var m6=Object.defineProperty;var g6=(e,t,r)=>t in e?m6(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var wr=(e,t,r)=>g6(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var S0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var E4={exports:{}},mm={},I4={exports:{}},gr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jf=Symbol.for("react.element"),x6=Symbol.for("react.portal"),y6=Symbol.for("react.fragment"),b6=Symbol.for("react.strict_mode"),v6=Symbol.for("react.profiler"),w6=Symbol.for("react.provider"),k6=Symbol.for("react.context"),S6=Symbol.for("react.forward_ref"),M6=Symbol.for("react.suspense"),j6=Symbol.for("react.memo"),N6=Symbol.for("react.lazy"),Ow=Symbol.iterator;function _6(e){return e===null||typeof e!="object"?null:(e=Ow&&e[Ow]||e["@@iterator"],typeof e=="function"?e:null)}var R4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},D4=Object.assign,$4={};function Tu(e,t,r){this.props=e,this.context=t,this.refs=$4,this.updater=r||R4}Tu.prototype.isReactComponent={};Tu.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Tu.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function L4(){}L4.prototype=Tu.prototype;function Jb(e,t,r){this.props=e,this.context=t,this.refs=$4,this.updater=r||R4}var Qb=Jb.prototype=new L4;Qb.constructor=Jb;D4(Qb,Tu.prototype);Qb.isPureReactComponent=!0;var Tw=Array.isArray,F4=Object.prototype.hasOwnProperty,ev={current:null},B4={key:!0,ref:!0,__self:!0,__source:!0};function G4(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)F4.call(t,n)&&!B4.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Jf,type:e,key:i,ref:o,props:a,_owner:ev.current}}function P6(e,t){return{$$typeof:Jf,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function tv(e){return typeof e=="object"&&e!==null&&e.$$typeof===Jf}function C6(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var Ew=/\/+/g;function zg(e,t){return typeof e=="object"&&e!==null&&e.key!=null?C6(""+e.key):t.toString(36)}function gh(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Jf:case x6:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+zg(o,0):n,Tw(a)?(r="",e!=null&&(r=e.replace(Ew,"$&/")+"/"),gh(a,t,r,"",function(u){return u})):a!=null&&(tv(a)&&(a=P6(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(Ew,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",Tw(e))for(var s=0;s<e.length;s++){i=e[s];var l=n+zg(i,s);o+=gh(i,t,r,l,a)}else if(l=_6(e),typeof l=="function")for(e=l.call(e),s=0;!(i=e.next()).done;)i=i.value,l=n+zg(i,s++),o+=gh(i,t,r,l,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function M0(e,t,r){if(e==null)return e;var n=[],a=0;return gh(e,n,"","",function(i){return t.call(r,i,a++)}),n}function A6(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var Ma={current:null},xh={transition:null},O6={ReactCurrentDispatcher:Ma,ReactCurrentBatchConfig:xh,ReactCurrentOwner:ev};function U4(){throw Error("act(...) is not supported in production builds of React.")}gr.Children={map:M0,forEach:function(e,t,r){M0(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return M0(e,function(){t++}),t},toArray:function(e){return M0(e,function(t){return t})||[]},only:function(e){if(!tv(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};gr.Component=Tu;gr.Fragment=y6;gr.Profiler=v6;gr.PureComponent=Jb;gr.StrictMode=b6;gr.Suspense=M6;gr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O6;gr.act=U4;gr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=D4({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=ev.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)F4.call(t,l)&&!B4.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&s!==void 0?s[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];n.children=s}return{$$typeof:Jf,type:e.type,key:a,ref:i,props:n,_owner:o}};gr.createContext=function(e){return e={$$typeof:k6,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:w6,_context:e},e.Consumer=e};gr.createElement=G4;gr.createFactory=function(e){var t=G4.bind(null,e);return t.type=e,t};gr.createRef=function(){return{current:null}};gr.forwardRef=function(e){return{$$typeof:S6,render:e}};gr.isValidElement=tv;gr.lazy=function(e){return{$$typeof:N6,_payload:{_status:-1,_result:e},_init:A6}};gr.memo=function(e,t){return{$$typeof:j6,type:e,compare:t===void 0?null:t}};gr.startTransition=function(e){var t=xh.transition;xh.transition={};try{e()}finally{xh.transition=t}};gr.unstable_act=U4;gr.useCallback=function(e,t){return Ma.current.useCallback(e,t)};gr.useContext=function(e){return Ma.current.useContext(e)};gr.useDebugValue=function(){};gr.useDeferredValue=function(e){return Ma.current.useDeferredValue(e)};gr.useEffect=function(e,t){return Ma.current.useEffect(e,t)};gr.useId=function(){return Ma.current.useId()};gr.useImperativeHandle=function(e,t,r){return Ma.current.useImperativeHandle(e,t,r)};gr.useInsertionEffect=function(e,t){return Ma.current.useInsertionEffect(e,t)};gr.useLayoutEffect=function(e,t){return Ma.current.useLayoutEffect(e,t)};gr.useMemo=function(e,t){return Ma.current.useMemo(e,t)};gr.useReducer=function(e,t,r){return Ma.current.useReducer(e,t,r)};gr.useRef=function(e){return Ma.current.useRef(e)};gr.useState=function(e){return Ma.current.useState(e)};gr.useSyncExternalStore=function(e,t,r){return Ma.current.useSyncExternalStore(e,t,r)};gr.useTransition=function(){return Ma.current.useTransition()};gr.version="18.3.1";I4.exports=gr;var j=I4.exports;const ee=Vr(j);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var T6=j,E6=Symbol.for("react.element"),I6=Symbol.for("react.fragment"),R6=Object.prototype.hasOwnProperty,D6=T6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$6={key:!0,ref:!0,__self:!0,__source:!0};function z4(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)R6.call(t,n)&&!$6.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:E6,type:e,key:i,ref:o,props:a,_owner:D6.current}}mm.Fragment=I6;mm.jsx=z4;mm.jsxs=z4;E4.exports=mm;var c=E4.exports,py={},W4={exports:{}},ti={},V4={exports:{}},H4={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(A,O){var F=A.length;A.push(O);e:for(;0<F;){var D=F-1>>>1,W=A[D];if(0<a(W,O))A[D]=O,A[F]=W,F=D;else break e}}function r(A){return A.length===0?null:A[0]}function n(A){if(A.length===0)return null;var O=A[0],F=A.pop();if(F!==O){A[0]=F;e:for(var D=0,W=A.length,H=W>>>1;D<H;){var Y=2*(D+1)-1,te=A[Y],U=Y+1,Se=A[U];if(0>a(te,F))U<W&&0>a(Se,te)?(A[D]=Se,A[U]=F,D=U):(A[D]=te,A[Y]=F,D=Y);else if(U<W&&0>a(Se,F))A[D]=Se,A[U]=F,D=U;else break e}}return O}function a(A,O){var F=A.sortIndex-O.sortIndex;return F!==0?F:A.id-O.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],u=[],d=1,f=null,h=3,p=!1,x=!1,g=!1,b=typeof setTimeout=="function"?setTimeout:null,y=typeof clearTimeout=="function"?clearTimeout:null,m=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(A){for(var O=r(u);O!==null;){if(O.callback===null)n(u);else if(O.startTime<=A)n(u),O.sortIndex=O.expirationTime,t(l,O);else break;O=r(u)}}function S(A){if(g=!1,k(A),!x)if(r(l)!==null)x=!0,C(w);else{var O=r(u);O!==null&&$(S,O.startTime-A)}}function w(A,O){x=!1,g&&(g=!1,y(N),N=-1),p=!0;var F=h;try{for(k(O),f=r(l);f!==null&&(!(f.expirationTime>O)||A&&!E());){var D=f.callback;if(typeof D=="function"){f.callback=null,h=f.priorityLevel;var W=D(f.expirationTime<=O);O=e.unstable_now(),typeof W=="function"?f.callback=W:f===r(l)&&n(l),k(O)}else n(l);f=r(l)}if(f!==null)var H=!0;else{var Y=r(u);Y!==null&&$(S,Y.startTime-O),H=!1}return H}finally{f=null,h=F,p=!1}}var v=!1,M=null,N=-1,_=5,P=-1;function E(){return!(e.unstable_now()-P<_)}function R(){if(M!==null){var A=e.unstable_now();P=A;var O=!0;try{O=M(!0,A)}finally{O?T():(v=!1,M=null)}}else v=!1}var T;if(typeof m=="function")T=function(){m(R)};else if(typeof MessageChannel<"u"){var G=new MessageChannel,L=G.port2;G.port1.onmessage=R,T=function(){L.postMessage(null)}}else T=function(){b(R,0)};function C(A){M=A,v||(v=!0,T())}function $(A,O){N=b(function(){A(e.unstable_now())},O)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(A){A.callback=null},e.unstable_continueExecution=function(){x||p||(x=!0,C(w))},e.unstable_forceFrameRate=function(A){0>A||125<A?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<A?Math.floor(1e3/A):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(A){switch(h){case 1:case 2:case 3:var O=3;break;default:O=h}var F=h;h=O;try{return A()}finally{h=F}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(A,O){switch(A){case 1:case 2:case 3:case 4:case 5:break;default:A=3}var F=h;h=A;try{return O()}finally{h=F}},e.unstable_scheduleCallback=function(A,O,F){var D=e.unstable_now();switch(typeof F=="object"&&F!==null?(F=F.delay,F=typeof F=="number"&&0<F?D+F:D):F=D,A){case 1:var W=-1;break;case 2:W=250;break;case 5:W=1073741823;break;case 4:W=1e4;break;default:W=5e3}return W=F+W,A={id:d++,callback:O,priorityLevel:A,startTime:F,expirationTime:W,sortIndex:-1},F>D?(A.sortIndex=F,t(u,A),r(l)===null&&A===r(u)&&(g?(y(N),N=-1):g=!0,$(S,F-D))):(A.sortIndex=W,t(l,A),x||p||(x=!0,C(w))),A},e.unstable_shouldYield=E,e.unstable_wrapCallback=function(A){var O=h;return function(){var F=h;h=O;try{return A.apply(this,arguments)}finally{h=F}}}})(H4);V4.exports=H4;var L6=V4.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var F6=j,ei=L6;function Re(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var X4=new Set,Zd={};function Kl(e,t){Vc(e,t),Vc(e+"Capture",t)}function Vc(e,t){for(Zd[e]=t,e=0;e<t.length;e++)X4.add(t[e])}var Io=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),my=Object.prototype.hasOwnProperty,B6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Iw={},Rw={};function G6(e){return my.call(Rw,e)?!0:my.call(Iw,e)?!1:B6.test(e)?Rw[e]=!0:(Iw[e]=!0,!1)}function U6(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function z6(e,t,r,n){if(t===null||typeof t>"u"||U6(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function ja(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var ta={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ta[e]=new ja(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];ta[t]=new ja(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ta[e]=new ja(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ta[e]=new ja(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ta[e]=new ja(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ta[e]=new ja(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ta[e]=new ja(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ta[e]=new ja(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ta[e]=new ja(e,5,!1,e.toLowerCase(),null,!1,!1)});var rv=/[\-:]([a-z])/g;function nv(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(rv,nv);ta[t]=new ja(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(rv,nv);ta[t]=new ja(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(rv,nv);ta[t]=new ja(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ta[e]=new ja(e,1,!1,e.toLowerCase(),null,!1,!1)});ta.xlinkHref=new ja("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ta[e]=new ja(e,1,!1,e.toLowerCase(),null,!0,!0)});function av(e,t,r,n){var a=ta.hasOwnProperty(t)?ta[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(z6(t,r,a,n)&&(r=null),n||a===null?G6(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Uo=F6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,j0=Symbol.for("react.element"),yc=Symbol.for("react.portal"),bc=Symbol.for("react.fragment"),iv=Symbol.for("react.strict_mode"),gy=Symbol.for("react.profiler"),K4=Symbol.for("react.provider"),Y4=Symbol.for("react.context"),ov=Symbol.for("react.forward_ref"),xy=Symbol.for("react.suspense"),yy=Symbol.for("react.suspense_list"),sv=Symbol.for("react.memo"),ss=Symbol.for("react.lazy"),q4=Symbol.for("react.offscreen"),Dw=Symbol.iterator;function od(e){return e===null||typeof e!="object"?null:(e=Dw&&e[Dw]||e["@@iterator"],typeof e=="function"?e:null)}var fn=Object.assign,Wg;function _d(e){if(Wg===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Wg=t&&t[1]||""}return`
`+Wg+e}var Vg=!1;function Hg(e,t){if(!e||Vg)return"";Vg=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s]){var l=`
`+a[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=s);break}}}finally{Vg=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?_d(e):""}function W6(e){switch(e.tag){case 5:return _d(e.type);case 16:return _d("Lazy");case 13:return _d("Suspense");case 19:return _d("SuspenseList");case 0:case 2:case 15:return e=Hg(e.type,!1),e;case 11:return e=Hg(e.type.render,!1),e;case 1:return e=Hg(e.type,!0),e;default:return""}}function by(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case bc:return"Fragment";case yc:return"Portal";case gy:return"Profiler";case iv:return"StrictMode";case xy:return"Suspense";case yy:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Y4:return(e.displayName||"Context")+".Consumer";case K4:return(e._context.displayName||"Context")+".Provider";case ov:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case sv:return t=e.displayName||null,t!==null?t:by(e.type)||"Memo";case ss:t=e._payload,e=e._init;try{return by(e(t))}catch{}}return null}function V6(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return by(t);case 8:return t===iv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function $s(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Z4(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function H6(e){var t=Z4(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function N0(e){e._valueTracker||(e._valueTracker=H6(e))}function J4(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Z4(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function Eh(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function vy(e,t){var r=t.checked;return fn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function $w(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=$s(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Q4(e,t){t=t.checked,t!=null&&av(e,"checked",t,!1)}function wy(e,t){Q4(e,t);var r=$s(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?ky(e,t.type,r):t.hasOwnProperty("defaultValue")&&ky(e,t.type,$s(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Lw(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function ky(e,t,r){(t!=="number"||Eh(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var Pd=Array.isArray;function Ic(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+$s(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function Sy(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Re(91));return fn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Fw(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Re(92));if(Pd(r)){if(1<r.length)throw Error(Re(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:$s(r)}}function ej(e,t){var r=$s(t.value),n=$s(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function Bw(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function tj(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function My(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?tj(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var _0,rj=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(_0=_0||document.createElement("div"),_0.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=_0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Jd(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Td={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},X6=["Webkit","ms","Moz","O"];Object.keys(Td).forEach(function(e){X6.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Td[t]=Td[e]})});function nj(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Td.hasOwnProperty(e)&&Td[e]?(""+t).trim():t+"px"}function aj(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=nj(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var K6=fn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function jy(e,t){if(t){if(K6[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Re(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Re(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Re(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Re(62))}}function Ny(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var _y=null;function lv(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Py=null,Rc=null,Dc=null;function Gw(e){if(e=t0(e)){if(typeof Py!="function")throw Error(Re(280));var t=e.stateNode;t&&(t=vm(t),Py(e.stateNode,e.type,t))}}function ij(e){Rc?Dc?Dc.push(e):Dc=[e]:Rc=e}function oj(){if(Rc){var e=Rc,t=Dc;if(Dc=Rc=null,Gw(e),t)for(e=0;e<t.length;e++)Gw(t[e])}}function sj(e,t){return e(t)}function lj(){}var Xg=!1;function cj(e,t,r){if(Xg)return e(t,r);Xg=!0;try{return sj(e,t,r)}finally{Xg=!1,(Rc!==null||Dc!==null)&&(lj(),oj())}}function Qd(e,t){var r=e.stateNode;if(r===null)return null;var n=vm(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Re(231,t,typeof r));return r}var Cy=!1;if(Io)try{var sd={};Object.defineProperty(sd,"passive",{get:function(){Cy=!0}}),window.addEventListener("test",sd,sd),window.removeEventListener("test",sd,sd)}catch{Cy=!1}function Y6(e,t,r,n,a,i,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(d){this.onError(d)}}var Ed=!1,Ih=null,Rh=!1,Ay=null,q6={onError:function(e){Ed=!0,Ih=e}};function Z6(e,t,r,n,a,i,o,s,l){Ed=!1,Ih=null,Y6.apply(q6,arguments)}function J6(e,t,r,n,a,i,o,s,l){if(Z6.apply(this,arguments),Ed){if(Ed){var u=Ih;Ed=!1,Ih=null}else throw Error(Re(198));Rh||(Rh=!0,Ay=u)}}function Yl(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function uj(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Uw(e){if(Yl(e)!==e)throw Error(Re(188))}function Q6(e){var t=e.alternate;if(!t){if(t=Yl(e),t===null)throw Error(Re(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return Uw(a),e;if(i===n)return Uw(a),t;i=i.sibling}throw Error(Re(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(Re(189))}}if(r.alternate!==n)throw Error(Re(190))}if(r.tag!==3)throw Error(Re(188));return r.stateNode.current===r?e:t}function dj(e){return e=Q6(e),e!==null?fj(e):null}function fj(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=fj(e);if(t!==null)return t;e=e.sibling}return null}var hj=ei.unstable_scheduleCallback,zw=ei.unstable_cancelCallback,eT=ei.unstable_shouldYield,tT=ei.unstable_requestPaint,vn=ei.unstable_now,rT=ei.unstable_getCurrentPriorityLevel,cv=ei.unstable_ImmediatePriority,pj=ei.unstable_UserBlockingPriority,Dh=ei.unstable_NormalPriority,nT=ei.unstable_LowPriority,mj=ei.unstable_IdlePriority,gm=null,Qi=null;function aT(e){if(Qi&&typeof Qi.onCommitFiberRoot=="function")try{Qi.onCommitFiberRoot(gm,e,void 0,(e.current.flags&128)===128)}catch{}}var $i=Math.clz32?Math.clz32:sT,iT=Math.log,oT=Math.LN2;function sT(e){return e>>>=0,e===0?32:31-(iT(e)/oT|0)|0}var P0=64,C0=4194304;function Cd(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function $h(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,i=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~a;s!==0?n=Cd(s):(i&=o,i!==0&&(n=Cd(i)))}else o=r&~a,o!==0?n=Cd(o):i!==0&&(n=Cd(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-$i(t),a=1<<r,n|=e[r],t&=~a;return n}function lT(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function cT(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-$i(i),s=1<<o,l=a[o];l===-1?(!(s&r)||s&n)&&(a[o]=lT(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}function Oy(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function gj(){var e=P0;return P0<<=1,!(P0&4194240)&&(P0=64),e}function Kg(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Qf(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-$i(t),e[t]=r}function uT(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-$i(r),i=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~i}}function uv(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-$i(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var Lr=0;function xj(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var yj,dv,bj,vj,wj,Ty=!1,A0=[],Ns=null,_s=null,Ps=null,ef=new Map,tf=new Map,ds=[],dT="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ww(e,t){switch(e){case"focusin":case"focusout":Ns=null;break;case"dragenter":case"dragleave":_s=null;break;case"mouseover":case"mouseout":Ps=null;break;case"pointerover":case"pointerout":ef.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":tf.delete(t.pointerId)}}function ld(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},t!==null&&(t=t0(t),t!==null&&dv(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function fT(e,t,r,n,a){switch(t){case"focusin":return Ns=ld(Ns,e,t,r,n,a),!0;case"dragenter":return _s=ld(_s,e,t,r,n,a),!0;case"mouseover":return Ps=ld(Ps,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return ef.set(i,ld(ef.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,tf.set(i,ld(tf.get(i)||null,e,t,r,n,a)),!0}return!1}function kj(e){var t=ul(e.target);if(t!==null){var r=Yl(t);if(r!==null){if(t=r.tag,t===13){if(t=uj(r),t!==null){e.blockedOn=t,wj(e.priority,function(){bj(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function yh(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=Ey(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);_y=n,r.target.dispatchEvent(n),_y=null}else return t=t0(r),t!==null&&dv(t),e.blockedOn=r,!1;t.shift()}return!0}function Vw(e,t,r){yh(e)&&r.delete(t)}function hT(){Ty=!1,Ns!==null&&yh(Ns)&&(Ns=null),_s!==null&&yh(_s)&&(_s=null),Ps!==null&&yh(Ps)&&(Ps=null),ef.forEach(Vw),tf.forEach(Vw)}function cd(e,t){e.blockedOn===t&&(e.blockedOn=null,Ty||(Ty=!0,ei.unstable_scheduleCallback(ei.unstable_NormalPriority,hT)))}function rf(e){function t(a){return cd(a,e)}if(0<A0.length){cd(A0[0],e);for(var r=1;r<A0.length;r++){var n=A0[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Ns!==null&&cd(Ns,e),_s!==null&&cd(_s,e),Ps!==null&&cd(Ps,e),ef.forEach(t),tf.forEach(t),r=0;r<ds.length;r++)n=ds[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<ds.length&&(r=ds[0],r.blockedOn===null);)kj(r),r.blockedOn===null&&ds.shift()}var $c=Uo.ReactCurrentBatchConfig,Lh=!0;function pT(e,t,r,n){var a=Lr,i=$c.transition;$c.transition=null;try{Lr=1,fv(e,t,r,n)}finally{Lr=a,$c.transition=i}}function mT(e,t,r,n){var a=Lr,i=$c.transition;$c.transition=null;try{Lr=4,fv(e,t,r,n)}finally{Lr=a,$c.transition=i}}function fv(e,t,r,n){if(Lh){var a=Ey(e,t,r,n);if(a===null)ax(e,t,n,Fh,r),Ww(e,n);else if(fT(a,e,t,r,n))n.stopPropagation();else if(Ww(e,n),t&4&&-1<dT.indexOf(e)){for(;a!==null;){var i=t0(a);if(i!==null&&yj(i),i=Ey(e,t,r,n),i===null&&ax(e,t,n,Fh,r),i===a)break;a=i}a!==null&&n.stopPropagation()}else ax(e,t,n,null,r)}}var Fh=null;function Ey(e,t,r,n){if(Fh=null,e=lv(n),e=ul(e),e!==null)if(t=Yl(e),t===null)e=null;else if(r=t.tag,r===13){if(e=uj(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Fh=e,null}function Sj(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(rT()){case cv:return 1;case pj:return 4;case Dh:case nT:return 16;case mj:return 536870912;default:return 16}default:return 16}}var ps=null,hv=null,bh=null;function Mj(){if(bh)return bh;var e,t=hv,r=t.length,n,a="value"in ps?ps.value:ps.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return bh=a.slice(e,1<n?1-n:void 0)}function vh(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function O0(){return!0}function Hw(){return!1}function ri(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?O0:Hw,this.isPropagationStopped=Hw,this}return fn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=O0)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=O0)},persist:function(){},isPersistent:O0}),t}var Eu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},pv=ri(Eu),e0=fn({},Eu,{view:0,detail:0}),gT=ri(e0),Yg,qg,ud,xm=fn({},e0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:mv,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==ud&&(ud&&e.type==="mousemove"?(Yg=e.screenX-ud.screenX,qg=e.screenY-ud.screenY):qg=Yg=0,ud=e),Yg)},movementY:function(e){return"movementY"in e?e.movementY:qg}}),Xw=ri(xm),xT=fn({},xm,{dataTransfer:0}),yT=ri(xT),bT=fn({},e0,{relatedTarget:0}),Zg=ri(bT),vT=fn({},Eu,{animationName:0,elapsedTime:0,pseudoElement:0}),wT=ri(vT),kT=fn({},Eu,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),ST=ri(kT),MT=fn({},Eu,{data:0}),Kw=ri(MT),jT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},NT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_T={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function PT(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=_T[e])?!!t[e]:!1}function mv(){return PT}var CT=fn({},e0,{key:function(e){if(e.key){var t=jT[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=vh(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?NT[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:mv,charCode:function(e){return e.type==="keypress"?vh(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?vh(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),AT=ri(CT),OT=fn({},xm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Yw=ri(OT),TT=fn({},e0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:mv}),ET=ri(TT),IT=fn({},Eu,{propertyName:0,elapsedTime:0,pseudoElement:0}),RT=ri(IT),DT=fn({},xm,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$T=ri(DT),LT=[9,13,27,32],gv=Io&&"CompositionEvent"in window,Id=null;Io&&"documentMode"in document&&(Id=document.documentMode);var FT=Io&&"TextEvent"in window&&!Id,jj=Io&&(!gv||Id&&8<Id&&11>=Id),qw=" ",Zw=!1;function Nj(e,t){switch(e){case"keyup":return LT.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function _j(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var vc=!1;function BT(e,t){switch(e){case"compositionend":return _j(t);case"keypress":return t.which!==32?null:(Zw=!0,qw);case"textInput":return e=t.data,e===qw&&Zw?null:e;default:return null}}function GT(e,t){if(vc)return e==="compositionend"||!gv&&Nj(e,t)?(e=Mj(),bh=hv=ps=null,vc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return jj&&t.locale!=="ko"?null:t.data;default:return null}}var UT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Jw(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!UT[e.type]:t==="textarea"}function Pj(e,t,r,n){ij(n),t=Bh(t,"onChange"),0<t.length&&(r=new pv("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Rd=null,nf=null;function zT(e){Fj(e,0)}function ym(e){var t=Sc(e);if(J4(t))return e}function WT(e,t){if(e==="change")return t}var Cj=!1;if(Io){var Jg;if(Io){var Qg="oninput"in document;if(!Qg){var Qw=document.createElement("div");Qw.setAttribute("oninput","return;"),Qg=typeof Qw.oninput=="function"}Jg=Qg}else Jg=!1;Cj=Jg&&(!document.documentMode||9<document.documentMode)}function ek(){Rd&&(Rd.detachEvent("onpropertychange",Aj),nf=Rd=null)}function Aj(e){if(e.propertyName==="value"&&ym(nf)){var t=[];Pj(t,nf,e,lv(e)),cj(zT,t)}}function VT(e,t,r){e==="focusin"?(ek(),Rd=t,nf=r,Rd.attachEvent("onpropertychange",Aj)):e==="focusout"&&ek()}function HT(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ym(nf)}function XT(e,t){if(e==="click")return ym(t)}function KT(e,t){if(e==="input"||e==="change")return ym(t)}function YT(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Fi=typeof Object.is=="function"?Object.is:YT;function af(e,t){if(Fi(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!my.call(t,a)||!Fi(e[a],t[a]))return!1}return!0}function tk(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function rk(e,t){var r=tk(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=tk(r)}}function Oj(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Oj(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Tj(){for(var e=window,t=Eh();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=Eh(e.document)}return t}function xv(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function qT(e){var t=Tj(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&Oj(r.ownerDocument.documentElement,r)){if(n!==null&&xv(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!e.extend&&i>n&&(a=n,n=i,i=a),a=rk(r,i);var o=rk(r,n);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var ZT=Io&&"documentMode"in document&&11>=document.documentMode,wc=null,Iy=null,Dd=null,Ry=!1;function nk(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;Ry||wc==null||wc!==Eh(n)||(n=wc,"selectionStart"in n&&xv(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Dd&&af(Dd,n)||(Dd=n,n=Bh(Iy,"onSelect"),0<n.length&&(t=new pv("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=wc)))}function T0(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var kc={animationend:T0("Animation","AnimationEnd"),animationiteration:T0("Animation","AnimationIteration"),animationstart:T0("Animation","AnimationStart"),transitionend:T0("Transition","TransitionEnd")},ex={},Ej={};Io&&(Ej=document.createElement("div").style,"AnimationEvent"in window||(delete kc.animationend.animation,delete kc.animationiteration.animation,delete kc.animationstart.animation),"TransitionEvent"in window||delete kc.transitionend.transition);function bm(e){if(ex[e])return ex[e];if(!kc[e])return e;var t=kc[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in Ej)return ex[e]=t[r];return e}var Ij=bm("animationend"),Rj=bm("animationiteration"),Dj=bm("animationstart"),$j=bm("transitionend"),Lj=new Map,ak="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Fs(e,t){Lj.set(e,t),Kl(t,[e])}for(var tx=0;tx<ak.length;tx++){var rx=ak[tx],JT=rx.toLowerCase(),QT=rx[0].toUpperCase()+rx.slice(1);Fs(JT,"on"+QT)}Fs(Ij,"onAnimationEnd");Fs(Rj,"onAnimationIteration");Fs(Dj,"onAnimationStart");Fs("dblclick","onDoubleClick");Fs("focusin","onFocus");Fs("focusout","onBlur");Fs($j,"onTransitionEnd");Vc("onMouseEnter",["mouseout","mouseover"]);Vc("onMouseLeave",["mouseout","mouseover"]);Vc("onPointerEnter",["pointerout","pointerover"]);Vc("onPointerLeave",["pointerout","pointerover"]);Kl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Kl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Kl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Kl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Kl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Kl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ad="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eE=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ad));function ik(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,J6(n,t,void 0,e),e.currentTarget=null}function Fj(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==i&&a.isPropagationStopped())break e;ik(a,s,u),i=l}else for(o=0;o<n.length;o++){if(s=n[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==i&&a.isPropagationStopped())break e;ik(a,s,u),i=l}}}if(Rh)throw e=Ay,Rh=!1,Ay=null,e}function en(e,t){var r=t[By];r===void 0&&(r=t[By]=new Set);var n=e+"__bubble";r.has(n)||(Bj(t,e,2,!1),r.add(n))}function nx(e,t,r){var n=0;t&&(n|=4),Bj(r,e,n,t)}var E0="_reactListening"+Math.random().toString(36).slice(2);function of(e){if(!e[E0]){e[E0]=!0,X4.forEach(function(r){r!=="selectionchange"&&(eE.has(r)||nx(r,!1,e),nx(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[E0]||(t[E0]=!0,nx("selectionchange",!1,t))}}function Bj(e,t,r,n){switch(Sj(t)){case 1:var a=pT;break;case 4:a=mT;break;default:a=fv}r=a.bind(null,t,r,e),a=void 0,!Cy||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function ax(e,t,r,n,a){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===a||l.nodeType===8&&l.parentNode===a))return;o=o.return}for(;s!==null;){if(o=ul(s),o===null)return;if(l=o.tag,l===5||l===6){n=i=o;continue e}s=s.parentNode}}n=n.return}cj(function(){var u=i,d=lv(r),f=[];e:{var h=Lj.get(e);if(h!==void 0){var p=pv,x=e;switch(e){case"keypress":if(vh(r)===0)break e;case"keydown":case"keyup":p=AT;break;case"focusin":x="focus",p=Zg;break;case"focusout":x="blur",p=Zg;break;case"beforeblur":case"afterblur":p=Zg;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Xw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=yT;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=ET;break;case Ij:case Rj:case Dj:p=wT;break;case $j:p=RT;break;case"scroll":p=gT;break;case"wheel":p=$T;break;case"copy":case"cut":case"paste":p=ST;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Yw}var g=(t&4)!==0,b=!g&&e==="scroll",y=g?h!==null?h+"Capture":null:h;g=[];for(var m=u,k;m!==null;){k=m;var S=k.stateNode;if(k.tag===5&&S!==null&&(k=S,y!==null&&(S=Qd(m,y),S!=null&&g.push(sf(m,S,k)))),b)break;m=m.return}0<g.length&&(h=new p(h,x,null,r,d),f.push({event:h,listeners:g}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&r!==_y&&(x=r.relatedTarget||r.fromElement)&&(ul(x)||x[Ro]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(x=r.relatedTarget||r.toElement,p=u,x=x?ul(x):null,x!==null&&(b=Yl(x),x!==b||x.tag!==5&&x.tag!==6)&&(x=null)):(p=null,x=u),p!==x)){if(g=Xw,S="onMouseLeave",y="onMouseEnter",m="mouse",(e==="pointerout"||e==="pointerover")&&(g=Yw,S="onPointerLeave",y="onPointerEnter",m="pointer"),b=p==null?h:Sc(p),k=x==null?h:Sc(x),h=new g(S,m+"leave",p,r,d),h.target=b,h.relatedTarget=k,S=null,ul(d)===u&&(g=new g(y,m+"enter",x,r,d),g.target=k,g.relatedTarget=b,S=g),b=S,p&&x)t:{for(g=p,y=x,m=0,k=g;k;k=uc(k))m++;for(k=0,S=y;S;S=uc(S))k++;for(;0<m-k;)g=uc(g),m--;for(;0<k-m;)y=uc(y),k--;for(;m--;){if(g===y||y!==null&&g===y.alternate)break t;g=uc(g),y=uc(y)}g=null}else g=null;p!==null&&ok(f,h,p,g,!1),x!==null&&b!==null&&ok(f,b,x,g,!0)}}e:{if(h=u?Sc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var w=WT;else if(Jw(h))if(Cj)w=KT;else{w=HT;var v=VT}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=XT);if(w&&(w=w(e,u))){Pj(f,w,r,d);break e}v&&v(e,h,u),e==="focusout"&&(v=h._wrapperState)&&v.controlled&&h.type==="number"&&ky(h,"number",h.value)}switch(v=u?Sc(u):window,e){case"focusin":(Jw(v)||v.contentEditable==="true")&&(wc=v,Iy=u,Dd=null);break;case"focusout":Dd=Iy=wc=null;break;case"mousedown":Ry=!0;break;case"contextmenu":case"mouseup":case"dragend":Ry=!1,nk(f,r,d);break;case"selectionchange":if(ZT)break;case"keydown":case"keyup":nk(f,r,d)}var M;if(gv)e:{switch(e){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else vc?Nj(e,r)&&(N="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(N="onCompositionStart");N&&(jj&&r.locale!=="ko"&&(vc||N!=="onCompositionStart"?N==="onCompositionEnd"&&vc&&(M=Mj()):(ps=d,hv="value"in ps?ps.value:ps.textContent,vc=!0)),v=Bh(u,N),0<v.length&&(N=new Kw(N,e,null,r,d),f.push({event:N,listeners:v}),M?N.data=M:(M=_j(r),M!==null&&(N.data=M)))),(M=FT?BT(e,r):GT(e,r))&&(u=Bh(u,"onBeforeInput"),0<u.length&&(d=new Kw("onBeforeInput","beforeinput",null,r,d),f.push({event:d,listeners:u}),d.data=M))}Fj(f,t)})}function sf(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Bh(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Qd(e,r),i!=null&&n.unshift(sf(e,i,a)),i=Qd(e,t),i!=null&&n.push(sf(e,i,a))),e=e.return}return n}function uc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function ok(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,l=s.alternate,u=s.stateNode;if(l!==null&&l===n)break;s.tag===5&&u!==null&&(s=u,a?(l=Qd(r,i),l!=null&&o.unshift(sf(r,l,s))):a||(l=Qd(r,i),l!=null&&o.push(sf(r,l,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var tE=/\r\n?/g,rE=/\u0000|\uFFFD/g;function sk(e){return(typeof e=="string"?e:""+e).replace(tE,`
`).replace(rE,"")}function I0(e,t,r){if(t=sk(t),sk(e)!==t&&r)throw Error(Re(425))}function Gh(){}var Dy=null,$y=null;function Ly(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Fy=typeof setTimeout=="function"?setTimeout:void 0,nE=typeof clearTimeout=="function"?clearTimeout:void 0,lk=typeof Promise=="function"?Promise:void 0,aE=typeof queueMicrotask=="function"?queueMicrotask:typeof lk<"u"?function(e){return lk.resolve(null).then(e).catch(iE)}:Fy;function iE(e){setTimeout(function(){throw e})}function ix(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),rf(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);rf(t)}function Cs(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function ck(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Iu=Math.random().toString(36).slice(2),Yi="__reactFiber$"+Iu,lf="__reactProps$"+Iu,Ro="__reactContainer$"+Iu,By="__reactEvents$"+Iu,oE="__reactListeners$"+Iu,sE="__reactHandles$"+Iu;function ul(e){var t=e[Yi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[Ro]||r[Yi]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=ck(e);e!==null;){if(r=e[Yi])return r;e=ck(e)}return t}e=r,r=e.parentNode}return null}function t0(e){return e=e[Yi]||e[Ro],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Sc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Re(33))}function vm(e){return e[lf]||null}var Gy=[],Mc=-1;function Bs(e){return{current:e}}function nn(e){0>Mc||(e.current=Gy[Mc],Gy[Mc]=null,Mc--)}function Qr(e,t){Mc++,Gy[Mc]=e.current,e.current=t}var Ls={},fa=Bs(Ls),Da=Bs(!1),Cl=Ls;function Hc(e,t){var r=e.type.contextTypes;if(!r)return Ls;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function $a(e){return e=e.childContextTypes,e!=null}function Uh(){nn(Da),nn(fa)}function uk(e,t,r){if(fa.current!==Ls)throw Error(Re(168));Qr(fa,t),Qr(Da,r)}function Gj(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(Re(108,V6(e)||"Unknown",a));return fn({},r,n)}function zh(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ls,Cl=fa.current,Qr(fa,e),Qr(Da,Da.current),!0}function dk(e,t,r){var n=e.stateNode;if(!n)throw Error(Re(169));r?(e=Gj(e,t,Cl),n.__reactInternalMemoizedMergedChildContext=e,nn(Da),nn(fa),Qr(fa,e)):nn(Da),Qr(Da,r)}var Mo=null,wm=!1,ox=!1;function Uj(e){Mo===null?Mo=[e]:Mo.push(e)}function lE(e){wm=!0,Uj(e)}function Gs(){if(!ox&&Mo!==null){ox=!0;var e=0,t=Lr;try{var r=Mo;for(Lr=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}Mo=null,wm=!1}catch(a){throw Mo!==null&&(Mo=Mo.slice(e+1)),hj(cv,Gs),a}finally{Lr=t,ox=!1}}return null}var jc=[],Nc=0,Wh=null,Vh=0,ui=[],di=0,Al=null,jo=1,No="";function il(e,t){jc[Nc++]=Vh,jc[Nc++]=Wh,Wh=e,Vh=t}function zj(e,t,r){ui[di++]=jo,ui[di++]=No,ui[di++]=Al,Al=e;var n=jo;e=No;var a=32-$i(n)-1;n&=~(1<<a),r+=1;var i=32-$i(t)+a;if(30<i){var o=a-a%5;i=(n&(1<<o)-1).toString(32),n>>=o,a-=o,jo=1<<32-$i(t)+a|r<<a|n,No=i+e}else jo=1<<i|r<<a|n,No=e}function yv(e){e.return!==null&&(il(e,1),zj(e,1,0))}function bv(e){for(;e===Wh;)Wh=jc[--Nc],jc[Nc]=null,Vh=jc[--Nc],jc[Nc]=null;for(;e===Al;)Al=ui[--di],ui[di]=null,No=ui[--di],ui[di]=null,jo=ui[--di],ui[di]=null}var Qa=null,Ja=null,sn=!1,Ti=null;function Wj(e,t){var r=fi(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function fk(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,Qa=e,Ja=Cs(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,Qa=e,Ja=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Al!==null?{id:jo,overflow:No}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=fi(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,Qa=e,Ja=null,!0):!1;default:return!1}}function Uy(e){return(e.mode&1)!==0&&(e.flags&128)===0}function zy(e){if(sn){var t=Ja;if(t){var r=t;if(!fk(e,t)){if(Uy(e))throw Error(Re(418));t=Cs(r.nextSibling);var n=Qa;t&&fk(e,t)?Wj(n,r):(e.flags=e.flags&-4097|2,sn=!1,Qa=e)}}else{if(Uy(e))throw Error(Re(418));e.flags=e.flags&-4097|2,sn=!1,Qa=e}}}function hk(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Qa=e}function R0(e){if(e!==Qa)return!1;if(!sn)return hk(e),sn=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ly(e.type,e.memoizedProps)),t&&(t=Ja)){if(Uy(e))throw Vj(),Error(Re(418));for(;t;)Wj(e,t),t=Cs(t.nextSibling)}if(hk(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Re(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Ja=Cs(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Ja=null}}else Ja=Qa?Cs(e.stateNode.nextSibling):null;return!0}function Vj(){for(var e=Ja;e;)e=Cs(e.nextSibling)}function Xc(){Ja=Qa=null,sn=!1}function vv(e){Ti===null?Ti=[e]:Ti.push(e)}var cE=Uo.ReactCurrentBatchConfig;function dd(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Re(309));var n=r.stateNode}if(!n)throw Error(Re(147,e));var a=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var s=a.refs;o===null?delete s[i]:s[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(Re(284));if(!r._owner)throw Error(Re(290,e))}return e}function D0(e,t){throw e=Object.prototype.toString.call(t),Error(Re(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function pk(e){var t=e._init;return t(e._payload)}function Hj(e){function t(y,m){if(e){var k=y.deletions;k===null?(y.deletions=[m],y.flags|=16):k.push(m)}}function r(y,m){if(!e)return null;for(;m!==null;)t(y,m),m=m.sibling;return null}function n(y,m){for(y=new Map;m!==null;)m.key!==null?y.set(m.key,m):y.set(m.index,m),m=m.sibling;return y}function a(y,m){return y=Es(y,m),y.index=0,y.sibling=null,y}function i(y,m,k){return y.index=k,e?(k=y.alternate,k!==null?(k=k.index,k<m?(y.flags|=2,m):k):(y.flags|=2,m)):(y.flags|=1048576,m)}function o(y){return e&&y.alternate===null&&(y.flags|=2),y}function s(y,m,k,S){return m===null||m.tag!==6?(m=hx(k,y.mode,S),m.return=y,m):(m=a(m,k),m.return=y,m)}function l(y,m,k,S){var w=k.type;return w===bc?d(y,m,k.props.children,S,k.key):m!==null&&(m.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ss&&pk(w)===m.type)?(S=a(m,k.props),S.ref=dd(y,m,k),S.return=y,S):(S=_h(k.type,k.key,k.props,null,y.mode,S),S.ref=dd(y,m,k),S.return=y,S)}function u(y,m,k,S){return m===null||m.tag!==4||m.stateNode.containerInfo!==k.containerInfo||m.stateNode.implementation!==k.implementation?(m=px(k,y.mode,S),m.return=y,m):(m=a(m,k.children||[]),m.return=y,m)}function d(y,m,k,S,w){return m===null||m.tag!==7?(m=Ml(k,y.mode,S,w),m.return=y,m):(m=a(m,k),m.return=y,m)}function f(y,m,k){if(typeof m=="string"&&m!==""||typeof m=="number")return m=hx(""+m,y.mode,k),m.return=y,m;if(typeof m=="object"&&m!==null){switch(m.$$typeof){case j0:return k=_h(m.type,m.key,m.props,null,y.mode,k),k.ref=dd(y,null,m),k.return=y,k;case yc:return m=px(m,y.mode,k),m.return=y,m;case ss:var S=m._init;return f(y,S(m._payload),k)}if(Pd(m)||od(m))return m=Ml(m,y.mode,k,null),m.return=y,m;D0(y,m)}return null}function h(y,m,k,S){var w=m!==null?m.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return w!==null?null:s(y,m,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case j0:return k.key===w?l(y,m,k,S):null;case yc:return k.key===w?u(y,m,k,S):null;case ss:return w=k._init,h(y,m,w(k._payload),S)}if(Pd(k)||od(k))return w!==null?null:d(y,m,k,S,null);D0(y,k)}return null}function p(y,m,k,S,w){if(typeof S=="string"&&S!==""||typeof S=="number")return y=y.get(k)||null,s(m,y,""+S,w);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case j0:return y=y.get(S.key===null?k:S.key)||null,l(m,y,S,w);case yc:return y=y.get(S.key===null?k:S.key)||null,u(m,y,S,w);case ss:var v=S._init;return p(y,m,k,v(S._payload),w)}if(Pd(S)||od(S))return y=y.get(k)||null,d(m,y,S,w,null);D0(m,S)}return null}function x(y,m,k,S){for(var w=null,v=null,M=m,N=m=0,_=null;M!==null&&N<k.length;N++){M.index>N?(_=M,M=null):_=M.sibling;var P=h(y,M,k[N],S);if(P===null){M===null&&(M=_);break}e&&M&&P.alternate===null&&t(y,M),m=i(P,m,N),v===null?w=P:v.sibling=P,v=P,M=_}if(N===k.length)return r(y,M),sn&&il(y,N),w;if(M===null){for(;N<k.length;N++)M=f(y,k[N],S),M!==null&&(m=i(M,m,N),v===null?w=M:v.sibling=M,v=M);return sn&&il(y,N),w}for(M=n(y,M);N<k.length;N++)_=p(M,y,N,k[N],S),_!==null&&(e&&_.alternate!==null&&M.delete(_.key===null?N:_.key),m=i(_,m,N),v===null?w=_:v.sibling=_,v=_);return e&&M.forEach(function(E){return t(y,E)}),sn&&il(y,N),w}function g(y,m,k,S){var w=od(k);if(typeof w!="function")throw Error(Re(150));if(k=w.call(k),k==null)throw Error(Re(151));for(var v=w=null,M=m,N=m=0,_=null,P=k.next();M!==null&&!P.done;N++,P=k.next()){M.index>N?(_=M,M=null):_=M.sibling;var E=h(y,M,P.value,S);if(E===null){M===null&&(M=_);break}e&&M&&E.alternate===null&&t(y,M),m=i(E,m,N),v===null?w=E:v.sibling=E,v=E,M=_}if(P.done)return r(y,M),sn&&il(y,N),w;if(M===null){for(;!P.done;N++,P=k.next())P=f(y,P.value,S),P!==null&&(m=i(P,m,N),v===null?w=P:v.sibling=P,v=P);return sn&&il(y,N),w}for(M=n(y,M);!P.done;N++,P=k.next())P=p(M,y,N,P.value,S),P!==null&&(e&&P.alternate!==null&&M.delete(P.key===null?N:P.key),m=i(P,m,N),v===null?w=P:v.sibling=P,v=P);return e&&M.forEach(function(R){return t(y,R)}),sn&&il(y,N),w}function b(y,m,k,S){if(typeof k=="object"&&k!==null&&k.type===bc&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case j0:e:{for(var w=k.key,v=m;v!==null;){if(v.key===w){if(w=k.type,w===bc){if(v.tag===7){r(y,v.sibling),m=a(v,k.props.children),m.return=y,y=m;break e}}else if(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===ss&&pk(w)===v.type){r(y,v.sibling),m=a(v,k.props),m.ref=dd(y,v,k),m.return=y,y=m;break e}r(y,v);break}else t(y,v);v=v.sibling}k.type===bc?(m=Ml(k.props.children,y.mode,S,k.key),m.return=y,y=m):(S=_h(k.type,k.key,k.props,null,y.mode,S),S.ref=dd(y,m,k),S.return=y,y=S)}return o(y);case yc:e:{for(v=k.key;m!==null;){if(m.key===v)if(m.tag===4&&m.stateNode.containerInfo===k.containerInfo&&m.stateNode.implementation===k.implementation){r(y,m.sibling),m=a(m,k.children||[]),m.return=y,y=m;break e}else{r(y,m);break}else t(y,m);m=m.sibling}m=px(k,y.mode,S),m.return=y,y=m}return o(y);case ss:return v=k._init,b(y,m,v(k._payload),S)}if(Pd(k))return x(y,m,k,S);if(od(k))return g(y,m,k,S);D0(y,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,m!==null&&m.tag===6?(r(y,m.sibling),m=a(m,k),m.return=y,y=m):(r(y,m),m=hx(k,y.mode,S),m.return=y,y=m),o(y)):r(y,m)}return b}var Kc=Hj(!0),Xj=Hj(!1),Hh=Bs(null),Xh=null,_c=null,wv=null;function kv(){wv=_c=Xh=null}function Sv(e){var t=Hh.current;nn(Hh),e._currentValue=t}function Wy(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Lc(e,t){Xh=e,wv=_c=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Ea=!0),e.firstContext=null)}function xi(e){var t=e._currentValue;if(wv!==e)if(e={context:e,memoizedValue:t,next:null},_c===null){if(Xh===null)throw Error(Re(308));_c=e,Xh.dependencies={lanes:0,firstContext:e}}else _c=_c.next=e;return t}var dl=null;function Mv(e){dl===null?dl=[e]:dl.push(e)}function Kj(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,Mv(t)):(r.next=a.next,a.next=r),t.interleaved=r,Do(e,n)}function Do(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var ls=!1;function jv(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Yj(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Ao(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function As(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,_r&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Do(e,r)}return a=n.interleaved,a===null?(t.next=t,Mv(n)):(t.next=a.next,a.next=t),n.interleaved=t,Do(e,r)}function wh(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,uv(e,r)}}function mk(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Kh(e,t,r,n){var a=e.updateQueue;ls=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=e.alternate;d!==null&&(d=d.updateQueue,s=d.lastBaseUpdate,s!==o&&(s===null?d.firstBaseUpdate=u:s.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=a.baseState;o=0,d=u=l=null,s=i;do{var h=s.lane,p=s.eventTime;if((n&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var x=e,g=s;switch(h=t,p=r,g.tag){case 1:if(x=g.payload,typeof x=="function"){f=x.call(p,f,h);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=g.payload,h=typeof x=="function"?x.call(p,f,h):x,h==null)break e;f=fn({},f,h);break e;case 2:ls=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,h=a.effects,h===null?a.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;h=s,s=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);if(d===null&&(l=f),a.baseState=l,a.firstBaseUpdate=u,a.lastBaseUpdate=d,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Tl|=o,e.lanes=o,e.memoizedState=f}}function gk(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Re(191,a));a.call(n)}}}var r0={},eo=Bs(r0),cf=Bs(r0),uf=Bs(r0);function fl(e){if(e===r0)throw Error(Re(174));return e}function Nv(e,t){switch(Qr(uf,t),Qr(cf,e),Qr(eo,r0),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:My(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=My(t,e)}nn(eo),Qr(eo,t)}function Yc(){nn(eo),nn(cf),nn(uf)}function qj(e){fl(uf.current);var t=fl(eo.current),r=My(t,e.type);t!==r&&(Qr(cf,e),Qr(eo,r))}function _v(e){cf.current===e&&(nn(eo),nn(cf))}var un=Bs(0);function Yh(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var sx=[];function Pv(){for(var e=0;e<sx.length;e++)sx[e]._workInProgressVersionPrimary=null;sx.length=0}var kh=Uo.ReactCurrentDispatcher,lx=Uo.ReactCurrentBatchConfig,Ol=0,dn=null,Dn=null,Vn=null,qh=!1,$d=!1,df=0,uE=0;function oa(){throw Error(Re(321))}function Cv(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Fi(e[r],t[r]))return!1;return!0}function Av(e,t,r,n,a,i){if(Ol=i,dn=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,kh.current=e===null||e.memoizedState===null?pE:mE,e=r(n,a),$d){i=0;do{if($d=!1,df=0,25<=i)throw Error(Re(301));i+=1,Vn=Dn=null,t.updateQueue=null,kh.current=gE,e=r(n,a)}while($d)}if(kh.current=Zh,t=Dn!==null&&Dn.next!==null,Ol=0,Vn=Dn=dn=null,qh=!1,t)throw Error(Re(300));return e}function Ov(){var e=df!==0;return df=0,e}function Ki(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vn===null?dn.memoizedState=Vn=e:Vn=Vn.next=e,Vn}function yi(){if(Dn===null){var e=dn.alternate;e=e!==null?e.memoizedState:null}else e=Dn.next;var t=Vn===null?dn.memoizedState:Vn.next;if(t!==null)Vn=t,Dn=e;else{if(e===null)throw Error(Re(310));Dn=e,e={memoizedState:Dn.memoizedState,baseState:Dn.baseState,baseQueue:Dn.baseQueue,queue:Dn.queue,next:null},Vn===null?dn.memoizedState=Vn=e:Vn=Vn.next=e}return Vn}function ff(e,t){return typeof t=="function"?t(e):t}function cx(e){var t=yi(),r=t.queue;if(r===null)throw Error(Re(311));r.lastRenderedReducer=e;var n=Dn,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,n=n.baseState;var s=o=null,l=null,u=i;do{var d=u.lane;if((Ol&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=f,o=n):l=l.next=f,dn.lanes|=d,Tl|=d}u=u.next}while(u!==null&&u!==i);l===null?o=n:l.next=s,Fi(n,t.memoizedState)||(Ea=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do i=a.lane,dn.lanes|=i,Tl|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function ux(e){var t=yi(),r=t.queue;if(r===null)throw Error(Re(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);Fi(i,t.memoizedState)||(Ea=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function Zj(){}function Jj(e,t){var r=dn,n=yi(),a=t(),i=!Fi(n.memoizedState,a);if(i&&(n.memoizedState=a,Ea=!0),n=n.queue,Tv(tN.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||Vn!==null&&Vn.memoizedState.tag&1){if(r.flags|=2048,hf(9,eN.bind(null,r,n,a,t),void 0,null),Hn===null)throw Error(Re(349));Ol&30||Qj(r,t,a)}return a}function Qj(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=dn.updateQueue,t===null?(t={lastEffect:null,stores:null},dn.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function eN(e,t,r,n){t.value=r,t.getSnapshot=n,rN(t)&&nN(e)}function tN(e,t,r){return r(function(){rN(t)&&nN(e)})}function rN(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Fi(e,r)}catch{return!0}}function nN(e){var t=Do(e,1);t!==null&&Li(t,e,1,-1)}function xk(e){var t=Ki();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ff,lastRenderedState:e},t.queue=e,e=e.dispatch=hE.bind(null,dn,e),[t.memoizedState,e]}function hf(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=dn.updateQueue,t===null?(t={lastEffect:null,stores:null},dn.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function aN(){return yi().memoizedState}function Sh(e,t,r,n){var a=Ki();dn.flags|=e,a.memoizedState=hf(1|t,r,void 0,n===void 0?null:n)}function km(e,t,r,n){var a=yi();n=n===void 0?null:n;var i=void 0;if(Dn!==null){var o=Dn.memoizedState;if(i=o.destroy,n!==null&&Cv(n,o.deps)){a.memoizedState=hf(t,r,i,n);return}}dn.flags|=e,a.memoizedState=hf(1|t,r,i,n)}function yk(e,t){return Sh(8390656,8,e,t)}function Tv(e,t){return km(2048,8,e,t)}function iN(e,t){return km(4,2,e,t)}function oN(e,t){return km(4,4,e,t)}function sN(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function lN(e,t,r){return r=r!=null?r.concat([e]):null,km(4,4,sN.bind(null,t,e),r)}function Ev(){}function cN(e,t){var r=yi();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Cv(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function uN(e,t){var r=yi();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&Cv(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function dN(e,t,r){return Ol&21?(Fi(r,t)||(r=gj(),dn.lanes|=r,Tl|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Ea=!0),e.memoizedState=r)}function dE(e,t){var r=Lr;Lr=r!==0&&4>r?r:4,e(!0);var n=lx.transition;lx.transition={};try{e(!1),t()}finally{Lr=r,lx.transition=n}}function fN(){return yi().memoizedState}function fE(e,t,r){var n=Ts(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},hN(e))pN(t,r);else if(r=Kj(e,t,r,n),r!==null){var a=Sa();Li(r,e,n,a),mN(r,t,n)}}function hE(e,t,r){var n=Ts(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(hN(e))pN(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,s=i(o,r);if(a.hasEagerState=!0,a.eagerState=s,Fi(s,o)){var l=t.interleaved;l===null?(a.next=a,Mv(t)):(a.next=l.next,l.next=a),t.interleaved=a;return}}catch{}finally{}r=Kj(e,t,a,n),r!==null&&(a=Sa(),Li(r,e,n,a),mN(r,t,n))}}function hN(e){var t=e.alternate;return e===dn||t!==null&&t===dn}function pN(e,t){$d=qh=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function mN(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,uv(e,r)}}var Zh={readContext:xi,useCallback:oa,useContext:oa,useEffect:oa,useImperativeHandle:oa,useInsertionEffect:oa,useLayoutEffect:oa,useMemo:oa,useReducer:oa,useRef:oa,useState:oa,useDebugValue:oa,useDeferredValue:oa,useTransition:oa,useMutableSource:oa,useSyncExternalStore:oa,useId:oa,unstable_isNewReconciler:!1},pE={readContext:xi,useCallback:function(e,t){return Ki().memoizedState=[e,t===void 0?null:t],e},useContext:xi,useEffect:yk,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,Sh(4194308,4,sN.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Sh(4194308,4,e,t)},useInsertionEffect:function(e,t){return Sh(4,2,e,t)},useMemo:function(e,t){var r=Ki();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Ki();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=fE.bind(null,dn,e),[n.memoizedState,e]},useRef:function(e){var t=Ki();return e={current:e},t.memoizedState=e},useState:xk,useDebugValue:Ev,useDeferredValue:function(e){return Ki().memoizedState=e},useTransition:function(){var e=xk(!1),t=e[0];return e=dE.bind(null,e[1]),Ki().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=dn,a=Ki();if(sn){if(r===void 0)throw Error(Re(407));r=r()}else{if(r=t(),Hn===null)throw Error(Re(349));Ol&30||Qj(n,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,yk(tN.bind(null,n,i,e),[e]),n.flags|=2048,hf(9,eN.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=Ki(),t=Hn.identifierPrefix;if(sn){var r=No,n=jo;r=(n&~(1<<32-$i(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=df++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=uE++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},mE={readContext:xi,useCallback:cN,useContext:xi,useEffect:Tv,useImperativeHandle:lN,useInsertionEffect:iN,useLayoutEffect:oN,useMemo:uN,useReducer:cx,useRef:aN,useState:function(){return cx(ff)},useDebugValue:Ev,useDeferredValue:function(e){var t=yi();return dN(t,Dn.memoizedState,e)},useTransition:function(){var e=cx(ff)[0],t=yi().memoizedState;return[e,t]},useMutableSource:Zj,useSyncExternalStore:Jj,useId:fN,unstable_isNewReconciler:!1},gE={readContext:xi,useCallback:cN,useContext:xi,useEffect:Tv,useImperativeHandle:lN,useInsertionEffect:iN,useLayoutEffect:oN,useMemo:uN,useReducer:ux,useRef:aN,useState:function(){return ux(ff)},useDebugValue:Ev,useDeferredValue:function(e){var t=yi();return Dn===null?t.memoizedState=e:dN(t,Dn.memoizedState,e)},useTransition:function(){var e=ux(ff)[0],t=yi().memoizedState;return[e,t]},useMutableSource:Zj,useSyncExternalStore:Jj,useId:fN,unstable_isNewReconciler:!1};function _i(e,t){if(e&&e.defaultProps){t=fn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Vy(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:fn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var Sm={isMounted:function(e){return(e=e._reactInternals)?Yl(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Sa(),a=Ts(e),i=Ao(n,a);i.payload=t,r!=null&&(i.callback=r),t=As(e,i,a),t!==null&&(Li(t,e,a,n),wh(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Sa(),a=Ts(e),i=Ao(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=As(e,i,a),t!==null&&(Li(t,e,a,n),wh(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Sa(),n=Ts(e),a=Ao(r,n);a.tag=2,t!=null&&(a.callback=t),t=As(e,a,n),t!==null&&(Li(t,e,n,r),wh(t,e,n))}};function bk(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!af(r,n)||!af(a,i):!0}function gN(e,t,r){var n=!1,a=Ls,i=t.contextType;return typeof i=="object"&&i!==null?i=xi(i):(a=$a(t)?Cl:fa.current,n=t.contextTypes,i=(n=n!=null)?Hc(e,a):Ls),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Sm,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function vk(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&Sm.enqueueReplaceState(t,t.state,null)}function Hy(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},jv(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=xi(i):(i=$a(t)?Cl:fa.current,a.context=Hc(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Vy(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&Sm.enqueueReplaceState(a,a.state,null),Kh(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function qc(e,t){try{var r="",n=t;do r+=W6(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function dx(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Xy(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var xE=typeof WeakMap=="function"?WeakMap:Map;function xN(e,t,r){r=Ao(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Qh||(Qh=!0,n1=n),Xy(e,t)},r}function yN(e,t,r){r=Ao(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){Xy(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Xy(e,t),typeof n!="function"&&(Os===null?Os=new Set([this]):Os.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function wk(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new xE;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=OE.bind(null,e,t,r),t.then(e,e))}function kk(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Sk(e,t,r,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Ao(-1,1),t.tag=2,As(r,t,1))),r.lanes|=1),e)}var yE=Uo.ReactCurrentOwner,Ea=!1;function ya(e,t,r,n){t.child=e===null?Xj(t,null,r,n):Kc(t,e.child,r,n)}function Mk(e,t,r,n,a){r=r.render;var i=t.ref;return Lc(t,a),n=Av(e,t,r,n,i,a),r=Ov(),e!==null&&!Ea?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,$o(e,t,a)):(sn&&r&&yv(t),t.flags|=1,ya(e,t,n,a),t.child)}function jk(e,t,r,n,a){if(e===null){var i=r.type;return typeof i=="function"&&!Gv(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,bN(e,t,i,n,a)):(e=_h(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:af,r(o,n)&&e.ref===t.ref)return $o(e,t,a)}return t.flags|=1,e=Es(i,n),e.ref=t.ref,e.return=t,t.child=e}function bN(e,t,r,n,a){if(e!==null){var i=e.memoizedProps;if(af(i,n)&&e.ref===t.ref)if(Ea=!1,t.pendingProps=n=i,(e.lanes&a)!==0)e.flags&131072&&(Ea=!0);else return t.lanes=e.lanes,$o(e,t,a)}return Ky(e,t,r,n,a)}function vN(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qr(Cc,Xa),Xa|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Qr(Cc,Xa),Xa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Qr(Cc,Xa),Xa|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Qr(Cc,Xa),Xa|=n;return ya(e,t,a,r),t.child}function wN(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Ky(e,t,r,n,a){var i=$a(r)?Cl:fa.current;return i=Hc(t,i),Lc(t,a),r=Av(e,t,r,n,i,a),n=Ov(),e!==null&&!Ea?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,$o(e,t,a)):(sn&&n&&yv(t),t.flags|=1,ya(e,t,r,a),t.child)}function Nk(e,t,r,n,a){if($a(r)){var i=!0;zh(t)}else i=!1;if(Lc(t,a),t.stateNode===null)Mh(e,t),gN(t,r,n),Hy(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=r.contextType;typeof u=="object"&&u!==null?u=xi(u):(u=$a(r)?Cl:fa.current,u=Hc(t,u));var d=r.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||l!==u)&&vk(t,o,n,u),ls=!1;var h=t.memoizedState;o.state=h,Kh(t,n,o,a),l=t.memoizedState,s!==n||h!==l||Da.current||ls?(typeof d=="function"&&(Vy(t,r,d,n),l=t.memoizedState),(s=ls||bk(t,r,s,n,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=u,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,Yj(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:_i(t.type,s),o.props=u,f=t.pendingProps,h=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=xi(l):(l=$a(r)?Cl:fa.current,l=Hc(t,l));var p=r.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||h!==l)&&vk(t,o,n,l),ls=!1,h=t.memoizedState,o.state=h,Kh(t,n,o,a);var x=t.memoizedState;s!==f||h!==x||Da.current||ls?(typeof p=="function"&&(Vy(t,r,p,n),x=t.memoizedState),(u=ls||bk(t,r,u,n,h,x,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,x,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,x,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=x),o.props=n,o.state=x,o.context=l,n=u):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Yy(e,t,r,n,i,a)}function Yy(e,t,r,n,a,i){wN(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return a&&dk(t,r,!1),$o(e,t,i);n=t.stateNode,yE.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Kc(t,e.child,null,i),t.child=Kc(t,null,s,i)):ya(e,t,s,i),t.memoizedState=n.state,a&&dk(t,r,!0),t.child}function kN(e){var t=e.stateNode;t.pendingContext?uk(e,t.pendingContext,t.pendingContext!==t.context):t.context&&uk(e,t.context,!1),Nv(e,t.containerInfo)}function _k(e,t,r,n,a){return Xc(),vv(a),t.flags|=256,ya(e,t,r,n),t.child}var qy={dehydrated:null,treeContext:null,retryLane:0};function Zy(e){return{baseLanes:e,cachePool:null,transitions:null}}function SN(e,t,r){var n=t.pendingProps,a=un.current,i=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Qr(un,a&1),e===null)return zy(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,i?(n=t.mode,i=t.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=Nm(o,n,0,null),e=Ml(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Zy(r),t.memoizedState=qy,e):Iv(t,o));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return bE(e,t,o,n,s,a,r);if(i){i=n.fallback,o=t.mode,a=e.child,s=a.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=Es(a,l),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?i=Es(s,i):(i=Ml(i,o,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,o=e.child.memoizedState,o=o===null?Zy(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~r,t.memoizedState=qy,n}return i=e.child,e=i.sibling,n=Es(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function Iv(e,t){return t=Nm({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function $0(e,t,r,n){return n!==null&&vv(n),Kc(t,e.child,null,r),e=Iv(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function bE(e,t,r,n,a,i,o){if(r)return t.flags&256?(t.flags&=-257,n=dx(Error(Re(422))),$0(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,a=t.mode,n=Nm({mode:"visible",children:n.children},a,0,null),i=Ml(i,a,o,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&Kc(t,e.child,null,o),t.child.memoizedState=Zy(o),t.memoizedState=qy,i);if(!(t.mode&1))return $0(e,t,o,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Re(419)),n=dx(i,n,void 0),$0(e,t,o,n)}if(s=(o&e.childLanes)!==0,Ea||s){if(n=Hn,n!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Do(e,a),Li(n,e,a,-1))}return Bv(),n=dx(Error(Re(421))),$0(e,t,o,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=TE.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Ja=Cs(a.nextSibling),Qa=t,sn=!0,Ti=null,e!==null&&(ui[di++]=jo,ui[di++]=No,ui[di++]=Al,jo=e.id,No=e.overflow,Al=t),t=Iv(t,n.children),t.flags|=4096,t)}function Pk(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Wy(e.return,t,r)}function fx(e,t,r,n,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=a)}function MN(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(ya(e,t,n.children,r),n=un.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Pk(e,r,t);else if(e.tag===19)Pk(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Qr(un,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&Yh(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),fx(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&Yh(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}fx(t,!0,r,null,i);break;case"together":fx(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Mh(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function $o(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Tl|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Re(153));if(t.child!==null){for(e=t.child,r=Es(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Es(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function vE(e,t,r){switch(t.tag){case 3:kN(t),Xc();break;case 5:qj(t);break;case 1:$a(t.type)&&zh(t);break;case 4:Nv(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Qr(Hh,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Qr(un,un.current&1),t.flags|=128,null):r&t.child.childLanes?SN(e,t,r):(Qr(un,un.current&1),e=$o(e,t,r),e!==null?e.sibling:null);Qr(un,un.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return MN(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Qr(un,un.current),n)break;return null;case 22:case 23:return t.lanes=0,vN(e,t,r)}return $o(e,t,r)}var jN,Jy,NN,_N;jN=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Jy=function(){};NN=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,fl(eo.current);var i=null;switch(r){case"input":a=vy(e,a),n=vy(e,n),i=[];break;case"select":a=fn({},a,{value:void 0}),n=fn({},n,{value:void 0}),i=[];break;case"textarea":a=Sy(e,a),n=Sy(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Gh)}jy(r,n);var o;r=null;for(u in a)if(!n.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var s=a[u];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Zd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(s=a!=null?a[u]:void 0,n.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(i||(i=[]),i.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Zd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&en("scroll",e),i||s===l||(i=[])):(i=i||[]).push(u,l))}r&&(i=i||[]).push("style",r);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};_N=function(e,t,r,n){r!==n&&(t.flags|=4)};function fd(e,t){if(!sn)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function sa(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function wE(e,t,r){var n=t.pendingProps;switch(bv(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return sa(t),null;case 1:return $a(t.type)&&Uh(),sa(t),null;case 3:return n=t.stateNode,Yc(),nn(Da),nn(fa),Pv(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(R0(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ti!==null&&(o1(Ti),Ti=null))),Jy(e,t),sa(t),null;case 5:_v(t);var a=fl(uf.current);if(r=t.type,e!==null&&t.stateNode!=null)NN(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Re(166));return sa(t),null}if(e=fl(eo.current),R0(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Yi]=t,n[lf]=i,e=(t.mode&1)!==0,r){case"dialog":en("cancel",n),en("close",n);break;case"iframe":case"object":case"embed":en("load",n);break;case"video":case"audio":for(a=0;a<Ad.length;a++)en(Ad[a],n);break;case"source":en("error",n);break;case"img":case"image":case"link":en("error",n),en("load",n);break;case"details":en("toggle",n);break;case"input":$w(n,i),en("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},en("invalid",n);break;case"textarea":Fw(n,i),en("invalid",n)}jy(r,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];o==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&I0(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&I0(n.textContent,s,e),a=["children",""+s]):Zd.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&en("scroll",n)}switch(r){case"input":N0(n),Lw(n,i,!0);break;case"textarea":N0(n),Bw(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Gh)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=tj(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Yi]=t,e[lf]=n,jN(e,t,!1,!1),t.stateNode=e;e:{switch(o=Ny(r,n),r){case"dialog":en("cancel",e),en("close",e),a=n;break;case"iframe":case"object":case"embed":en("load",e),a=n;break;case"video":case"audio":for(a=0;a<Ad.length;a++)en(Ad[a],e);a=n;break;case"source":en("error",e),a=n;break;case"img":case"image":case"link":en("error",e),en("load",e),a=n;break;case"details":en("toggle",e),a=n;break;case"input":$w(e,n),a=vy(e,n),en("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=fn({},n,{value:void 0}),en("invalid",e);break;case"textarea":Fw(e,n),a=Sy(e,n),en("invalid",e);break;default:a=n}jy(r,a),s=a;for(i in s)if(s.hasOwnProperty(i)){var l=s[i];i==="style"?aj(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&rj(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&Jd(e,l):typeof l=="number"&&Jd(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(Zd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&en("scroll",e):l!=null&&av(e,i,l,o))}switch(r){case"input":N0(e),Lw(e,n,!1);break;case"textarea":N0(e),Bw(e);break;case"option":n.value!=null&&e.setAttribute("value",""+$s(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Ic(e,!!n.multiple,i,!1):n.defaultValue!=null&&Ic(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Gh)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return sa(t),null;case 6:if(e&&t.stateNode!=null)_N(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Re(166));if(r=fl(uf.current),fl(eo.current),R0(t)){if(n=t.stateNode,r=t.memoizedProps,n[Yi]=t,(i=n.nodeValue!==r)&&(e=Qa,e!==null))switch(e.tag){case 3:I0(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&I0(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Yi]=t,t.stateNode=n}return sa(t),null;case 13:if(nn(un),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(sn&&Ja!==null&&t.mode&1&&!(t.flags&128))Vj(),Xc(),t.flags|=98560,i=!1;else if(i=R0(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Re(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Re(317));i[Yi]=t}else Xc(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;sa(t),i=!1}else Ti!==null&&(o1(Ti),Ti=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||un.current&1?Fn===0&&(Fn=3):Bv())),t.updateQueue!==null&&(t.flags|=4),sa(t),null);case 4:return Yc(),Jy(e,t),e===null&&of(t.stateNode.containerInfo),sa(t),null;case 10:return Sv(t.type._context),sa(t),null;case 17:return $a(t.type)&&Uh(),sa(t),null;case 19:if(nn(un),i=t.memoizedState,i===null)return sa(t),null;if(n=(t.flags&128)!==0,o=i.rendering,o===null)if(n)fd(i,!1);else{if(Fn!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=Yh(e),o!==null){for(t.flags|=128,fd(i,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Qr(un,un.current&1|2),t.child}e=e.sibling}i.tail!==null&&vn()>Zc&&(t.flags|=128,n=!0,fd(i,!1),t.lanes=4194304)}else{if(!n)if(e=Yh(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),fd(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!sn)return sa(t),null}else 2*vn()-i.renderingStartTime>Zc&&r!==1073741824&&(t.flags|=128,n=!0,fd(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(r=i.last,r!==null?r.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=vn(),t.sibling=null,r=un.current,Qr(un,n?r&1|2:r&1),t):(sa(t),null);case 22:case 23:return Fv(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Xa&1073741824&&(sa(t),t.subtreeFlags&6&&(t.flags|=8192)):sa(t),null;case 24:return null;case 25:return null}throw Error(Re(156,t.tag))}function kE(e,t){switch(bv(t),t.tag){case 1:return $a(t.type)&&Uh(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Yc(),nn(Da),nn(fa),Pv(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return _v(t),null;case 13:if(nn(un),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Re(340));Xc()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return nn(un),null;case 4:return Yc(),null;case 10:return Sv(t.type._context),null;case 22:case 23:return Fv(),null;case 24:return null;default:return null}}var L0=!1,ca=!1,SE=typeof WeakSet=="function"?WeakSet:Set,lt=null;function Pc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){xn(e,t,n)}else r.current=null}function Qy(e,t,r){try{r()}catch(n){xn(e,t,n)}}var Ck=!1;function ME(e,t){if(Dy=Lh,e=Tj(),xv(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,s=-1,l=-1,u=0,d=0,f=e,h=null;t:for(;;){for(var p;f!==r||a!==0&&f.nodeType!==3||(s=o+a),f!==i||n!==0&&f.nodeType!==3||(l=o+n),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===e)break t;if(h===r&&++u===a&&(s=o),h===i&&++d===n&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}r=s===-1||l===-1?null:{start:s,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for($y={focusedElem:e,selectionRange:r},Lh=!1,lt=t;lt!==null;)if(t=lt,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,lt=e;else for(;lt!==null;){t=lt;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var g=x.memoizedProps,b=x.memoizedState,y=t.stateNode,m=y.getSnapshotBeforeUpdate(t.elementType===t.type?g:_i(t.type,g),b);y.__reactInternalSnapshotBeforeUpdate=m}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Re(163))}}catch(S){xn(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,lt=e;break}lt=t.return}return x=Ck,Ck=!1,x}function Ld(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&Qy(t,r,i)}a=a.next}while(a!==n)}}function Mm(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function e1(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function PN(e){var t=e.alternate;t!==null&&(e.alternate=null,PN(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Yi],delete t[lf],delete t[By],delete t[oE],delete t[sE])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function CN(e){return e.tag===5||e.tag===3||e.tag===4}function Ak(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||CN(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function t1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Gh));else if(n!==4&&(e=e.child,e!==null))for(t1(e,t,r),e=e.sibling;e!==null;)t1(e,t,r),e=e.sibling}function r1(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(r1(e,t,r),e=e.sibling;e!==null;)r1(e,t,r),e=e.sibling}var Zn=null,Ci=!1;function es(e,t,r){for(r=r.child;r!==null;)AN(e,t,r),r=r.sibling}function AN(e,t,r){if(Qi&&typeof Qi.onCommitFiberUnmount=="function")try{Qi.onCommitFiberUnmount(gm,r)}catch{}switch(r.tag){case 5:ca||Pc(r,t);case 6:var n=Zn,a=Ci;Zn=null,es(e,t,r),Zn=n,Ci=a,Zn!==null&&(Ci?(e=Zn,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Zn.removeChild(r.stateNode));break;case 18:Zn!==null&&(Ci?(e=Zn,r=r.stateNode,e.nodeType===8?ix(e.parentNode,r):e.nodeType===1&&ix(e,r),rf(e)):ix(Zn,r.stateNode));break;case 4:n=Zn,a=Ci,Zn=r.stateNode.containerInfo,Ci=!0,es(e,t,r),Zn=n,Ci=a;break;case 0:case 11:case 14:case 15:if(!ca&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&Qy(r,t,o),a=a.next}while(a!==n)}es(e,t,r);break;case 1:if(!ca&&(Pc(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){xn(r,t,s)}es(e,t,r);break;case 21:es(e,t,r);break;case 22:r.mode&1?(ca=(n=ca)||r.memoizedState!==null,es(e,t,r),ca=n):es(e,t,r);break;default:es(e,t,r)}}function Ok(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new SE),t.forEach(function(n){var a=EE.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function Mi(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var i=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:Zn=s.stateNode,Ci=!1;break e;case 3:Zn=s.stateNode.containerInfo,Ci=!0;break e;case 4:Zn=s.stateNode.containerInfo,Ci=!0;break e}s=s.return}if(Zn===null)throw Error(Re(160));AN(i,o,a),Zn=null,Ci=!1;var l=a.alternate;l!==null&&(l.return=null),a.return=null}catch(u){xn(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)ON(t,e),t=t.sibling}function ON(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Mi(t,e),Xi(e),n&4){try{Ld(3,e,e.return),Mm(3,e)}catch(g){xn(e,e.return,g)}try{Ld(5,e,e.return)}catch(g){xn(e,e.return,g)}}break;case 1:Mi(t,e),Xi(e),n&512&&r!==null&&Pc(r,r.return);break;case 5:if(Mi(t,e),Xi(e),n&512&&r!==null&&Pc(r,r.return),e.flags&32){var a=e.stateNode;try{Jd(a,"")}catch(g){xn(e,e.return,g)}}if(n&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=r!==null?r.memoizedProps:i,s=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&Q4(a,i),Ny(s,o);var u=Ny(s,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?aj(a,f):d==="dangerouslySetInnerHTML"?rj(a,f):d==="children"?Jd(a,f):av(a,d,f,u)}switch(s){case"input":wy(a,i);break;case"textarea":ej(a,i);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Ic(a,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Ic(a,!!i.multiple,i.defaultValue,!0):Ic(a,!!i.multiple,i.multiple?[]:"",!1))}a[lf]=i}catch(g){xn(e,e.return,g)}}break;case 6:if(Mi(t,e),Xi(e),n&4){if(e.stateNode===null)throw Error(Re(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(g){xn(e,e.return,g)}}break;case 3:if(Mi(t,e),Xi(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{rf(t.containerInfo)}catch(g){xn(e,e.return,g)}break;case 4:Mi(t,e),Xi(e);break;case 13:Mi(t,e),Xi(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||($v=vn())),n&4&&Ok(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(ca=(u=ca)||d,Mi(t,e),ca=u):Mi(t,e),Xi(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(lt=e,d=e.child;d!==null;){for(f=lt=d;lt!==null;){switch(h=lt,p=h.child,h.tag){case 0:case 11:case 14:case 15:Ld(4,h,h.return);break;case 1:Pc(h,h.return);var x=h.stateNode;if(typeof x.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(g){xn(n,r,g)}}break;case 5:Pc(h,h.return);break;case 22:if(h.memoizedState!==null){Ek(f);continue}}p!==null?(p.return=h,lt=p):Ek(f)}d=d.sibling}e:for(d=null,f=e;;){if(f.tag===5){if(d===null){d=f;try{a=f.stateNode,u?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=nj("display",o))}catch(g){xn(e,e.return,g)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(g){xn(e,e.return,g)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:Mi(t,e),Xi(e),n&4&&Ok(e);break;case 21:break;default:Mi(t,e),Xi(e)}}function Xi(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(CN(r)){var n=r;break e}r=r.return}throw Error(Re(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Jd(a,""),n.flags&=-33);var i=Ak(e);r1(e,i,a);break;case 3:case 4:var o=n.stateNode.containerInfo,s=Ak(e);t1(e,s,o);break;default:throw Error(Re(161))}}catch(l){xn(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function jE(e,t,r){lt=e,TN(e)}function TN(e,t,r){for(var n=(e.mode&1)!==0;lt!==null;){var a=lt,i=a.child;if(a.tag===22&&n){var o=a.memoizedState!==null||L0;if(!o){var s=a.alternate,l=s!==null&&s.memoizedState!==null||ca;s=L0;var u=ca;if(L0=o,(ca=l)&&!u)for(lt=a;lt!==null;)o=lt,l=o.child,o.tag===22&&o.memoizedState!==null?Ik(a):l!==null?(l.return=o,lt=l):Ik(a);for(;i!==null;)lt=i,TN(i),i=i.sibling;lt=a,L0=s,ca=u}Tk(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,lt=i):Tk(e)}}function Tk(e){for(;lt!==null;){var t=lt;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:ca||Mm(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!ca)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:_i(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&gk(t,i,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}gk(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&rf(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Re(163))}ca||t.flags&512&&e1(t)}catch(h){xn(t,t.return,h)}}if(t===e){lt=null;break}if(r=t.sibling,r!==null){r.return=t.return,lt=r;break}lt=t.return}}function Ek(e){for(;lt!==null;){var t=lt;if(t===e){lt=null;break}var r=t.sibling;if(r!==null){r.return=t.return,lt=r;break}lt=t.return}}function Ik(e){for(;lt!==null;){var t=lt;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{Mm(4,t)}catch(l){xn(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(l){xn(t,a,l)}}var i=t.return;try{e1(t)}catch(l){xn(t,i,l)}break;case 5:var o=t.return;try{e1(t)}catch(l){xn(t,o,l)}}}catch(l){xn(t,t.return,l)}if(t===e){lt=null;break}var s=t.sibling;if(s!==null){s.return=t.return,lt=s;break}lt=t.return}}var NE=Math.ceil,Jh=Uo.ReactCurrentDispatcher,Rv=Uo.ReactCurrentOwner,mi=Uo.ReactCurrentBatchConfig,_r=0,Hn=null,An=null,ea=0,Xa=0,Cc=Bs(0),Fn=0,pf=null,Tl=0,jm=0,Dv=0,Fd=null,Oa=null,$v=0,Zc=1/0,So=null,Qh=!1,n1=null,Os=null,F0=!1,ms=null,ep=0,Bd=0,a1=null,jh=-1,Nh=0;function Sa(){return _r&6?vn():jh!==-1?jh:jh=vn()}function Ts(e){return e.mode&1?_r&2&&ea!==0?ea&-ea:cE.transition!==null?(Nh===0&&(Nh=gj()),Nh):(e=Lr,e!==0||(e=window.event,e=e===void 0?16:Sj(e.type)),e):1}function Li(e,t,r,n){if(50<Bd)throw Bd=0,a1=null,Error(Re(185));Qf(e,r,n),(!(_r&2)||e!==Hn)&&(e===Hn&&(!(_r&2)&&(jm|=r),Fn===4&&fs(e,ea)),La(e,n),r===1&&_r===0&&!(t.mode&1)&&(Zc=vn()+500,wm&&Gs()))}function La(e,t){var r=e.callbackNode;cT(e,t);var n=$h(e,e===Hn?ea:0);if(n===0)r!==null&&zw(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&zw(r),t===1)e.tag===0?lE(Rk.bind(null,e)):Uj(Rk.bind(null,e)),aE(function(){!(_r&6)&&Gs()}),r=null;else{switch(xj(n)){case 1:r=cv;break;case 4:r=pj;break;case 16:r=Dh;break;case 536870912:r=mj;break;default:r=Dh}r=BN(r,EN.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function EN(e,t){if(jh=-1,Nh=0,_r&6)throw Error(Re(327));var r=e.callbackNode;if(Fc()&&e.callbackNode!==r)return null;var n=$h(e,e===Hn?ea:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=tp(e,n);else{t=n;var a=_r;_r|=2;var i=RN();(Hn!==e||ea!==t)&&(So=null,Zc=vn()+500,Sl(e,t));do try{CE();break}catch(s){IN(e,s)}while(!0);kv(),Jh.current=i,_r=a,An!==null?t=0:(Hn=null,ea=0,t=Fn)}if(t!==0){if(t===2&&(a=Oy(e),a!==0&&(n=a,t=i1(e,a))),t===1)throw r=pf,Sl(e,0),fs(e,n),La(e,vn()),r;if(t===6)fs(e,n);else{if(a=e.current.alternate,!(n&30)&&!_E(a)&&(t=tp(e,n),t===2&&(i=Oy(e),i!==0&&(n=i,t=i1(e,i))),t===1))throw r=pf,Sl(e,0),fs(e,n),La(e,vn()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(Re(345));case 2:ol(e,Oa,So);break;case 3:if(fs(e,n),(n&130023424)===n&&(t=$v+500-vn(),10<t)){if($h(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){Sa(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Fy(ol.bind(null,e,Oa,So),t);break}ol(e,Oa,So);break;case 4:if(fs(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var o=31-$i(n);i=1<<o,o=t[o],o>a&&(a=o),n&=~i}if(n=a,n=vn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*NE(n/1960))-n,10<n){e.timeoutHandle=Fy(ol.bind(null,e,Oa,So),n);break}ol(e,Oa,So);break;case 5:ol(e,Oa,So);break;default:throw Error(Re(329))}}}return La(e,vn()),e.callbackNode===r?EN.bind(null,e):null}function i1(e,t){var r=Fd;return e.current.memoizedState.isDehydrated&&(Sl(e,t).flags|=256),e=tp(e,t),e!==2&&(t=Oa,Oa=r,t!==null&&o1(t)),e}function o1(e){Oa===null?Oa=e:Oa.push.apply(Oa,e)}function _E(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],i=a.getSnapshot;a=a.value;try{if(!Fi(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function fs(e,t){for(t&=~Dv,t&=~jm,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-$i(t),n=1<<r;e[r]=-1,t&=~n}}function Rk(e){if(_r&6)throw Error(Re(327));Fc();var t=$h(e,0);if(!(t&1))return La(e,vn()),null;var r=tp(e,t);if(e.tag!==0&&r===2){var n=Oy(e);n!==0&&(t=n,r=i1(e,n))}if(r===1)throw r=pf,Sl(e,0),fs(e,t),La(e,vn()),r;if(r===6)throw Error(Re(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,ol(e,Oa,So),La(e,vn()),null}function Lv(e,t){var r=_r;_r|=1;try{return e(t)}finally{_r=r,_r===0&&(Zc=vn()+500,wm&&Gs())}}function El(e){ms!==null&&ms.tag===0&&!(_r&6)&&Fc();var t=_r;_r|=1;var r=mi.transition,n=Lr;try{if(mi.transition=null,Lr=1,e)return e()}finally{Lr=n,mi.transition=r,_r=t,!(_r&6)&&Gs()}}function Fv(){Xa=Cc.current,nn(Cc)}function Sl(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,nE(r)),An!==null)for(r=An.return;r!==null;){var n=r;switch(bv(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Uh();break;case 3:Yc(),nn(Da),nn(fa),Pv();break;case 5:_v(n);break;case 4:Yc();break;case 13:nn(un);break;case 19:nn(un);break;case 10:Sv(n.type._context);break;case 22:case 23:Fv()}r=r.return}if(Hn=e,An=e=Es(e.current,null),ea=Xa=t,Fn=0,pf=null,Dv=jm=Tl=0,Oa=Fd=null,dl!==null){for(t=0;t<dl.length;t++)if(r=dl[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,i=r.pending;if(i!==null){var o=i.next;i.next=a,n.next=o}r.pending=n}dl=null}return e}function IN(e,t){do{var r=An;try{if(kv(),kh.current=Zh,qh){for(var n=dn.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}qh=!1}if(Ol=0,Vn=Dn=dn=null,$d=!1,df=0,Rv.current=null,r===null||r.return===null){Fn=1,pf=t,An=null;break}e:{var i=e,o=r.return,s=r,l=t;if(t=ea,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=s,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=kk(o);if(p!==null){p.flags&=-257,Sk(p,o,s,i,t),p.mode&1&&wk(i,u,t),t=p,l=u;var x=t.updateQueue;if(x===null){var g=new Set;g.add(l),t.updateQueue=g}else x.add(l);break e}else{if(!(t&1)){wk(i,u,t),Bv();break e}l=Error(Re(426))}}else if(sn&&s.mode&1){var b=kk(o);if(b!==null){!(b.flags&65536)&&(b.flags|=256),Sk(b,o,s,i,t),vv(qc(l,s));break e}}i=l=qc(l,s),Fn!==4&&(Fn=2),Fd===null?Fd=[i]:Fd.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var y=xN(i,l,t);mk(i,y);break e;case 1:s=l;var m=i.type,k=i.stateNode;if(!(i.flags&128)&&(typeof m.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Os===null||!Os.has(k)))){i.flags|=65536,t&=-t,i.lanes|=t;var S=yN(i,s,t);mk(i,S);break e}}i=i.return}while(i!==null)}$N(r)}catch(w){t=w,An===r&&r!==null&&(An=r=r.return);continue}break}while(!0)}function RN(){var e=Jh.current;return Jh.current=Zh,e===null?Zh:e}function Bv(){(Fn===0||Fn===3||Fn===2)&&(Fn=4),Hn===null||!(Tl&268435455)&&!(jm&268435455)||fs(Hn,ea)}function tp(e,t){var r=_r;_r|=2;var n=RN();(Hn!==e||ea!==t)&&(So=null,Sl(e,t));do try{PE();break}catch(a){IN(e,a)}while(!0);if(kv(),_r=r,Jh.current=n,An!==null)throw Error(Re(261));return Hn=null,ea=0,Fn}function PE(){for(;An!==null;)DN(An)}function CE(){for(;An!==null&&!eT();)DN(An)}function DN(e){var t=FN(e.alternate,e,Xa);e.memoizedProps=e.pendingProps,t===null?$N(e):An=t,Rv.current=null}function $N(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=kE(r,t),r!==null){r.flags&=32767,An=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{Fn=6,An=null;return}}else if(r=wE(r,t,Xa),r!==null){An=r;return}if(t=t.sibling,t!==null){An=t;return}An=t=e}while(t!==null);Fn===0&&(Fn=5)}function ol(e,t,r){var n=Lr,a=mi.transition;try{mi.transition=null,Lr=1,AE(e,t,r,n)}finally{mi.transition=a,Lr=n}return null}function AE(e,t,r,n){do Fc();while(ms!==null);if(_r&6)throw Error(Re(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Re(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(uT(e,i),e===Hn&&(An=Hn=null,ea=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||F0||(F0=!0,BN(Dh,function(){return Fc(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=mi.transition,mi.transition=null;var o=Lr;Lr=1;var s=_r;_r|=4,Rv.current=null,ME(e,r),ON(r,e),qT($y),Lh=!!Dy,$y=Dy=null,e.current=r,jE(r),tT(),_r=s,Lr=o,mi.transition=i}else e.current=r;if(F0&&(F0=!1,ms=e,ep=a),i=e.pendingLanes,i===0&&(Os=null),aT(r.stateNode),La(e,vn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(Qh)throw Qh=!1,e=n1,n1=null,e;return ep&1&&e.tag!==0&&Fc(),i=e.pendingLanes,i&1?e===a1?Bd++:(Bd=0,a1=e):Bd=0,Gs(),null}function Fc(){if(ms!==null){var e=xj(ep),t=mi.transition,r=Lr;try{if(mi.transition=null,Lr=16>e?16:e,ms===null)var n=!1;else{if(e=ms,ms=null,ep=0,_r&6)throw Error(Re(331));var a=_r;for(_r|=4,lt=e.current;lt!==null;){var i=lt,o=i.child;if(lt.flags&16){var s=i.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(lt=u;lt!==null;){var d=lt;switch(d.tag){case 0:case 11:case 15:Ld(8,d,i)}var f=d.child;if(f!==null)f.return=d,lt=f;else for(;lt!==null;){d=lt;var h=d.sibling,p=d.return;if(PN(d),d===u){lt=null;break}if(h!==null){h.return=p,lt=h;break}lt=p}}}var x=i.alternate;if(x!==null){var g=x.child;if(g!==null){x.child=null;do{var b=g.sibling;g.sibling=null,g=b}while(g!==null)}}lt=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,lt=o;else e:for(;lt!==null;){if(i=lt,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ld(9,i,i.return)}var y=i.sibling;if(y!==null){y.return=i.return,lt=y;break e}lt=i.return}}var m=e.current;for(lt=m;lt!==null;){o=lt;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,lt=k;else e:for(o=m;lt!==null;){if(s=lt,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:Mm(9,s)}}catch(w){xn(s,s.return,w)}if(s===o){lt=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,lt=S;break e}lt=s.return}}if(_r=a,Gs(),Qi&&typeof Qi.onPostCommitFiberRoot=="function")try{Qi.onPostCommitFiberRoot(gm,e)}catch{}n=!0}return n}finally{Lr=r,mi.transition=t}}return!1}function Dk(e,t,r){t=qc(r,t),t=xN(e,t,1),e=As(e,t,1),t=Sa(),e!==null&&(Qf(e,1,t),La(e,t))}function xn(e,t,r){if(e.tag===3)Dk(e,e,r);else for(;t!==null;){if(t.tag===3){Dk(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Os===null||!Os.has(n))){e=qc(r,e),e=yN(t,e,1),t=As(t,e,1),e=Sa(),t!==null&&(Qf(t,1,e),La(t,e));break}}t=t.return}}function OE(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=Sa(),e.pingedLanes|=e.suspendedLanes&r,Hn===e&&(ea&r)===r&&(Fn===4||Fn===3&&(ea&130023424)===ea&&500>vn()-$v?Sl(e,0):Dv|=r),La(e,t)}function LN(e,t){t===0&&(e.mode&1?(t=C0,C0<<=1,!(C0&130023424)&&(C0=4194304)):t=1);var r=Sa();e=Do(e,t),e!==null&&(Qf(e,t,r),La(e,r))}function TE(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),LN(e,r)}function EE(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Re(314))}n!==null&&n.delete(t),LN(e,r)}var FN;FN=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Da.current)Ea=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Ea=!1,vE(e,t,r);Ea=!!(e.flags&131072)}else Ea=!1,sn&&t.flags&1048576&&zj(t,Vh,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Mh(e,t),e=t.pendingProps;var a=Hc(t,fa.current);Lc(t,r),a=Av(null,t,n,e,a,r);var i=Ov();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,$a(n)?(i=!0,zh(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,jv(t),a.updater=Sm,t.stateNode=a,a._reactInternals=t,Hy(t,n,e,r),t=Yy(null,t,n,!0,i,r)):(t.tag=0,sn&&i&&yv(t),ya(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Mh(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=RE(n),e=_i(n,e),a){case 0:t=Ky(null,t,n,e,r);break e;case 1:t=Nk(null,t,n,e,r);break e;case 11:t=Mk(null,t,n,e,r);break e;case 14:t=jk(null,t,n,_i(n.type,e),r);break e}throw Error(Re(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_i(n,a),Ky(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_i(n,a),Nk(e,t,n,a,r);case 3:e:{if(kN(t),e===null)throw Error(Re(387));n=t.pendingProps,i=t.memoizedState,a=i.element,Yj(e,t),Kh(t,n,null,r);var o=t.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=qc(Error(Re(423)),t),t=_k(e,t,n,r,a);break e}else if(n!==a){a=qc(Error(Re(424)),t),t=_k(e,t,n,r,a);break e}else for(Ja=Cs(t.stateNode.containerInfo.firstChild),Qa=t,sn=!0,Ti=null,r=Xj(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Xc(),n===a){t=$o(e,t,r);break e}ya(e,t,n,r)}t=t.child}return t;case 5:return qj(t),e===null&&zy(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,Ly(n,a)?o=null:i!==null&&Ly(n,i)&&(t.flags|=32),wN(e,t),ya(e,t,o,r),t.child;case 6:return e===null&&zy(t),null;case 13:return SN(e,t,r);case 4:return Nv(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Kc(t,null,n,r):ya(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_i(n,a),Mk(e,t,n,a,r);case 7:return ya(e,t,t.pendingProps,r),t.child;case 8:return ya(e,t,t.pendingProps.children,r),t.child;case 12:return ya(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Qr(Hh,n._currentValue),n._currentValue=o,i!==null)if(Fi(i.value,o)){if(i.children===a.children&&!Da.current){t=$o(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){o=i.child;for(var l=s.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Ao(-1,r&-r),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),Wy(i.return,r,t),s.lanes|=r;break}l=l.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Re(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),Wy(o,r,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ya(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Lc(t,r),a=xi(a),n=n(a),t.flags|=1,ya(e,t,n,r),t.child;case 14:return n=t.type,a=_i(n,t.pendingProps),a=_i(n.type,a),jk(e,t,n,a,r);case 15:return bN(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:_i(n,a),Mh(e,t),t.tag=1,$a(n)?(e=!0,zh(t)):e=!1,Lc(t,r),gN(t,n,a),Hy(t,n,a,r),Yy(null,t,n,!0,e,r);case 19:return MN(e,t,r);case 22:return vN(e,t,r)}throw Error(Re(156,t.tag))};function BN(e,t){return hj(e,t)}function IE(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function fi(e,t,r,n){return new IE(e,t,r,n)}function Gv(e){return e=e.prototype,!(!e||!e.isReactComponent)}function RE(e){if(typeof e=="function")return Gv(e)?1:0;if(e!=null){if(e=e.$$typeof,e===ov)return 11;if(e===sv)return 14}return 2}function Es(e,t){var r=e.alternate;return r===null?(r=fi(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function _h(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")Gv(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case bc:return Ml(r.children,a,i,t);case iv:o=8,a|=8;break;case gy:return e=fi(12,r,t,a|2),e.elementType=gy,e.lanes=i,e;case xy:return e=fi(13,r,t,a),e.elementType=xy,e.lanes=i,e;case yy:return e=fi(19,r,t,a),e.elementType=yy,e.lanes=i,e;case q4:return Nm(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case K4:o=10;break e;case Y4:o=9;break e;case ov:o=11;break e;case sv:o=14;break e;case ss:o=16,n=null;break e}throw Error(Re(130,e==null?e:typeof e,""))}return t=fi(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function Ml(e,t,r,n){return e=fi(7,e,n,t),e.lanes=r,e}function Nm(e,t,r,n){return e=fi(22,e,n,t),e.elementType=q4,e.lanes=r,e.stateNode={isHidden:!1},e}function hx(e,t,r){return e=fi(6,e,null,t),e.lanes=r,e}function px(e,t,r){return t=fi(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function DE(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Kg(0),this.expirationTimes=Kg(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kg(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Uv(e,t,r,n,a,i,o,s,l){return e=new DE(e,t,r,s,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=fi(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},jv(i),e}function $E(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:yc,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function GN(e){if(!e)return Ls;e=e._reactInternals;e:{if(Yl(e)!==e||e.tag!==1)throw Error(Re(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if($a(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Re(171))}if(e.tag===1){var r=e.type;if($a(r))return Gj(e,r,t)}return t}function UN(e,t,r,n,a,i,o,s,l){return e=Uv(r,n,!0,e,a,i,o,s,l),e.context=GN(null),r=e.current,n=Sa(),a=Ts(r),i=Ao(n,a),i.callback=t??null,As(r,i,a),e.current.lanes=a,Qf(e,a,n),La(e,n),e}function _m(e,t,r,n){var a=t.current,i=Sa(),o=Ts(a);return r=GN(r),t.context===null?t.context=r:t.pendingContext=r,t=Ao(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=As(a,t,o),e!==null&&(Li(e,a,o,i),wh(e,a,o)),o}function rp(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function $k(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function zv(e,t){$k(e,t),(e=e.alternate)&&$k(e,t)}function LE(){return null}var zN=typeof reportError=="function"?reportError:function(e){console.error(e)};function Wv(e){this._internalRoot=e}Pm.prototype.render=Wv.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Re(409));_m(e,t,null,null)};Pm.prototype.unmount=Wv.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;El(function(){_m(null,e,null,null)}),t[Ro]=null}};function Pm(e){this._internalRoot=e}Pm.prototype.unstable_scheduleHydration=function(e){if(e){var t=vj();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ds.length&&t!==0&&t<ds[r].priority;r++);ds.splice(r,0,e),r===0&&kj(e)}};function Vv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Cm(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function Lk(){}function FE(e,t,r,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var u=rp(o);i.call(u)}}var o=UN(t,n,e,0,null,!1,!1,"",Lk);return e._reactRootContainer=o,e[Ro]=o.current,of(e.nodeType===8?e.parentNode:e),El(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var u=rp(l);s.call(u)}}var l=Uv(e,0,!1,null,null,!1,!1,"",Lk);return e._reactRootContainer=l,e[Ro]=l.current,of(e.nodeType===8?e.parentNode:e),El(function(){_m(t,l,r,n)}),l}function Am(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var s=a;a=function(){var l=rp(o);s.call(l)}}_m(t,o,e,a)}else o=FE(r,t,e,a,n);return rp(o)}yj=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=Cd(t.pendingLanes);r!==0&&(uv(t,r|1),La(t,vn()),!(_r&6)&&(Zc=vn()+500,Gs()))}break;case 13:El(function(){var n=Do(e,1);if(n!==null){var a=Sa();Li(n,e,1,a)}}),zv(e,1)}};dv=function(e){if(e.tag===13){var t=Do(e,134217728);if(t!==null){var r=Sa();Li(t,e,134217728,r)}zv(e,134217728)}};bj=function(e){if(e.tag===13){var t=Ts(e),r=Do(e,t);if(r!==null){var n=Sa();Li(r,e,t,n)}zv(e,t)}};vj=function(){return Lr};wj=function(e,t){var r=Lr;try{return Lr=e,t()}finally{Lr=r}};Py=function(e,t,r){switch(t){case"input":if(wy(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=vm(n);if(!a)throw Error(Re(90));J4(n),wy(n,a)}}}break;case"textarea":ej(e,r);break;case"select":t=r.value,t!=null&&Ic(e,!!r.multiple,t,!1)}};sj=Lv;lj=El;var BE={usingClientEntryPoint:!1,Events:[t0,Sc,vm,ij,oj,Lv]},hd={findFiberByHostInstance:ul,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},GE={bundleType:hd.bundleType,version:hd.version,rendererPackageName:hd.rendererPackageName,rendererConfig:hd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Uo.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=dj(e),e===null?null:e.stateNode},findFiberByHostInstance:hd.findFiberByHostInstance||LE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var B0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!B0.isDisabled&&B0.supportsFiber)try{gm=B0.inject(GE),Qi=B0}catch{}}ti.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BE;ti.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Vv(t))throw Error(Re(200));return $E(e,t,null,r)};ti.createRoot=function(e,t){if(!Vv(e))throw Error(Re(299));var r=!1,n="",a=zN;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=Uv(e,1,!1,null,null,r,!1,n,a),e[Ro]=t.current,of(e.nodeType===8?e.parentNode:e),new Wv(t)};ti.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Re(188)):(e=Object.keys(e).join(","),Error(Re(268,e)));return e=dj(t),e=e===null?null:e.stateNode,e};ti.flushSync=function(e){return El(e)};ti.hydrate=function(e,t,r){if(!Cm(t))throw Error(Re(200));return Am(null,e,t,!0,r)};ti.hydrateRoot=function(e,t,r){if(!Vv(e))throw Error(Re(405));var n=r!=null&&r.hydratedSources||null,a=!1,i="",o=zN;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=UN(t,null,e,1,r??null,a,!1,i,o),e[Ro]=t.current,of(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new Pm(t)};ti.render=function(e,t,r){if(!Cm(t))throw Error(Re(200));return Am(null,e,t,!1,r)};ti.unmountComponentAtNode=function(e){if(!Cm(e))throw Error(Re(40));return e._reactRootContainer?(El(function(){Am(null,null,e,!1,function(){e._reactRootContainer=null,e[Ro]=null})}),!0):!1};ti.unstable_batchedUpdates=Lv;ti.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Cm(r))throw Error(Re(200));if(e==null||e._reactInternals===void 0)throw Error(Re(38));return Am(e,t,r,!1,n)};ti.version="18.3.1-next-f1338f8080-20240426";function WN(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(WN)}catch(e){console.error(e)}}WN(),W4.exports=ti;var UE=W4.exports,Fk=UE;py.createRoot=Fk.createRoot,py.hydrateRoot=Fk.hydrateRoot;const Is=({isOpen:e,onClose:t,onConfirm:r,title:n,message:a,confirmText:i="I know the risk and insist to continue",cancelText:o="Cancel"})=>e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl border border-amber-500/30 overflow-hidden transform transition-all scale-100",children:[c.jsxs("div",{className:"bg-amber-500/10 p-6 flex flex-col items-center justify-center border-b border-amber-500/20",children:[c.jsx("div",{className:"w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mb-4",children:c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-amber-600 dark:text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),c.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white text-center",children:n})]}),c.jsx("div",{className:"p-6",children:c.jsx("div",{className:"text-gray-600 dark:text-slate-300 text-center text-sm leading-relaxed",children:a})}),c.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 flex gap-3 justify-end border-t border-gray-200 dark:border-slate-800",children:[c.jsx("button",{onClick:t,className:"px-4 py-2 bg-white hover:bg-gray-100 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-700 dark:text-slate-200 font-semibold rounded-lg border border-gray-300 dark:border-slate-600 transition-colors text-sm",children:o}),c.jsx("button",{onClick:r,className:"px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg shadow-amber-500/20 transition-all active:scale-95 text-sm",children:i})]})]})}):null,zE=({onFileSelected:e,onGenerateFakeDng:t,fileName:r,hasGeneratedData:n,viewMode:a,onSetViewMode:i,patternPeriod:o,onPatternPeriodChange:s,fillFactor:l,onFillFactorChange:u,patternPhase:d,onPatternPhaseChange:f,showPatternControls:h,onOpenAbout:p,onShowExif:x,bridgeStatus:g,onBridgeClick:b,isDrLabOpen:y,onToggleDrLab:m,isColorLabOpen:k,onToggleColorLab:S,isFftLabOpen:w,onToggleFftLab:v,isSfrLabOpen:M,onToggleSfrLab:N,onGenerateTestPic:_,onPTCFilesSelected:P,onDownloadDng:E,isThreePlane:R,onOpenDatabase:T,isSidebarOpen:G,onToggleSidebar:L,onOpenSaveZ8:C,isPsModeOpen:$,onTogglePsMode:A})=>{const O=j.useRef(null),F=j.useRef(null),[D,W]=j.useState(!1),[H,Y]=j.useState(!1),[te,U]=j.useState(!1),[Se,re]=j.useState("direct"),J=j.useRef(null),ne=j.useRef(null);j.useEffect(()=>{const oe=ke=>{J.current&&!J.current.contains(ke.target)&&Y(!1),ne.current&&!ne.current.contains(ke.target)&&U(!1)};return document.addEventListener("mousedown",oe),()=>document.removeEventListener("mousedown",oe)},[]);const ce=oe=>{var ke,le;if($){Y(!1);return}Y(!1),oe==="direct"?(re("direct"),(ke=O.current)==null||ke.click()):!g.isConnected||!g.hasDngConverter?W(!0):(re("convert"),(le=O.current)==null||le.click())},ie=oe=>{var le;if($){oe.target.value="";return}const ke=(le=oe.target.files)==null?void 0:le[0];ke&&e(ke,Se),oe.target.value=""},se=oe=>{oe.target.files&&oe.target.files.length>0&&P(oe.target.files),oe.target.value=""};return r==="pattern_test.dng"||(r==null||r.startsWith("Diff_")),c.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4 flex-shrink-0 relative z-50 font-mono",children:[c.jsx(Is,{isOpen:D,onClose:()=>W(!1),onConfirm:()=>W(!1),title:"DNG Converter Missing",confirmText:"OK",cancelText:"Cancel",message:c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsx("p",{className:"font-bold text-red-600 dark:text-red-400 text-base",children:"JiangBridge Offline or Adobe DNG Converter not installed"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"To use the conversion feature, you must run JiangBridge locally and have Adobe DNG Converter installed on your system."})]})}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-black dark:text-white text-center sm:text-left tracking-tight border-2 border-black dark:border-white px-2 py-1 bg-white dark:bg-black",children:"Jiangtherapee_Online"}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-slate-400 hidden lg:block max-w-xs truncate font-bold",title:r||"No image loaded",children:r||"No_Image_Loaded"}),R&&c.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border-2 border-red-500 dark:border-red-800 text-[10px] font-bold px-2 py-1 animate-pulse",children:" 3-PLANE / RGB MODE"})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-wrap justify-end",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:g.isConnected?void 0:b,className:`px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-black dark:border-gray-500 ${g.isConnected?"bg-emerald-100 text-emerald-900 border-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-600 cursor-default":"bg-pink-100 text-pink-900 border-pink-800 dark:bg-pink-900/30 dark:text-pink-400 dark:border-pink-600 hover:bg-pink-200 dark:hover:bg-pink-900/50 cursor-pointer animate-pulse"}`,title:g.isConnected?"Local Bridge Service Connected":"Click to download Jiangbridge",children:[c.jsx("span",{className:`w-2 h-2 ${g.isConnected?"bg-emerald-600":"bg-pink-600"}`}),g.isConnected?`JiangBridge Ready ${g.hasDngConverter?"DNG+":""}`:"JiangBridge Offline"]}),y&&c.jsxs("button",{onClick:m,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-indigo-800 bg-indigo-100 text-indigo-900 dark:bg-indigo-900/30 dark:text-indigo-400 dark:border-indigo-600 hover:bg-indigo-200 dark:hover:bg-indigo-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off DR Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-indigo-600 animate-pulse"}),"DR Lab On"]}),k&&c.jsxs("button",{onClick:S,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-yellow-800 bg-yellow-100 text-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-600 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off Color Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-yellow-500 animate-pulse"}),"Color Lab On"]}),w&&c.jsxs("button",{onClick:v,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-fuchsia-800 bg-fuchsia-100 text-fuchsia-900 dark:bg-fuchsia-900/30 dark:text-fuchsia-400 dark:border-fuchsia-600 hover:bg-fuchsia-200 dark:hover:bg-fuchsia-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off FFT Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-fuchsia-600 animate-pulse"}),"FFT Lab On"]}),M&&c.jsxs("button",{onClick:N,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-orange-800 bg-orange-100 text-orange-900 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-600 hover:bg-orange-200 dark:hover:bg-orange-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off SFR Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-orange-600 animate-pulse"}),"SFR Lab On"]}),$&&c.jsxs("button",{className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-teal-800 bg-teal-100 text-teal-900 dark:bg-teal-900/30 dark:text-teal-400 dark:border-teal-600 cursor-default animate-in fade-in",title:"PS Mode is locked",children:[c.jsx("span",{className:"w-2 h-2 bg-teal-500 animate-pulse"}),"PS Mode On"]})]}),c.jsx("input",{type:"file",ref:O,onChange:ie,className:"hidden"}),c.jsx("input",{type:"file",ref:F,onChange:se,className:"hidden",multiple:!0,accept:".csv"}),c.jsxs("div",{className:"relative inline-block text-left",ref:ne,children:[c.jsxs("button",{onClick:()=>U(!te),className:"bg-purple-700 hover:bg-purple-600 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2",children:["TOOLS",c.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${te?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),te&&c.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 shadow-[8px_8px_0px_rgba(0,0,0,0.5)] ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-hidden origin-top-right transition-all animate-in fade-in slide-in-from-top-2 border-2 border-black dark:border-gray-500",children:c.jsxs("div",{className:"py-1",children:[c.jsxs("button",{onClick:()=>{U(!1),A&&!$&&A(),y&&m(),w&&v(),k&&S&&S(),M&&N&&N()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${$?"bg-teal-100 dark:bg-teal-900/40 text-teal-800 dark:text-teal-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-teal-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),c.jsxs("span",{children:["PS Mode ",$?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{U(!1),y||m(),w&&v(),k&&S&&S(),M&&N&&N(),$&&A()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${y?"bg-indigo-100 dark:bg-indigo-900/40 text-indigo-800 dark:text-indigo-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),c.jsxs("span",{children:["DR Lab ",y?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{U(!1),S&&!k&&S(),y&&m(),w&&v(),M&&N&&N(),$&&A()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${k?"bg-yellow-100 dark:bg-yellow-900/40 text-yellow-800 dark:text-yellow-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),c.jsxs("span",{children:["Color Lab ",k?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{U(!1),N&&!M&&N(),y&&m(),w&&v(),k&&S&&S(),$&&A()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${M?"bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),c.jsxs("span",{children:["SFR Lab ",M?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{U(!1),w||v(),y&&m(),k&&S&&S(),M&&N&&N(),$&&A()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${w?"bg-fuchsia-100 dark:bg-fuchsia-900/40 text-fuchsia-800 dark:text-fuchsia-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-fuchsia-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),c.jsxs("span",{children:["Stack Lab ",w?"(On)":""]})]}),c.jsx("div",{className:"border-t border-gray-300 dark:border-gray-600 my-1"}),c.jsxs("button",{onClick:()=>{U(!1),C==null||C()},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),c.jsx("span",{children:" Z8 (Save Z8)"})]}),c.jsxs("button",{onClick:()=>{U(!1),t()},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),c.jsx("span",{children:"Generate Pattern DNG"})]}),c.jsxs("button",{onClick:()=>{var oe;U(!1),(oe=F.current)==null||oe.click()},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})}),c.jsx("span",{children:"Generate PTC"})]}),c.jsxs("button",{onClick:()=>{U(!1),window.open("https://y-g-jiang.github.io/CP.html","_blank")},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),c.jsx("span",{children:"Generate MTF Contour"})]})]})})]}),c.jsxs("div",{className:"relative inline-block text-left",ref:J,children:[c.jsxs("button",{onClick:()=>!$&&Y(!H),disabled:$,className:`bg-cyan-700 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2 ${$?"opacity-50 cursor-not-allowed":"hover:bg-cyan-600 active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black]"}`,title:$?"Load Image is disabled while PS Mode is active":void 0,children:["Load Image",c.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${H?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),H&&c.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 shadow-[8px_8px_0px_rgba(0,0,0,0.5)] ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-hidden origin-top-right transition-all animate-in fade-in slide-in-from-top-2 border-2 border-black dark:border-gray-500",children:c.jsxs("div",{className:"py-1",children:[c.jsxs("button",{onClick:()=>ce("direct"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600",children:[c.jsx("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),c.jsx("span",{children:"Load Image (Direct)"})]}),c.jsxs("button",{onClick:()=>ce("convert"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),c.jsx("span",{children:"Convert to Adobe DNG & Load"})]})]})})]}),r&&x&&c.jsxs("button",{onClick:x,className:"bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-1",title:"View EXIF Data",children:[c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"EXIF"]}),c.jsx("button",{onClick:p,className:"bg-teal-700 hover:bg-teal-600 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap",children:"About/Tutorial/Tools"}),c.jsx("a",{href:"https://y-g-jiang.github.io/index.html",target:"_blank",rel:"noopener noreferrer",className:"bg-gray-300 hover:bg-gray-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-black dark:text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm no-underline",children:"Home"}),c.jsxs("button",{onClick:L,className:`bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-3 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2 ${G?"":"ring-2 ring-cyan-500 ring-offset-2 dark:ring-offset-black"}`,title:G?"Hide Control Panel":"Show Control Panel",children:[c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:G?c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"}):c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})}),c.jsx("span",{className:"hidden sm:inline",children:G?"Hide Panel":"Show Panel"})]})]})]})},WE=({image:e,zoom:t,pan:r,onPanChange:n,onZoomChange:a,onSelectionChange:i,forcedSelection:o,theme:s,touchAction:l="pan",isMarking:u=!1,onPointClick:d,markers:f=[],gridRects:h=[],colorLabPoints:p=[],colorLabRects:x=[],sfrRects:g=[],psMaskOverlay:b=null,psMaskDirtyRect:y=null,psGuides:m=[],psSelectedGuideId:k=null,psGuidePickTarget:S=null,psEllipseTool:w={mode:"off",draft:null},psEditableEllipse:v=null,psBrush:M,onPsBrushPaint:N,onPsGuidePickPoint:_,onPsEllipseCenterPick:P,onPsEllipseDrag:E,onPsEditEllipse:R})=>{var Lt;const T=j.useRef(null),G=j.useRef(document.createElement("canvas")),L=j.useRef(null),C=j.useRef(null),[$,A]=j.useState(!1),[O,F]=j.useState({x:0,y:0}),D=j.useRef(null),W=j.useRef(null),H=j.useRef(null),[Y,te]=j.useState(!1),[U,Se]=j.useState(null),[re,J]=j.useState(null),[ne,ce]=j.useState(!1),[ie,se]=j.useState(!1),[oe,ke]=j.useState(!1),[le,fe]=j.useState(null),Pe=j.useRef(null),Fe=j.useRef(null),Ue=j.useRef(null),K=j.useRef(null),_e=Me=>{Pe.current=Me,fe(Me)};j.useEffect(()=>{o!==void 0&&J(o)},[o]),j.useEffect(()=>{oe||_e(null)},[oe,v==null?void 0:v.id]),j.useEffect(()=>{if(!b){L.current=null,C.current=null;return}if(!L.current||!C.current||C.current.width!==b.width||C.current.height!==b.height||!y){const Wt=document.createElement("canvas");Wt.width=b.width,Wt.height=b.height;const Rt=Wt.getContext("2d");if(!Rt)return;const kt=Rt.createImageData(b.width,b.height);for(let qt=0;qt<b.alpha.length;qt++){const xr=Math.max(0,Math.min(1,b.alpha[qt])),Ir=qt*4;kt.data[Ir]=255,kt.data[Ir+1]=56,kt.data[Ir+2]=56,kt.data[Ir+3]=Math.round(xr*128)}Rt.putImageData(kt,0,0),L.current=Wt,C.current={width:b.width,height:b.height};return}const xe=L.current.getContext("2d");if(!xe)return;const ue=Math.max(0,Math.floor(y.x0)),De=Math.max(0,Math.floor(y.y0)),qe=Math.min(b.width-1,Math.ceil(y.x1)),pt=Math.min(b.height-1,Math.ceil(y.y1)),de=Math.max(0,qe-ue+1),Ce=Math.max(0,pt-De+1);if(de<=0||Ce<=0)return;const dt=xe.createImageData(de,Ce);for(let Wt=0;Wt<Ce;Wt++){const kt=(De+Wt)*b.width,qt=Wt*de;for(let xr=0;xr<de;xr++){const Ir=ue+xr,fr=Math.max(0,Math.min(1,b.alpha[kt+Ir])),be=(qt+xr)*4;dt.data[be]=255,dt.data[be+1]=56,dt.data[be+2]=56,dt.data[be+3]=Math.round(fr*128)}}xe.putImageData(dt,ue,De)},[b==null?void 0:b.alpha,b==null?void 0:b.width,b==null?void 0:b.height,b==null?void 0:b.version,y]);const Te=j.useCallback(()=>{const Me=T.current,Z=Me==null?void 0:Me.getContext("2d");return{canvas:Me,ctx:Z}},[]);j.useEffect(()=>{const Me=G.current,Z=Me.getContext("2d");if(!e||!Z)return;let xe=0,ue=0;e instanceof ImageData?(xe=e.width,ue=e.height):e instanceof HTMLImageElement&&(xe=e.naturalWidth,ue=e.naturalHeight),!(xe===0||ue===0)&&((Me.width!==xe||Me.height!==ue)&&(Me.width=xe,Me.height=ue),e instanceof ImageData?Z.putImageData(e,0,0):(Z.clearRect(0,0,xe,ue),Z.drawImage(e,0,0)))},[e]);const Le=j.useCallback(()=>{const{canvas:Me,ctx:Z}=Te();if(!Me||!Z||!e)return;if(Z.setTransform(1,0,0,1,0,0),Z.fillStyle=s==="dark"?"rgb(15, 23, 42)":"rgb(243, 244, 246)",Z.fillRect(0,0,Me.width,Me.height),Z.setTransform(t,0,0,t,r.x,r.y),G.current.width>0&&(Z.imageSmoothingEnabled=!1,Z.drawImage(G.current,0,0)),L.current&&(Z.imageSmoothingEnabled=!1,Z.drawImage(L.current,0,0)),m&&m.length>0){Z.save();for(const ue of m){if(ue.visible===!1)continue;const De=k===ue.id;Z.strokeStyle=De?"#f59e0b":"#22d3ee",Z.lineWidth=De?2/t:1/t,Z.setLineDash([8/t,6/t]),Z.beginPath(),Z.moveTo(ue.p1.x,ue.p1.y),Z.lineTo(ue.p2.x,ue.p2.y),Z.stroke();const qe=3/t;Z.fillStyle=De?"#f59e0b":"#22d3ee",Z.beginPath(),Z.arc(ue.p1.x,ue.p1.y,qe,0,Math.PI*2),Z.arc(ue.p2.x,ue.p2.y,qe,0,Math.PI*2),Z.fill()}Z.restore()}if(w.mode!=="off"&&w.draft){const ue=w.draft;Z.save(),Z.strokeStyle="#f59e0b",Z.lineWidth=2/t,Z.setLineDash([6/t,4/t]),Z.beginPath(),Z.ellipse(ue.center.x,ue.center.y,Math.max(1,ue.radiusX),Math.max(1,ue.radiusY),ue.rotationDeg*Math.PI/180,0,Math.PI*2),Z.stroke(),Z.setLineDash([]),Z.fillStyle="#f59e0b",Z.beginPath(),Z.arc(ue.center.x,ue.center.y,3/t,0,Math.PI*2),Z.fill(),Z.restore()}const xe=oe&&le?le:v;if(xe&&w.mode==="off"){const ue=xe,De=ht(ue),qe=4/t;Z.save(),Z.strokeStyle="#14b8a6",Z.lineWidth=1.5/t,Z.setLineDash([5/t,3/t]),Z.beginPath(),Z.ellipse(ue.center.x,ue.center.y,Math.max(1,ue.radiusX),Math.max(1,ue.radiusY),ue.rotationDeg*Math.PI/180,0,Math.PI*2),Z.stroke(),Z.setLineDash([]),Z.strokeStyle="#22d3ee",Z.beginPath(),Z.moveTo(De.center.x,De.center.y),Z.lineTo(De.rotHandle.x,De.rotHandle.y),Z.stroke();const pt=(de,Ce)=>{Z.fillStyle=Ce,Z.beginPath(),Z.arc(de.x,de.y,qe,0,Math.PI*2),Z.fill(),Z.strokeStyle="#0f172a",Z.lineWidth=1/t,Z.stroke()};pt(De.center,"#f59e0b"),pt(De.rxHandle,"#38bdf8"),pt(De.ryHandle,"#818cf8"),pt(De.rotHandle,"#22d3ee"),Z.restore()}if(re){Z.strokeStyle="#06b6d4",Z.lineWidth=1/t,Z.fillStyle="rgba(6, 182, 212, 0.2)",Z.beginPath(),Z.rect(re.x,re.y,re.w,re.h),Z.fill(),Z.stroke(),Z.save(),Z.fillStyle="#fff";const ue=Math.max(10,14/t);Z.font=`${ue}px monospace`,Z.shadowColor="rgba(0,0,0,0.8)",Z.shadowBlur=4,Z.shadowOffsetX=1,Z.shadowOffsetY=1,Z.fillText(`${Math.round(re.w)}x${Math.round(re.h)}`,re.x,re.y-5/t),Z.restore()}if(h&&h.length>0){Z.save(),Z.strokeStyle="#f59e0b",Z.lineWidth=1/t,Z.globalAlpha=.8,Z.beginPath(),h.forEach(qe=>{Z.rect(qe.x,qe.y,qe.w,qe.h)}),Z.stroke();const ue=h[0];Z.fillStyle="#f59e0b";const De=Math.max(10,12/t);Z.font=`${De}px monospace`,Z.fillText(`${Math.round(ue.w)}x${Math.round(ue.h)}`,ue.x,ue.y-4/t),Z.restore()}if(f&&f.length>0){Z.save();const ue=6/t,De=Math.max(12,16/t);Z.font=`bold ${De}px sans-serif`,Z.textAlign="center",Z.textBaseline="middle",f.forEach((qe,pt)=>{Z.beginPath(),Z.arc(qe.x,qe.y,ue,0,2*Math.PI),Z.fillStyle="white",Z.fill(),Z.strokeStyle="#4338ca",Z.lineWidth=2/t,Z.stroke(),Z.fillStyle="#4338ca",Z.fillText((pt+1).toString(),qe.x,qe.y-12/t)}),Z.restore()}if(p&&p.length>0){Z.save();const ue=5/t,De=Math.max(10,14/t);Z.font=`bold ${De}px sans-serif`,Z.textAlign="center",Z.textBaseline="middle",p.forEach((qe,pt)=>{Z.fillStyle="yellow",Z.fillRect(qe.x-ue,qe.y-ue,ue*2,ue*2),Z.strokeStyle="black",Z.lineWidth=1/t,Z.strokeRect(qe.x-ue,qe.y-ue,ue*2,ue*2),Z.fillStyle="yellow",Z.shadowColor="black",Z.shadowBlur=2,Z.fillText((pt+1).toString(),qe.x,qe.y-10/t)}),Z.restore()}if(x&&x.length>0){if(Z.save(),Z.strokeStyle="yellow",Z.lineWidth=1/t,Z.globalAlpha=.9,Z.beginPath(),x.forEach(ue=>{Z.rect(ue.x,ue.y,ue.w,ue.h)}),Z.stroke(),x[0]){const ue=x[0];Z.fillStyle="yellow",Z.shadowColor="black",Z.shadowBlur=3;const De=Math.max(10,12/t);Z.font=`${De}px monospace`,Z.fillText(`${Math.round(ue.w)}x${Math.round(ue.h)}`,ue.x,ue.y-4/t)}Z.restore()}g&&g.length>0&&(Z.save(),Z.strokeStyle="#ef4444",Z.lineWidth=2/t,Z.globalAlpha=.9,Z.beginPath(),g.forEach(ue=>{Z.rect(ue.x,ue.y,ue.w,ue.h)}),Z.stroke(),Z.restore())},[Te,e,t,r,s,re,h,f,p,x,g,b==null?void 0:b.version,m,k,w,v,oe,le]);j.useEffect(()=>{const{canvas:Me}=Te();if(!Me)return;const Z=new ResizeObserver(()=>{Me.width=Me.clientWidth,Me.height=Me.clientHeight,Le()});return Z.observe(Me),()=>Z.disconnect()},[Te,Le]),j.useEffect(()=>{Le()},[Le,e,r,t,s,re,h,f,p,x,g,m,k,v,oe,le]);const ft=Me=>{const{canvas:Z}=Te();if(!Z)return{x:0,y:0};const xe=Z.getBoundingClientRect();return{x:Me.clientX-xe.left,y:Me.clientY-xe.top}},Xe=(Me,Z)=>({x:(Me-r.x)/t,y:(Z-r.y)/t}),Ie=Me=>{const Z=Me*Math.PI/180,xe={x:Math.cos(Z),y:Math.sin(Z)},ue={x:-Math.sin(Z),y:Math.cos(Z)};return{ux:xe,uy:ue}},ht=Me=>{const{ux:Z,uy:xe}=Ie(Me.rotationDeg),ue=Me.center,De=Math.max(1,Me.radiusX),qe=Math.max(1,Me.radiusY),pt={x:ue.x+Z.x*De,y:ue.y+Z.y*De},de={x:ue.x+xe.x*qe,y:ue.y+xe.y*qe},Ce={x:ue.x+Z.x*(De+28/t),y:ue.y+Z.y*(De+28/t)};return{center:ue,rxHandle:pt,ryHandle:de,rotHandle:Ce,ux:Z,uy:xe}},xt=(Me,Z)=>{const xe=Me.x-Z.x,ue=Me.y-Z.y;return xe*xe+ue*ue},nt=Me=>{const Z=oe&&le?le:v;if(!Z||w.mode!=="off")return null;const xe=ht(Z),ue=8/t,De=ue*ue;if(xt(Me,xe.rotHandle)<=De)return"rotate";if(xt(Me,xe.rxHandle)<=De)return"radiusX";if(xt(Me,xe.ryHandle)<=De)return"radiusY";if(xt(Me,xe.center)<=De)return"move";const qe=Me.x-xe.center.x,pt=Me.y-xe.center.y,de=qe*xe.ux.x+pt*xe.ux.y,Ce=qe*xe.uy.x+pt*xe.uy.y,dt=de/Math.max(1,Z.radiusX),Wt=Ce/Math.max(1,Z.radiusY);return dt*dt+Wt*Wt<=1.05*1.05?"move":null},Gt=Me=>{if(!v||!R||w.mode!=="off")return!1;const Z=nt(Me);return Z?(Ue.current=Z,K.current={itemId:v.id,startMouse:Me,center:{...v.center},radiusX:v.radiusX,radiusY:v.radiusY,rotationDeg:v.rotationDeg},_e({id:v.id,center:{...v.center},radiusX:v.radiusX,radiusY:v.radiusY,rotationDeg:v.rotationDeg}),ke(!0),!0):!1},yt=Me=>{if(!oe)return!1;const Z=Ue.current,xe=K.current;if(!Z||!xe)return!1;const ue={id:xe.itemId,center:{...xe.center},radiusX:xe.radiusX,radiusY:xe.radiusY,rotationDeg:xe.rotationDeg};if(Z==="move")return ue.center={x:xe.center.x+(Me.x-xe.startMouse.x),y:xe.center.y+(Me.y-xe.startMouse.y)},_e(ue),!0;if(Z==="rotate"){const Ce=Math.atan2(Me.y-xe.center.y,Me.x-xe.center.x)*180/Math.PI;return ue.rotationDeg=Ce,_e(ue),!0}const{ux:De,uy:qe}=Ie(xe.rotationDeg),pt=Me.x-xe.center.x,de=Me.y-xe.center.y;if(Z==="radiusX"){const Ce=Math.max(1,Math.abs(pt*De.x+de*De.y));return ue.radiusX=Ce,_e(ue),!0}if(Z==="radiusY"){const Ce=Math.max(1,Math.abs(pt*qe.x+de*qe.y));return ue.radiusY=Ce,_e(ue),!0}return!1},et=()=>{if(!oe||!R)return;const Me=K.current,Z=Pe.current||le;!Me||!Z||R(Me.itemId,{center:Z.center,radiusX:Z.radiusX,radiusY:Z.radiusY,rotationDeg:Z.rotationDeg})},He=Me=>{Me.preventDefault();const Z=ft(Me),xe=Xe(Z.x,Z.y);if(Fe.current=xe,w.mode==="center"&&P){P(xe);return}if(w.mode==="drag"&&E){E(xe,"start"),se(!0);return}if(!Gt(xe)){if(S&&_){_(xe);return}if(M!=null&&M.enabled&&N&&!u&&l!=="select"&&!Me.shiftKey){const ue=Xe(Z.x,Z.y);N(ue,"start"),ce(!0);return}if(u&&d){const ue=Xe(Z.x,Z.y);d(ue);return}if(l==="select"||Me.shiftKey){te(!0);const ue=Xe(Z.x,Z.y),De={x:Math.floor(ue.x),y:Math.floor(ue.y)};Se(De),J(null),i&&i(null)}else A(!0),F({x:Z.x-r.x,y:Z.y-r.y})}},mt=Me=>{const Z=ft(Me),xe=Xe(Z.x,Z.y);if(Fe.current=xe,!yt(xe)){if(ie&&E){E(xe,"move");return}if(ne&&N){N(xe,"move");return}if(Y&&U){const ue=Xe(Z.x,Z.y),De=Math.floor(ue.x),qe=Math.floor(ue.y),pt=Math.min(U.x,De),de=Math.min(U.y,qe),Ce=Math.max(U.x,De),dt=Math.max(U.y,qe),Wt=Ce-pt+1,Rt=dt-de+1;J({x:pt,y:de,w:Wt,h:Rt})}else $&&n({x:Z.x-O.x,y:Z.y-O.y})}},jt=()=>{ie&&E&&(E(Fe.current||{x:0,y:0},"end"),se(!1)),oe&&(et(),ke(!1),_e(null),Ue.current=null,K.current=null),ne&&(N&&N({x:0,y:0},"end"),ce(!1)),Y&&(te(!1),re&&i&&re.w>0&&re.h>0&&i(re)),A(!1)},or=Me=>{var Z;if(Me.touches.length===1){const xe=Me.touches[0],ue=(Z=T.current)==null?void 0:Z.getBoundingClientRect();if(!ue)return;const De=xe.clientX-ue.left,qe=xe.clientY-ue.top,pt=Xe(De,qe);if(Fe.current=pt,w.mode==="center"&&P){P(pt);return}if(w.mode==="drag"&&E){E(pt,"start"),se(!0);return}if(Gt(pt))return;if(S&&_){_(pt);return}if(u&&d){const de=Xe(De,qe);d(de);return}if(M!=null&&M.enabled&&N&&l!=="select"){const de=Xe(De,qe);N(de,"start"),ce(!0);return}if(l==="select"){const de=Xe(De,qe),Ce={x:Math.floor(de.x),y:Math.floor(de.y)};Se(Ce),te(!0),J(null),i&&i(null)}else H.current={x:De,y:qe},F({x:De-r.x,y:qe-r.y}),A(!0)}else if(Me.touches.length===2){const xe=Math.hypot(Me.touches[0].clientX-Me.touches[1].clientX,Me.touches[0].clientY-Me.touches[1].clientY);D.current=xe,W.current=t,A(!1),te(!1)}},zt=Me=>{var Z;if(Me.touches.length===1){const xe=Me.touches[0],ue=(Z=T.current)==null?void 0:Z.getBoundingClientRect();if(!ue)return;const De=xe.clientX-ue.left,qe=xe.clientY-ue.top,pt=Xe(De,qe);if(Fe.current=pt,yt(pt))return;if(ie&&E){E(pt,"move");return}if(u)return;if(ne&&N){N(pt,"move");return}if(Y&&U){const de=Xe(De,qe),Ce=Math.floor(de.x),dt=Math.floor(de.y),Wt=Math.min(U.x,Ce),Rt=Math.min(U.y,dt),kt=Math.max(U.x,Ce),qt=Math.max(U.y,dt),xr=kt-Wt+1,Ir=qt-Rt+1;J({x:Wt,y:Rt,w:xr,h:Ir})}else $&&n({x:De-O.x,y:qe-O.y})}else if(Me.touches.length===2&&D.current&&W.current&&a){const ue=Math.hypot(Me.touches[0].clientX-Me.touches[1].clientX,Me.touches[0].clientY-Me.touches[1].clientY)/D.current;a(W.current*ue)}},ut=()=>{ie&&E&&(E(Fe.current||{x:0,y:0},"end"),se(!1)),oe&&(et(),ke(!1),_e(null),Ue.current=null,K.current=null),ne&&N&&(N({x:0,y:0},"end"),ce(!1)),Y&&(te(!1),re&&i&&re.w>0&&re.h>0&&i(re)),A(!1),D.current=null,W.current=null,H.current=null},It=w.mode!=="off"||S?"cursor-crosshair":oe?"cursor-grabbing":v?"cursor-pointer":M!=null&&M.enabled||u||l==="select"||(Lt=window.event)!=null&&Lt.shiftKey?"cursor-crosshair":"cursor-grab active:cursor-grabbing";return c.jsx("canvas",{ref:T,className:`w-full h-full block touch-none ${It}`,onMouseDown:He,onMouseMove:mt,onMouseUp:jt,onMouseLeave:jt,onTouchStart:or,onTouchMove:zt,onTouchEnd:ut,onTouchCancel:ut,tabIndex:0})},VE="modulepreload",HE=function(e){return"/"+e},Bk={},Mt=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(l=>{if(l=HE(l),l in Bk)return;Bk[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":VE,u||(f.as="script"),f.crossOrigin="",f.href=l,s&&f.setAttribute("nonce",s),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return a.then(o=>{for(const s of o||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})};function Lo(e){const[[t,r,n],[a,i,o],[s,l,u]]=e,d=t*(i*u-o*l)-r*(a*u-o*s)+n*(a*l-i*s);if(Math.abs(d)<1e-10)return null;const f=1/d;return[[(i*u-o*l)*f,(n*l-r*u)*f,(r*o-n*i)*f],[(o*s-a*u)*f,(t*u-n*s)*f,(n*a-t*o)*f],[(a*l-i*s)*f,(r*s-t*l)*f,(t*i-r*a)*f]]}function VN(e,t){const[[r,n,a],[i,o,s],[l,u,d]]=e,[f,h,p]=t;return[r*f+n*h+a*p,i*f+o*h+s*p,l*f+u*h+d*p]}function Jc(e,t){const r=[[0,0,0],[0,0,0],[0,0,0]];for(let n=0;n<3;n++)for(let a=0;a<3;a++)for(let i=0;i<3;i++)r[n][a]+=e[n][i]*t[i][a];return r}function XE(e){const t=e.length;if(t<2)return s=>{var l;return((l=e[0])==null?void 0:l.y)||0};const r=[...e].sort((s,l)=>s.x-l.x),n=r.map(s=>s.x),a=r.map(s=>s.y),i=new Float32Array(t-1),o=new Float32Array(t);for(let s=0;s<t-1;s++){const l=n[s+1]-n[s],u=a[s+1]-a[s];i[s]=u/(l||1e-9)}o[0]=i[0];for(let s=1;s<t-1;s++)o[s]=(i[s-1]+i[s])*.5;o[t-1]=i[t-2];for(let s=0;s<t-1;s++)if(i[s]===0)o[s]=0,o[s+1]=0;else{const l=o[s]/i[s],u=o[s+1]/i[s],d=l*l+u*u;if(d>9){const f=3/Math.sqrt(d);o[s]=l*f*i[s],o[s+1]=u*f*i[s]}}return s=>{let l=0;if(s<=n[0])return a[0];if(s>=n[t-1])return a[t-1];for(;s>n[l+1]&&l<t-2;)l++;const u=n[l+1]-n[l],d=1/u,h=(s-n[l])*d,p=h*h,x=p*h,g=2*x-3*p+1,b=x-2*p+h,y=-2*x+3*p,m=x-p,k=g*a[l]+b*u*o[l]+y*a[l+1]+m*u*o[l+1];return Math.max(0,Math.min(1,k))}}function da(e,t=256){const r=XE(e),n=new Float32Array(t);for(let a=0;a<t;a++){const i=a/(t-1);n[a]=r(i)}return n}class Il{constructor(t){wr(this,"size");wr(this,"isPowerOfTwo");wr(this,"_real");wr(this,"_imag");wr(this,"_scratch",null);wr(this,"_rev",null);wr(this,"_m",0);wr(this,"_internalFFT",null);wr(this,"_chirpReal",null);wr(this,"_chirpImag",null);wr(this,"_bReal",null);wr(this,"_bImag",null);wr(this,"_hanning",null);wr(this,"_windowSumSq",0);this.size=t,this.isPowerOfTwo=(t&t-1)===0&&t>0,this._real=new Float32Array(t),this._imag=new Float32Array(t),this.isPowerOfTwo?this.initRadix2():this.initBluestein()}initRadix2(){const t=this.size,r=Math.log2(t);this._rev=new Uint32Array(t);for(let n=0;n<t;n++){let a=0,i=n;for(let o=0;o<r;o++)a=a<<1|i&1,i>>>=1;this._rev[n]=a}}initBluestein(){const t=this.size;this._m=Math.pow(2,Math.ceil(Math.log2(2*t-1))),this._internalFFT=new Il(this._m),this._chirpReal=new Float32Array(t),this._chirpImag=new Float32Array(t);for(let a=0;a<t;a++){const i=-Math.PI*(a*a)/t;this._chirpReal[a]=Math.cos(i),this._chirpImag[a]=Math.sin(i)}const r=new Float32Array(this._m),n=new Float32Array(this._m);for(let a=0;a<t;a++)r[a]=this._chirpReal[a],n[a]=-this._chirpImag[a];for(let a=1;a<t;a++)r[this._m-a]=r[a],n[this._m-a]=n[a];this._internalFFT.transform(r,n),this._bReal=new Float32Array(this._internalFFT._real),this._bImag=new Float32Array(this._internalFFT._imag)}initHanning(){if(this._hanning)return;const t=this.size;this._hanning=new Float32Array(t);let r=0;for(let n=0;n<t;n++){const a=.5*(1-Math.cos(2*Math.PI*n/(t-1)));this._hanning[n]=a,r+=a*a}this._windowSumSq=r}transform(t,r){this.isPowerOfTwo?this.transformRadix2(t,r):this.transformBluestein(t,r)}transformRadix2(t,r){const n=this.size,a=this._rev,i=this._real,o=this._imag;if(t===i)for(let s=0;s<n;s++){const l=a[s];if(s<l){const u=i[s],d=o[s];i[s]=i[l],o[s]=o[l],i[l]=u,o[l]=d}}else for(let s=0;s<n;s++){const l=a[s];i[s]=t[l],o[s]=r?r[l]:0}for(let s=2;s<=n;s*=2){const l=s/2,u=-2*Math.PI/s,d=Math.cos(u),f=Math.sin(u);for(let h=0;h<n;h+=s){let p=1,x=0;for(let g=0;g<l;g++){const b=h+g,y=h+g+l,m=p*i[y]-x*o[y],k=p*o[y]+x*i[y],S=i[b],w=o[b];i[b]=S+m,o[b]=w+k,i[y]=S-m,o[y]=w-k;const v=p*d-x*f,M=p*f+x*d;p=v,x=M}}}}transformBluestein(t,r){const n=this.size,a=this._m,i=this._internalFFT,o=i._real,s=i._imag;o.fill(0),s.fill(0);for(let f=0;f<n;f++){const h=t[f],p=r?r[f]:0,x=this._chirpReal[f],g=this._chirpImag[f];o[f]=h*x-p*g,s[f]=h*g+p*x}i.transformRadix2(o,s);for(let f=0;f<a;f++){const h=i._real[f],p=i._imag[f],x=this._bReal[f],g=this._bImag[f];i._real[f]=h*x-p*g,i._imag[f]=h*g+p*x}const l=i._real,u=i._imag;for(let f=0;f<a;f++)u[f]=-u[f];i.transformRadix2(l,u);const d=1/a;for(let f=0;f<n;f++){const h=i._real[f]*d,p=-i._imag[f]*d,x=this._chirpReal[f],g=this._chirpImag[f];this._real[f]=h*x-p*g,this._imag[f]=h*g+p*x}}calculateSpectrum(t,r,n=!1){const a=this.size;let i=0;for(let d=0;d<a;d++)i+=t[d];const o=i/a;this._scratch||(this._scratch=new Float32Array(a));const s=this._scratch;if(n){this.initHanning();const d=this._hanning;for(let f=0;f<a;f++)s[f]=(t[f]-o)*d[f]}else for(let d=0;d<a;d++)s[d]=t[d]-o;this.transform(s);const l=r.length;let u=1/a;n&&this._windowSumSq>0&&(u=1/this._windowSumSq);for(let d=0;d<l;d++){const f=this._real[d],h=this._imag[d];r[d]+=(f*f+h*h)*u}}}function Gk(e,t,r,n=!1){const a=new Il(t),i=new Il(r),o=t*r,s=new Float32Array(o),l=new Float32Array(o);let u=null,d=null;if(n){u=new Float32Array(t);for(let g=0;g<t;g++)u[g]=.5*(1-Math.cos(2*Math.PI*g/(t-1)));d=new Float32Array(r);for(let g=0;g<r;g++)d[g]=.5*(1-Math.cos(2*Math.PI*g/(r-1)))}for(let g=0;g<r;g++){const b=g*t,y=a._real;let m=0;for(let S=0;S<t;S++)m+=e[b+S];const k=m/t;if(u)for(let S=0;S<t;S++)y[S]=(e[b+S]-k)*u[S];else for(let S=0;S<t;S++)y[S]=e[b+S]-k;a.transform(y);for(let S=0;S<t;S++)s[b+S]=a._real[S],l[b+S]=a._imag[S]}for(let g=0;g<t;g++){const b=i._real,y=i._imag;for(let m=0;m<r;m++){const k=m*t+g;let S=s[k],w=l[k];d&&(S*=d[m],w*=d[m]),b[m]=S,y[m]=w}i.transform(b,y);for(let m=0;m<r;m++){const k=m*t+g;s[k]=i._real[m],l[k]=i._imag[m]}}const f=new Float32Array(o);let h=1,p=t,x=r;if(n&&u&&d){p=0;for(let g=0;g<t;g++)p+=u[g]*u[g];x=0;for(let g=0;g<r;g++)x+=d[g]*d[g]}h=1/(p*x);for(let g=0;g<o;g++)f[g]=(s[g]*s[g]+l[g]*l[g])*h;return f}function Uk(e,t,r){const n=new Float32Array(e.length),a=Math.floor(t/2),i=Math.floor(r/2);for(let o=0;o<r;o++)for(let s=0;s<t;s++){const l=(s+a)%t,u=(o+i)%r,d=o*t+s,f=u*t+l;n[f]=e[d]}return n}const Rl=e=>`${e}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,jr=e=>Math.max(0,Math.min(1,e)),Bc=e=>{const t=jr(e);return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055},mx=e=>{const t=jr(e);return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},G0=[{x:0,y:0},{x:1,y:1}],U0=e=>e.map(t=>({x:t.x,y:t.y})),Hv=()=>({master:U0(G0),red:U0(G0),green:U0(G0),blue:U0(G0)}),KE=["red","orange","yellow","green","aqua","blue","purple","magenta"],HN=()=>({exposure:0,temperature:0,tint:0,contrast:0,highlights:0,shadows:0,vibrance:0,saturation:0}),ts=()=>({hue:0,saturation:0,luminance:0}),Xv=()=>({red:ts(),orange:ts(),yellow:ts(),green:ts(),aqua:ts(),blue:ts(),purple:ts(),magenta:ts()}),Pi=(e,t,r,n=0)=>{const a=Number(e);return Number.isFinite(a)?Math.max(t,Math.min(r,a)):n},Qc=e=>({exposure:Pi(e==null?void 0:e.exposure,-5,5,0),temperature:Pi(e==null?void 0:e.temperature,-100,100,0),tint:Pi(e==null?void 0:e.tint,-100,100,0),contrast:Pi(e==null?void 0:e.contrast,-100,100,0),highlights:Pi(e==null?void 0:e.highlights,-100,100,0),shadows:Pi(e==null?void 0:e.shadows,-100,100,0),vibrance:Pi(e==null?void 0:e.vibrance,-100,100,0),saturation:Pi(e==null?void 0:e.saturation,-100,100,0)}),eu=e=>{const t=Xv(),r=n=>{var a,i,o;return{hue:Pi((a=e==null?void 0:e[n])==null?void 0:a.hue,-100,100,t[n].hue),saturation:Pi((i=e==null?void 0:e[n])==null?void 0:i.saturation,-100,100,t[n].saturation),luminance:Pi((o=e==null?void 0:e[n])==null?void 0:o.luminance,-100,100,t[n].luminance)}};return{red:r("red"),orange:r("orange"),yellow:r("yellow"),green:r("green"),aqua:r("aqua"),blue:r("blue"),purple:r("purple"),magenta:r("magenta")}},Om=e=>{const t=Hv();if(!e)return t;const r=n=>{const a=e==null?void 0:e[n];if(!Array.isArray(a)||a.length<2)return t[n];const i=a.map(o=>({x:Math.max(0,Math.min(1,Number((o==null?void 0:o.x)??0))),y:Math.max(0,Math.min(1,Number((o==null?void 0:o.y)??0)))})).filter(o=>!Number.isNaN(o.x)&&!Number.isNaN(o.y)).sort((o,s)=>o.x-s.x);return i.length<2?t[n]:(i[0].x=0,i[i.length-1].x=1,i)};return{master:r("master"),red:r("red"),green:r("green"),blue:r("blue")}},YE=(e,t,r,n,a,i,o,s,l)=>{const u=Math.max(1,i),d=jr(o),f=jr(l),h=u,p=u*(1+f*1.5),x=p*p,g=Math.max(0,Math.floor(n-p)),b=Math.max(0,Math.floor(a-p)),y=Math.min(t-1,Math.ceil(n+p)),m=Math.min(r-1,Math.ceil(a+p));for(let k=b;k<=m;k++){const S=k*t;for(let w=g;w<=y;w++){const v=w-n,M=k-a,N=v*v+M*M;if(N>x)continue;const _=Math.sqrt(N);let P=1;if(_>h){const G=Math.max(1e-6,p-h);P=jr((p-_)/G)}const E=jr(d*P),R=S+w,T=e[R];e[R]=s==="add"?T+(1-T)*E:T*(1-E)}}},qE=(e,t,r,n)=>{const a=n.center.x,i=n.center.y,o=Math.max(1,n.radiusX),s=Math.max(1,n.radiusY),l=Math.max(1,Math.min(o,s)),u=Math.max(0,Math.min(n.featherPx,l*.95)),d=n.rotationDeg*Math.PI/180,f=Math.cos(d),h=Math.sin(d),p=Math.ceil(Math.max(o,s))+2,x=Math.max(0,Math.floor(a-p)),g=Math.max(0,Math.floor(i-p)),b=Math.min(t-1,Math.ceil(a+p)),y=Math.min(r-1,Math.ceil(i+p));for(let m=g;m<=y;m++){const k=m*t;for(let S=x;S<=b;S++){const w=S-a,v=m-i,M=w*f+v*h,N=-w*h+v*f,_=Math.sqrt(M*M/(o*o)+N*N/(s*s));if(_>1)continue;let P=1;if(u>0){const T=(1-_)*l;P=jr(T/u)}const E=k+S,R=e[E];e[E]=n.mode==="add"?R+(1-R)*P:R*(1-P)}}},Kv=e=>{const t=new Float32Array(e.width*e.height);for(const r of e.items||[])if(r.visible)if(r.type==="ellipse")qE(t,e.width,e.height,r);else for(const n of r.points)YE(t,e.width,e.height,n.x,n.y,r.sizePx,r.opacity,r.mode,r.feather);return t};function XN(e){const t=e.masks.map(r=>{const n=Kv(r);return{...r,alpha:n,version:r.version+1}});return{...e,masks:t}}function ZE(e){const t=e.width,r=e.height,n=e.alpha;let a=t,i=r,o=-1,s=-1;for(let u=0;u<r;u++){const d=u*t;for(let f=0;f<t;f++)n[d+f]<=1e-4||(f<a&&(a=f),u<i&&(i=u),f>o&&(o=f),u>s&&(s=u))}if(o<a||s<i)return null;const l=2;return{x0:Math.max(0,a-l),y0:Math.max(0,i-l),x1:Math.min(t-1,o+l),y1:Math.min(r-1,s+l)}}function zk(e,t,r,n){return{id:e,width:t,height:r,baseRgb:n,masks:[],layers:[],guides:[],selectedGuideId:null,selectedMaskId:"",selectedLayerId:"",selectedMaskItemId:null,transform:{rotationDeg:0,crop:null},history:[{id:Rl("history"),label:"Initialize PS Document",timestamp:Date.now()}],historyIndex:0}}function JE(e){const t=new Float32Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r]/65535;return t}function KN(e){const t=new Float32Array(e.width*e.height*3),r=e.data;for(let n=0,a=0;n<r.length;n+=4,a+=3)t[a]=mx(r[n]/255),t[a+1]=mx(r[n+1]/255),t[a+2]=mx(r[n+2]/255);return t}async function QE(e){const t=e.naturalWidth||e.width,r=e.naturalHeight||e.height,n=document.createElement("canvas");n.width=t,n.height=r;const a=n.getContext("2d");if(!a)throw new Error("Failed to create 2D context for raster-to-float conversion.");a.drawImage(e,0,0,t,r);const i=a.getImageData(0,0,t,r);return{width:t,height:r,data:KN(i)}}function Yv(e){const t=Rl("mask"),r=Rl("layer"),n={id:t,name:`Mask ${e.masks.length+1}`,shape:"full",width:e.width,height:e.height,alpha:new Float32Array(e.width*e.height),version:1,featherPx:0,visible:!0,overlayVisible:!0,items:[]},a={id:r,name:`Layer ${e.layers.length+1}`,maskId:t,blendMode:"add",enabled:!0,opacity:1,basic:HN(),mixer:Xv(),curves:Hv()};return{...e,masks:[...e.masks,n],layers:[...e.layers,a],selectedMaskId:t,selectedLayerId:r,selectedMaskItemId:null}}function YN(e,t){if(!e.masks.some(o=>o.id===t))return e;const n=e.layers.find(o=>o.maskId===t);if(n)return{...e,selectedMaskId:t,selectedLayerId:n.id,selectedMaskItemId:null};const a=Rl("layer"),i={id:a,name:`Layer ${e.layers.length+1}`,maskId:t,blendMode:"add",enabled:!0,opacity:1,basic:HN(),mixer:Xv(),curves:Hv()};return{...e,layers:[...e.layers,i],selectedMaskId:t,selectedLayerId:a,selectedMaskItemId:null}}function e8(e,t){const r=(e.width-1)*.5,n=(e.height-1)*.5,a=Math.max(8,e.width*.4),i=Math.max(8,e.height*.4),o={id:Rl("guide"),orientation:t,p1:t==="horizontal"?{x:r-a*.5,y:n}:{x:r,y:n-i*.5},p2:t==="horizontal"?{x:r+a*.5,y:n}:{x:r,y:n+i*.5},visible:!0};return{...e,guides:[...e.guides,o],selectedGuideId:o.id}}function t8(e,t){return t===null?{...e,selectedGuideId:null}:e.guides.some(n=>n.id===t)?{...e,selectedGuideId:t}:e}function Wk(e,t,r,n){const a=s=>({x:Math.max(0,Math.min(e.width-1,s.x)),y:Math.max(0,Math.min(e.height-1,s.y))});let i=!1;const o=e.guides.map(s=>{if(s.id!==t)return s;const l=a(r),u=a(n);return Math.abs(l.x-s.p1.x)<1e-6&&Math.abs(l.y-s.p1.y)<1e-6&&Math.abs(u.x-s.p2.x)<1e-6&&Math.abs(u.y-s.p2.y)<1e-6?s:(i=!0,{...s,p1:l,p2:u})});return i?{...e,guides:o}:e}function r8(e,t){const r=e.guides.filter(n=>n.id!==t);return r.length===e.guides.length?e:{...e,guides:r,selectedGuideId:e.selectedGuideId===t?null:e.selectedGuideId}}function n8(e,t,r=0,n="add"){var d;const a=e.selectedMaskId?e:Yv(e),i=a.selectedMaskId;if(!i)return a;const o=a.masks.map(f=>{if(f.id!==i)return f;const h=f.items||[],p={id:Rl("item"),name:`Ellipse ${h.filter(b=>b.type==="ellipse").length+1}`,type:"ellipse",mode:n,visible:!0,center:{x:t.center.x,y:t.center.y},radiusX:Math.max(1,t.radiusX),radiusY:Math.max(1,t.radiusY),rotationDeg:t.rotationDeg??0,featherPx:Math.max(0,r)},x=[...h,p];return{...f,shape:"ellipse",items:x,alpha:Kv({...f,items:x}),version:f.version+1}}),s=o.find(f=>f.id===i),l=(s==null?void 0:s.items)||[],u=((d=l[l.length-1])==null?void 0:d.id)||null;return{...a,masks:o,selectedMaskItemId:u}}function a8(e,t,r,n,a,i,o=1){const s=e.selectedMaskId?e:Yv(e);if(!s.selectedMaskId)return s;const l=Math.max(1,n),u=jr(a),d=jr(o),f=l,h=l*(1+d*1.5),p=h*h,x=s.masks.map(g=>{if(g.id!==s.selectedMaskId)return g;const b=g.alpha,y=Math.max(0,Math.floor(t-h)),m=Math.max(0,Math.floor(r-h)),k=Math.min(g.width-1,Math.ceil(t+h)),S=Math.min(g.height-1,Math.ceil(r+h));for(let w=m;w<=S;w++){const v=w*g.width;for(let M=y;M<=k;M++){const N=M-t,_=w-r,P=N*N+_*_;if(P>p)continue;const E=Math.sqrt(P);let R=1;if(E>f){const C=Math.max(1e-6,h-f);R=jr((h-E)/C)}const T=jr(u*R),G=v+M,L=b[G];b[G]=i==="add"?L+(1-L)*T:L*(1-T)}}return{...g,alpha:b,version:g.version+1}});return{...s,masks:x}}function i8(e,t,r,n,a,i){var d;if(!e.selectedMaskId||t.length===0)return e;const o=e.masks.map(f=>{if(f.id!==e.selectedMaskId)return f;const h=f.items||[],p=t.map(k=>({x:k.x,y:k.y})),x=Math.max(1,r),g=jr(n),b=jr(i),y=h[h.length-1];if(y&&y.type==="brush"&&u8(y,{points:p,sizePx:x,opacity:g,mode:a,feather:b})){const k=y.points[y.points.length-1],S=p.filter((v,M)=>M!==0||Math.hypot(v.x-k.x,v.y-k.y)>.5),w={...y,points:[...y.points,...S]};return{...f,shape:"brush",items:[...h.slice(0,-1),w]}}const m={id:Rl("item"),name:`Brush ${h.filter(k=>k.type==="brush").length+1}`,type:"brush",mode:a,visible:!0,sizePx:x,opacity:g,feather:b,points:p};return{...f,shape:"brush",items:[...h,m]}}),s=o.find(f=>f.id===e.selectedMaskId),l=(s==null?void 0:s.items)||[],u=((d=l[l.length-1])==null?void 0:d.id)||null;return{...e,masks:o,selectedMaskItemId:u}}function o8(e,t){if(!t)return{...e,selectedMaskItemId:null};const r=e.selectedMaskId?e.masks.find(i=>i.id===e.selectedMaskId):null;if(r&&(r.items||[]).some(i=>i.id===t))return{...e,selectedMaskItemId:t};const n=e.masks.find(i=>(i.items||[]).some(o=>o.id===t));return n?{...YN(e,n.id),selectedMaskItemId:t}:{...e,selectedMaskItemId:null}}function s8(e,t,r){if(!e.selectedMaskId)return e;let n=!1;const a=e.masks.map(i=>{if(i.id!==e.selectedMaskId)return i;const o=(i.items||[]).map(s=>s.id!==t||s.type!=="ellipse"?s:(n=!0,{...s,...r,center:r.center?{x:r.center.x,y:r.center.y}:s.center,radiusX:r.radiusX!==void 0?Math.max(1,r.radiusX):s.radiusX,radiusY:r.radiusY!==void 0?Math.max(1,r.radiusY):s.radiusY,featherPx:r.featherPx!==void 0?Math.max(0,r.featherPx):s.featherPx}));return n?{...i,items:o,alpha:Kv({...i,items:o}),version:i.version+1}:i});return n?{...e,masks:a}:e}function l8(e,t,r){let n=!1;const a=e.masks.map(i=>i.id!==t||(i.overlayVisible??!0)===r?i:(n=!0,{...i,overlayVisible:r}));return n?{...e,masks:a}:e}const Gd=(e,t)=>[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]],c8=e=>{const t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],o=e[5],s=e[6],l=e[7],u=e[8],d=i*u-o*l,f=-(a*u-o*s),h=a*l-i*s,p=-(r*u-n*l),x=t*u-n*s,g=-(t*l-r*s),b=r*o-n*i,y=-(t*o-n*a),m=t*i-r*a,k=t*d+r*f+n*h;if(Math.abs(k)<1e-12)return null;const S=1/k;return[d*S,p*S,b*S,f*S,x*S,y*S,h*S,g*S,m*S]},ba=(e,t)=>{const r=t.x,n=t.y,a=e[6]*r+e[7]*n+e[8];return Math.abs(a)<1e-12?{x:0,y:0}:{x:(e[0]*r+e[1]*n+e[2])/a,y:(e[3]*r+e[4]*n+e[5])/a}},u8=(e,t)=>{if(e.mode!==t.mode||Math.abs(e.sizePx-t.sizePx)>.25||Math.abs(e.opacity-t.opacity)>.02||Math.abs(e.feather-t.feather)>.02||e.points.length===0||t.points.length===0)return!1;const r=e.points[e.points.length-1],n=t.points[0],a=Math.hypot(r.x-n.x,r.y-n.y),i=Math.max(4,Math.min(e.sizePx,t.sizePx)*1.5);return a<=i},d8=(e,t)=>{const r=e.rotationDeg*Math.PI/180,n=Math.cos(r),a=Math.sin(r),i=-a,o=n,s=e.center,l={x:s.x+n*e.radiusX,y:s.y+a*e.radiusX},u={x:s.x+i*e.radiusY,y:s.y+o*e.radiusY},d=ba(t,s),f=ba(t,l),h=ba(t,u),p=Math.max(1,Math.hypot(f.x-d.x,f.y-d.y)),x=Math.max(1,Math.hypot(h.x-d.x,h.y-d.y)),g=Math.atan2(f.y-d.y,f.x-d.x)*180/Math.PI;return{...e,center:d,radiusX:p,radiusY:x,rotationDeg:g}},gs=(e,t,r,n,a,i,o=0)=>{if(n<0||a<0||n>t-1||a>r-1)return 0;const s=Math.floor(n),l=Math.floor(a),u=Math.min(t-1,s+1),d=Math.min(r-1,l+1),f=n-s,h=a-l,p=(S,w)=>i===1?w*t+S:(w*t+S)*3+o,x=e[p(s,l)],g=e[p(u,l)],b=e[p(s,d)],y=e[p(u,d)],m=x*(1-f)+g*f,k=b*(1-f)+y*f;return m*(1-h)+k*h},qN=(e,t,r)=>{const a=[{x:0,y:0},{x:e-1,y:0},{x:e-1,y:t-1},{x:0,y:t-1}].map(s=>ba(r,s)),i=a.map(s=>s.x),o=a.map(s=>s.y);return{minX:Math.min(...i),maxX:Math.max(...i),minY:Math.min(...o),maxY:Math.max(...o)}},ZN=(e,t)=>{const r=qN(e.width,e.height,t),n=-r.minX,a=-r.minY,o=Gd([1,0,n,0,1,a,0,0,1],t),s=c8(o);if(!s)return e;const l=Math.max(1,Math.ceil(r.maxX-r.minX+1)),u=Math.max(1,Math.ceil(r.maxY-r.minY+1)),d=new Float32Array(l*u*3);for(let p=0;p<u;p++)for(let x=0;x<l;x++){const g=ba(s,{x,y:p}),b=(p*l+x)*3;d[b]=gs(e.baseRgb,e.width,e.height,g.x,g.y,3,0),d[b+1]=gs(e.baseRgb,e.width,e.height,g.x,g.y,3,1),d[b+2]=gs(e.baseRgb,e.width,e.height,g.x,g.y,3,2)}const f=e.masks.map(p=>{const x=new Float32Array(l*u);for(let b=0;b<u;b++)for(let y=0;y<l;y++){const m=ba(s,{x:y,y:b});x[b*l+y]=gs(p.alpha,p.width,p.height,m.x,m.y,1)}const g=(p.items||[]).map(b=>b.type==="brush"?{...b,points:b.points.map(y=>ba(o,y)).filter(y=>y.x>=0&&y.y>=0&&y.x<=l-1&&y.y<=u-1)}:d8(b,o)).filter(b=>b.type==="ellipse"?b.center.x>=-Math.max(b.radiusX,b.radiusY)&&b.center.y>=-Math.max(b.radiusX,b.radiusY)&&b.center.x<=l-1+Math.max(b.radiusX,b.radiusY)&&b.center.y<=u-1+Math.max(b.radiusX,b.radiusY):b.points.length>0);return{...p,width:l,height:u,alpha:x,version:p.version+1,featherPx:0,items:g}}),h=e.guides.map(p=>({...p,p1:ba(o,p.p1),p2:ba(o,p.p2)}));return{...e,width:l,height:u,baseRgb:d,masks:f,guides:h,selectedMaskItemId:f.some(p=>(p.items||[]).some(x=>x.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}},f8=(e,t,r,n,a,i)=>{let o=0,s=1;const l=t.x-e.x,u=t.y-e.y,d=(f,h)=>{if(Math.abs(f)<1e-12)return h>=0;const p=h/f;return f<0?p>s?!1:(p>o&&(o=p),!0):p<o?!1:(p<s&&(s=p),!0)};return!d(-l,e.x-r)||!d(l,a-e.x)||!d(-u,e.y-n)||!d(u,i-e.y)?null:{p1:{x:e.x+o*l,y:e.y+o*u},p2:{x:e.x+s*l,y:e.y+s*u}}};function JN(e,t){const r=Math.max(0,Math.min(e.width-1,Math.floor(t.x))),n=Math.max(0,Math.min(e.height-1,Math.floor(t.y))),a=Math.max(r+1,Math.min(e.width,Math.ceil(t.x+t.w))),i=Math.max(n+1,Math.min(e.height,Math.ceil(t.y+t.h))),o=a-r,s=i-n;if(o===e.width&&s===e.height&&r===0&&n===0)return e;const l=new Float32Array(o*s*3);for(let f=0;f<s;f++)for(let h=0;h<o;h++){const p=((f+n)*e.width+(h+r))*3,x=(f*o+h)*3;l[x]=e.baseRgb[p],l[x+1]=e.baseRgb[p+1],l[x+2]=e.baseRgb[p+2]}const u=e.masks.map(f=>{const h=new Float32Array(o*s);for(let x=0;x<s;x++)for(let g=0;g<o;g++)h[x*o+g]=f.alpha[(x+n)*f.width+(g+r)];const p=(f.items||[]).map(x=>x.type==="brush"?{...x,points:x.points.map(g=>({x:g.x-r,y:g.y-n})).filter(g=>g.x>=0&&g.y>=0&&g.x<=o-1&&g.y<=s-1)}:{...x,center:{x:x.center.x-r,y:x.center.y-n}}).filter(x=>x.type==="ellipse"?x.center.x>=-Math.max(x.radiusX,x.radiusY)&&x.center.y>=-Math.max(x.radiusX,x.radiusY)&&x.center.x<=o-1+Math.max(x.radiusX,x.radiusY)&&x.center.y<=s-1+Math.max(x.radiusX,x.radiusY):x.points.length>0);return{...f,width:o,height:s,alpha:h,version:f.version+1,featherPx:0,items:p}}),d=e.guides.map(f=>{const h=f8(f.p1,f.p2,r,n,a-1,i-1);return h?{...f,p1:{x:h.p1.x-r,y:h.p1.y-n},p2:{x:h.p2.x-r,y:h.p2.y-n}}:null}).filter(Boolean);return{...e,width:o,height:s,baseRgb:l,masks:u,guides:d,selectedGuideId:d.some(f=>f.id===e.selectedGuideId)?e.selectedGuideId:null,selectedMaskItemId:u.some(f=>(f.items||[]).some(h=>h.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}}function QN(e,t){const r=t*Math.PI/180,n=Math.cos(r),a=Math.sin(r),i=(e.width-1)*.5,o=(e.height-1)*.5,s=[1,0,-i,0,1,-o,0,0,1],l=[n,-a,0,a,n,0,0,0,1],d=Gd([1,0,i,0,1,o,0,0,1],Gd(l,s)),f=qN(e.width,e.height,d),h=Gd([1,0,-f.minX,0,1,-f.minY,0,0,1],d),p=ZN(e,d),x=p.masks.map(g=>{const b=e.masks.find(m=>m.id===g.id);if(!b)return g;const y=(b.items||[]).map(m=>m.type==="brush"?{...m,points:m.points.map(k=>ba(h,k)).filter(k=>k.x>=0&&k.y>=0&&k.x<=p.width-1&&k.y<=p.height-1)}:{...m,center:ba(h,m.center),rotationDeg:m.rotationDeg+t}).filter(m=>m.type==="ellipse"?!0:m.points.length>0);return{...g,items:y}});return{...p,masks:x,selectedMaskItemId:x.some(g=>(g.items||[]).some(b=>b.id===e.selectedMaskItemId))?e.selectedMaskItemId:null}}function e_(e){const t=e.width,r=e.height,n=new Float32Array(e.baseRgb.length);for(let i=0;i<r;i++)for(let o=0;o<t;o++){const s=t-1-o,l=(i*t+s)*3,u=(i*t+o)*3;n[u]=e.baseRgb[l],n[u+1]=e.baseRgb[l+1],n[u+2]=e.baseRgb[l+2]}const a=e.masks.map(i=>{const o=new Float32Array(i.alpha.length);for(let s=0;s<r;s++)for(let l=0;l<t;l++)o[s*t+l]=i.alpha[s*t+(t-1-l)];return{...i,alpha:o,version:i.version+1,items:(i.items||[]).map(s=>s.type==="brush"?{...s,points:s.points.map(l=>({x:t-1-l.x,y:l.y}))}:{...s,center:{x:t-1-s.center.x,y:s.center.y},rotationDeg:-s.rotationDeg})}});return{...e,baseRgb:n,masks:a,guides:e.guides.map(i=>({...i,p1:{x:t-1-i.p1.x,y:i.p1.y},p2:{x:t-1-i.p2.x,y:i.p2.y}}))}}function t_(e){const t=e.width,r=e.height,n=new Float32Array(e.baseRgb.length);for(let i=0;i<r;i++){const o=r-1-i;for(let s=0;s<t;s++){const l=(o*t+s)*3,u=(i*t+s)*3;n[u]=e.baseRgb[l],n[u+1]=e.baseRgb[l+1],n[u+2]=e.baseRgb[l+2]}}const a=e.masks.map(i=>{const o=new Float32Array(i.alpha.length);for(let s=0;s<r;s++){const l=r-1-s;for(let u=0;u<t;u++)o[s*t+u]=i.alpha[l*t+u]}return{...i,alpha:o,version:i.version+1,items:(i.items||[]).map(s=>s.type==="brush"?{...s,points:s.points.map(l=>({x:l.x,y:r-1-l.y}))}:{...s,center:{x:s.center.x,y:r-1-s.center.y},rotationDeg:-s.rotationDeg})}});return{...e,baseRgb:n,masks:a,guides:e.guides.map(i=>({...i,p1:{x:i.p1.x,y:r-1-i.p1.y},p2:{x:i.p2.x,y:r-1-i.p2.y}}))}}function r_(e,t){const r=e.width,n=e.height;if(r<=1||n<=1)return e;const a=(r-1)*.5,i=(n-1)*.5,o=Math.max(1e-6,Math.hypot(a,i)),s=t.model,l=Number.isFinite(Number(t.k1))?Number(t.k1):0,u=Number.isFinite(Number(t.k2))?Number(t.k2):0,d=Number.isFinite(Number(t.a))?Number(t.a):0,f=Number.isFinite(Number(t.b))?Number(t.b):0,h=Number.isFinite(Number(t.c))?Number(t.c):0,p=S=>{const w=Math.max(0,S);if(s==="poly3")return l*w*w*w+(1-l)*w;if(s==="poly5"){const _=w*w;return w*(1+l*_+u*_*_)}const v=w*w,M=v*w,N=M*w;return d*N+f*M+h*v+(1-d-f-h)*w},x=S=>{const w=Math.max(0,S);if(w<=1e-8)return 0;let v=w;for(let M=0;M<8;M++){const N=p(v)-w;if(Math.abs(N)<1e-7)break;const _=1e-4,P=p(v+_),E=p(Math.max(0,v-_)),R=(P-E)/(2*_);if(!Number.isFinite(R)||Math.abs(R)<1e-8)break;if(v-=N/R,!Number.isFinite(v))return w;v=Math.max(0,Math.min(4,v))}return v},g=S=>{const w=S.x-a,v=S.y-i,M=Math.hypot(w,v)/o;if(M<=1e-8)return{x:a,y:i};const _=x(M)/M;return{x:a+w*_,y:i+v*_}},b=S=>{const w=S.rotationDeg*Math.PI/180,v=Math.cos(w),M=Math.sin(w),N=-M,_=v,P=S.center,E={x:P.x+v*S.radiusX,y:P.y+M*S.radiusX},R={x:P.x+N*S.radiusY,y:P.y+_*S.radiusY},T=g(P),G=g(E),L=g(R),C=Math.max(1,Math.hypot(G.x-T.x,G.y-T.y)),$=Math.max(1,Math.hypot(L.x-T.x,L.y-T.y)),A=Math.atan2(G.y-T.y,G.x-T.x)*180/Math.PI;return{...S,center:T,radiusX:C,radiusY:$,rotationDeg:A}},y=new Float32Array(e.baseRgb.length);for(let S=0;S<n;S++)for(let w=0;w<r;w++){const v=w-a,M=S-i,N=Math.hypot(v,M)/o,_=p(N),P=N>1e-8?_/N:1,E=a+v*P,R=i+M*P,T=(S*r+w)*3;y[T]=gs(e.baseRgb,r,n,E,R,3,0),y[T+1]=gs(e.baseRgb,r,n,E,R,3,1),y[T+2]=gs(e.baseRgb,r,n,E,R,3,2)}const m=e.masks.map(S=>{const w=new Float32Array(S.alpha.length);for(let M=0;M<n;M++)for(let N=0;N<r;N++){const _=N-a,P=M-i,E=Math.hypot(_,P)/o,R=p(E),T=E>1e-8?R/E:1,G=a+_*T,L=i+P*T;w[M*r+N]=gs(S.alpha,r,n,G,L,1)}const v=(S.items||[]).map(M=>M.type==="brush"?{...M,points:M.points.map(g).filter(N=>N.x>=0&&N.y>=0&&N.x<=r-1&&N.y<=n-1)}:b(M)).filter(M=>M.type==="ellipse"?M.center.x>=-Math.max(M.radiusX,M.radiusY)&&M.center.y>=-Math.max(M.radiusX,M.radiusY)&&M.center.x<=r-1+Math.max(M.radiusX,M.radiusY)&&M.center.y<=n-1+Math.max(M.radiusX,M.radiusY):M.points.length>0);return{...S,alpha:w,version:S.version+1,items:v,featherPx:0}}),k=e.guides.map(S=>({...S,p1:g(S.p1),p2:g(S.p2)}));return{...e,baseRgb:y,masks:m,guides:k,selectedMaskItemId:m.some(S=>(S.items||[]).some(w=>w.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}}const Ph=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],z0=(e,t)=>Ph([e.x,e.y,1],[t.x,t.y,1]),s1=(e,t)=>{const r=Math.hypot(e,t);return r<1e-8?null:{x:e/r,y:t/r}},Vk=e=>{if(e.length===0)return null;let t=0,r=0;for(const n of e)t*n.x+r*n.y<0?(t-=n.x,r-=n.y):(t+=n.x,r+=n.y);return s1(t,r)};function n_(e){const t=e.guides.filter(N=>N.visible!==!1&&N.orientation==="horizontal").slice(0,2),r=e.guides.filter(N=>N.visible!==!1&&N.orientation==="vertical").slice(0,2);if(t.length<2||r.length<2)return e;const n=z0(t[0].p1,t[0].p2),a=z0(t[1].p1,t[1].p2),i=z0(r[0].p1,r[0].p2),o=z0(r[1].p1,r[1].p2),s=Ph(n,a),l=Ph(i,o),u=Ph(s,l);if(Math.abs(u[2])<1e-12)return e;const d=u[0]/u[2],f=u[1]/u[2],h=[1,0,0,0,1,0,d,f,1],p=t.map(N=>{const _=ba(h,N.p1),P=ba(h,N.p2);return s1(P.x-_.x,P.y-_.y)}).filter(Boolean),x=r.map(N=>{const _=ba(h,N.p1),P=ba(h,N.p2);return s1(P.x-_.x,P.y-_.y)}).filter(Boolean),g=Vk(p),b=Vk(x);if(!g||!b)return e;const y=g.x*b.y-g.y*b.x;if(Math.abs(y)<1e-8)return e;const m=1/y,k=b.y*m,S=-b.x*m,w=-g.y*m,v=g.x*m;return ZN(e,Gd([k,S,0,w,v,0,0,0,1],h))}function h8(e,t,r){const n=Math.max(e,t,r),a=Math.min(e,t,r),i=(n+a)/2;if(n===a)return[0,0,i];const o=n-a,s=i>.5?o/(2-n-a):o/(n+a);let l=0;switch(n){case e:l=(t-r)/o+(t<r?6:0);break;case t:l=(r-e)/o+2;break;default:l=(e-t)/o+4;break}return l/=6,[l,s,i]}function gx(e,t,r){let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function p8(e,t,r){if(t===0)return[r,r,r];const n=r<.5?r*(1+t):r+t-r*t,a=2*r-n;return[gx(a,n,e+1/3),gx(a,n,e),gx(a,n,e-1/3)]}const m8=[0,30,60,120,180,240,285,320],a_=e=>{const t=[],r=[],n=[];let a=!1;for(const i of KE){const o=e[i];t.push(o.hue),r.push(o.saturation),n.push(o.luminance),(Math.abs(o.hue)>1e-6||Math.abs(o.saturation)>1e-6||Math.abs(o.luminance)>1e-6)&&(a=!0)}return{hue:t,saturation:r,luminance:n,hasAdjust:a}},Hk=(e,t,r)=>{if(Math.abs(t-e)<1e-9)return r<e?0:1;const n=jr((r-e)/(t-e));return n*n*(3-2*n)},dc=(e,t,r)=>{const n=Math.max(-1,Math.min(1,t)),a=jr(r);return n>=0?e+(1-e)*n*a:e+e*n*a};function i_(e,t,r,n,a,i){let o=e,s=t,l=r;if(n.exposure!==0){const y=Math.pow(2,n.exposure);o*=y,s*=y,l*=y}if(n.temperature!==0||n.tint!==0){const y=n.temperature/100,m=n.tint/100;o*=1+.18*y+.08*m,s*=1-.16*m,l*=1-.18*y+.08*m}if(n.contrast!==0){const y=1+n.contrast/100;o=(o-.5)*y+.5,s=(s-.5)*y+.5,l=(l-.5)*y+.5}if(n.highlights!==0||n.shadows!==0){const y=jr(o*.2126+s*.7152+l*.0722),m=Hk(.5,1,y),k=1-Hk(0,.5,y);if(n.highlights!==0){const S=n.highlights/100;o=dc(o,S,m),s=dc(s,S,m),l=dc(l,S,m)}if(n.shadows!==0){const S=n.shadows/100;o=dc(o,S,k),s=dc(s,S,k),l=dc(l,S,k)}}if(n.vibrance!==0||n.saturation!==0||a.hasAdjust){let[y,m,k]=h8(jr(o),jr(s),jr(l));if(n.vibrance!==0){const S=n.vibrance/100;m=S>=0?jr(m+S*(1-m)):jr(m+S*m)}if(n.saturation!==0&&(m=jr(m+n.saturation/100)),a.hasAdjust){const S=(y%1+1)%1*360;let w=0,v=0,M=0,N=0;for(let _=0;_<8;_++){const P=m8[_];let E=Math.abs(S-P);E>180&&(E=360-E);const R=jr(1-E/45);R<=0||(w+=R,v+=R*a.hue[_],M+=R*a.saturation[_],N+=R*a.luminance[_])}if(w>1e-6){const _=jr((m-.03)/.25),P=1/w,E=v*P/100*(45/360)*_;y=(y+E)%1,y<0&&(y+=1),m=jr(m+M*P/100*_),k=jr(k+N*P/100*_)}}[o,s,l]=p8(y,m,k)}const d=Math.max(0,o*.2126+s*.7152+l*.0722),f=Math.min(255,Math.max(0,Math.round(jr(d)*255))),h=i.master[f],p=d>1e-6?h/d:1,x=jr(o*p),g=jr(s*p),b=jr(l*p);return o=i.red[Math.min(255,Math.max(0,Math.round(x*255)))],s=i.green[Math.min(255,Math.max(0,Math.round(g*255)))],l=i.blue[Math.min(255,Math.max(0,Math.round(b*255)))],[o,s,l]}function l1(e){const t=new Float32Array(e.baseRgb),r=new Map,n=new Map,a=e.width*e.height;for(const s of e.layers)s.enabled&&r.set(s.maskId,s);for(const s of e.masks){const l=r.get(s.id);if(!l||!l.enabled||!s.visible)continue;const u=Qc(l.basic),d=eu(l.mixer),f=a_(d),h=Om(l.curves),p=`${l.id}:${JSON.stringify(h)}`;let x=n.get(p);x||(x={master:da(h.master),red:da(h.red),green:da(h.green),blue:da(h.blue)},n.set(p,x));const g=s.alpha,b=jr(l.opacity);for(let y=0;y<a;y++){const m=jr(g[y]*b);if(m<=0)continue;const k=y*3,S=t[k],w=t[k+1],v=t[k+2],[M,N,_]=i_(S,w,v,u,f,x),P=l.blendMode==="subtract"?2*S-M:M,E=l.blendMode==="subtract"?2*w-N:N,R=l.blendMode==="subtract"?2*v-_:_;t[k]=S*(1-m)+P*m,t[k+1]=w*(1-m)+E*m,t[k+2]=v*(1-m)+R*m}}const i=new ImageData(e.width,e.height),o=i.data;for(let s=0,l=0;s<a;s++,l+=3){const u=s*4;o[u]=Math.round(Bc(t[l])*255),o[u+1]=Math.round(Bc(t[l+1])*255),o[u+2]=Math.round(Bc(t[l+2])*255),o[u+3]=255}return i}function g8(e,t,r){if(t.width!==e.width||t.height!==e.height)return l1(e);const n=Math.max(0,Math.floor(r.x0)),a=Math.max(0,Math.floor(r.y0)),i=Math.min(e.width-1,Math.ceil(r.x1)),o=Math.min(e.height-1,Math.ceil(r.y1));if(i<n||o<a)return t;const s=new Uint8ClampedArray(t.data),l=new ImageData(s,e.width,e.height),u=l.data,d=new Map,f=new Map;for(const p of e.layers)p.enabled&&d.set(p.maskId,p);const h=[];for(const p of e.masks){const x=d.get(p.id);if(!x||!x.enabled||!p.visible)continue;const g=Qc(x.basic),b=eu(x.mixer),y=a_(b),m=Om(x.curves),k=`${x.id}:${JSON.stringify(m)}`;let S=f.get(k);S||(S={master:da(m.master),red:da(m.red),green:da(m.green),blue:da(m.blue)},f.set(k,S)),h.push({mask:p,layer:x,alpha:p.alpha,opacity:jr(x.opacity),basic:g,mixerArrays:y,lutPack:S})}for(let p=a;p<=o;p++){const x=p*e.width;for(let g=n;g<=i;g++){const b=x+g,y=b*3;let m=e.baseRgb[y],k=e.baseRgb[y+1],S=e.baseRgb[y+2];for(const v of h){const M=jr(v.alpha[b]*v.opacity);if(M<=0)continue;const[N,_,P]=i_(m,k,S,v.basic,v.mixerArrays,v.lutPack),E=v.layer.blendMode==="subtract"?2*m-N:N,R=v.layer.blendMode==="subtract"?2*k-_:_,T=v.layer.blendMode==="subtract"?2*S-P:P;m=m*(1-M)+E*M,k=k*(1-M)+R*M,S=S*(1-M)+T*M}const w=b*4;u[w]=Math.round(Bc(m)*255),u[w+1]=Math.round(Bc(k)*255),u[w+2]=Math.round(Bc(S)*255),u[w+3]=255}}return l}const Xk=[{id:"red",label:"Red",color:"#ef4444"},{id:"orange",label:"Orange",color:"#fb923c"},{id:"yellow",label:"Yellow",color:"#facc15"},{id:"green",label:"Green",color:"#22c55e"},{id:"aqua",label:"Aqua",color:"#14b8a6"},{id:"blue",label:"Blue",color:"#3b82f6"},{id:"purple",label:"Purple",color:"#8b5cf6"},{id:"magenta",label:"Magenta",color:"#d946ef"}],xx={exposure:0,temperature:0,tint:0,contrast:0,highlights:0,shadows:0,vibrance:0,saturation:0},yx={red:{hue:0,saturation:0,luminance:0},orange:{hue:0,saturation:0,luminance:0},yellow:{hue:0,saturation:0,luminance:0},green:{hue:0,saturation:0,luminance:0},aqua:{hue:0,saturation:0,luminance:0},blue:{hue:0,saturation:0,luminance:0},purple:{hue:0,saturation:0,luminance:0},magenta:{hue:0,saturation:0,luminance:0}},x8=e=>{const t=[...e].sort((l,u)=>l.x-u.x),r=t.length,n=t.map(l=>l.x),a=t.map(l=>l.y);if(r<2)return l=>r===1?a[0]:0;const i=new Array(r-1).fill(0);for(let l=0;l<r-1;l++){const u=n[l+1]-n[l],d=a[l+1]-a[l];i[l]=u!==0?d/u:0}const o=new Array(r).fill(0);o[0]=i[0],o[r-1]=i[r-2];for(let l=1;l<r-1;l++)i[l-1]*i[l]<=0?o[l]=0:o[l]=(i[l-1]+i[l])/2;for(let l=0;l<r-1;l++){if(i[l]===0){o[l]=0,o[l+1]=0;continue}const u=o[l]/i[l],d=o[l+1]/i[l],f=u*u+d*d;if(f>9){const h=3/Math.sqrt(f);o[l]=h*u*i[l],o[l+1]=h*d*i[l]}}const s=(l,u)=>{const d=n[l],f=n[l+1],h=a[l],p=a[l+1],x=f-d;if(x<=0)return h;const g=(u-d)/x,b=g*g,y=b*g,m=2*y-3*b+1,k=y-2*b+g,S=-2*y+3*b,w=y-b;return Math.max(0,Math.min(1,m*h+k*x*o[l]+S*p+w*x*o[l+1]))};return l=>{if(l<=n[0])return a[0];if(l>=n[r-1])return a[r-1];let u=0;for(;u<r-2&&l>n[u+1];)u++;return s(u,l)}},y8=({channel:e,points:t,onChange:r})=>{const n=j.useRef(null),[a,i]=j.useState(null),[o,s]=j.useState(()=>[...t].sort((g,b)=>g.x-b.x)),l=j.useRef(o),u=g=>{l.current=g,s(g)};j.useEffect(()=>{if(a!==null)return;const g=[...t].sort((b,y)=>b.x-y.x);u(g)},[t,a]);const d=j.useMemo(()=>[...o].sort((g,b)=>g.x-b.x),[o]),f=j.useMemo(()=>{if(d.length<2)return"";const g=x8(d);let b=`M ${d[0].x*256} ${256-d[0].y*256}`;for(let y=1;y<=120;y++){const m=y/120,k=g(m);b+=` L ${m*256} ${256-k*256}`}return b},[d]),h=g=>{if(!n.current)return{x:0,y:0};const b=n.current.getBoundingClientRect();return{x:Math.max(0,Math.min(1,(g.clientX-b.left)/b.width)),y:Math.max(0,Math.min(1,1-(g.clientY-b.top)/b.height))}},p=g=>{if(a!==null)return;const b=h(g);if(d.some(m=>Math.abs(m.x-b.x)<.04))return;const y=[...d,b].sort((m,k)=>m.x-k.x);u(y),r(y)};j.useEffect(()=>{const g=y=>{if(a===null)return;const m=h(y),k=[...l.current].sort((M,N)=>M.x-N.x);let S=0,w=1;a>0&&(S=k[a-1].x+.01),a<k.length-1&&(w=k[a+1].x-.01),a===0?m.x=0:a===k.length-1?m.x=1:m.x=Math.max(S,Math.min(w,m.x));const v=[...k];v[a]=m,u(v)},b=()=>{if(a!==null){const y=[...l.current].sort((m,k)=>m.x-k.x);r(y)}i(null)};return a!==null&&(window.addEventListener("mousemove",g),window.addEventListener("mouseup",b)),()=>{window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",b)}},[a,r,d]);const x=e==="master"?"#94a3b8":e==="red"?"#ef4444":e==="green"?"#22c55e":"#3b82f6";return c.jsx("div",{className:"w-full aspect-square bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded relative select-none",children:c.jsxs("svg",{ref:n,width:"100%",height:"100%",viewBox:"0 0 256 256",className:"cursor-crosshair",onMouseDown:p,children:[c.jsx("path",{d:"M64,0 v256 M128,0 v256 M192,0 v256",stroke:"rgba(128,128,128,0.2)",strokeDasharray:"4 4"}),c.jsx("path",{d:"M0,64 h256 M0,128 h256 M0,192 h256",stroke:"rgba(128,128,128,0.2)",strokeDasharray:"4 4"}),c.jsx("line",{x1:"0",y1:"256",x2:"256",y2:"0",stroke:"rgba(128,128,128,0.1)"}),c.jsx("path",{d:f,fill:"none",stroke:x,strokeWidth:"2"}),d.map((g,b)=>c.jsx("circle",{cx:g.x*256,cy:256-g.y*256,r:a===b?6:4,fill:x,stroke:"white",strokeWidth:"1.5",className:"cursor-pointer",onMouseDown:y=>{y.stopPropagation(),y.preventDefault(),i(b)},onDoubleClick:y=>{if(y.stopPropagation(),b===0||b===d.length-1)return;const m=d.filter((k,S)=>S!==b);u(m),r(m)}},b))]})})},ji=({value:e,min:t,max:r,step:n,className:a,onPreview:i,onCommit:o,resetValue:s=0})=>{const[l,u]=j.useState(e),d=j.useRef(!1),f=j.useRef(e);j.useEffect(()=>{d.current||(u(e),f.current=e)},[e]);const h=()=>{const x=Math.max(t,Math.min(r,l)),g=f.current;d.current=!1,Math.abs(x-g)>1e-9&&o(x),f.current=x},p=()=>{const x=Math.max(t,Math.min(r,s)),g=d.current?f.current:e;d.current=!1,u(x),i==null||i(x),Math.abs(x-g)>1e-9&&o(x),f.current=x};return c.jsx("input",{type:"range",min:t,max:r,step:n,value:l,onChange:x=>{const g=Number(x.target.value);u(g),i==null||i(g)},onPointerDown:()=>{d.current=!0,f.current=e},onPointerUp:h,onPointerCancel:h,onMouseUp:h,onTouchEnd:h,onBlur:h,onDoubleClick:p,className:a})},b8=({inline:e=!1,doc:t,brushEnabled:r,brushSize:n,brushOpacity:a,brushFeather:i,ellipseFeather:o,brushMode:s,onAddMask:l,onAddEllipseMask:u,onCancelEllipseTool:d,onSelectLayer:f,onSelectMask:h,onBindLayerMask:p,onSetLayerBlendMode:x,onSetLayerOpacity:g,onSetLayerBasic:b,onSetLayerMixer:y,onPreviewLayerBasic:m,onPreviewLayerMixer:k,onSetLayerCurves:S,onSelectMaskItem:w,onUpdateEllipseItem:v,onSetMaskOverlayVisible:M,onBrushEnabledChange:N,onBrushSizeChange:_,onBrushOpacityChange:P,onBrushFeatherChange:E,onEllipseFeatherChange:R,onBrushModeChange:T})=>{var Pe,Fe,Ue;const[G,L]=j.useState("master"),[C,$]=j.useState("orange"),[A,O]=j.useState(null),[F,D]=j.useState(!1),[W,H]=j.useState(!1),Y=e?"w-full p-2 bg-white dark:bg-black border border-gray-300 dark:border-slate-700 text-xs":"absolute top-3 right-3 z-40 w-80 max-h-[90%] overflow-y-auto p-3 bg-white/95 dark:bg-black/95 border-2 border-black dark:border-white shadow-[6px_6px_0px_rgba(0,0,0,0.6)] text-xs";if(!t)return c.jsx("div",{className:e?"w-full p-2 bg-white dark:bg-black border border-gray-300 dark:border-slate-700":"absolute top-3 right-3 z-40 w-80 p-3 bg-white/90 dark:bg-black/90 border-2 border-black dark:border-white",children:c.jsx("p",{className:"text-xs font-bold",children:"PS document not ready."})});const te=t.masks.find(K=>K.id===t.selectedMaskId)||null,U=te&&t.layers.find(K=>K.maskId===te.id)||null,Se=((Pe=te==null?void 0:te.items)==null?void 0:Pe.find(K=>K.id===t.selectedMaskItemId))||null,re=Se&&Se.type==="ellipse"?Se:null,J=Om(U==null?void 0:U.curves),ne=(U==null?void 0:U.basic)||xx,ie=((U==null?void 0:U.mixer)||yx)[C]||{hue:0,saturation:0,luminance:0};j.useEffect(()=>{L("master"),$("orange")},[U==null?void 0:U.id]),j.useEffect(()=>{te&&O(te.id)},[te==null?void 0:te.id]);const se=(K,_e,Te)=>{b(K.id,{...K.basic||xx,[_e]:Te})},oe=(K,_e,Te)=>{m==null||m(K.id,{...K.basic||xx,[_e]:Te})},ke=(K,_e,Te,Le)=>{const ft=K.mixer||yx;y(K.id,{...ft,[_e]:{...ft[_e]||{hue:0,saturation:0,luminance:0},[Te]:Le}})},le=(K,_e,Te,Le)=>{const ft=K.mixer||yx;k==null||k(K.id,{...ft,[_e]:{...ft[_e]||{hue:0,saturation:0,luminance:0},[Te]:Le}})},fe=K=>{U&&S(U.id,{...J,[G]:K})};return c.jsxs("div",{className:Y,children:[c.jsx("div",{className:"font-bold mb-2",children:"PS Masks"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[c.jsx("button",{onClick:l,className:"px-2 py-1 bg-cyan-600 text-white font-bold border border-black",children:"+ Mask"}),c.jsx("button",{onClick:()=>{const K=!F;D(K),N(K)},className:`px-2 py-1 font-bold border border-black ${F?"bg-white text-black":"bg-emerald-600 text-white"}`,children:"+ Brush"}),c.jsx("button",{onClick:()=>{const K=!W;H(K),K?u():d()},className:`px-2 py-1 font-bold border border-black ${W?"bg-white text-black":"bg-violet-600 text-white"}`,children:"+ Ellipse"})]}),W&&c.jsxs("label",{className:"block mb-3",children:[c.jsxs("span",{className:"block mb-1",children:["New Ellipse Feather ",Math.round(o)," px"]}),c.jsx("input",{type:"range",min:0,max:256,step:1,value:o,onChange:K=>R(Number(K.target.value)),className:"w-full"})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"font-semibold mb-1",children:"Masks"}),c.jsxs("div",{className:"space-y-1 max-h-52 overflow-auto border border-gray-300 dark:border-slate-700 p-1",children:[t.masks.map(K=>c.jsxs("div",{className:"border border-gray-300 dark:border-slate-700",children:[c.jsxs("div",{className:"flex",children:[c.jsx("button",{onClick:()=>O(A===K.id?null:K.id),className:"w-7 px-1 py-1 border-r border-gray-300 dark:border-slate-700 bg-gray-100 dark:bg-slate-800",title:A===K.id?"Collapse mask":"Expand mask",children:A===K.id?"v":">"}),c.jsx("button",{onClick:()=>h(K.id),className:`flex-1 text-left px-2 py-1 ${t.selectedMaskId===K.id?"bg-emerald-100 dark:bg-emerald-900/40":"bg-white dark:bg-slate-900"}`,children:K.name}),c.jsx("button",{onClick:()=>M(K.id,!(K.overlayVisible??!0)),className:`px-2 py-1 border-l border-gray-300 dark:border-slate-700 text-[11px] font-bold ${K.overlayVisible??!0?"bg-rose-100 dark:bg-rose-900/40 text-rose-700 dark:text-rose-300":"bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-slate-400"}`,title:"Toggle red mask overlay",children:"Eye"})]}),A===K.id&&c.jsxs("div",{className:"p-1 border-t border-gray-300 dark:border-slate-700 space-y-1 bg-gray-50 dark:bg-slate-900/40",children:[(K.items||[]).map(_e=>c.jsxs("button",{onClick:()=>w(_e.id),className:`w-full text-left px-2 py-1 border text-[11px] ${t.selectedMaskId===K.id&&t.selectedMaskItemId===_e.id?"bg-violet-100 dark:bg-violet-900/40 border-violet-500":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-700"}`,children:[(_e.type==="brush",_e.name)," (",_e.mode==="add"?"Add":"Subtract",")"]},_e.id)),(K.items||[]).length===0&&c.jsx("div",{className:"px-2 py-1 text-[11px] text-gray-500",children:"No brush/ellipse items."})]})]},K.id)),t.masks.length===0&&c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No masks yet."})]})]}),F&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Brush"}),c.jsx("div",{className:"grid grid-cols-1 gap-2 mb-2",children:c.jsxs("select",{value:s,onChange:K=>T(K.target.value),className:"border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Paint Add"}),c.jsx("option",{value:"subtract",children:"Paint Subtract"})]})}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Size ",n,"px"]}),c.jsx("input",{type:"range",min:1,max:200,step:1,value:n,onChange:K=>_(Number(K.target.value)),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Opacity ",a.toFixed(2)]}),c.jsx("input",{type:"range",min:.01,max:1,step:.01,value:a,onChange:K=>P(Number(K.target.value)),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("span",{className:"block mb-1",children:["Feather ",Math.round(i*100),"%"]}),c.jsx("input",{type:"range",min:0,max:1,step:.01,value:i,onChange:K=>E(Number(K.target.value)),className:"w-full"})]})]}),re&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Selected Ellipse"}),c.jsxs("label",{className:"block mb-2",children:[c.jsx("span",{className:"block mb-1",children:"Mode"}),c.jsxs("select",{value:re.mode,onChange:K=>v(re.id,{mode:K.target.value}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Add"}),c.jsx("option",{value:"subtract",children:"Subtract"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Center X"}),c.jsx("input",{type:"number",step:1,value:re.center.x,onChange:K=>v(re.id,{center:{...re.center,x:Number(K.target.value)}}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Center Y"}),c.jsx("input",{type:"number",step:1,value:re.center.y,onChange:K=>v(re.id,{center:{...re.center,y:Number(K.target.value)}}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Radius X"}),c.jsx("input",{type:"number",min:1,step:1,value:re.radiusX,onChange:K=>v(re.id,{radiusX:Number(K.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Radius Y"}),c.jsx("input",{type:"number",min:1,step:1,value:re.radiusY,onChange:K=>v(re.id,{radiusY:Number(K.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Rotation ",re.rotationDeg.toFixed(1)," deg"]}),c.jsx("input",{type:"range",min:-180,max:180,step:.1,value:re.rotationDeg,onChange:K=>v(re.id,{rotationDeg:Number(K.target.value)}),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("span",{className:"block mb-1",children:["Feather ",Math.round(re.featherPx)," px"]}),c.jsx("input",{type:"range",min:0,max:512,step:1,value:re.featherPx,onChange:K=>v(re.id,{featherPx:Number(K.target.value)}),className:"w-full"})]})]}),U&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Mask Adjustment"}),c.jsxs("label",{className:"block mb-2",children:[c.jsx("span",{className:"block mb-1",children:"Blend"}),c.jsxs("select",{value:U.blendMode,onChange:K=>x(U.id,K.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Add"}),c.jsx("option",{value:"subtract",children:"Subtract"})]})]}),c.jsxs("div",{className:"mb-2 text-[11px] text-gray-500",children:["Bound Mask: ",c.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:((Fe=t.masks.find(K=>K.id===U.maskId))==null?void 0:Fe.name)||"None"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Opacity ",U.opacity.toFixed(2)]}),c.jsx("input",{type:"range",min:0,max:1,step:.01,value:U.opacity,onChange:K=>g(U.id,Number(K.target.value)),className:"w-full"})]}),c.jsxs("div",{className:"mt-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Basic"}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Exposure"}),c.jsx("span",{className:"text-[11px]",children:ne.exposure.toFixed(2)})]}),c.jsx(ji,{value:ne.exposure,min:-5,max:5,step:.01,onPreview:K=>oe(U,"exposure",K),onCommit:K=>se(U,"exposure",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Temperature"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.temperature)})]}),c.jsx(ji,{value:ne.temperature,min:-100,max:100,step:1,onPreview:K=>oe(U,"temperature",K),onCommit:K=>se(U,"temperature",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Tint (G/M)"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.tint)})]}),c.jsx(ji,{value:ne.tint,min:-100,max:100,step:1,onPreview:K=>oe(U,"tint",K),onCommit:K=>se(U,"tint",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Contrast"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.contrast)})]}),c.jsx(ji,{value:ne.contrast,min:-100,max:100,step:1,onPreview:K=>oe(U,"contrast",K),onCommit:K=>se(U,"contrast",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Highlights"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.highlights)})]}),c.jsx(ji,{value:ne.highlights,min:-100,max:100,step:1,onPreview:K=>oe(U,"highlights",K),onCommit:K=>se(U,"highlights",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Shadows"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.shadows)})]}),c.jsx(ji,{value:ne.shadows,min:-100,max:100,step:1,onPreview:K=>oe(U,"shadows",K),onCommit:K=>se(U,"shadows",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Vibrance"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.vibrance)})]}),c.jsx(ji,{value:ne.vibrance,min:-100,max:100,step:1,onPreview:K=>oe(U,"vibrance",K),onCommit:K=>se(U,"vibrance",K),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Saturation"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.saturation)})]}),c.jsx(ji,{value:ne.saturation,min:-100,max:100,step:1,onPreview:K=>oe(U,"saturation",K),onCommit:K=>se(U,"saturation",K),className:"w-full"})]})]}),c.jsxs("div",{className:"mt-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Color Mixer"}),c.jsx("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:Xk.map(K=>c.jsx("button",{onClick:()=>$(K.id),className:`w-5 h-5 rounded-full border-2 ${C===K.id?"border-black dark:border-white scale-110":"border-gray-500 dark:border-slate-500"} transition-transform`,style:{backgroundColor:K.color},title:K.label},K.id))}),c.jsxs("div",{className:"text-[11px] text-gray-500 mb-2",children:["Band: ",(Ue=Xk.find(K=>K.id===C))==null?void 0:Ue.label]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Hue"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ie.hue)})]}),c.jsx(ji,{value:ie.hue,min:-100,max:100,step:1,onPreview:K=>le(U,C,"hue",K),onCommit:K=>ke(U,C,"hue",K),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Saturation"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ie.saturation)})]}),c.jsx(ji,{value:ie.saturation,min:-100,max:100,step:1,onPreview:K=>le(U,C,"saturation",K),onCommit:K=>ke(U,C,"saturation",K),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Luminance"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ie.luminance)})]}),c.jsx(ji,{value:ie.luminance,min:-100,max:100,step:1,onPreview:K=>le(U,C,"luminance",K),onCommit:K=>ke(U,C,"luminance",K),className:"w-full"})]})]}),c.jsxs("div",{className:"mt-3",children:[c.jsx("div",{className:"font-semibold mb-1",children:"Layer Curves"}),c.jsx("div",{className:"flex gap-1 mb-2",children:["master","red","green","blue"].map(K=>c.jsx("button",{onClick:()=>L(K),className:`flex-1 py-1 text-[11px] font-bold uppercase rounded transition-colors ${G===K?"bg-slate-700 text-white":"bg-gray-200 dark:bg-slate-800 text-gray-600 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-slate-700"}`,children:K==="master"?"Luma":K},K))}),c.jsx(y8,{channel:G,points:J[G],onChange:fe}),c.jsx("div",{className:"text-[10px] text-gray-400 mt-1 text-center",children:"Click add, drag move, double-click remove."})]})]}),!U&&te&&c.jsx("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2 text-[11px] text-gray-500",children:"No adjustment layer bound to this mask."})]})},tu={"Canon EOS R5":"0.9766 -0.2953 -0.1254 -0.4276 1.2116 0.2433 -0.0437 0.1336 0.5131","Canon EOS 7D Mark II":"0.7268 -0.1082 -0.0969 -0.4186 1.1839 0.2663 -0.0825 0.2029 0.5839","Canon EOS R3":"0.9423 -0.2839 -0.1195 -0.4532 1.2377 0.2415 -0.0483 0.1374 0.5276","Canon EOS 5D Mark III":"0.6722 -0.0635 -0.0963 -0.4287 1.246 0.2028 -0.0908 0.2162 0.5668","Canon EOS 5DS R":"0.625 -0.0711 -0.0808 -0.5153 1.2794 0.2636 -0.1249 0.2198 0.561","Canon EOS R6":"0.8293 -0.1611 -0.1132 -0.4759 1.2711 0.2275 -0.1013 0.2415 0.5509","Samsung NX U":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Canon EOS R5 Mark II":"0.9396 -0.2598 -0.1207 -0.4408 1.2296 0.2369 -0.0505 0.1575 0.6077","Canon EOS 5DS":"0.625 -0.0711 -0.0808 -0.5153 1.2794 0.2636 -0.1249 0.2198 0.561","Canon EOS R":"0.8293 -0.1789 -0.1094 -0.5025 1.2925 0.2327 -0.1199 0.2769 0.6108","Canon EOS R6 Mark II":"0.9539 -0.2795 -0.1224 -0.4175 1.1998 0.2458 -0.0465 0.1755 0.6048","Canon EOS R7":"1.0424 -0.3138 -0.13 -0.4221 1.1938 0.2584 -0.0547 0.1658 0.6183","Canon EOS 5D Mark IV":"0.6446 -0.0366 -0.0864 -0.4436 1.2204 0.2513 -0.0952 0.2496 0.6348","Canon EOS-1D X Mark III":"0.8971 -0.2022 -0.1242 -0.5405 1.3249 0.238 -0.128 0.2483 0.6072","Sony ILCE-7M3":"0.7374 -0.2389 -0.0551 -0.5435 1.3162 0.2519 -0.1006 0.1795 0.6552","Hasselblad 50-15-Coated5":"0.5002 -0.0878 0.0111 -0.4856 1.1929 0.3338 -0.1183 0.2041 0.7022","Canon EOS-1D X":"0.6847 -0.0614 -0.1014 -0.4669 1.2737 0.2139 -0.1197 0.2488 0.6846","Fujifilm GFX 100":"1.6212 -0.8423 -0.1583 -0.4336 1.2583 0.1937 -0.0195 0.0726 0.6199","Phase One IQ180":"0.6294 0.0686 -0.0712 -0.5435 1.3417 0.2211 -0.1006 0.2435 0.5042","Phase One IQ3 100MP":"0.2423 0 0 0 0.9901 0 0 0 0.7989","Canon EOS-1D X Mark II":"0.7596 -0.0978 -0.0967 -0.4808 1.2571 0.2503 -0.1398 0.2567 0.5752","Canon PowerShot Pro70":"-0.5106 1.0695 0.1576 0.382 0.0053 0.4566 -0.6497 1.0736 0.6701 -0.3336 1.1887 0.1394","Sony ILCE-9":"0.6389 -0.1703 -0.0378 -0.4562 1.2265 0.2587 -0.067 0.1489 0.655","Sony ILCE-7CR":"0.82 -0.2976 -0.0719 -0.4296 1.2053 0.2532 -0.0429 0.1282 0.5774","Sony ILCE-7S":"0.5838 -0.143 -0.0246 -0.3497 1.1477 0.2297 -0.0748 0.1885 0.5778","Sony ILCE-7RM3":"0.664 -0.1847 -0.0503 -0.5238 1.301 0.2474 -0.0993 0.1673 0.6527","Sony DSC-RX1RM3":"0.9034 -0.349 -0.0777 -0.4004 1.1841 0.2448 -0.0484 0.1352 0.5552","Sony ILCE-6100":"0.7657 -0.2847 -0.0607 -0.4083 1.1966 0.2389 -0.0684 0.1418 0.5844","Sony ILCE-7RM2":"0.6629 -0.19 -0.0483 -0.4618 1.2349 0.255 -0.0622 0.1381 0.6514","Sony ILCE-5100":"0.5991 -0.1456 -0.0455 -0.4764 1.2135 0.298 -0.0707 0.1425 0.6701","Sony ILCE-7M2":"0.5271 -0.0712 -0.0347 -0.6153 1.3653 0.2763 -0.1601 0.2366 0.7242","Sony ILCE-7RM5":"0.82 -0.2976 -0.0719 -0.4296 1.2053 0.2532 -0.0429 0.1282 0.5774","Sony ILCA-77M2":"0.5991 -0.1732 -0.0443 -0.41 1.1989 0.2381 -0.0704 0.1467 0.5992","Sony ZV-1M2":"0.828 -0.2987 -0.0703 -0.3531 1.1645 0.2133 -0.055 0.1542 0.5312","Sony ILCE-7SM2":"0.5838 -0.143 -0.0246 -0.3497 1.1477 0.2297 -0.0748 0.1885 0.5778","Sony DSC-RX100M7":"1.0315 -0.439 -0.0937 -0.4859 1.2734 0.2365 -0.0734 0.1537 0.5997","Sony ILCE-6300":"0.5973 -0.1695 -0.0419 -0.3826 1.1797 0.2293 -0.0639 0.1398 0.5789","Sony ILCA-99M2":"0.666 -0.1918 -0.0471 -0.4613 1.2398 0.2485 -0.0649 0.1433 0.6447","Sony ILCE-9M3":"0.9811 -0.3908 -0.0752 -0.3704 1.1577 0.2417 -0.0073 0.095 0.598","Sony ILCE-9M2":"0.6389 -0.1703 -0.0378 -0.4562 1.2265 0.2587 -0.067 0.1489 0.655","Sony DSC-RX100M6":"0.7325 -0.2321 -0.0596 -0.3494 1.1674 0.2055 -0.0668 0.1562 0.5031","Sony ZV-E10M2":"0.6972 -0.2408 -0.06 -0.433 1.2101 0.2515 -0.0388 0.1277 0.5847","Sony DSC-RX100M4":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","Sony ILCE-7SM3":"0.6912 -0.2127 -0.0469 -0.447 1.2175 0.2587 -0.0398 0.1478 0.6492","Sony ILCE-7":"0.5271 -0.0712 -0.0347 -0.6153 1.3653 0.2763 -0.1601 0.2366 0.7242","Sony ILCE-6000":"0.5991 -0.1456 -0.0455 -0.4764 1.2135 0.298 -0.0707 0.1425 0.6701","Sony ILCE-1":"0.8161 -0.2947 -0.0739 -0.4811 1.2668 0.2389 -0.0437 0.1229 0.6524","Sony ILCE-7M4":"0.746 -0.2365 -0.0588 -0.5687 1.3442 0.2474 -0.0624 0.1156 0.6584","Sony ILCE-7R":"0.4913 -0.0541 -0.0202 -0.613 1.3513 0.2906 -0.1564 0.2151 0.7183","Fujifilm X100VI":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-H2":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-A3":"1.2407 -0.5222 -0.1086 -0.2971 1.1116 0.212 -0.0294 0.1029 0.5284","Fujifilm X-H2S":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-Pro3":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-T50":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-T2":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T5":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-Pro2":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-A7":"1.5055 -0.7391 -0.1274 -0.4062 1.2071 0.2238 -0.061 0.1217 0.6147","Fujifilm X-H1":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-S20":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-S10":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-T30":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X30":"1.2328 -0.5256 -0.1144 -0.4469 1.2927 0.1675 -0.0087 0.1291 0.4351","Fujifilm GFX 50R":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X100V":"1.3717 -0.649 -0.1154 -0.4348 1.2266 0.2335 -0.069 0.1286 0.6134","Fujifilm X-A5":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm X100F":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T100":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm XQ1":"0.9252 -0.2704 -0.1064 -0.5893 1.4265 0.1717 -0.1101 0.2341 0.4349","Fujifilm X-T4":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-E3":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T20":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-A2":"1.0763 -0.456 -0.0917 -0.3346 1.1311 0.2322 -0.0475 0.1135 0.5843","Fujifilm GFX 50S":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X-A1":"1.1086 -0.4555 -0.0839 -0.3512 1.131 0.2517 -0.0815 0.1341 0.594","Fujifilm X70":"1.045 -0.4329 -0.0878 -0.3217 1.1105 0.2421 -0.0752 0.1758 0.6519","Fujifilm FinePix S1":"1.2297 -0.4882 -0.1202 -0.2106 1.0691 0.1623 -0.0088 0.1312 0.479","Fujifilm XQ2":"0.9252 -0.2704 -0.1064 -0.5893 1.4265 0.1717 -0.1101 0.2341 0.4349","Fujifilm X-E2":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm GFX 100RF":"1.2806 -0.5779 -0.111 -0.3546 1.1507 0.2318 -0.0177 0.0996 0.5715","Fujifilm X-T10":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm X-E5":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X100T":"1.0592 -0.4262 -0.1008 -0.3514 1.1355 0.2465 -0.087 0.2025 0.6386","Fujifilm X100S":"1.0592 -0.4262 -0.1008 -0.3514 1.1355 0.2465 -0.087 0.2025 0.6386","Fujifilm X-T3":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-M5":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-M1":"1.0413 -0.3996 -0.0993 -0.3721 1.164 0.2361 -0.0733 0.154 0.6011","Fujifilm X-T1":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm X20":"1.1768 -0.4971 -0.1133 -0.4904 1.2927 0.2183 -0.048 0.1723 0.4605","Fujifilm GFX 50S II":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X-Pro1":"1.0413 -0.3996 -0.0993 -0.3721 1.164 0.2361 -0.0733 0.154 0.6011","Fujifilm XF10":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm X-E2S":"1.1562 -0.5118 -0.0961 -0.3022 1.1007 0.2311 -0.0525 0.1569 0.6097","Nikon Coolpix P330":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P1000":"1.4294 -0.6116 -0.1333 -0.1628 1.0219 0.1637 -0.0014 0.1158 0.5022","Nikon Coolpix P340":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P7800":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P7700":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon 1 S2":"0.6612 -0.1342 -0.0618 -0.3338 1.1055 0.2623 -0.0174 0.1792 0.5075","Nikon D3300":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D3200":"0.7013 -0.1408 -0.0635 -0.5268 1.2902 0.264 -0.147 0.2801 0.7379","Nikon Z 8":"1.1423 -0.4564 -0.1123 -0.4816 1.2895 0.2119 -0.021 0.1061 0.7282","Nikon D810A":"1.1973 -0.5685 -0.0888 -0.1965 1.0326 0.1901 -0.0115 0.1123 0.7169","Nikon D5500":"0.8821 -0.2938 -0.0785 -0.4178 1.2142 0.2287 -0.0824 0.1651 0.686","Nikon Z 6 3":"1.1206 -0.4286 -0.0941 -0.4879 1.2847 0.2251 -0.0745 0.1654 0.7374","Nikon D750":"0.902 -0.289 -0.0715 -0.4535 1.2436 0.2348 -0.0934 0.1919 0.7086","Nikon Z 6":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon D500":"0.8813 -0.321 -0.1036 -0.4703 1.2868 0.2021 -0.1054 0.194 0.6129","Nikon D3400":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D5300":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D5600":"0.8821 -0.2938 -0.0785 -0.4178 1.2142 0.2287 -0.0824 0.1651 0.686","Nikon D780":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon Z 6 2":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon D5":"0.92 -0.3522 -0.0992 -0.5755 1.3803 0.2117 -0.0753 0.1486 0.6338","Nikon 1 J4":"0.5958 -0.1559 -0.0571 -0.4021 1.1453 0.2939 -0.0634 0.1548 0.5087","Nikon D800":"0.7866 -0.2108 -0.0555 -0.4869 1.2483 0.2681 -0.1176 0.2069 0.7501","Nikon 1 S1":"0.8994 -0.2667 -0.0865 -0.4594 1.2324 0.2552 -0.0699 0.1786 0.626","Nikon D850":"1.0405 -0.3755 -0.127 -0.5461 1.3787 0.1793 -0.104 0.2015 0.6785","Nikon 1 J3":"0.6588 -0.1305 -0.0693 -0.3277 1.0987 0.2634 -0.0355 0.2016 0.5106","Nikon D7200":"0.8322 -0.3112 -0.1047 -0.6367 1.4342 0.2179 -0.0988 0.1638 0.6394","Nikon Z 5":"0.8695 -0.2558 -0.0648 -0.5015 1.2711 0.2575 -0.1279 0.2215 0.7514","Nikon Z 50":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon Z 7 2":"1.3705 -0.6004 -0.14 -0.5464 1.3568 0.2062 -0.094 0.1706 0.7618","Nikon 1 J5":"0.752 -0.2518 -0.0645 -0.3844 1.2102 0.1945 -0.0913 0.2249 0.6835","Nikon Z 5 2":"1.3133 -0.5542 -0.128 -0.4325 1.2543 0.1972 0.0034 0.0792 0.7662","Nikon Z fc":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon Z f":"1.1607 -0.4491 -0.0977 -0.4522 1.246 0.2304 -0.0458 0.1519 0.7616","Nikon D610":"0.8178 -0.2245 -0.0609 -0.4857 1.2394 0.2776 -0.1207 0.2086 0.7298","Nikon Z 7":"1.3705 -0.6004 -0.14 -0.5464 1.3568 0.2062 -0.094 0.1706 0.7618","Nikon Df":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","Nikon 1 V3":"0.5958 -0.1559 -0.0571 -0.4021 1.1453 0.2939 -0.0634 0.1548 0.5087","Nikon D7000":"0.8198 -0.2239 -0.0724 -0.4871 1.2389 0.2798 -0.1043 0.205 0.7181","Nikon Z 9":"1.3389 -0.6049 -0.1441 -0.4544 1.2757 0.1969 0.0229 0.0498 0.739","Nikon Z 50 2":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon D4S":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","Nikon D810":"0.9369 -0.3195 -0.0791 -0.4488 1.243 0.2301 -0.0893 0.1796 0.6872","Nikon D4":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","DXO ONE":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","DXO-ONE":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","Nikon D800E":"0.7866 -0.2108 -0.0555 -0.4869 1.2483 0.2681 -0.1176 0.2069 0.7501","ZEISS ZX1":"1 -0.4766 -0.0938 -0.2969 1.1328 0.1875 -0.0313 0.1094 0.7422","PENTAX K-50":"0.8628 -0.2607 -0.1156 -0.3995 1.2301 0.1881 -0.099 0.1735 0.6595","PENTAX K-500":"0.8513 -0.2572 -0.114 -0.3995 1.2301 0.1881 -0.1003 0.1758 0.6683","PENTAX K-3 II":"0.8571 -0.259 -0.1148 -0.3995 1.2301 0.1881 -0.1052 0.1844 0.7013","PENTAX K-S2":"0.8009 -0.2517 -0.114 -0.3882 1.235 0.1689 -0.0844 0.1493 0.6312","PENTAX K-3":"0.8761 -0.2648 -0.1173 -0.3995 1.2301 0.1881 -0.0901 0.1579 0.6001","PENTAX KP":"0.7357 -0.2031 -0.132 -0.4842 1.3555 0.1349 -0.1538 0.2416 0.5736","PENTAX MX-1":"0.8804 -0.2523 -0.1238 -0.2423 1.1627 0.086 -0.0682 0.1774 0.4753","PENTAX K-70":"0.8117 -0.2078 -0.1275 -0.4359 1.2953 0.1515 -0.1096 0.1965 0.6073","PENTAX K-3 Mark III":"0.6842 -0.1581 -0.0867 -0.4614 1.2728 0.2065 -0.0639 0.1428 0.5682","PENTAX 645Z":"0.9829 -0.31 -0.1271 -0.3685 1.2133 0.1721 -0.1068 0.1977 0.6854","PENTAX K-1":"0.8566 -0.2746 -0.1201 -0.3612 1.2204 0.155 -0.0893 0.168 0.6264","PENTAX Q7":"1.2995 -0.5593 -0.1107 -0.1879 1.0139 0.2027 -0.0064 0.1233 0.4919","Canon PowerShot SX60 HS":"1.3161 -0.5451 -0.1344 -0.1989 1.0654 0.1531 -0.0047 0.1271 0.4955","Canon PowerShot G15":"0.7474 -0.2301 -0.0567 -0.4056 1.1456 0.2975 -0.0222 0.0716 0.4181","Canon PowerShot G5 X Mark II":"1.1629 -0.5713 -0.0914 -0.2706 1.109 0.1842 -0.0206 0.1225 0.5515","Canon PowerShot G16":"0.802 -0.2687 -0.0682 -0.3704 1.1879 0.2052 -0.0965 0.1921 0.5556","Canon PowerShot S120":"0.6961 -0.1685 -0.0695 -0.4625 1.2945 0.1836 -0.1114 0.2152 0.5518","Canon PowerShot G1 X":"0.7378 -0.1255 -0.1043 -0.4088 1.2251 0.2048 -0.0876 0.1946 0.5805","Canon EOS M5":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS M6":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon PowerShot G7 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G7 X Mark II":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G9 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G3 X":"0.9701 -0.3857 -0.0921 -0.3149 1.1537 0.1817 -0.0786 0.1817 0.5147","Canon EOS 6D Mark II":"0.6875 -0.097 -0.0932 -0.4691 1.2459 0.2501 -0.0874 0.1953 0.5809","Canon PowerShot G1 X Mark III":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon PowerShot G9 X Mark II":"1.0056 -0.4131 -0.0944 -0.2576 1.1143 0.1625 -0.0238 0.1294 0.5179","Canon EOS 200D":"0.7377 -0.0742 -0.0998 -0.4235 1.1981 0.2549 -0.0673 0.1918 0.5538","Canon EOS R10":"0.9269 -0.2012 -0.1107 -0.399 1.1762 0.2527 -0.0569 0.2093 0.4913","Canon PowerShot G5 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G1 X Mark II":"0.7378 -0.1255 -0.1043 -0.4088 1.2251 0.2048 -0.0876 0.1946 0.5805","Canon EOS M100":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS RP":"0.8608 -0.2097 -0.1178 -0.5425 1.3265 0.2383 -0.1149 0.2238 0.568","Canon EOS 7D":"0.6844 -0.0996 -0.0856 -0.3876 1.1761 0.2396 -0.0593 0.1772 0.6198","Canon EOS 90D":"1.1498 -0.3759 -0.1516 -0.5073 1.2954 0.2349 -0.0892 0.1867 0.6118","Canon PowerShot V1":"1.26 -0.4747 -0.2027 -0.611 1.5868 -0.0029 0.011 0.0479 0.6011","Canon EOS M3":"0.6362 -0.0823 -0.0847 -0.4426 1.2109 0.2616 -0.0743 0.1857 0.5635","Canon PowerShot G7 X Mark III":"1.1629 -0.5713 -0.0914 -0.2706 1.109 0.1842 -0.0206 0.1225 0.5515","Canon EOS M50":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS 80D":"0.7457 -0.0671 -0.0937 -0.4849 1.2495 0.2643 -0.1213 0.2354 0.5492","Canon EOS M200":"1.0463 -0.2173 -0.1437 -0.4856 1.2635 0.2482 -0.1216 0.2915 0.7237","Canon EOS R100":"0.823 -0.1515 -0.1032 -0.4179 1.2005 0.2454 -0.0649 0.2076 0.4711","Canon EOS 700D":"0.6602 -0.0841 -0.0939 -0.4472 1.2458 0.2247 -0.0975 0.2039 0.6148","Canon EOS 100D":"0.6602 -0.0841 -0.0939 -0.4472 1.2458 0.2247 -0.0975 0.2039 0.6148","Canon EOS M6 Mark II":"1.1498 -0.3759 -0.1516 -0.5073 1.2954 0.2349 -0.0892 0.1867 0.6118","Canon EOS 70D":"0.7034 -0.0804 -0.1014 -0.442 1.2564 0.2058 -0.0851 0.1994 0.5758","Canon EOS R8":"0.9539 -0.2795 -0.1224 -0.4175 1.1998 0.2458 -0.0465 0.1755 0.6048","Canon EOS 6D":"0.7034 -0.0804 -0.1014 -0.442 1.2564 0.2058 -0.0851 0.1994 0.5758","Canon EOS R50 V":"0.9089 -0.181 -0.1209 -0.4294 1.2116 0.2454 -0.0498 0.1862 0.4923","Canon EOS 77D":"0.7377 -0.0742 -0.0998 -0.4235 1.1981 0.2549 -0.0673 0.1918 0.5538","LEICA M10":"0.8249 -0.2849 -0.062 -0.5415 1.4756 0.0565 -0.0957 0.3074 0.6517","LEICA Q (Typ 116)":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA Q3 43":"1.1111 -0.3816 -0.1057 -0.375 1.2107 0.1829 -0.0947 0.1868 0.4645","LEICA Q2":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA SL (Typ 601)":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA D-Lux 8":"0.8585 -0.3127 -0.0833 -0.4005 1.225 0.1953 -0.065 0.1494 0.4862","LEICA T (Typ 701)":"0.5463 -0.0988 -0.0364 -0.4634 1.2036 0.2946 -0.0766 0.1389 0.6522","LEICA X (Typ 113)":"0.7712 -0.2059 -0.0653 -0.3882 1.1494 0.2726 -0.071 0.1332 0.5958","PENTAX K-1 Mark II":"0.8935 -0.2864 -0.1253 -0.3612 1.2204 0.155 -0.0905 0.1702 0.6346","Panasonic DMC-ZS40":"0.8607 -0.2822 -0.0808 -0.3755 1.193 0.2049 -0.082 0.206 0.5224","Panasonic DMC-CM1":"0.877 -0.3194 -0.082 -0.2871 1.1281 0.1803 -0.0513 0.1552 0.4434","Panasonic DC-G9":"0.7685 -0.2375 -0.0634 -0.3687 1.17 0.2249 -0.0748 0.1546 0.5111","Panasonic DMC-ZS50":"0.8802 -0.3135 -0.0789 -0.3151 1.1468 0.1904 -0.055 0.1745 0.481","Panasonic DMC-GX85":"0.7771 -0.302 -0.0629 -0.4029 1.195 0.2345 -0.0821 0.1977 0.6119","Panasonic DMC-LX9":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Panasonic DC-FZ80":"1.1532 -0.4324 -0.1066 -0.2375 1.0847 0.1749 -0.0564 0.1699 0.4351","Panasonic DMC-FZ300":"0.8378 -0.2798 -0.0769 -0.3068 1.141 0.1877 -0.0538 0.1792 0.4623","Panasonic DMC-GX8":"0.7564 -0.2263 -0.0606 -0.3148 1.1239 0.2177 -0.054 0.1435 0.4853","Panasonic DC-S1RM2":"0.9941 -0.4056 -0.0871 -0.3745 1.1604 0.2433 -0.0254 0.1132 0.5526","Panasonic DC-GH6":"0.7949 -0.3491 -0.071 -0.3435 1.1681 0.1977 -0.0503 0.1622 0.5065","Panasonic DC-S1":"0.9744 -0.3905 -0.0779 -0.4899 1.2807 0.2324 -0.0798 0.163 0.5827","Olympus E-M5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Panasonic DMC-ZS100":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Olympus E-M5 Mark II":"0.9422 -0.3258 -0.0711 -0.2655 1.0898 0.2015 -0.0512 0.1354 0.5512","Panasonic DC-GF9":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-GF7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Olympus PEN-F":"0.9476 -0.3182 -0.0765 -0.2613 1.0958 0.1893 -0.0449 0.1315 0.5268","Panasonic DC-S1H":"0.9397 -0.3719 -0.0805 -0.5425 1.3326 0.2309 -0.0972 0.1715 0.6034","Panasonic DMC-LX100":"0.8844 -0.3538 -0.0768 -0.3709 1.1762 0.22 -0.0698 0.1792 0.522","Panasonic DMC-FZ2500":"0.7386 -0.2443 -0.0743 -0.3437 1.1864 0.1757 -0.0608 0.166 0.4766","Panasonic DC-G99":"0.9657 -0.3963 -0.0748 -0.3361 1.1378 0.2258 -0.0568 0.1415 0.5158","Panasonic DC-LX100M2":"0.8585 -0.3127 -0.0833 -0.4005 1.225 0.1953 -0.065 0.1494 0.4862","Panasonic DC-S1R":"1.1822 -0.5321 -0.1249 -0.5958 1.5114 0.0766 -0.0614 0.1264 0.7043","Panasonic DC-G9M2":"0.8325 -0.3456 -0.0623 -0.433 1.2089 0.2528 -0.086 0.2646 0.5984","Panasonic DC-S9":"0.9983 -0.389 -0.0841 -0.418 1.2164 0.2263 -0.0249 0.1139 0.5766","Panasonic DC-ZS200":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Panasonic DC-GX9":"0.7564 -0.2263 -0.0606 -0.3148 1.1239 0.2177 -0.054 0.1435 0.4853","Panasonic DMC-G8":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-ZS60":"0.855 -0.2908 -0.0842 -0.3195 1.1529 0.1881 -0.0338 0.1603 0.4631","Panasonic DC-S1M2":"1.073 -0.4442 -0.0922 -0.4478 1.2504 0.2199 -0.038 0.1198 0.6039","Panasonic DC-GH5S":"0.6929 -0.2355 -0.0708 -0.4192 1.2534 0.1828 -0.1097 0.1989 0.5195","Panasonic DC-S5":"0.9744 -0.3905 -0.0779 -0.4899 1.2807 0.2324 -0.0798 0.163 0.5827","Panasonic DC-GH5M2":"0.93 -0.3659 -0.0755 -0.2981 1.0988 0.2287 -0.019 0.1077 0.5016","Panasonic DC-FZ1000M2":"0.9803 -0.4185 -0.0992 -0.4066 1.2578 0.1628 -0.0838 0.1824 0.5288","Panasonic DC-GH5":"0.7641 -0.2336 -0.0605 -0.3218 1.1299 0.2187 -0.0485 0.1338 0.5121","Panasonic DMC-GX7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-LX7":"1.0148 -0.3743 -0.0991 -0.2837 1.1366 0.1659 -0.0701 0.1893 0.4899","Panasonic DC-GH7":"0.8573 -0.3575 -0.0678 -0.4252 1.2079 0.2451 -0.0808 0.2524 0.5936","Panasonic DC-S5M2":"1.0308 -0.4206 -0.0783 -0.4088 1.2102 0.2229 -0.0125 0.1051 0.5912","Panasonic DMC-LF1":"0.9379 -0.3267 -0.0816 -0.3227 1.156 0.1881 -0.0926 0.1928 0.534","Panasonic DMC-G7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Olympus E-M1X":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","OM Digital Solutions OM-1":"0.9488 -0.3984 -0.0714 -0.2887 1.0945 0.2229 -0.0137 0.096 0.5786","Olympus E-M10":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M1 Mark III":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus TG-4":"1.1426 -0.4159 -0.1126 -0.2066 1.0678 0.1593 -0.012 0.1327 0.4998","Olympus E-P5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M10 Mark II":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M1":"0.7687 -0.1984 -0.0606 -0.4327 1.1928 0.2721 -0.1381 0.2339 0.6452","Olympus E-PL5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Panasonic DMC-GM1":"0.677 -0.1895 -0.0744 -0.5232 1.3145 0.2303 -0.1664 0.2691 0.5703","Panasonic DMC-GF6":"0.813 -0.2801 -0.0946 -0.352 1.1289 0.2552 -0.1314 0.2511 0.5791","Panasonic DMC-FZ1000":"0.783 -0.2696 -0.0763 -0.3325 1.1667 0.1866 -0.0641 0.1712 0.4824","Panasonic DMC-GH4":"0.7122 -0.2108 -0.0512 -0.3155 1.1201 0.2231 -0.0541 0.1423 0.5045","Panasonic DMC-GM5":"0.8238 -0.3244 -0.0679 -0.3921 1.1814 0.2384 -0.0836 0.2022 0.5852","OM Digital Solutions OM-5 Mark II":"1.2008 -0.523 -0.1123 -0.2265 1.0496 0.2046 0.0069 0.0734 0.4938",M1:"0.7712 -0.2059 -0.0653 -0.3882 1.1494 0.2726 -0.071 0.1332 0.5958","Olympus XZ-2":"0.9777 -0.3483 -0.0925 -0.2886 1.1297 0.18 -0.0602 0.1663 0.5134","Olympus E-M1 Mark II":"0.9383 -0.317 -0.0763 -0.2457 1.0702 0.202 -0.0384 0.1236 0.5552","Olympus E-PL7":"0.9197 -0.319 -0.0659 -0.2606 1.083 0.2039 -0.0458 0.125 0.5458","OM Digital Solutions OM-5":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus E-M5 Mark III":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus STYLUS 1":"0.836 -0.242 -0.088 -0.3928 1.2353 0.1739 -0.1381 0.2416 0.5173","RICOH GR IV":"0.6428 -0.1485 -0.0814 -0.4614 1.2728 0.2065 -0.0667 0.1489 0.5924","RICOH GR III":"0.6093 -0.1407 -0.0772 -0.4614 1.2728 0.2065 -0.0663 0.1481 0.5892","GR II":"0.4717 -0.085 -0.0431 -0.4977 1.2805 0.2417 -0.0641 0.1474 0.6143","Olympus E-M10 Mark III":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Samsung NX1":"1.0686 -0.4042 -0.1052 -0.3595 1.3238 0.0276 -0.0464 0.1259 0.5931","Samsung NX2000":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX500":"1.0686 -0.4042 -0.1052 -0.3595 1.3238 0.0276 -0.0464 0.1259 0.5931","Samsung NX300":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX30":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX mini":"0.5222 -0.1196 -0.055 -0.654 1.4649 0.2009 -0.1666 0.2819 0.5657","SIGMA fp L":"1.079 -0.2673 -0.228 -0.6718 1.5773 0.0854 -0.1473 0.2047 0.4597","sd Quattro H":"1.2907 0.0532 -0.3603 0.2957 0.7904 -0.0911 0.0255 0.7093 0.3228","Phase One IQ4 150MP":"0.6644 -0.2257 -0.0804 -0.6459 1.4562 0.2019 -0.1221 0.1876 0.6411","Sony ILCE-7RM4":"0.7662 -0.2686 -0.066 -0.524 1.2965 0.253 -0.0796 0.1508 0.6167","Fujifilm X-E4":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598"};function Ch(e,t,r,n=[0,0,0,0],a=65535,i="RGGB",o=null){const l=e*t*2,u=8,d=u+l,f="Fake",h="StretchedNoiseCam",p="StretchedNoiseCam",x=L=>{const C=new Uint8Array(L.length+1);for(let $=0;$<L.length;$++)C[$]=L.charCodeAt($);return C[L.length]=0,C},g=x(f),b=x(h),y=x(p),m=L=>{const C=[0,0,0,0],$={R:0,G:1,B:2},A=L.toUpperCase();for(let O=0;O<4;O++)C[O]=$[A[O]]??1;return C},k=L=>{const C=[];return L.forEach($=>{C.push(Math.round($*1e4)),C.push(1e4)}),C},S=[{id:254,type:4,count:1,value:0},{id:256,type:4,count:1,value:e},{id:257,type:4,count:1,value:t},{id:258,type:3,count:1,value:16},{id:259,type:3,count:1,value:1},{id:262,type:3,count:1,value:32803},{id:271,type:2,count:g.length,value:g},{id:272,type:2,count:b.length,value:b},{id:273,type:4,count:1,value:u},{id:277,type:3,count:1,value:1},{id:278,type:4,count:1,value:t},{id:279,type:4,count:1,value:l},{id:33421,type:3,count:2,value:[2,2]},{id:33422,type:1,count:4,value:m(i)},{id:50706,type:1,count:4,value:[1,4,0,0]},{id:50714,type:3,count:4,value:n.map(L=>Math.round(L))},{id:50715,type:4,count:1,value:Math.round(a)},{id:50717,type:2,count:y.length,value:y}];o&&o.length===9&&(S.push({id:50721,type:10,count:9,value:k(o)}),S.push({id:50778,type:3,count:1,value:21})),S.sort((L,C)=>L.id-C.id);const w=2+S.length*12+4;let v=0;const M=S.map(L=>{let C=1;L.type===3&&(C=2),L.type===4&&(C=4),(L.type===5||L.type===10)&&(C=8);const $=L.count*C,A=$<=4;let O=0;return A||(O=v,v+=$,v%2!==0&&v++),{...L,fits:A,totalBytes:$,extraOffset:O,typeSize:C}}),N=d+w,_=N+v,P=new ArrayBuffer(_),E=new DataView(P),R=new Uint8Array(P);E.setUint16(0,18761,!0),E.setUint16(2,42,!0),E.setUint32(4,d,!0);const T=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);R.set(T,u);let G=d;return E.setUint16(G,S.length,!0),G+=2,M.forEach(L=>{if(E.setUint16(G,L.id,!0),E.setUint16(G+2,L.type,!0),E.setUint32(G+4,L.count,!0),L.fits){const C=G+8;Array.isArray(L.value)?L.value.forEach(($,A)=>{L.type===1&&E.setUint8(C+A,$),L.type===3&&E.setUint16(C+A*2,$,!0)}):(L.type===3&&E.setUint16(C,L.value,!0),L.type===4&&E.setUint32(C,L.value,!0))}else{const C=N+L.extraOffset;E.setUint32(G+8,C,!0),L.value instanceof Uint8Array?R.set(L.value,C):Array.isArray(L.value)&&L.value.forEach(($,A)=>{L.type===1&&E.setUint8(C+A,$),L.type===2&&E.setUint8(C+A,$),L.type===3&&E.setUint16(C+A*2,$,!0),L.type===4&&E.setUint32(C+A*4,$,!0),(L.type===5||L.type===10)&&(L.type===10?E.setInt32(C+A*4,$,!0):E.setUint32(C+A*4,$,!0))})}G+=12}),E.setUint32(G,0,!0),P}var Tm=typeof self<"u"?self:global;const mf=typeof navigator<"u",v8=mf&&typeof HTMLImageElement>"u",np=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),Em=Tm.Buffer,W0=Tm.BigInt,Im=!!Em,w8=e=>e;function ap(e,t=w8){if(np)try{return typeof require=="function"?Promise.resolve(t(require(e))):import(e).then(t)}catch{console.warn(`Couldn't load ${e}`)}}let qv=Tm.fetch;const k8=e=>qv=e;if(!Tm.fetch){const e=ap("http",n=>n),t=ap("https",n=>n),r=(n,{headers:a}={})=>new Promise(async(i,o)=>{let{port:s,hostname:l,pathname:u,protocol:d,search:f}=new URL(n);const h={method:"GET",hostname:l,path:encodeURI(u)+f,headers:a};s!==""&&(h.port=Number(s));const p=(d==="https:"?await t:await e).request(h,x=>{if(x.statusCode===301||x.statusCode===302){let g=new URL(x.headers.location,n).toString();return r(g,{headers:a}).then(i).catch(o)}i({status:x.statusCode,arrayBuffer:()=>new Promise(g=>{let b=[];x.on("data",y=>b.push(y)),x.on("end",()=>g(Buffer.concat(b)))})})});p.on("error",o),p.end()});k8(r)}function Bt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const ip=e=>o_(e)?void 0:e,S8=e=>e!==void 0;function o_(e){return e===void 0||(e instanceof Map?e.size===0:Object.values(e).filter(S8).length===0)}function On(e){let t=new Error(e);throw delete t.stack,t}function hl(e){return(e=function(t){for(;t.endsWith("\0");)t=t.slice(0,-1);return t}(e).trim())===""?void 0:e}function c1(e){let t=function(r){let n=0;return r.ifd0.enabled&&(n+=1024),r.exif.enabled&&(n+=2048),r.makerNote&&(n+=2048),r.userComment&&(n+=1024),r.gps.enabled&&(n+=512),r.interop.enabled&&(n+=100),r.ifd1.enabled&&(n+=1024),n+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const u1=e=>String.fromCharCode.apply(null,e),Kk=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function s_(e){return Kk?Kk.decode(e):Im?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(u1(e)))}class Ta{static from(t,r){return t instanceof this&&t.le===r?t:new Ta(t,void 0,void 0,r)}constructor(t,r=0,n,a){if(typeof a=="boolean"&&(this.le=a),Array.isArray(t)&&(t=new Uint8Array(t)),t===0)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){n===void 0&&(n=t.byteLength-r);let i=new DataView(t,r,n);this._swapDataView(i)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof Ta){n===void 0&&(n=t.byteLength-r),(r+=t.byteOffset)+n>t.byteOffset+t.byteLength&&On("Creating view outside of available memory in ArrayBuffer");let i=new DataView(t.buffer,r,n);this._swapDataView(i)}else if(typeof t=="number"){let i=new DataView(new ArrayBuffer(t));this._swapDataView(i)}else On("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,r,n=Ta){return t instanceof DataView||t instanceof Ta?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||On("BufferView.set(): Invalid data argument."),this.toUint8().set(t,r),new n(this,r,t.byteLength)}subarray(t,r){return r=r||this._lengthToEnd(t),new Ta(this,t,r)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,r){return new Uint8Array(this.buffer,this.byteOffset+t,r)}getString(t=0,r=this.byteLength){return s_(this.getUint8Array(t,r))}getLatin1String(t=0,r=this.byteLength){let n=this.getUint8Array(t,r);return u1(n)}getUnicodeString(t=0,r=this.byteLength){const n=[];for(let a=0;a<r&&t+a<this.byteLength;a+=2)n.push(this.getUint16(t+a));return u1(n)}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,r=this.le){return this.dataView.getInt16(t,r)}getInt32(t,r=this.le){return this.dataView.getInt32(t,r)}getUint16(t,r=this.le){return this.dataView.getUint16(t,r)}getUint32(t,r=this.le){return this.dataView.getUint32(t,r)}getFloat32(t,r=this.le){return this.dataView.getFloat32(t,r)}getFloat64(t,r=this.le){return this.dataView.getFloat64(t,r)}getFloat(t,r=this.le){return this.dataView.getFloat32(t,r)}getDouble(t,r=this.le){return this.dataView.getFloat64(t,r)}getUintBytes(t,r,n){switch(r){case 1:return this.getUint8(t,n);case 2:return this.getUint16(t,n);case 4:return this.getUint32(t,n);case 8:return this.getUint64&&this.getUint64(t,n)}}getUint(t,r,n){switch(r){case 8:return this.getUint8(t,n);case 16:return this.getUint16(t,n);case 32:return this.getUint32(t,n);case 64:return this.getUint64&&this.getUint64(t,n)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}}function d1(e,t){On(`${e} '${t}' was not loaded, try using full build of exifr.`)}let Zv=class extends Map{constructor(t){super(),this.kind=t}get(t,r){return this.has(t)||d1(this.kind,t),r&&(t in r||function(n,a){On(`Unknown ${n} '${a}'.`)}(this.kind,t),r[t].enabled||d1(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}};var oo=new Zv("file parser"),Pn=new Zv("segment parser"),co=new Zv("file reader");function M8(e,t){return typeof e=="string"?Yk(e,t):mf&&!v8&&e instanceof HTMLImageElement?Yk(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new Ta(e):mf&&e instanceof Blob?f1(e,t,"blob",$l):void On("Invalid input argument")}function Yk(e,t){return(r=e).startsWith("data:")||r.length>1e4?h1(e,t,"base64"):np&&e.includes("://")?f1(e,t,"url",Dl):np?h1(e,t,"fs"):mf?f1(e,t,"url",Dl):void On("Invalid input argument");var r}async function f1(e,t,r,n){return co.has(r)?h1(e,t,r):n?async function(a,i){let o=await i(a);return new Ta(o)}(e,n):void On(`Parser ${r} is not loaded`)}async function h1(e,t,r){let n=new(co.get(r))(e,t);return await n.read(),n}const Dl=e=>qv(e).then(t=>t.arrayBuffer()),$l=e=>new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>t(n.result||new ArrayBuffer),n.onerror=r,n.readAsArrayBuffer(e)});class j8 extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function kn(e,t,r){let n=new j8;for(let[a,i]of r)n.set(a,i);if(Array.isArray(t))for(let a of t)e.set(a,n);else e.set(t,n);return n}function Ll(e,t,r){let n,a=e.get(t);for(n of r)a.set(n[0],n[1])}const Xn=new Map,Gi=new Map,Rs=new Map,xs=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Ru=["jfif","xmp","icc","iptc","ihdr"],Fl=["tiff",...Ru],gn=["ifd0","ifd1","exif","gps","interop"],ys=[...Fl,...gn],bs=["makerNote","userComment"],Du=["translateKeys","translateValues","reviveValues","multiSegment"],vs=[...Du,"sanitize","mergeOutput","silentErrors"];class l_{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class pd extends l_{get needed(){return this.enabled||this.deps.size>0}constructor(t,r,n,a){if(super(),Bt(this,"enabled",!1),Bt(this,"skip",new Set),Bt(this,"pick",new Set),Bt(this,"deps",new Set),Bt(this,"translateKeys",!1),Bt(this,"translateValues",!1),Bt(this,"reviveValues",!1),this.key=t,this.enabled=r,this.parse=this.enabled,this.applyInheritables(a),this.canBeFiltered=gn.includes(t),this.canBeFiltered&&(this.dict=Xn.get(t)),n!==void 0)if(Array.isArray(n))this.parse=this.enabled=!0,this.canBeFiltered&&n.length>0&&this.translateTagSet(n,this.pick);else if(typeof n=="object"){if(this.enabled=!0,this.parse=n.parse!==!1,this.canBeFiltered){let{pick:i,skip:o}=n;i&&i.length>0&&this.translateTagSet(i,this.pick),o&&o.length>0&&this.translateTagSet(o,this.skip)}this.applyInheritables(n)}else n===!0||n===!1?this.parse=this.enabled=n:On(`Invalid options argument: ${n}`)}applyInheritables(t){let r,n;for(r of Du)n=t[r],n!==void 0&&(this[r]=n)}translateTagSet(t,r){if(this.dict){let n,a,{tagKeys:i,tagValues:o}=this.dict;for(n of t)typeof n=="string"?(a=o.indexOf(n),a===-1&&(a=i.indexOf(Number(n))),a!==-1&&r.add(Number(i[a]))):r.add(n)}else for(let n of t)r.add(n)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,op(this.pick,this.deps)):this.enabled&&this.pick.size>0&&op(this.pick,this.deps)}}var ga={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},qk=new Map;let ql=class extends l_{static useCached(t){let r=qk.get(t);return r!==void 0||(r=new this(t),qk.set(t,r)),r}constructor(t){super(),t===!0?this.setupFromTrue():t===void 0?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):typeof t=="object"?this.setupFromObject(t):On(`Invalid options argument ${t}`),this.firstChunkSize===void 0&&(this.firstChunkSize=mf?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of xs)this[t]=ga[t];for(t of vs)this[t]=ga[t];for(t of bs)this[t]=ga[t];for(t of ys)this[t]=new pd(t,ga[t],void 0,this)}setupFromTrue(){let t;for(t of xs)this[t]=ga[t];for(t of vs)this[t]=ga[t];for(t of bs)this[t]=!0;for(t of ys)this[t]=new pd(t,!0,void 0,this)}setupFromArray(t){let r;for(r of xs)this[r]=ga[r];for(r of vs)this[r]=ga[r];for(r of bs)this[r]=ga[r];for(r of ys)this[r]=new pd(r,!1,void 0,this);this.setupGlobalFilters(t,void 0,gn)}setupFromObject(t){let r;for(r of(gn.ifd0=gn.ifd0||gn.image,gn.ifd1=gn.ifd1||gn.thumbnail,Object.assign(this,t),xs))this[r]=bx(t[r],ga[r]);for(r of vs)this[r]=bx(t[r],ga[r]);for(r of bs)this[r]=bx(t[r],ga[r]);for(r of Fl)this[r]=new pd(r,ga[r],t[r],this);for(r of gn)this[r]=new pd(r,ga[r],t[r],this.tiff);this.setupGlobalFilters(t.pick,t.skip,gn,ys),t.tiff===!0?this.batchEnableWithBool(gn,!0):t.tiff===!1?this.batchEnableWithUserValue(gn,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,gn):typeof t.tiff=="object"&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,gn)}batchEnableWithBool(t,r){for(let n of t)this[n].enabled=r}batchEnableWithUserValue(t,r){for(let n of t){let a=r[n];this[n].enabled=a!==!1&&a!==void 0}}setupGlobalFilters(t,r,n,a=n){if(t&&t.length){for(let o of a)this[o].enabled=!1;let i=Zk(t,n);for(let[o,s]of i)op(this[o].pick,s),this[o].enabled=!0}else if(r&&r.length){let i=Zk(r,n);for(let[o,s]of i)op(this[o].skip,s)}}filterNestedSegmentTags(){let{ifd0:t,exif:r,xmp:n,iptc:a,icc:i}=this;this.makerNote?r.deps.add(37500):r.skip.add(37500),this.userComment?r.deps.add(37510):r.skip.add(37510),n.enabled||t.skip.add(700),a.enabled||t.skip.add(33723),i.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:r,gps:n,interop:a}=this;a.needed&&(r.deps.add(40965),t.deps.add(40965)),r.needed&&t.deps.add(34665),n.needed&&t.deps.add(34853),this.tiff.enabled=gn.some(i=>this[i].enabled===!0)||this.makerNote||this.userComment;for(let i of gn)this[i].finalizeFilters()}get onlyTiff(){return!Ru.map(t=>this[t].enabled).some(t=>t===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of Fl)this[t].enabled&&!Pn.has(t)&&d1("segment parser",t)}};function Zk(e,t){let r,n,a,i,o=[];for(a of t){for(i of(r=Xn.get(a),n=[],r))(e.includes(i[0])||e.includes(i[1]))&&n.push(i[0]);n.length&&o.push([a,n])}return o}function bx(e,t){return e!==void 0?e:t!==void 0?t:void 0}function op(e,t){for(let r of t)e.add(r)}Bt(ql,"default",ga);class Us{constructor(t){Bt(this,"parsers",{}),Bt(this,"output",{}),Bt(this,"errors",[]),Bt(this,"pushToErrors",r=>this.errors.push(r)),this.options=ql.useCached(t)}async read(t){this.file=await M8(t,this.options)}setup(){if(this.fileParser)return;let{file:t}=this,r=t.getUint16(0);for(let[n,a]of oo)if(a.canHandle(t,r))return this.fileParser=new a(this.options,this.file,this.parsers),t[n]=!0;this.file.close&&this.file.close(),On("Unknown file format")}async parse(){let{output:t,errors:r}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),r.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&r.length>0&&(t.errors=r),ip(t)}async executeParsers(){let{output:t}=this;await this.fileParser.parse();let r=Object.values(this.parsers).map(async n=>{let a=await n.parse();n.assignToOutput(t,a)});this.options.silentErrors&&(r=r.map(n=>n.catch(this.pushToErrors))),await Promise.all(r)}async extractThumbnail(){this.setup();let{options:t,file:r}=this,n=Pn.get("tiff",t);var a;if(r.tiff?a={start:0,type:"tiff"}:r.jpeg&&(a=await this.fileParser.getOrFindSegment("tiff")),a===void 0)return;let i=await this.fileParser.ensureSegmentChunk(a),o=this.parsers.tiff=new n(i,t,r),s=await o.extractThumbnail();return r.close&&r.close(),s}}async function Rm(e,t){let r=new Us(t);return await r.read(e),r.parse()}var N8=Object.freeze({__proto__:null,parse:Rm,Exifr:Us,fileParsers:oo,segmentParsers:Pn,fileReaders:co,tagKeys:Xn,tagValues:Gi,tagRevivers:Rs,createDictionary:kn,extendDictionary:Ll,fetchUrlAsArrayBuffer:Dl,readBlobAsArrayBuffer:$l,chunkedProps:xs,otherSegments:Ru,segments:Fl,tiffBlocks:gn,segmentsAndBlocks:ys,tiffExtractables:bs,inheritables:Du,allFormatters:vs,Options:ql});class Dm{constructor(t,r,n){Bt(this,"errors",[]),Bt(this,"ensureSegmentChunk",async a=>{let i=a.start,o=a.size||65536;if(this.file.chunked)if(this.file.available(i,o))a.chunk=this.file.subarray(i,o);else try{a.chunk=await this.file.readChunk(i,o)}catch(s){On(`Couldn't read segment: ${JSON.stringify(a)}. ${s.message}`)}else this.file.byteLength>i+o?a.chunk=this.file.subarray(i,o):a.size===void 0?a.chunk=this.file.subarray(i):On("Segment unreachable: "+JSON.stringify(a));return a.chunk}),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=r,this.parsers=n}injectSegment(t,r){this.options[t].enabled&&this.createParser(t,r)}createParser(t,r){let n=new(Pn.get(t))(r,this.options,this.file);return this.parsers[t]=n}createParsers(t){for(let r of t){let{type:n,chunk:a}=r,i=this.options[n];if(i&&i.enabled){let o=this.parsers[n];o&&o.append||o||this.createParser(n,a)}}}async readSegments(t){let r=t.map(this.ensureSegmentChunk);await Promise.all(r)}}let Ii=class{static findPosition(t,r){let n=t.getUint16(r+2)+2,a=typeof this.headerLength=="function"?this.headerLength(t,r,n):this.headerLength,i=r+a,o=n-a;return{offset:r,length:n,headerLength:a,start:i,size:o,end:i+o}}static parse(t,r={}){return new this(t,new ql({[this.type]:r}),t).parse()}normalizeInput(t){return t instanceof Ta?t:new Ta(t)}constructor(t,r={},n){Bt(this,"errors",[]),Bt(this,"raw",new Map),Bt(this,"handleError",a=>{if(!this.options.silentErrors)throw a;this.errors.push(a.message)}),this.chunk=this.normalizeInput(t),this.file=n,this.type=this.constructor.type,this.globalOptions=this.options=r,this.localOptions=r[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,r){let n=Rs.get(r),a=Gi.get(r),i=Xn.get(r),o=this.options[r],s=o.reviveValues&&!!n,l=o.translateValues&&!!a,u=o.translateKeys&&!!i,d={};for(let[f,h]of t)s&&n.has(f)?h=n.get(f)(h):l&&a.has(f)&&(h=this.translateValue(h,a.get(f))),u&&i.has(f)&&(f=i.get(f)||f),d[f]=h;return d}translateValue(t,r){return r[t]||r.DEFAULT||t}assignToOutput(t,r){this.assignObjectToOutput(t,this.constructor.type,r)}assignObjectToOutput(t,r,n){if(this.globalOptions.mergeOutput)return Object.assign(t,n);t[r]?Object.assign(t[r],n):t[r]=n}};Bt(Ii,"headerLength",4),Bt(Ii,"type",void 0),Bt(Ii,"multiSegment",!1),Bt(Ii,"canHandle",()=>!1);function _8(e){return e===192||e===194||e===196||e===219||e===221||e===218||e===254}function P8(e){return e>=224&&e<=239}function C8(e,t,r){for(let[n,a]of Pn)if(a.canHandle(e,t,r))return n}class Jk extends Dm{constructor(...t){super(...t),Bt(this,"appSegments",[]),Bt(this,"jpegSegments",[]),Bt(this,"unknownSegments",[])}static canHandle(t,r){return r===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(t){t===!0?(this.findAll=!0,this.wanted=new Set(Pn.keyList())):(t=t===void 0?Pn.keyList().filter(r=>this.options[r].enabled):t.filter(r=>this.options[r].enabled&&Pn.has(r)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}async findAppSegments(t=0,r){this.setupSegmentFinderArgs(r);let{file:n,findAll:a,wanted:i,remaining:o}=this;if(!a&&this.file.chunked&&(a=Array.from(i).some(s=>{let l=Pn.get(s),u=this.options[s];return l.multiSegment&&u.multiSegment}),a&&await this.file.readWhole()),t=this.findAppSegmentsInRange(t,n.byteLength),!this.options.onlyTiff&&n.chunked){let s=!1;for(;o.size>0&&!s&&(n.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:l}=n,u=this.appSegments.some(d=>!this.file.available(d.offset||d.start,d.length||d.size));if(s=t>l&&!u?!await n.readNextChunk(t):!await n.readNextChunk(l),(t=this.findAppSegmentsInRange(t,n.byteLength))===void 0)return}}}findAppSegmentsInRange(t,r){r-=2;let n,a,i,o,s,l,{file:u,findAll:d,wanted:f,remaining:h,options:p}=this;for(;t<r;t++)if(u.getUint8(t)===255){if(n=u.getUint8(t+1),P8(n)){if(a=u.getUint16(t+2),i=C8(u,t,a),i&&f.has(i)&&(o=Pn.get(i),s=o.findPosition(u,t),l=p[i],s.type=i,this.appSegments.push(s),!d&&(o.multiSegment&&l.multiSegment?(this.unfinishedMultiSegment=s.chunkNumber<s.chunkCount,this.unfinishedMultiSegment||h.delete(i)):h.delete(i),h.size===0)))break;p.recordUnknownSegments&&(s=Ii.findPosition(u,t),s.marker=n,this.unknownSegments.push(s)),t+=a+1}else if(_8(n)){if(a=u.getUint16(t+2),n===218&&p.stopAfterSos!==!1)return;p.recordJpegSegments&&this.jpegSegments.push({offset:t,length:a,marker:n}),t+=a+1}}return t}mergeMultiSegments(){if(!this.appSegments.some(r=>r.multiSegment))return;let t=function(r,n){let a,i,o,s=new Map;for(let l=0;l<r.length;l++)a=r[l],i=a[n],s.has(i)?o=s.get(i):s.set(i,o=[]),o.push(a);return Array.from(s)}(this.appSegments,"type");this.mergedAppSegments=t.map(([r,n])=>{let a=Pn.get(r,this.options);return a.handleMultiSegments?{type:r,chunk:a.handleMultiSegments(n)}:n[0]})}getSegment(t){return this.appSegments.find(r=>r.type===t)}async getOrFindSegment(t){let r=this.getSegment(t);return r===void 0&&(await this.findAppSegments(0,[t]),r=this.getSegment(t)),r}}Bt(Jk,"type","jpeg"),oo.set("jpeg",Jk);const A8=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class O8 extends Ii{parseHeader(){var t=this.chunk.getUint16();t===18761?this.le=!0:t===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,r,n=new Map){let{pick:a,skip:i}=this.options[r];a=new Set(a);let o=a.size>0,s=i.size===0,l=this.chunk.getUint16(t);t+=2;for(let u=0;u<l;u++){let d=this.chunk.getUint16(t);if(o){if(a.has(d)&&(n.set(d,this.parseTag(t,d,r)),a.delete(d),a.size===0))break}else!s&&i.has(d)||n.set(d,this.parseTag(t,d,r));t+=12}return n}parseTag(t,r,n){let{chunk:a}=this,i=a.getUint16(t+2),o=a.getUint32(t+4),s=A8[i];if(s*o<=4?t+=8:t=a.getUint32(t+8),(i<1||i>13)&&On(`Invalid TIFF value type. block: ${n.toUpperCase()}, tag: ${r.toString(16)}, type: ${i}, offset ${t}`),t>a.byteLength&&On(`Invalid TIFF value offset. block: ${n.toUpperCase()}, tag: ${r.toString(16)}, type: ${i}, offset ${t} is outside of chunk size ${a.byteLength}`),i===1)return a.getUint8Array(t,o);if(i===2)return hl(a.getString(t,o));if(i===7)return a.getUint8Array(t,o);if(o===1)return this.parseTagValue(i,t);{let l=new(function(d){switch(d){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(i))(o),u=s;for(let d=0;d<o;d++)l[d]=this.parseTagValue(i,t),t+=u;return l}}parseTagValue(t,r){let{chunk:n}=this;switch(t){case 1:return n.getUint8(r);case 3:return n.getUint16(r);case 4:return n.getUint32(r);case 5:return n.getUint32(r)/n.getUint32(r+4);case 6:return n.getInt8(r);case 8:return n.getInt16(r);case 9:return n.getInt32(r);case 10:return n.getInt32(r)/n.getInt32(r+4);case 11:return n.getFloat(r);case 12:return n.getDouble(r);case 13:return n.getUint32(r);default:On(`Invalid tiff type ${t}`)}}}class vx extends O8{static canHandle(t,r){return t.getUint8(r+1)===225&&t.getUint32(r+4)===1165519206&&t.getUint16(r+8)===0}async parse(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&await this.parseIfd0Block(),t.exif.enabled&&await this.safeParse("parseExifBlock"),t.gps.enabled&&await this.safeParse("parseGpsBlock"),t.interop.enabled&&await this.safeParse("parseInteropBlock"),t.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(t){let r=this[t]();return r.catch!==void 0&&(r=r.catch(this.handleError)),r}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),r=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(r)}}parseBlock(t,r){let n=new Map;return this[r]=n,this.parseTags(t,r,n),n}async parseIfd0Block(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&On("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&On(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${t.byteLength}`),t.tiff&&await t.ensureChunk(this.ifd0Offset,c1(this.options));let r=this.parseBlock(this.ifd0Offset,"ifd0");return r.size!==0?(this.exifOffset=r.get(34665),this.interopOffset=r.get(40965),this.gpsOffset=r.get(34853),this.xmp=r.get(700),this.iptc=r.get(33723),this.icc=r.get(34675),this.options.sanitize&&(r.delete(34665),r.delete(40965),r.delete(34853),r.delete(700),r.delete(33723),r.delete(34675)),r):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,c1(this.options));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t}unpack(t,r){let n=t.get(r);n&&n.length===1&&t.set(r,n[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",Qk(...t.get(2),t.get(1))),t.set("longitude",Qk(...t.get(4),t.get(3)))),t}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(t=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let t=this.ifd1.get(513),r=this.ifd1.get(514);return this.chunk.getUint8Array(t,r)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,r,n,a={};for(r of gn)if(t=this[r],!o_(t))if(n=this.canTranslate?this.translateBlock(t,r):Object.fromEntries(t),this.options.mergeOutput){if(r==="ifd1")continue;Object.assign(a,n)}else a[r]=n;return this.makerNote&&(a.makerNote=this.makerNote),this.userComment&&(a.userComment=this.userComment),a}assignToOutput(t,r){if(this.globalOptions.mergeOutput)Object.assign(t,r);else for(let[n,a]of Object.entries(r))this.assignObjectToOutput(t,n,a)}}function Qk(e,t,r,n){var a=e+t/60+r/3600;return n!=="S"&&n!=="W"||(a*=-1),a}Bt(vx,"type","tiff"),Bt(vx,"headerLength",10),Pn.set("tiff",vx);var T8=Object.freeze({__proto__:null,default:N8,Exifr:Us,fileParsers:oo,segmentParsers:Pn,fileReaders:co,tagKeys:Xn,tagValues:Gi,tagRevivers:Rs,createDictionary:kn,extendDictionary:Ll,fetchUrlAsArrayBuffer:Dl,readBlobAsArrayBuffer:$l,chunkedProps:xs,otherSegments:Ru,segments:Fl,tiffBlocks:gn,segmentsAndBlocks:ys,tiffExtractables:bs,inheritables:Du,allFormatters:vs,Options:ql,parse:Rm});const Jv={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},Qv=Object.assign({},Jv,{firstChunkSize:4e4,gps:[1,2,3,4]});async function c_(e){let t=new Us(Qv);await t.read(e);let r=await t.parse();if(r&&r.gps){let{latitude:n,longitude:a}=r.gps;return{latitude:n,longitude:a}}}const e2=Object.assign({},Jv,{tiff:!1,ifd1:!0,mergeOutput:!1});async function u_(e){let t=new Us(e2);await t.read(e);let r=await t.extractThumbnail();return r&&Im?Em.from(r):r}async function d_(e){let t=await this.thumbnail(e);if(t!==void 0){let r=new Blob([t]);return URL.createObjectURL(r)}}const t2=Object.assign({},Jv,{firstChunkSize:4e4,ifd0:[274]});async function r2(e){let t=new Us(t2);await t.read(e);let r=await t.parse();if(r&&r.ifd0)return r.ifd0[274]}const n2=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let pl=!0,ml=!0;if(typeof navigator=="object"){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,r,n]=t;pl=Number(r)+.1*Number(n)<13.4,ml=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);pl=ml=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);pl=ml=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);pl=ml=Number(t)<77}}async function f_(e){let t=await r2(e);return Object.assign({canvas:pl,css:ml},n2[t])}class E8 extends Ta{constructor(...t){super(...t),Bt(this,"ranges",new I8),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(t,r,n){if(t===0&&this.byteLength===0&&n){let a=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(a)}else{let a=t+r;if(a>this.byteLength){let{dataView:i}=this._extend(a);this._swapDataView(i)}}}_extend(t){let r;r=Im?Em.allocUnsafe(t):new Uint8Array(t);let n=new DataView(r.buffer,r.byteOffset,r.byteLength);return r.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:r,dataView:n}}subarray(t,r,n=!1){return r=r||this._lengthToEnd(t),n&&this._tryExtend(t,r),this.ranges.add(t,r),super.subarray(t,r)}set(t,r,n=!1){n&&this._tryExtend(r,t.byteLength,t);let a=super.set(t,r);return this.ranges.add(r,a.byteLength),a}async ensureChunk(t,r){this.chunked&&(this.ranges.available(t,r)||await this.readChunk(t,r))}available(t,r){return this.ranges.available(t,r)}}class I8{constructor(){Bt(this,"list",[])}get length(){return this.list.length}add(t,r,n=0){let a=t+r,i=this.list.filter(o=>e3(t,o.offset,a)||e3(t,o.end,a));if(i.length>0){t=Math.min(t,...i.map(s=>s.offset)),a=Math.max(a,...i.map(s=>s.end)),r=a-t;let o=i.shift();o.offset=t,o.length=r,o.end=a,this.list=this.list.filter(s=>!i.includes(s))}else this.list.push({offset:t,length:r,end:a})}available(t,r){let n=t+r;return this.list.some(a=>a.offset<=t&&n<=a.end)}}function e3(e,t,r){return e<=t&&t<=r}class $m extends E8{constructor(t,r){super(0),Bt(this,"chunksRead",0),this.input=t,this.options=r}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let r=this.options.chunkSize,n=await this.readChunk(t,r);return!!n&&n.byteLength===r}async readChunk(t,r){if(this.chunksRead++,(r=this.safeWrapAddress(t,r))!==0)return this._readChunk(t,r)}safeWrapAddress(t,r){return this.size!==void 0&&t+r>this.size?Math.max(0,this.size-t):r}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}co.set("blob",class extends $m{async readWhole(){this.chunked=!1;let e=await $l(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let r=t?e+t:void 0,n=this.input.slice(e,r),a=await $l(n);return this.set(a,e,!0)}});var R8=Object.freeze({__proto__:null,default:T8,Exifr:Us,fileParsers:oo,segmentParsers:Pn,fileReaders:co,tagKeys:Xn,tagValues:Gi,tagRevivers:Rs,createDictionary:kn,extendDictionary:Ll,fetchUrlAsArrayBuffer:Dl,readBlobAsArrayBuffer:$l,chunkedProps:xs,otherSegments:Ru,segments:Fl,tiffBlocks:gn,segmentsAndBlocks:ys,tiffExtractables:bs,inheritables:Du,allFormatters:vs,Options:ql,parse:Rm,gpsOnlyOptions:Qv,gps:c_,thumbnailOnlyOptions:e2,thumbnail:u_,thumbnailUrl:d_,orientationOnlyOptions:t2,orientation:r2,rotations:n2,get rotateCanvas(){return pl},get rotateCss(){return ml},rotation:f_});co.set("url",class extends $m{async readWhole(){this.chunked=!1;let e=await Dl(this.input);e instanceof ArrayBuffer?this._swapArrayBuffer(e):e instanceof Uint8Array&&this._swapBuffer(e)}async _readChunk(e,t){let r=t?e+t-1:void 0,n=this.options.httpHeaders||{};(e||r)&&(n.range=`bytes=${[e,r].join("-")}`);let a=await qv(this.input,{headers:n}),i=await a.arrayBuffer(),o=i.byteLength;if(a.status!==416)return o!==t&&(this.size=e+o),this.set(i,e,!0)}});Ta.prototype.getUint64=function(e){let t=this.getUint32(e),r=this.getUint32(e+4);return t<1048575?t<<32|r:typeof W0!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),W0(t)<<W0(32)|W0(r)):void On("Trying to read 64b value but JS can only handle 53b numbers.")};class D8 extends Dm{parseBoxes(t=0){let r=[];for(;t<this.file.byteLength-4;){let n=this.parseBoxHead(t);if(r.push(n),n.length===0)break;t+=n.length}return r}parseSubBoxes(t){t.boxes=this.parseBoxes(t.start)}findBox(t,r){return t.boxes===void 0&&this.parseSubBoxes(t),t.boxes.find(n=>n.kind===r)}parseBoxHead(t){let r=this.file.getUint32(t),n=this.file.getString(t+4,4),a=t+8;return r===1&&(r=this.file.getUint64(t+8),a+=8),{offset:t,length:r,kind:n,start:a}}parseBoxFullHead(t){if(t.version!==void 0)return;let r=this.file.getUint32(t.start);t.version=r>>24,t.start+=4}}class h_ extends D8{static canHandle(t,r){if(r!==0)return!1;let n=t.getUint16(2);if(n>50)return!1;let a=16,i=[];for(;a<n;)i.push(t.getString(a,4)),a+=4;return i.includes(this.type)}async parse(){let t=this.file.getUint32(0),r=this.parseBoxHead(t);for(;r.kind!=="meta";)t+=r.length,await this.file.ensureChunk(t,16),r=this.parseBoxHead(t);await this.file.ensureChunk(r.offset,r.length),this.parseBoxFullHead(r),this.parseSubBoxes(r),this.options.icc.enabled&&await this.findIcc(r),this.options.tiff.enabled&&await this.findExif(r)}async registerSegment(t,r,n){await this.file.ensureChunk(r,n);let a=this.file.subarray(r,n);this.createParser(t,a)}async findIcc(t){let r=this.findBox(t,"iprp");if(r===void 0)return;let n=this.findBox(r,"ipco");if(n===void 0)return;let a=this.findBox(n,"colr");a!==void 0&&await this.registerSegment("icc",a.offset+12,a.length)}async findExif(t){let r=this.findBox(t,"iinf");if(r===void 0)return;let n=this.findBox(t,"iloc");if(n===void 0)return;let a=this.findExifLocIdInIinf(r),i=this.findExtentInIloc(n,a);if(i===void 0)return;let[o,s]=i;await this.file.ensureChunk(o,s);let l=4+this.file.getUint32(o);o+=l,s-=l,await this.registerSegment("tiff",o,s)}findExifLocIdInIinf(t){this.parseBoxFullHead(t);let r,n,a,i,o=t.start,s=this.file.getUint16(o);for(o+=2;s--;){if(r=this.parseBoxHead(o),this.parseBoxFullHead(r),n=r.start,r.version>=2&&(a=r.version===3?4:2,i=this.file.getString(n+a+2,4),i==="Exif"))return this.file.getUintBytes(n,a);o+=r.length}}get8bits(t){let r=this.file.getUint8(t);return[r>>4,15&r]}findExtentInIloc(t,r){this.parseBoxFullHead(t);let n=t.start,[a,i]=this.get8bits(n++),[o,s]=this.get8bits(n++),l=t.version===2?4:2,u=t.version===1||t.version===2?2:0,d=s+a+i,f=t.version===2?4:2,h=this.file.getUintBytes(n,f);for(n+=f;h--;){let p=this.file.getUintBytes(n,l);n+=l+u+2+o;let x=this.file.getUint16(n);if(n+=2,p===r)return x>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(n+s,a),this.file.getUintBytes(n+s+a,i)];n+=x*d}}}class p_ extends h_{}Bt(p_,"type","heic");class t3 extends h_{}Bt(t3,"type","avif"),oo.set("heic",p_),oo.set("avif",t3),kn(Xn,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),kn(Xn,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),kn(Xn,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),kn(Gi,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Ud=kn(Gi,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const r3={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Ud.set(37392,r3),Ud.set(41488,r3);const wx={0:"Normal",1:"Low",2:"High"};function n3(e){return typeof e=="object"&&e.length!==void 0?e[0]:e}function a3(e){let t=Array.from(e).slice(1);return t[1]>15&&(t=t.map(r=>String.fromCharCode(r))),t[2]!=="0"&&t[2]!==0||t.pop(),t.join(".")}function kx(e){if(typeof e=="string"){var[t,r,n,a,i,o]=e.trim().split(/[-: ]/g).map(Number),s=new Date(t,r-1,n);return Number.isNaN(a)||Number.isNaN(i)||Number.isNaN(o)||(s.setHours(a),s.setMinutes(i),s.setSeconds(o)),Number.isNaN(+s)?e:s}}function md(e){if(typeof e=="string")return e;let t=[];if(e[1]===0&&e[e.length-1]===0)for(let r=0;r<e.length;r+=2)t.push(i3(e[r+1],e[r]));else for(let r=0;r<e.length;r+=2)t.push(i3(e[r],e[r+1]));return hl(String.fromCodePoint(...t))}function i3(e,t){return e<<8|t}Ud.set(41992,wx),Ud.set(41993,wx),Ud.set(41994,wx),kn(Rs,["ifd0","ifd1"],[[50827,function(e){return typeof e!="string"?s_(e):e}],[306,kx],[40091,md],[40092,md],[40093,md],[40094,md],[40095,md]]),kn(Rs,"exif",[[40960,a3],[36864,a3],[36867,kx],[36868,kx],[40962,n3],[40963,n3]]),kn(Rs,"gps",[[0,e=>Array.from(e).join(".")],[7,e=>Array.from(e).join(":")]]);class Sx extends Ii{static canHandle(t,r){return t.getUint8(r+1)===225&&t.getUint32(r+4)===1752462448&&t.getString(r+4,20)==="http://ns.adobe.com/"}static headerLength(t,r){return t.getString(r+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(t,r){let n=super.findPosition(t,r);return n.multiSegment=n.extended=n.headerLength===79,n.multiSegment?(n.chunkCount=t.getUint8(r+72),n.chunkNumber=t.getUint8(r+76),t.getUint8(r+77)!==0&&n.chunkNumber++):(n.chunkCount=1/0,n.chunkNumber=-1),n}static handleMultiSegments(t){return t.map(r=>r.chunk.getString()).join("")}normalizeInput(t){return typeof t=="string"?t:Ta.from(t).getString()}parse(t=this.chunk){if(!this.localOptions.parse)return t;t=function(i){let o={},s={};for(let l of y_)o[l]=[],s[l]=0;return i.replace(B8,(l,u,d)=>{if(u==="<"){let f=++s[d];return o[d].push(f),`${l}#${f}`}return`${l}#${o[d].pop()}`})}(t);let r=Gc.findAll(t,"rdf","Description");r.length===0&&r.push(new Gc("rdf","Description",void 0,t));let n,a={};for(let i of r)for(let o of i.properties)n=F8(o.ns,a),m_(o,n);return function(i){let o;for(let s in i)o=i[s]=ip(i[s]),o===void 0&&delete i[s];return ip(i)}(a)}assignToOutput(t,r){if(this.localOptions.parse)for(let[n,a]of Object.entries(r))switch(n){case"tiff":this.assignObjectToOutput(t,"ifd0",a);break;case"exif":this.assignObjectToOutput(t,"exif",a);break;case"xmlns":break;default:this.assignObjectToOutput(t,n,a)}else t.xmp=r}}Bt(Sx,"type","xmp"),Bt(Sx,"multiSegment",!0),Pn.set("xmp",Sx);class sp{static findAll(t){return g_(t,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(sp.unpackMatch)}static unpackMatch(t){let r=t[1],n=t[2],a=t[3].slice(1,-1);return a=x_(a),new sp(r,n,a)}constructor(t,r,n){this.ns=t,this.name=r,this.value=n}serialize(){return this.value}}class Gc{static findAll(t,r,n){if(r!==void 0||n!==void 0){r=r||"[\\w\\d-]+",n=n||"[\\w\\d-]+";var a=new RegExp(`<(${r}):(${n})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else a=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return g_(t,a).map(Gc.unpackMatch)}static unpackMatch(t){let r=t[1],n=t[2],a=t[4],i=t[8];return new Gc(r,n,a,i)}constructor(t,r,n,a){this.ns=t,this.name=r,this.attrString=n,this.innerXml=a,this.attrs=sp.findAll(n),this.children=Gc.findAll(a),this.value=this.children.length===0?x_(a):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:t,name:r}=this;return t==="rdf"&&(r==="Seq"||r==="Bag"||r==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return L8(this.children.map($8));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let t={};for(let r of this.properties)m_(r,t);return this.value!==void 0&&(t.value=this.value),ip(t)}}function m_(e,t){let r=e.serialize();r!==void 0&&(t[e.name]=r)}var $8=e=>e.serialize(),L8=e=>e.length===1?e[0]:e,F8=(e,t)=>t[e]?t[e]:t[e]={};function g_(e,t){let r,n=[];if(!e)return n;for(;(r=t.exec(e))!==null;)n.push(r);return n}function x_(e){if(function(n){return n==null||n==="null"||n==="undefined"||n===""||n.trim()===""}(e))return;let t=Number(e);if(!Number.isNaN(t))return t;let r=e.toLowerCase();return r==="true"||r!=="false"&&e.trim()}const y_=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],B8=new RegExp(`(<|\\/)(${y_.join("|")})`,"g");var b_=Object.freeze({__proto__:null,default:R8,Exifr:Us,fileParsers:oo,segmentParsers:Pn,fileReaders:co,tagKeys:Xn,tagValues:Gi,tagRevivers:Rs,createDictionary:kn,extendDictionary:Ll,fetchUrlAsArrayBuffer:Dl,readBlobAsArrayBuffer:$l,chunkedProps:xs,otherSegments:Ru,segments:Fl,tiffBlocks:gn,segmentsAndBlocks:ys,tiffExtractables:bs,inheritables:Du,allFormatters:vs,Options:ql,parse:Rm,gpsOnlyOptions:Qv,gps:c_,thumbnailOnlyOptions:e2,thumbnail:u_,thumbnailUrl:d_,orientationOnlyOptions:t2,orientation:r2,rotations:n2,get rotateCanvas(){return pl},get rotateCss(){return ml},rotation:f_});let o3=ap("fs",e=>e.promises);co.set("fs",class extends $m{async readWhole(){this.chunked=!1,this.fs=await o3;let e=await this.fs.readFile(this.input);this._swapBuffer(e)}async readChunked(){this.chunked=!0,this.fs=await o3,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(e,t){this.fh===void 0&&await this.open(),e+t>this.size&&(t=this.size-e);var r=this.subarray(e,t,!0);return await this.fh.read(r.dataView,0,t,e),r}async close(){if(this.fh){let e=this.fh;this.fh=void 0,await e.close()}}});co.set("base64",class extends $m{constructor(...e){super(...e),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(e,t){let r,n,a=this.input;e===void 0?(e=0,r=0,n=0):(r=4*Math.floor(e/3),n=e-r/4*3),t===void 0&&(t=this.size);let i=e+t,o=r+4*Math.ceil(i/3);a=a.slice(r,o);let s=Math.min(t,this.size-e);if(Im){let l=Em.from(a,"base64").slice(n,n+s);return this.set(l,e,!0)}{let l=this.subarray(e,s,!0),u=atob(a),d=l.toUint8();for(let f=0;f<s;f++)d[f]=u.charCodeAt(n+f);return l}}});class s3 extends Dm{static canHandle(t,r){return r===18761||r===19789}extendOptions(t){let{ifd0:r,xmp:n,iptc:a,icc:i}=t;n.enabled&&r.deps.add(700),a.enabled&&r.deps.add(33723),i.enabled&&r.deps.add(34675),r.finalizeFilters()}async parse(){let{tiff:t,xmp:r,iptc:n,icc:a}=this.options;if(t.enabled||r.enabled||n.enabled||a.enabled){let i=Math.max(c1(this.options),this.options.chunkSize);await this.file.ensureChunk(0,i),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(t){if(this.parsers.tiff[t]){let r=this.parsers.tiff[t];this.injectSegment(t,r)}}}Bt(s3,"type","tiff"),oo.set("tiff",s3);let G8=ap("zlib");const U8=["ihdr","iccp","text","itxt","exif"];class l3 extends Dm{constructor(...t){super(...t),Bt(this,"catchError",r=>this.errors.push(r)),Bt(this,"metaChunks",[]),Bt(this,"unknownChunks",[])}static canHandle(t,r){return r===35152&&t.getUint32(0)===2303741511&&t.getUint32(4)===218765834}async parse(){let{file:t}=this;await this.findPngChunksInRange(8,t.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(t,r){let{file:n}=this;for(;t<r;){let a=n.getUint32(t),i=n.getUint32(t+4),o=n.getString(t+4,4).toLowerCase(),s=a+4+4+4,l={type:o,offset:t,length:s,start:t+4+4,size:a,marker:i};U8.includes(o)?this.metaChunks.push(l):this.unknownChunks.push(l),t+=s}}parseTextChunks(){let t=this.metaChunks.filter(r=>r.type==="text");for(let r of t){let[n,a]=this.file.getString(r.start,r.size).split("\0");this.injectKeyValToIhdr(n,a)}}injectKeyValToIhdr(t,r){let n=this.parsers.ihdr;n&&n.raw.set(t,r)}findIhdr(){let t=this.metaChunks.find(r=>r.type==="ihdr");t&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",t.chunk)}async findExif(){let t=this.metaChunks.find(r=>r.type==="exif");t&&this.injectSegment("tiff",t.chunk)}async findXmp(){let t=this.metaChunks.filter(r=>r.type==="itxt");for(let r of t)r.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",r.chunk)}async findIcc(){let t=this.metaChunks.find(s=>s.type==="iccp");if(!t)return;let{chunk:r}=t,n=r.getUint8Array(0,81),a=0;for(;a<80&&n[a]!==0;)a++;let i=a+2,o=r.getString(0,a);if(this.injectKeyValToIhdr("ProfileName",o),np){let s=await G8,l=r.getUint8Array(i);l=s.inflateSync(l),this.injectSegment("icc",l)}}}Bt(l3,"type","png"),oo.set("png",l3),kn(Xn,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),Ll(Xn,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let c3=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];Ll(Xn,"ifd0",c3),Ll(Xn,"exif",c3),kn(Gi,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class Mx extends Ii{static canHandle(t,r){return t.getUint8(r+1)===224&&t.getUint32(r+4)===1246120262&&t.getUint8(r+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}Bt(Mx,"type","jfif"),Bt(Mx,"headerLength",9),Pn.set("jfif",Mx),kn(Xn,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class u3 extends Ii{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}Bt(u3,"type","ihdr"),Pn.set("ihdr",u3),kn(Xn,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),kn(Gi,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class Ah extends Ii{static canHandle(t,r){return t.getUint8(r+1)===226&&t.getUint32(r+4)===1229144927}static findPosition(t,r){let n=super.findPosition(t,r);return n.chunkNumber=t.getUint8(r+16),n.chunkCount=t.getUint8(r+17),n.multiSegment=n.chunkCount>1,n}static handleMultiSegments(t){return function(r){let n=function(a){let i=a[0].constructor,o=0;for(let u of a)o+=u.length;let s=new i(o),l=0;for(let u of a)s.set(u,l),l+=u.length;return s}(r.map(a=>a.chunk.toUint8()));return new Ta(n)}(t)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:t}=this;this.chunk.byteLength<84&&On("ICC header is too short");for(let[r,n]of Object.entries(z8)){r=parseInt(r,10);let a=n(this.chunk,r);a!=="\0\0\0\0"&&t.set(r,a)}}parseTags(){let t,r,n,a,i,{raw:o}=this,s=this.chunk.getUint32(128),l=132,u=this.chunk.byteLength;for(;s--;){if(t=this.chunk.getString(l,4),r=this.chunk.getUint32(l+4),n=this.chunk.getUint32(l+8),a=this.chunk.getString(r,4),r+n>u)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");i=this.parseTag(a,r,n),i!==void 0&&i!=="\0\0\0\0"&&o.set(t,i),l+=12}}parseTag(t,r,n){switch(t){case"desc":return this.parseDesc(r);case"mluc":return this.parseMluc(r);case"text":return this.parseText(r,n);case"sig ":return this.parseSig(r)}if(!(r+n>this.chunk.byteLength))return this.chunk.getUint8Array(r,n)}parseDesc(t){let r=this.chunk.getUint32(t+8)-1;return hl(this.chunk.getString(t+12,r))}parseText(t,r){return hl(this.chunk.getString(t+8,r-8))}parseSig(t){return hl(this.chunk.getString(t+8,4))}parseMluc(t){let{chunk:r}=this,n=r.getUint32(t+8),a=r.getUint32(t+12),i=t+16,o=[];for(let s=0;s<n;s++){let l=r.getString(i+0,2),u=r.getString(i+2,2),d=r.getUint32(i+4),f=r.getUint32(i+8)+t,h=hl(r.getUnicodeString(f,d));o.push({lang:l,country:u,text:h}),i+=a}return n===1?o[0].text:o}translateValue(t,r){return typeof t=="string"?r[t]||r[t.toLowerCase()]||t:r[t]||t}}Bt(Ah,"type","icc"),Bt(Ah,"multiSegment",!0),Bt(Ah,"headerLength",18);const z8={4:bo,8:function(e,t){return[e.getUint8(t),e.getUint8(t+1)>>4,e.getUint8(t+1)%16].map(r=>r.toString(10)).join(".")},12:bo,16:bo,20:bo,24:function(e,t){const r=e.getUint16(t),n=e.getUint16(t+2)-1,a=e.getUint16(t+4),i=e.getUint16(t+6),o=e.getUint16(t+8),s=e.getUint16(t+10);return new Date(Date.UTC(r,n,a,i,o,s))},36:bo,40:bo,48:bo,52:bo,64:(e,t)=>e.getUint32(t),80:bo};function bo(e,t){return hl(e.getString(t,4))}Pn.set("icc",Ah),kn(Xn,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const V0={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},d3={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};kn(Gi,"icc",[[4,V0],[12,d3],[40,Object.assign({},V0,d3)],[48,V0],[80,V0],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class H0 extends Ii{static canHandle(t,r,n){return t.getUint8(r+1)===237&&t.getString(r+4,9)==="Photoshop"&&this.containsIptc8bim(t,r,n)!==void 0}static headerLength(t,r,n){let a,i=this.containsIptc8bim(t,r,n);if(i!==void 0)return a=t.getUint8(r+i+7),a%2!=0&&(a+=1),a===0&&(a=4),i+8+a}static containsIptc8bim(t,r,n){for(let a=0;a<n;a++)if(this.isIptcSegmentHead(t,r+a))return a}static isIptcSegmentHead(t,r){return t.getUint8(r)===56&&t.getUint32(r)===943868237&&t.getUint16(r+4)===1028}parse(){let{raw:t}=this,r=this.chunk.byteLength-1,n=!1;for(let a=0;a<r;a++)if(this.chunk.getUint8(a)===28&&this.chunk.getUint8(a+1)===2){n=!0;let i=this.chunk.getUint16(a+3),o=this.chunk.getUint8(a+2),s=this.chunk.getLatin1String(a+5,i);t.set(o,this.pluralizeValue(t.get(o),s)),a+=4+i}else if(n)break;return this.translate(),this.output}pluralizeValue(t,r){return t!==void 0?t instanceof Array?(t.push(r),t):[t,r]:r}}Bt(H0,"type","iptc"),Bt(H0,"translateValues",!1),Bt(H0,"reviveValues",!1),Pn.set("iptc",H0),kn(Xn,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),kn(Gi,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);let jx=null;async function zs(){if(!jx)try{const n=(await Mt(()=>import("./joraw-DPYKpgR3.js"),[])).default;if(typeof n!="function")throw new Error("JoRaw WASM import failed");const a=new URL("/assets/joraw-DraTMNgX.wasm",import.meta.url).href;jx=n({locateFile:(i,o)=>i.endsWith("joraw.wasm")?a:o+i})}catch(r){throw console.error("Failed to load joraw.js:",r),r}const e=await jx,t=e.LibRaw||e.JoRaw;if(!t)throw new Error("JoRaw class not found");return t}const a2=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],to=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;async function X0(e,t=0,r=0){const n=await zs(),a=new n;try{await a.open(new Uint8Array(e));const i=a.getRawImage(),o=new Uint16Array(i.data),s=i.width,l=i.height,u=Math.floor((s-t)/6)*2,d=Math.floor((l-r)/6)*2;if(u<=0||d<=0)throw new Error("Image too small for X-Trans subsampling with current phase.");const f=new Uint16Array(u*d);for(let p=0;p<d/2;p++){const x=p*6+r;if(x+3>=l)break;const g=x*s,b=(x+3)*s,y=p*2,m=y*u,k=(y+1)*u;for(let S=0;S<u/2;S++){const w=S*6+t;if(w+1>=s)break;const v=S*2;f[m+v]=o[g+w+1],f[m+v+1]=o[g+w+0],f[k+v]=o[b+w+0],f[k+v+1]=o[b+w+1]}}return{dngBuffer:Ch(u,d,f),width:u,height:d}}finally{a.delete?a.delete():a.close()}}function W8(e,t,r){const n=r.type===1?1:r.type===3?2:r.type===4?4:0;if(n===0)throw new Error(`Unsupported TIFF field type: ${r.type}`);const i=r.count*n<=4?r.valueFieldOffset:e.getUint32(r.valueFieldOffset,t),o=[];for(let s=0;s<r.count;s++){const l=i+s*n;if(l<0||l+n>e.byteLength)throw new Error("Invalid TIFF field offset");r.type===1?o.push(e.getUint8(l)):r.type===3?o.push(e.getUint16(l,t)):o.push(e.getUint32(l,t))}return o}function V8(e){const t=new DataView(e);if(t.byteLength<8)throw new Error("TIFF file too small");const r=t.getUint16(0,!1),n=r===18761;if(!n&&r!==19789)throw new Error("Invalid TIFF byte order");if(t.getUint16(2,n)!==42)throw new Error("Not a TIFF file");const i=t.getUint32(4,n);if(i<=0||i+2>t.byteLength)throw new Error("Invalid TIFF IFD offset");const o=t.getUint16(i,n),s=new Map;for(let A=0;A<o;A++){const O=i+2+A*12;if(O+12>t.byteLength)throw new Error("Corrupt TIFF IFD");const F=t.getUint16(O,n),D=t.getUint16(O+2,n),W=t.getUint32(O+4,n);s.set(F,{type:D,count:W,valueFieldOffset:O+8})}const l=(A,O=!1)=>{const F=s.get(A);if(!F){if(O)return[];throw new Error(`Missing TIFF tag ${A}`)}return W8(t,n,F)},u=l(256)[0]||0,d=l(257)[0]||0;if(u<=0||d<=0)throw new Error("Invalid TIFF dimensions");const f=l(258),h=l(277,!0)[0]||f.length||1,p=l(259,!0)[0]||1,x=l(262,!0)[0]||(h===1?1:2),g=l(273),b=l(279),y=l(278,!0)[0]||d,m=l(284,!0)[0]||1;if(p!==1)throw new Error(`Unsupported TIFF compression: ${p}`);if(m!==1)throw new Error("Only chunky TIFF (PlanarConfiguration=1) is supported");if(g.length!==b.length)throw new Error("Invalid TIFF strip metadata");const k=f.length===1?new Array(h).fill(f[0]):f;if(k.length<h)throw new Error("Invalid BitsPerSample count");const S=k[0];if(S!==8&&S!==16||k.some(A=>A!==S))throw new Error("Only 8-bit or 16-bit uniform TIFF samples are supported");const w=S/8,v=h*w,M=u*d*v;let N=new Uint8Array(M),_=0;for(let A=0;A<g.length;A++){const O=g[A],F=b[A];if(O<0||F<0||O+F>t.byteLength)throw new Error("Invalid TIFF strip bounds");const D=A*y;if(D>=d)break;const H=Math.min(y,d-D)*u*v,Y=Math.min(F,H,M-_);if(N.set(new Uint8Array(e,O,Y),_),_+=Y,_>=M)break}if(_<M)throw new Error("TIFF pixel data is incomplete");const P=A=>w===1?N[A]:n?N[A]|N[A+1]<<8:N[A]<<8|N[A+1],E=A=>S===8?A&255:A>>>8&255,R=A=>S===8?A&255:A&65535,T=new Uint8ClampedArray(u*d*4),G=new Uint16Array(u*d*3);let L=0;const C=x===0;for(let A=0;A<d;A++)for(let O=0;O<u;O++){const F=A*u+O,D=F*4;let W=P(L),H=h>=2?P(L+w):W,Y=h>=3?P(L+w*2):W;L+=v,C&&(S===8?(W=255-W,H=255-H,Y=255-Y):(W=65535-W,H=65535-H,Y=65535-Y)),T[D]=E(W),T[D+1]=E(H),T[D+2]=E(Y),T[D+3]=255;const te=F*3;G[te]=R(W),G[te+1]=R(H),G[te+2]=R(Y)}return{width:u,height:d,rgba:T,rgbData:G,whiteLevel:S===8?255:65535}}async function v_(e){const t=e.name.toLowerCase(),r=/\.tiff?$/i.test(t)||e.type==="image/tiff"||e.type==="image/x-tiff"||e.type==="image/tif"||e.type==="application/tiff";let n=0,a=0,i=new Uint16Array(0),o=255;const s=document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("Failed to create canvas context");try{const f=await createImageBitmap(e);n=f.width,a=f.height,s.width=n,s.height=a,l.drawImage(f,0,0),f.close&&f.close();const p=l.getImageData(0,0,n,a).data,x=n*a;i=new Uint16Array(x*3);for(let g=0;g<a;g++)for(let b=0;b<n;b++){const y=(g*n+b)*4,m=(g*n+b)*3;i[m]=p[y],i[m+1]=p[y+1],i[m+2]=p[y+2]}}catch(f){if(!r)throw f;const h=V8(await e.arrayBuffer());n=h.width,a=h.height,i=new Uint16Array(h.rgbData),o=h.whiteLevel,s.width=n,s.height=a;const p=new ImageData(new Uint8ClampedArray(h.rgba),n,a);l.putImageData(p,0,0)}const u=await new Promise(f=>s.toBlob(f,"image/png"));let d={description:"Standard image (non-RAW)"};try{const f=await b_.parse(e);f&&(d={...d,...f})}catch(f){console.warn("EXIF parsing failed for standard image",f)}return{previewBlob:u||e,analysisData:{data:i,width:n,height:a,bayerPattern:"RGGB",blackLevels:[0,0,0,0],whiteLevel:o,metadata:d,isThreePlane:!0}}}const H8=async e=>{const t=await zs(),r=new t;try{await r.open(e,{useCameraWb:!0,outputBps:8,noAutoBright:!0,userQual:3,outputColor:1});const n=await r.imageData();return new Promise((a,i)=>{const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const s=o.getContext("2d");if(!s){i(new Error("Could not create canvas context"));return}const l=s.createImageData(n.width,n.height),u=n.data,d=n.width*n.height;for(let f=0;f<d;f++){const h=f*3,p=f*4;l.data[p]=u[h],l.data[p+1]=u[h+1],l.data[p+2]=u[h+2],l.data[p+3]=255}s.putImageData(l,0,0),o.toBlob(f=>{f?a(f):i(new Error("Canvas to Blob failed"))},"image/jpeg",.85)})}finally{r.delete?r.delete():r.close()}},lp=async e=>{var n,a,i,o,s,l,u,d,f;const t=await zs(),r=new t;try{if(await r.open(e,{}),typeof r.getRawImage!="function")throw new Error("WASM mismatch");const h=r.getRawImage();let p=new Uint16Array(h.data);const x=await r.metadata(!0);let g={...x};try{const v=await b_.parse(e.buffer);v&&(g={...g,...v})}catch(v){console.warn("exifr parsing failed for RAW buffer",v)}const b=((n=x.idata)==null?void 0:n.filters)||0,y=((a=x.idata)==null?void 0:a.colors)||0,m=b===0&&y===3,k=b===9;let S=[0,0,0,0],w=!1;if(r.getBlackLevels)try{const v=r.getBlackLevels();v.dng_cblack&&v.dng_cblack.length===4&&Array.from(v.dng_cblack).some(M=>M>0)?(S=Array.from(v.dng_cblack).map(Number),w=!0):v.cblack&&v.cblack.length===4&&Array.from(v.cblack).some(M=>M>0)?(S=Array.from(v.cblack).map(Number),w=!0):typeof v.black=="number"&&v.black>0&&(S=[v.black,v.black,v.black,v.black],w=!0)}catch(v){console.warn("getBlackLevels binding failed",v)}if(!w){let v=[];if((i=x.color_data)!=null&&i.cblack_rawpy_style)v=x.color_data.cblack_rawpy_style;else if((s=(o=x.color_data)==null?void 0:o.dng_levels)!=null&&s.dng_cblack)v=x.color_data.dng_levels.dng_cblack;else if(((l=x.black_level_per_channel)==null?void 0:l.length)>=4)v=x.black_level_per_channel;else if(((u=x.cblack)==null?void 0:u.length)>=4)v=x.cblack;else if(((f=(d=x.color)==null?void 0:d.cblack)==null?void 0:f.length)>=4)v=x.color.cblack;else{const M=x.black_level||x.color_data&&x.color_data.black||0;v=[M,M,M,M]}S=[Number(v[0])||0,Number(v[1])||0,Number(v[2])||0,Number(v[3])||0]}return{data:p,width:h.width,height:h.height,bayerPattern:x.color_desc||"RGGB",blackLevels:S,whiteLevel:x.white_level||16383,metadata:g,isThreePlane:m,isXTrans:k}}finally{r.delete?r.delete():r.close()}};async function fc(e){const t=new Uint8Array(e.slice(0)),r=new Uint8Array(e.slice(0)),[n,a]=await Promise.all([H8(t),lp(r)]);return{previewBlob:n,analysisData:a}}async function Bl(e){const t=new Uint8Array(e);return lp(t)}const f3=e=>(e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e);async function Nx(e,t,r,n=!0){const a=await lp(new Uint8Array(e)),i=await lp(new Uint8Array(t));if(a.width!==i.width||a.height!==i.height)throw new Error("Dimension Mismatch");const o=a.width,s=a.height,l=r?f3(o):o,u=r?f3(s):s,d=l*u,f=new Uint16Array(d),h=32768,p=1.41421356;for(let x=0;x<s;x++){const g=x*o,b=x*l;for(let y=0;y<o;y++){const m=a.data[g+y],k=i.data[g+y];let S=m-k;n&&(S/=p);let w=S+h;w=Math.max(0,Math.min(65535,w)),f[b+y]=Math.round(w)}}return{rawData:f,width:l,height:u,metadata:a.metadata}}function nl(e,t,r,n,a,i,o){const s=Math.max(0,Math.floor(n)),l=Math.max(0,Math.floor(a)),u=Math.min(t,Math.ceil(n+i)),d=Math.min(r,Math.ceil(a+o)),f=[0,0,0,0],h=[0,0,0,0],p=[0,0,0,0];for(let b=l;b<d;b++){const y=b*t,m=b%2;for(let k=s;k<u;k++){const S=k%2,w=e[y+k],v=m*2+S;f[v]+=w,h[v]+=w*w,p[v]++}}const x=[0,0,0,0],g=[0,0,0,0];for(let b=0;b<4;b++)if(p[b]>0){const y=f[b]/p[b];x[b]=y;const k=h[b]/p[b]-y*y;g[b]=Math.sqrt(Math.max(0,k))}return{x:s,y:l,width:u-s,height:d-l,means:x,stdDevs:g,pixelCount:p.reduce((b,y)=>b+y,0)}}function X8(e,t,r,n,a,i=!1){const o=Math.floor(Math.max(0,r.x)),s=Math.floor(Math.max(0,r.y)),l=Math.ceil(Math.min(t,r.x+r.w)),u=e.length/t,d=Math.ceil(Math.min(u,r.y+r.h)),f=[0,0,0,0],h=[0,0,0,0];for(let L=s;L<d;L++){const C=L*t,$=L%2;for(let A=o;A<l;A++){const O=A%2,F=$*2+O,D=e[C+A],W=n[F]||0;f[F]+=Math.max(0,D-W),h[F]++}}let p=0,x=3;i&&(p=3,x=0);const g=h[p]>0?f[p]/h[p]:1,b=(f[1]+f[2])/(h[1]+h[2]||1),y=h[x]>0?f[x]/h[x]:1;if(g<1||b<1||y<1)return[1,1];const m=[[a[0],a[1],a[2]],[a[3],a[4],a[5]],[a[6],a[7],a[8]]],k=Lo(m);if(!k)return console.warn("Color Matrix is not invertible, falling back to standard WB"),[b/g,b/y];const S=Jc(a2,k),w=Lo(S);let v=1,M=1,N=1;if(w)v=w[0][0]+w[0][1]+w[0][2],M=w[1][0]+w[1][1]+w[1][2],N=w[2][0]+w[2][1]+w[2][2],Math.abs(M)<1e-6&&(M=1);else return console.warn("Final Matrix is not invertible"),[b/g,b/y];const _=b/g,P=b/y,E=v/M,R=N/M,T=_*E,G=P*R;return[Math.max(0,T),Math.max(0,G)]}function h3(e,t,r,n,a,i,o=0,s=0,l=!1){const u=Math.max(0,Math.floor(n.x)),d=Math.max(0,Math.floor(n.y)),f=Math.min(t,Math.ceil(n.x+n.w)),h=Math.min(r,Math.ceil(n.y+n.h));if(l&&e.length>=t*r*3){if(a<0||a>2||i<0||i>2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const P=(O,F,D)=>e[(O*t+F)*3+D];let E=0,R=0,T=0;for(let O=d;O<h;O++)for(let F=u;F<f;F++){const D=O+o,W=F+s;D<d||D>=h||W<u||W>=f||(E+=P(O,F,a),R+=P(D,W,i),T++)}if(T<2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const G=E/T,L=R/T;let C=0,$=0,A=0;for(let O=d;O<h;O++)for(let F=u;F<f;F++){const D=O+o,W=F+s;if(D<d||D>=h||W<u||W>=f)continue;const H=P(O,F,a),Y=P(D,W,i),te=H-G,U=Y-L;C+=te*U,$+=te*te,A+=U*U}return{sumCov:C,sumVar1:$,sumVar2:A,n:T}}const x=a>>1,g=a&1,b=(i>>1)+o,y=(i&1)+s;let m=0,k=0,S=0;for(let P=d;P<h-2;P+=2)for(let E=u;E<f-2;E+=2){const R=(P+x)*t+(E+g),T=(P+b)*t+(E+y);P+b>=r||E+y>=t||(m+=e[R],k+=e[T],S++)}if(S<2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const w=m/S,v=k/S;let M=0,N=0,_=0;for(let P=d;P<h-2;P+=2)for(let E=u;E<f-2;E+=2){const R=(P+x)*t+(E+g),T=(P+b)*t+(E+y);if(P+b>=r||E+y>=t)continue;const G=e[R],L=e[T],C=G-w,$=L-v;M+=C*$,N+=C*C,_+=$*$}return{sumCov:M,sumVar1:N,sumVar2:_,n:S}}function K8(e){if(e.n<2)return 0;const t=Math.sqrt(e.sumVar1*e.sumVar2);return t===0?0:e.sumCov/t}function Y8(e,t,r,n,a,i,o,s,l,u,d,f=!1){if(u<=l)return[];const h=Math.max(0,Math.floor(n)),p=Math.max(0,Math.floor(a)),x=Math.min(t,Math.ceil(n+i)),g=Math.min(r,Math.ceil(a+o)),b=u-l,y=d?Math.floor(b)+1:s,m=b/y,k=[new Uint32Array(y),new Uint32Array(y),new Uint32Array(y),new Uint32Array(y)];if(f&&e.length>=t*r*3)for(let v=p;v<g;v++){const M=v*t;for(let N=h;N<x;N++){const _=(M+N)*3;for(let P=0;P<3;P++){const E=e[_+P];if(E<l||E>u)continue;let R;d?R=Math.floor(E-l):R=Math.floor((E-l)/m),R<0&&(R=0),R>=y&&(R=y-1),k[P][R]++}}}else for(let v=p;v<g;v++){const M=v*t,N=v%2;for(let _=h;_<x;_++){const P=_%2,E=e[M+_];if(E<l||E>u)continue;const R=N*2+P;let T;d?T=Math.floor(E-l):T=Math.floor((E-l)/m),T<0&&(T=0),T>=y&&(T=y-1),k[R][T]++}}const w=[];for(let v=0;v<y;v++){const M=l+(d?v:v*m);w.push({binStart:M,c0:k[0][v],c1:k[1][v],c2:k[2][v],c3:k[3][v]})}return w}function q8(e,t,r,n,a,i=!1,o=!1,s={rows:!1,rowGroup:0,cols:!1,colGroup:0},l=!0,u=1,d=!1){const f=Math.max(0,Math.floor(n.x)),h=Math.max(0,Math.floor(n.y)),p=Math.min(t,Math.ceil(n.x+n.w)),x=Math.min(r,Math.ceil(n.y+n.h)),g=p-f,b=x-h;if(g<=1||b<=1)return null;const y=d&&e.length>=t*r*3;if(y){if(a<0||a>2)return null}else if(a<0||a>3)return null;let m=0,k=0;if(y)m=p-f,k=x-h;else{for(let T=f;T<p;T++)T%2===(a&1)&&m++;for(let T=h;T<x;T++)T%2===a>>1&&k++}if(m<4||k<4)return null;const S=Math.max(1,u),w=Math.floor(2*m/(S+1)),v=Math.floor(2*k/(S+1));if(w<4||v<4)return null;const M=new Il(w),N=new Il(v),_=new Float32Array(Math.floor(w/2)+1),P=new Float32Array(Math.floor(v/2)+1);let E=0,R=0;for(let T=h;T<x;T++){const G=T%2;if(!y&&a>>1!==G||s.rows&&(y?T&1:T>>1&1)!==s.rowGroup)continue;const L=T*t,C=new Float32Array(m);let $=0;for(let A=f;A<p;A++){if(!y&&A%2!==(a&1)||$>=m)continue;const O=y?e[(L+A)*3+a]:e[L+A],F=Number.isFinite(O)?O:0;C[$++]=F}for(let A=0;A<S;A++){const O=Math.floor(A*w/2);if(O+w>m)break;const F=C.slice(O,O+w);M.calculateSpectrum(F,_,o),E++}if(!l)break}for(let T=f;T<p;T++){const G=T%2;if(!y&&(a&1)!==G||s.cols&&(y?T&1:T>>1&1)!==s.colGroup)continue;const L=new Float32Array(k);let C=0;for(let $=h;$<x;$++){if(!y&&$%2!==a>>1||C>=k)continue;const A=y?e[($*t+T)*3+a]:e[$*t+T],O=Number.isFinite(A)?A:0;L[C++]=O}for(let $=0;$<S;$++){const A=Math.floor($*v/2);if(A+v>k)break;const O=L.slice(A,A+v);N.calculateSpectrum(O,P,o),R++}if(!l)break}if(E>0)for(let T=0;T<_.length;T++)_[T]/=E;if(R>0)for(let T=0;T<P.length;T++)P[T]/=R;return{avgHoriz:Array.from(_),avgVert:Array.from(P),sampleCount:{h:E,v:R}}}function Z8(e,t,r,n,a,i=!1,o=!1){const s=Math.max(0,Math.floor(n.x)),l=Math.max(0,Math.floor(n.y)),u=Math.min(t,Math.ceil(n.x+n.w)),d=Math.min(r,Math.ceil(n.y+n.h));if(o&&e.length>=t*r*3){if(a<0||a>2)return null;const S=u-s,w=d-l;if(S<=0||w<=0)return null;const v=new Float32Array(S*w);let M=0;for(let P=l;P<d;P++)for(let E=s;E<u;E++)v[M++]=e[(P*t+E)*3+a];const N=Gk(v,S,w,i),_=Uk(N,S,w);return{width:S,height:w,data:_}}let h=-1;for(let S=l;S<d;S++)if(S%2===a>>1){h=S;break}if(h===-1)return null;let p=-1;for(let S=s;S<u;S++)if(S%2===(a&1)){p=S;break}if(p===-1)return null;const x=[];for(let S=h;S<d;S+=2){const w=S*t,v=[];for(let M=p;M<u;M+=2)v.push(e[w+M]);x.push(v)}const g=x.length;if(g===0)return null;const b=x[0].length;if(b===0)return null;const y=new Float32Array(b*g);for(let S=0;S<g;S++){const w=x[S];for(let v=0;v<b;v++)y[S*b+v]=w[v]}const m=Gk(y,b,g,i),k=Uk(m,b,g);return{width:b,height:g,data:k}}function J8(e,t,r,n,a,i,o,s=!1){const{x:l,y:u,w:d,h:f}=n,h=[],p=Math.max(0,Math.floor(l)),x=Math.max(0,Math.floor(u)),g=Math.min(t,Math.ceil(l+d)),b=Math.min(r,Math.ceil(u+f));if(s&&e.length>=t*r*3){if(a<0||a>2)return null;for(let v=x;v<b;v++){const M=v*t;for(let N=p;N<g;N++){const _=e[(M+N)*3+a];_>=i&&_<=o&&h.push(_-i)}}}else{if(a<0||a>3)return null;const v=a>>1,M=a&1;for(let N=x;N<b;N++){if(N%2!==v)continue;const _=N*t;for(let P=p;P<g;P++){if(P%2!==M)continue;const E=e[_+P];E>=i&&E<=o&&h.push(E-i)}}}if(h.length===0)return null;h.sort((v,M)=>v-M);const m=[h[0]];for(let v=1;v<h.length;v++)h[v]!==h[v-1]&&m.push(h[v]);const k=[],S=[],w={};for(let v=0;v<m.length-1;v++){const M=m[v],_=m[v+1]-M;k.push(_),S.push({x:M,y:_}),w[_]=(w[_]||0)+1}return{uniqueCount:m.length,diffCount:k.length,stepCounts:w,plotData:S}}function i2(e,t,r){if(!r.advancedZeroDep)throw new Error("Unmixing settings not found in DisplaySettings.");const{bl:n,bg:a,fg:i}=r.advancedZeroDep,{data:o,width:s,whiteLevel:l}=e,u=a.map((k,S)=>Math.max(0,k-n[S])),d=i.map((k,S)=>Math.max(0,k-n[S])),f=(u[1]+u[3])/2,h=(d[1]+d[3])/2,p=Math.floor(t.x),x=Math.floor(t.y),g=Math.floor(t.w),b=Math.floor(t.h),y=Math.pow(2,r.exposure),m=new Uint16Array(g*b);for(let k=0;k<b;k++){const S=x+k;if(S<0||S>=e.height)continue;const w=S%2,v=S*s,M=k*g;for(let N=0;N<g;N++){const _=p+N;if(_<0||_>=s)continue;const P=_%2;let E=0;!w&&!P?E=0:!w&&P?E=1:w&&!P?E=3:E=2;const R=o[v+_],T=n[E],G=u[E],L=d[E],C=Math.max(R-T,0),$=L-G||1e-9,A=(C-G)/$;let O;A<0?O=C*(f/Math.max(G,1e-9)):A>1?O=C*(h/Math.max(L,1e-9)):O=(1-A)*f+A*h,O*=y,m[M+N]=Math.max(0,Math.min(65535,Math.round(O)))}}return{data:m,width:g,height:b}}async function Q8(e,t){const r=await zs(),n=new r;try{const a=new Uint8Array(e.slice(0));let i=!1,o=[];if(t.customMatrix&&t.customMatrix.length===9){const h=[[t.customMatrix[0],t.customMatrix[1],t.customMatrix[2]],[t.customMatrix[3],t.customMatrix[4],t.customMatrix[5]],[t.customMatrix[6],t.customMatrix[7],t.customMatrix[8]]],p=Lo(h);if(p){const x=t.wbGains?t.wbGains[0]:1,g=t.wbGains?t.wbGains[1]:1,y=Jc(p,[[x,0,0],[0,1,0],[0,0,g]]),m=Jc(a2,y);o=[m[0][0],m[0][1],m[0][2],m[1][0],m[1][1],m[1][2],m[2][0],m[2][1],m[2][2]],i=!0}else throw new Error("Custom Matrix is not invertible.")}const s={outputBps:16,noAutoBright:!0,bright:i?1:Math.pow(2,t.exposure)};t.blackLevel&&t.blackLevel.length===4&&(s.userBlack=0,s.userCblack=t.blackLevel.map(h=>{const p=Math.round(h);return p===0?1:p})),t.demosaicMethod===-1?s.noInterpolation=!0:s.userQual=t.demosaicMethod,i?(s.outputColor=0,s.gamma=[1,1],s.userMul=[1,1,1,1],s.useCameraWb=!1):(s.outputColor=1,s.useCameraWb=!0),await n.open(a,s);const l=await n.imageData(),u=new ImageData(l.width,l.height),d=u.data,f=new Uint16Array(l.data.buffer,l.data.byteOffset,l.data.byteLength/2);if(i&&o.length===9){const h=o,x=Math.pow(2,t.exposure)*.25;for(let g=0;g<f.length;g+=3){const b=f[g]/65535,y=f[g+1]/65535,m=f[g+2]/65535;let k=h[0]*b+h[1]*y+h[2]*m,S=h[3]*b+h[4]*y+h[5]*m,w=h[6]*b+h[7]*y+h[8]*m;k*=x,S*=x,w*=x,k=Math.max(0,Math.min(1,k)),S=Math.max(0,Math.min(1,S)),w=Math.max(0,Math.min(1,w)),k=to(k),S=to(S),w=to(w);const v=g/3*4;d[v]=Math.round(k*255),d[v+1]=Math.round(S*255),d[v+2]=Math.round(w*255),d[v+3]=255}}else for(let h=0;h<f.length;h+=3){const p=h/3*4;d[p]=f[h]>>8,d[p+1]=f[h+1]>>8,d[p+2]=f[h+2]>>8,d[p+3]=255}return u}finally{n.delete?n.delete():n.close()}}async function _x(e,t){const r=await zs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const g=await n.metadata(!0);g&&g.white_level&&(a=g.white_level)}catch(g){console.warn("Metadata error",g)}const i=n.getRawImage(),o=i.width,s=i.height,l=i.data,u=new ImageData(o,s),d=u.data,f=t.blackLevel||[0,0,0,0],h=a,p=t.wbGains?t.wbGains[0]:1,x=t.wbGains?t.wbGains[1]:1;for(let g=0;g<s;g++){const b=g%2;for(let y=0;y<o;y++){const m=y%2,k=b*2+m,S=l[g*o+y],w=f[k];let v=(S-w)/(h-w);v=Math.max(0,Math.min(1,v)),t.exposure!==0&&(v*=Math.pow(2,t.exposure),v=Math.min(1,v)),k===0?v*=p:k===3&&(v*=x);const M=Math.round(to(Math.min(1,v))*255),N=(g*o+y)*4;d[N]=M,d[N+1]=M,d[N+2]=M,d[N+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function eI(e,t){const r=await zs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const A=await n.metadata(!0);A&&A.white_level&&(a=A.white_level)}catch{}const i=n.getRawImage(),{width:o,height:s,data:l}=i,u=new ImageData(o,s),d=u.data,f=t.blackLevel||[0,0,0,0],h=a,p=t.wbGains?t.wbGains[0]:1,x=t.wbGains?t.wbGains[1]:1,g=Math.pow(2,t.exposure),b=!!t.isBGGR,y=t.zeroDepColorDemosaic==="bilinear"?"bilinear":"amaze";let m=[[1,0,0],[0,1,0],[0,0,1]];if(t.customMatrix&&t.customMatrix.length===9){const A=[[t.customMatrix[0],t.customMatrix[1],t.customMatrix[2]],[t.customMatrix[3],t.customMatrix[4],t.customMatrix[5]],[t.customMatrix[6],t.customMatrix[7],t.customMatrix[8]]],O=Lo(A);O&&(m=Jc(a2,O))}const k=m[0][0],S=m[0][1],w=m[0][2],v=m[1][0],M=m[1][1],N=m[1][2],_=m[2][0],P=m[2][1],E=m[2][2],R=new Float32Array(o*s);for(let A=0;A<o*s;A++){const O=Math.floor(A/o),F=A%o,D=O%2,W=F%2,H=D*2+W,Y=l[A],te=f[H];let U=(Y-te)/(h-te);U=Math.max(0,U),b?H===0?U*=x:H===3&&(U*=p):H===0?U*=p:H===3&&(U*=x),R[A]=U}const T=(A,O)=>{const F=Math.max(0,Math.min(o-1,A)),D=Math.max(0,Math.min(s-1,O));return R[D*o+F]},G=(A,O,F)=>{const D=2*O/(A+F+1e-6),W=O+.5*(A-F);return Math.abs(1-D)<.75?A*D:W},L=(A,O)=>{const F=T(A,O),D=G(F,T(A,O-1),T(A,O-2)),W=G(F,T(A,O+1),T(A,O+2)),H=G(F,T(A-1,O),T(A-2,O)),Y=G(F,T(A+1,O),T(A+2,O)),te=1/(1e-6+Math.abs(T(A,O-2)-F)+Math.abs(T(A,O-1)-T(A,O+1))),U=1/(1e-6+Math.abs(T(A,O+2)-F)+Math.abs(T(A,O+1)-T(A,O-1))),Se=1/(1e-6+Math.abs(T(A-2,O)-F)+Math.abs(T(A-1,O)-T(A+1,O))),re=1/(1e-6+Math.abs(T(A+2,O)-F)+Math.abs(T(A+1,O)-T(A-1,O))),J=(te*D+U*W)/(te+U),ne=(Se*H+re*Y)/(Se+re),ce=Math.abs(T(A-1,O)-T(A+1,O))+Math.abs(T(A-2,O)-F)+Math.abs(F-T(A+2,O)),ie=Math.abs(T(A,O-1)-T(A,O+1))+Math.abs(T(A,O-2)-F)+Math.abs(F-T(A,O+2)),se=1/(1e-6+ce),oe=1/(1e-6+ie);return(se*ne+oe*J)/(se+oe)},C=(A,O)=>{const F=T(A,O),D=G(F,T(A+1,O-1),T(A+2,O-2)),W=G(F,T(A-1,O+1),T(A-2,O+2)),H=G(F,T(A-1,O-1),T(A-2,O-2)),Y=G(F,T(A+1,O+1),T(A+2,O+2)),te=1/(1e-6+Math.abs(T(A+1,O-1)-T(A-1,O+1))+Math.abs(T(A+2,O-2)-T(A-2,O+2))),U=1/(1e-6+Math.abs(T(A-1,O-1)-T(A+1,O+1))+Math.abs(T(A-2,O-2)-T(A+2,O+2)));return(te*(D+W)+U*(H+Y))/(2*(te+U))},$=(A,O,F)=>{const D=T(A,O);if(F){const U=G(D,T(A-1,O),T(A-2,O)),Se=G(D,T(A+1,O),T(A+2,O)),re=1/(1e-6+Math.abs(T(A-2,O)-D)+Math.abs(T(A-1,O)-T(A+1,O))),J=1/(1e-6+Math.abs(T(A+2,O)-D)+Math.abs(T(A+1,O)-T(A-1,O)));return(re*U+J*Se)/(re+J)}const W=G(D,T(A,O-1),T(A,O-2)),H=G(D,T(A,O+1),T(A,O+2)),Y=1/(1e-6+Math.abs(T(A,O-2)-D)+Math.abs(T(A,O-1)-T(A,O+1))),te=1/(1e-6+Math.abs(T(A,O+2)-D)+Math.abs(T(A,O+1)-T(A,O-1)));return(Y*W+te*H)/(Y+te)};for(let A=1;A<s-1;A++){const O=A%2,F=A*o;for(let D=1;D<o-1;D++){const W=D%2,H=F+D;let Y=0,te=0,U=0,Se=!1,re=!1,J=!1;if(!O&&!W?b?re=!0:Se=!0:O&&W?b?Se=!0:re=!0:J=!0,Se)Y=R[H],y==="amaze"?(te=L(D,A),U=C(D,A)):(te=(R[H-1]+R[H+1]+R[H-o]+R[H+o])*.25,U=(R[H-o-1]+R[H-o+1]+R[H+o-1]+R[H+o+1])*.25);else if(re)U=R[H],y==="amaze"?(te=L(D,A),Y=C(D,A)):(te=(R[H-1]+R[H+1]+R[H-o]+R[H+o])*.25,Y=(R[H-o-1]+R[H-o+1]+R[H+o-1]+R[H+o+1])*.25);else{te=R[H];const oe=(R[H-1]+R[H+1])*.5,ke=(R[H-o]+R[H+o])*.5;let le=!1;!O&&W?b?le=!1:le=!0:b?le=!0:le=!1,y==="amaze"?le?(Y=$(D,A,!0),U=$(D,A,!1)):(U=$(D,A,!0),Y=$(D,A,!1)):le?(Y=oe,U=ke):(U=oe,Y=ke)}let ne=k*Y+S*te+w*U,ce=v*Y+M*te+N*U,ie=_*Y+P*te+E*U;ne*=g,ce*=g,ie*=g,ne=Math.max(0,Math.min(1,ne)),ce=Math.max(0,Math.min(1,ce)),ie=Math.max(0,Math.min(1,ie)),ne=to(ne),ce=to(ce),ie=to(ie);const se=H*4;d[se]=Math.round(ne*255),d[se+1]=Math.round(ce*255),d[se+2]=Math.round(ie*255),d[se+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function tI(e,t){const r=await zs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const m=await n.metadata(!0);m&&m.white_level&&(a=m.white_level)}catch(m){console.warn("Metadata error",m)}const i=n.getRawImage(),{width:o,height:s,data:l}=i,u=new ImageData(o,s),d=u.data;if(!t.advancedZeroDep)throw new Error("Missing advanced settings");const{bl:f,bg:h,fg:p}=t.advancedZeroDep,x=h.map((m,k)=>Math.max(0,m-f[k])),g=p.map((m,k)=>Math.max(0,m-f[k])),b=(x[1]+x[3])/2,y=(g[1]+g[3])/2;for(let m=0;m<s;m++){const k=m%2;for(let S=0;S<o;S++){const w=S%2;let v=0;!k&&!w?v=0:!k&&w?v=1:k&&!w?v=3:v=2;const M=l[m*o+S],N=f[v],_=x[v],P=g[v],E=Math.max(M-N,0),R=P-_||1e-9,T=(E-_)/R;let G;T<0?G=E*(b/Math.max(_,1e-9)):T>1?G=E*(y/Math.max(P,1e-9)):G=(1-T)*b+T*y;let L=G/65535;L=Math.max(0,Math.min(1,L));const C=Math.round(to(L)*255),$=(m*o+S)*4;d[$]=C,d[$+1]=C,d[$+2]=C,d[$+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function w_(e,t,r=!1,n=!1){const a=await zs(),i=new a;try{if(t.renderMode==="zero-dependency"||t.renderMode==="advanced-zero-dep"){await i.open(new Uint8Array(e));const o=await i.metadata(!0),s=(o==null?void 0:o.white_level)||16383,l=i.getRawImage(),{width:u,height:d,data:f}=l,h=new Uint16Array(u*d),p=Math.pow(2,t.exposure);if(t.renderMode==="advanced-zero-dep"&&t.advancedZeroDep){const{bl:x,bg:g,fg:b}=t.advancedZeroDep,y=g.map((w,v)=>Math.max(0,w-x[v])),m=b.map((w,v)=>Math.max(0,w-x[v])),k=(y[1]+y[3])/2,S=(m[1]+m[3])/2;for(let w=0;w<d;w++){const v=w%2;for(let M=0;M<u;M++){const N=M%2;let _=0;!v&&!N?_=0:!v&&N?_=1:v&&!N?_=3:_=2;const P=f[w*u+M],E=x[_],R=y[_],T=m[_],G=Math.max(P-E,0),L=T-R||1e-9,C=(G-R)/L;let $;C<0?$=G*(k/Math.max(R,1e-9)):C>1?$=G*(S/Math.max(T,1e-9)):$=(1-C)*k+C*S,$*=p;let A;if(n){const O=Math.max(0,Math.min(1,$/65535));A=to(O)*65535}else A=$;h[w*u+M]=Math.round(Math.max(0,Math.min(65535,A)))}}}else{const x=t.blackLevel||[0,0,0,0],g=t.wbGains?t.wbGains[0]:1,b=t.wbGains?t.wbGains[1]:1;for(let y=0;y<d;y++){const m=y%2;for(let k=0;k<u;k++){const S=k%2,w=m*2+S,v=f[y*u+k],M=x[w];let N=v-M;w===0?N*=g:w===3&&(N*=b),N*=p;const _=Math.max(0,Math.min(1,N/(r?s-M:s))),P=n?to(_):_;h[y*u+k]=Math.round(P*65535)}}}return{data:h,width:u,height:d,channels:1}}else{const o=new Uint8Array(e.slice(0)),s={outputBps:16,noAutoBright:!r,bright:1,outputColor:n?1:0,useCameraWb:!0};t.blackLevel&&t.blackLevel.length===4&&(s.userBlack=0,s.userCblack=t.blackLevel.map(f=>Math.max(1,Math.round(f)))),t.demosaicMethod===-1?s.noInterpolation=!0:s.userQual=t.demosaicMethod,await i.open(o,s);const l=await i.imageData(),u=new Uint16Array(l.data.buffer,l.data.byteOffset,l.data.byteLength/2),d=Math.pow(2,t.exposure);if(d!==1)for(let f=0;f<u.length;f++)u[f]=Math.max(0,Math.min(65535,Math.round(u[f]*d)));return{data:u,width:l.width,height:l.height,channels:3}}}finally{i.delete?i.delete():i.close()}}async function rI(e,t){const r={...t,renderMode:"standard",demosaicMethod:t.demosaicMethod===-1?3:t.demosaicMethod},n=await w_(e,r,!1,!1),a=n.width*n.height,i=new Float32Array(a*3);if(n.channels===3)for(let o=0;o<n.data.length;o++)i[o]=n.data[o]/65535;else for(let o=0;o<a;o++){const s=n.data[o]/65535,l=o*3;i[l]=s,i[l+1]=s,i[l+2]=s}return{data:i,width:n.width,height:n.height}}const nI=Object.assign({"../lensfun/6x6.xml":()=>Mt(()=>import("./6x6-Dud9lWUd.js"),[]).then(e=>e.default),"../lensfun/actioncams.xml":()=>Mt(()=>import("./actioncams-Cg5HQ60A.js"),[]).then(e=>e.default),"../lensfun/compact-canon.xml":()=>Mt(()=>import("./compact-canon-BDgHCadq.js"),[]).then(e=>e.default),"../lensfun/compact-casio.xml":()=>Mt(()=>import("./compact-casio-CDzufeyu.js"),[]).then(e=>e.default),"../lensfun/compact-fujifilm.xml":()=>Mt(()=>import("./compact-fujifilm-BuFyPBlo.js"),[]).then(e=>e.default),"../lensfun/compact-kodak.xml":()=>Mt(()=>import("./compact-kodak-DICTBwTD.js"),[]).then(e=>e.default),"../lensfun/compact-konica-minolta.xml":()=>Mt(()=>import("./compact-konica-minolta-BKI4omr1.js"),[]).then(e=>e.default),"../lensfun/compact-leica.xml":()=>Mt(()=>import("./compact-leica-B1Fqeeu3.js"),[]).then(e=>e.default),"../lensfun/compact-nikon.xml":()=>Mt(()=>import("./compact-nikon-Q231DWRs.js"),[]).then(e=>e.default),"../lensfun/compact-olympus.xml":()=>Mt(()=>import("./compact-olympus-BmAKd-oF.js"),[]).then(e=>e.default),"../lensfun/compact-panasonic.xml":()=>Mt(()=>import("./compact-panasonic-DJuEnLOf.js"),[]).then(e=>e.default),"../lensfun/compact-pentax.xml":()=>Mt(()=>import("./compact-pentax-CK-wShH4.js"),[]).then(e=>e.default),"../lensfun/compact-ricoh.xml":()=>Mt(()=>import("./compact-ricoh-DbsLlRAS.js"),[]).then(e=>e.default),"../lensfun/compact-samsung.xml":()=>Mt(()=>import("./compact-samsung-CBNQmwIs.js"),[]).then(e=>e.default),"../lensfun/compact-sigma.xml":()=>Mt(()=>import("./compact-sigma-Ce4mbNmr.js"),[]).then(e=>e.default),"../lensfun/compact-sony.xml":()=>Mt(()=>import("./compact-sony-aE387uCd.js"),[]).then(e=>e.default),"../lensfun/contax.xml":()=>Mt(()=>import("./contax-lfgVw8XE.js"),[]).then(e=>e.default),"../lensfun/generic.xml":()=>Mt(()=>import("./generic-CnlCoerb.js"),[]).then(e=>e.default),"../lensfun/mil-canon.xml":()=>Mt(()=>import("./mil-canon-CsP2d6LD.js"),[]).then(e=>e.default),"../lensfun/mil-fujifilm.xml":()=>Mt(()=>import("./mil-fujifilm-F3oKEIYZ.js"),[]).then(e=>e.default),"../lensfun/mil-hasselblad.xml":()=>Mt(()=>import("./mil-hasselblad-DeXxLlTg.js"),[]).then(e=>e.default),"../lensfun/mil-leica.xml":()=>Mt(()=>import("./mil-leica-Czic2o9o.js"),[]).then(e=>e.default),"../lensfun/mil-nikon.xml":()=>Mt(()=>import("./mil-nikon-DkZbaqBH.js"),[]).then(e=>e.default),"../lensfun/mil-olympus.xml":()=>Mt(()=>import("./mil-olympus-DWRA_NNZ.js"),[]).then(e=>e.default),"../lensfun/mil-panasonic.xml":()=>Mt(()=>import("./mil-panasonic-CsQ7Qk1h.js"),[]).then(e=>e.default),"../lensfun/mil-pentax.xml":()=>Mt(()=>import("./mil-pentax-ClXRigoa.js"),[]).then(e=>e.default),"../lensfun/mil-samsung.xml":()=>Mt(()=>import("./mil-samsung-BbQ5TjXi.js"),[]).then(e=>e.default),"../lensfun/mil-samyang.xml":()=>Mt(()=>import("./mil-samyang-CyxQtljS.js"),[]).then(e=>e.default),"../lensfun/mil-sigma.xml":()=>Mt(()=>import("./mil-sigma-C4H9prlz.js"),[]).then(e=>e.default),"../lensfun/mil-sony.xml":()=>Mt(()=>import("./mil-sony-D2U1LHts.js"),[]).then(e=>e.default),"../lensfun/mil-tamron.xml":()=>Mt(()=>import("./mil-tamron-B5g4hRYO.js"),[]).then(e=>e.default),"../lensfun/mil-tokina.xml":()=>Mt(()=>import("./mil-tokina-Cs1l9ZTO.js"),[]).then(e=>e.default),"../lensfun/mil-zeiss.xml":()=>Mt(()=>import("./mil-zeiss-avF4V-6T.js"),[]).then(e=>e.default),"../lensfun/misc.xml":()=>Mt(()=>import("./misc-DDds1gXl.js"),[]).then(e=>e.default),"../lensfun/om-system.xml":()=>Mt(()=>import("./om-system-DiAB48fM.js"),[]).then(e=>e.default),"../lensfun/rf-leica.xml":()=>Mt(()=>import("./rf-leica-B--SzUq2.js"),[]).then(e=>e.default),"../lensfun/slr-canon.xml":()=>Mt(()=>import("./slr-canon-CgVCqXGM.js"),[]).then(e=>e.default),"../lensfun/slr-hasselblad.xml":()=>Mt(()=>import("./slr-hasselblad-C1loeXzI.js"),[]).then(e=>e.default),"../lensfun/slr-konica-minolta.xml":()=>Mt(()=>import("./slr-konica-minolta-D38k_LOC.js"),[]).then(e=>e.default),"../lensfun/slr-leica.xml":()=>Mt(()=>import("./slr-leica-c2xbyark.js"),[]).then(e=>e.default),"../lensfun/slr-nikon.xml":()=>Mt(()=>import("./slr-nikon-CRCAIYTn.js"),[]).then(e=>e.default),"../lensfun/slr-olympus.xml":()=>Mt(()=>import("./slr-olympus-dFRFPB-U.js"),[]).then(e=>e.default),"../lensfun/slr-panasonic.xml":()=>Mt(()=>import("./slr-panasonic-JG8UEfod.js"),[]).then(e=>e.default),"../lensfun/slr-pentax.xml":()=>Mt(()=>import("./slr-pentax-CFNePcmx.js"),[]).then(e=>e.default),"../lensfun/slr-ricoh.xml":()=>Mt(()=>import("./slr-ricoh-9U2ATHkn.js"),[]).then(e=>e.default),"../lensfun/slr-samsung.xml":()=>Mt(()=>import("./slr-samsung-C2vmR_UF.js"),[]).then(e=>e.default),"../lensfun/slr-samyang.xml":()=>Mt(()=>import("./slr-samyang-DNuAvYvk.js"),[]).then(e=>e.default),"../lensfun/slr-schneider.xml":()=>Mt(()=>import("./slr-schneider-BFavwTAS.js"),[]).then(e=>e.default),"../lensfun/slr-sigma.xml":()=>Mt(()=>import("./slr-sigma-CkwWa641.js"),[]).then(e=>e.default),"../lensfun/slr-soligor.xml":()=>Mt(()=>import("./slr-soligor-CoIp1oZj.js"),[]).then(e=>e.default),"../lensfun/slr-sony.xml":()=>Mt(()=>import("./slr-sony-BgsLb2KN.js"),[]).then(e=>e.default),"../lensfun/slr-tamron.xml":()=>Mt(()=>import("./slr-tamron-DqtWr6vk.js"),[]).then(e=>e.default),"../lensfun/slr-tokina.xml":()=>Mt(()=>import("./slr-tokina-DQ0zZu9T.js"),[]).then(e=>e.default),"../lensfun/slr-ussr.xml":()=>Mt(()=>import("./slr-ussr-Bfn2DNi9.js"),[]).then(e=>e.default),"../lensfun/slr-vivitar.xml":()=>Mt(()=>import("./slr-vivitar-CIhiFdqq.js"),[]).then(e=>e.default),"../lensfun/slr-zeiss.xml":()=>Mt(()=>import("./slr-zeiss-DzcVUeAm.js"),[]).then(e=>e.default)}),rs=({title:e,children:t})=>c.jsxs("div",{className:"border-b border-gray-200 dark:border-slate-700 transition-colors duration-300",children:[c.jsx("div",{className:"p-4 font-semibold text-gray-800 dark:text-slate-200 bg-gray-50 dark:bg-slate-800/30 border-b border-gray-200 dark:border-slate-800 select-none cursor-default transition-colors duration-300",children:c.jsx("span",{children:e})}),c.jsx("div",{className:"p-4 bg-white dark:bg-slate-900/50 transition-colors duration-300",children:t})]}),aI=[{value:-1,label:"Raw Bayer (Grayscale)"},{value:0,label:"Linear interpolation"},{value:1,label:"VNG (Variable Number of Gradients)"},{value:2,label:"PPG (Patterned Pixel Grouping)"},{value:3,label:"AHD (Adaptive Homogeneity-Directed)"},{value:4,label:"DCB (Demosaicing with Color Back-refinement)"},{value:11,label:"DHT (Modified AHD)"},{value:12,label:"AAHD (Adaptive AHD)"}],K0=({checked:e,onChange:t,label:r})=>c.jsxs("div",{className:"flex items-center justify-between py-2 cursor-pointer group",onClick:()=>t(!e),children:[c.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-slate-300 select-none group-hover:text-gray-900 dark:group-hover:text-slate-200 transition-colors",children:r}),c.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors duration-200 ease-in-out ${e?"bg-cyan-500 dark:bg-cyan-600":"bg-gray-300 dark:bg-slate-600 group-hover:bg-gray-400 dark:group-hover:bg-slate-500"}`,children:c.jsx("div",{className:`absolute left-1 top-1 bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${e?"translate-x-5":"translate-x-0"}`})})]}),Px=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];return f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},Cx=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e!="string")return null;const t=e.match(/-?\d+(\.\d+)?/);if(!t)return null;const r=Number(t[0]);return Number.isFinite(r)?r:null},p3=(e,t)=>{var o,s,l,u;const n=new DOMParser().parseFromString(e,"application/xml");if(n.getElementsByTagName("parsererror").length>0)throw new Error(`Invalid XML in ${t}`);const a=Array.from(n.getElementsByTagName("lens")),i=[];for(const d of a){const f=((s=(o=d.getElementsByTagName("maker")[0])==null?void 0:o.textContent)==null?void 0:s.trim())||"",h=((u=(l=d.getElementsByTagName("model")[0])==null?void 0:l.textContent)==null?void 0:u.trim())||"",p=[],x=Array.from(d.getElementsByTagName("distortion"));for(const y of x){const m=(y.getAttribute("model")||"").toLowerCase(),k=Number(y.getAttribute("focal"));if(!Number.isFinite(k)||m!=="poly3"&&m!=="poly5"&&m!=="ptlens")continue;const S={model:m,focal:k,k1:Number(y.getAttribute("k1"))||0,k2:Number(y.getAttribute("k2"))||0,a:Number(y.getAttribute("a"))||0,b:Number(y.getAttribute("b"))||0,c:Number(y.getAttribute("c"))||0};p.push(S)}if(p.length===0)continue;p.sort((y,m)=>y.focal-m.focal);const b=([f,h].filter(Boolean).join(" ")||"Unnamed Lens").trim();i.push({id:`${t}:${b}:${i.length}`,label:b,distortions:p})}return i},m3=(e,t)=>{const r=new Map;for(const n of e)r.set(n.id,n);for(const n of t)r.set(n.id,n);return Array.from(r.values()).sort((n,a)=>n.label.localeCompare(a.label))},iI=(e,t,r)=>{if(e.model!==t.model||Math.abs(t.focal-e.focal)<1e-8)return{...e,focal:r};const n=Math.max(0,Math.min(1,(r-e.focal)/(t.focal-e.focal))),a=(i,o)=>(i||0)*(1-n)+(o||0)*n;return{model:e.model,focal:r,k1:a(e.k1,t.k1),k2:a(e.k2,t.k2),a:a(e.a,t.a),b:a(e.b,t.b),c:a(e.c,t.c)}},oI=(e,t)=>{if(!e.length||!Number.isFinite(t))return null;if(e.length===1)return{...e[0],focal:t};let r=e[0],n=e[e.length-1];for(let a=0;a<e.length;a++){const i=e[a];if(i.focal<=t&&(r=i),i.focal>=t){n=i;break}}return r.focal===n.focal?{...r,focal:t}:r.model!==n.model?{...Math.abs(r.focal-t)<=Math.abs(n.focal-t)?r:n,focal:t}:iI(r,n,t)},sI=e=>{var y0,b0,v0;const{rawImageData:t,displaySettings:r,onApplyDisplaySettings:n,onSetSelection:a,exifData:i,isBridgeConnected:o,isDrLabOpen:s,drMarkingStep:l,onStartMarking:u,onGenerateTestPic:d,drRoiSize:f,onDrRoiSizeChange:h,drGridRows:p,onDrGridRowsChange:x,drGridCols:g,onDrGridColsChange:b,onBatchDrLab:y,hasDrMarkers:m,isFftLabOpen:k,onProcessPair:S,onProcessBatchDiff:w,onProcessStackFft:v,onOpenCrossCalc:M,isThreePlane:N,onToggleXTrans:_,xtransPhase:P,onXTransPhaseChange:E,isXTransConverted:R,onCommand:T,isColorLabOpen:G,colorLabMarkingStep:L,onStartColorLabMarking:C,isSfrLabOpen:$,roiStats:A,isBGGR:O,onOpenDngExport:F,sfrRectCount:D,isBatchMarkingMode:W,onToggleBatchMarking:H,onClearBatchMarks:Y,onBatchCompute:te,stdChartStep:U,onStartStandardCalibration:Se,onSaveBatchTemplate:re,onImportBatchTemplate:J,onBatchTransform:ne,onOpenStackingTool:ce,isPsModeOpen:ie,psDocument:se,psBrushEnabled:oe,psBrushSize:ke,psBrushOpacity:le,psBrushFeather:fe,psEllipseFeather:Pe,psBrushMode:Fe,onPsAddMask:Ue,onPsAddEllipseMask:K,onPsCancelEllipseTool:_e,onPsFlipHorizontal:Te,onPsFlipVertical:Le,onPsCropToRoi:ft,onPsRotateCanvas:Xe,onPsApplyUpright:Ie,onPsApplyLensDistortion:ht,onPsSelectLayer:xt,onPsSelectMask:nt,onPsBindLayerMask:Gt,onPsSetLayerBlendMode:yt,onPsSetLayerOpacity:et,onPsSetLayerBasic:He,onPsSetLayerMixer:mt,onPsPreviewLayerBasic:jt,onPsPreviewLayerMixer:or,onPsSetLayerCurves:zt,onPsSelectMaskItem:ut,onPsUpdateEllipseItem:It,onPsSetMaskOverlayVisible:Lt,onPsAddGuide:Me,onPsSelectGuide:Z,onPsSetGuideEndpoints:xe,psGuidePickTarget:ue,onPsStartGuidePointPick:De,onPsCancelGuidePointPick:qe,onPsDeleteGuide:pt,onPsUndo:de,onPsJumpHistoryIndex:Ce,onPsExportWorkflowCsv:dt,onPsImportWorkflowCsv:Wt,onPsExportPng:Rt,onPsExportJpeg:kt,onPsBrushEnabledChange:qt,onPsBrushSizeChange:xr,onPsBrushOpacityChange:Ir,onPsBrushFeatherChange:fr,onPsEllipseFeatherChange:be,onPsBrushModeChange:tt}=e,it=!!t,Zt=!!(t!=null&&t.isXTrans),Vt=!!_,ot=j.useMemo(()=>!se||!se.selectedGuideId?null:se.guides.find(V=>V.id===se.selectedGuideId)||null,[se]),ir=j.useMemo(()=>{var V;return(V=se==null?void 0:se.history)!=null&&V.length?se.history.map((we,bt)=>({entry:we,index:bt})).reverse():[]},[se]),[yr,Ht]=j.useState("0"),Dt=j.useCallback(()=>{const V=Number(yr);Number.isFinite(V)&&(Xe==null||Xe(V))},[yr,Xe]),Ee=j.useRef(!1),er=j.useRef(null),B=()=>{Ee.current=!0},ge=()=>{Ee.current=!1},[ye,vt]=j.useState(r.exposure.toString()),[We,st]=j.useState(""),[Be,tr]=j.useState("0 0 0 0"),[br,Pr]=j.useState("1.0"),[Xt,Hr]=j.useState("1.0"),[Br,Ur]=j.useState(r.demosaicMethod),[ur,sr]=j.useState(!!r.showKadc),[hr,Ze]=j.useState(!!r.subtractBlackLevelFromStats),[rr,Rr]=j.useState(!!r.highlightRecovery),[hn,ra]=j.useState(((y0=t==null?void 0:t.whiteLevel)==null?void 0:y0.toString())||((b0=r.customWhiteLevel)==null?void 0:b0.toString())||"16383"),[Sn,Na]=j.useState("64"),[ae,me]=j.useState(!1),[je,Q]=j.useState(""),[ze,rt]=j.useState(""),[wt,Ot]=j.useState(""),[Jt,At]=j.useState(!1),[pr,vr]=j.useState(!1),[Dr,Xr]=j.useState(!1),[Ae,nr]=j.useState("amaze"),[gt,Tr]=j.useState(!1),[Cr,Mn]=j.useState(!1),[Sr,an]=j.useState("single"),[zn,zi]=j.useState(!1),[Wi,Zu]=j.useState(!0),[Zs,Ju]=j.useState(!0),[rc,cn]=j.useState(!1),[Ga,fo]=j.useState(10),[Ua,ho]=j.useState(1.05),Vi=j.useMemo(()=>Object.keys(tu).sort(),[]),po=j.useRef(null),Js=j.useRef(null),Hi=j.useRef(null),Ho=j.useRef(null),[Ye,dr]=j.useState(null),[Tt,cr]=j.useState(null),[pn,ha]=j.useState(!1),[bn,ki]=j.useState(!0),Yn=j.useRef(null),_a=j.useRef(null),Kr=j.useRef(null),na=j.useRef(null),mo=j.useRef(null),[Xo,Qs]=j.useState([]),[_t,nc]=j.useState(""),[Ct,Ko]=j.useState(""),[Yo,el]=j.useState(!1),[Qu,Pa]=j.useState("Built-in Lensfun database will load when PS Mode opens."),f0=j.useRef(!1);j.useEffect(()=>{if(!ie||f0.current)return;f0.current=!0;let V=!1;return(async()=>{Pa("Loading built-in Lensfun database...");const bt=Object.entries(nI);if(bt.length===0){V||Pa("No built-in Lensfun XML found in /lensfun. You can still load XML manually.");return}const lr=[];let zr=0;for(const[Ar,aa]of bt){const xo=Ar.split("/").pop()||Ar;try{const ai=await aa();lr.push(...p3(ai,xo))}catch{zr++}}if(V)return;if(lr.length===0){Pa("Built-in Lensfun XML loaded, but no supported distortion profiles were found.");return}Qs(Ar=>m3(Ar,lr)),nc(Ar=>Ar||lr[0].id);const En=zr>0?` (${zr} file(s) skipped)`:"";Pa(`Built-in Lensfun ready: ${lr.length} profile(s) from ${bt.length} XML file(s)${En}.`)})(),()=>{V=!0}},[ie]),j.useEffect(()=>{if(Ct.trim())return;const V=Cx(i==null?void 0:i.FocalLength)??Cx(i==null?void 0:i.FocalLength35efl)??Cx(i==null?void 0:i.FocalLengthIn35mmFormat);V&&V>0&&Ko(V.toFixed(1))},[i,Ct]),j.useEffect(()=>{const V=t!==er.current;if(V&&(er.current=t,ge()),vt(r.exposure.toString()),r.customMatrix?st(r.customMatrix.join(" ")):st(""),r.blackLevel&&r.blackLevel.length===4)tr(r.blackLevel.join(" "));else{const we=Px(t,i);we&&we.some(bt=>bt!==0)?tr(we.join(" ")):tr("")}Pr(r.wbGains?r.wbGains[0].toString():"1.0"),Hr(r.wbGains?r.wbGains[1].toString():"1.0"),Ur(r.demosaicMethod),sr(!!r.showKadc),Ze(!!r.subtractBlackLevelFromStats),V?(Rr(!1),t!=null&&t.whiteLevel?ra(t.whiteLevel.toString()):r.customWhiteLevel&&ra(r.customWhiteLevel.toString())):(Rr(!!r.highlightRecovery),r.customWhiteLevel?ra(r.customWhiteLevel.toString()):t!=null&&t.whiteLevel&&ra(t.whiteLevel.toString())),r.advancedZeroDep&&(Q(r.advancedZeroDep.bl.join(" ")),rt(r.advancedZeroDep.bg.join(" ")),Ot(r.advancedZeroDep.fg.join(" ")),V&&me(!0))},[r,t,i]);const tl=j.useRef(!1),go=j.useRef(null);j.useEffect(()=>{t!==go.current&&(tl.current=!1,go.current=t)},[t]),j.useEffect(()=>{if(o&&t&&!tl.current){tl.current=!0;const V=Px(t,i),we=V&&V.some(bt=>bt>0);if(V&&we){console.log("[AutoApply] Detected Black Levels via Bridge:",V);const bt={...r,blackLevel:V,showKadc:!1,subtractBlackLevelFromStats:!1,exposure:r.exposure,wbGains:r.wbGains||[1,1],demosaicMethod:-1,renderMode:"zero-dependency"};n(bt)}}},[o,t,i,r,n]);const h0=V=>{B(),vt(V)},p0=V=>{B(),Pr(V)},Cg=V=>{B(),Hr(V)},ed=V=>{B(),Ur(parseInt(V.target.value,10))},m0=V=>{B(),st(V.target.value)},ni=()=>{ge(),vt("0"),Ur(3),Pr("1.0"),Hr("1.0"),sr(!0),Ze(!0),st(""),Rr(!1),ra((t==null?void 0:t.whiteLevel.toString())||"16383"),me(!1);const V=Px(t,i);tr(V&&V.some(we=>we!==0)?V.join(" "):"")},za=()=>{!t||!a||(a({x:0,y:0,w:t.width,h:t.height}),T==null||T("sel full"))},Wa=()=>{if(!t||!a)return;const V=parseInt(Sn,10);if(isNaN(V)||V<=0)return;const we=Math.min(V,t.width),bt=Math.min(V,t.height),lr=Math.floor((t.width-we)/2),zr=Math.floor((t.height-bt)/2);a({x:lr,y:zr,w:we,h:bt}),T==null||T(`sel center ${V}`)},ac=()=>{if(!t||!A){alert("Please select a region on the image first.");return}const V=td()||[0,0,0,0],we=We.trim().replace(/[\s,\n]+/g," "),bt=we?we.split(" ").map(Number):[1,0,0,0,1,0,0,0,1];if(bt.length!==9){alert("Matrix must be 3x3 (9 values).");return}const[lr,zr]=X8(t.data,t.width,{x:A.x,y:A.y,w:A.width,h:A.height},V,bt,O);B(),Pr(lr.toFixed(4)),Hr(zr.toFixed(4)),T==null||T(`wb ${lr.toFixed(4)} ${zr.toFixed(4)} (Spot)`)},td=()=>{const we=Be.split(/[\s,]+/).filter(bt=>bt.trim()!=="").map(Number);if(we.length===1&&!isNaN(we[0]))return[we[0],we[0],we[0],we[0]];if(we.length>=4&&!we.slice(0,4).some(isNaN))return[we[0],we[1],we[2],we[3]]},rd=V=>{const we=V.trim().split(/[\s,]+/).map(Number);return we.length===4&&!we.some(isNaN)?we:we.length===1&&!isNaN(we[0])?[we[0],we[0],we[0],we[0]]:null},g0=()=>{ge(),T&&(ye!=="0"&&T(`ev ${ye}`),(br!=="1.0"||Xt!=="1.0")&&T(`wb ${br} ${Xt}`),Be!=="0 0 0 0"&&Be!==""&&T(`bl ${Be}`),Br!==3&&T(`demo ${Br}`),We.trim().length>0&&T(`matrix ${We.replace(/\s+/g," ")}`),T("render"));const V={...r},we=parseFloat(ye);isNaN(we)||(V.exposure=we);const bt=parseFloat(br),lr=parseFloat(Xt);!isNaN(bt)&&!isNaN(lr)&&(V.wbGains=[bt,lr]),V.demosaicMethod=Br,V.renderMode="standard";const zr=td();zr?V.blackLevel=zr:delete V.blackLevel;const En=We.trim().replace(/[\s,\n]+/g," ");if(En){const Ar=En.split(" ").map(Number);Ar.length===9&&!Ar.some(isNaN)?V.customMatrix=Ar:alert("Invalid matrix format. Please ensure exactly 9 numeric values (3x3).")}else delete V.customMatrix;if(V.showKadc=ur,V.subtractBlackLevelFromStats=hr,V.highlightRecovery=rr,rr){const Ar=parseFloat(hn);!isNaN(Ar)&&Ar>0&&(V.customWhiteLevel=Ar)}else delete V.customWhiteLevel;n(V)},nd=()=>{Xr(O||!1),nr("amaze"),vr(!0)},rl=V=>{ge(),T&&(ye!=="0"&&T(`ev ${ye}`),(br!=="1.0"||Xt!=="1.0")&&T(`wb ${br} ${Xt}`),Be!=="0 0 0 0"&&Be!==""&&T(`bl ${Be}`),T(V==="color"?"render zero color":"render zero"));const we={...r},bt=td();bt&&(we.blackLevel=bt);const lr=parseFloat(br),zr=parseFloat(Xt);!isNaN(lr)&&!isNaN(zr)&&(we.wbGains=[lr,zr]);const En=parseFloat(ye);if(isNaN(En)||(we.exposure=En),V==="color"){const Ar=We.trim().replace(/[\s,\n]+/g," ");if(Ar){const aa=Ar.split(" ").map(Number);aa.length===9&&!aa.some(isNaN)&&(we.customMatrix=aa)}we.isBGGR=Dr,we.zeroDepColorDemosaic=Ae}if(we.renderMode=V==="mosaic"?"zero-dependency":"zero-dep-color",we.showKadc=ur,we.subtractBlackLevelFromStats=hr,we.highlightRecovery=rr,rr){const Ar=parseFloat(hn);!isNaN(Ar)&&Ar>0&&(we.customWhiteLevel=Ar)}else delete we.customWhiteLevel;vr(!1),n(we)},ic=()=>{ge();const V=rd(je),we=rd(ze),bt=rd(wt);if(!V||!we||!bt){alert("Please enter valid 4-channel numbers for BL, BG, and FG.");return}T&&(ye!=="0"&&T(`ev ${ye}`),T(`render unmix ${V.join(" ")} ${we.join(" ")} ${bt.join(" ")}`));const lr={...r,renderMode:"advanced-zero-dep",advancedZeroDep:{bl:V,bg:we,fg:bt}};if(lr.showKadc=ur,lr.subtractBlackLevelFromStats=hr,lr.highlightRecovery=rr,rr){const zr=parseFloat(hn);!isNaN(zr)&&zr>0&&(lr.customWhiteLevel=zr)}n(lr)},Ag=()=>{if(A){const V=A.means,we=[V[0],V[1],V[3],V[2]].map(bt=>bt.toFixed(1));B(),rt(we.join(" "))}else alert("Please select an ROI on the image first.")},St=()=>{if(A){const V=A.means,we=[V[0],V[1],V[3],V[2]].map(bt=>bt.toFixed(1));B(),Ot(we.join(" "))}else alert("Please select an ROI on the image first.")},Og=V=>{V.target.files&&V.target.files.length>0&&y&&(y(V.target.files,Sr),T==null||T(`drlab batch ${Sr}`)),V.target.value="",Mn(!1)},Tg=async V=>{var bt;const we=(bt=V.target.files)==null?void 0:bt[0];if(!(!we||!J)){try{const zr=(await we.text()).split(`
`),En=[];for(let Ar of zr){if(Ar=Ar.trim(),!Ar||Ar.toLowerCase().startsWith("index"))continue;const aa=Ar.split(",").map(Number);if(aa.length>=5){const xo=aa[1],ai=aa[2],Jo=aa[3],yo=aa[4],pa=aa[5];!isNaN(xo)&&!isNaN(ai)&&!isNaN(Jo)&&!isNaN(yo)&&En.push({x:xo,y:ai,w:Jo,h:yo,ori:isNaN(pa)?void 0:pa})}}J(En),alert(`Imported ${En.length} ROIs successfully.`)}catch(lr){console.error("Import failed",lr),alert("Failed to import CSV: "+lr.message)}V.target.value=""}},qo=async V=>{var bt;const we=(bt=V.target.files)==null?void 0:bt[0];if(we){try{const zr=(await we.text()).split(`
`),En=[];En.push("#BlackLevel: 0,0,0,0"),En.push("#ImageHeight: 0"),En.push("Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std");let Ar=1;for(let Jo=0;Jo<zr.length;Jo++){const yo=zr[Jo].trim();if(!yo||yo.includes("R_mean")||yo.includes("R_std"))continue;const pa=yo.split(/\s+/).map(Number);if(pa.length<8||pa.some(isNaN))continue;const Gg=[Ar,1,pa[0],pa[2],pa[6],pa[4],pa[1],pa[3],pa[7],pa[5]].join(",");En.push(Gg),Ar++}const aa=new Blob([En.join(`
`)],{type:"text/csv"}),xo=URL.createObjectURL(aa),ai=document.createElement("a");ai.href=xo,ai.download=we.name.replace(/\.[^/.]+$/,"")+"_converted.csv",document.body.appendChild(ai),ai.click(),document.body.removeChild(ai),URL.revokeObjectURL(xo)}catch(lr){console.error("Conversion failed",lr),alert("Failed to convert file.")}V.target.value=""}},oc=V=>{V.target.files&&V.target.files[0]&&(dr(V.target.files[0]),T==null||T("fft load a"))},sc=V=>{V.target.files&&V.target.files[0]&&(cr(V.target.files[0]),T==null||T("fft load b"))},Eg=()=>{Ye&&Tt&&S&&(S(Ye,Tt,pn,bn),T==null||T("fft run"))},Ig=V=>{V.target.files&&V.target.files.length>0&&w&&(w(V.target.files),T==null||T("fft batch")),V.target.value=""},Rg=V=>{V.target.files&&V.target.files.length>0&&v&&(v(V.target.files),T==null||T("fft stack")),V.target.value=""},Dg=()=>{te&&(te({useNR:Wi,useDeshading:Zs,greenOnly:rc}),T==null||T("batch compute"))},Zo=(V,we,bt)=>{ne&&ne(V,we,bt)},$g=V=>{var bt;const we=(bt=V.target.files)==null?void 0:bt[0];we&&Wt&&Wt(we),V.target.value=""},Lg=async V=>{const we=V.target.files;if(!(!we||we.length===0))try{const bt=[];for(const lr of Array.from(we)){const zr=await lr.text();bt.push(...p3(zr,lr.name))}if(bt.length===0){Pa("No supported distortion profiles found in selected XML.");return}Qs(lr=>m3(lr,bt)),nc(lr=>lr||bt[0].id),Pa(`Added ${bt.length} lens profile(s) from ${we.length} file(s).`)}catch(bt){Pa(`Lensfun load failed: ${(bt==null?void 0:bt.message)||bt}`)}finally{V.target.value=""}},x0=()=>{if(!Yo||!ht)return;const V=Number(Ct);if(!Number.isFinite(V)||V<=0){Pa("Set a valid focal length (mm) before applying correction.");return}const we=Xo.find(lr=>lr.id===_t);if(!we){Pa("Select a lens profile first.");return}const bt=oI(we.distortions,V);if(!bt){Pa("No usable distortion coefficients for this lens.");return}ht({...bt,focal:V,lensLabel:we.label}),Pa(`Applied ${we.label} correction at ${V.toFixed(1)}mm (${bt.model}).`)},Fg=je.trim()!==""&&ze.trim()!==""&&wt.trim()!=="",Bg=r.renderMode==="advanced-zero-dep";return c.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-black",children:[c.jsxs("div",{className:"flex-grow overflow-y-auto",children:[N&&c.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 border-b border-red-100 dark:border-red-800 text-center animate-pulse",children:[c.jsx("p",{className:"text-xs font-bold text-red-600 dark:text-red-400 uppercase tracking-wide",children:"[!] 3-Plane / Full Color"}),c.jsx("p",{className:"text-[10px] text-red-500/80 dark:text-red-300/70 mt-1",children:"Demosaic disabled. Stats analysis treated as pseudo-Bayer."})]}),Zt&&!R&&c.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 border-b border-amber-100 dark:border-amber-800 text-center",children:[c.jsx("p",{className:"text-xs font-bold text-amber-600 dark:text-amber-400 uppercase tracking-wide",children:"[!] X-Trans Native (Unsupported)"}),c.jsx("p",{className:"text-[10px] text-amber-600/80 dark:text-amber-300/70 mt-1 text-left leading-tight px-1",children:"Currently reading raw 6x6 pattern as Bayer. Stats will be incorrect. Please enable Pseudo-Bayer conversion below."})]}),R&&c.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-3 border-b border-emerald-100 dark:border-emerald-800 text-center",children:[c.jsx("p",{className:"text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide",children:"[OK] X-Trans Pseudo-Bayer"}),c.jsx("p",{className:"text-[10px] text-emerald-600/80 dark:text-emerald-300/70 mt-1 text-left leading-tight px-1",children:"Converted 6x6  2x2 RGGB (Subsampled). Demosaic & Analysis fully supported."})]}),ie&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/30",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>de==null?void 0:de(),disabled:!se||(se.historyIndex??0)<=0,className:"px-2 py-1 bg-amber-600 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Undo"}),c.jsx("button",{onClick:()=>dt==null?void 0:dt(),disabled:!se,className:"px-2 py-1 bg-slate-800 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Export Flow JSON"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>{var V;return(V=na.current)==null?void 0:V.click()},disabled:!se,className:"px-2 py-1 bg-slate-700 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Import Flow File"}),c.jsx("button",{onClick:()=>Rt==null?void 0:Rt(),className:"px-2 py-1 bg-emerald-700 text-white font-bold border border-black text-xs",children:"Export PNG"})]}),c.jsx("button",{onClick:()=>kt==null?void 0:kt(),className:"w-full px-2 py-1 bg-emerald-800 text-white font-bold border border-black text-xs",children:"Export JPEG"}),c.jsx("input",{ref:na,type:"file",accept:".json,.csv,application/json,text/csv",className:"hidden",onChange:$g}),c.jsx("div",{className:"max-h-36 overflow-y-auto border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900",children:ir.length>0?ir.map(({entry:V,index:we})=>c.jsxs("button",{onClick:()=>Ce==null?void 0:Ce(we),className:`w-full text-left px-2 py-1 border-b border-gray-200 dark:border-slate-700 text-xs ${(se==null?void 0:se.historyIndex)===we?"bg-cyan-100 dark:bg-cyan-900/40":"bg-white dark:bg-slate-900"}`,children:[c.jsx("div",{className:"font-semibold truncate",children:V.label}),c.jsx("div",{className:"text-[10px] text-gray-500",children:new Date(V.timestamp).toLocaleTimeString()})]},V.id)):c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No history entries."})})]})}),c.jsx(rs,{title:"PS Masks",children:c.jsx(b8,{inline:!0,doc:se||null,brushEnabled:!!oe,brushSize:ke||32,brushOpacity:le||.35,brushFeather:fe??.6,ellipseFeather:Pe??24,brushMode:Fe||"add",onAddMask:()=>Ue==null?void 0:Ue(),onAddEllipseMask:()=>K==null?void 0:K(),onCancelEllipseTool:()=>_e==null?void 0:_e(),onSelectLayer:V=>xt==null?void 0:xt(V),onSelectMask:V=>nt==null?void 0:nt(V),onBindLayerMask:(V,we)=>Gt==null?void 0:Gt(V,we),onSetLayerBlendMode:(V,we)=>yt==null?void 0:yt(V,we),onSetLayerOpacity:(V,we)=>et==null?void 0:et(V,we),onSetLayerBasic:(V,we)=>He==null?void 0:He(V,we),onSetLayerMixer:(V,we)=>mt==null?void 0:mt(V,we),onPreviewLayerBasic:(V,we)=>jt==null?void 0:jt(V,we),onPreviewLayerMixer:(V,we)=>or==null?void 0:or(V,we),onSetLayerCurves:(V,we)=>zt==null?void 0:zt(V,we),onSelectMaskItem:V=>ut==null?void 0:ut(V),onUpdateEllipseItem:(V,we)=>It==null?void 0:It(V,we),onSetMaskOverlayVisible:(V,we)=>Lt==null?void 0:Lt(V,we),onBrushEnabledChange:V=>qt==null?void 0:qt(V),onBrushSizeChange:V=>xr==null?void 0:xr(V),onBrushOpacityChange:V=>Ir==null?void 0:Ir(V),onBrushFeatherChange:V=>fr==null?void 0:fr(V),onEllipseFeatherChange:V=>be==null?void 0:be(V),onBrushModeChange:V=>tt==null?void 0:tt(V)})}),c.jsxs(rs,{title:"PS Upright / Crop",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>Te==null?void 0:Te(),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Flip Left-Right"}),c.jsx("button",{onClick:()=>Le==null?void 0:Le(),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Flip Up-Down"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>Xe==null?void 0:Xe(90),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Rotate +90"}),c.jsx("button",{onClick:()=>Xe==null?void 0:Xe(-90),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Rotate -90"})]}),c.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 mb-3",children:[c.jsx("input",{type:"number",step:.1,value:yr,onChange:V=>Ht(V.target.value),className:"border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",placeholder:"Angle deg"}),c.jsx("button",{onClick:Dt,className:"px-2 py-1 bg-slate-800 text-white font-bold border border-black",children:"Rotate"})]}),c.jsx("button",{onClick:()=>ft==null?void 0:ft(),disabled:!A,className:"mb-3 w-full px-2 py-1 bg-amber-600 disabled:bg-gray-400 text-white font-bold border border-black",children:"Crop To ROI"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>Me==null?void 0:Me("horizontal"),className:"px-2 py-1 bg-sky-700 text-white font-bold border border-black",children:"+ H Guide"}),c.jsx("button",{onClick:()=>Me==null?void 0:Me("vertical"),className:"px-2 py-1 bg-sky-800 text-white font-bold border border-black",children:"+ V Guide"})]}),c.jsxs("div",{className:"space-y-1 max-h-24 overflow-auto border border-gray-300 dark:border-slate-700 p-1 mb-2",children:[((se==null?void 0:se.guides)||[]).map(V=>c.jsxs("button",{onClick:()=>Z==null?void 0:Z(V.id),className:`w-full text-left px-2 py-1 border ${(se==null?void 0:se.selectedGuideId)===V.id?"bg-sky-100 dark:bg-sky-900/40 border-sky-500":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-700"}`,children:[V.orientation==="horizontal"?"H":"V"," (",Math.round(V.p1.x),",",Math.round(V.p1.y),")-(",Math.round(V.p2.x),",",Math.round(V.p2.y),")"]},V.id)),(((v0=se==null?void 0:se.guides)==null?void 0:v0.length)||0)===0&&c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No guides."})]}),ot&&c.jsxs("div",{children:[c.jsxs("div",{className:"text-[11px] mb-1 text-gray-500",children:["Selected: ",ot.orientation==="horizontal"?"Horizontal":"Vertical"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"x1"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((se==null?void 0:se.width)||1)-1),step:1,value:Math.round(ot.p1.x),onChange:V=>xe==null?void 0:xe(ot.id,{...ot.p1,x:Number(V.target.value)},ot.p2),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"y1"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((se==null?void 0:se.height)||1)-1),step:1,value:Math.round(ot.p1.y),onChange:V=>xe==null?void 0:xe(ot.id,{...ot.p1,y:Number(V.target.value)},ot.p2),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"x2"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((se==null?void 0:se.width)||1)-1),step:1,value:Math.round(ot.p2.x),onChange:V=>xe==null?void 0:xe(ot.id,ot.p1,{...ot.p2,x:Number(V.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"y2"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((se==null?void 0:se.height)||1)-1),step:1,value:Math.round(ot.p2.y),onChange:V=>xe==null?void 0:xe(ot.id,ot.p1,{...ot.p2,y:Number(V.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]})]}),c.jsx("button",{onClick:()=>pt==null?void 0:pt(ot.id),className:"w-full px-2 py-1 bg-rose-700 text-white font-bold border border-black",children:"Delete Selected Guide"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[c.jsx("button",{onClick:()=>De==null?void 0:De("p1"),className:`px-2 py-1 font-bold border border-black ${ue==="p1"?"bg-amber-600 text-white":"bg-gray-200 dark:bg-slate-800 text-black dark:text-white"}`,children:"Pick P1"}),c.jsx("button",{onClick:()=>De==null?void 0:De("p2"),className:`px-2 py-1 font-bold border border-black ${ue==="p2"?"bg-amber-600 text-white":"bg-gray-200 dark:bg-slate-800 text-black dark:text-white"}`,children:"Pick P2"})]}),ue&&c.jsx("button",{onClick:()=>qe==null?void 0:qe(),className:"mt-2 w-full px-2 py-1 bg-gray-600 text-white font-bold border border-black",children:"Cancel Pick"})]}),c.jsx("button",{onClick:()=>Ie==null?void 0:Ie(),className:"mt-2 w-full px-2 py-1 bg-teal-700 text-white font-bold border border-black",children:"Apply Upright (4 Guides)"}),c.jsx("div",{className:"mt-2 text-[10px] text-gray-500",children:"Upright: set 4 guides for two horizontal and two vertical references."}),ue&&c.jsxs("div",{className:"mt-1 text-[10px] text-amber-600 dark:text-amber-400",children:["Click once on canvas to set ",ue.toUpperCase(),"."]}),c.jsxs("div",{className:"mt-3 border-t border-gray-300 dark:border-slate-700 pt-3",children:[c.jsx("div",{className:"text-xs font-bold text-gray-700 dark:text-slate-200 mb-2",children:"Lens Distortion Correction (Lensfun XML)"}),c.jsxs("label",{className:"flex items-center gap-2 text-[11px] mb-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Yo,onChange:V=>el(V.target.checked)}),"Enable lens correction"]}),c.jsx("input",{ref:mo,type:"file",className:"hidden",accept:".xml,text/xml,application/xml",multiple:!0,onChange:Lg}),c.jsx("button",{onClick:()=>{var V;return(V=mo.current)==null?void 0:V.click()},className:"w-full px-2 py-1 bg-slate-700 text-white font-bold border border-black text-xs",children:"Load Extra Lensfun XML"}),c.jsx("div",{className:"mt-2 text-[10px] text-gray-500 dark:text-slate-400 break-words",children:Qu}),c.jsx("label",{className:"block text-[10px] mt-2 mb-1 text-gray-500 dark:text-slate-400",children:"Lens Profile"}),c.jsxs("select",{value:_t,onChange:V=>nc(V.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1 text-xs",children:[Xo.length===0&&c.jsx("option",{value:"",children:"No profile loaded"}),Xo.map(V=>c.jsx("option",{value:V.id,children:V.label},V.id))]}),c.jsx("label",{className:"block text-[10px] mt-2 mb-1 text-gray-500 dark:text-slate-400",children:"Focal Length (mm)"}),c.jsx("input",{type:"number",min:.1,step:.1,value:Ct,onChange:V=>Ko(V.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1 text-xs",placeholder:"e.g. 35.0"}),c.jsx("button",{onClick:x0,disabled:!Yo||!_t||!ht,className:"mt-2 w-full px-2 py-1 bg-emerald-700 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Apply Lens Correction"})]})]})]}),$&&c.jsx(rs,{title:"SFR Lab Tools (Scalar Unmixing)",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-3 rounded border border-orange-200 dark:border-orange-800",children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase mb-2",children:"Analyze ROI"}),c.jsx("p",{className:"text-[10px] text-gray-500 dark:text-slate-400 mb-2",children:"Select an edge on the main canvas and click analyze. Use the pop-up modal to view ESF/LSF/MTF."}),c.jsx("div",{className:"text-center text-xs font-bold text-orange-500",children:"(ROI Analysis Window is Active)"})]}),Bg&&c.jsxs("div",{className:"border-t border-orange-200 dark:border-orange-800 pt-3",children:[c.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>zi(!zn),children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase",children:" (Batch Ops)"}),c.jsx("svg",{className:`w-4 h-4 text-orange-500 transition-transform ${zn?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),zn&&c.jsxs("div",{className:"mt-3 space-y-3 bg-white/50 dark:bg-black/20 p-2 rounded animate-in slide-in-from-top-1",children:[c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-600 dark:text-gray-300",children:" (Standard Chart)"}),c.jsx("button",{onClick:Se,disabled:!!U&&U>0,className:`w-full py-2 border font-bold text-xs rounded transition-all ${U&&U>0?"bg-emerald-600 text-white border-emerald-500 animate-pulse":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100"}`,children:U&&U>0?`Click ${U===1?"TL":U===2?"TR":U===3?"BL":"BR"}`:"Start Calibration (4-Pts)"}),!!U&&U>0&&c.jsx("p",{className:"text-[9px] text-emerald-600 dark:text-emerald-400 font-bold text-center",children:"Click corners: TopLeft  TopRight  BottomLeft  BottomRight"})]}),c.jsx("div",{className:"h-px bg-gray-300 dark:bg-slate-600 w-full"}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-600 dark:text-gray-300",children:" (Manual Mark)"}),D!==void 0&&D>0&&c.jsxs("span",{className:"text-[9px] text-orange-500 font-bold",children:[D," Selected"]})]}),c.jsx("button",{onClick:H,className:`w-full py-2 font-bold text-xs rounded shadow transition-all ${W?"bg-orange-600 hover:bg-orange-500 text-white ring-2 ring-orange-300":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100"}`,children:W?"Stop Marking (Active)":"Start Batch Marking"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:re,disabled:!D,className:"flex-1 py-1.5 border border-indigo-300 dark:border-indigo-700 text-indigo-700 dark:text-indigo-400 font-bold text-[10px] rounded hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})," (Save)"]}),c.jsx("input",{type:"file",ref:Kr,className:"hidden",accept:".csv",onChange:Tg}),c.jsxs("button",{onClick:()=>{var V;return(V=Kr.current)==null?void 0:V.click()},className:"flex-1 py-1.5 border border-emerald-300 dark:border-emerald-700 text-emerald-700 dark:text-emerald-400 font-bold text-[10px] rounded hover:bg-emerald-50 dark:hover:bg-emerald-900/30 transition-colors flex items-center justify-center gap-1",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})," (Import)"]})]}),D!==void 0&&D>0&&c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800/50 p-2 rounded border border-gray-200 dark:border-slate-700 mt-1",children:[c.jsx("div",{className:"text-[9px] font-bold text-gray-500 text-center mb-1",children:"UNIFIED TRANSFORM"}),c.jsxs("div",{className:"flex gap-2 mb-2 justify-center",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400",children:"Step (px)"}),c.jsx("input",{type:"number",min:"1",value:Ga,onChange:V=>fo(Number(V.target.value)),className:"w-10 text-center text-[10px] bg-white dark:bg-slate-900 border rounded"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400",children:"Scale"}),c.jsx("input",{type:"number",step:"0.01",value:Ua,onChange:V=>ho(Number(V.target.value)),className:"w-10 text-center text-[10px] bg-white dark:bg-slate-900 border rounded"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[c.jsx("button",{onClick:()=>Zo("scale",1/Ua,1/Ua),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600 font-bold",title:"Zoom Out (Shrink)",children:"-"}),c.jsx("button",{onClick:()=>Zo("move",0,-Ga),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:"^"}),c.jsx("button",{onClick:()=>Zo("scale",Ua,Ua),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600 font-bold",title:"Zoom In (Expand)",children:"+"}),c.jsx("button",{onClick:()=>Zo("move",-Ga,0),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:""}),c.jsx("div",{className:"text-center text-[8px] text-gray-400 flex items-center justify-center",children:"Move"}),c.jsx("button",{onClick:()=>Zo("move",Ga,0),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:">"}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Zo("move",0,Ga),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:"v"}),c.jsx("div",{})]})]}),W&&c.jsx("p",{className:"text-[9px] text-gray-400 italic text-center mt-1",children:"Hold Shift + Drag on canvas to add multiple ROIs."}),c.jsxs("div",{className:"flex flex-col gap-1 text-[10px] mt-2 bg-gray-100 dark:bg-slate-800/50 p-2 rounded",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Wi,onChange:V=>Zu(V.target.checked),className:"rounded text-orange-500"}),"Jiang Official NR"]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Zs,onChange:V=>Ju(V.target.checked),className:"rounded text-purple-500"}),"Deshading"]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 my-1"}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",title:"Only use Green channel points for projection (reduces color moire issues)",children:[c.jsx("input",{type:"checkbox",checked:rc,onChange:V=>cn(V.target.checked),className:"rounded text-emerald-500"}),c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:"Green Channel Only (G Only)"})]})]}),c.jsxs("button",{onClick:Dg,disabled:!D,className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold text-xs rounded shadow transition-transform active:scale-95",children:["Calculate & Copy (",D||0,")"]}),c.jsx("button",{onClick:Y,disabled:!D,className:"w-full py-1.5 bg-gray-200 dark:bg-slate-700 hover:bg-red-100 hover:text-red-600 text-[10px] font-bold rounded transition-colors disabled:opacity-50",children:"Clear All Marks"})]})]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsx(K0,{checked:ae,onChange:me,label:" (Scalar Unmixing)"}),ae&&c.jsxs("div",{className:"space-y-4 pl-2 border-l-2 border-indigo-200 dark:border-indigo-900 animate-in slide-in-from-top-2 duration-200",children:[c.jsxs("div",{className:"grid grid-cols-5 gap-1 items-center text-[9px] uppercase font-bold text-gray-400 mb-[-8px]",children:[c.jsx("div",{className:"col-span-1",children:"Param"}),c.jsx("div",{className:"text-center",children:"Ch0(R)"}),c.jsx("div",{className:"text-center",children:"Ch1(G1)"}),c.jsx("div",{className:"text-center",children:"Ch2(B)"}),c.jsx("div",{className:"text-center",children:"Ch3(G2)"})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-red-500",children:"BL:"}),c.jsx("input",{type:"text",value:je,onChange:V=>{B(),Q(V.target.value)},placeholder:"0 0 0 0",className:"col-span-4 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500",children:"B ():"}),c.jsxs("div",{className:"col-span-4 flex gap-1",children:[c.jsx("input",{type:"text",value:ze,onChange:V=>{B(),rt(V.target.value)},className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"}),c.jsx("button",{onClick:Ag,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-[9px] rounded font-bold transition-colors",title:"Fill with current ROI mean stats (Raw DN)",children:"Pick"})]})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-emerald-500",children:"F ():"}),c.jsxs("div",{className:"col-span-4 flex gap-1",children:[c.jsx("input",{type:"text",value:wt,onChange:V=>{B(),Ot(V.target.value)},className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"}),c.jsx("button",{onClick:St,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-[9px] rounded font-bold transition-colors",title:"Fill with current ROI mean stats (Raw DN)",children:"Pick"})]})]}),c.jsx("button",{onClick:ic,disabled:!it||!Fg,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 rounded text-[10px] shadow transition-transform active:scale-95 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed",children:"RUN UNMIXING (ADV ZERO-DEP)"}),c.jsx("p",{className:"text-[9px] text-gray-400 italic text-center",children:"Basic render + sRGB gamma are applied."})]})]})}),k&&c.jsx(rs,{title:"FFT Lab (Noise Profile)",children:c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"space-y-3 bg-gray-50 dark:bg-slate-800/40 p-3 rounded-xl border border-gray-100 dark:border-slate-800",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-fuchsia-600 dark:text-fuchsia-400 uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-fuchsia-500"})," 1. Pair Difference (Sub)"]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:po,className:"hidden",onChange:oc,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var V;return(V=po.current)==null?void 0:V.click()},className:`w-full py-2 px-3 rounded-lg border text-[10px] font-bold text-left truncate transition-colors ${Ye?"bg-fuchsia-55 dark:bg-fuchsia-900/20 border-fuchsia-300 dark:border-fuchsia-800 text-fuchsia-700 dark:text-fuchsia-300":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:Ye?`A: ${Ye.name}`:"Load Image A"}),c.jsx("input",{type:"file",ref:Js,className:"hidden",onChange:sc,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var V;return(V=Js.current)==null?void 0:V.click()},className:`w-full py-2 px-3 rounded-lg border text-[10px] font-bold text-left truncate transition-colors ${Tt?"bg-fuchsia-55 dark:bg-fuchsia-900/20 border-fuchsia-300 dark:border-fuchsia-800 text-fuchsia-700 dark:text-fuchsia-300":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:Tt?`B: ${Tt.name}`:"Load Image B"})]}),c.jsx("div",{className:"flex flex-col gap-1.5 pt-1",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:bn,onChange:V=>ki(V.target.checked),className:"w-3 h-3 text-fuchsia-600 border-gray-300 rounded focus:ring-0"}),c.jsx("span",{className:"text-[10px] text-gray-600 dark:text-slate-300",children:"Normalize (/sqrt(2), do not check if not clear about the side effects)"})]})}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[c.jsx("button",{onClick:Eg,disabled:!Ye||!Tt,className:"w-full bg-fuchsia-600 hover:bg-fuchsia-500 disabled:opacity-30 text-white font-bold py-2 rounded shadow transition-all active:scale-95 text-[10px]",children:"Generate Diff & Load"}),c.jsx("input",{type:"file",ref:Hi,className:"hidden",multiple:!0,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:Ig}),c.jsx("button",{onClick:()=>{var V;return(V=Hi.current)==null?void 0:V.click()},className:"w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 rounded shadow transition-all active:scale-95 text-[10px] flex items-center justify-center gap-1",children:"Batch Diffs (Auto Download)"})]})]}),c.jsxs("div",{className:"space-y-3 bg-gray-50 dark:bg-slate-800/40 p-3 rounded-xl border border-gray-100 dark:border-slate-800",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-400 uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"})," 2. Stack FFT (Avg PSD)"]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:Ho,className:"hidden",multiple:!0,onChange:Rg,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var V;return(V=Ho.current)==null?void 0:V.click()},className:"w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"Select Sequence Files"})]})]}),c.jsxs("div",{className:"flex flex-col gap-2 pt-2 border-t border-gray-100 dark:border-slate-800",children:[c.jsx("button",{onClick:()=>{M==null||M(),T==null||T("crosscalc")},className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"Cross-Compensation Calc"}),c.jsx("button",{onClick:()=>{ce==null||ce(),T==null||T("stack tool")},className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"General Stack"})]})]})}),s&&c.jsx(rs,{title:"DR Lab Tools",children:c.jsxs("div",{className:"space-y-4",children:[c.jsx("button",{onClick:()=>{d==null||d(),T==null||T("gen test")},className:"w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors text-sm",children:"Generate Test Pic"}),c.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 pt-3",children:[c.jsx("h4",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-2",children:"Grid Analysis"}),h&&f!==void 0&&c.jsx("div",{className:"flex items-center justify-between mb-3",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Box Size:"}),c.jsx("input",{type:"number",min:"8",max:"512",step:"2",value:f,onChange:V=>h(parseInt(V.target.value)||64),className:"w-12 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 text-center"}),c.jsx("span",{className:"text-xs text-gray-400",children:"px"})]})}),x&&b&&p!==void 0&&g!==void 0&&c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-400",children:"Layout:"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"number",min:"1",max:"50",value:p,onChange:V=>x(Math.max(1,parseInt(V.target.value)||1)),className:"w-10 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md outline-none text-sm text-center",title:"Rows"}),c.jsx("span",{className:"text-xs text-gray-400",children:"x"}),c.jsx("input",{type:"number",min:"1",max:"50",value:g,onChange:V=>b(Math.max(1,parseInt(V.target.value)||1)),className:"w-10 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md outline-none text-sm text-center",title:"Columns"})]})]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("button",{onClick:()=>{u==null||u(),T==null||T("mark")},disabled:!it||l!==void 0&&l>0,className:`w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm ${it?l&&l>0?"bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300 border-2 border-indigo-500":"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:l&&l>0?"Marking Active...":"Mark Corners"}),y&&c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"file",ref:Yn,className:"hidden",multiple:!0,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:Og}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>Mn(!Cr),disabled:!m,className:"w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed text-white flex items-center justify-center gap-2",children:"Reuse Last & Batch"}),Cr&&c.jsxs("div",{className:"absolute bottom-full left-0 w-full mb-1 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-gray-200 dark:border-slate-700 overflow-hidden z-20 flex flex-col animate-in fade-in zoom-in-95 duration-100",children:[c.jsx("button",{className:"px-4 py-2 text-left text-xs hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-700 dark:text-slate-200 border-b border-gray-100 dark:border-slate-700",onClick:()=>{var V;an("single"),(V=Yn.current)==null||V.click()},children:"1. Independent Frames"}),c.jsx("button",{className:"px-4 py-2 text-left text-xs hover:bg-gray-100 dark:hover:bg-slate-700 text-indigo-600 dark:text-indigo-400 font-bold",onClick:()=>{var V;an("pair"),(V=Yn.current)==null||V.click()},children:"2. Pair Difference (A-B)"})]})]})]}),c.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-100 dark:border-slate-800",children:[c.jsx("input",{type:"file",ref:_a,className:"hidden",accept:".txt",onChange:qo}),c.jsx("button",{onClick:()=>{var V;return(V=_a.current)==null?void 0:V.click()},className:"w-full font-bold py-2 px-4 rounded-lg shadow-sm transition-all text-xs bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 flex items-center justify-center gap-2 border border-gray-300 dark:border-slate-600",children:"Convert Format (.txt  .csv)"})]})]}),l!==void 0&&l>0&&c.jsx("div",{className:"mt-2 text-center",children:c.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400 font-bold animate-pulse",children:[l===1&&"Click Top-Left Center",l===2&&"Click Top-Right Center",l===3&&"Click Bottom-Left Center",l===4&&"Click Bottom-Right Center"]})})]})]})}),G&&c.jsx(rs,{title:"Color Lab Tools",children:c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"text-sm text-gray-600 dark:text-slate-300 mb-2",children:"Calibrate colors using a standard ColorChecker 24 chart."}),c.jsx("button",{onClick:()=>{C==null||C(),T==null||T("cl mark")},disabled:!it||L!==void 0&&L>0,className:`w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm ${it?L&&L>0?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 border-2 border-yellow-500":"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:L&&L>0?"Marking Active...":"Mark 24-Patch Chart"}),L!==void 0&&L>0&&c.jsx("div",{className:"mt-2 text-center",children:c.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 font-bold animate-pulse",children:[L===1&&"Click Top-Left (Brown)",L===2&&"Click Top-Right (Cyanish)",L===3&&"Click Bottom-Left (White)",L===4&&"Click Bottom-Right (Black)"]})})]})}),!ie&&c.jsx(rs,{title:"Selection Tools",children:c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Quick Select (or Shift+drag)"}),c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Size (px):"}),c.jsx("input",{type:"number",min:"1",value:Sn,onChange:V=>Na(V.target.value),disabled:!it,className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:Wa,disabled:!it,className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-slate-200 text-xs font-semibold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Center Rect"}),c.jsx("button",{onClick:za,disabled:!it,className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-slate-200 text-xs font-semibold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Full Image"})]})]})})}),!ie&&c.jsx(rs,{title:"Display Controls",children:c.jsxs("div",{className:"space-y-5",children:[c.jsxs("p",{className:"text-gray-500 dark:text-slate-400 text-center text-sm",children:["Adjust parameters and click ",c.jsx("b",{children:"Apply"}),"."]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"exposure",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Exposure (EV)"}),c.jsx("div",{className:"flex items-center gap-2 mb-2",children:c.jsx("input",{type:"range",min:"-5",max:"5",step:"0.1",disabled:!it,value:parseFloat(ye)||0,onChange:V=>h0(V.target.value),className:"w-full h-2 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500 disabled:opacity-50"})}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("input",{id:"exposure",type:"number",step:"0.1",value:ye,onChange:V=>h0(V.target.value),disabled:!it,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})})]}),c.jsxs("div",{children:[c.jsx(K0,{checked:rr,onChange:V=>{B(),Rr(V)},label:"Highlight Recovery"}),rr&&c.jsxs("div",{className:"mt-2 pl-2 border-l-2 border-orange-200 dark:border-orange-900 animate-in slide-in-from-top-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"White Level (Clip Point)"}),c.jsx("input",{type:"number",value:hn,onChange:V=>{B(),ra(V.target.value)},className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-orange-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors"})]})]}),Vt&&c.jsxs("div",{className:"border-t border-gray-100 dark:border-slate-800 pt-2",children:[c.jsx(K0,{checked:!!R,onChange:V=>{B(),_&&_(V),T==null||T(`xtrans ${V?"on":"off"}`)},label:"Force X-Trans (6x6 -> 2x2)"}),R&&P&&E&&c.jsxs("div",{className:"mt-2 pl-2 border-l-2 border-emerald-500/50 bg-emerald-50/20 dark:bg-emerald-900/10 p-2 rounded",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Phase Offset (Fine Tune)"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-[9px] text-gray-400",children:"X (0-5)"}),c.jsx("input",{type:"number",min:"0",max:"5",value:P.x,onChange:V=>{B();const we=Math.min(5,Math.max(0,parseInt(V.target.value)||0));E({x:we}),T==null||T(`xtrans phase ${we} ${P.y}`)},className:"w-full text-xs px-1 py-0.5 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-center outline-none focus:border-cyan-500"})]}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-[9px] text-gray-400",children:"Y (0-5)"}),c.jsx("input",{type:"number",min:"0",max:"5",value:P.y,onChange:V=>{B();const we=Math.min(5,Math.max(0,parseInt(V.target.value)||0));E({y:we}),T==null||T(`xtrans phase ${P.x} ${we}`)},className:"w-full text-xs px-1 py-0.5 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-center outline-none focus:border-cyan-500"})]})]})]})]}),c.jsxs("div",{className:"space-y-5 pt-2 animate-in slide-in-from-top-2 duration-200 border-t border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{children:[c.jsx(K0,{checked:ur,onChange:V=>{B(),sr(V)},label:"Show k"}),c.jsx("p",{className:"text-[10px] text-gray-400 dark:text-slate-500 mt-1"})]}),c.jsxs("div",{children:[c.jsxs("button",{onClick:ac,disabled:!it||!A,className:"w-full mb-3 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-bold rounded shadow-sm transition-all active:scale-95 disabled:bg-gray-300 dark:disabled:bg-slate-700 disabled:text-gray-500 dark:disabled:text-gray-500 disabled:cursor-not-allowed disabled:shadow-none flex items-center justify-center gap-2",title:"Calculate Gains to make the selected area neutral gray, accounting for Color Matrix",children:[c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Spot WB (Matrix-Aware)"]}),c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"White Balance Gains"}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-red-500 dark:text-red-400 block mb-1",children:"Red"}),c.jsx("input",{type:"number",step:"0.01",value:br,onChange:V=>p0(V.target.value),disabled:!it,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-red-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-blue-500 dark:text-blue-400 block mb-1",children:"Blue"}),c.jsx("input",{type:"number",step:"0.01",value:Xt,onChange:V=>Cg(V.target.value),disabled:!it,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})]})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-end mb-2",children:[c.jsxs("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-0 flex items-center",children:["Black Level (4-Ch)",c.jsx("span",{className:"ml-1 text-[10px] text-gray-400 dark:text-slate-500 font-normal normal-case",children:"Native"}),c.jsx("button",{onClick:()=>At(!0),className:"ml-2 text-[10px] text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 hover:underline cursor-pointer transition-colors",title:"About Black Level Settings",children:"[about]"})]}),c.jsxs("div",{className:"flex items-center gap-1.5",title:"Subtract Black Level from ROI Mean stats (for display)",children:[c.jsx("span",{className:"text-[9px] font-mono text-gray-400 dark:text-slate-500 uppercase tracking-wide",children:"Sub. BL"}),c.jsx("div",{className:`relative w-8 h-4 rounded-full cursor-pointer transition-colors duration-200 ease-in-out ${hr?"bg-cyan-500":"bg-gray-300 dark:bg-slate-700"}`,onClick:()=>{B(),Ze(!hr)},children:c.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-3 h-3 rounded-full shadow-sm transform transition-transform duration-200 ${hr?"translate-x-4":"translate-x-0"}`})})]})]}),c.jsx("input",{type:"text",value:Be,onChange:V=>{B(),tr(V.target.value)},disabled:!it,placeholder:"0 0 0 0",className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-xs font-mono text-gray-900 dark:text-slate-100 transition-colors duration-300",title:"Enter 4 values separated by space or comma"}),c.jsx("p",{className:"text-[10px] text-gray-400 dark:text-slate-500 mt-1",children:"Order: (0,0) (0,1) (1,0) (1,1). Spatial: TL, TR, BL, BR."})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-end mb-2",children:[c.jsxs("label",{htmlFor:"customMatrix",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block flex flex-col gap-1",children:[c.jsx("span",{children:"Custom Color Matrix"}),c.jsx("span",{className:"text-[9px] text-gray-400 dark:text-slate-500 font-normal normal-case",children:"XYZ to Camera RGB (3x3, 9 nums)"})]}),c.jsxs("select",{className:"text-[10px] bg-gray-100 dark:bg-gray-800 border border-black dark:border-gray-500 rounded-none px-1 py-0.5 max-w-[120px] cursor-pointer outline-none text-gray-700 dark:text-gray-300",onChange:V=>{B();const we=tu[V.target.value];we&&st(we),V.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Camera..."}),Vi.map(V=>c.jsx("option",{value:V,children:V},V))]})]}),c.jsx("textarea",{id:"customMatrix",value:We,onChange:m0,disabled:!it,placeholder:"0.66 -0.19 -0.04  -0.46 1.23 0.25  -0.06 0.13 0.65",className:"w-full h-24 px-2 py-2 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none transition-colors disabled:bg-gray-100 dark:disabled:bg-slate-800/50 disabled:cursor-not-allowed text-xs font-mono leading-relaxed text-gray-900 dark:text-slate-100"})]})]}),c.jsxs("div",{className:"pt-4 flex flex-col gap-2",children:[c.jsx("button",{onClick:nd,disabled:!it,className:"w-full text-sm font-bold bg-slate-700 hover:bg-slate-600 text-white disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 transition-all py-4 rounded-xl flex items-center justify-center border-2 border-slate-500 shadow-lg",title:"Diagnostic Mode. Direct RAW-to-Grayscale mapping using manual Black Level & WB Gains (R/B calibration).",children:c.jsxs("span",{className:"text-center leading-tight",children:["Apply Settings / Render",c.jsx("br",{}),c.jsx("span",{className:"text-xs font-normal opacity-90",children:"Float-safe render path, avoids ROI drift and CM color artifacts"})]})}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("button",{onClick:()=>Tr(!0),disabled:!it,className:"w-full text-xs font-bold bg-black text-gray-400 hover:bg-gray-800 hover:text-gray-300 dark:bg-black dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed py-3 px-2 rounded-lg transition-all active:scale-95 border border-gray-700",children:["Try Official Render",c.jsx("br",{}),c.jsx("span",{className:"text-[10px] font-normal opacity-75",children:"(Not for analysis)"})]}),c.jsx("button",{onClick:()=>F==null?void 0:F(),disabled:!it,className:"w-full text-xs font-bold bg-black text-gray-400 hover:bg-gray-800 hover:text-gray-300 dark:bg-black dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-all py-3 rounded-lg flex items-center justify-center border border-gray-700 active:scale-95",title:"Manual Lab Workstation: 16-bit Bit Shift and Manual DNG Container Packaging",children:"Generate 16bit DNG"})]}),c.jsx("div",{className:"text-center pt-1",children:c.jsx("button",{onClick:ni,disabled:!it,className:"text-xs text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200 disabled:text-gray-300 dark:disabled:text-slate-600 transition-colors underline decoration-gray-300 hover:decoration-gray-600 underline-offset-2",children:"Reset Defaults (Local)"})})]})]})})]}),c.jsx(Is,{isOpen:Jt,onClose:()=>At(!1),onConfirm:()=>{window.open("https://y-g-jiang.github.io/CBLD.html","_blank"),At(!1)},title:"Black Level Info / ",confirmText:"Visit Database (CBLD)",cancelText:"Close",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left text-sm text-gray-600 dark:text-slate-300",children:[c.jsx("p",{className:"leading-relaxed",children:"JiangBridge  CBLD "}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsx("p",{className:"leading-relaxed",children:"For best accuracy, capture a dark frame with the same ISO/shutter and measure the center ROI in this app."})]})}),c.jsx(Is,{isOpen:pr,onClose:()=>vr(!1),onConfirm:()=>{},title:"Select Zero-Dependency Mode",confirmText:"",cancelText:"",message:c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsx("div",{className:"text-gray-600 dark:text-slate-300 text-left text-sm leading-relaxed mb-2",children:"Select how you want to visualize the raw data without full JOraw processing."}),c.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Bayer Pattern"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>Xr(!1),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Dr?"text-gray-500 dark:text-slate-400":"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm"}`,children:"RGGB"}),c.jsx("button",{onClick:()=>Xr(!0),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Dr?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"BGGR"})]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Color Demosaic"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>nr("bilinear"),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Ae==="bilinear"?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"Bilinear"}),c.jsx("button",{onClick:()=>nr("amaze"),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Ae==="amaze"||Ae==="edge-aware"?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"AMaZE (Default)"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("button",{onClick:()=>rl("mosaic"),className:"flex flex-col items-center justify-center p-4 bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 border-2 border-transparent hover:border-gray-400 dark:hover:border-slate-500 rounded-xl transition-all group",children:[c.jsx("div",{className:"w-12 h-12 bg-gray-300 dark:bg-slate-600 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600 dark:text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),c.jsx("span",{className:"font-bold text-gray-800 dark:text-slate-200",children:"Raw Mosaic"}),c.jsx("span",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:"Grayscale checkerboard"})]}),c.jsxs("button",{onClick:()=>rl("color"),className:"flex flex-col items-center justify-center p-4 bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 border-2 border-transparent hover:border-cyan-400 dark:hover:border-cyan-500 rounded-xl transition-all group",children:[c.jsx("div",{className:"w-12 h-12 bg-cyan-100 dark:bg-cyan-900/30 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:c.jsx("svg",{className:"w-6 h-6 text-cyan-600 dark:text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),c.jsx("span",{className:"font-bold text-cyan-700 dark:text-cyan-400",children:"Basic Color"}),c.jsx("span",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:Ae==="amaze"||Ae==="edge-aware"?"AMaZE Demosaic + WB + Matrix":"Bilinear Demosaic + WB + Matrix"})]})]})]})}),c.jsx(Is,{isOpen:gt,onClose:()=>Tr(!1),onConfirm:()=>{g0(),Tr(!1)},title:"Official Render Options",confirmText:"Render",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsx("p",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Select a demosaicing algorithm for the standard render pipeline."}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"demosaic-modal",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Demosaic Method"}),c.jsx("select",{id:"demosaic-modal",value:Br,onChange:ed,disabled:!it||N||(t==null?void 0:t.isXTrans),className:"w-full px-2 py-2 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none transition-colors disabled:bg-gray-100 dark:disabled:bg-slate-800/50 disabled:cursor-not-allowed text-sm text-gray-900 dark:text-slate-100",children:aI.map(V=>c.jsx("option",{value:V.value,children:V.label},V.value))}),N&&c.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:"Full color data detected. Demosaicing skipped."}),(t==null?void 0:t.isXTrans)&&c.jsx("p",{className:"text-[9px] text-amber-500 mt-1",children:"X-Trans detected. Please enable Pseudo-Bayer conversion first."})]})]})})]})},lI=j.forwardRef((e,t)=>{const{rawImageData:r,displaySettings:n,onApplyDisplaySettings:a,onSetSelection:i,onStartMarking:o,onGenerateTestPic:s,onBatchDrLab:l,onProcessPair:u,onProcessBatchDiff:d,onProcessStackFft:f,onOpenCrossCalc:h,onToggleXTrans:p,onXTransPhaseChange:x}=e,[g,b]=j.useState([{id:"init",type:"info",text:'Jiangtherapee CLI v1.0. Type "help" for commands.'}]),[y,m]=j.useState(""),[k,S]=j.useState([]),[w,v]=j.useState(-1),M=j.useRef(null),N=j.useRef(null),_=j.useRef(null),P=j.useRef(null),E=j.useRef(null),R=j.useRef(null),T=j.useRef(null),G=j.useRef(null);j.useRef(null);const L=j.useRef({...n});j.useEffect(()=>{L.current={...n}},[n.exposure,n.demosaicMethod]);const C=j.useRef({fileA:null,fileB:null});j.useLayoutEffect(()=>{M.current&&(M.current.scrollTop=M.current.scrollHeight)},[g]);const $=(H,Y="out")=>{b(te=>[...te,{id:Date.now().toString()+Math.random(),type:Y,text:H}])};j.useImperativeHandle(t,()=>({log:(H,Y="in")=>{const te=Y;let U=H;Y==="in"&&!H.startsWith(">")&&(U=`> ${H}`),$(U,te)}}));const A=j.useRef(null);j.useEffect(()=>{if(e.roiStats&&e.roiStats!==A.current){const H=e.roiStats,Y=Math.round(H.x),te=Math.round(H.y),U=Math.round(H.width),Se=Math.round(H.height);$(`> sel ${Y} ${te} ${U} ${Se}`,"in");const re=e.isBGGR?[{name:"B",idx:0},{name:"G1",idx:1},{name:"G2",idx:2},{name:"R",idx:3}]:[{name:"R",idx:0},{name:"G1",idx:1},{name:"G2",idx:2},{name:"B",idx:3}],J=c.jsxs("div",{className:"font-mono text-xs mt-1 mb-2",children:[c.jsxs("div",{className:"text-gray-400 mb-1",children:["Region Stats [",Y,", ",te,", ",U,"x",Se,"]:"]}),c.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr] gap-x-2 border-b border-gray-700 pb-1 mb-1 text-gray-500 font-bold",children:[c.jsx("div",{children:"Ch"}),c.jsx("div",{className:"text-right",children:"Mean"}),c.jsx("div",{className:"text-right",children:"StdDev"})]}),re.map(ne=>c.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr] gap-x-2 hover:bg-gray-900",children:[c.jsx("div",{className:ne.name==="R"?"text-red-500":ne.name==="B"?"text-blue-500":"text-green-500",children:ne.name}),c.jsx("div",{className:"text-right text-gray-300",children:H.means[ne.idx].toFixed(2)}),c.jsx("div",{className:"text-right text-gray-400",children:H.stdDevs[ne.idx].toFixed(2)})]},ne.name))]});$(J,"out"),A.current=H}},[e.roiStats,e.isBGGR]);const O=H=>{var Se,re,J,ne,ce,ie,se;const Y=H.trim().split(/\s+/),te=Y[0].toLowerCase(),U=Y.slice(1);switch(te){case"help":$("Available Commands:","info"),$("  ev <val>          Set Exposure (e.g. ev 1.5)","info"),$("  wb <r> <b>        Set WB Gains","info"),$("  bl <r> <g>...     Set Black Level (1 or 4 vals)","info"),$("  demo <id>         Demosaic (0=Lin, 3=AHD, -1=Raw)","info"),$("  matrix <n1..n9>   Set Custom Color Matrix","info"),$("  xtrans <on|off>   Force X-Trans Mode","info"),$("  xtrans phase <x> <y>  Set X-Trans Phase","info"),$("  render            Apply settings & Render","info"),$("  render zero       Zero-Dependency Render","info"),$("  render unmix      Advanced Unmixing Render","info"),$("  sel <full|center> Select ROI","info"),$("  sel <x> <y> <w> <h> Select ROI manually","info"),$("  mark              Start DR Lab Corner Marking","info"),$("  gen test          Generate Test Pattern","info"),$("  fft load <a>      Load FFT Pair Image A","info"),$("  fft load <b>      Load FFT Pair Image B","info"),$("  fft run           Run FFT Pair Diff","info"),$("  cls               Clear Screen","info");break;case"cls":case"clear":b([]);break;case"ev":case"exposure":if(U.length<1){$(`Current EV: ${L.current.exposure}`,"info");return}const oe=parseFloat(U[0]);if(isNaN(oe)){$("Invalid EV value","err");return}L.current.exposure=oe,$(`EV set to ${oe} (run 'render' to apply)`);break;case"wb":if(U.length<2){$("Usage: wb <red_gain> <blue_gain>","err");return}const ke=parseFloat(U[0]),le=parseFloat(U[1]);if(isNaN(ke)||isNaN(le)){$("Invalid gains","err");return}L.current.wbGains=[ke,le],$(`WB set to R:${ke} B:${le}`);break;case"bl":case"black":if(U.length===0){$(`Current BL: ${((Se=L.current.blackLevel)==null?void 0:Se.join(" "))||"Auto"}`,"info");return}let fe=U.map(Number);if(fe.some(isNaN)){$("Invalid numbers","err");return}if(fe.length===1&&(fe=[fe[0],fe[0],fe[0],fe[0]]),fe.length<4){$("Need 1 or 4 values","err");return}L.current.blackLevel=[fe[0],fe[1],fe[2],fe[3]],L.current.subtractBlackLevelFromStats=!0,L.current.showKadc=!0,$(`Black Level set: ${fe.slice(0,4).join(" ")}`);break;case"demo":case"demosaic":if(U.length===0){$("Usage: demo <id> (0=Lin, 1=VNG, 2=PPG, 3=AHD, 4=DCB, 11=DHT, 12=AAHD, -1=Raw)","info");return}const Pe=parseInt(U[0]);if(isNaN(Pe)){$("Invalid method ID","err");return}L.current.demosaicMethod=Pe,$(`Demosaic set to ID ${Pe}`);break;case"matrix":if(U.length!==9){$("Usage: matrix m1 m2 m3 m4 m5 m6 m7 m8 m9 (3x3)","err");return}const Fe=U.map(Number);if(Fe.some(isNaN)){$("Invalid matrix values","err");return}L.current.customMatrix=Fe,$("Custom Color Matrix set.");break;case"xtrans":if(U[0]==="on"||U[0]==="true")p?(p(!0),$("X-Trans conversion ON")):$("Feature not available","err");else if(U[0]==="off"||U[0]==="false")p?(p(!1),$("X-Trans conversion OFF")):$("Feature not available","err");else if(U[0]==="phase"){if(U.length<3){$("Usage: xtrans phase <x> <y>","err");return}const Ue=parseInt(U[1]),K=parseInt(U[2]);x&&(x({x:Ue,y:K}),$(`X-Trans Phase set to (${Ue}, ${K})`))}else $("Usage: xtrans <on|off> OR xtrans phase <x> <y>","err");break;case"render":case"apply":if(U[0]==="zero"){const Ue=U[1]==="color"?"zero-dep-color":"zero-dependency";L.current.renderMode=Ue,$(`Rendering Zero-Dependency (${Ue})...`)}else if(U[0]==="unmix"){if(U.length<13){$("Usage: render unmix <4xBL> <4xBG> <4xFG>","err");return}const Ue=U.slice(1).map(Number);if(Ue.some(isNaN)){$("Invalid params","err");return}L.current.renderMode="advanced-zero-dep",L.current.advancedZeroDep={bl:[Ue[0],Ue[1],Ue[2],Ue[3]],bg:[Ue[4],Ue[5],Ue[6],Ue[7]],fg:[Ue[8],Ue[9],Ue[10],Ue[11]]},$("Rendering Advanced Unmix...")}else L.current.renderMode="standard",$("Rendering Standard Pipeline...");a({...L.current});break;case"sel":case"select":if(!r||!i){$("No image loaded","err");return}if(U[0]==="full")i({x:0,y:0,w:r.width,h:r.height});else if(U[0]==="center"){const Ue=parseInt(U[1])||64,K=Math.floor((r.width-Ue)/2),_e=Math.floor((r.height-Ue)/2);i({x:K,y:_e,w:Ue,h:Ue})}else if(U.length===4){const[Ue,K,_e,Te]=U.map(Number);if([Ue,K,_e,Te].some(isNaN)){$("Invalid coordinates","err");return}i({x:Ue,y:K,w:_e,h:Te})}else $("Usage: sel full | sel center <size> | sel <x> <y> <w> <h>","err");break;case"mark":o&&(o(),$("Interactive marking started. Click 4 corners on canvas."));break;case"gen":(U[0]==="test"||U[0]==="pattern")&&s&&(s(),$("Generated Test Pattern"));break;case"drlab":if(U[0]==="config"){const[Ue,K,_e]=U.slice(1).map(Number);e.onDrRoiSizeChange&&e.onDrRoiSizeChange(Ue||64),e.onDrGridRowsChange&&e.onDrGridRowsChange(K||10),e.onDrGridColsChange&&e.onDrGridColsChange(_e||10),$(`DR Grid Configured: Size=${Ue}, Grid=${K}x${_e}`)}else U[0]==="batch"&&(U[1]==="pair"?($("Select file pairs for DR Lab..."),(re=P.current)==null||re.click()):($("Select single files for DR Lab..."),(J=_.current)==null||J.click()));break;case"fft":U[0]==="load"?U[1]==="a"?(ne=E.current)==null||ne.click():U[1]==="b"?(ce=R.current)==null||ce.click():$("Usage: fft load <a|b>","err"):U[0]==="run"?C.current.fileA&&C.current.fileB&&u?($(`Processing Pair: ${C.current.fileA.name} - ${C.current.fileB.name}`),u(C.current.fileA,C.current.fileB,!1,!0)):$("Load both A and B first","err"):U[0]==="stack"?($("Select files for Stack FFT..."),(ie=T.current)==null||ie.click()):U[0]==="batch"&&($("Select files for Batch Diff...","info"),(se=G.current)==null||se.click());break;case"crosscalc":h&&(h(),$("Opened Cross-Calculator"));break;default:$(`Unknown command: ${te}`,"err")}},F=H=>{if(H.key==="Enter"){const Y=y.trim();if(!Y)return;$(`> ${Y}`,"in"),Y.split(";").forEach(U=>{U.trim()&&O(U.trim())}),S(U=>[...U,Y]),v(-1),m("")}else if(H.key==="ArrowUp"){if(H.preventDefault(),k.length>0){const Y=w===-1?k.length-1:Math.max(0,w-1);v(Y),m(k[Y])}}else if(H.key==="ArrowDown")if(H.preventDefault(),w!==-1){const Y=Math.min(k.length-1,w+1);v(Y),m(k[Y])}else m("")},D=(H,Y)=>{H.target.files&&H.target.files.length>0&&l&&($(`Batch processing ${H.target.files.length} files in ${Y} mode...`),l(H.target.files,Y)),H.target.value=""},W=(H,Y)=>{var U;const te=(U=H.target.files)==null?void 0:U[0];te&&(Y==="A"?C.current.fileA=te:C.current.fileB=te,$(`Loaded ${Y}: ${te.name}`)),H.target.value=""};return c.jsxs("div",{className:"flex flex-col h-full bg-black text-green-500 font-mono text-sm border-l-4 border-gray-700 p-2 shadow-2xl",children:[c.jsxs("div",{className:"border-b border-green-800 pb-2 mb-2 flex justify-between items-end select-none",children:[c.jsx("h2",{className:"text-xl font-bold tracking-widest",children:"TERMINAL"}),c.jsx("div",{className:"text-[10px] text-green-700",children:"JIANGTHERAPEE_CLI_V1"})]}),c.jsx("div",{ref:M,className:"flex-grow overflow-y-auto overflow-x-hidden break-words mb-2 pr-1 scrollbar-thin scrollbar-thumb-green-900 scrollbar-track-black",children:g.map(H=>c.jsxs("div",{className:`mb-1 ${H.type==="in"?"opacity-50":""} ${H.type==="err"?"text-red-500":""} ${H.type==="info"?"text-cyan-400":""}`,children:[H.type!=="in"&&typeof H.text=="string"&&!H.text.startsWith(">")&&c.jsx("span",{className:"mr-2 opacity-50",children:">"}),H.text]},H.id))}),c.jsxs("div",{className:"relative flex items-center border-t border-green-800 pt-2",children:[c.jsx("span",{className:"text-green-500 mr-2 animate-pulse font-bold",children:">"}),c.jsx("input",{ref:N,type:"text",value:y,onChange:H=>m(H.target.value),onKeyDown:F,autoFocus:!0,className:"w-full bg-transparent border-none outline-none text-green-400 placeholder-green-900",placeholder:"Enter command (e.g. 'help')",spellCheck:!1,autoComplete:"off"})]}),c.jsx("input",{type:"file",ref:_,className:"hidden",multiple:!0,onChange:H=>D(H,"single")}),c.jsx("input",{type:"file",ref:P,className:"hidden",multiple:!0,onChange:H=>D(H,"pair")}),c.jsx("input",{type:"file",ref:E,className:"hidden",onChange:H=>W(H,"A")}),c.jsx("input",{type:"file",ref:R,className:"hidden",onChange:H=>W(H,"B")}),c.jsx("input",{type:"file",ref:T,className:"hidden",multiple:!0,onChange:H=>{e.onProcessStackFft&&H.target.files&&($(`Loading ${H.target.files.length} frames for Stack FFT...`),e.onProcessStackFft(H.target.files)),H.target.value=""}}),c.jsx("input",{type:"file",ref:G,className:"hidden",multiple:!0,onChange:H=>{e.onProcessBatchDiff&&H.target.files&&($("Starting Batch Diff..."),e.onProcessBatchDiff(H.target.files)),H.target.value=""}})]})}),cI=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];if(f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),n("B").forEach(h=>f[h]=d),f.some(h=>h>0))return f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN)&&l.some(u=>u>0))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},uI=e=>{const[t,r]=j.useState("gui"),{rawImageData:n,exifData:a,isBridgeConnected:i,displaySettings:o,onApplyDisplaySettings:s}=e,l=j.useRef(null),u=j.useRef(o);j.useEffect(()=>{u.current=o},[o]);const d=j.useRef(!1),f=j.useRef(null);j.useEffect(()=>{n!==f.current&&(d.current=!1,f.current=n)},[n]),j.useEffect(()=>{var k;if(!i||!n||d.current)return;const p=cI(n,a);if(!(!!p&&p.some(S=>S>0))||!p)return;const g=u.current,b=g.blackLevel;if(!!b&&b.some(S=>S>0)){d.current=!0;return}d.current=!0,console.log("[AutoApply] Detected Black Levels via Bridge:",p),(k=l.current)==null||k.log(`Auto-detected BL: ${p.join(" ")}`,"info");const m={...g,blackLevel:p};s(m)},[i,n,a,s]);const h=j.useCallback(p=>{var x;(x=l.current)==null||x.log(p,"in")},[]);return c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsxs("div",{className:"flex bg-gray-200 dark:bg-gray-800 p-1 border-b border-gray-300 dark:border-gray-700 flex-shrink-0",children:[c.jsx("button",{onClick:()=>r("gui"),className:`flex-1 py-1 text-xs font-bold uppercase tracking-wider transition-colors border-r border-gray-300 dark:border-gray-700 ${t==="gui"?"bg-white dark:bg-black shadow-inner text-cyan-600 dark:text-cyan-400":"bg-gray-200 dark:bg-gray-900 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"GUI"}),c.jsx("button",{onClick:()=>r("terminal"),className:`flex-1 py-1 text-xs font-bold uppercase tracking-wider transition-colors ${t==="terminal"?"bg-black text-green-500 shadow-inner":"bg-gray-200 dark:bg-gray-900 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Terminal"})]}),c.jsxs("div",{className:"flex-grow overflow-hidden relative",children:[c.jsx("div",{className:`h-full w-full ${t==="gui"?"block":"hidden"}`,children:c.jsx(sI,{...e,onCommand:h})}),c.jsx("div",{className:`h-full w-full ${t==="terminal"?"block":"hidden"}`,children:c.jsx(lI,{...e,ref:l})})]})]})},dI=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})}),fI=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),hI=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M4 12a8 8 0 0114.24-5.12M20 20v-5h-5M20 12a8 8 0 01-14.24 5.12"})}),pI=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})}),mI=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),p1=.1,m1=16,gI=Math.log(p1),xI=Math.log(m1),yI=({zoom:e,onZoomChange:t,onResetView:r,touchAction:n,onToggleTouchAction:a})=>{const i=u=>{const d=parseFloat(u.target.value),f=Math.exp(d);t(Math.max(p1,Math.min(m1,f)))},o=()=>{t(Math.min(m1,e*1.25))},s=()=>{t(Math.max(p1,e/1.25))},l=Math.log(e);return c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",onClick:u=>u.stopPropagation(),children:[c.jsx("div",{className:"bg-white/90 dark:bg-slate-800/70 backdrop-blur-sm p-2 rounded-lg border border-gray-200 dark:border-slate-700 flex items-center shadow-lg transition-colors duration-300",children:c.jsx("button",{onClick:a,className:`p-1.5 rounded-md transition-colors flex items-center justify-center ${n==="select"?"bg-cyan-100 text-cyan-600 dark:bg-cyan-900/50 dark:text-cyan-400 ring-2 ring-cyan-500/50":"text-gray-500 dark:text-slate-400 hover:bg-gray-100 dark:hover:bg-slate-700"}`,title:n==="select"?"Mode: Selection (Drag to Select)":"Mode: Pan (Drag to Move)",children:n==="select"?c.jsx(mI,{}):c.jsx(pI,{})})}),c.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/70 backdrop-blur-sm p-2 rounded-lg border border-gray-200 dark:border-slate-700 flex items-center gap-2 text-gray-700 dark:text-slate-300 shadow-lg transition-colors duration-300",children:[c.jsx("button",{onClick:s,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Zoom Out","aria-label":"Zoom Out",children:c.jsx(dI,{})}),c.jsx("input",{type:"range",min:gI,max:xI,step:"0.01",value:l,onChange:i,className:"w-24 sm:w-32 h-2 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500","aria-label":"Zoom slider"}),c.jsx("button",{onClick:o,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Zoom In","aria-label":"Zoom In",children:c.jsx(fI,{})}),c.jsxs("span",{className:"w-16 text-center font-mono text-sm","aria-live":"polite",children:[(e*100).toFixed(0),"%"]}),c.jsx("button",{onClick:r,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Reset View","aria-label":"Reset View",children:c.jsx(hI,{})})]})]})},bI=({theme:e,setTheme:t})=>{const r=()=>{t(e==="light"?"dark":"light")};return c.jsx("button",{onClick:r,className:"fixed bottom-6 right-6 z-50 p-3 rounded-full bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 shadow-lg text-gray-800 dark:text-yellow-400 hover:bg-gray-100 dark:hover:bg-slate-700 transition-all duration-300",title:`Switch to ${e==="light"?"dark":"light"} mode`,children:e==="light"?c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-slate-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})})};function k_(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=k_(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function kr(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=k_(e))&&(n&&(n+=" "),n+=t);return n}var vI=Array.isArray,Ba=vI,wI=typeof S0=="object"&&S0&&S0.Object===Object&&S0,S_=wI,kI=S_,SI=typeof self=="object"&&self&&self.Object===Object&&self,MI=kI||SI||Function("return this")(),uo=MI,jI=uo,NI=jI.Symbol,n0=NI,g3=n0,M_=Object.prototype,_I=M_.hasOwnProperty,PI=M_.toString,gd=g3?g3.toStringTag:void 0;function CI(e){var t=_I.call(e,gd),r=e[gd];try{e[gd]=void 0;var n=!0}catch{}var a=PI.call(e);return n&&(t?e[gd]=r:delete e[gd]),a}var AI=CI,OI=Object.prototype,TI=OI.toString;function EI(e){return TI.call(e)}var II=EI,x3=n0,RI=AI,DI=II,$I="[object Null]",LI="[object Undefined]",y3=x3?x3.toStringTag:void 0;function FI(e){return e==null?e===void 0?LI:$I:y3&&y3 in Object(e)?RI(e):DI(e)}var zo=FI;function BI(e){return e!=null&&typeof e=="object"}var Wo=BI,GI=zo,UI=Wo,zI="[object Symbol]";function WI(e){return typeof e=="symbol"||UI(e)&&GI(e)==zI}var $u=WI,VI=Ba,HI=$u,XI=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,KI=/^\w*$/;function YI(e,t){if(VI(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||HI(e)?!0:KI.test(e)||!XI.test(e)||t!=null&&e in Object(t)}var o2=YI;function qI(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Ws=qI;const Lu=Vr(Ws);var ZI=zo,JI=Ws,QI="[object AsyncFunction]",eR="[object Function]",tR="[object GeneratorFunction]",rR="[object Proxy]";function nR(e){if(!JI(e))return!1;var t=ZI(e);return t==eR||t==tR||t==QI||t==rR}var s2=nR;const ar=Vr(s2);var aR=uo,iR=aR["__core-js_shared__"],oR=iR,Ax=oR,b3=function(){var e=/[^.]+$/.exec(Ax&&Ax.keys&&Ax.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function sR(e){return!!b3&&b3 in e}var lR=sR,cR=Function.prototype,uR=cR.toString;function dR(e){if(e!=null){try{return uR.call(e)}catch{}try{return e+""}catch{}}return""}var j_=dR,fR=s2,hR=lR,pR=Ws,mR=j_,gR=/[\\^$.*+?()[\]{}|]/g,xR=/^\[object .+?Constructor\]$/,yR=Function.prototype,bR=Object.prototype,vR=yR.toString,wR=bR.hasOwnProperty,kR=RegExp("^"+vR.call(wR).replace(gR,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function SR(e){if(!pR(e)||hR(e))return!1;var t=fR(e)?kR:xR;return t.test(mR(e))}var MR=SR;function jR(e,t){return e==null?void 0:e[t]}var NR=jR,_R=MR,PR=NR;function CR(e,t){var r=PR(e,t);return _R(r)?r:void 0}var Zl=CR,AR=Zl,OR=AR(Object,"create"),Lm=OR,v3=Lm;function TR(){this.__data__=v3?v3(null):{},this.size=0}var ER=TR;function IR(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var RR=IR,DR=Lm,$R="__lodash_hash_undefined__",LR=Object.prototype,FR=LR.hasOwnProperty;function BR(e){var t=this.__data__;if(DR){var r=t[e];return r===$R?void 0:r}return FR.call(t,e)?t[e]:void 0}var GR=BR,UR=Lm,zR=Object.prototype,WR=zR.hasOwnProperty;function VR(e){var t=this.__data__;return UR?t[e]!==void 0:WR.call(t,e)}var HR=VR,XR=Lm,KR="__lodash_hash_undefined__";function YR(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=XR&&t===void 0?KR:t,this}var qR=YR,ZR=ER,JR=RR,QR=GR,eD=HR,tD=qR;function Fu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Fu.prototype.clear=ZR;Fu.prototype.delete=JR;Fu.prototype.get=QR;Fu.prototype.has=eD;Fu.prototype.set=tD;var rD=Fu;function nD(){this.__data__=[],this.size=0}var aD=nD;function iD(e,t){return e===t||e!==e&&t!==t}var l2=iD,oD=l2;function sD(e,t){for(var r=e.length;r--;)if(oD(e[r][0],t))return r;return-1}var Fm=sD,lD=Fm,cD=Array.prototype,uD=cD.splice;function dD(e){var t=this.__data__,r=lD(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():uD.call(t,r,1),--this.size,!0}var fD=dD,hD=Fm;function pD(e){var t=this.__data__,r=hD(t,e);return r<0?void 0:t[r][1]}var mD=pD,gD=Fm;function xD(e){return gD(this.__data__,e)>-1}var yD=xD,bD=Fm;function vD(e,t){var r=this.__data__,n=bD(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var wD=vD,kD=aD,SD=fD,MD=mD,jD=yD,ND=wD;function Bu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Bu.prototype.clear=kD;Bu.prototype.delete=SD;Bu.prototype.get=MD;Bu.prototype.has=jD;Bu.prototype.set=ND;var Bm=Bu,_D=Zl,PD=uo,CD=_D(PD,"Map"),c2=CD,w3=rD,AD=Bm,OD=c2;function TD(){this.size=0,this.__data__={hash:new w3,map:new(OD||AD),string:new w3}}var ED=TD;function ID(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var RD=ID,DD=RD;function $D(e,t){var r=e.__data__;return DD(t)?r[typeof t=="string"?"string":"hash"]:r.map}var Gm=$D,LD=Gm;function FD(e){var t=LD(this,e).delete(e);return this.size-=t?1:0,t}var BD=FD,GD=Gm;function UD(e){return GD(this,e).get(e)}var zD=UD,WD=Gm;function VD(e){return WD(this,e).has(e)}var HD=VD,XD=Gm;function KD(e,t){var r=XD(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var YD=KD,qD=ED,ZD=BD,JD=zD,QD=HD,e$=YD;function Gu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Gu.prototype.clear=qD;Gu.prototype.delete=ZD;Gu.prototype.get=JD;Gu.prototype.has=QD;Gu.prototype.set=e$;var u2=Gu,N_=u2,t$="Expected a function";function d2(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(t$);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=e.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(d2.Cache||N_),r}d2.Cache=N_;var __=d2;const r$=Vr(__);var n$=__,a$=500;function i$(e){var t=n$(e,function(n){return r.size===a$&&r.clear(),n}),r=t.cache;return t}var o$=i$,s$=o$,l$=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,c$=/\\(\\)?/g,u$=s$(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(l$,function(r,n,a,i){t.push(a?i.replace(c$,"$1"):n||r)}),t}),d$=u$;function f$(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var f2=f$,k3=n0,h$=f2,p$=Ba,m$=$u,S3=k3?k3.prototype:void 0,M3=S3?S3.toString:void 0;function P_(e){if(typeof e=="string")return e;if(p$(e))return h$(e,P_)+"";if(m$(e))return M3?M3.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var g$=P_,x$=g$;function y$(e){return e==null?"":x$(e)}var C_=y$,b$=Ba,v$=o2,w$=d$,k$=C_;function S$(e,t){return b$(e)?e:v$(e,t)?[e]:w$(k$(e))}var A_=S$,M$=$u;function j$(e){if(typeof e=="string"||M$(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Um=j$,N$=A_,_$=Um;function P$(e,t){t=N$(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[_$(t[r++])];return r&&r==n?e:void 0}var h2=P$,C$=h2;function A$(e,t,r){var n=e==null?void 0:C$(e,t);return n===void 0?r:n}var O_=A$;const gi=Vr(O_);function O$(e){return e==null}var T$=O$;const Yt=Vr(T$);var E$=zo,I$=Ba,R$=Wo,D$="[object String]";function $$(e){return typeof e=="string"||!I$(e)&&R$(e)&&E$(e)==D$}var L$=$$;const Gl=Vr(L$);var T_={exports:{}},Fr={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var p2=Symbol.for("react.element"),m2=Symbol.for("react.portal"),zm=Symbol.for("react.fragment"),Wm=Symbol.for("react.strict_mode"),Vm=Symbol.for("react.profiler"),Hm=Symbol.for("react.provider"),Xm=Symbol.for("react.context"),F$=Symbol.for("react.server_context"),Km=Symbol.for("react.forward_ref"),Ym=Symbol.for("react.suspense"),qm=Symbol.for("react.suspense_list"),Zm=Symbol.for("react.memo"),Jm=Symbol.for("react.lazy"),B$=Symbol.for("react.offscreen"),E_;E_=Symbol.for("react.module.reference");function vi(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case p2:switch(e=e.type,e){case zm:case Vm:case Wm:case Ym:case qm:return e;default:switch(e=e&&e.$$typeof,e){case F$:case Xm:case Km:case Jm:case Zm:case Hm:return e;default:return t}}case m2:return t}}}Fr.ContextConsumer=Xm;Fr.ContextProvider=Hm;Fr.Element=p2;Fr.ForwardRef=Km;Fr.Fragment=zm;Fr.Lazy=Jm;Fr.Memo=Zm;Fr.Portal=m2;Fr.Profiler=Vm;Fr.StrictMode=Wm;Fr.Suspense=Ym;Fr.SuspenseList=qm;Fr.isAsyncMode=function(){return!1};Fr.isConcurrentMode=function(){return!1};Fr.isContextConsumer=function(e){return vi(e)===Xm};Fr.isContextProvider=function(e){return vi(e)===Hm};Fr.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===p2};Fr.isForwardRef=function(e){return vi(e)===Km};Fr.isFragment=function(e){return vi(e)===zm};Fr.isLazy=function(e){return vi(e)===Jm};Fr.isMemo=function(e){return vi(e)===Zm};Fr.isPortal=function(e){return vi(e)===m2};Fr.isProfiler=function(e){return vi(e)===Vm};Fr.isStrictMode=function(e){return vi(e)===Wm};Fr.isSuspense=function(e){return vi(e)===Ym};Fr.isSuspenseList=function(e){return vi(e)===qm};Fr.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===zm||e===Vm||e===Wm||e===Ym||e===qm||e===B$||typeof e=="object"&&e!==null&&(e.$$typeof===Jm||e.$$typeof===Zm||e.$$typeof===Hm||e.$$typeof===Xm||e.$$typeof===Km||e.$$typeof===E_||e.getModuleId!==void 0)};Fr.typeOf=vi;T_.exports=Fr;var G$=T_.exports,U$=zo,z$=Wo,W$="[object Number]";function V$(e){return typeof e=="number"||z$(e)&&U$(e)==W$}var I_=V$;const H$=Vr(I_);var X$=I_;function K$(e){return X$(e)&&e!=+e}var Y$=K$;const Uu=Vr(Y$);var Ri=function(t){return t===0?0:t>0?1:-1},gl=function(t){return Gl(t)&&t.indexOf("%")===t.length-1},Ge=function(t){return H$(t)&&!Uu(t)},q$=function(t){return Yt(t)},Bn=function(t){return Ge(t)||Gl(t)},Z$=0,Jl=function(t){var r=++Z$;return"".concat(t||"").concat(r)},Ul=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Ge(t)&&!Gl(t))return n;var i;if(gl(t)){var o=t.indexOf("%");i=r*parseFloat(t.slice(0,o))/100}else i=+t;return Uu(i)&&(i=n),a&&i>r&&(i=r),i},hs=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},J$=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},wn=function(t,r){return Ge(t)&&Ge(r)?function(n){return t+n*(r-t)}:function(){return r}};function cp(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):gi(n,t))===r})}var Q$=function(t){if(!t||!t.length)return null;for(var r=t.length,n=0,a=0,i=0,o=0,s=1/0,l=-1/0,u=0,d=0,f=0;f<r;f++)u=t[f].cx||0,d=t[f].cy||0,n+=u,a+=d,i+=u*d,o+=u*u,s=Math.min(s,u),l=Math.max(l,u);var h=r*o!==n*n?(r*i-n*a)/(r*o-n*n):0;return{xmin:s,xmax:l,a:h,b:(a-h*n)/r}},e9=function(t,r){return Ge(t)&&Ge(r)?t-r:Gl(t)&&Gl(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Uc(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function g1(e){"@babel/helpers - typeof";return g1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g1(e)}var t9=["viewBox","children"],r9=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],j3=["points","pathLength"],Ox={svg:t9,polygon:j3,polyline:j3},g2=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],up=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(j.isValidElement(t)&&(n=t.props),!Lu(n))return null;var a={};return Object.keys(n).forEach(function(i){g2.includes(i)&&(a[i]=r||function(o){return n[i](n,o)})}),a},n9=function(t,r,n){return function(a){return t(r,n,a),null}},gf=function(t,r,n){if(!Lu(t)||g1(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(i){var o=t[i];g2.includes(i)&&typeof o=="function"&&(a||(a={}),a[i]=n9(o,r,n))}),a},a9=["children"],i9=["children"];function N3(e,t){if(e==null)return{};var r=o9(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function o9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function x1(e){"@babel/helpers - typeof";return x1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x1(e)}var _3={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},Oo=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},P3=null,Tx=null,x2=function e(t){if(t===P3&&Array.isArray(Tx))return Tx;var r=[];return j.Children.forEach(t,function(n){Yt(n)||(G$.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),Tx=r,P3=t,r};function Fa(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return Oo(a)}):n=[Oo(t)],x2(e).forEach(function(a){var i=gi(a,"type.displayName")||gi(a,"type.name");n.indexOf(i)!==-1&&r.push(a)}),r}function Ka(e,t){var r=Fa(e,t);return r&&r[0]}var C3=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!Ge(n)||n<=0||!Ge(a)||a<=0)},s9=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],l9=function(t){return t&&t.type&&Gl(t.type)&&s9.indexOf(t.type)>=0},R_=function(t){return t&&x1(t)==="object"&&"clipDot"in t},c9=function(t,r,n,a){var i,o=(i=Ox==null?void 0:Ox[a])!==null&&i!==void 0?i:[];return r.startsWith("data-")||!ar(t)&&(a&&o.includes(r)||r9.includes(r))||n&&g2.includes(r)},Qt=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(j.isValidElement(t)&&(a=t.props),!Lu(a))return null;var i={};return Object.keys(a).forEach(function(o){var s;c9((s=a)===null||s===void 0?void 0:s[o],o,r,n)&&(i[o]=a[o])}),i},y1=function e(t,r){if(t===r)return!0;var n=j.Children.count(t);if(n!==j.Children.count(r))return!1;if(n===0)return!0;if(n===1)return A3(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var i=t[a],o=r[a];if(Array.isArray(i)||Array.isArray(o)){if(!e(i,o))return!1}else if(!A3(i,o))return!1}return!0},A3=function(t,r){if(Yt(t)&&Yt(r))return!0;if(!Yt(t)&&!Yt(r)){var n=t.props||{},a=n.children,i=N3(n,a9),o=r.props||{},s=o.children,l=N3(o,i9);return a&&s?Uc(i,l)&&y1(a,s):!a&&!s?Uc(i,l):!1}return!1},O3=function(t,r){var n=[],a={};return x2(t).forEach(function(i,o){if(l9(i))n.push(i);else if(i){var s=Oo(i.type),l=r[s]||{},u=l.handler,d=l.once;if(u&&(!d||!a[s])){var f=u(i,s,o);n.push(f),a[s]=!0}}}),n},u9=function(t){var r=t&&t.type;return r&&_3[r]?_3[r]:null},d9=function(t,r){return x2(r).indexOf(t)},f9=["children","width","height","viewBox","className","style","title","desc"];function b1(){return b1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},b1.apply(this,arguments)}function h9(e,t){if(e==null)return{};var r=p9(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function p9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function v1(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,i=e.className,o=e.style,s=e.title,l=e.desc,u=h9(e,f9),d=a||{width:r,height:n,x:0,y:0},f=kr("recharts-surface",i);return ee.createElement("svg",b1({},Qt(u,!0,"svg"),{className:f,width:r,height:n,style:o,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height)}),ee.createElement("title",null,s),ee.createElement("desc",null,l),t)}var m9=["children","className"];function w1(){return w1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},w1.apply(this,arguments)}function g9(e,t){if(e==null)return{};var r=x9(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function x9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Er=ee.forwardRef(function(e,t){var r=e.children,n=e.className,a=g9(e,m9),i=kr("recharts-layer",n);return ee.createElement("g",w1({className:i},Qt(a,!0),{ref:t}),r)}),To=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i]};function y9(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),r=r>a?a:r,r<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(a);++n<a;)i[n]=e[n+t];return i}var b9=y9,v9=b9;function w9(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:v9(e,t,r)}var k9=w9,S9="\\ud800-\\udfff",M9="\\u0300-\\u036f",j9="\\ufe20-\\ufe2f",N9="\\u20d0-\\u20ff",_9=M9+j9+N9,P9="\\ufe0e\\ufe0f",C9="\\u200d",A9=RegExp("["+C9+S9+_9+P9+"]");function O9(e){return A9.test(e)}var D_=O9;function T9(e){return e.split("")}var E9=T9,$_="\\ud800-\\udfff",I9="\\u0300-\\u036f",R9="\\ufe20-\\ufe2f",D9="\\u20d0-\\u20ff",$9=I9+R9+D9,L9="\\ufe0e\\ufe0f",F9="["+$_+"]",k1="["+$9+"]",S1="\\ud83c[\\udffb-\\udfff]",B9="(?:"+k1+"|"+S1+")",L_="[^"+$_+"]",F_="(?:\\ud83c[\\udde6-\\uddff]){2}",B_="[\\ud800-\\udbff][\\udc00-\\udfff]",G9="\\u200d",G_=B9+"?",U_="["+L9+"]?",U9="(?:"+G9+"(?:"+[L_,F_,B_].join("|")+")"+U_+G_+")*",z9=U_+G_+U9,W9="(?:"+[L_+k1+"?",k1,F_,B_,F9].join("|")+")",V9=RegExp(S1+"(?="+S1+")|"+W9+z9,"g");function H9(e){return e.match(V9)||[]}var X9=H9,K9=E9,Y9=D_,q9=X9;function Z9(e){return Y9(e)?q9(e):K9(e)}var J9=Z9,Q9=k9,e7=D_,t7=J9,r7=C_;function n7(e){return function(t){t=r7(t);var r=e7(t)?t7(t):void 0,n=r?r[0]:t.charAt(0),a=r?Q9(r,1).join(""):t.slice(1);return n[e]()+a}}var a7=n7,i7=a7,o7=i7("toUpperCase"),s7=o7;const Qm=Vr(s7);function Jr(e){return function(){return e}}const z_=Math.cos,dp=Math.sin,Ui=Math.sqrt,fp=Math.PI,eg=2*fp,M1=Math.PI,j1=2*M1,sl=1e-6,l7=j1-sl;function W_(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function c7(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return W_;const r=10**t;return function(n){this._+=n[0];for(let a=1,i=n.length;a<i;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class u7{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?W_:c7(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,i,o){this._append`C${+t},${+r},${+n},${+a},${this._x1=+i},${this._y1=+o}`}arcTo(t,r,n,a,i){if(t=+t,r=+r,n=+n,a=+a,i=+i,i<0)throw new Error(`negative radius: ${i}`);let o=this._x1,s=this._y1,l=n-t,u=a-r,d=o-t,f=s-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>sl)if(!(Math.abs(f*l-u*d)>sl)||!i)this._append`L${this._x1=t},${this._y1=r}`;else{let p=n-o,x=a-s,g=l*l+u*u,b=p*p+x*x,y=Math.sqrt(g),m=Math.sqrt(h),k=i*Math.tan((M1-Math.acos((g+h-b)/(2*y*m)))/2),S=k/m,w=k/y;Math.abs(S-1)>sl&&this._append`L${t+S*d},${r+S*f}`,this._append`A${i},${i},0,0,${+(f*p>d*x)},${this._x1=t+w*l},${this._y1=r+w*u}`}}arc(t,r,n,a,i,o){if(t=+t,r=+r,n=+n,o=!!o,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(a),l=n*Math.sin(a),u=t+s,d=r+l,f=1^o,h=o?a-i:i-a;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>sl||Math.abs(this._y1-d)>sl)&&this._append`L${u},${d}`,n&&(h<0&&(h=h%j1+j1),h>l7?this._append`A${n},${n},0,1,${f},${t-s},${r-l}A${n},${n},0,1,${f},${this._x1=u},${this._y1=d}`:h>sl&&this._append`A${n},${n},0,${+(h>=M1)},${f},${this._x1=t+n*Math.cos(i)},${this._y1=r+n*Math.sin(i)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function y2(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new u7(t)}function b2(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function V_(e){this._context=e}V_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function tg(e){return new V_(e)}function H_(e){return e[0]}function X_(e){return e[1]}function K_(e,t){var r=Jr(!0),n=null,a=tg,i=null,o=y2(s);e=typeof e=="function"?e:e===void 0?H_:Jr(e),t=typeof t=="function"?t:t===void 0?X_:Jr(t);function s(l){var u,d=(l=b2(l)).length,f,h=!1,p;for(n==null&&(i=a(p=o())),u=0;u<=d;++u)!(u<d&&r(f=l[u],u,l))===h&&((h=!h)?i.lineStart():i.lineEnd()),h&&i.point(+e(f,u,l),+t(f,u,l));if(p)return i=null,p+""||null}return s.x=function(l){return arguments.length?(e=typeof l=="function"?l:Jr(+l),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Jr(+l),s):t},s.defined=function(l){return arguments.length?(r=typeof l=="function"?l:Jr(!!l),s):r},s.curve=function(l){return arguments.length?(a=l,n!=null&&(i=a(n)),s):a},s.context=function(l){return arguments.length?(l==null?n=i=null:i=a(n=l),s):n},s}function Y0(e,t,r){var n=null,a=Jr(!0),i=null,o=tg,s=null,l=y2(u);e=typeof e=="function"?e:e===void 0?H_:Jr(+e),t=typeof t=="function"?t:Jr(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?X_:Jr(+r);function u(f){var h,p,x,g=(f=b2(f)).length,b,y=!1,m,k=new Array(g),S=new Array(g);for(i==null&&(s=o(m=l())),h=0;h<=g;++h){if(!(h<g&&a(b=f[h],h,f))===y)if(y=!y)p=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),x=h-1;x>=p;--x)s.point(k[x],S[x]);s.lineEnd(),s.areaEnd()}y&&(k[h]=+e(b,h,f),S[h]=+t(b,h,f),s.point(n?+n(b,h,f):k[h],r?+r(b,h,f):S[h]))}if(m)return s=null,m+""||null}function d(){return K_().defined(a).curve(o).context(i)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:Jr(+f),n=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Jr(+f),u):e},u.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Jr(+f),u):n},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:Jr(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Jr(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Jr(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(n).y(t)},u.defined=function(f){return arguments.length?(a=typeof f=="function"?f:Jr(!!f),u):a},u.curve=function(f){return arguments.length?(o=f,i!=null&&(s=o(i)),u):o},u.context=function(f){return arguments.length?(f==null?i=s=null:s=o(i=f),u):i},u}class Y_{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function d7(e){return new Y_(e,!0)}function f7(e){return new Y_(e,!1)}const v2={draw(e,t){const r=Ui(t/fp);e.moveTo(r,0),e.arc(0,0,r,0,eg)}},h7={draw(e,t){const r=Ui(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},q_=Ui(1/3),p7=q_*2,m7={draw(e,t){const r=Ui(t/p7),n=r*q_;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},g7={draw(e,t){const r=Ui(t),n=-r/2;e.rect(n,n,r,r)}},x7=.8908130915292852,Z_=dp(fp/10)/dp(7*fp/10),y7=dp(eg/10)*Z_,b7=-z_(eg/10)*Z_,v7={draw(e,t){const r=Ui(t*x7),n=y7*r,a=b7*r;e.moveTo(0,-r),e.lineTo(n,a);for(let i=1;i<5;++i){const o=eg*i/5,s=z_(o),l=dp(o);e.lineTo(l*r,-s*r),e.lineTo(s*n-l*a,l*n+s*a)}e.closePath()}},Ex=Ui(3),w7={draw(e,t){const r=-Ui(t/(Ex*3));e.moveTo(0,r*2),e.lineTo(-Ex*r,-r),e.lineTo(Ex*r,-r),e.closePath()}},oi=-.5,si=Ui(3)/2,N1=1/Ui(12),k7=(N1/2+1)*3,S7={draw(e,t){const r=Ui(t/k7),n=r/2,a=r*N1,i=n,o=r*N1+r,s=-i,l=o;e.moveTo(n,a),e.lineTo(i,o),e.lineTo(s,l),e.lineTo(oi*n-si*a,si*n+oi*a),e.lineTo(oi*i-si*o,si*i+oi*o),e.lineTo(oi*s-si*l,si*s+oi*l),e.lineTo(oi*n+si*a,oi*a-si*n),e.lineTo(oi*i+si*o,oi*o-si*i),e.lineTo(oi*s+si*l,oi*l-si*s),e.closePath()}};function M7(e,t){let r=null,n=y2(a);e=typeof e=="function"?e:Jr(e||v2),t=typeof t=="function"?t:Jr(t===void 0?64:+t);function a(){let i;if(r||(r=i=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),i)return r=null,i+""||null}return a.type=function(i){return arguments.length?(e=typeof i=="function"?i:Jr(i),a):e},a.size=function(i){return arguments.length?(t=typeof i=="function"?i:Jr(+i),a):t},a.context=function(i){return arguments.length?(r=i??null,a):r},a}function hp(){}function pp(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function J_(e){this._context=e}J_.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:pp(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:pp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function j7(e){return new J_(e)}function Q_(e){this._context=e}Q_.prototype={areaStart:hp,areaEnd:hp,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:pp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function N7(e){return new Q_(e)}function eP(e){this._context=e}eP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:pp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function _7(e){return new eP(e)}function tP(e){this._context=e}tP.prototype={areaStart:hp,areaEnd:hp,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function P7(e){return new tP(e)}function T3(e){return e<0?-1:1}function E3(e,t,r){var n=e._x1-e._x0,a=t-e._x1,i=(e._y1-e._y0)/(n||a<0&&-0),o=(r-e._y1)/(a||n<0&&-0),s=(i*a+o*n)/(n+a);return(T3(i)+T3(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(s))||0}function I3(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function Ix(e,t,r){var n=e._x0,a=e._y0,i=e._x1,o=e._y1,s=(i-n)/3;e._context.bezierCurveTo(n+s,a+s*t,i-s,o-s*r,i,o)}function mp(e){this._context=e}mp.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:Ix(this,this._t0,I3(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,Ix(this,I3(this,r=E3(this,e,t)),r);break;default:Ix(this,this._t0,r=E3(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function rP(e){this._context=new nP(e)}(rP.prototype=Object.create(mp.prototype)).point=function(e,t){mp.prototype.point.call(this,t,e)};function nP(e){this._context=e}nP.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,i){this._context.bezierCurveTo(t,e,n,r,i,a)}};function C7(e){return new mp(e)}function A7(e){return new rP(e)}function aP(e){this._context=e}aP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=R3(e),a=R3(t),i=0,o=1;o<r;++i,++o)this._context.bezierCurveTo(n[0][i],a[0][i],n[1][i],a[1][i],e[o],t[o]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function R3(e){var t,r=e.length-1,n,a=new Array(r),i=new Array(r),o=new Array(r);for(a[0]=0,i[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,i[t]=4,o[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,i[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/i[t-1],i[t]-=n,o[t]-=n*o[t-1];for(a[r-1]=o[r-1]/i[r-1],t=r-2;t>=0;--t)a[t]=(o[t]-a[t+1])/i[t];for(i[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)i[t]=2*e[t+1]-a[t+1];return[a,i]}function O7(e){return new aP(e)}function rg(e,t){this._context=e,this._t=t}rg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function T7(e){return new rg(e,.5)}function E7(e){return new rg(e,0)}function I7(e){return new rg(e,1)}function ru(e,t){if((o=e.length)>1)for(var r=1,n,a,i=e[t[0]],o,s=i.length;r<o;++r)for(a=i,i=e[t[r]],n=0;n<s;++n)i[n][1]+=i[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function _1(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function R7(e,t){return e[t]}function D7(e){const t=[];return t.key=e,t}function $7(){var e=Jr([]),t=_1,r=ru,n=R7;function a(i){var o=Array.from(e.apply(this,arguments),D7),s,l=o.length,u=-1,d;for(const f of i)for(s=0,++u;s<l;++s)(o[s][u]=[0,+n(f,o[s].key,u,i)]).data=f;for(s=0,d=b2(t(o));s<l;++s)o[d[s]].index=s;return r(o,d),o}return a.keys=function(i){return arguments.length?(e=typeof i=="function"?i:Jr(Array.from(i)),a):e},a.value=function(i){return arguments.length?(n=typeof i=="function"?i:Jr(+i),a):n},a.order=function(i){return arguments.length?(t=i==null?_1:typeof i=="function"?i:Jr(Array.from(i)),a):t},a.offset=function(i){return arguments.length?(r=i??ru,a):r},a}function L7(e,t){if((n=e.length)>0){for(var r,n,a=0,i=e[0].length,o;a<i;++a){for(o=r=0;r<n;++r)o+=e[r][a][1]||0;if(o)for(r=0;r<n;++r)e[r][a][1]/=o}ru(e,t)}}function F7(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,i=n.length;r<i;++r){for(var o=0,s=0;o<a;++o)s+=e[o][r][1]||0;n[r][1]+=n[r][0]=-s/2}ru(e,t)}}function B7(e,t){if(!(!((o=e.length)>0)||!((i=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,i,o;n<i;++n){for(var s=0,l=0,u=0;s<o;++s){for(var d=e[t[s]],f=d[n][1]||0,h=d[n-1][1]||0,p=(f-h)/2,x=0;x<s;++x){var g=e[t[x]],b=g[n][1]||0,y=g[n-1][1]||0;p+=b-y}l+=f,u+=p*f}a[n-1][1]+=a[n-1][0]=r,l&&(r-=u/l)}a[n-1][1]+=a[n-1][0]=r,ru(e,t)}}function xf(e){"@babel/helpers - typeof";return xf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xf(e)}var G7=["type","size","sizeType"];function P1(){return P1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},P1.apply(this,arguments)}function D3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D3(Object(r),!0).forEach(function(n){U7(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function U7(e,t,r){return t=z7(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function z7(e){var t=W7(e,"string");return xf(t)=="symbol"?t:t+""}function W7(e,t){if(xf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function V7(e,t){if(e==null)return{};var r=H7(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function H7(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var iP={symbolCircle:v2,symbolCross:h7,symbolDiamond:m7,symbolSquare:g7,symbolStar:v7,symbolTriangle:w7,symbolWye:S7},X7=Math.PI/180,K7=function(t){var r="symbol".concat(Qm(t));return iP[r]||v2},Y7=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*X7;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},q7=function(t,r){iP["symbol".concat(Qm(t))]=r},ng=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,i=a===void 0?64:a,o=t.sizeType,s=o===void 0?"area":o,l=V7(t,G7),u=$3($3({},l),{},{type:n,size:i,sizeType:s}),d=function(){var b=K7(n),y=M7().type(b).size(Y7(i,s,n));return y()},f=u.className,h=u.cx,p=u.cy,x=Qt(u,!0);return h===+h&&p===+p&&i===+i?ee.createElement("path",P1({},x,{className:kr("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(p,")"),d:d()})):null};ng.registerSymbol=q7;function nu(e){"@babel/helpers - typeof";return nu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nu(e)}function C1(){return C1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},C1.apply(this,arguments)}function L3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Z7(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L3(Object(r),!0).forEach(function(n){yf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function J7(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Q7(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sP(n.key),n)}}function eL(e,t,r){return t&&Q7(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function tL(e,t,r){return t=gp(t),rL(e,oP()?Reflect.construct(t,r||[],gp(e).constructor):t.apply(e,r))}function rL(e,t){if(t&&(nu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return nL(e)}function nL(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oP=function(){return!!e})()}function gp(e){return gp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},gp(e)}function aL(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A1(e,t)}function A1(e,t){return A1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},A1(e,t)}function yf(e,t,r){return t=sP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sP(e){var t=iL(e,"string");return nu(t)=="symbol"?t:t+""}function iL(e,t){if(nu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(nu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var li=32,w2=function(e){function t(){return J7(this,t),tL(this,t,arguments)}return aL(t,e),eL(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,i=li/2,o=li/6,s=li/3,l=n.inactive?a:n.color;if(n.type==="plainline")return ee.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:i,x2:li,y2:i,className:"recharts-legend-icon"});if(n.type==="line")return ee.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(i,"h").concat(s,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(2*s,",").concat(i,`
            H`).concat(li,"M").concat(2*s,",").concat(i,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(s,",").concat(i),className:"recharts-legend-icon"});if(n.type==="rect")return ee.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(li/8,"h").concat(li,"v").concat(li*3/4,"h").concat(-li,"z"),className:"recharts-legend-icon"});if(ee.isValidElement(n.legendIcon)){var u=Z7({},n);return delete u.legendIcon,ee.cloneElement(n.legendIcon,u)}return ee.createElement(ng,{fill:l,cx:i,cy:i,size:li,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,i=a.payload,o=a.iconSize,s=a.layout,l=a.formatter,u=a.inactiveColor,d={x:0,y:0,width:li,height:li},f={display:s==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return i.map(function(p,x){var g=p.formatter||l,b=kr(yf(yf({"recharts-legend-item":!0},"legend-item-".concat(x),!0),"inactive",p.inactive));if(p.type==="none")return null;var y=ar(p.value)?null:p.value;To(!ar(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var m=p.inactive?u:p.color;return ee.createElement("li",C1({className:b,style:f,key:"legend-item-".concat(x)},gf(n.props,p,x)),ee.createElement(v1,{width:o,height:o,viewBox:d,style:h},n.renderIcon(p)),ee.createElement("span",{className:"recharts-legend-item-text",style:{color:m}},g?g(y,p,x):y))})}},{key:"render",value:function(){var n=this.props,a=n.payload,i=n.layout,o=n.align;if(!a||!a.length)return null;var s={padding:0,margin:0,textAlign:i==="horizontal"?o:"left"};return ee.createElement("ul",{className:"recharts-default-legend",style:s},this.renderItems())}}])}(j.PureComponent);yf(w2,"displayName","Legend");yf(w2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var oL=Bm;function sL(){this.__data__=new oL,this.size=0}var lL=sL;function cL(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var uL=cL;function dL(e){return this.__data__.get(e)}var fL=dL;function hL(e){return this.__data__.has(e)}var pL=hL,mL=Bm,gL=c2,xL=u2,yL=200;function bL(e,t){var r=this.__data__;if(r instanceof mL){var n=r.__data__;if(!gL||n.length<yL-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new xL(n)}return r.set(e,t),this.size=r.size,this}var vL=bL,wL=Bm,kL=lL,SL=uL,ML=fL,jL=pL,NL=vL;function zu(e){var t=this.__data__=new wL(e);this.size=t.size}zu.prototype.clear=kL;zu.prototype.delete=SL;zu.prototype.get=ML;zu.prototype.has=jL;zu.prototype.set=NL;var lP=zu,_L="__lodash_hash_undefined__";function PL(e){return this.__data__.set(e,_L),this}var CL=PL;function AL(e){return this.__data__.has(e)}var OL=AL,TL=u2,EL=CL,IL=OL;function xp(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new TL;++t<r;)this.add(e[t])}xp.prototype.add=xp.prototype.push=EL;xp.prototype.has=IL;var cP=xp;function RL(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var uP=RL;function DL(e,t){return e.has(t)}var dP=DL,$L=cP,LL=uP,FL=dP,BL=1,GL=2;function UL(e,t,r,n,a,i){var o=r&BL,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=i.get(e),d=i.get(t);if(u&&d)return u==t&&d==e;var f=-1,h=!0,p=r&GL?new $L:void 0;for(i.set(e,t),i.set(t,e);++f<s;){var x=e[f],g=t[f];if(n)var b=o?n(g,x,f,t,e,i):n(x,g,f,e,t,i);if(b!==void 0){if(b)continue;h=!1;break}if(p){if(!LL(t,function(y,m){if(!FL(p,m)&&(x===y||a(x,y,r,n,i)))return p.push(m)})){h=!1;break}}else if(!(x===g||a(x,g,r,n,i))){h=!1;break}}return i.delete(e),i.delete(t),h}var fP=UL,zL=uo,WL=zL.Uint8Array,VL=WL;function HL(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var XL=HL;function KL(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var k2=KL,F3=n0,B3=VL,YL=l2,qL=fP,ZL=XL,JL=k2,QL=1,eF=2,tF="[object Boolean]",rF="[object Date]",nF="[object Error]",aF="[object Map]",iF="[object Number]",oF="[object RegExp]",sF="[object Set]",lF="[object String]",cF="[object Symbol]",uF="[object ArrayBuffer]",dF="[object DataView]",G3=F3?F3.prototype:void 0,Rx=G3?G3.valueOf:void 0;function fF(e,t,r,n,a,i,o){switch(r){case dF:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case uF:return!(e.byteLength!=t.byteLength||!i(new B3(e),new B3(t)));case tF:case rF:case iF:return YL(+e,+t);case nF:return e.name==t.name&&e.message==t.message;case oF:case lF:return e==t+"";case aF:var s=ZL;case sF:var l=n&QL;if(s||(s=JL),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=eF,o.set(e,t);var d=qL(s(e),s(t),n,a,i,o);return o.delete(e),d;case cF:if(Rx)return Rx.call(e)==Rx.call(t)}return!1}var hF=fF;function pF(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var hP=pF,mF=hP,gF=Ba;function xF(e,t,r){var n=t(e);return gF(e)?n:mF(n,r(e))}var yF=xF;function bF(e,t){for(var r=-1,n=e==null?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i}var vF=bF;function wF(){return[]}var kF=wF,SF=vF,MF=kF,jF=Object.prototype,NF=jF.propertyIsEnumerable,U3=Object.getOwnPropertySymbols,_F=U3?function(e){return e==null?[]:(e=Object(e),SF(U3(e),function(t){return NF.call(e,t)}))}:MF,PF=_F;function CF(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var AF=CF,OF=zo,TF=Wo,EF="[object Arguments]";function IF(e){return TF(e)&&OF(e)==EF}var RF=IF,z3=RF,DF=Wo,pP=Object.prototype,$F=pP.hasOwnProperty,LF=pP.propertyIsEnumerable,FF=z3(function(){return arguments}())?z3:function(e){return DF(e)&&$F.call(e,"callee")&&!LF.call(e,"callee")},S2=FF,yp={exports:{}};function BF(){return!1}var GF=BF;yp.exports;(function(e,t){var r=uo,n=GF,a=t&&!t.nodeType&&t,i=a&&!0&&e&&!e.nodeType&&e,o=i&&i.exports===a,s=o?r.Buffer:void 0,l=s?s.isBuffer:void 0,u=l||n;e.exports=u})(yp,yp.exports);var mP=yp.exports,UF=9007199254740991,zF=/^(?:0|[1-9]\d*)$/;function WF(e,t){var r=typeof e;return t=t??UF,!!t&&(r=="number"||r!="symbol"&&zF.test(e))&&e>-1&&e%1==0&&e<t}var M2=WF,VF=9007199254740991;function HF(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=VF}var j2=HF,XF=zo,KF=j2,YF=Wo,qF="[object Arguments]",ZF="[object Array]",JF="[object Boolean]",QF="[object Date]",eB="[object Error]",tB="[object Function]",rB="[object Map]",nB="[object Number]",aB="[object Object]",iB="[object RegExp]",oB="[object Set]",sB="[object String]",lB="[object WeakMap]",cB="[object ArrayBuffer]",uB="[object DataView]",dB="[object Float32Array]",fB="[object Float64Array]",hB="[object Int8Array]",pB="[object Int16Array]",mB="[object Int32Array]",gB="[object Uint8Array]",xB="[object Uint8ClampedArray]",yB="[object Uint16Array]",bB="[object Uint32Array]",tn={};tn[dB]=tn[fB]=tn[hB]=tn[pB]=tn[mB]=tn[gB]=tn[xB]=tn[yB]=tn[bB]=!0;tn[qF]=tn[ZF]=tn[cB]=tn[JF]=tn[uB]=tn[QF]=tn[eB]=tn[tB]=tn[rB]=tn[nB]=tn[aB]=tn[iB]=tn[oB]=tn[sB]=tn[lB]=!1;function vB(e){return YF(e)&&KF(e.length)&&!!tn[XF(e)]}var wB=vB;function kB(e){return function(t){return e(t)}}var gP=kB,bp={exports:{}};bp.exports;(function(e,t){var r=S_,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,i=a&&a.exports===n,o=i&&r.process,s=function(){try{var l=a&&a.require&&a.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();e.exports=s})(bp,bp.exports);var SB=bp.exports,MB=wB,jB=gP,W3=SB,V3=W3&&W3.isTypedArray,NB=V3?jB(V3):MB,xP=NB,_B=AF,PB=S2,CB=Ba,AB=mP,OB=M2,TB=xP,EB=Object.prototype,IB=EB.hasOwnProperty;function RB(e,t){var r=CB(e),n=!r&&PB(e),a=!r&&!n&&AB(e),i=!r&&!n&&!a&&TB(e),o=r||n||a||i,s=o?_B(e.length,String):[],l=s.length;for(var u in e)(t||IB.call(e,u))&&!(o&&(u=="length"||a&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||OB(u,l)))&&s.push(u);return s}var DB=RB,$B=Object.prototype;function LB(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||$B;return e===r}var FB=LB;function BB(e,t){return function(r){return e(t(r))}}var yP=BB,GB=yP,UB=GB(Object.keys,Object),zB=UB,WB=FB,VB=zB,HB=Object.prototype,XB=HB.hasOwnProperty;function KB(e){if(!WB(e))return VB(e);var t=[];for(var r in Object(e))XB.call(e,r)&&r!="constructor"&&t.push(r);return t}var YB=KB,qB=s2,ZB=j2;function JB(e){return e!=null&&ZB(e.length)&&!qB(e)}var a0=JB,QB=DB,eG=YB,tG=a0;function rG(e){return tG(e)?QB(e):eG(e)}var ag=rG,nG=yF,aG=PF,iG=ag;function oG(e){return nG(e,iG,aG)}var sG=oG,H3=sG,lG=1,cG=Object.prototype,uG=cG.hasOwnProperty;function dG(e,t,r,n,a,i){var o=r&lG,s=H3(e),l=s.length,u=H3(t),d=u.length;if(l!=d&&!o)return!1;for(var f=l;f--;){var h=s[f];if(!(o?h in t:uG.call(t,h)))return!1}var p=i.get(e),x=i.get(t);if(p&&x)return p==t&&x==e;var g=!0;i.set(e,t),i.set(t,e);for(var b=o;++f<l;){h=s[f];var y=e[h],m=t[h];if(n)var k=o?n(m,y,h,t,e,i):n(y,m,h,e,t,i);if(!(k===void 0?y===m||a(y,m,r,n,i):k)){g=!1;break}b||(b=h=="constructor")}if(g&&!b){var S=e.constructor,w=t.constructor;S!=w&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof w=="function"&&w instanceof w)&&(g=!1)}return i.delete(e),i.delete(t),g}var fG=dG,hG=Zl,pG=uo,mG=hG(pG,"DataView"),gG=mG,xG=Zl,yG=uo,bG=xG(yG,"Promise"),vG=bG,wG=Zl,kG=uo,SG=wG(kG,"Set"),bP=SG,MG=Zl,jG=uo,NG=MG(jG,"WeakMap"),_G=NG,O1=gG,T1=c2,E1=vG,I1=bP,R1=_G,vP=zo,Wu=j_,X3="[object Map]",PG="[object Object]",K3="[object Promise]",Y3="[object Set]",q3="[object WeakMap]",Z3="[object DataView]",CG=Wu(O1),AG=Wu(T1),OG=Wu(E1),TG=Wu(I1),EG=Wu(R1),ll=vP;(O1&&ll(new O1(new ArrayBuffer(1)))!=Z3||T1&&ll(new T1)!=X3||E1&&ll(E1.resolve())!=K3||I1&&ll(new I1)!=Y3||R1&&ll(new R1)!=q3)&&(ll=function(e){var t=vP(e),r=t==PG?e.constructor:void 0,n=r?Wu(r):"";if(n)switch(n){case CG:return Z3;case AG:return X3;case OG:return K3;case TG:return Y3;case EG:return q3}return t});var IG=ll,Dx=lP,RG=fP,DG=hF,$G=fG,J3=IG,Q3=Ba,eS=mP,LG=xP,FG=1,tS="[object Arguments]",rS="[object Array]",q0="[object Object]",BG=Object.prototype,nS=BG.hasOwnProperty;function GG(e,t,r,n,a,i){var o=Q3(e),s=Q3(t),l=o?rS:J3(e),u=s?rS:J3(t);l=l==tS?q0:l,u=u==tS?q0:u;var d=l==q0,f=u==q0,h=l==u;if(h&&eS(e)){if(!eS(t))return!1;o=!0,d=!1}if(h&&!d)return i||(i=new Dx),o||LG(e)?RG(e,t,r,n,a,i):DG(e,t,l,r,n,a,i);if(!(r&FG)){var p=d&&nS.call(e,"__wrapped__"),x=f&&nS.call(t,"__wrapped__");if(p||x){var g=p?e.value():e,b=x?t.value():t;return i||(i=new Dx),a(g,b,r,n,i)}}return h?(i||(i=new Dx),$G(e,t,r,n,a,i)):!1}var UG=GG,zG=UG,aS=Wo;function wP(e,t,r,n,a){return e===t?!0:e==null||t==null||!aS(e)&&!aS(t)?e!==e&&t!==t:zG(e,t,r,n,wP,a)}var N2=wP,WG=lP,VG=N2,HG=1,XG=2;function KG(e,t,r,n){var a=r.length,i=a,o=!n;if(e==null)return!i;for(e=Object(e);a--;){var s=r[a];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<i;){s=r[a];var l=s[0],u=e[l],d=s[1];if(o&&s[2]){if(u===void 0&&!(l in e))return!1}else{var f=new WG;if(n)var h=n(u,d,l,e,t,f);if(!(h===void 0?VG(d,u,HG|XG,n,f):h))return!1}}return!0}var YG=KG,qG=Ws;function ZG(e){return e===e&&!qG(e)}var kP=ZG,JG=kP,QG=ag;function eU(e){for(var t=QG(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,JG(a)]}return t}var tU=eU;function rU(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var SP=rU,nU=YG,aU=tU,iU=SP;function oU(e){var t=aU(e);return t.length==1&&t[0][2]?iU(t[0][0],t[0][1]):function(r){return r===e||nU(r,e,t)}}var sU=oU;function lU(e,t){return e!=null&&t in Object(e)}var cU=lU,uU=A_,dU=S2,fU=Ba,hU=M2,pU=j2,mU=Um;function gU(e,t,r){t=uU(t,e);for(var n=-1,a=t.length,i=!1;++n<a;){var o=mU(t[n]);if(!(i=e!=null&&r(e,o)))break;e=e[o]}return i||++n!=a?i:(a=e==null?0:e.length,!!a&&pU(a)&&hU(o,a)&&(fU(e)||dU(e)))}var xU=gU,yU=cU,bU=xU;function vU(e,t){return e!=null&&bU(e,t,yU)}var wU=vU,kU=N2,SU=O_,MU=wU,jU=o2,NU=kP,_U=SP,PU=Um,CU=1,AU=2;function OU(e,t){return jU(e)&&NU(t)?_U(PU(e),t):function(r){var n=SU(r,e);return n===void 0&&n===t?MU(r,e):kU(t,n,CU|AU)}}var TU=OU;function EU(e){return e}var Vu=EU;function IU(e){return function(t){return t==null?void 0:t[e]}}var RU=IU,DU=h2;function $U(e){return function(t){return DU(t,e)}}var LU=$U,FU=RU,BU=LU,GU=o2,UU=Um;function zU(e){return GU(e)?FU(UU(e)):BU(e)}var WU=zU,VU=sU,HU=TU,XU=Vu,KU=Ba,YU=WU;function qU(e){return typeof e=="function"?e:e==null?XU:typeof e=="object"?KU(e)?HU(e[0],e[1]):VU(e):YU(e)}var Vs=qU;function ZU(e,t,r,n){for(var a=e.length,i=r+(n?1:-1);n?i--:++i<a;)if(t(e[i],i,e))return i;return-1}var MP=ZU;function JU(e){return e!==e}var QU=JU;function ez(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}var tz=ez,rz=MP,nz=QU,az=tz;function iz(e,t,r){return t===t?az(e,t,r):rz(e,nz,r)}var oz=iz,sz=oz;function lz(e,t){var r=e==null?0:e.length;return!!r&&sz(e,t,0)>-1}var cz=lz;function uz(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var dz=uz;function fz(){}var hz=fz,$x=bP,pz=hz,mz=k2,gz=1/0,xz=$x&&1/mz(new $x([,-0]))[1]==gz?function(e){return new $x(e)}:pz,yz=xz,bz=cP,vz=cz,wz=dz,kz=dP,Sz=yz,Mz=k2,jz=200;function Nz(e,t,r){var n=-1,a=vz,i=e.length,o=!0,s=[],l=s;if(r)o=!1,a=wz;else if(i>=jz){var u=t?null:Sz(e);if(u)return Mz(u);o=!1,a=kz,l=new bz}else l=t?[]:s;e:for(;++n<i;){var d=e[n],f=t?t(d):d;if(d=r||d!==0?d:0,o&&f===f){for(var h=l.length;h--;)if(l[h]===f)continue e;t&&l.push(f),s.push(d)}else a(l,f,r)||(l!==s&&l.push(f),s.push(d))}return s}var _z=Nz,Pz=Vs,Cz=_z;function Az(e,t){return e&&e.length?Cz(e,Pz(t)):[]}var Oz=Az;const iS=Vr(Oz);function jP(e,t,r){return t===!0?iS(e,r):ar(t)?iS(e,t):e}function au(e){"@babel/helpers - typeof";return au=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},au(e)}var Tz=["ref"];function oS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function vo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?oS(Object(r),!0).forEach(function(n){ig(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ez(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function sS(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_P(n.key),n)}}function Iz(e,t,r){return t&&sS(e.prototype,t),r&&sS(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Rz(e,t,r){return t=vp(t),Dz(e,NP()?Reflect.construct(t,r||[],vp(e).constructor):t.apply(e,r))}function Dz(e,t){if(t&&(au(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return $z(e)}function $z(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NP=function(){return!!e})()}function vp(e){return vp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},vp(e)}function Lz(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&D1(e,t)}function D1(e,t){return D1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},D1(e,t)}function ig(e,t,r){return t=_P(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _P(e){var t=Fz(e,"string");return au(t)=="symbol"?t:t+""}function Fz(e,t){if(au(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(au(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Bz(e,t){if(e==null)return{};var r=Gz(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Gz(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Uz(e){return e.value}function zz(e,t){if(ee.isValidElement(e))return ee.cloneElement(e,t);if(typeof e=="function")return ee.createElement(e,t);t.ref;var r=Bz(t,Tz);return ee.createElement(w2,r)}var lS=1,ro=function(e){function t(){var r;Ez(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Rz(this,t,[].concat(a)),ig(r,"lastBoundingBox",{width:-1,height:-1}),r}return Lz(t,e),Iz(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>lS||Math.abs(a.height-this.lastBoundingBox.height)>lS)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?vo({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,i=a.layout,o=a.align,s=a.verticalAlign,l=a.margin,u=a.chartWidth,d=a.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(o==="center"&&i==="vertical"){var p=this.getBBoxSnapshot();f={left:((u||0)-p.width)/2}}else f=o==="right"?{right:l&&l.right||0}:{left:l&&l.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(s==="middle"){var x=this.getBBoxSnapshot();h={top:((d||0)-x.height)/2}}else h=s==="bottom"?{bottom:l&&l.bottom||0}:{top:l&&l.top||0};return vo(vo({},f),h)}},{key:"render",value:function(){var n=this,a=this.props,i=a.content,o=a.width,s=a.height,l=a.wrapperStyle,u=a.payloadUniqBy,d=a.payload,f=vo(vo({position:"absolute",width:o||"auto",height:s||"auto"},this.getDefaultPosition(l)),l);return ee.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(p){n.wrapperNode=p}},zz(i,vo(vo({},this.props),{},{payload:jP(d,u,Uz)})))}}],[{key:"getWithHeight",value:function(n,a){var i=vo(vo({},this.defaultProps),n.props),o=i.layout;return o==="vertical"&&Ge(n.props.height)?{height:n.props.height}:o==="horizontal"?{width:n.props.width||a}:null}}])}(j.PureComponent);ig(ro,"displayName","Legend");ig(ro,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var cS=n0,Wz=S2,Vz=Ba,uS=cS?cS.isConcatSpreadable:void 0;function Hz(e){return Vz(e)||Wz(e)||!!(uS&&e&&e[uS])}var Xz=Hz,Kz=hP,Yz=Xz;function PP(e,t,r,n,a){var i=-1,o=e.length;for(r||(r=Yz),a||(a=[]);++i<o;){var s=e[i];t>0&&r(s)?t>1?PP(s,t-1,r,n,a):Kz(a,s):n||(a[a.length]=s)}return a}var CP=PP;function qz(e){return function(t,r,n){for(var a=-1,i=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++a];if(r(i[l],l,i)===!1)break}return t}}var Zz=qz,Jz=Zz,Qz=Jz(),eW=Qz,tW=eW,rW=ag;function nW(e,t){return e&&tW(e,t,rW)}var AP=nW,aW=a0;function iW(e,t){return function(r,n){if(r==null)return r;if(!aW(r))return e(r,n);for(var a=r.length,i=t?a:-1,o=Object(r);(t?i--:++i<a)&&n(o[i],i,o)!==!1;);return r}}var oW=iW,sW=AP,lW=oW,cW=lW(sW),_2=cW,uW=_2,dW=a0;function fW(e,t){var r=-1,n=dW(e)?Array(e.length):[];return uW(e,function(a,i,o){n[++r]=t(a,i,o)}),n}var OP=fW;function hW(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var pW=hW,dS=$u;function mW(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,i=dS(e),o=t!==void 0,s=t===null,l=t===t,u=dS(t);if(!s&&!u&&!i&&e>t||i&&o&&l&&!s&&!u||n&&o&&l||!r&&l||!a)return 1;if(!n&&!i&&!u&&e<t||u&&r&&a&&!n&&!i||s&&r&&a||!o&&a||!l)return-1}return 0}var gW=mW,xW=gW;function yW(e,t,r){for(var n=-1,a=e.criteria,i=t.criteria,o=a.length,s=r.length;++n<o;){var l=xW(a[n],i[n]);if(l){if(n>=s)return l;var u=r[n];return l*(u=="desc"?-1:1)}}return e.index-t.index}var bW=yW,Lx=f2,vW=h2,wW=Vs,kW=OP,SW=pW,MW=gP,jW=bW,NW=Vu,_W=Ba;function PW(e,t,r){t.length?t=Lx(t,function(i){return _W(i)?function(o){return vW(o,i.length===1?i[0]:i)}:i}):t=[NW];var n=-1;t=Lx(t,MW(wW));var a=kW(e,function(i,o,s){var l=Lx(t,function(u){return u(i)});return{criteria:l,index:++n,value:i}});return SW(a,function(i,o){return jW(i,o,r)})}var CW=PW;function AW(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var OW=AW,TW=OW,fS=Math.max;function EW(e,t,r){return t=fS(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,i=fS(n.length-t,0),o=Array(i);++a<i;)o[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(o),TW(e,this,s)}}var IW=EW;function RW(e){return function(){return e}}var DW=RW,$W=Zl,LW=function(){try{var e=$W(Object,"defineProperty");return e({},"",{}),e}catch{}}(),TP=LW,FW=DW,hS=TP,BW=Vu,GW=hS?function(e,t){return hS(e,"toString",{configurable:!0,enumerable:!1,value:FW(t),writable:!0})}:BW,UW=GW,zW=800,WW=16,VW=Date.now;function HW(e){var t=0,r=0;return function(){var n=VW(),a=WW-(n-r);if(r=n,a>0){if(++t>=zW)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var XW=HW,KW=UW,YW=XW,qW=YW(KW),ZW=qW,JW=Vu,QW=IW,eV=ZW;function tV(e,t){return eV(QW(e,t,JW),e+"")}var rV=tV,nV=l2,aV=a0,iV=M2,oV=Ws;function sV(e,t,r){if(!oV(r))return!1;var n=typeof t;return(n=="number"?aV(r)&&iV(t,r.length):n=="string"&&t in r)?nV(r[t],e):!1}var og=sV,lV=CP,cV=CW,uV=rV,pS=og,dV=uV(function(e,t){if(e==null)return[];var r=t.length;return r>1&&pS(e,t[0],t[1])?t=[]:r>2&&pS(t[0],t[1],t[2])&&(t=[t[0]]),cV(e,lV(t,1),[])}),fV=dV;const P2=Vr(fV);function bf(e){"@babel/helpers - typeof";return bf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bf(e)}function $1(){return $1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$1.apply(this,arguments)}function hV(e,t){return xV(e)||gV(e,t)||mV(e,t)||pV()}function pV(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mV(e,t){if(e){if(typeof e=="string")return mS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return mS(e,t)}}function mS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function gV(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function xV(e){if(Array.isArray(e))return e}function gS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Fx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?gS(Object(r),!0).forEach(function(n){yV(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):gS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function yV(e,t,r){return t=bV(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bV(e){var t=vV(e,"string");return bf(t)=="symbol"?t:t+""}function vV(e,t){if(bf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function wV(e){return Array.isArray(e)&&Bn(e[0])&&Bn(e[1])?e.join(" ~ "):e}var kV=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,i=a===void 0?{}:a,o=t.itemStyle,s=o===void 0?{}:o,l=t.labelStyle,u=l===void 0?{}:l,d=t.payload,f=t.formatter,h=t.itemSorter,p=t.wrapperClassName,x=t.labelClassName,g=t.label,b=t.labelFormatter,y=t.accessibilityLayer,m=y===void 0?!1:y,k=function(){if(d&&d.length){var R={padding:0,margin:0},T=(h?P2(d,h):d).map(function(G,L){if(G.type==="none")return null;var C=Fx({display:"block",paddingTop:4,paddingBottom:4,color:G.color||"#000"},s),$=G.formatter||f||wV,A=G.value,O=G.name,F=A,D=O;if($&&F!=null&&D!=null){var W=$(A,O,G,L,d);if(Array.isArray(W)){var H=hV(W,2);F=H[0],D=H[1]}else F=W}return ee.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(L),style:C},Bn(D)?ee.createElement("span",{className:"recharts-tooltip-item-name"},D):null,Bn(D)?ee.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,ee.createElement("span",{className:"recharts-tooltip-item-value"},F),ee.createElement("span",{className:"recharts-tooltip-item-unit"},G.unit||""))});return ee.createElement("ul",{className:"recharts-tooltip-item-list",style:R},T)}return null},S=Fx({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},i),w=Fx({margin:0},u),v=!Yt(g),M=v?g:"",N=kr("recharts-default-tooltip",p),_=kr("recharts-tooltip-label",x);v&&b&&d!==void 0&&d!==null&&(M=b(g,d));var P=m?{role:"status","aria-live":"assertive"}:{};return ee.createElement("div",$1({className:N,style:S},P),ee.createElement("p",{className:_,style:w},ee.isValidElement(M)?M:"".concat(M)),k())};function vf(e){"@babel/helpers - typeof";return vf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vf(e)}function Z0(e,t,r){return t=SV(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SV(e){var t=MV(e,"string");return vf(t)=="symbol"?t:t+""}function MV(e,t){if(vf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xd="recharts-tooltip-wrapper",jV={visibility:"hidden"};function NV(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return kr(xd,Z0(Z0(Z0(Z0({},"".concat(xd,"-right"),Ge(r)&&t&&Ge(t.x)&&r>=t.x),"".concat(xd,"-left"),Ge(r)&&t&&Ge(t.x)&&r<t.x),"".concat(xd,"-bottom"),Ge(n)&&t&&Ge(t.y)&&n>=t.y),"".concat(xd,"-top"),Ge(n)&&t&&Ge(t.y)&&n<t.y))}function xS(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,i=e.position,o=e.reverseDirection,s=e.tooltipDimension,l=e.viewBox,u=e.viewBoxDimension;if(i&&Ge(i[n]))return i[n];var d=r[n]-s-a,f=r[n]+a;if(t[n])return o[n]?d:f;if(o[n]){var h=d,p=l[n];return h<p?Math.max(f,l[n]):Math.max(d,l[n])}var x=f+s,g=l[n]+u;return x>g?Math.max(d,l[n]):Math.max(f,l[n])}function _V(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function PV(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,i=e.reverseDirection,o=e.tooltipBox,s=e.useTranslate3d,l=e.viewBox,u,d,f;return o.height>0&&o.width>0&&r?(d=xS({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:i,tooltipDimension:o.width,viewBox:l,viewBoxDimension:l.width}),f=xS({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:i,tooltipDimension:o.height,viewBox:l,viewBoxDimension:l.height}),u=_V({translateX:d,translateY:f,useTranslate3d:s})):u=jV,{cssProperties:u,cssClasses:NV({translateX:d,translateY:f,coordinate:r})}}function iu(e){"@babel/helpers - typeof";return iu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},iu(e)}function yS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function bS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yS(Object(r),!0).forEach(function(n){F1(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function CV(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function AV(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,IP(n.key),n)}}function OV(e,t,r){return t&&AV(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function TV(e,t,r){return t=wp(t),EV(e,EP()?Reflect.construct(t,r||[],wp(e).constructor):t.apply(e,r))}function EV(e,t){if(t&&(iu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return IV(e)}function IV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function EP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(EP=function(){return!!e})()}function wp(e){return wp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},wp(e)}function RV(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L1(e,t)}function L1(e,t){return L1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},L1(e,t)}function F1(e,t,r){return t=IP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function IP(e){var t=DV(e,"string");return iu(t)=="symbol"?t:t+""}function DV(e,t){if(iu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(iu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var vS=1,$V=function(e){function t(){var r;CV(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=TV(this,t,[].concat(a)),F1(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),F1(r,"handleKeyDown",function(o){if(o.key==="Escape"){var s,l,u,d;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(l=r.props.coordinate)===null||l===void 0?void 0:l.x)!==null&&s!==void 0?s:0,y:(u=(d=r.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}}),r}return RV(t,e),OV(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>vS||Math.abs(n.height-this.state.lastBoundingBox.height)>vS)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,i=a.active,o=a.allowEscapeViewBox,s=a.animationDuration,l=a.animationEasing,u=a.children,d=a.coordinate,f=a.hasPayload,h=a.isAnimationActive,p=a.offset,x=a.position,g=a.reverseDirection,b=a.useTranslate3d,y=a.viewBox,m=a.wrapperStyle,k=PV({allowEscapeViewBox:o,coordinate:d,offsetTopLeft:p,position:x,reverseDirection:g,tooltipBox:this.state.lastBoundingBox,useTranslate3d:b,viewBox:y}),S=k.cssClasses,w=k.cssProperties,v=bS(bS({transition:h&&i?"transform ".concat(s,"ms ").concat(l):void 0},w),{},{pointerEvents:"none",visibility:!this.state.dismissed&&i&&f?"visible":"hidden",position:"absolute",top:0,left:0},m);return ee.createElement("div",{tabIndex:-1,className:S,style:v,ref:function(N){n.wrapperNode=N}},u)}}])}(j.PureComponent),LV=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Hs={isSsr:LV()};function ou(e){"@babel/helpers - typeof";return ou=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ou(e)}function wS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wS(Object(r),!0).forEach(function(n){C2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function FV(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BV(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,DP(n.key),n)}}function GV(e,t,r){return t&&BV(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function UV(e,t,r){return t=kp(t),zV(e,RP()?Reflect.construct(t,r||[],kp(e).constructor):t.apply(e,r))}function zV(e,t){if(t&&(ou(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return WV(e)}function WV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function RP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(RP=function(){return!!e})()}function kp(e){return kp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},kp(e)}function VV(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&B1(e,t)}function B1(e,t){return B1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},B1(e,t)}function C2(e,t,r){return t=DP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DP(e){var t=HV(e,"string");return ou(t)=="symbol"?t:t+""}function HV(e,t){if(ou(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ou(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function XV(e){return e.dataKey}function KV(e,t){return ee.isValidElement(e)?ee.cloneElement(e,t):typeof e=="function"?ee.createElement(e,t):ee.createElement(kV,t)}var $n=function(e){function t(){return FV(this,t),UV(this,t,arguments)}return VV(t,e),GV(t,[{key:"render",value:function(){var n=this,a=this.props,i=a.active,o=a.allowEscapeViewBox,s=a.animationDuration,l=a.animationEasing,u=a.content,d=a.coordinate,f=a.filterNull,h=a.isAnimationActive,p=a.offset,x=a.payload,g=a.payloadUniqBy,b=a.position,y=a.reverseDirection,m=a.useTranslate3d,k=a.viewBox,S=a.wrapperStyle,w=x??[];f&&w.length&&(w=jP(x.filter(function(M){return M.value!=null&&(M.hide!==!0||n.props.includeHidden)}),g,XV));var v=w.length>0;return ee.createElement($V,{allowEscapeViewBox:o,animationDuration:s,animationEasing:l,isAnimationActive:h,active:i,coordinate:d,hasPayload:v,offset:p,position:b,reverseDirection:y,useTranslate3d:m,viewBox:k,wrapperStyle:S},KV(u,kS(kS({},this.props),{},{payload:w})))}}])}(j.PureComponent);C2($n,"displayName","Tooltip");C2($n,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Hs.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var YV=uo,qV=function(){return YV.Date.now()},ZV=qV,JV=/\s/;function QV(e){for(var t=e.length;t--&&JV.test(e.charAt(t)););return t}var eH=QV,tH=eH,rH=/^\s+/;function nH(e){return e&&e.slice(0,tH(e)+1).replace(rH,"")}var aH=nH,iH=aH,SS=Ws,oH=$u,MS=NaN,sH=/^[-+]0x[0-9a-f]+$/i,lH=/^0b[01]+$/i,cH=/^0o[0-7]+$/i,uH=parseInt;function dH(e){if(typeof e=="number")return e;if(oH(e))return MS;if(SS(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=SS(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=iH(e);var r=lH.test(e);return r||cH.test(e)?uH(e.slice(2),r?2:8):sH.test(e)?MS:+e}var $P=dH,fH=Ws,Bx=ZV,jS=$P,hH="Expected a function",pH=Math.max,mH=Math.min;function gH(e,t,r){var n,a,i,o,s,l,u=0,d=!1,f=!1,h=!0;if(typeof e!="function")throw new TypeError(hH);t=jS(t)||0,fH(r)&&(d=!!r.leading,f="maxWait"in r,i=f?pH(jS(r.maxWait)||0,t):i,h="trailing"in r?!!r.trailing:h);function p(v){var M=n,N=a;return n=a=void 0,u=v,o=e.apply(N,M),o}function x(v){return u=v,s=setTimeout(y,t),d?p(v):o}function g(v){var M=v-l,N=v-u,_=t-M;return f?mH(_,i-N):_}function b(v){var M=v-l,N=v-u;return l===void 0||M>=t||M<0||f&&N>=i}function y(){var v=Bx();if(b(v))return m(v);s=setTimeout(y,g(v))}function m(v){return s=void 0,h&&n?p(v):(n=a=void 0,o)}function k(){s!==void 0&&clearTimeout(s),u=0,n=l=a=s=void 0}function S(){return s===void 0?o:m(Bx())}function w(){var v=Bx(),M=b(v);if(n=arguments,a=this,l=v,M){if(s===void 0)return x(l);if(f)return clearTimeout(s),s=setTimeout(y,t),p(l)}return s===void 0&&(s=setTimeout(y,t)),o}return w.cancel=k,w.flush=S,w}var xH=gH,yH=xH,bH=Ws,vH="Expected a function";function wH(e,t,r){var n=!0,a=!0;if(typeof e!="function")throw new TypeError(vH);return bH(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),yH(e,t,{leading:n,maxWait:t,trailing:a})}var kH=wH;const LP=Vr(kH);function wf(e){"@babel/helpers - typeof";return wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wf(e)}function NS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function J0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?NS(Object(r),!0).forEach(function(n){SH(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):NS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function SH(e,t,r){return t=MH(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function MH(e){var t=jH(e,"string");return wf(t)=="symbol"?t:t+""}function jH(e,t){if(wf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function NH(e,t){return AH(e)||CH(e,t)||PH(e,t)||_H()}function _H(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PH(e,t){if(e){if(typeof e=="string")return _S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _S(e,t)}}function _S(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function CH(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function AH(e){if(Array.isArray(e))return e}var qi=j.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,i=e.width,o=i===void 0?"100%":i,s=e.height,l=s===void 0?"100%":s,u=e.minWidth,d=u===void 0?0:u,f=e.minHeight,h=e.maxHeight,p=e.children,x=e.debounce,g=x===void 0?0:x,b=e.id,y=e.className,m=e.onResize,k=e.style,S=k===void 0?{}:k,w=j.useRef(null),v=j.useRef();v.current=m,j.useImperativeHandle(t,function(){return Object.defineProperty(w.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),w.current},configurable:!0})});var M=j.useState({containerWidth:a.width,containerHeight:a.height}),N=NH(M,2),_=N[0],P=N[1],E=j.useCallback(function(T,G){P(function(L){var C=Math.round(T),$=Math.round(G);return L.containerWidth===C&&L.containerHeight===$?L:{containerWidth:C,containerHeight:$}})},[]);j.useEffect(function(){var T=function(O){var F,D=O[0].contentRect,W=D.width,H=D.height;E(W,H),(F=v.current)===null||F===void 0||F.call(v,W,H)};g>0&&(T=LP(T,g,{trailing:!0,leading:!1}));var G=new ResizeObserver(T),L=w.current.getBoundingClientRect(),C=L.width,$=L.height;return E(C,$),G.observe(w.current),function(){G.disconnect()}},[E,g]);var R=j.useMemo(function(){var T=_.containerWidth,G=_.containerHeight;if(T<0||G<0)return null;To(gl(o)||gl(l),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,o,l),To(!r||r>0,"The aspect(%s) must be greater than zero.",r);var L=gl(o)?T:o,C=gl(l)?G:l;r&&r>0&&(L?C=L/r:C&&(L=C*r),h&&C>h&&(C=h)),To(L>0||C>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,L,C,o,l,d,f,r);var $=!Array.isArray(p)&&Oo(p.type).endsWith("Chart");return ee.Children.map(p,function(A){return ee.isValidElement(A)?j.cloneElement(A,J0({width:L,height:C},$?{style:J0({height:"100%",width:"100%",maxHeight:C,maxWidth:L},A.props.style)}:{})):A})},[r,p,l,h,f,d,_,o]);return ee.createElement("div",{id:b?"".concat(b):void 0,className:kr("recharts-responsive-container",y),style:J0(J0({},S),{},{width:o,height:l,minWidth:d,minHeight:f,maxHeight:h}),ref:w},R)}),A2=function(t){return null};A2.displayName="Cell";function kf(e){"@babel/helpers - typeof";return kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},kf(e)}function PS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function G1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?PS(Object(r),!0).forEach(function(n){OH(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):PS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OH(e,t,r){return t=TH(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function TH(e){var t=EH(e,"string");return kf(t)=="symbol"?t:t+""}function EH(e,t){if(kf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(kf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var hc={widthCache:{},cacheCount:0},IH=2e3,RH={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},CS="recharts_measurement_span";function DH(e){var t=G1({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var zd=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Hs.isSsr)return{width:0,height:0};var n=DH(r),a=JSON.stringify({text:t,copyStyle:n});if(hc.widthCache[a])return hc.widthCache[a];try{var i=document.getElementById(CS);i||(i=document.createElement("span"),i.setAttribute("id",CS),i.setAttribute("aria-hidden","true"),document.body.appendChild(i));var o=G1(G1({},RH),n);Object.assign(i.style,o),i.textContent="".concat(t);var s=i.getBoundingClientRect(),l={width:s.width,height:s.height};return hc.widthCache[a]=l,++hc.cacheCount>IH&&(hc.cacheCount=0,hc.widthCache={}),l}catch{return{width:0,height:0}}},$H=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function Sf(e){"@babel/helpers - typeof";return Sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sf(e)}function Sp(e,t){return GH(e)||BH(e,t)||FH(e,t)||LH()}function LH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FH(e,t){if(e){if(typeof e=="string")return AS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return AS(e,t)}}function AS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function BH(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function GH(e){if(Array.isArray(e))return e}function UH(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OS(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WH(n.key),n)}}function zH(e,t,r){return t&&OS(e.prototype,t),r&&OS(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function WH(e){var t=VH(e,"string");return Sf(t)=="symbol"?t:t+""}function VH(e,t){if(Sf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var TS=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,ES=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,HH=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,XH=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,FP={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},KH=Object.keys(FP),Ac="NaN";function YH(e,t){return e*FP[t]}var Q0=function(){function e(t,r){UH(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!HH.test(r)&&(this.num=NaN,this.unit=""),KH.includes(r)&&(this.num=YH(t,r),this.unit="px")}return zH(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=XH.exec(r))!==null&&n!==void 0?n:[],i=Sp(a,3),o=i[1],s=i[2];return new e(parseFloat(o),s??"")}}])}();function BP(e){if(e.includes(Ac))return Ac;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=TS.exec(t))!==null&&r!==void 0?r:[],a=Sp(n,4),i=a[1],o=a[2],s=a[3],l=Q0.parse(i??""),u=Q0.parse(s??""),d=o==="*"?l.multiply(u):l.divide(u);if(d.isNaN())return Ac;t=t.replace(TS,d.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=ES.exec(t))!==null&&f!==void 0?f:[],p=Sp(h,4),x=p[1],g=p[2],b=p[3],y=Q0.parse(x??""),m=Q0.parse(b??""),k=g==="+"?y.add(m):y.subtract(m);if(k.isNaN())return Ac;t=t.replace(ES,k.toString())}return t}var IS=/\(([^()]*)\)/;function qH(e){for(var t=e;t.includes("(");){var r=IS.exec(t),n=Sp(r,2),a=n[1];t=t.replace(IS,BP(a))}return t}function ZH(e){var t=e.replace(/\s+/g,"");return t=qH(t),t=BP(t),t}function JH(e){try{return ZH(e)}catch{return Ac}}function Gx(e){var t=JH(e.slice(5,-1));return t===Ac?"":t}var QH=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],eX=["dx","dy","angle","className","breakAll"];function U1(){return U1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},U1.apply(this,arguments)}function RS(e,t){if(e==null)return{};var r=tX(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function tX(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function DS(e,t){return iX(e)||aX(e,t)||nX(e,t)||rX()}function rX(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nX(e,t){if(e){if(typeof e=="string")return $S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return $S(e,t)}}function $S(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function aX(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function iX(e){if(Array.isArray(e))return e}var GP=/[ \f\n\r\t\v\u2028\u2029]+/,UP=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var i=[];Yt(r)||(n?i=r.toString().split(""):i=r.toString().split(GP));var o=i.map(function(l){return{word:l,width:zd(l,a).width}}),s=n?0:zd("",a).width;return{wordsWithComputedWidth:o,spaceWidth:s}}catch{return null}},oX=function(t,r,n,a,i){var o=t.maxLines,s=t.children,l=t.style,u=t.breakAll,d=Ge(o),f=s,h=function(){var L=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return L.reduce(function(C,$){var A=$.word,O=$.width,F=C[C.length-1];if(F&&(a==null||i||F.width+O+n<Number(a)))F.words.push(A),F.width+=O+n;else{var D={words:[A],width:O};C.push(D)}return C},[])},p=h(r),x=function(L){return L.reduce(function(C,$){return C.width>$.width?C:$})};if(!d)return p;for(var g="",b=function(L){var C=f.slice(0,L),$=UP({breakAll:u,style:l,children:C+g}).wordsWithComputedWidth,A=h($),O=A.length>o||x(A).width>Number(a);return[O,A]},y=0,m=f.length-1,k=0,S;y<=m&&k<=f.length-1;){var w=Math.floor((y+m)/2),v=w-1,M=b(v),N=DS(M,2),_=N[0],P=N[1],E=b(w),R=DS(E,1),T=R[0];if(!_&&!T&&(y=w+1),_&&T&&(m=w-1),!_&&T){S=P;break}k++}return S||p},LS=function(t){var r=Yt(t)?[]:t.toString().split(GP);return[{words:r}]},sX=function(t){var r=t.width,n=t.scaleToFit,a=t.children,i=t.style,o=t.breakAll,s=t.maxLines;if((r||n)&&!Hs.isSsr){var l,u,d=UP({breakAll:o,children:a,style:i});if(d){var f=d.wordsWithComputedWidth,h=d.spaceWidth;l=f,u=h}else return LS(a);return oX({breakAll:o,children:a,maxLines:s,style:i},l,u,r,n)}return LS(a)},FS="#808080",Mp=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,i=a===void 0?0:a,o=t.lineHeight,s=o===void 0?"1em":o,l=t.capHeight,u=l===void 0?"0.71em":l,d=t.scaleToFit,f=d===void 0?!1:d,h=t.textAnchor,p=h===void 0?"start":h,x=t.verticalAnchor,g=x===void 0?"end":x,b=t.fill,y=b===void 0?FS:b,m=RS(t,QH),k=j.useMemo(function(){return sX({breakAll:m.breakAll,children:m.children,maxLines:m.maxLines,scaleToFit:f,style:m.style,width:m.width})},[m.breakAll,m.children,m.maxLines,f,m.style,m.width]),S=m.dx,w=m.dy,v=m.angle,M=m.className,N=m.breakAll,_=RS(m,eX);if(!Bn(n)||!Bn(i))return null;var P=n+(Ge(S)?S:0),E=i+(Ge(w)?w:0),R;switch(g){case"start":R=Gx("calc(".concat(u,")"));break;case"middle":R=Gx("calc(".concat((k.length-1)/2," * -").concat(s," + (").concat(u," / 2))"));break;default:R=Gx("calc(".concat(k.length-1," * -").concat(s,")"));break}var T=[];if(f){var G=k[0].width,L=m.width;T.push("scale(".concat((Ge(L)?L/G:1)/G,")"))}return v&&T.push("rotate(".concat(v,", ").concat(P,", ").concat(E,")")),T.length&&(_.transform=T.join(" ")),ee.createElement("text",U1({},Qt(_,!0),{x:P,y:E,className:kr("recharts-text",M),textAnchor:p,fill:y.includes("url")?FS:y}),k.map(function(C,$){var A=C.words.join(N?"":" ");return ee.createElement("tspan",{x:P,dy:$===0?R:s,key:"".concat(A,"-").concat($)},A)}))};function Ds(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function lX(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function O2(e){let t,r,n;e.length!==2?(t=Ds,r=(s,l)=>Ds(e(s),l),n=(s,l)=>e(s)-l):(t=e===Ds||e===lX?e:cX,r=e,n=e);function a(s,l,u=0,d=s.length){if(u<d){if(t(l,l)!==0)return d;do{const f=u+d>>>1;r(s[f],l)<0?u=f+1:d=f}while(u<d)}return u}function i(s,l,u=0,d=s.length){if(u<d){if(t(l,l)!==0)return d;do{const f=u+d>>>1;r(s[f],l)<=0?u=f+1:d=f}while(u<d)}return u}function o(s,l,u=0,d=s.length){const f=a(s,l,u,d-1);return f>u&&n(s[f-1],l)>-n(s[f],l)?f-1:f}return{left:a,center:o,right:i}}function cX(){return 0}function zP(e){return e===null?NaN:+e}function*uX(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const dX=O2(Ds),i0=dX.right;O2(zP).center;class BS extends Map{constructor(t,r=pX){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(GS(this,t))}has(t){return super.has(GS(this,t))}set(t,r){return super.set(fX(this,t),r)}delete(t){return super.delete(hX(this,t))}}function GS({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function fX({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function hX({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function pX(e){return e!==null&&typeof e=="object"?e.valueOf():e}function mX(e=Ds){if(e===Ds)return WP;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function WP(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const gX=Math.sqrt(50),xX=Math.sqrt(10),yX=Math.sqrt(2);function jp(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),i=n/Math.pow(10,a),o=i>=gX?10:i>=xX?5:i>=yX?2:1;let s,l,u;return a<0?(u=Math.pow(10,-a)/o,s=Math.round(e*u),l=Math.round(t*u),s/u<e&&++s,l/u>t&&--l,u=-u):(u=Math.pow(10,a)*o,s=Math.round(e/u),l=Math.round(t/u),s*u<e&&++s,l*u>t&&--l),l<s&&.5<=r&&r<2?jp(e,t,r*2):[s,l,u]}function z1(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,i,o]=n?jp(t,e,r):jp(e,t,r);if(!(i>=a))return[];const s=i-a+1,l=new Array(s);if(n)if(o<0)for(let u=0;u<s;++u)l[u]=(i-u)/-o;else for(let u=0;u<s;++u)l[u]=(i-u)*o;else if(o<0)for(let u=0;u<s;++u)l[u]=(a+u)/-o;else for(let u=0;u<s;++u)l[u]=(a+u)*o;return l}function W1(e,t,r){return t=+t,e=+e,r=+r,jp(e,t,r)[2]}function V1(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?W1(t,e,r):W1(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function US(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function zS(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function VP(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?WP:mX(a);n>r;){if(n-r>600){const l=n-r+1,u=t-r+1,d=Math.log(l),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(l-f)/l)*(u-l/2<0?-1:1),p=Math.max(r,Math.floor(t-u*f/l+h)),x=Math.min(n,Math.floor(t+(l-u)*f/l+h));VP(e,t,p,x,a)}const i=e[t];let o=r,s=n;for(yd(e,r,t),a(e[n],i)>0&&yd(e,r,n);o<s;){for(yd(e,o,s),++o,--s;a(e[o],i)<0;)++o;for(;a(e[s],i)>0;)--s}a(e[r],i)===0?yd(e,r,s):(++s,yd(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function yd(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function bX(e,t,r){if(e=Float64Array.from(uX(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return zS(e);if(t>=1)return US(e);var n,a=(n-1)*t,i=Math.floor(a),o=US(VP(e,i).subarray(0,i+1)),s=zS(e.subarray(i+1));return o+(s-o)*(a-i)}}function vX(e,t,r=zP){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,i=Math.floor(a),o=+r(e[i],i,e),s=+r(e[i+1],i+1,e);return o+(s-o)*(a-i)}}function wX(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,i=new Array(a);++n<a;)i[n]=e+n*r;return i}function wi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Vo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const H1=Symbol("implicit");function T2(){var e=new BS,t=[],r=[],n=H1;function a(i){let o=e.get(i);if(o===void 0){if(n!==H1)return n;e.set(i,o=t.push(i)-1)}return r[o%r.length]}return a.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new BS;for(const o of i)e.has(o)||e.set(o,t.push(o)-1);return a},a.range=function(i){return arguments.length?(r=Array.from(i),a):r.slice()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return T2(t,r).unknown(n)},wi.apply(a,arguments),a}function Mf(){var e=T2().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,i,o,s=!1,l=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,p=a<n,x=p?a:n,g=p?n:a;i=(g-x)/Math.max(1,h-l+u*2),s&&(i=Math.floor(i)),x+=(g-x-i*(h-l))*d,o=i*(1-l),s&&(x=Math.round(x),o=Math.round(o));var b=wX(h).map(function(y){return x+i*y});return r(p?b.reverse():b)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,a]=h,n=+n,a=+a,f()):[n,a]},e.rangeRound=function(h){return[n,a]=h,n=+n,a=+a,s=!0,f()},e.bandwidth=function(){return o},e.step=function(){return i},e.round=function(h){return arguments.length?(s=!!h,f()):s},e.padding=function(h){return arguments.length?(l=Math.min(1,u=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return Mf(t(),[n,a]).round(s).paddingInner(l).paddingOuter(u).align(d)},wi.apply(f(),arguments)}function HP(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return HP(t())},e}function Wd(){return HP(Mf.apply(null,arguments).paddingInner(1))}function E2(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function XP(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function o0(){}var jf=.7,Np=1/jf,zc="\\s*([+-]?\\d+)\\s*",Nf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",no="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",kX=/^#([0-9a-f]{3,8})$/,SX=new RegExp(`^rgb\\(${zc},${zc},${zc}\\)$`),MX=new RegExp(`^rgb\\(${no},${no},${no}\\)$`),jX=new RegExp(`^rgba\\(${zc},${zc},${zc},${Nf}\\)$`),NX=new RegExp(`^rgba\\(${no},${no},${no},${Nf}\\)$`),_X=new RegExp(`^hsl\\(${Nf},${no},${no}\\)$`),PX=new RegExp(`^hsla\\(${Nf},${no},${no},${Nf}\\)$`),WS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};E2(o0,_f,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:VS,formatHex:VS,formatHex8:CX,formatHsl:AX,formatRgb:HS,toString:HS});function VS(){return this.rgb().formatHex()}function CX(){return this.rgb().formatHex8()}function AX(){return KP(this).formatHsl()}function HS(){return this.rgb().formatRgb()}function _f(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=kX.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?XS(t):r===3?new Ia(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?eh(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?eh(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=SX.exec(e))?new Ia(t[1],t[2],t[3],1):(t=MX.exec(e))?new Ia(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=jX.exec(e))?eh(t[1],t[2],t[3],t[4]):(t=NX.exec(e))?eh(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=_X.exec(e))?qS(t[1],t[2]/100,t[3]/100,1):(t=PX.exec(e))?qS(t[1],t[2]/100,t[3]/100,t[4]):WS.hasOwnProperty(e)?XS(WS[e]):e==="transparent"?new Ia(NaN,NaN,NaN,0):null}function XS(e){return new Ia(e>>16&255,e>>8&255,e&255,1)}function eh(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ia(e,t,r,n)}function OX(e){return e instanceof o0||(e=_f(e)),e?(e=e.rgb(),new Ia(e.r,e.g,e.b,e.opacity)):new Ia}function X1(e,t,r,n){return arguments.length===1?OX(e):new Ia(e,t,r,n??1)}function Ia(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}E2(Ia,X1,XP(o0,{brighter(e){return e=e==null?Np:Math.pow(Np,e),new Ia(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?jf:Math.pow(jf,e),new Ia(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ia(jl(this.r),jl(this.g),jl(this.b),_p(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KS,formatHex:KS,formatHex8:TX,formatRgb:YS,toString:YS}));function KS(){return`#${xl(this.r)}${xl(this.g)}${xl(this.b)}`}function TX(){return`#${xl(this.r)}${xl(this.g)}${xl(this.b)}${xl((isNaN(this.opacity)?1:this.opacity)*255)}`}function YS(){const e=_p(this.opacity);return`${e===1?"rgb(":"rgba("}${jl(this.r)}, ${jl(this.g)}, ${jl(this.b)}${e===1?")":`, ${e})`}`}function _p(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function jl(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function xl(e){return e=jl(e),(e<16?"0":"")+e.toString(16)}function qS(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Ei(e,t,r,n)}function KP(e){if(e instanceof Ei)return new Ei(e.h,e.s,e.l,e.opacity);if(e instanceof o0||(e=_f(e)),!e)return new Ei;if(e instanceof Ei)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),i=Math.max(t,r,n),o=NaN,s=i-a,l=(i+a)/2;return s?(t===i?o=(r-n)/s+(r<n)*6:r===i?o=(n-t)/s+2:o=(t-r)/s+4,s/=l<.5?i+a:2-i-a,o*=60):s=l>0&&l<1?0:o,new Ei(o,s,l,e.opacity)}function EX(e,t,r,n){return arguments.length===1?KP(e):new Ei(e,t,r,n??1)}function Ei(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}E2(Ei,EX,XP(o0,{brighter(e){return e=e==null?Np:Math.pow(Np,e),new Ei(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?jf:Math.pow(jf,e),new Ei(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Ia(Ux(e>=240?e-240:e+120,a,n),Ux(e,a,n),Ux(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new Ei(ZS(this.h),th(this.s),th(this.l),_p(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=_p(this.opacity);return`${e===1?"hsl(":"hsla("}${ZS(this.h)}, ${th(this.s)*100}%, ${th(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ZS(e){return e=(e||0)%360,e<0?e+360:e}function th(e){return Math.max(0,Math.min(1,e||0))}function Ux(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const I2=e=>()=>e;function IX(e,t){return function(r){return e+r*t}}function RX(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function DX(e){return(e=+e)==1?YP:function(t,r){return r-t?RX(t,r,e):I2(isNaN(t)?r:t)}}function YP(e,t){var r=t-e;return r?IX(e,r):I2(isNaN(e)?t:e)}const JS=function e(t){var r=DX(t);function n(a,i){var o=r((a=X1(a)).r,(i=X1(i)).r),s=r(a.g,i.g),l=r(a.b,i.b),u=YP(a.opacity,i.opacity);return function(d){return a.r=o(d),a.g=s(d),a.b=l(d),a.opacity=u(d),a+""}}return n.gamma=e,n}(1);function $X(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(i){for(a=0;a<r;++a)n[a]=e[a]*(1-i)+t[a]*i;return n}}function LX(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function FX(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),i=new Array(r),o;for(o=0;o<n;++o)a[o]=Hu(e[o],t[o]);for(;o<r;++o)i[o]=t[o];return function(s){for(o=0;o<n;++o)i[o]=a[o](s);return i}}function BX(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function Pp(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function GX(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=Hu(e[a],t[a]):n[a]=t[a];return function(i){for(a in r)n[a]=r[a](i);return n}}var K1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zx=new RegExp(K1.source,"g");function UX(e){return function(){return e}}function zX(e){return function(t){return e(t)+""}}function WX(e,t){var r=K1.lastIndex=zx.lastIndex=0,n,a,i,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=K1.exec(e))&&(a=zx.exec(t));)(i=a.index)>r&&(i=t.slice(r,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(a=a[0])?s[o]?s[o]+=a:s[++o]=a:(s[++o]=null,l.push({i:o,x:Pp(n,a)})),r=zx.lastIndex;return r<t.length&&(i=t.slice(r),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?zX(l[0].x):UX(t):(t=l.length,function(u){for(var d=0,f;d<t;++d)s[(f=l[d]).i]=f.x(u);return s.join("")})}function Hu(e,t){var r=typeof t,n;return t==null||r==="boolean"?I2(t):(r==="number"?Pp:r==="string"?(n=_f(t))?(t=n,JS):WX:t instanceof _f?JS:t instanceof Date?BX:LX(t)?$X:Array.isArray(t)?FX:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?GX:Pp)(e,t)}function R2(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function VX(e,t){t===void 0&&(t=e,e=Hu);for(var r=0,n=t.length-1,a=t[0],i=new Array(n<0?0:n);r<n;)i[r]=e(a,a=t[++r]);return function(o){var s=Math.max(0,Math.min(n-1,Math.floor(o*=n)));return i[s](o-s)}}function HX(e){return function(){return e}}function Cp(e){return+e}var QS=[0,1];function va(e){return e}function Y1(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:HX(isNaN(t)?NaN:.5)}function XX(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function KX(e,t,r){var n=e[0],a=e[1],i=t[0],o=t[1];return a<n?(n=Y1(a,n),i=r(o,i)):(n=Y1(n,a),i=r(i,o)),function(s){return i(n(s))}}function YX(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),i=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)a[o]=Y1(e[o],e[o+1]),i[o]=r(t[o],t[o+1]);return function(s){var l=i0(e,s,1,n)-1;return i[l](a[l](s))}}function s0(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function sg(){var e=QS,t=QS,r=Hu,n,a,i,o=va,s,l,u;function d(){var h=Math.min(e.length,t.length);return o!==va&&(o=XX(e[0],e[h-1])),s=h>2?YX:KX,l=u=null,f}function f(h){return h==null||isNaN(h=+h)?i:(l||(l=s(e.map(n),t,r)))(n(o(h)))}return f.invert=function(h){return o(a((u||(u=s(t,e.map(n),Pp)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,Cp),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=R2,d()},f.clamp=function(h){return arguments.length?(o=h?!0:va,d()):o!==va},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(i=h,f):i},function(h,p){return n=h,a=p,d()}}function D2(){return sg()(va,va)}function qX(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Ap(e,t){if(!isFinite(e)||e===0)return null;var r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function su(e){return e=Ap(Math.abs(e)),e?e[1]:NaN}function ZX(e,t){return function(r,n){for(var a=r.length,i=[],o=0,s=e[0],l=0;a>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),i.push(r.substring(a-=s,a+s)),!((l+=s+1)>n));)s=e[o=(o+1)%e.length];return i.reverse().join(t)}}function JX(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var QX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Pf(e){if(!(t=QX.exec(e)))throw new Error("invalid format: "+e);var t;return new $2({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}Pf.prototype=$2.prototype;function $2(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}$2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function eK(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var Op;function tK(e,t){var r=Ap(e,t);if(!r)return Op=void 0,e.toPrecision(t);var n=r[0],a=r[1],i=a-(Op=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,o=n.length;return i===o?n:i>o?n+new Array(i-o+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+Ap(e,Math.max(0,t+i-1))[0]}function e5(e,t){var r=Ap(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const t5={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:qX,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>e5(e*100,t),r:e5,s:tK,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function r5(e){return e}var n5=Array.prototype.map,a5=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function rK(e){var t=e.grouping===void 0||e.thousands===void 0?r5:ZX(n5.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?r5:JX(n5.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f,h){f=Pf(f);var p=f.fill,x=f.align,g=f.sign,b=f.symbol,y=f.zero,m=f.width,k=f.comma,S=f.precision,w=f.trim,v=f.type;v==="n"?(k=!0,v="g"):t5[v]||(S===void 0&&(S=12),w=!0,v="g"),(y||p==="0"&&x==="=")&&(y=!0,p="0",x="=");var M=(h&&h.prefix!==void 0?h.prefix:"")+(b==="$"?r:b==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():""),N=(b==="$"?n:/[%p]/.test(v)?o:"")+(h&&h.suffix!==void 0?h.suffix:""),_=t5[v],P=/[defgprs%]/.test(v);S=S===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,S)):Math.max(0,Math.min(20,S));function E(R){var T=M,G=N,L,C,$;if(v==="c")G=_(R)+G,R="";else{R=+R;var A=R<0||1/R<0;if(R=isNaN(R)?l:_(Math.abs(R),S),w&&(R=eK(R)),A&&+R==0&&g!=="+"&&(A=!1),T=(A?g==="("?g:s:g==="-"||g==="("?"":g)+T,G=(v==="s"&&!isNaN(R)&&Op!==void 0?a5[8+Op/3]:"")+G+(A&&g==="("?")":""),P){for(L=-1,C=R.length;++L<C;)if($=R.charCodeAt(L),48>$||$>57){G=($===46?a+R.slice(L+1):R.slice(L))+G,R=R.slice(0,L);break}}}k&&!y&&(R=t(R,1/0));var O=T.length+R.length+G.length,F=O<m?new Array(m-O+1).join(p):"";switch(k&&y&&(R=t(F+R,F.length?m-G.length:1/0),F=""),x){case"<":R=T+R+G+F;break;case"=":R=T+F+R+G;break;case"^":R=F.slice(0,O=F.length>>1)+T+R+G+F.slice(O);break;default:R=F+T+R+G;break}return i(R)}return E.toString=function(){return f+""},E}function d(f,h){var p=Math.max(-8,Math.min(8,Math.floor(su(h)/3)))*3,x=Math.pow(10,-p),g=u((f=Pf(f),f.type="f",f),{suffix:a5[8+p/3]});return function(b){return g(x*b)}}return{format:u,formatPrefix:d}}var rh,L2,qP;nK({thousands:",",grouping:[3],currency:["$",""]});function nK(e){return rh=rK(e),L2=rh.format,qP=rh.formatPrefix,rh}function aK(e){return Math.max(0,-su(Math.abs(e)))}function iK(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(su(t)/3)))*3-su(Math.abs(e)))}function oK(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,su(t)-su(e))+1}function ZP(e,t,r,n){var a=V1(e,t,r),i;switch(n=Pf(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(i=iK(a,o))&&(n.precision=i),qP(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=oK(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=aK(a))&&(n.precision=i-(n.type==="%")*2);break}}return L2(n)}function Xs(e){var t=e.domain;return e.ticks=function(r){var n=t();return z1(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return ZP(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,i=n.length-1,o=n[a],s=n[i],l,u,d=10;for(s<o&&(u=o,o=s,s=u,u=a,a=i,i=u);d-- >0;){if(u=W1(o,s,r),u===l)return n[a]=o,n[i]=s,t(n);if(u>0)o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u;else if(u<0)o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u;else break;l=u}return e},e}function Tp(){var e=D2();return e.copy=function(){return s0(e,Tp())},wi.apply(e,arguments),Xs(e)}function JP(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,Cp),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return JP(e).unknown(t)},e=arguments.length?Array.from(e,Cp):[0,1],Xs(r)}function QP(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],i=e[n],o;return i<a&&(o=r,r=n,n=o,o=a,a=i,i=o),e[r]=t.floor(a),e[n]=t.ceil(i),e}function i5(e){return Math.log(e)}function o5(e){return Math.exp(e)}function sK(e){return-Math.log(-e)}function lK(e){return-Math.exp(-e)}function cK(e){return isFinite(e)?+("1e"+e):e<0?0:e}function uK(e){return e===10?cK:e===Math.E?Math.exp:t=>Math.pow(e,t)}function dK(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function s5(e){return(t,r)=>-e(-t,r)}function F2(e){const t=e(i5,o5),r=t.domain;let n=10,a,i;function o(){return a=dK(n),i=uK(n),r()[0]<0?(a=s5(a),i=s5(i),e(sK,lK)):e(i5,o5),t}return t.base=function(s){return arguments.length?(n=+s,o()):n},t.domain=function(s){return arguments.length?(r(s),o()):r()},t.ticks=s=>{const l=r();let u=l[0],d=l[l.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=a(u),p=a(d),x,g;const b=s==null?10:+s;let y=[];if(!(n%1)&&p-h<b){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(x=1;x<n;++x)if(g=h<0?x/i(-h):x*i(h),!(g<u)){if(g>d)break;y.push(g)}}else for(;h<=p;++h)for(x=n-1;x>=1;--x)if(g=h>0?x/i(-h):x*i(h),!(g<u)){if(g>d)break;y.push(g)}y.length*2<b&&(y=z1(u,d,b))}else y=z1(h,p,Math.min(p-h,b)).map(i);return f?y.reverse():y},t.tickFormat=(s,l)=>{if(s==null&&(s=10),l==null&&(l=n===10?"s":","),typeof l!="function"&&(!(n%1)&&(l=Pf(l)).precision==null&&(l.trim=!0),l=L2(l)),s===1/0)return l;const u=Math.max(1,n*s/t.ticks().length);return d=>{let f=d/i(Math.round(a(d)));return f*n<n-.5&&(f*=n),f<=u?l(d):""}},t.nice=()=>r(QP(r(),{floor:s=>i(Math.floor(a(s))),ceil:s=>i(Math.ceil(a(s)))})),t}function eC(){const e=F2(sg()).domain([1,10]);return e.copy=()=>s0(e,eC()).base(e.base()),wi.apply(e,arguments),e}function l5(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function c5(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function B2(e){var t=1,r=e(l5(t),c5(t));return r.constant=function(n){return arguments.length?e(l5(t=+n),c5(t)):t},Xs(r)}function tC(){var e=B2(sg());return e.copy=function(){return s0(e,tC()).constant(e.constant())},wi.apply(e,arguments)}function u5(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function fK(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function hK(e){return e<0?-e*e:e*e}function G2(e){var t=e(va,va),r=1;function n(){return r===1?e(va,va):r===.5?e(fK,hK):e(u5(r),u5(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},Xs(t)}function U2(){var e=G2(sg());return e.copy=function(){return s0(e,U2()).exponent(e.exponent())},wi.apply(e,arguments),e}function pK(){return U2.apply(null,arguments).exponent(.5)}function d5(e){return Math.sign(e)*e*e}function mK(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function rC(){var e=D2(),t=[0,1],r=!1,n;function a(i){var o=mK(e(i));return isNaN(o)?n:r?Math.round(o):o}return a.invert=function(i){return e.invert(d5(i))},a.domain=function(i){return arguments.length?(e.domain(i),a):e.domain()},a.range=function(i){return arguments.length?(e.range((t=Array.from(i,Cp)).map(d5)),a):t.slice()},a.rangeRound=function(i){return a.range(i).round(!0)},a.round=function(i){return arguments.length?(r=!!i,a):r},a.clamp=function(i){return arguments.length?(e.clamp(i),a):e.clamp()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return rC(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},wi.apply(a,arguments),Xs(a)}function nC(){var e=[],t=[],r=[],n;function a(){var o=0,s=Math.max(1,t.length);for(r=new Array(s-1);++o<s;)r[o-1]=vX(e,o/s);return i}function i(o){return o==null||isNaN(o=+o)?n:t[i0(r,o)]}return i.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},i.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Ds),a()},i.range=function(o){return arguments.length?(t=Array.from(o),a()):t.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.quantiles=function(){return r.slice()},i.copy=function(){return nC().domain(e).range(t).unknown(n)},wi.apply(i,arguments)}function aC(){var e=0,t=1,r=1,n=[.5],a=[0,1],i;function o(l){return l!=null&&l<=l?a[i0(n,l,0,r)]:i}function s(){var l=-1;for(n=new Array(r);++l<r;)n[l]=((l+1)*t-(l-r)*e)/(r+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(r=(a=Array.from(l)).length-1,s()):a.slice()},o.invertExtent=function(l){var u=a.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},o.unknown=function(l){return arguments.length&&(i=l),o},o.thresholds=function(){return n.slice()},o.copy=function(){return aC().domain([e,t]).range(a).unknown(i)},wi.apply(Xs(o),arguments)}function iC(){var e=[.5],t=[0,1],r,n=1;function a(i){return i!=null&&i<=i?t[i0(e,i,0,n)]:r}return a.domain=function(i){return arguments.length?(e=Array.from(i),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(i){return arguments.length?(t=Array.from(i),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(i){var o=t.indexOf(i);return[e[o-1],e[o]]},a.unknown=function(i){return arguments.length?(r=i,a):r},a.copy=function(){return iC().domain(e).range(t).unknown(r)},wi.apply(a,arguments)}const Wx=new Date,Vx=new Date;function Un(e,t,r,n){function a(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return a.floor=i=>(e(i=new Date(+i)),i),a.ceil=i=>(e(i=new Date(i-1)),t(i,1),e(i),i),a.round=i=>{const o=a(i),s=a.ceil(i);return i-o<s-i?o:s},a.offset=(i,o)=>(t(i=new Date(+i),o==null?1:Math.floor(o)),i),a.range=(i,o,s)=>{const l=[];if(i=a.ceil(i),s=s==null?1:Math.floor(s),!(i<o)||!(s>0))return l;let u;do l.push(u=new Date(+i)),t(i,s),e(i);while(u<i&&i<o);return l},a.filter=i=>Un(o=>{if(o>=o)for(;e(o),!i(o);)o.setTime(o-1)},(o,s)=>{if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!i(o););else for(;--s>=0;)for(;t(o,1),!i(o););}),r&&(a.count=(i,o)=>(Wx.setTime(+i),Vx.setTime(+o),e(Wx),e(Vx),Math.floor(r(Wx,Vx))),a.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?a.filter(n?o=>n(o)%i===0:o=>a.count(0,o)%i===0):a)),a}const Ep=Un(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);Ep.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Un(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):Ep);Ep.range;const _o=1e3,hi=_o*60,Po=hi*60,Fo=Po*24,z2=Fo*7,f5=Fo*30,Hx=Fo*365,yl=Un(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*_o)},(e,t)=>(t-e)/_o,e=>e.getUTCSeconds());yl.range;const W2=Un(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_o)},(e,t)=>{e.setTime(+e+t*hi)},(e,t)=>(t-e)/hi,e=>e.getMinutes());W2.range;const V2=Un(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*hi)},(e,t)=>(t-e)/hi,e=>e.getUTCMinutes());V2.range;const H2=Un(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*_o-e.getMinutes()*hi)},(e,t)=>{e.setTime(+e+t*Po)},(e,t)=>(t-e)/Po,e=>e.getHours());H2.range;const X2=Un(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Po)},(e,t)=>(t-e)/Po,e=>e.getUTCHours());X2.range;const l0=Un(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*hi)/Fo,e=>e.getDate()-1);l0.range;const lg=Un(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Fo,e=>e.getUTCDate()-1);lg.range;const oC=Un(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Fo,e=>Math.floor(e/Fo));oC.range;function Ql(e){return Un(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*hi)/z2)}const cg=Ql(0),Ip=Ql(1),gK=Ql(2),xK=Ql(3),lu=Ql(4),yK=Ql(5),bK=Ql(6);cg.range;Ip.range;gK.range;xK.range;lu.range;yK.range;bK.range;function ec(e){return Un(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/z2)}const ug=ec(0),Rp=ec(1),vK=ec(2),wK=ec(3),cu=ec(4),kK=ec(5),SK=ec(6);ug.range;Rp.range;vK.range;wK.range;cu.range;kK.range;SK.range;const K2=Un(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());K2.range;const Y2=Un(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());Y2.range;const Bo=Un(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());Bo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Un(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});Bo.range;const Go=Un(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Go.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Un(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Go.range;function sC(e,t,r,n,a,i){const o=[[yl,1,_o],[yl,5,5*_o],[yl,15,15*_o],[yl,30,30*_o],[i,1,hi],[i,5,5*hi],[i,15,15*hi],[i,30,30*hi],[a,1,Po],[a,3,3*Po],[a,6,6*Po],[a,12,12*Po],[n,1,Fo],[n,2,2*Fo],[r,1,z2],[t,1,f5],[t,3,3*f5],[e,1,Hx]];function s(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:l(u,d,f),x=p?p.range(u,+d+1):[];return h?x.reverse():x}function l(u,d,f){const h=Math.abs(d-u)/f,p=O2(([,,b])=>b).right(o,h);if(p===o.length)return e.every(V1(u/Hx,d/Hx,f));if(p===0)return Ep.every(Math.max(V1(u,d,f),1));const[x,g]=o[h/o[p-1][2]<o[p][2]/h?p-1:p];return x.every(g)}return[s,l]}const[MK,jK]=sC(Go,Y2,ug,oC,X2,V2),[NK,_K]=sC(Bo,K2,cg,l0,H2,W2);function Xx(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Kx(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function bd(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function PK(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,i=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=vd(a),d=wd(a),f=vd(i),h=wd(i),p=vd(o),x=wd(o),g=vd(s),b=wd(s),y=vd(l),m=wd(l),k={a:$,A,b:O,B:F,c:null,d:y5,e:y5,f:ZK,g:sY,G:cY,H:KK,I:YK,j:qK,L:lC,m:JK,M:QK,p:D,q:W,Q:w5,s:k5,S:eY,u:tY,U:rY,V:nY,w:aY,W:iY,x:null,X:null,y:oY,Y:lY,Z:uY,"%":v5},S={a:H,A:Y,b:te,B:U,c:null,d:b5,e:b5,f:pY,g:MY,G:NY,H:dY,I:fY,j:hY,L:uC,m:mY,M:gY,p:Se,q:re,Q:w5,s:k5,S:xY,u:yY,U:bY,V:vY,w:wY,W:kY,x:null,X:null,y:SY,Y:jY,Z:_Y,"%":v5},w={a:P,A:E,b:R,B:T,c:G,d:g5,e:g5,f:WK,g:m5,G:p5,H:x5,I:x5,j:BK,L:zK,m:FK,M:GK,p:_,q:LK,Q:HK,s:XK,S:UK,u:EK,U:IK,V:RK,w:TK,W:DK,x:L,X:C,y:m5,Y:p5,Z:$K,"%":VK};k.x=v(r,k),k.X=v(n,k),k.c=v(t,k),S.x=v(r,S),S.X=v(n,S),S.c=v(t,S);function v(J,ne){return function(ce){var ie=[],se=-1,oe=0,ke=J.length,le,fe,Pe;for(ce instanceof Date||(ce=new Date(+ce));++se<ke;)J.charCodeAt(se)===37&&(ie.push(J.slice(oe,se)),(fe=h5[le=J.charAt(++se)])!=null?le=J.charAt(++se):fe=le==="e"?" ":"0",(Pe=ne[le])&&(le=Pe(ce,fe)),ie.push(le),oe=se+1);return ie.push(J.slice(oe,se)),ie.join("")}}function M(J,ne){return function(ce){var ie=bd(1900,void 0,1),se=N(ie,J,ce+="",0),oe,ke;if(se!=ce.length)return null;if("Q"in ie)return new Date(ie.Q);if("s"in ie)return new Date(ie.s*1e3+("L"in ie?ie.L:0));if(ne&&!("Z"in ie)&&(ie.Z=0),"p"in ie&&(ie.H=ie.H%12+ie.p*12),ie.m===void 0&&(ie.m="q"in ie?ie.q:0),"V"in ie){if(ie.V<1||ie.V>53)return null;"w"in ie||(ie.w=1),"Z"in ie?(oe=Kx(bd(ie.y,0,1)),ke=oe.getUTCDay(),oe=ke>4||ke===0?Rp.ceil(oe):Rp(oe),oe=lg.offset(oe,(ie.V-1)*7),ie.y=oe.getUTCFullYear(),ie.m=oe.getUTCMonth(),ie.d=oe.getUTCDate()+(ie.w+6)%7):(oe=Xx(bd(ie.y,0,1)),ke=oe.getDay(),oe=ke>4||ke===0?Ip.ceil(oe):Ip(oe),oe=l0.offset(oe,(ie.V-1)*7),ie.y=oe.getFullYear(),ie.m=oe.getMonth(),ie.d=oe.getDate()+(ie.w+6)%7)}else("W"in ie||"U"in ie)&&("w"in ie||(ie.w="u"in ie?ie.u%7:"W"in ie?1:0),ke="Z"in ie?Kx(bd(ie.y,0,1)).getUTCDay():Xx(bd(ie.y,0,1)).getDay(),ie.m=0,ie.d="W"in ie?(ie.w+6)%7+ie.W*7-(ke+5)%7:ie.w+ie.U*7-(ke+6)%7);return"Z"in ie?(ie.H+=ie.Z/100|0,ie.M+=ie.Z%100,Kx(ie)):Xx(ie)}}function N(J,ne,ce,ie){for(var se=0,oe=ne.length,ke=ce.length,le,fe;se<oe;){if(ie>=ke)return-1;if(le=ne.charCodeAt(se++),le===37){if(le=ne.charAt(se++),fe=w[le in h5?ne.charAt(se++):le],!fe||(ie=fe(J,ce,ie))<0)return-1}else if(le!=ce.charCodeAt(ie++))return-1}return ie}function _(J,ne,ce){var ie=u.exec(ne.slice(ce));return ie?(J.p=d.get(ie[0].toLowerCase()),ce+ie[0].length):-1}function P(J,ne,ce){var ie=p.exec(ne.slice(ce));return ie?(J.w=x.get(ie[0].toLowerCase()),ce+ie[0].length):-1}function E(J,ne,ce){var ie=f.exec(ne.slice(ce));return ie?(J.w=h.get(ie[0].toLowerCase()),ce+ie[0].length):-1}function R(J,ne,ce){var ie=y.exec(ne.slice(ce));return ie?(J.m=m.get(ie[0].toLowerCase()),ce+ie[0].length):-1}function T(J,ne,ce){var ie=g.exec(ne.slice(ce));return ie?(J.m=b.get(ie[0].toLowerCase()),ce+ie[0].length):-1}function G(J,ne,ce){return N(J,t,ne,ce)}function L(J,ne,ce){return N(J,r,ne,ce)}function C(J,ne,ce){return N(J,n,ne,ce)}function $(J){return o[J.getDay()]}function A(J){return i[J.getDay()]}function O(J){return l[J.getMonth()]}function F(J){return s[J.getMonth()]}function D(J){return a[+(J.getHours()>=12)]}function W(J){return 1+~~(J.getMonth()/3)}function H(J){return o[J.getUTCDay()]}function Y(J){return i[J.getUTCDay()]}function te(J){return l[J.getUTCMonth()]}function U(J){return s[J.getUTCMonth()]}function Se(J){return a[+(J.getUTCHours()>=12)]}function re(J){return 1+~~(J.getUTCMonth()/3)}return{format:function(J){var ne=v(J+="",k);return ne.toString=function(){return J},ne},parse:function(J){var ne=M(J+="",!1);return ne.toString=function(){return J},ne},utcFormat:function(J){var ne=v(J+="",S);return ne.toString=function(){return J},ne},utcParse:function(J){var ne=M(J+="",!0);return ne.toString=function(){return J},ne}}}var h5={"-":"",_:" ",0:"0"},Kn=/^\s*\d+/,CK=/^%/,AK=/[\\^$*+?|[\]().{}]/g;function Or(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",i=a.length;return n+(i<r?new Array(r-i+1).join(t)+a:a)}function OK(e){return e.replace(AK,"\\$&")}function vd(e){return new RegExp("^(?:"+e.map(OK).join("|")+")","i")}function wd(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function TK(e,t,r){var n=Kn.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function EK(e,t,r){var n=Kn.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function IK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function RK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function DK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function p5(e,t,r){var n=Kn.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function m5(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function $K(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function LK(e,t,r){var n=Kn.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function FK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function g5(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function BK(e,t,r){var n=Kn.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function x5(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function GK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function UK(e,t,r){var n=Kn.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function zK(e,t,r){var n=Kn.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function WK(e,t,r){var n=Kn.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function VK(e,t,r){var n=CK.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function HK(e,t,r){var n=Kn.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function XK(e,t,r){var n=Kn.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function y5(e,t){return Or(e.getDate(),t,2)}function KK(e,t){return Or(e.getHours(),t,2)}function YK(e,t){return Or(e.getHours()%12||12,t,2)}function qK(e,t){return Or(1+l0.count(Bo(e),e),t,3)}function lC(e,t){return Or(e.getMilliseconds(),t,3)}function ZK(e,t){return lC(e,t)+"000"}function JK(e,t){return Or(e.getMonth()+1,t,2)}function QK(e,t){return Or(e.getMinutes(),t,2)}function eY(e,t){return Or(e.getSeconds(),t,2)}function tY(e){var t=e.getDay();return t===0?7:t}function rY(e,t){return Or(cg.count(Bo(e)-1,e),t,2)}function cC(e){var t=e.getDay();return t>=4||t===0?lu(e):lu.ceil(e)}function nY(e,t){return e=cC(e),Or(lu.count(Bo(e),e)+(Bo(e).getDay()===4),t,2)}function aY(e){return e.getDay()}function iY(e,t){return Or(Ip.count(Bo(e)-1,e),t,2)}function oY(e,t){return Or(e.getFullYear()%100,t,2)}function sY(e,t){return e=cC(e),Or(e.getFullYear()%100,t,2)}function lY(e,t){return Or(e.getFullYear()%1e4,t,4)}function cY(e,t){var r=e.getDay();return e=r>=4||r===0?lu(e):lu.ceil(e),Or(e.getFullYear()%1e4,t,4)}function uY(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+Or(t/60|0,"0",2)+Or(t%60,"0",2)}function b5(e,t){return Or(e.getUTCDate(),t,2)}function dY(e,t){return Or(e.getUTCHours(),t,2)}function fY(e,t){return Or(e.getUTCHours()%12||12,t,2)}function hY(e,t){return Or(1+lg.count(Go(e),e),t,3)}function uC(e,t){return Or(e.getUTCMilliseconds(),t,3)}function pY(e,t){return uC(e,t)+"000"}function mY(e,t){return Or(e.getUTCMonth()+1,t,2)}function gY(e,t){return Or(e.getUTCMinutes(),t,2)}function xY(e,t){return Or(e.getUTCSeconds(),t,2)}function yY(e){var t=e.getUTCDay();return t===0?7:t}function bY(e,t){return Or(ug.count(Go(e)-1,e),t,2)}function dC(e){var t=e.getUTCDay();return t>=4||t===0?cu(e):cu.ceil(e)}function vY(e,t){return e=dC(e),Or(cu.count(Go(e),e)+(Go(e).getUTCDay()===4),t,2)}function wY(e){return e.getUTCDay()}function kY(e,t){return Or(Rp.count(Go(e)-1,e),t,2)}function SY(e,t){return Or(e.getUTCFullYear()%100,t,2)}function MY(e,t){return e=dC(e),Or(e.getUTCFullYear()%100,t,2)}function jY(e,t){return Or(e.getUTCFullYear()%1e4,t,4)}function NY(e,t){var r=e.getUTCDay();return e=r>=4||r===0?cu(e):cu.ceil(e),Or(e.getUTCFullYear()%1e4,t,4)}function _Y(){return"+0000"}function v5(){return"%"}function w5(e){return+e}function k5(e){return Math.floor(+e/1e3)}var pc,fC,hC;PY({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function PY(e){return pc=PK(e),fC=pc.format,pc.parse,hC=pc.utcFormat,pc.utcParse,pc}function CY(e){return new Date(e)}function AY(e){return e instanceof Date?+e:+new Date(+e)}function q2(e,t,r,n,a,i,o,s,l,u){var d=D2(),f=d.invert,h=d.domain,p=u(".%L"),x=u(":%S"),g=u("%I:%M"),b=u("%I %p"),y=u("%a %d"),m=u("%b %d"),k=u("%B"),S=u("%Y");function w(v){return(l(v)<v?p:s(v)<v?x:o(v)<v?g:i(v)<v?b:n(v)<v?a(v)<v?y:m:r(v)<v?k:S)(v)}return d.invert=function(v){return new Date(f(v))},d.domain=function(v){return arguments.length?h(Array.from(v,AY)):h().map(CY)},d.ticks=function(v){var M=h();return e(M[0],M[M.length-1],v??10)},d.tickFormat=function(v,M){return M==null?w:u(M)},d.nice=function(v){var M=h();return(!v||typeof v.range!="function")&&(v=t(M[0],M[M.length-1],v??10)),v?h(QP(M,v)):d},d.copy=function(){return s0(d,q2(e,t,r,n,a,i,o,s,l,u))},d}function OY(){return wi.apply(q2(NK,_K,Bo,K2,cg,l0,H2,W2,yl,fC).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function TY(){return wi.apply(q2(MK,jK,Go,Y2,ug,lg,X2,V2,yl,hC).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function dg(){var e=0,t=1,r,n,a,i,o=va,s=!1,l;function u(f){return f==null||isNaN(f=+f)?l:o(a===0?.5:(f=(i(f)-r)*a,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=i(e=+e),n=i(t=+t),a=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function d(f){return function(h){var p,x;return arguments.length?([p,x]=h,o=f(p,x),u):[o(0),o(1)]}}return u.range=d(Hu),u.rangeRound=d(R2),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return i=f,r=f(e),n=f(t),a=r===n?0:1/(n-r),u}}function Ks(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function pC(){var e=Xs(dg()(va));return e.copy=function(){return Ks(e,pC())},Vo.apply(e,arguments)}function mC(){var e=F2(dg()).domain([1,10]);return e.copy=function(){return Ks(e,mC()).base(e.base())},Vo.apply(e,arguments)}function gC(){var e=B2(dg());return e.copy=function(){return Ks(e,gC()).constant(e.constant())},Vo.apply(e,arguments)}function Z2(){var e=G2(dg());return e.copy=function(){return Ks(e,Z2()).exponent(e.exponent())},Vo.apply(e,arguments)}function EY(){return Z2.apply(null,arguments).exponent(.5)}function xC(){var e=[],t=va;function r(n){if(n!=null&&!isNaN(n=+n))return t((i0(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Ds),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,i)=>bX(e,i/n))},r.copy=function(){return xC(t).domain(e)},Vo.apply(r,arguments)}function fg(){var e=0,t=.5,r=1,n=1,a,i,o,s,l,u=va,d,f=!1,h;function p(g){return isNaN(g=+g)?h:(g=.5+((g=+d(g))-i)*(n*g<n*i?s:l),u(f?Math.max(0,Math.min(1,g)):g))}p.domain=function(g){return arguments.length?([e,t,r]=g,a=d(e=+e),i=d(t=+t),o=d(r=+r),s=a===i?0:.5/(i-a),l=i===o?0:.5/(o-i),n=i<a?-1:1,p):[e,t,r]},p.clamp=function(g){return arguments.length?(f=!!g,p):f},p.interpolator=function(g){return arguments.length?(u=g,p):u};function x(g){return function(b){var y,m,k;return arguments.length?([y,m,k]=b,u=VX(g,[y,m,k]),p):[u(0),u(.5),u(1)]}}return p.range=x(Hu),p.rangeRound=x(R2),p.unknown=function(g){return arguments.length?(h=g,p):h},function(g){return d=g,a=g(e),i=g(t),o=g(r),s=a===i?0:.5/(i-a),l=i===o?0:.5/(o-i),n=i<a?-1:1,p}}function yC(){var e=Xs(fg()(va));return e.copy=function(){return Ks(e,yC())},Vo.apply(e,arguments)}function bC(){var e=F2(fg()).domain([.1,1,10]);return e.copy=function(){return Ks(e,bC()).base(e.base())},Vo.apply(e,arguments)}function vC(){var e=B2(fg());return e.copy=function(){return Ks(e,vC()).constant(e.constant())},Vo.apply(e,arguments)}function J2(){var e=G2(fg());return e.copy=function(){return Ks(e,J2()).exponent(e.exponent())},Vo.apply(e,arguments)}function IY(){return J2.apply(null,arguments).exponent(.5)}const S5=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:Mf,scaleDiverging:yC,scaleDivergingLog:bC,scaleDivergingPow:J2,scaleDivergingSqrt:IY,scaleDivergingSymlog:vC,scaleIdentity:JP,scaleImplicit:H1,scaleLinear:Tp,scaleLog:eC,scaleOrdinal:T2,scalePoint:Wd,scalePow:U2,scaleQuantile:nC,scaleQuantize:aC,scaleRadial:rC,scaleSequential:pC,scaleSequentialLog:mC,scaleSequentialPow:Z2,scaleSequentialQuantile:xC,scaleSequentialSqrt:EY,scaleSequentialSymlog:gC,scaleSqrt:pK,scaleSymlog:tC,scaleThreshold:iC,scaleTime:OY,scaleUtc:TY,tickFormat:ZP},Symbol.toStringTag,{value:"Module"}));var RY=$u;function DY(e,t,r){for(var n=-1,a=e.length;++n<a;){var i=e[n],o=t(i);if(o!=null&&(s===void 0?o===o&&!RY(o):r(o,s)))var s=o,l=i}return l}var wC=DY;function $Y(e,t){return e>t}var LY=$Y,FY=wC,BY=LY,GY=Vu;function UY(e){return e&&e.length?FY(e,GY,BY):void 0}var zY=UY;const ws=Vr(zY);function WY(e,t){return e<t}var VY=WY,HY=wC,XY=VY,KY=Vu;function YY(e){return e&&e.length?HY(e,KY,XY):void 0}var qY=YY;const hg=Vr(qY);var ZY=f2,JY=Vs,QY=OP,eq=Ba;function tq(e,t){var r=eq(e)?ZY:QY;return r(e,JY(t))}var rq=tq,nq=CP,aq=rq;function iq(e,t){return nq(aq(e,t),1)}var oq=iq;const sq=Vr(oq);var lq=N2;function cq(e,t){return lq(e,t)}var uq=cq;const zl=Vr(uq);var Xu=1e9,dq={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},ew,ln=!0,bi="[DecimalError] ",Nl=bi+"Invalid argument: ",Q2=bi+"Exponent out of range: ",Ku=Math.floor,cl=Math.pow,fq=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Za,Wn=1e7,rn=7,kC=9007199254740991,Dp=Ku(kC/rn),ct={};ct.absoluteValue=ct.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};ct.comparedTo=ct.cmp=function(e){var t,r,n,a,i=this;if(e=new i.constructor(e),i.s!==e.s)return i.s||-e.s;if(i.e!==e.e)return i.e>e.e^i.s<0?1:-1;for(n=i.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(i.d[t]!==e.d[t])return i.d[t]>e.d[t]^i.s<0?1:-1;return n===a?0:n>a^i.s<0?1:-1};ct.decimalPlaces=ct.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*rn;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};ct.dividedBy=ct.div=function(e){return Eo(this,new this.constructor(e))};ct.dividedToIntegerBy=ct.idiv=function(e){var t=this,r=t.constructor;return Wr(Eo(t,new r(e),0,1),r.precision)};ct.equals=ct.eq=function(e){return!this.cmp(e)};ct.exponent=function(){return Tn(this)};ct.greaterThan=ct.gt=function(e){return this.cmp(e)>0};ct.greaterThanOrEqualTo=ct.gte=function(e){return this.cmp(e)>=0};ct.isInteger=ct.isint=function(){return this.e>this.d.length-2};ct.isNegative=ct.isneg=function(){return this.s<0};ct.isPositive=ct.ispos=function(){return this.s>0};ct.isZero=function(){return this.s===0};ct.lessThan=ct.lt=function(e){return this.cmp(e)<0};ct.lessThanOrEqualTo=ct.lte=function(e){return this.cmp(e)<1};ct.logarithm=ct.log=function(e){var t,r=this,n=r.constructor,a=n.precision,i=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(Za))throw Error(bi+"NaN");if(r.s<1)throw Error(bi+(r.s?"NaN":"-Infinity"));return r.eq(Za)?new n(0):(ln=!1,t=Eo(Cf(r,i),Cf(e,i),i),ln=!0,Wr(t,a))};ct.minus=ct.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?jC(t,e):SC(t,(e.s=-e.s,e))};ct.modulo=ct.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(bi+"NaN");return r.s?(ln=!1,t=Eo(r,e,0,1).times(e),ln=!0,r.minus(t)):Wr(new n(r),a)};ct.naturalExponential=ct.exp=function(){return MC(this)};ct.naturalLogarithm=ct.ln=function(){return Cf(this)};ct.negated=ct.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};ct.plus=ct.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?SC(t,e):jC(t,(e.s=-e.s,e))};ct.precision=ct.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Nl+e);if(t=Tn(a)+1,n=a.d.length-1,r=n*rn+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};ct.squareRoot=ct.sqrt=function(){var e,t,r,n,a,i,o,s=this,l=s.constructor;if(s.s<1){if(!s.s)return new l(0);throw Error(bi+"NaN")}for(e=Tn(s),ln=!1,a=Math.sqrt(+s),a==0||a==1/0?(t=Zi(s.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Ku((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new l(t)):n=new l(a.toString()),r=l.precision,a=o=r+3;;)if(i=n,n=i.plus(Eo(s,i,o+2)).times(.5),Zi(i.d).slice(0,o)===(t=Zi(n.d)).slice(0,o)){if(t=t.slice(o-3,o+1),a==o&&t=="4999"){if(Wr(i,r+1,0),i.times(i).eq(s)){n=i;break}}else if(t!="9999")break;o+=4}return ln=!0,Wr(n,r)};ct.times=ct.mul=function(e){var t,r,n,a,i,o,s,l,u,d=this,f=d.constructor,h=d.d,p=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,l=h.length,u=p.length,l<u&&(i=h,h=p,p=i,o=l,l=u,u=o),i=[],o=l+u,n=o;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,a=l+n;a>n;)s=i[a]+p[n]*h[a-n-1]+t,i[a--]=s%Wn|0,t=s/Wn|0;i[a]=(i[a]+t)%Wn|0}for(;!i[--o];)i.pop();return t?++r:i.shift(),e.d=i,e.e=r,ln?Wr(e,f.precision):e};ct.toDecimalPlaces=ct.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(so(e,0,Xu),t===void 0?t=n.rounding:so(t,0,8),Wr(r,e+Tn(r)+1,t))};ct.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Wl(n,!0):(so(e,0,Xu),t===void 0?t=a.rounding:so(t,0,8),n=Wr(new a(n),e+1,t),r=Wl(n,!0,e+1)),r};ct.toFixed=function(e,t){var r,n,a=this,i=a.constructor;return e===void 0?Wl(a):(so(e,0,Xu),t===void 0?t=i.rounding:so(t,0,8),n=Wr(new i(a),e+Tn(a)+1,t),r=Wl(n.abs(),!1,e+Tn(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};ct.toInteger=ct.toint=function(){var e=this,t=e.constructor;return Wr(new t(e),Tn(e)+1,t.rounding)};ct.toNumber=function(){return+this};ct.toPower=ct.pow=function(e){var t,r,n,a,i,o,s=this,l=s.constructor,u=12,d=+(e=new l(e));if(!e.s)return new l(Za);if(s=new l(s),!s.s){if(e.s<1)throw Error(bi+"Infinity");return s}if(s.eq(Za))return s;if(n=l.precision,e.eq(Za))return Wr(s,n);if(t=e.e,r=e.d.length-1,o=t>=r,i=s.s,o){if((r=d<0?-d:d)<=kC){for(a=new l(Za),t=Math.ceil(n/rn+4),ln=!1;r%2&&(a=a.times(s),j5(a.d,t)),r=Ku(r/2),r!==0;)s=s.times(s),j5(s.d,t);return ln=!0,e.s<0?new l(Za).div(a):Wr(a,n)}}else if(i<0)throw Error(bi+"NaN");return i=i<0&&e.d[Math.max(t,r)]&1?-1:1,s.s=1,ln=!1,a=e.times(Cf(s,n+u)),ln=!0,a=MC(a),a.s=i,a};ct.toPrecision=function(e,t){var r,n,a=this,i=a.constructor;return e===void 0?(r=Tn(a),n=Wl(a,r<=i.toExpNeg||r>=i.toExpPos)):(so(e,1,Xu),t===void 0?t=i.rounding:so(t,0,8),a=Wr(new i(a),e,t),r=Tn(a),n=Wl(a,e<=r||r<=i.toExpNeg,e)),n};ct.toSignificantDigits=ct.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(so(e,1,Xu),t===void 0?t=n.rounding:so(t,0,8)),Wr(new n(r),e,t)};ct.toString=ct.valueOf=ct.val=ct.toJSON=ct[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Tn(e),r=e.constructor;return Wl(e,t<=r.toExpNeg||t>=r.toExpPos)};function SC(e,t){var r,n,a,i,o,s,l,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),ln?Wr(t,f):t;if(l=e.d,u=t.d,o=e.e,a=t.e,l=l.slice(),i=o-a,i){for(i<0?(n=l,i=-i,s=u.length):(n=u,a=o,s=l.length),o=Math.ceil(f/rn),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=l.length,i=u.length,s-i<0&&(i=s,n=u,u=l,l=n),r=0;i;)r=(l[--i]=l[i]+u[i]+r)/Wn|0,l[i]%=Wn;for(r&&(l.unshift(r),++a),s=l.length;l[--s]==0;)l.pop();return t.d=l,t.e=a,ln?Wr(t,f):t}function so(e,t,r){if(e!==~~e||e<t||e>r)throw Error(Nl+e)}function Zi(e){var t,r,n,a=e.length-1,i="",o=e[0];if(a>0){for(i+=o,t=1;t<a;t++)n=e[t]+"",r=rn-n.length,r&&(i+=cs(r)),i+=n;o=e[t],n=o+"",r=rn-n.length,r&&(i+=cs(r))}else if(o===0)return"0";for(;o%10===0;)o/=10;return i+o}var Eo=function(){function e(n,a){var i,o=0,s=n.length;for(n=n.slice();s--;)i=n[s]*a+o,n[s]=i%Wn|0,o=i/Wn|0;return o&&n.unshift(o),n}function t(n,a,i,o){var s,l;if(i!=o)l=i>o?1:-1;else for(s=l=0;s<i;s++)if(n[s]!=a[s]){l=n[s]>a[s]?1:-1;break}return l}function r(n,a,i){for(var o=0;i--;)n[i]-=o,o=n[i]<a[i]?1:0,n[i]=o*Wn+n[i]-a[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,i,o){var s,l,u,d,f,h,p,x,g,b,y,m,k,S,w,v,M,N,_=n.constructor,P=n.s==a.s?1:-1,E=n.d,R=a.d;if(!n.s)return new _(n);if(!a.s)throw Error(bi+"Division by zero");for(l=n.e-a.e,M=R.length,w=E.length,p=new _(P),x=p.d=[],u=0;R[u]==(E[u]||0);)++u;if(R[u]>(E[u]||0)&&--l,i==null?m=i=_.precision:o?m=i+(Tn(n)-Tn(a))+1:m=i,m<0)return new _(0);if(m=m/rn+2|0,u=0,M==1)for(d=0,R=R[0],m++;(u<w||d)&&m--;u++)k=d*Wn+(E[u]||0),x[u]=k/R|0,d=k%R|0;else{for(d=Wn/(R[0]+1)|0,d>1&&(R=e(R,d),E=e(E,d),M=R.length,w=E.length),S=M,g=E.slice(0,M),b=g.length;b<M;)g[b++]=0;N=R.slice(),N.unshift(0),v=R[0],R[1]>=Wn/2&&++v;do d=0,s=t(R,g,M,b),s<0?(y=g[0],M!=b&&(y=y*Wn+(g[1]||0)),d=y/v|0,d>1?(d>=Wn&&(d=Wn-1),f=e(R,d),h=f.length,b=g.length,s=t(f,g,h,b),s==1&&(d--,r(f,M<h?N:R,h))):(d==0&&(s=d=1),f=R.slice()),h=f.length,h<b&&f.unshift(0),r(g,f,b),s==-1&&(b=g.length,s=t(R,g,M,b),s<1&&(d++,r(g,M<b?N:R,b))),b=g.length):s===0&&(d++,g=[0]),x[u++]=d,s&&g[0]?g[b++]=E[S]||0:(g=[E[S]],b=1);while((S++<w||g[0]!==void 0)&&m--)}return x[0]||x.shift(),p.e=l,Wr(p,o?i+Tn(p)+1:i)}}();function MC(e,t){var r,n,a,i,o,s,l=0,u=0,d=e.constructor,f=d.precision;if(Tn(e)>16)throw Error(Q2+Tn(e));if(!e.s)return new d(Za);for(ln=!1,s=f,o=new d(.03125);e.abs().gte(.1);)e=e.times(o),u+=5;for(n=Math.log(cl(2,u))/Math.LN10*2+5|0,s+=n,r=a=i=new d(Za),d.precision=s;;){if(a=Wr(a.times(e),s),r=r.times(++l),o=i.plus(Eo(a,r,s)),Zi(o.d).slice(0,s)===Zi(i.d).slice(0,s)){for(;u--;)i=Wr(i.times(i),s);return d.precision=f,t==null?(ln=!0,Wr(i,f)):i}i=o}}function Tn(e){for(var t=e.e*rn,r=e.d[0];r>=10;r/=10)t++;return t}function Yx(e,t,r){if(t>e.LN10.sd())throw ln=!0,r&&(e.precision=r),Error(bi+"LN10 precision limit exceeded");return Wr(new e(e.LN10),t)}function cs(e){for(var t="";e--;)t+="0";return t}function Cf(e,t){var r,n,a,i,o,s,l,u,d,f=1,h=10,p=e,x=p.d,g=p.constructor,b=g.precision;if(p.s<1)throw Error(bi+(p.s?"NaN":"-Infinity"));if(p.eq(Za))return new g(0);if(t==null?(ln=!1,u=b):u=t,p.eq(10))return t==null&&(ln=!0),Yx(g,u);if(u+=h,g.precision=u,r=Zi(x),n=r.charAt(0),i=Tn(p),Math.abs(i)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)p=p.times(e),r=Zi(p.d),n=r.charAt(0),f++;i=Tn(p),n>1?(p=new g("0."+r),i++):p=new g(n+"."+r.slice(1))}else return l=Yx(g,u+2,b).times(i+""),p=Cf(new g(n+"."+r.slice(1)),u-h).plus(l),g.precision=b,t==null?(ln=!0,Wr(p,b)):p;for(s=o=p=Eo(p.minus(Za),p.plus(Za),u),d=Wr(p.times(p),u),a=3;;){if(o=Wr(o.times(d),u),l=s.plus(Eo(o,new g(a),u)),Zi(l.d).slice(0,u)===Zi(s.d).slice(0,u))return s=s.times(2),i!==0&&(s=s.plus(Yx(g,u+2,b).times(i+""))),s=Eo(s,new g(f),u),g.precision=b,t==null?(ln=!0,Wr(s,b)):s;s=l,a+=2}}function M5(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Ku(r/rn),e.d=[],n=(r+1)%rn,r<0&&(n+=rn),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=rn;n<a;)e.d.push(+t.slice(n,n+=rn));t=t.slice(n),n=rn-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),ln&&(e.e>Dp||e.e<-Dp))throw Error(Q2+r)}else e.s=0,e.e=0,e.d=[0];return e}function Wr(e,t,r){var n,a,i,o,s,l,u,d,f=e.d;for(o=1,i=f[0];i>=10;i/=10)o++;if(n=t-o,n<0)n+=rn,a=t,u=f[d=0];else{if(d=Math.ceil((n+1)/rn),i=f.length,d>=i)return e;for(u=i=f[d],o=1;i>=10;i/=10)o++;n%=rn,a=n-rn+o}if(r!==void 0&&(i=cl(10,o-a-1),s=u/i%10|0,l=t<0||f[d+1]!==void 0||u%i,l=r<4?(s||l)&&(r==0||r==(e.s<0?3:2)):s>5||s==5&&(r==4||l||r==6&&(n>0?a>0?u/cl(10,o-a):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return l?(i=Tn(e),f.length=1,t=t-i-1,f[0]=cl(10,(rn-t%rn)%rn),e.e=Ku(-t/rn)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=d,i=1,d--):(f.length=d+1,i=cl(10,rn-n),f[d]=a>0?(u/cl(10,o-a)%cl(10,a)|0)*i:0),l)for(;;)if(d==0){(f[0]+=i)==Wn&&(f[0]=1,++e.e);break}else{if(f[d]+=i,f[d]!=Wn)break;f[d--]=0,i=1}for(n=f.length;f[--n]===0;)f.pop();if(ln&&(e.e>Dp||e.e<-Dp))throw Error(Q2+Tn(e));return e}function jC(e,t){var r,n,a,i,o,s,l,u,d,f,h=e.constructor,p=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),ln?Wr(t,p):t;if(l=e.d,f=t.d,n=t.e,u=e.e,l=l.slice(),o=u-n,o){for(d=o<0,d?(r=l,o=-o,s=f.length):(r=f,n=u,s=l.length),a=Math.max(Math.ceil(p/rn),s)+2,o>a&&(o=a,r.length=1),r.reverse(),a=o;a--;)r.push(0);r.reverse()}else{for(a=l.length,s=f.length,d=a<s,d&&(s=a),a=0;a<s;a++)if(l[a]!=f[a]){d=l[a]<f[a];break}o=0}for(d&&(r=l,l=f,f=r,t.s=-t.s),s=l.length,a=f.length-s;a>0;--a)l[s++]=0;for(a=f.length;a>o;){if(l[--a]<f[a]){for(i=a;i&&l[--i]===0;)l[i]=Wn-1;--l[i],l[a]+=Wn}l[a]-=f[a]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--n;return l[0]?(t.d=l,t.e=n,ln?Wr(t,p):t):new h(0)}function Wl(e,t,r){var n,a=Tn(e),i=Zi(e.d),o=i.length;return t?(r&&(n=r-o)>0?i=i.charAt(0)+"."+i.slice(1)+cs(n):o>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(a<0?"e":"e+")+a):a<0?(i="0."+cs(-a-1)+i,r&&(n=r-o)>0&&(i+=cs(n))):a>=o?(i+=cs(a+1-o),r&&(n=r-a-1)>0&&(i=i+"."+cs(n))):((n=a+1)<o&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-o)>0&&(a+1===o&&(i+="."),i+=cs(n))),e.s<0?"-"+i:i}function j5(e,t){if(e.length>t)return e.length=t,!0}function NC(e){var t,r,n;function a(i){var o=this;if(!(o instanceof a))return new a(i);if(o.constructor=a,i instanceof a){o.s=i.s,o.e=i.e,o.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(Nl+i);if(i>0)o.s=1;else if(i<0)i=-i,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(i===~~i&&i<1e7){o.e=0,o.d=[i];return}return M5(o,i.toString())}else if(typeof i!="string")throw Error(Nl+i);if(i.charCodeAt(0)===45?(i=i.slice(1),o.s=-1):o.s=1,fq.test(i))M5(o,i);else throw Error(Nl+i)}if(a.prototype=ct,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=NC,a.config=a.set=hq,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function hq(e){if(!e||typeof e!="object")throw Error(bi+"Object expected");var t,r,n,a=["precision",1,Xu,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Ku(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(Nl+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(Nl+r+": "+n);return this}var ew=NC(dq);Za=new ew(1);const Gr=ew;function pq(e){return yq(e)||xq(e)||gq(e)||mq()}function mq(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gq(e,t){if(e){if(typeof e=="string")return q1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q1(e,t)}}function xq(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function yq(e){if(Array.isArray(e))return q1(e)}function q1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var bq=function(t){return t},_C={},PC=function(t){return t===_C},N5=function(t){return function r(){return arguments.length===0||arguments.length===1&&PC(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},vq=function e(t,r){return t===1?r:N5(function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=a.filter(function(s){return s!==_C}).length;return o>=t?r.apply(void 0,a):e(t-o,N5(function(){for(var s=arguments.length,l=new Array(s),u=0;u<s;u++)l[u]=arguments[u];var d=a.map(function(f){return PC(f)?l.shift():f});return r.apply(void 0,pq(d).concat(l))}))})},pg=function(t){return vq(t.length,t)},Z1=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},wq=pg(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),kq=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return bq;var a=r.reverse(),i=a[0],o=a.slice(1);return function(){return o.reduce(function(s,l){return l(s)},i.apply(void 0,arguments))}},J1=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},CC=function(t){var r=null,n=null;return function(){for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r&&i.every(function(s,l){return s===r[l]})||(r=i,n=t.apply(void 0,i)),n}};function Sq(e){var t;return e===0?t=1:t=Math.floor(new Gr(e).abs().log(10).toNumber())+1,t}function Mq(e,t,r){for(var n=new Gr(e),a=0,i=[];n.lt(t)&&a<1e5;)i.push(n.toNumber()),n=n.add(r),a++;return i}var jq=pg(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),Nq=pg(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),_q=pg(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const mg={rangeStep:Mq,getDigitCount:Sq,interpolateNumber:jq,uninterpolateNumber:Nq,uninterpolateTruncation:_q};function Q1(e){return Aq(e)||Cq(e)||AC(e)||Pq()}function Pq(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Cq(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function Aq(e){if(Array.isArray(e))return eb(e)}function Af(e,t){return Eq(e)||Tq(e,t)||AC(e,t)||Oq()}function Oq(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AC(e,t){if(e){if(typeof e=="string")return eb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eb(e,t)}}function eb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Tq(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,i=void 0;try{for(var o=e[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(l){a=!0,i=l}finally{try{!n&&o.return!=null&&o.return()}finally{if(a)throw i}}return r}}function Eq(e){if(Array.isArray(e))return e}function OC(e){var t=Af(e,2),r=t[0],n=t[1],a=r,i=n;return r>n&&(a=n,i=r),[a,i]}function TC(e,t,r){if(e.lte(0))return new Gr(0);var n=mg.getDigitCount(e.toNumber()),a=new Gr(10).pow(n),i=e.div(a),o=n!==1?.05:.1,s=new Gr(Math.ceil(i.div(o).toNumber())).add(r).mul(o),l=s.mul(a);return t?l:new Gr(Math.ceil(l))}function Iq(e,t,r){var n=1,a=new Gr(e);if(!a.isint()&&r){var i=Math.abs(e);i<1?(n=new Gr(10).pow(mg.getDigitCount(e)-1),a=new Gr(Math.floor(a.div(n).toNumber())).mul(n)):i>1&&(a=new Gr(Math.floor(e)))}else e===0?a=new Gr(Math.floor((t-1)/2)):r||(a=new Gr(Math.floor(e)));var o=Math.floor((t-1)/2),s=kq(wq(function(l){return a.add(new Gr(l-o).mul(n)).toNumber()}),Z1);return s(0,t)}function EC(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Gr(0),tickMin:new Gr(0),tickMax:new Gr(0)};var i=TC(new Gr(t).sub(e).div(r-1),n,a),o;e<=0&&t>=0?o=new Gr(0):(o=new Gr(e).add(t).div(2),o=o.sub(new Gr(o).mod(i)));var s=Math.ceil(o.sub(e).div(i).toNumber()),l=Math.ceil(new Gr(t).sub(o).div(i).toNumber()),u=s+l+1;return u>r?EC(e,t,r,n,a+1):(u<r&&(l=t>0?l+(r-u):l,s=t>0?s:s+(r-u)),{step:i,tickMin:o.sub(new Gr(s).mul(i)),tickMax:o.add(new Gr(l).mul(i))})}function Rq(e){var t=Af(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=Math.max(a,2),s=OC([r,n]),l=Af(s,2),u=l[0],d=l[1];if(u===-1/0||d===1/0){var f=d===1/0?[u].concat(Q1(Z1(0,a-1).map(function(){return 1/0}))):[].concat(Q1(Z1(0,a-1).map(function(){return-1/0})),[d]);return r>n?J1(f):f}if(u===d)return Iq(u,a,i);var h=EC(u,d,o,i),p=h.step,x=h.tickMin,g=h.tickMax,b=mg.rangeStep(x,g.add(new Gr(.1).mul(p)),p);return r>n?J1(b):b}function Dq(e,t){var r=Af(e,2),n=r[0],a=r[1],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=OC([n,a]),s=Af(o,2),l=s[0],u=s[1];if(l===-1/0||u===1/0)return[n,a];if(l===u)return[l];var d=Math.max(t,2),f=TC(new Gr(u).sub(l).div(d-1),i,0),h=[].concat(Q1(mg.rangeStep(new Gr(l),new Gr(u).sub(new Gr(.99).mul(f)),f)),[u]);return n>a?J1(h):h}var $q=CC(Rq),Lq=CC(Dq),Fq="Invariant failed";function Vl(e,t){throw new Error(Fq)}var Bq=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function uu(e){"@babel/helpers - typeof";return uu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},uu(e)}function $p(){return $p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},$p.apply(this,arguments)}function Gq(e,t){return Vq(e)||Wq(e,t)||zq(e,t)||Uq()}function Uq(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zq(e,t){if(e){if(typeof e=="string")return _5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _5(e,t)}}function _5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Wq(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function Vq(e){if(Array.isArray(e))return e}function Hq(e,t){if(e==null)return{};var r=Xq(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Xq(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Kq(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Yq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,DC(n.key),n)}}function qq(e,t,r){return t&&Yq(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zq(e,t,r){return t=Lp(t),Jq(e,IC()?Reflect.construct(t,r||[],Lp(e).constructor):t.apply(e,r))}function Jq(e,t){if(t&&(uu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qq(e)}function Qq(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function IC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(IC=function(){return!!e})()}function Lp(e){return Lp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Lp(e)}function eZ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tb(e,t)}function tb(e,t){return tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},tb(e,t)}function RC(e,t,r){return t=DC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function DC(e){var t=tZ(e,"string");return uu(t)=="symbol"?t:t+""}function tZ(e,t){if(uu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(uu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Yu=function(e){function t(){return Kq(this,t),Zq(this,t,arguments)}return eZ(t,e),qq(t,[{key:"render",value:function(){var n=this.props,a=n.offset,i=n.layout,o=n.width,s=n.dataKey,l=n.data,u=n.dataPointFormatter,d=n.xAxis,f=n.yAxis,h=Hq(n,Bq),p=Qt(h,!1);this.props.direction==="x"&&d.type!=="number"&&Vl();var x=l.map(function(g){var b=u(g,s),y=b.x,m=b.y,k=b.value,S=b.errorVal;if(!S)return null;var w=[],v,M;if(Array.isArray(S)){var N=Gq(S,2);v=N[0],M=N[1]}else v=M=S;if(i==="vertical"){var _=d.scale,P=m+a,E=P+o,R=P-o,T=_(k-v),G=_(k+M);w.push({x1:G,y1:E,x2:G,y2:R}),w.push({x1:T,y1:P,x2:G,y2:P}),w.push({x1:T,y1:E,x2:T,y2:R})}else if(i==="horizontal"){var L=f.scale,C=y+a,$=C-o,A=C+o,O=L(k-v),F=L(k+M);w.push({x1:$,y1:F,x2:A,y2:F}),w.push({x1:C,y1:O,x2:C,y2:F}),w.push({x1:$,y1:O,x2:A,y2:O})}return ee.createElement(Er,$p({className:"recharts-errorBar",key:"bar-".concat(w.map(function(D){return"".concat(D.x1,"-").concat(D.x2,"-").concat(D.y1,"-").concat(D.y2)}))},p),w.map(function(D){return ee.createElement("line",$p({},D,{key:"line-".concat(D.x1,"-").concat(D.x2,"-").concat(D.y1,"-").concat(D.y2)}))}))});return ee.createElement(Er,{className:"recharts-errorBars"},x)}}])}(ee.Component);RC(Yu,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});RC(Yu,"displayName","ErrorBar");function Of(e){"@babel/helpers - typeof";return Of=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Of(e)}function P5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function al(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?P5(Object(r),!0).forEach(function(n){rZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):P5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rZ(e,t,r){return t=nZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nZ(e){var t=aZ(e,"string");return Of(t)=="symbol"?t:t+""}function aZ(e,t){if(Of(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Of(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var $C=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,i=t.legendContent,o=Ka(r,ro);if(!o)return null;var s=ro.defaultProps,l=s!==void 0?al(al({},s),o.props):{},u;return o.props&&o.props.payload?u=o.props&&o.props.payload:i==="children"?u=(n||[]).reduce(function(d,f){var h=f.item,p=f.props,x=p.sectors||p.data||[];return d.concat(x.map(function(g){return{type:o.props.iconType||h.props.legendType,value:g.name,color:g.fill,payload:g}}))},[]):u=(n||[]).map(function(d){var f=d.item,h=f.type.defaultProps,p=h!==void 0?al(al({},h),f.props):{},x=p.dataKey,g=p.name,b=p.legendType,y=p.hide;return{inactive:y,dataKey:x,type:l.iconType||b||"square",color:tw(f),value:g||x,payload:p}}),al(al(al({},l),ro.getWithHeight(o,a)),{},{payload:u,item:o})};function Tf(e){"@babel/helpers - typeof";return Tf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tf(e)}function C5(e){return lZ(e)||sZ(e)||oZ(e)||iZ()}function iZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function oZ(e,t){if(e){if(typeof e=="string")return rb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return rb(e,t)}}function sZ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function lZ(e){if(Array.isArray(e))return rb(e)}function rb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function A5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?A5(Object(r),!0).forEach(function(n){Wc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):A5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wc(e,t,r){return t=cZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cZ(e){var t=uZ(e,"string");return Tf(t)=="symbol"?t:t+""}function uZ(e,t){if(Tf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Tf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gn(e,t,r){return Yt(e)||Yt(t)?r:Bn(t)?gi(e,t,r):ar(t)?t(e):r}function Vd(e,t,r,n){var a=sq(e,function(s){return Gn(s,t)});if(r==="number"){var i=a.filter(function(s){return Ge(s)||parseFloat(s)});return i.length?[hg(i),ws(i)]:[1/0,-1/0]}var o=n?a.filter(function(s){return!Yt(s)}):a;return o.map(function(s){return Bn(s)||s instanceof Date?s:""})}var dZ=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=-1,s=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(s<=1)return 0;if(i&&i.axisType==="angleAxis"&&Math.abs(Math.abs(i.range[1]-i.range[0])-360)<=1e-6)for(var l=i.range,u=0;u<s;u++){var d=u>0?a[u-1].coordinate:a[s-1].coordinate,f=a[u].coordinate,h=u>=s-1?a[0].coordinate:a[u+1].coordinate,p=void 0;if(Ri(f-d)!==Ri(h-f)){var x=[];if(Ri(h-f)===Ri(l[1]-l[0])){p=h;var g=f+l[1]-l[0];x[0]=Math.min(g,(g+d)/2),x[1]=Math.max(g,(g+d)/2)}else{p=d;var b=h+l[1]-l[0];x[0]=Math.min(f,(b+f)/2),x[1]=Math.max(f,(b+f)/2)}var y=[Math.min(f,(p+f)/2),Math.max(f,(p+f)/2)];if(t>y[0]&&t<=y[1]||t>=x[0]&&t<=x[1]){o=a[u].index;break}}else{var m=Math.min(d,h),k=Math.max(d,h);if(t>(m+f)/2&&t<=(k+f)/2){o=a[u].index;break}}}else for(var S=0;S<s;S++)if(S===0&&t<=(n[S].coordinate+n[S+1].coordinate)/2||S>0&&S<s-1&&t>(n[S].coordinate+n[S-1].coordinate)/2&&t<=(n[S].coordinate+n[S+1].coordinate)/2||S===s-1&&t>(n[S].coordinate+n[S-1].coordinate)/2){o=n[S].index;break}return o},tw=function(t){var r,n=t,a=n.type.displayName,i=(r=t.type)!==null&&r!==void 0&&r.defaultProps?yn(yn({},t.type.defaultProps),t.props):t.props,o=i.stroke,s=i.fill,l;switch(a){case"Line":l=o;break;case"Area":case"Radar":l=o&&o!=="none"?o:s;break;default:l=s;break}return l},fZ=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,i=a===void 0?{}:a;if(!i)return{};for(var o={},s=Object.keys(i),l=0,u=s.length;l<u;l++)for(var d=i[s[l]].stackGroups,f=Object.keys(d),h=0,p=f.length;h<p;h++){var x=d[f[h]],g=x.items,b=x.cateAxisId,y=g.filter(function(M){return Oo(M.type).indexOf("Bar")>=0});if(y&&y.length){var m=y[0].type.defaultProps,k=m!==void 0?yn(yn({},m),y[0].props):y[0].props,S=k.barSize,w=k[b];o[w]||(o[w]=[]);var v=Yt(S)?r:S;o[w].push({item:y[0],stackList:y.slice(1),barSize:Yt(v)?void 0:Ul(v,n,0)})}}return o},hZ=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,i=t.sizeList,o=i===void 0?[]:i,s=t.maxBarSize,l=o.length;if(l<1)return null;var u=Ul(r,a,0,!0),d,f=[];if(o[0].barSize===+o[0].barSize){var h=!1,p=a/l,x=o.reduce(function(S,w){return S+w.barSize||0},0);x+=(l-1)*u,x>=a&&(x-=(l-1)*u,u=0),x>=a&&p>0&&(h=!0,p*=.9,x=l*p);var g=(a-x)/2>>0,b={offset:g-u,size:0};d=o.reduce(function(S,w){var v={item:w.item,position:{offset:b.offset+b.size+u,size:h?p:w.barSize}},M=[].concat(C5(S),[v]);return b=M[M.length-1].position,w.stackList&&w.stackList.length&&w.stackList.forEach(function(N){M.push({item:N,position:b})}),M},f)}else{var y=Ul(n,a,0,!0);a-2*y-(l-1)*u<=0&&(u=0);var m=(a-2*y-(l-1)*u)/l;m>1&&(m>>=0);var k=s===+s?Math.min(m,s):m;d=o.reduce(function(S,w,v){var M=[].concat(C5(S),[{item:w.item,position:{offset:y+(m+u)*v+(m-k)/2,size:k}}]);return w.stackList&&w.stackList.length&&w.stackList.forEach(function(N){M.push({item:N,position:M[M.length-1].position})}),M},f)}return d},pZ=function(t,r,n,a){var i=n.children,o=n.width,s=n.margin,l=o-(s.left||0)-(s.right||0),u=$C({children:i,legendWidth:l});if(u){var d=a||{},f=d.width,h=d.height,p=u.align,x=u.verticalAlign,g=u.layout;if((g==="vertical"||g==="horizontal"&&x==="middle")&&p!=="center"&&Ge(t[p]))return yn(yn({},t),{},Wc({},p,t[p]+(f||0)));if((g==="horizontal"||g==="vertical"&&p==="center")&&x!=="middle"&&Ge(t[x]))return yn(yn({},t),{},Wc({},x,t[x]+(h||0)))}return t},mZ=function(t,r,n){return Yt(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},LC=function(t,r,n,a,i){var o=r.props.children,s=Fa(o,Yu).filter(function(u){return mZ(a,i,u.props.direction)});if(s&&s.length){var l=s.map(function(u){return u.props.dataKey});return t.reduce(function(u,d){var f=Gn(d,n);if(Yt(f))return u;var h=Array.isArray(f)?[hg(f),ws(f)]:[f,f],p=l.reduce(function(x,g){var b=Gn(d,g,0),y=h[0]-Math.abs(Array.isArray(b)?b[0]:b),m=h[1]+Math.abs(Array.isArray(b)?b[1]:b);return[Math.min(y,x[0]),Math.max(m,x[1])]},[1/0,-1/0]);return[Math.min(p[0],u[0]),Math.max(p[1],u[1])]},[1/0,-1/0])}return null},gZ=function(t,r,n,a,i){var o=r.map(function(s){return LC(t,s,n,i,a)}).filter(function(s){return!Yt(s)});return o&&o.length?o.reduce(function(s,l){return[Math.min(s[0],l[0]),Math.max(s[1],l[1])]},[1/0,-1/0]):null},FC=function(t,r,n,a,i){var o=r.map(function(l){var u=l.props.dataKey;return n==="number"&&u&&LC(t,l,u,a)||Vd(t,u,n,i)});if(n==="number")return o.reduce(function(l,u){return[Math.min(l[0],u[0]),Math.max(l[1],u[1])]},[1/0,-1/0]);var s={};return o.reduce(function(l,u){for(var d=0,f=u.length;d<f;d++)s[u[d]]||(s[u[d]]=!0,l.push(u[d]));return l},[])},BC=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},GC=function(t,r,n,a){if(a)return t.map(function(l){return l.coordinate});var i,o,s=t.map(function(l){return l.coordinate===r&&(i=!0),l.coordinate===n&&(o=!0),l.coordinate});return i||s.push(r),o||s.push(n),s},Co=function(t,r,n){if(!t)return null;var a=t.scale,i=t.duplicateDomain,o=t.type,s=t.range,l=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,u=(r||n)&&o==="category"&&a.bandwidth?a.bandwidth()/l:0;if(u=t.axisType==="angleAxis"&&(s==null?void 0:s.length)>=2?Ri(s[0]-s[1])*2*u:u,r&&(t.ticks||t.niceTicks)){var d=(t.ticks||t.niceTicks).map(function(f){var h=i?i.indexOf(f):f;return{coordinate:a(h)+u,value:f,offset:u}});return d.filter(function(f){return!Uu(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:a(f)+u,value:f,index:h,offset:u}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(f){return{coordinate:a(f)+u,value:f,offset:u}}):a.domain().map(function(f,h){return{coordinate:a(f)+u,value:i?i[f]:f,index:h,offset:u}})},qx=new WeakMap,nh=function(t,r){if(typeof r!="function")return t;qx.has(t)||qx.set(t,new WeakMap);var n=qx.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},xZ=function(t,r,n){var a=t.scale,i=t.type,o=t.layout,s=t.axisType;if(a==="auto")return o==="radial"&&s==="radiusAxis"?{scale:Mf(),realScaleType:"band"}:o==="radial"&&s==="angleAxis"?{scale:Tp(),realScaleType:"linear"}:i==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:Wd(),realScaleType:"point"}:i==="category"?{scale:Mf(),realScaleType:"band"}:{scale:Tp(),realScaleType:"linear"};if(Gl(a)){var l="scale".concat(Qm(a));return{scale:(S5[l]||Wd)(),realScaleType:S5[l]?l:"point"}}return ar(a)?{scale:a}:{scale:Wd(),realScaleType:"point"}},O5=1e-4,yZ=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),i=Math.min(a[0],a[1])-O5,o=Math.max(a[0],a[1])+O5,s=t(r[0]),l=t(r[n-1]);(s<i||s>o||l<i||l>o)&&t.domain([r[0],r[n-1]])}},bZ=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},vZ=function(t,r){if(!r||r.length!==2||!Ge(r[0])||!Ge(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),i=[t[0],t[1]];return(!Ge(t[0])||t[0]<n)&&(i[0]=n),(!Ge(t[1])||t[1]>a)&&(i[1]=a),i[0]>a&&(i[0]=a),i[1]<n&&(i[1]=n),i},wZ=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var i=0,o=0,s=0;s<r;++s){var l=Uu(t[s][n][1])?t[s][n][0]:t[s][n][1];l>=0?(t[s][n][0]=i,t[s][n][1]=i+l,i=t[s][n][1]):(t[s][n][0]=o,t[s][n][1]=o+l,o=t[s][n][1])}},kZ=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var i=0,o=0;o<r;++o){var s=Uu(t[o][n][1])?t[o][n][0]:t[o][n][1];s>=0?(t[o][n][0]=i,t[o][n][1]=i+s,i=t[o][n][1]):(t[o][n][0]=0,t[o][n][1]=0)}},SZ={sign:wZ,expand:L7,none:ru,silhouette:F7,wiggle:B7,positive:kZ},MZ=function(t,r,n){var a=r.map(function(s){return s.props.dataKey}),i=SZ[n],o=$7().keys(a).value(function(s,l){return+Gn(s,l,0)}).order(_1).offset(i);return o(t)},jZ=function(t,r,n,a,i,o){if(!t)return null;var s=o?r.reverse():r,l={},u=s.reduce(function(f,h){var p,x=(p=h.type)!==null&&p!==void 0&&p.defaultProps?yn(yn({},h.type.defaultProps),h.props):h.props,g=x.stackId,b=x.hide;if(b)return f;var y=x[n],m=f[y]||{hasStack:!1,stackGroups:{}};if(Bn(g)){var k=m.stackGroups[g]||{numericAxisId:n,cateAxisId:a,items:[]};k.items.push(h),m.hasStack=!0,m.stackGroups[g]=k}else m.stackGroups[Jl("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[h]};return yn(yn({},f),{},Wc({},y,m))},l),d={};return Object.keys(u).reduce(function(f,h){var p=u[h];if(p.hasStack){var x={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(g,b){var y=p.stackGroups[b];return yn(yn({},g),{},Wc({},b,{numericAxisId:n,cateAxisId:a,items:y.items,stackedData:MZ(t,y.items,i)}))},x)}return yn(yn({},f),{},Wc({},h,p))},d)},NZ=function(t,r){var n=r.realScaleType,a=r.type,i=r.tickCount,o=r.originalDomain,s=r.allowDecimals,l=n||r.scale;if(l!=="auto"&&l!=="linear")return null;if(i&&a==="number"&&o&&(o[0]==="auto"||o[1]==="auto")){var u=t.domain();if(!u.length)return null;var d=$q(u,i,s);return t.domain([hg(d),ws(d)]),{niceTicks:d}}if(i&&a==="number"){var f=t.domain(),h=Lq(f,i,s);return{niceTicks:h}}return null};function du(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,i=e.index,o=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Yt(a[t.dataKey])){var s=cp(r,"value",a[t.dataKey]);if(s)return s.coordinate+n/2}return r[i]?r[i].coordinate+n/2:null}var l=Gn(a,Yt(o)?t.dataKey:o);return Yt(l)?null:t.scale(l)}var T5=function(t){var r=t.axis,n=t.ticks,a=t.offset,i=t.bandSize,o=t.entry,s=t.index;if(r.type==="category")return n[s]?n[s].coordinate+a:null;var l=Gn(o,r.dataKey,r.domain[s]);return Yt(l)?null:r.scale(l)-i/2+a},_Z=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),i=Math.max(n[0],n[1]);return a<=0&&i>=0?0:i<0?i:a}return n[0]},PZ=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?yn(yn({},t.type.defaultProps),t.props):t.props,i=a.stackId;if(Bn(i)){var o=r[i];if(o){var s=o.items.indexOf(t);return s>=0?o.stackedData[s]:null}}return null},CZ=function(t){return t.reduce(function(r,n){return[hg(n.concat([r[0]]).filter(Ge)),ws(n.concat([r[1]]).filter(Ge))]},[1/0,-1/0])},UC=function(t,r,n){return Object.keys(t).reduce(function(a,i){var o=t[i],s=o.stackedData,l=s.reduce(function(u,d){var f=CZ(d.slice(r,n+1));return[Math.min(u[0],f[0]),Math.max(u[1],f[1])]},[1/0,-1/0]);return[Math.min(l[0],a[0]),Math.max(l[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},E5=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,I5=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,nb=function(t,r,n){if(ar(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(Ge(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(E5.test(t[0])){var i=+E5.exec(t[0])[1];a[0]=r[0]-i}else ar(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(Ge(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(I5.test(t[1])){var o=+I5.exec(t[1])[1];a[1]=r[1]+o}else ar(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},Fp=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var i=P2(r,function(f){return f.coordinate}),o=1/0,s=1,l=i.length;s<l;s++){var u=i[s],d=i[s-1];o=Math.min((u.coordinate||0)-(d.coordinate||0),o)}return o===1/0?0:o}return n?void 0:0},R5=function(t,r,n){return!t||!t.length||zl(t,gi(n,"type.defaultProps.domain"))?r:t},zC=function(t,r){var n=t.type.defaultProps?yn(yn({},t.type.defaultProps),t.props):t.props,a=n.dataKey,i=n.name,o=n.unit,s=n.formatter,l=n.tooltipType,u=n.chartType,d=n.hide;return yn(yn({},Qt(t,!1)),{},{dataKey:a,unit:o,formatter:s,name:i||a,color:tw(t),value:Gn(r,a),type:l,payload:r,chartType:u,hide:d})};function Ef(e){"@babel/helpers - typeof";return Ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ef(e)}function D5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D5(Object(r),!0).forEach(function(n){AZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function AZ(e,t,r){return t=OZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function OZ(e){var t=TZ(e,"string");return Ef(t)=="symbol"?t:t+""}function TZ(e,t){if(Ef(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ef(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Bp=Math.PI/180,EZ=function(t){return t*180/Math.PI},Qn=function(t,r,n,a){return{x:t+Math.cos(-Bp*a)*n,y:r+Math.sin(-Bp*a)*n}},IZ=function(t,r){var n=t.x,a=t.y,i=r.x,o=r.y;return Math.sqrt(Math.pow(n-i,2)+Math.pow(a-o,2))},RZ=function(t,r){var n=t.x,a=t.y,i=r.cx,o=r.cy,s=IZ({x:n,y:a},{x:i,y:o});if(s<=0)return{radius:s};var l=(n-i)/s,u=Math.acos(l);return a>o&&(u=2*Math.PI-u),{radius:s,angle:EZ(u),angleInRadian:u}},DZ=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),i=Math.floor(n/360),o=Math.min(a,i);return{startAngle:r-o*360,endAngle:n-o*360}},$Z=function(t,r){var n=r.startAngle,a=r.endAngle,i=Math.floor(n/360),o=Math.floor(a/360),s=Math.min(i,o);return t+s*360},L5=function(t,r){var n=t.x,a=t.y,i=RZ({x:n,y:a},r),o=i.radius,s=i.angle,l=r.innerRadius,u=r.outerRadius;if(o<l||o>u)return!1;if(o===0)return!0;var d=DZ(r),f=d.startAngle,h=d.endAngle,p=s,x;if(f<=h){for(;p>h;)p-=360;for(;p<f;)p+=360;x=p>=f&&p<=h}else{for(;p>f;)p-=360;for(;p<h;)p+=360;x=p>=h&&p<=f}return x?$5($5({},r),{},{radius:o,angle:$Z(p,r)}):null};function If(e){"@babel/helpers - typeof";return If=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},If(e)}var LZ=["offset"];function FZ(e){return zZ(e)||UZ(e)||GZ(e)||BZ()}function BZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function GZ(e,t){if(e){if(typeof e=="string")return ab(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ab(e,t)}}function UZ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zZ(e){if(Array.isArray(e))return ab(e)}function ab(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function WZ(e,t){if(e==null)return{};var r=VZ(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function VZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function F5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Rn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?F5(Object(r),!0).forEach(function(n){HZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):F5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function HZ(e,t,r){return t=XZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XZ(e){var t=KZ(e,"string");return If(t)=="symbol"?t:t+""}function KZ(e,t){if(If(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(If(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Rf(){return Rf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rf.apply(this,arguments)}var YZ=function(t){var r=t.value,n=t.formatter,a=Yt(t.children)?r:t.children;return ar(n)?n(a):a},qZ=function(t,r){var n=Ri(r-t),a=Math.min(Math.abs(r-t),360);return n*a},ZZ=function(t,r,n){var a=t.position,i=t.viewBox,o=t.offset,s=t.className,l=i,u=l.cx,d=l.cy,f=l.innerRadius,h=l.outerRadius,p=l.startAngle,x=l.endAngle,g=l.clockWise,b=(f+h)/2,y=qZ(p,x),m=y>=0?1:-1,k,S;a==="insideStart"?(k=p+m*o,S=g):a==="insideEnd"?(k=x-m*o,S=!g):a==="end"&&(k=x+m*o,S=g),S=y<=0?S:!S;var w=Qn(u,d,b,k),v=Qn(u,d,b,k+(S?1:-1)*359),M="M".concat(w.x,",").concat(w.y,`
    A`).concat(b,",").concat(b,",0,1,").concat(S?0:1,`,
    `).concat(v.x,",").concat(v.y),N=Yt(t.id)?Jl("recharts-radial-line-"):t.id;return ee.createElement("text",Rf({},n,{dominantBaseline:"central",className:kr("recharts-radial-bar-label",s)}),ee.createElement("defs",null,ee.createElement("path",{id:N,d:M})),ee.createElement("textPath",{xlinkHref:"#".concat(N)},r))},JZ=function(t){var r=t.viewBox,n=t.offset,a=t.position,i=r,o=i.cx,s=i.cy,l=i.innerRadius,u=i.outerRadius,d=i.startAngle,f=i.endAngle,h=(d+f)/2;if(a==="outside"){var p=Qn(o,s,u+n,h),x=p.x,g=p.y;return{x,y:g,textAnchor:x>=o?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"end"};var b=(l+u)/2,y=Qn(o,s,b,h),m=y.x,k=y.y;return{x:m,y:k,textAnchor:"middle",verticalAnchor:"middle"}},QZ=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,i=t.position,o=r,s=o.x,l=o.y,u=o.width,d=o.height,f=d>=0?1:-1,h=f*a,p=f>0?"end":"start",x=f>0?"start":"end",g=u>=0?1:-1,b=g*a,y=g>0?"end":"start",m=g>0?"start":"end";if(i==="top"){var k={x:s+u/2,y:l-f*a,textAnchor:"middle",verticalAnchor:p};return Rn(Rn({},k),n?{height:Math.max(l-n.y,0),width:u}:{})}if(i==="bottom"){var S={x:s+u/2,y:l+d+h,textAnchor:"middle",verticalAnchor:x};return Rn(Rn({},S),n?{height:Math.max(n.y+n.height-(l+d),0),width:u}:{})}if(i==="left"){var w={x:s-b,y:l+d/2,textAnchor:y,verticalAnchor:"middle"};return Rn(Rn({},w),n?{width:Math.max(w.x-n.x,0),height:d}:{})}if(i==="right"){var v={x:s+u+b,y:l+d/2,textAnchor:m,verticalAnchor:"middle"};return Rn(Rn({},v),n?{width:Math.max(n.x+n.width-v.x,0),height:d}:{})}var M=n?{width:u,height:d}:{};return i==="insideLeft"?Rn({x:s+b,y:l+d/2,textAnchor:m,verticalAnchor:"middle"},M):i==="insideRight"?Rn({x:s+u-b,y:l+d/2,textAnchor:y,verticalAnchor:"middle"},M):i==="insideTop"?Rn({x:s+u/2,y:l+h,textAnchor:"middle",verticalAnchor:x},M):i==="insideBottom"?Rn({x:s+u/2,y:l+d-h,textAnchor:"middle",verticalAnchor:p},M):i==="insideTopLeft"?Rn({x:s+b,y:l+h,textAnchor:m,verticalAnchor:x},M):i==="insideTopRight"?Rn({x:s+u-b,y:l+h,textAnchor:y,verticalAnchor:x},M):i==="insideBottomLeft"?Rn({x:s+b,y:l+d-h,textAnchor:m,verticalAnchor:p},M):i==="insideBottomRight"?Rn({x:s+u-b,y:l+d-h,textAnchor:y,verticalAnchor:p},M):Lu(i)&&(Ge(i.x)||gl(i.x))&&(Ge(i.y)||gl(i.y))?Rn({x:s+Ul(i.x,u),y:l+Ul(i.y,d),textAnchor:"end",verticalAnchor:"end"},M):Rn({x:s+u/2,y:l+d/2,textAnchor:"middle",verticalAnchor:"middle"},M)},eJ=function(t){return"cx"in t&&Ge(t.cx)};function Jn(e){var t=e.offset,r=t===void 0?5:t,n=WZ(e,LZ),a=Rn({offset:r},n),i=a.viewBox,o=a.position,s=a.value,l=a.children,u=a.content,d=a.className,f=d===void 0?"":d,h=a.textBreakAll;if(!i||Yt(s)&&Yt(l)&&!j.isValidElement(u)&&!ar(u))return null;if(j.isValidElement(u))return j.cloneElement(u,a);var p;if(ar(u)){if(p=j.createElement(u,a),j.isValidElement(p))return p}else p=YZ(a);var x=eJ(i),g=Qt(a,!0);if(x&&(o==="insideStart"||o==="insideEnd"||o==="end"))return ZZ(a,p,g);var b=x?JZ(a):QZ(a);return ee.createElement(Mp,Rf({className:kr("recharts-label",f)},g,b,{breakAll:h}),p)}Jn.displayName="Label";var WC=function(t){var r=t.cx,n=t.cy,a=t.angle,i=t.startAngle,o=t.endAngle,s=t.r,l=t.radius,u=t.innerRadius,d=t.outerRadius,f=t.x,h=t.y,p=t.top,x=t.left,g=t.width,b=t.height,y=t.clockWise,m=t.labelViewBox;if(m)return m;if(Ge(g)&&Ge(b)){if(Ge(f)&&Ge(h))return{x:f,y:h,width:g,height:b};if(Ge(p)&&Ge(x))return{x:p,y:x,width:g,height:b}}return Ge(f)&&Ge(h)?{x:f,y:h,width:0,height:0}:Ge(r)&&Ge(n)?{cx:r,cy:n,startAngle:i||a||0,endAngle:o||a||0,innerRadius:u||0,outerRadius:d||l||s||0,clockWise:y}:t.viewBox?t.viewBox:{}},tJ=function(t,r){return t?t===!0?ee.createElement(Jn,{key:"label-implicit",viewBox:r}):Bn(t)?ee.createElement(Jn,{key:"label-implicit",viewBox:r,value:t}):j.isValidElement(t)?t.type===Jn?j.cloneElement(t,{key:"label-implicit",viewBox:r}):ee.createElement(Jn,{key:"label-implicit",content:t,viewBox:r}):ar(t)?ee.createElement(Jn,{key:"label-implicit",content:t,viewBox:r}):Lu(t)?ee.createElement(Jn,Rf({viewBox:r},t,{key:"label-implicit"})):null:null},rJ=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,i=WC(t),o=Fa(a,Jn).map(function(l,u){return j.cloneElement(l,{viewBox:r||i,key:"label-".concat(u)})});if(!n)return o;var s=tJ(t.label,r||i);return[s].concat(FZ(o))};Jn.parseViewBox=WC;Jn.renderCallByParent=rJ;function nJ(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var aJ=nJ;const iJ=Vr(aJ);function Df(e){"@babel/helpers - typeof";return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Df(e)}var oJ=["valueAccessor"],sJ=["data","dataKey","clockWise","id","textBreakAll"];function lJ(e){return fJ(e)||dJ(e)||uJ(e)||cJ()}function cJ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uJ(e,t){if(e){if(typeof e=="string")return ib(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ib(e,t)}}function dJ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function fJ(e){if(Array.isArray(e))return ib(e)}function ib(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Gp(){return Gp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gp.apply(this,arguments)}function B5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function G5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?B5(Object(r),!0).forEach(function(n){hJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hJ(e,t,r){return t=pJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pJ(e){var t=mJ(e,"string");return Df(t)=="symbol"?t:t+""}function mJ(e,t){if(Df(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Df(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function U5(e,t){if(e==null)return{};var r=gJ(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gJ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var xJ=function(t){return Array.isArray(t.value)?iJ(t.value):t.value};function ao(e){var t=e.valueAccessor,r=t===void 0?xJ:t,n=U5(e,oJ),a=n.data,i=n.dataKey,o=n.clockWise,s=n.id,l=n.textBreakAll,u=U5(n,sJ);return!a||!a.length?null:ee.createElement(Er,{className:"recharts-label-list"},a.map(function(d,f){var h=Yt(i)?r(d,f):Gn(d&&d.payload,i),p=Yt(s)?{}:{id:"".concat(s,"-").concat(f)};return ee.createElement(Jn,Gp({},Qt(d,!0),u,p,{parentViewBox:d.parentViewBox,value:h,textBreakAll:l,viewBox:Jn.parseViewBox(Yt(o)?d:G5(G5({},d),{},{clockWise:o})),key:"label-".concat(f),index:f}))}))}ao.displayName="LabelList";function yJ(e,t){return e?e===!0?ee.createElement(ao,{key:"labelList-implicit",data:t}):ee.isValidElement(e)||ar(e)?ee.createElement(ao,{key:"labelList-implicit",data:t,content:e}):Lu(e)?ee.createElement(ao,Gp({data:t},e,{key:"labelList-implicit"})):null:null}function bJ(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Fa(n,ao).map(function(o,s){return j.cloneElement(o,{data:t,key:"labelList-".concat(s)})});if(!r)return a;var i=yJ(e.label,t);return[i].concat(lJ(a))}ao.renderCallByParent=bJ;function $f(e){"@babel/helpers - typeof";return $f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},$f(e)}function ob(){return ob=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ob.apply(this,arguments)}function z5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function W5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z5(Object(r),!0).forEach(function(n){vJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vJ(e,t,r){return t=wJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wJ(e){var t=kJ(e,"string");return $f(t)=="symbol"?t:t+""}function kJ(e,t){if($f(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if($f(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var SJ=function(t,r){var n=Ri(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},ah=function(t){var r=t.cx,n=t.cy,a=t.radius,i=t.angle,o=t.sign,s=t.isExternal,l=t.cornerRadius,u=t.cornerIsExternal,d=l*(s?1:-1)+a,f=Math.asin(l/d)/Bp,h=u?i:i+o*f,p=Qn(r,n,d,h),x=Qn(r,n,a,h),g=u?i-o*f:i,b=Qn(r,n,d*Math.cos(f*Bp),g);return{center:p,circleTangency:x,lineTangency:b,theta:f}},VC=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,i=t.outerRadius,o=t.startAngle,s=t.endAngle,l=SJ(o,s),u=o+l,d=Qn(r,n,i,o),f=Qn(r,n,i,u),h="M ".concat(d.x,",").concat(d.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(l)>180),",").concat(+(o>u),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(a>0){var p=Qn(r,n,a,o),x=Qn(r,n,a,u);h+="L ".concat(x.x,",").concat(x.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(l)>180),",").concat(+(o<=u),`,
            `).concat(p.x,",").concat(p.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},MJ=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,i=t.outerRadius,o=t.cornerRadius,s=t.forceCornerRadius,l=t.cornerIsExternal,u=t.startAngle,d=t.endAngle,f=Ri(d-u),h=ah({cx:r,cy:n,radius:i,angle:u,sign:f,cornerRadius:o,cornerIsExternal:l}),p=h.circleTangency,x=h.lineTangency,g=h.theta,b=ah({cx:r,cy:n,radius:i,angle:d,sign:-f,cornerRadius:o,cornerIsExternal:l}),y=b.circleTangency,m=b.lineTangency,k=b.theta,S=l?Math.abs(u-d):Math.abs(u-d)-g-k;if(S<0)return s?"M ".concat(x.x,",").concat(x.y,`
        a`).concat(o,",").concat(o,",0,0,1,").concat(o*2,`,0
        a`).concat(o,",").concat(o,",0,0,1,").concat(-o*2,`,0
      `):VC({cx:r,cy:n,innerRadius:a,outerRadius:i,startAngle:u,endAngle:d});var w="M ".concat(x.x,",").concat(x.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(S>180),",").concat(+(f<0),",").concat(y.x,",").concat(y.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(m.x,",").concat(m.y,`
  `);if(a>0){var v=ah({cx:r,cy:n,radius:a,angle:u,sign:f,isExternal:!0,cornerRadius:o,cornerIsExternal:l}),M=v.circleTangency,N=v.lineTangency,_=v.theta,P=ah({cx:r,cy:n,radius:a,angle:d,sign:-f,isExternal:!0,cornerRadius:o,cornerIsExternal:l}),E=P.circleTangency,R=P.lineTangency,T=P.theta,G=l?Math.abs(u-d):Math.abs(u-d)-_-T;if(G<0&&o===0)return"".concat(w,"L").concat(r,",").concat(n,"Z");w+="L".concat(R.x,",").concat(R.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(E.x,",").concat(E.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(G>180),",").concat(+(f>0),",").concat(M.x,",").concat(M.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(N.x,",").concat(N.y,"Z")}else w+="L".concat(r,",").concat(n,"Z");return w},jJ={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},HC=function(t){var r=W5(W5({},jJ),t),n=r.cx,a=r.cy,i=r.innerRadius,o=r.outerRadius,s=r.cornerRadius,l=r.forceCornerRadius,u=r.cornerIsExternal,d=r.startAngle,f=r.endAngle,h=r.className;if(o<i||d===f)return null;var p=kr("recharts-sector",h),x=o-i,g=Ul(s,x,0,!0),b;return g>0&&Math.abs(d-f)<360?b=MJ({cx:n,cy:a,innerRadius:i,outerRadius:o,cornerRadius:Math.min(g,x/2),forceCornerRadius:l,cornerIsExternal:u,startAngle:d,endAngle:f}):b=VC({cx:n,cy:a,innerRadius:i,outerRadius:o,startAngle:d,endAngle:f}),ee.createElement("path",ob({},Qt(r,!0),{className:p,d:b,role:"img"}))};function Lf(e){"@babel/helpers - typeof";return Lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lf(e)}function sb(){return sb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},sb.apply(this,arguments)}function V5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function H5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V5(Object(r),!0).forEach(function(n){NJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function NJ(e,t,r){return t=_J(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _J(e){var t=PJ(e,"string");return Lf(t)=="symbol"?t:t+""}function PJ(e,t){if(Lf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Lf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var X5={curveBasisClosed:N7,curveBasisOpen:_7,curveBasis:j7,curveBumpX:d7,curveBumpY:f7,curveLinearClosed:P7,curveLinear:tg,curveMonotoneX:C7,curveMonotoneY:A7,curveNatural:O7,curveStep:T7,curveStepAfter:I7,curveStepBefore:E7},ih=function(t){return t.x===+t.x&&t.y===+t.y},kd=function(t){return t.x},Sd=function(t){return t.y},CJ=function(t,r){if(ar(t))return t;var n="curve".concat(Qm(t));return(n==="curveMonotone"||n==="curveBump")&&r?X5["".concat(n).concat(r==="vertical"?"Y":"X")]:X5[n]||tg},AJ=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,i=a===void 0?[]:a,o=t.baseLine,s=t.layout,l=t.connectNulls,u=l===void 0?!1:l,d=CJ(n,s),f=u?i.filter(function(g){return ih(g)}):i,h;if(Array.isArray(o)){var p=u?o.filter(function(g){return ih(g)}):o,x=f.map(function(g,b){return H5(H5({},g),{},{base:p[b]})});return s==="vertical"?h=Y0().y(Sd).x1(kd).x0(function(g){return g.base.x}):h=Y0().x(kd).y1(Sd).y0(function(g){return g.base.y}),h.defined(ih).curve(d),h(x)}return s==="vertical"&&Ge(o)?h=Y0().y(Sd).x1(kd).x0(o):Ge(o)?h=Y0().x(kd).y1(Sd).y0(o):h=K_().x(kd).y(Sd),h.defined(ih).curve(d),h(f)},_l=function(t){var r=t.className,n=t.points,a=t.path,i=t.pathRef;if((!n||!n.length)&&!a)return null;var o=n&&n.length?AJ(t):a;return j.createElement("path",sb({},Qt(t,!1),up(t),{className:kr("recharts-curve",r),d:o,ref:i}))},XC={exports:{}},OJ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",TJ=OJ,EJ=TJ;function KC(){}function YC(){}YC.resetWarningCache=KC;var IJ=function(){function e(n,a,i,o,s,l){if(l!==EJ){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:YC,resetWarningCache:KC};return r.PropTypes=r,r};XC.exports=IJ();var RJ=XC.exports;const $r=Vr(RJ),{getOwnPropertyNames:DJ,getOwnPropertySymbols:$J}=Object,{hasOwnProperty:LJ}=Object.prototype;function Zx(e,t){return function(n,a,i){return e(n,a,i)&&t(n,a,i)}}function oh(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);const{cache:i}=a,o=i.get(r),s=i.get(n);if(o&&s)return o===n&&s===r;i.set(r,n),i.set(n,r);const l=e(r,n,a);return i.delete(r),i.delete(n),l}}function FJ(e){return e!=null?e[Symbol.toStringTag]:void 0}function K5(e){return DJ(e).concat($J(e))}const BJ=Object.hasOwn||((e,t)=>LJ.call(e,t));function tc(e,t){return e===t||!e&&!t&&e!==e&&t!==t}const GJ="__v",UJ="__o",zJ="_owner",{getOwnPropertyDescriptor:Y5,keys:q5}=Object;function WJ(e,t){return e.byteLength===t.byteLength&&Up(new Uint8Array(e),new Uint8Array(t))}function VJ(e,t,r){let n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function HJ(e,t){return e.byteLength===t.byteLength&&Up(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}function XJ(e,t){return tc(e.getTime(),t.getTime())}function KJ(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function YJ(e,t){return e===t}function Z5(e,t,r){const n=e.size;if(n!==t.size)return!1;if(!n)return!0;const a=new Array(n),i=e.entries();let o,s,l=0;for(;(o=i.next())&&!o.done;){const u=t.entries();let d=!1,f=0;for(;(s=u.next())&&!s.done;){if(a[f]){f++;continue}const h=o.value,p=s.value;if(r.equals(h[0],p[0],l,f,e,t,r)&&r.equals(h[1],p[1],h[0],p[0],e,t,r)){d=a[f]=!0;break}f++}if(!d)return!1;l++}return!0}const qJ=tc;function ZJ(e,t,r){const n=q5(e);let a=n.length;if(q5(t).length!==a)return!1;for(;a-- >0;)if(!qC(e,t,r,n[a]))return!1;return!0}function Md(e,t,r){const n=K5(e);let a=n.length;if(K5(t).length!==a)return!1;let i,o,s;for(;a-- >0;)if(i=n[a],!qC(e,t,r,i)||(o=Y5(e,i),s=Y5(t,i),(o||s)&&(!o||!s||o.configurable!==s.configurable||o.enumerable!==s.enumerable||o.writable!==s.writable)))return!1;return!0}function JJ(e,t){return tc(e.valueOf(),t.valueOf())}function QJ(e,t){return e.source===t.source&&e.flags===t.flags}function J5(e,t,r){const n=e.size;if(n!==t.size)return!1;if(!n)return!0;const a=new Array(n),i=e.values();let o,s;for(;(o=i.next())&&!o.done;){const l=t.values();let u=!1,d=0;for(;(s=l.next())&&!s.done;){if(!a[d]&&r.equals(o.value,s.value,o.value,s.value,e,t,r)){u=a[d]=!0;break}d++}if(!u)return!1}return!0}function Up(e,t){let r=e.byteLength;if(t.byteLength!==r||e.byteOffset!==t.byteOffset)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function eQ(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function qC(e,t,r,n){return(n===zJ||n===UJ||n===GJ)&&(e.$$typeof||t.$$typeof)?!0:BJ(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}const tQ="[object ArrayBuffer]",rQ="[object Arguments]",nQ="[object Boolean]",aQ="[object DataView]",iQ="[object Date]",oQ="[object Error]",sQ="[object Map]",lQ="[object Number]",cQ="[object Object]",uQ="[object RegExp]",dQ="[object Set]",fQ="[object String]",hQ={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},pQ="[object URL]",mQ=Object.prototype.toString;function gQ({areArrayBuffersEqual:e,areArraysEqual:t,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:a,areFunctionsEqual:i,areMapsEqual:o,areNumbersEqual:s,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:d,areSetsEqual:f,areTypedArraysEqual:h,areUrlsEqual:p,unknownTagComparators:x}){return function(b,y,m){if(b===y)return!0;if(b==null||y==null)return!1;const k=typeof b;if(k!==typeof y)return!1;if(k!=="object")return k==="number"?s(b,y,m):k==="function"?i(b,y,m):!1;const S=b.constructor;if(S!==y.constructor)return!1;if(S===Object)return l(b,y,m);if(Array.isArray(b))return t(b,y,m);if(S===Date)return n(b,y,m);if(S===RegExp)return d(b,y,m);if(S===Map)return o(b,y,m);if(S===Set)return f(b,y,m);const w=mQ.call(b);if(w===iQ)return n(b,y,m);if(w===uQ)return d(b,y,m);if(w===sQ)return o(b,y,m);if(w===dQ)return f(b,y,m);if(w===cQ)return typeof b.then!="function"&&typeof y.then!="function"&&l(b,y,m);if(w===pQ)return p(b,y,m);if(w===oQ)return a(b,y,m);if(w===rQ)return l(b,y,m);if(hQ[w])return h(b,y,m);if(w===tQ)return e(b,y,m);if(w===aQ)return r(b,y,m);if(w===nQ||w===lQ||w===fQ)return u(b,y,m);if(x){let v=x[w];if(!v){const M=FJ(b);M&&(v=x[M])}if(v)return v(b,y,m)}return!1}}function xQ({circular:e,createCustomConfig:t,strict:r}){let n={areArrayBuffersEqual:WJ,areArraysEqual:r?Md:VJ,areDataViewsEqual:HJ,areDatesEqual:XJ,areErrorsEqual:KJ,areFunctionsEqual:YJ,areMapsEqual:r?Zx(Z5,Md):Z5,areNumbersEqual:qJ,areObjectsEqual:r?Md:ZJ,arePrimitiveWrappersEqual:JJ,areRegExpsEqual:QJ,areSetsEqual:r?Zx(J5,Md):J5,areTypedArraysEqual:r?Zx(Up,Md):Up,areUrlsEqual:eQ,unknownTagComparators:void 0};if(t&&(n=Object.assign({},n,t(n))),e){const a=oh(n.areArraysEqual),i=oh(n.areMapsEqual),o=oh(n.areObjectsEqual),s=oh(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:a,areMapsEqual:i,areObjectsEqual:o,areSetsEqual:s})}return n}function yQ(e){return function(t,r,n,a,i,o,s){return e(t,r,s)}}function bQ({circular:e,comparator:t,createState:r,equals:n,strict:a}){if(r)return function(s,l){const{cache:u=e?new WeakMap:void 0,meta:d}=r();return t(s,l,{cache:u,equals:n,meta:d,strict:a})};if(e)return function(s,l){return t(s,l,{cache:new WeakMap,equals:n,meta:void 0,strict:a})};const i={cache:void 0,equals:n,meta:void 0,strict:a};return function(s,l){return t(s,l,i)}}const vQ=Ys();Ys({strict:!0});Ys({circular:!0});Ys({circular:!0,strict:!0});Ys({createInternalComparator:()=>tc});Ys({strict:!0,createInternalComparator:()=>tc});Ys({circular:!0,createInternalComparator:()=>tc});Ys({circular:!0,createInternalComparator:()=>tc,strict:!0});function Ys(e={}){const{circular:t=!1,createInternalComparator:r,createState:n,strict:a=!1}=e,i=xQ(e),o=gQ(i),s=r?r(o):yQ(o);return bQ({circular:t,comparator:o,createState:n,equals:s,strict:a})}function wQ(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function Q5(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(i){r<0&&(r=i),i-r>t?(e(i),r=-1):wQ(a)};requestAnimationFrame(n)}function lb(e){"@babel/helpers - typeof";return lb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lb(e)}function kQ(e){return NQ(e)||jQ(e)||MQ(e)||SQ()}function SQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MQ(e,t){if(e){if(typeof e=="string")return eM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return eM(e,t)}}function eM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function jQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function NQ(e){if(Array.isArray(e))return e}function _Q(){var e={},t=function(){return null},r=!1,n=function a(i){if(!r){if(Array.isArray(i)){if(!i.length)return;var o=i,s=kQ(o),l=s[0],u=s.slice(1);if(typeof l=="number"){Q5(a.bind(null,u),l);return}a(l),Q5(a.bind(null,u));return}lb(i)==="object"&&(e=i,t(e)),typeof i=="function"&&i()}};return{stop:function(){r=!0},start:function(i){r=!1,n(i)},subscribe:function(i){return t=i,function(){t=function(){return null}}}}}function Ff(e){"@babel/helpers - typeof";return Ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ff(e)}function tM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?tM(Object(r),!0).forEach(function(n){ZC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ZC(e,t,r){return t=PQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PQ(e){var t=CQ(e,"string");return Ff(t)==="symbol"?t:String(t)}function CQ(e,t){if(Ff(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ff(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var AQ=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(i){return a.includes(i)})})},OQ=function(t){return t},TQ=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Hd=function(t,r){return Object.keys(r).reduce(function(n,a){return rM(rM({},n),{},ZC({},a,t(a,r[a])))},{})},nM=function(t,r,n){return t.map(function(a){return"".concat(TQ(a)," ").concat(r,"ms ").concat(n)}).join(",")};function EQ(e,t){return DQ(e)||RQ(e,t)||JC(e,t)||IQ()}function IQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function DQ(e){if(Array.isArray(e))return e}function $Q(e){return BQ(e)||FQ(e)||JC(e)||LQ()}function LQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JC(e,t){if(e){if(typeof e=="string")return cb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cb(e,t)}}function FQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function BQ(e){if(Array.isArray(e))return cb(e)}function cb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var zp=1e-4,QC=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},eA=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},aM=function(t,r){return function(n){var a=QC(t,r);return eA(a,n)}},GQ=function(t,r){return function(n){var a=QC(t,r),i=[].concat($Q(a.map(function(o,s){return o*s}).slice(1)),[0]);return eA(i,n)}},iM=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],i=r[1],o=r[2],s=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,i=0,o=1,s=1;break;case"ease":a=.25,i=.1,o=.25,s=1;break;case"ease-in":a=.42,i=0,o=1,s=1;break;case"ease-out":a=.42,i=0,o=.58,s=1;break;case"ease-in-out":a=0,i=0,o=.58,s=1;break;default:{var l=r[0].split("(");if(l[0]==="cubic-bezier"&&l[1].split(")")[0].split(",").length===4){var u=l[1].split(")")[0].split(",").map(function(b){return parseFloat(b)}),d=EQ(u,4);a=d[0],i=d[1],o=d[2],s=d[3]}}}var f=aM(a,o),h=aM(i,s),p=GQ(a,o),x=function(y){return y>1?1:y<0?0:y},g=function(y){for(var m=y>1?1:y,k=m,S=0;S<8;++S){var w=f(k)-m,v=p(k);if(Math.abs(w-m)<zp||v<zp)return h(k);k=x(k-w/v)}return h(k)};return g.isStepper=!1,g},UQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,i=a===void 0?8:a,o=t.dt,s=o===void 0?17:o,l=function(d,f,h){var p=-(d-f)*n,x=h*i,g=h+(p-x)*s/1e3,b=h*s/1e3+d;return Math.abs(b-f)<zp&&Math.abs(g)<zp?[f,0]:[b,g]};return l.isStepper=!0,l.dt=s,l},zQ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return iM(a);case"spring":return UQ();default:if(a.split("(")[0]==="cubic-bezier")return iM(a)}return typeof a=="function"?a:null};function Bf(e){"@babel/helpers - typeof";return Bf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bf(e)}function oM(e){return HQ(e)||VQ(e)||tA(e)||WQ()}function WQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function HQ(e){if(Array.isArray(e))return db(e)}function sM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function qn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sM(Object(r),!0).forEach(function(n){ub(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ub(e,t,r){return t=XQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function XQ(e){var t=KQ(e,"string");return Bf(t)==="symbol"?t:String(t)}function KQ(e,t){if(Bf(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Bf(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function YQ(e,t){return JQ(e)||ZQ(e,t)||tA(e,t)||qQ()}function qQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tA(e,t){if(e){if(typeof e=="string")return db(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return db(e,t)}}function db(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function ZQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function JQ(e){if(Array.isArray(e))return e}var Wp=function(t,r,n){return t+(r-t)*n},fb=function(t){var r=t.from,n=t.to;return r!==n},QQ=function e(t,r,n){var a=Hd(function(i,o){if(fb(o)){var s=t(o.from,o.to,o.velocity),l=YQ(s,2),u=l[0],d=l[1];return qn(qn({},o),{},{from:u,velocity:d})}return o},r);return n<1?Hd(function(i,o){return fb(o)?qn(qn({},o),{},{velocity:Wp(o.velocity,a[i].velocity,n),from:Wp(o.from,a[i].from,n)}):o},r):e(t,a,n-1)};const eee=function(e,t,r,n,a){var i=AQ(e,t),o=i.reduce(function(b,y){return qn(qn({},b),{},ub({},y,[e[y],t[y]]))},{}),s=i.reduce(function(b,y){return qn(qn({},b),{},ub({},y,{from:e[y],velocity:0,to:t[y]}))},{}),l=-1,u,d,f=function(){return null},h=function(){return Hd(function(y,m){return m.from},s)},p=function(){return!Object.values(s).filter(fb).length},x=function(y){u||(u=y);var m=y-u,k=m/r.dt;s=QQ(r,s,k),a(qn(qn(qn({},e),t),h())),u=y,p()||(l=requestAnimationFrame(f))},g=function(y){d||(d=y);var m=(y-d)/n,k=Hd(function(w,v){return Wp.apply(void 0,oM(v).concat([r(m)]))},o);if(a(qn(qn(qn({},e),t),k)),m<1)l=requestAnimationFrame(f);else{var S=Hd(function(w,v){return Wp.apply(void 0,oM(v).concat([r(1)]))},o);a(qn(qn(qn({},e),t),S))}};return f=r.isStepper?x:g,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(l)}}};function fu(e){"@babel/helpers - typeof";return fu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fu(e)}var tee=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function ree(e,t){if(e==null)return{};var r=nee(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function nee(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function Jx(e){return see(e)||oee(e)||iee(e)||aee()}function aee(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iee(e,t){if(e){if(typeof e=="string")return hb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hb(e,t)}}function oee(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function see(e){if(Array.isArray(e))return hb(e)}function hb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ni(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?lM(Object(r),!0).forEach(function(n){Od(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):lM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Od(e,t,r){return t=rA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lee(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function cee(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rA(n.key),n)}}function uee(e,t,r){return t&&cee(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function rA(e){var t=dee(e,"string");return fu(t)==="symbol"?t:String(t)}function dee(e,t){if(fu(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fu(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function fee(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pb(e,t)}function pb(e,t){return pb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},pb(e,t)}function hee(e){var t=pee();return function(){var n=Vp(e),a;if(t){var i=Vp(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return mb(this,a)}}function mb(e,t){if(t&&(fu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gb(e)}function gb(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pee(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Vp(e){return Vp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Vp(e)}var Bi=function(e){fee(r,e);var t=hee(r);function r(n,a){var i;lee(this,r),i=t.call(this,n,a);var o=i.props,s=o.isActive,l=o.attributeName,u=o.from,d=o.to,f=o.steps,h=o.children,p=o.duration;if(i.handleStyleChange=i.handleStyleChange.bind(gb(i)),i.changeStyle=i.changeStyle.bind(gb(i)),!s||p<=0)return i.state={style:{}},typeof h=="function"&&(i.state={style:d}),mb(i);if(f&&f.length)i.state={style:f[0].style};else if(u){if(typeof h=="function")return i.state={style:u},mb(i);i.state={style:l?Od({},l,u):u}}else i.state={style:{}};return i}return uee(r,[{key:"componentDidMount",value:function(){var a=this.props,i=a.isActive,o=a.canBegin;this.mounted=!0,!(!i||!o)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var i=this.props,o=i.isActive,s=i.canBegin,l=i.attributeName,u=i.shouldReAnimate,d=i.to,f=i.from,h=this.state.style;if(s){if(!o){var p={style:l?Od({},l,d):d};this.state&&h&&(l&&h[l]!==d||!l&&h!==d)&&this.setState(p);return}if(!(vQ(a.to,d)&&a.canBegin&&a.isActive)){var x=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var g=x||u?f:a.to;if(this.state&&h){var b={style:l?Od({},l,g):g};(l&&h[l]!==g||!l&&h!==g)&&this.setState(b)}this.runAnimation(Ni(Ni({},this.props),{},{from:g,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var i=this,o=a.from,s=a.to,l=a.duration,u=a.easing,d=a.begin,f=a.onAnimationEnd,h=a.onAnimationStart,p=eee(o,s,zQ(u),l,this.changeStyle),x=function(){i.stopJSAnimation=p()};this.manager.start([h,d,x,l,f])}},{key:"runStepAnimation",value:function(a){var i=this,o=a.steps,s=a.begin,l=a.onAnimationStart,u=o[0],d=u.style,f=u.duration,h=f===void 0?0:f,p=function(g,b,y){if(y===0)return g;var m=b.duration,k=b.easing,S=k===void 0?"ease":k,w=b.style,v=b.properties,M=b.onAnimationEnd,N=y>0?o[y-1]:b,_=v||Object.keys(w);if(typeof S=="function"||S==="spring")return[].concat(Jx(g),[i.runJSAnimation.bind(i,{from:N.style,to:w,duration:m,easing:S}),m]);var P=nM(_,m,S),E=Ni(Ni(Ni({},N.style),w),{},{transition:P});return[].concat(Jx(g),[E,m,M]).filter(OQ)};return this.manager.start([l].concat(Jx(o.reduce(p,[d,Math.max(h,s)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=_Q());var i=a.begin,o=a.duration,s=a.attributeName,l=a.to,u=a.easing,d=a.onAnimationStart,f=a.onAnimationEnd,h=a.steps,p=a.children,x=this.manager;if(this.unSubscribe=x.subscribe(this.handleStyleChange),typeof u=="function"||typeof p=="function"||u==="spring"){this.runJSAnimation(a);return}if(h.length>1){this.runStepAnimation(a);return}var g=s?Od({},s,l):l,b=nM(Object.keys(g),o,u);x.start([d,i,Ni(Ni({},g),{},{transition:b}),o,f])}},{key:"render",value:function(){var a=this.props,i=a.children;a.begin;var o=a.duration;a.attributeName,a.easing;var s=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var l=ree(a,tee),u=j.Children.count(i),d=this.state.style;if(typeof i=="function")return i(d);if(!s||u===0||o<=0)return i;var f=function(p){var x=p.props,g=x.style,b=g===void 0?{}:g,y=x.className,m=j.cloneElement(p,Ni(Ni({},l),{},{style:Ni(Ni({},b),d),className:y}));return m};return u===1?f(j.Children.only(i)):ee.createElement("div",null,j.Children.map(i,function(h){return f(h)}))}}]),r}(j.PureComponent);Bi.displayName="Animate";Bi.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};Bi.propTypes={from:$r.oneOfType([$r.object,$r.string]),to:$r.oneOfType([$r.object,$r.string]),attributeName:$r.string,duration:$r.number,begin:$r.number,easing:$r.oneOfType([$r.string,$r.func]),steps:$r.arrayOf($r.shape({duration:$r.number.isRequired,style:$r.object.isRequired,easing:$r.oneOfType([$r.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),$r.func]),properties:$r.arrayOf("string"),onAnimationEnd:$r.func})),children:$r.oneOfType([$r.node,$r.func]),isActive:$r.bool,canBegin:$r.bool,onAnimationEnd:$r.func,shouldReAnimate:$r.bool,onAnimationStart:$r.func,onAnimationReStart:$r.func};function Gf(e){"@babel/helpers - typeof";return Gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gf(e)}function Hp(){return Hp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Hp.apply(this,arguments)}function mee(e,t){return bee(e)||yee(e,t)||xee(e,t)||gee()}function gee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xee(e,t){if(e){if(typeof e=="string")return cM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cM(e,t)}}function cM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function yee(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function bee(e){if(Array.isArray(e))return e}function uM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function dM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?uM(Object(r),!0).forEach(function(n){vee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vee(e,t,r){return t=wee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wee(e){var t=kee(e,"string");return Gf(t)=="symbol"?t:t+""}function kee(e,t){if(Gf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Gf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var fM=function(t,r,n,a,i){var o=Math.min(Math.abs(n)/2,Math.abs(a)/2),s=a>=0?1:-1,l=n>=0?1:-1,u=a>=0&&n>=0||a<0&&n<0?1:0,d;if(o>0&&i instanceof Array){for(var f=[0,0,0,0],h=0,p=4;h<p;h++)f[h]=i[h]>o?o:i[h];d="M".concat(t,",").concat(r+s*f[0]),f[0]>0&&(d+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(u,",").concat(t+l*f[0],",").concat(r)),d+="L ".concat(t+n-l*f[1],",").concat(r),f[1]>0&&(d+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(u,`,
        `).concat(t+n,",").concat(r+s*f[1])),d+="L ".concat(t+n,",").concat(r+a-s*f[2]),f[2]>0&&(d+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(u,`,
        `).concat(t+n-l*f[2],",").concat(r+a)),d+="L ".concat(t+l*f[3],",").concat(r+a),f[3]>0&&(d+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(u,`,
        `).concat(t,",").concat(r+a-s*f[3])),d+="Z"}else if(o>0&&i===+i&&i>0){var x=Math.min(o,i);d="M ".concat(t,",").concat(r+s*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+l*x,",").concat(r,`
            L `).concat(t+n-l*x,",").concat(r,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+n,",").concat(r+s*x,`
            L `).concat(t+n,",").concat(r+a-s*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+n-l*x,",").concat(r+a,`
            L `).concat(t+l*x,",").concat(r+a,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t,",").concat(r+a-s*x," Z")}else d="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return d},See=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,i=r.x,o=r.y,s=r.width,l=r.height;if(Math.abs(s)>0&&Math.abs(l)>0){var u=Math.min(i,i+s),d=Math.max(i,i+s),f=Math.min(o,o+l),h=Math.max(o,o+l);return n>=u&&n<=d&&a>=f&&a<=h}return!1},Mee={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},rw=function(t){var r=dM(dM({},Mee),t),n=j.useRef(),a=j.useState(-1),i=mee(a,2),o=i[0],s=i[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var S=n.current.getTotalLength();S&&s(S)}catch{}},[]);var l=r.x,u=r.y,d=r.width,f=r.height,h=r.radius,p=r.className,x=r.animationEasing,g=r.animationDuration,b=r.animationBegin,y=r.isAnimationActive,m=r.isUpdateAnimationActive;if(l!==+l||u!==+u||d!==+d||f!==+f||d===0||f===0)return null;var k=kr("recharts-rectangle",p);return m?ee.createElement(Bi,{canBegin:o>0,from:{width:d,height:f,x:l,y:u},to:{width:d,height:f,x:l,y:u},duration:g,animationEasing:x,isActive:m},function(S){var w=S.width,v=S.height,M=S.x,N=S.y;return ee.createElement(Bi,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:b,duration:g,isActive:y,easing:x},ee.createElement("path",Hp({},Qt(r,!0),{className:k,d:fM(M,N,w,v,h),ref:n})))}):ee.createElement("path",Hp({},Qt(r,!0),{className:k,d:fM(l,u,d,f,h)}))};function xb(){return xb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xb.apply(this,arguments)}var gg=function(t){var r=t.cx,n=t.cy,a=t.r,i=t.className,o=kr("recharts-dot",i);return r===+r&&n===+n&&a===+a?j.createElement("circle",xb({},Qt(t,!1),up(t),{className:o,cx:r,cy:n,r:a})):null};function Uf(e){"@babel/helpers - typeof";return Uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uf(e)}var jee=["x","y","top","left","width","height","className"];function yb(){return yb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yb.apply(this,arguments)}function hM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Nee(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?hM(Object(r),!0).forEach(function(n){_ee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):hM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function _ee(e,t,r){return t=Pee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Pee(e){var t=Cee(e,"string");return Uf(t)=="symbol"?t:t+""}function Cee(e,t){if(Uf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Uf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Aee(e,t){if(e==null)return{};var r=Oee(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Oee(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Tee=function(t,r,n,a,i,o){return"M".concat(t,",").concat(i,"v").concat(a,"M").concat(o,",").concat(r,"h").concat(n)},Eee=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,i=a===void 0?0:a,o=t.top,s=o===void 0?0:o,l=t.left,u=l===void 0?0:l,d=t.width,f=d===void 0?0:d,h=t.height,p=h===void 0?0:h,x=t.className,g=Aee(t,jee),b=Nee({x:n,y:i,top:s,left:u,width:f,height:p},g);return!Ge(n)||!Ge(i)||!Ge(f)||!Ge(p)||!Ge(s)||!Ge(u)?null:ee.createElement("path",yb({},Qt(b,!0),{className:kr("recharts-cross",x),d:Tee(n,i,f,p,s,u)}))},Iee=yP,Ree=Iee(Object.getPrototypeOf,Object),Dee=Ree,$ee=zo,Lee=Dee,Fee=Wo,Bee="[object Object]",Gee=Function.prototype,Uee=Object.prototype,nA=Gee.toString,zee=Uee.hasOwnProperty,Wee=nA.call(Object);function Vee(e){if(!Fee(e)||$ee(e)!=Bee)return!1;var t=Lee(e);if(t===null)return!0;var r=zee.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&nA.call(r)==Wee}var Hee=Vee;const Xee=Vr(Hee);var Kee=zo,Yee=Wo,qee="[object Boolean]";function Zee(e){return e===!0||e===!1||Yee(e)&&Kee(e)==qee}var Jee=Zee;const Qee=Vr(Jee);function zf(e){"@babel/helpers - typeof";return zf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zf(e)}function Xp(){return Xp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xp.apply(this,arguments)}function ete(e,t){return ate(e)||nte(e,t)||rte(e,t)||tte()}function tte(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rte(e,t){if(e){if(typeof e=="string")return pM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return pM(e,t)}}function pM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function nte(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function ate(e){if(Array.isArray(e))return e}function mM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function gM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?mM(Object(r),!0).forEach(function(n){ite(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ite(e,t,r){return t=ote(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ote(e){var t=ste(e,"string");return zf(t)=="symbol"?t:t+""}function ste(e,t){if(zf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(zf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var xM=function(t,r,n,a,i){var o=n-a,s;return s="M ".concat(t,",").concat(r),s+="L ".concat(t+n,",").concat(r),s+="L ".concat(t+n-o/2,",").concat(r+i),s+="L ".concat(t+n-o/2-a,",").concat(r+i),s+="L ".concat(t,",").concat(r," Z"),s},lte={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},cte=function(t){var r=gM(gM({},lte),t),n=j.useRef(),a=j.useState(-1),i=ete(a,2),o=i[0],s=i[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var k=n.current.getTotalLength();k&&s(k)}catch{}},[]);var l=r.x,u=r.y,d=r.upperWidth,f=r.lowerWidth,h=r.height,p=r.className,x=r.animationEasing,g=r.animationDuration,b=r.animationBegin,y=r.isUpdateAnimationActive;if(l!==+l||u!==+u||d!==+d||f!==+f||h!==+h||d===0&&f===0||h===0)return null;var m=kr("recharts-trapezoid",p);return y?ee.createElement(Bi,{canBegin:o>0,from:{upperWidth:0,lowerWidth:0,height:h,x:l,y:u},to:{upperWidth:d,lowerWidth:f,height:h,x:l,y:u},duration:g,animationEasing:x,isActive:y},function(k){var S=k.upperWidth,w=k.lowerWidth,v=k.height,M=k.x,N=k.y;return ee.createElement(Bi,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:b,duration:g,easing:x},ee.createElement("path",Xp({},Qt(r,!0),{className:m,d:xM(M,N,S,w,v),ref:n})))}):ee.createElement("g",null,ee.createElement("path",Xp({},Qt(r,!0),{className:m,d:xM(l,u,d,f,h)})))},ute=["option","shapeType","propTransformer","activeClassName","isActive"];function Wf(e){"@babel/helpers - typeof";return Wf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wf(e)}function dte(e,t){if(e==null)return{};var r=fte(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function fte(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function yM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?yM(Object(r),!0).forEach(function(n){hte(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function hte(e,t,r){return t=pte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function pte(e){var t=mte(e,"string");return Wf(t)=="symbol"?t:t+""}function mte(e,t){if(Wf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Wf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function gte(e,t){return Kp(Kp({},t),e)}function xte(e,t){return e==="symbols"}function bM(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return ee.createElement(rw,r);case"trapezoid":return ee.createElement(cte,r);case"sector":return ee.createElement(HC,r);case"symbols":if(xte(t))return ee.createElement(ng,r);break;default:return null}}function yte(e){return j.isValidElement(e)?e.props:e}function bb(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?gte:n,i=e.activeClassName,o=i===void 0?"recharts-active-shape":i,s=e.isActive,l=dte(e,ute),u;if(j.isValidElement(t))u=j.cloneElement(t,Kp(Kp({},l),yte(t)));else if(ar(t))u=t(l);else if(Xee(t)&&!Qee(t)){var d=a(t,l);u=ee.createElement(bM,{shapeType:r,elementProps:d})}else{var f=l;u=ee.createElement(bM,{shapeType:r,elementProps:f})}return s?ee.createElement(Er,{className:o},u):u}function xg(e,t){return t!=null&&"trapezoids"in e.props}function yg(e,t){return t!=null&&"sectors"in e.props}function Vf(e,t){return t!=null&&"points"in e.props}function bte(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,i=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&i}function vte(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function wte(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function kte(e,t){var r;return xg(e,t)?r=bte:yg(e,t)?r=vte:Vf(e,t)&&(r=wte),r}function Ste(e,t){var r;return xg(e,t)?r="trapezoids":yg(e,t)?r="sectors":Vf(e,t)&&(r="points"),r}function Mte(e,t){if(xg(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(yg(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return Vf(e,t)?t.payload:{}}function jte(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=Ste(r,t),i=Mte(r,t),o=n.filter(function(l,u){var d=zl(i,l),f=r.props[a].filter(function(x){var g=kte(r,t);return g(x,t)}),h=r.props[a].indexOf(f[f.length-1]),p=u===h;return d&&p}),s=n.indexOf(o[o.length-1]);return s}var Nte=Math.ceil,_te=Math.max;function Pte(e,t,r,n){for(var a=-1,i=_te(Nte((t-e)/(r||1)),0),o=Array(i);i--;)o[n?i:++a]=e,e+=r;return o}var Cte=Pte,Ate=$P,vM=1/0,Ote=17976931348623157e292;function Tte(e){if(!e)return e===0?e:0;if(e=Ate(e),e===vM||e===-vM){var t=e<0?-1:1;return t*Ote}return e===e?e:0}var aA=Tte,Ete=Cte,Ite=og,Qx=aA;function Rte(e){return function(t,r,n){return n&&typeof n!="number"&&Ite(t,r,n)&&(r=n=void 0),t=Qx(t),r===void 0?(r=t,t=0):r=Qx(r),n=n===void 0?t<r?1:-1:Qx(n),Ete(t,r,n,e)}}var Dte=Rte,$te=Dte,Lte=$te(),Fte=Lte;const Yp=Vr(Fte);function Hf(e){"@babel/helpers - typeof";return Hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hf(e)}function wM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function kM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?wM(Object(r),!0).forEach(function(n){iA(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iA(e,t,r){return t=Bte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bte(e){var t=Gte(e,"string");return Hf(t)=="symbol"?t:t+""}function Gte(e,t){if(Hf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Hf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Ute=["Webkit","Moz","O","ms"],zte=function(t,r){var n=t.replace(/(\w)/,function(i){return i.toUpperCase()}),a=Ute.reduce(function(i,o){return kM(kM({},i),{},iA({},o+n,r))},{});return a[t]=r,a};function hu(e){"@babel/helpers - typeof";return hu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hu(e)}function qp(){return qp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qp.apply(this,arguments)}function SM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ey(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?SM(Object(r),!0).forEach(function(n){Ha(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):SM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Wte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function MM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,sA(n.key),n)}}function Vte(e,t,r){return t&&MM(e.prototype,t),r&&MM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Hte(e,t,r){return t=Zp(t),Xte(e,oA()?Reflect.construct(t,r||[],Zp(e).constructor):t.apply(e,r))}function Xte(e,t){if(t&&(hu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kte(e)}function Kte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(oA=function(){return!!e})()}function Zp(e){return Zp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Zp(e)}function Yte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vb(e,t)}function vb(e,t){return vb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},vb(e,t)}function Ha(e,t,r){return t=sA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sA(e){var t=qte(e,"string");return hu(t)=="symbol"?t:t+""}function qte(e,t){if(hu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Zte=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,i=t.x,o=t.width,s=t.travellerWidth;if(!r||!r.length)return{};var l=r.length,u=Wd().domain(Yp(0,l)).range([i,i+o-s]),d=u.domain().map(function(f){return u(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:u(n),endX:u(a),scale:u,scaleValues:d}},jM=function(t){return t.changedTouches&&!!t.changedTouches.length},pu=function(e){function t(r){var n;return Wte(this,t),n=Hte(this,t,[r]),Ha(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),Ha(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),Ha(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,i=a.endIndex,o=a.onDragEnd,s=a.startIndex;o==null||o({endIndex:i,startIndex:s})}),n.detachDragEndListener()}),Ha(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),Ha(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),Ha(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),Ha(n,"handleSlideDragStart",function(a){var i=jM(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:i.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return Yte(t,e),Vte(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,i=n.endX,o=this.state.scaleValues,s=this.props,l=s.gap,u=s.data,d=u.length-1,f=Math.min(a,i),h=Math.max(a,i),p=t.getIndexInRange(o,f),x=t.getIndexInRange(o,h);return{startIndex:p-p%l,endIndex:x===d?d:x-x%l}}},{key:"getTextOfTick",value:function(n){var a=this.props,i=a.data,o=a.tickFormatter,s=a.dataKey,l=Gn(i[n],s,n);return ar(o)?o(l,n):l}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,i=a.slideMoveStartX,o=a.startX,s=a.endX,l=this.props,u=l.x,d=l.width,f=l.travellerWidth,h=l.startIndex,p=l.endIndex,x=l.onChange,g=n.pageX-i;g>0?g=Math.min(g,u+d-f-s,u+d-f-o):g<0&&(g=Math.max(g,u-o,u-s));var b=this.getIndex({startX:o+g,endX:s+g});(b.startIndex!==h||b.endIndex!==p)&&x&&x(b),this.setState({startX:o+g,endX:s+g,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var i=jM(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:i.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,i=a.brushMoveStartX,o=a.movingTravellerId,s=a.endX,l=a.startX,u=this.state[o],d=this.props,f=d.x,h=d.width,p=d.travellerWidth,x=d.onChange,g=d.gap,b=d.data,y={startX:this.state.startX,endX:this.state.endX},m=n.pageX-i;m>0?m=Math.min(m,f+h-p-u):m<0&&(m=Math.max(m,f-u)),y[o]=u+m;var k=this.getIndex(y),S=k.startIndex,w=k.endIndex,v=function(){var N=b.length-1;return o==="startX"&&(s>l?S%g===0:w%g===0)||s<l&&w===N||o==="endX"&&(s>l?w%g===0:S%g===0)||s>l&&w===N};this.setState(Ha(Ha({},o,u+m),"brushMoveStartX",n.pageX),function(){x&&v()&&x(k)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var i=this,o=this.state,s=o.scaleValues,l=o.startX,u=o.endX,d=this.state[a],f=s.indexOf(d);if(f!==-1){var h=f+n;if(!(h===-1||h>=s.length)){var p=s[h];a==="startX"&&p>=u||a==="endX"&&p<=l||this.setState(Ha({},a,p),function(){i.props.onChange(i.getIndex({startX:i.state.startX,endX:i.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.fill,u=n.stroke;return ee.createElement("rect",{stroke:u,fill:l,x:a,y:i,width:o,height:s})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.data,u=n.children,d=n.padding,f=j.Children.only(u);return f?ee.cloneElement(f,{x:a,y:i,width:o,height:s,margin:d,compact:!0,data:l}):null}},{key:"renderTravellerLayer",value:function(n,a){var i,o,s=this,l=this.props,u=l.y,d=l.travellerWidth,f=l.height,h=l.traveller,p=l.ariaLabel,x=l.data,g=l.startIndex,b=l.endIndex,y=Math.max(n,this.props.x),m=ey(ey({},Qt(this.props,!1)),{},{x:y,y:u,width:d,height:f}),k=p||"Min value: ".concat((i=x[g])===null||i===void 0?void 0:i.name,", Max value: ").concat((o=x[b])===null||o===void 0?void 0:o.name);return ee.createElement(Er,{tabIndex:0,role:"slider","aria-label":k,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(w){["ArrowLeft","ArrowRight"].includes(w.key)&&(w.preventDefault(),w.stopPropagation(),s.handleTravellerMoveKeyboard(w.key==="ArrowRight"?1:-1,a))},onFocus:function(){s.setState({isTravellerFocused:!0})},onBlur:function(){s.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,m))}},{key:"renderSlide",value:function(n,a){var i=this.props,o=i.y,s=i.height,l=i.stroke,u=i.travellerWidth,d=Math.min(n,a)+u,f=Math.max(Math.abs(a-n)-u,0);return ee.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:l,fillOpacity:.2,x:d,y:o,width:f,height:s})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,i=n.endIndex,o=n.y,s=n.height,l=n.travellerWidth,u=n.stroke,d=this.state,f=d.startX,h=d.endX,p=5,x={pointerEvents:"none",fill:u};return ee.createElement(Er,{className:"recharts-brush-texts"},ee.createElement(Mp,qp({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-p,y:o+s/2},x),this.getTextOfTick(a)),ee.createElement(Mp,qp({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+l+p,y:o+s/2},x),this.getTextOfTick(i)))}},{key:"render",value:function(){var n=this.props,a=n.data,i=n.className,o=n.children,s=n.x,l=n.y,u=n.width,d=n.height,f=n.alwaysShowText,h=this.state,p=h.startX,x=h.endX,g=h.isTextActive,b=h.isSlideMoving,y=h.isTravellerMoving,m=h.isTravellerFocused;if(!a||!a.length||!Ge(s)||!Ge(l)||!Ge(u)||!Ge(d)||u<=0||d<=0)return null;var k=kr("recharts-brush",i),S=ee.Children.count(o)===1,w=zte("userSelect","none");return ee.createElement(Er,{className:k,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:w},this.renderBackground(),S&&this.renderPanorama(),this.renderSlide(p,x),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(x,"endX"),(g||b||y||m||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,i=n.y,o=n.width,s=n.height,l=n.stroke,u=Math.floor(i+s/2)-1;return ee.createElement(ee.Fragment,null,ee.createElement("rect",{x:a,y:i,width:o,height:s,fill:l,stroke:"none"}),ee.createElement("line",{x1:a+1,y1:u,x2:a+o-1,y2:u,fill:"none",stroke:"#fff"}),ee.createElement("line",{x1:a+1,y1:u+2,x2:a+o-1,y2:u+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var i;return ee.isValidElement(n)?i=ee.cloneElement(n,a):ar(n)?i=n(a):i=t.renderDefaultTraveller(a),i}},{key:"getDerivedStateFromProps",value:function(n,a){var i=n.data,o=n.width,s=n.x,l=n.travellerWidth,u=n.updateId,d=n.startIndex,f=n.endIndex;if(i!==a.prevData||u!==a.prevUpdateId)return ey({prevData:i,prevTravellerWidth:l,prevUpdateId:u,prevX:s,prevWidth:o},i&&i.length?Zte({data:i,width:o,x:s,travellerWidth:l,startIndex:d,endIndex:f}):{scale:null,scaleValues:null});if(a.scale&&(o!==a.prevWidth||s!==a.prevX||l!==a.prevTravellerWidth)){a.scale.range([s,s+o-l]);var h=a.scale.domain().map(function(p){return a.scale(p)});return{prevData:i,prevTravellerWidth:l,prevUpdateId:u,prevX:s,prevWidth:o,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,a){for(var i=n.length,o=0,s=i-1;s-o>1;){var l=Math.floor((o+s)/2);n[l]>a?s=l:o=l}return a>=n[s]?s:o}}])}(j.PureComponent);Ha(pu,"displayName","Brush");Ha(pu,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Jte=_2;function Qte(e,t){var r;return Jte(e,function(n,a,i){return r=t(n,a,i),!r}),!!r}var ere=Qte,tre=uP,rre=Vs,nre=ere,are=Ba,ire=og;function ore(e,t,r){var n=are(e)?tre:nre;return r&&ire(e,t,r)&&(t=void 0),n(e,rre(t))}var sre=ore;const lre=Vr(sre);var io=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},NM=TP;function cre(e,t,r){t=="__proto__"&&NM?NM(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var ure=cre,dre=ure,fre=AP,hre=Vs;function pre(e,t){var r={};return t=hre(t),fre(e,function(n,a,i){dre(r,a,t(n,a,i))}),r}var mre=pre;const gre=Vr(mre);function xre(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var yre=xre,bre=_2;function vre(e,t){var r=!0;return bre(e,function(n,a,i){return r=!!t(n,a,i),r}),r}var wre=vre,kre=yre,Sre=wre,Mre=Vs,jre=Ba,Nre=og;function _re(e,t,r){var n=jre(e)?kre:Sre;return r&&Nre(e,t,r)&&(t=void 0),n(e,Mre(t))}var Pre=_re;const lA=Vr(Pre);var Cre=["x","y"];function Xf(e){"@babel/helpers - typeof";return Xf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xf(e)}function wb(){return wb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wb.apply(this,arguments)}function _M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_M(Object(r),!0).forEach(function(n){Are(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_M(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Are(e,t,r){return t=Ore(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ore(e){var t=Tre(e,"string");return Xf(t)=="symbol"?t:t+""}function Tre(e,t){if(Xf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Xf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Ere(e,t){if(e==null)return{};var r=Ire(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Ire(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Rre(e,t){var r=e.x,n=e.y,a=Ere(e,Cre),i="".concat(r),o=parseInt(i,10),s="".concat(n),l=parseInt(s,10),u="".concat(t.height||a.height),d=parseInt(u,10),f="".concat(t.width||a.width),h=parseInt(f,10);return jd(jd(jd(jd(jd({},t),a),o?{x:o}:{}),l?{y:l}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function PM(e){return ee.createElement(bb,wb({shapeType:"rectangle",propTransformer:Rre,activeClassName:"recharts-active-bar"},e))}var Dre=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var i=Ge(n)||q$(n);return i?t(n,a):(i||Vl(),r)}},$re=["value","background"],cA;function mu(e){"@babel/helpers - typeof";return mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mu(e)}function Lre(e,t){if(e==null)return{};var r=Fre(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Fre(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Jp(){return Jp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Jp.apply(this,arguments)}function CM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _n(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?CM(Object(r),!0).forEach(function(n){ks(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):CM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function AM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,dA(n.key),n)}}function Gre(e,t,r){return t&&AM(e.prototype,t),r&&AM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Ure(e,t,r){return t=Qp(t),zre(e,uA()?Reflect.construct(t,r||[],Qp(e).constructor):t.apply(e,r))}function zre(e,t){if(t&&(mu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Wre(e)}function Wre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function uA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(uA=function(){return!!e})()}function Qp(e){return Qp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Qp(e)}function Vre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kb(e,t)}function kb(e,t){return kb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},kb(e,t)}function ks(e,t,r){return t=dA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function dA(e){var t=Hre(e,"string");return mu(t)=="symbol"?t:t+""}function Hre(e,t){if(mu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var c0=function(e){function t(){var r;Bre(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Ure(this,t,[].concat(a)),ks(r,"state",{isAnimationFinished:!1}),ks(r,"id",Jl("recharts-bar-")),ks(r,"handleAnimationEnd",function(){var o=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),o&&o()}),ks(r,"handleAnimationStart",function(){var o=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),o&&o()}),r}return Vre(t,e),Gre(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,i=this.props,o=i.shape,s=i.dataKey,l=i.activeIndex,u=i.activeBar,d=Qt(this.props,!1);return n&&n.map(function(f,h){var p=h===l,x=p?u:o,g=_n(_n(_n({},d),f),{},{isActive:p,option:x,index:h,dataKey:s,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return ee.createElement(Er,Jp({className:"recharts-bar-rectangle"},gf(a.props,f,h),{key:"rectangle-".concat(f==null?void 0:f.x,"-").concat(f==null?void 0:f.y,"-").concat(f==null?void 0:f.value,"-").concat(h)}),ee.createElement(PM,g))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,i=a.data,o=a.layout,s=a.isAnimationActive,l=a.animationBegin,u=a.animationDuration,d=a.animationEasing,f=a.animationId,h=this.state.prevData;return ee.createElement(Bi,{begin:l,duration:u,isActive:s,easing:d,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var x=p.t,g=i.map(function(b,y){var m=h&&h[y];if(m){var k=wn(m.x,b.x),S=wn(m.y,b.y),w=wn(m.width,b.width),v=wn(m.height,b.height);return _n(_n({},b),{},{x:k(x),y:S(x),width:w(x),height:v(x)})}if(o==="horizontal"){var M=wn(0,b.height),N=M(x);return _n(_n({},b),{},{y:b.y+b.height-N,height:N})}var _=wn(0,b.width),P=_(x);return _n(_n({},b),{},{width:P})});return ee.createElement(Er,null,n.renderRectanglesStatically(g))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,i=n.isAnimationActive,o=this.state.prevData;return i&&a&&a.length&&(!o||!zl(o,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,i=a.data,o=a.dataKey,s=a.activeIndex,l=Qt(this.props.background,!1);return i.map(function(u,d){u.value;var f=u.background,h=Lre(u,$re);if(!f)return null;var p=_n(_n(_n(_n(_n({},h),{},{fill:"#eee"},f),l),gf(n.props,u,d)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:o,index:d,className:"recharts-bar-background-rectangle"});return ee.createElement(PM,Jp({key:"background-bar-".concat(d),option:n.props.background,isActive:d===s},p))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.data,s=i.xAxis,l=i.yAxis,u=i.layout,d=i.children,f=Fa(d,Yu);if(!f)return null;var h=u==="vertical"?o[0].height/2:o[0].width/2,p=function(b,y){var m=Array.isArray(b.value)?b.value[1]:b.value;return{x:b.x,y:b.y,value:m,errorVal:Gn(b,y)}},x={clipPath:n?"url(#clipPath-".concat(a,")"):null};return ee.createElement(Er,x,f.map(function(g){return ee.cloneElement(g,{key:"error-bar-".concat(a,"-").concat(g.props.dataKey),data:o,xAxis:s,yAxis:l,layout:u,offset:h,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,i=n.data,o=n.className,s=n.xAxis,l=n.yAxis,u=n.left,d=n.top,f=n.width,h=n.height,p=n.isAnimationActive,x=n.background,g=n.id;if(a||!i||!i.length)return null;var b=this.state.isAnimationFinished,y=kr("recharts-bar",o),m=s&&s.allowDataOverflow,k=l&&l.allowDataOverflow,S=m||k,w=Yt(g)?this.id:g;return ee.createElement(Er,{className:y},m||k?ee.createElement("defs",null,ee.createElement("clipPath",{id:"clipPath-".concat(w)},ee.createElement("rect",{x:m?u:u-f/2,y:k?d:d-h/2,width:m?f:f*2,height:k?h:h*2}))):null,ee.createElement(Er,{className:"recharts-bar-rectangles",clipPath:S?"url(#clipPath-".concat(w,")"):null},x?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(S,w),(!p||b)&&ao.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(j.PureComponent);cA=c0;ks(c0,"displayName","Bar");ks(c0,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Hs.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});ks(c0,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,i=e.xAxis,o=e.yAxis,s=e.xAxisTicks,l=e.yAxisTicks,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=bZ(n,r);if(!p)return null;var x=t.layout,g=r.type.defaultProps,b=g!==void 0?_n(_n({},g),r.props):r.props,y=b.dataKey,m=b.children,k=b.minPointSize,S=x==="horizontal"?o:i,w=u?S.scale.domain():null,v=_Z({numericAxis:S}),M=Fa(m,A2),N=f.map(function(_,P){var E,R,T,G,L,C;u?E=vZ(u[d+P],w):(E=Gn(_,y),Array.isArray(E)||(E=[v,E]));var $=Dre(k,cA.defaultProps.minPointSize)(E[1],P);if(x==="horizontal"){var A,O=[o.scale(E[0]),o.scale(E[1])],F=O[0],D=O[1];R=T5({axis:i,ticks:s,bandSize:a,offset:p.offset,entry:_,index:P}),T=(A=D??F)!==null&&A!==void 0?A:void 0,G=p.size;var W=F-D;if(L=Number.isNaN(W)?0:W,C={x:R,y:o.y,width:G,height:o.height},Math.abs($)>0&&Math.abs(L)<Math.abs($)){var H=Ri(L||$)*(Math.abs($)-Math.abs(L));T-=H,L+=H}}else{var Y=[i.scale(E[0]),i.scale(E[1])],te=Y[0],U=Y[1];if(R=te,T=T5({axis:o,ticks:l,bandSize:a,offset:p.offset,entry:_,index:P}),G=U-te,L=p.size,C={x:i.x,y:T,width:i.width,height:L},Math.abs($)>0&&Math.abs(G)<Math.abs($)){var Se=Ri(G||$)*(Math.abs($)-Math.abs(G));G+=Se}}return _n(_n(_n({},_),{},{x:R,y:T,width:G,height:L,value:u?E:E[1],payload:_,background:C},M&&M[P]&&M[P].props),{},{tooltipPayload:[zC(r,_)],tooltipPosition:{x:R+G/2,y:T+L/2}})});return _n({data:N,layout:x},h)});function Kf(e){"@babel/helpers - typeof";return Kf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Kf(e)}function Xre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function OM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fA(n.key),n)}}function Kre(e,t,r){return t&&OM(e.prototype,t),r&&OM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function TM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ai(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?TM(Object(r),!0).forEach(function(n){bg(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):TM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bg(e,t,r){return t=fA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fA(e){var t=Yre(e,"string");return Kf(t)=="symbol"?t:t+""}function Yre(e,t){if(Kf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Kf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var nw=function(t,r,n,a,i){var o=t.width,s=t.height,l=t.layout,u=t.children,d=Object.keys(r),f={left:n.left,leftMirror:n.left,right:o-n.right,rightMirror:o-n.right,top:n.top,topMirror:n.top,bottom:s-n.bottom,bottomMirror:s-n.bottom},h=!!Ka(u,c0);return d.reduce(function(p,x){var g=r[x],b=g.orientation,y=g.domain,m=g.padding,k=m===void 0?{}:m,S=g.mirror,w=g.reversed,v="".concat(b).concat(S?"Mirror":""),M,N,_,P,E;if(g.type==="number"&&(g.padding==="gap"||g.padding==="no-gap")){var R=y[1]-y[0],T=1/0,G=g.categoricalDomain.sort(e9);if(G.forEach(function(Y,te){te>0&&(T=Math.min((Y||0)-(G[te-1]||0),T))}),Number.isFinite(T)){var L=T/R,C=g.layout==="vertical"?n.height:n.width;if(g.padding==="gap"&&(M=L*C/2),g.padding==="no-gap"){var $=Ul(t.barCategoryGap,L*C),A=L*C/2;M=A-$-(A-$)/C*$}}}a==="xAxis"?N=[n.left+(k.left||0)+(M||0),n.left+n.width-(k.right||0)-(M||0)]:a==="yAxis"?N=l==="horizontal"?[n.top+n.height-(k.bottom||0),n.top+(k.top||0)]:[n.top+(k.top||0)+(M||0),n.top+n.height-(k.bottom||0)-(M||0)]:N=g.range,w&&(N=[N[1],N[0]]);var O=xZ(g,i,h),F=O.scale,D=O.realScaleType;F.domain(y).range(N),yZ(F);var W=NZ(F,Ai(Ai({},g),{},{realScaleType:D}));a==="xAxis"?(E=b==="top"&&!S||b==="bottom"&&S,_=n.left,P=f[v]-E*g.height):a==="yAxis"&&(E=b==="left"&&!S||b==="right"&&S,_=f[v]-E*g.width,P=n.top);var H=Ai(Ai(Ai({},g),W),{},{realScaleType:D,x:_,y:P,scale:F,width:a==="xAxis"?n.width:g.width,height:a==="yAxis"?n.height:g.height});return H.bandSize=Fp(H,W),!g.hide&&a==="xAxis"?f[v]+=(E?-1:1)*H.height:g.hide||(f[v]+=(E?-1:1)*H.width),Ai(Ai({},p),{},bg({},x,H))},{})},hA=function(t,r){var n=t.x,a=t.y,i=r.x,o=r.y;return{x:Math.min(n,i),y:Math.min(a,o),width:Math.abs(i-n),height:Math.abs(o-a)}},qre=function(t){var r=t.x1,n=t.y1,a=t.x2,i=t.y2;return hA({x:r,y:n},{x:a,y:i})},pA=function(){function e(t){Xre(this,e),this.scale=t}return Kre(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,i=n.position;if(r!==void 0){if(i)switch(i){case"start":return this.scale(r);case"middle":{var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+o}case"end":{var s=this.bandwidth?this.bandwidth():0;return this.scale(r)+s}default:return this.scale(r)}if(a){var l=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+l}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],i=n[n.length-1];return a<=i?r>=a&&r<=i:r>=i&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();bg(pA,"EPS",1e-4);var aw=function(t){var r=Object.keys(t).reduce(function(n,a){return Ai(Ai({},n),{},bg({},a,pA.create(t[a])))},{});return Ai(Ai({},r),{},{apply:function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.bandAware,s=i.position;return gre(a,function(l,u){return r[u].apply(l,{bandAware:o,position:s})})},isInRange:function(a){return lA(a,function(i,o){return r[o].isInRange(i)})}})};function Zre(e){return(e%180+180)%180}var Jre=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=Zre(a),o=i*Math.PI/180,s=Math.atan(n/r),l=o>s&&o<Math.PI-s?n/Math.sin(o):r/Math.cos(o);return Math.abs(l)},Qre=Vs,ene=a0,tne=ag;function rne(e){return function(t,r,n){var a=Object(t);if(!ene(t)){var i=Qre(r);t=tne(t),r=function(s){return i(a[s],s,a)}}var o=e(t,r,n);return o>-1?a[i?t[o]:o]:void 0}}var nne=rne,ane=aA;function ine(e){var t=ane(e),r=t%1;return t===t?r?t-r:t:0}var one=ine,sne=MP,lne=Vs,cne=one,une=Math.max;function dne(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var a=r==null?0:cne(r);return a<0&&(a=une(n+a,0)),sne(e,lne(t),a)}var fne=dne,hne=nne,pne=fne,mne=hne(pne),gne=mne;const xne=Vr(gne);var yne=r$(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),iw=j.createContext(void 0),ow=j.createContext(void 0),mA=j.createContext(void 0),gA=j.createContext({}),xA=j.createContext(void 0),yA=j.createContext(0),bA=j.createContext(0),EM=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,i=r.offset,o=t.clipPathId,s=t.children,l=t.width,u=t.height,d=yne(i);return ee.createElement(iw.Provider,{value:n},ee.createElement(ow.Provider,{value:a},ee.createElement(gA.Provider,{value:i},ee.createElement(mA.Provider,{value:d},ee.createElement(xA.Provider,{value:o},ee.createElement(yA.Provider,{value:u},ee.createElement(bA.Provider,{value:l},s)))))))},bne=function(){return j.useContext(xA)},vA=function(t){var r=j.useContext(iw);r==null&&Vl();var n=r[t];return n==null&&Vl(),n},vne=function(){var t=j.useContext(iw);return hs(t)},wne=function(){var t=j.useContext(ow),r=xne(t,function(n){return lA(n.domain,Number.isFinite)});return r||hs(t)},wA=function(t){var r=j.useContext(ow);r==null&&Vl();var n=r[t];return n==null&&Vl(),n},kne=function(){var t=j.useContext(mA);return t},Sne=function(){return j.useContext(gA)},sw=function(){return j.useContext(bA)},lw=function(){return j.useContext(yA)};function gu(e){"@babel/helpers - typeof";return gu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gu(e)}function Mne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function jne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,SA(n.key),n)}}function Nne(e,t,r){return t&&jne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function _ne(e,t,r){return t=em(t),Pne(e,kA()?Reflect.construct(t,r||[],em(e).constructor):t.apply(e,r))}function Pne(e,t){if(t&&(gu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cne(e)}function Cne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kA=function(){return!!e})()}function em(e){return em=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},em(e)}function Ane(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Sb(e,t)}function Sb(e,t){return Sb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Sb(e,t)}function IM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function RM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?IM(Object(r),!0).forEach(function(n){cw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):IM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cw(e,t,r){return t=SA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SA(e){var t=One(e,"string");return gu(t)=="symbol"?t:t+""}function One(e,t){if(gu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Tne(e,t){return Dne(e)||Rne(e,t)||Ine(e,t)||Ene()}function Ene(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ine(e,t){if(e){if(typeof e=="string")return DM(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return DM(e,t)}}function DM(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Rne(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function Dne(e){if(Array.isArray(e))return e}function Mb(){return Mb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mb.apply(this,arguments)}var $ne=function(t,r){var n;return ee.isValidElement(t)?n=ee.cloneElement(t,r):ar(t)?n=t(r):n=ee.createElement("line",Mb({},r,{className:"recharts-reference-line-line"})),n},Lne=function(t,r,n,a,i,o,s,l,u){var d=i.x,f=i.y,h=i.width,p=i.height;if(n){var x=u.y,g=t.y.apply(x,{position:o});if(io(u,"discard")&&!t.y.isInRange(g))return null;var b=[{x:d+h,y:g},{x:d,y:g}];return l==="left"?b.reverse():b}if(r){var y=u.x,m=t.x.apply(y,{position:o});if(io(u,"discard")&&!t.x.isInRange(m))return null;var k=[{x:m,y:f+p},{x:m,y:f}];return s==="top"?k.reverse():k}if(a){var S=u.segment,w=S.map(function(v){return t.apply(v,{position:o})});return io(u,"discard")&&lre(w,function(v){return!t.isInRange(v)})?null:w}return null};function Fne(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,i=e.yAxisId,o=e.shape,s=e.className,l=e.alwaysShow,u=bne(),d=vA(a),f=wA(i),h=kne();if(!u||!h)return null;To(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var p=aw({x:d.scale,y:f.scale}),x=Bn(t),g=Bn(r),b=n&&n.length===2,y=Lne(p,x,g,b,h,e.position,d.orientation,f.orientation,e);if(!y)return null;var m=Tne(y,2),k=m[0],S=k.x,w=k.y,v=m[1],M=v.x,N=v.y,_=io(e,"hidden")?"url(#".concat(u,")"):void 0,P=RM(RM({clipPath:_},Qt(e,!0)),{},{x1:S,y1:w,x2:M,y2:N});return ee.createElement(Er,{className:kr("recharts-reference-line",s)},$ne(o,P),Jn.renderCallByParent(e,qre({x1:S,y1:w,x2:M,y2:N})))}var Ss=function(e){function t(){return Mne(this,t),_ne(this,t,arguments)}return Ane(t,e),Nne(t,[{key:"render",value:function(){return ee.createElement(Fne,this.props)}}])}(ee.Component);cw(Ss,"displayName","ReferenceLine");cw(Ss,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function jb(){return jb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jb.apply(this,arguments)}function xu(e){"@babel/helpers - typeof";return xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xu(e)}function $M(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function LM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?$M(Object(r),!0).forEach(function(n){vg(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$M(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Bne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Gne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jA(n.key),n)}}function Une(e,t,r){return t&&Gne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function zne(e,t,r){return t=tm(t),Wne(e,MA()?Reflect.construct(t,r||[],tm(e).constructor):t.apply(e,r))}function Wne(e,t){if(t&&(xu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Vne(e)}function Vne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function MA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(MA=function(){return!!e})()}function tm(e){return tm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},tm(e)}function Hne(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Nb(e,t)}function Nb(e,t){return Nb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Nb(e,t)}function vg(e,t,r){return t=jA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jA(e){var t=Xne(e,"string");return xu(t)=="symbol"?t:t+""}function Xne(e,t){if(xu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Kne=function(t){var r=t.x,n=t.y,a=t.xAxis,i=t.yAxis,o=aw({x:a.scale,y:i.scale}),s=o.apply({x:r,y:n},{bandAware:!0});return io(t,"discard")&&!o.isInRange(s)?null:s},u0=function(e){function t(){return Bne(this,t),zne(this,t,arguments)}return Hne(t,e),Une(t,[{key:"render",value:function(){var n=this.props,a=n.x,i=n.y,o=n.r,s=n.alwaysShow,l=n.clipPathId,u=Bn(a),d=Bn(i);if(To(s===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!u||!d)return null;var f=Kne(this.props);if(!f)return null;var h=f.x,p=f.y,x=this.props,g=x.shape,b=x.className,y=io(this.props,"hidden")?"url(#".concat(l,")"):void 0,m=LM(LM({clipPath:y},Qt(this.props,!0)),{},{cx:h,cy:p});return ee.createElement(Er,{className:kr("recharts-reference-dot",b)},t.renderDot(g,m),Jn.renderCallByParent(this.props,{x:h-o,y:p-o,width:2*o,height:2*o}))}}])}(ee.Component);vg(u0,"displayName","ReferenceDot");vg(u0,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});vg(u0,"renderDot",function(e,t){var r;return ee.isValidElement(e)?r=ee.cloneElement(e,t):ar(e)?r=e(t):r=ee.createElement(gg,jb({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function _b(){return _b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_b.apply(this,arguments)}function yu(e){"@babel/helpers - typeof";return yu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yu(e)}function FM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function BM(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?FM(Object(r),!0).forEach(function(n){wg(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_A(n.key),n)}}function Zne(e,t,r){return t&&qne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Jne(e,t,r){return t=rm(t),Qne(e,NA()?Reflect.construct(t,r||[],rm(e).constructor):t.apply(e,r))}function Qne(e,t){if(t&&(yu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return eae(e)}function eae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function NA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(NA=function(){return!!e})()}function rm(e){return rm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},rm(e)}function tae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pb(e,t)}function Pb(e,t){return Pb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Pb(e,t)}function wg(e,t,r){return t=_A(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _A(e){var t=rae(e,"string");return yu(t)=="symbol"?t:t+""}function rae(e,t){if(yu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var nae=function(t,r,n,a,i){var o=i.x1,s=i.x2,l=i.y1,u=i.y2,d=i.xAxis,f=i.yAxis;if(!d||!f)return null;var h=aw({x:d.scale,y:f.scale}),p={x:t?h.x.apply(o,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(l,{position:"start"}):h.y.rangeMin},x={x:r?h.x.apply(s,{position:"end"}):h.x.rangeMax,y:a?h.y.apply(u,{position:"end"}):h.y.rangeMax};return io(i,"discard")&&(!h.isInRange(p)||!h.isInRange(x))?null:hA(p,x)},d0=function(e){function t(){return Yne(this,t),Jne(this,t,arguments)}return tae(t,e),Zne(t,[{key:"render",value:function(){var n=this.props,a=n.x1,i=n.x2,o=n.y1,s=n.y2,l=n.className,u=n.alwaysShow,d=n.clipPathId;To(u===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Bn(a),h=Bn(i),p=Bn(o),x=Bn(s),g=this.props.shape;if(!f&&!h&&!p&&!x&&!g)return null;var b=nae(f,h,p,x,this.props);if(!b&&!g)return null;var y=io(this.props,"hidden")?"url(#".concat(d,")"):void 0;return ee.createElement(Er,{className:kr("recharts-reference-area",l)},t.renderRect(g,BM(BM({clipPath:y},Qt(this.props,!0)),b)),Jn.renderCallByParent(this.props,b))}}])}(ee.Component);wg(d0,"displayName","ReferenceArea");wg(d0,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});wg(d0,"renderRect",function(e,t){var r;return ee.isValidElement(e)?r=ee.cloneElement(e,t):ar(e)?r=e(t):r=ee.createElement(rw,_b({},t,{className:"recharts-reference-area-rect"})),r});function PA(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function aae(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return Jre(n,r)}function iae(e,t,r){var n=r==="width",a=e.x,i=e.y,o=e.width,s=e.height;return t===1?{start:n?a:i,end:n?a+o:i+s}:{start:n?a+o:i+s,end:n?a:i}}function nm(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var i=r();return e*(t-e*i/2-n)>=0&&e*(t+e*i/2-a)<=0}function oae(e,t){return PA(e,t+1)}function sae(e,t,r,n,a){for(var i=(n||[]).slice(),o=t.start,s=t.end,l=0,u=1,d=o,f=function(){var x=n==null?void 0:n[l];if(x===void 0)return{v:PA(n,u)};var g=l,b,y=function(){return b===void 0&&(b=r(x,g)),b},m=x.coordinate,k=l===0||nm(e,m,y,d,s);k||(l=0,d=o,u+=1),k&&(d=m+e*(y()/2+a),l+=u)},h;u<=i.length;)if(h=f(),h)return h.v;return[]}function Yf(e){"@babel/helpers - typeof";return Yf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Yf(e)}function GM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function la(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?GM(Object(r),!0).forEach(function(n){lae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):GM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function lae(e,t,r){return t=cae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cae(e){var t=uae(e,"string");return Yf(t)=="symbol"?t:t+""}function uae(e,t){if(Yf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Yf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function dae(e,t,r,n,a){for(var i=(n||[]).slice(),o=i.length,s=t.start,l=t.end,u=function(h){var p=i[h],x,g=function(){return x===void 0&&(x=r(p,h)),x};if(h===o-1){var b=e*(p.coordinate+e*g()/2-l);i[h]=p=la(la({},p),{},{tickCoord:b>0?p.coordinate-b*e:p.coordinate})}else i[h]=p=la(la({},p),{},{tickCoord:p.coordinate});var y=nm(e,p.tickCoord,g,s,l);y&&(l=p.tickCoord-e*(g()/2+a),i[h]=la(la({},p),{},{isShow:!0}))},d=o-1;d>=0;d--)u(d);return i}function fae(e,t,r,n,a,i){var o=(n||[]).slice(),s=o.length,l=t.start,u=t.end;if(i){var d=n[s-1],f=r(d,s-1),h=e*(d.coordinate+e*f/2-u);o[s-1]=d=la(la({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate});var p=nm(e,d.tickCoord,function(){return f},l,u);p&&(u=d.tickCoord-e*(f/2+a),o[s-1]=la(la({},d),{},{isShow:!0}))}for(var x=i?s-1:s,g=function(m){var k=o[m],S,w=function(){return S===void 0&&(S=r(k,m)),S};if(m===0){var v=e*(k.coordinate-e*w()/2-l);o[m]=k=la(la({},k),{},{tickCoord:v<0?k.coordinate-v*e:k.coordinate})}else o[m]=k=la(la({},k),{},{tickCoord:k.coordinate});var M=nm(e,k.tickCoord,w,l,u);M&&(l=k.tickCoord+e*(w()/2+a),o[m]=la(la({},k),{},{isShow:!0}))},b=0;b<x;b++)g(b);return o}function uw(e,t,r){var n=e.tick,a=e.ticks,i=e.viewBox,o=e.minTickGap,s=e.orientation,l=e.interval,u=e.tickFormatter,d=e.unit,f=e.angle;if(!a||!a.length||!n)return[];if(Ge(l)||Hs.isSsr)return oae(a,typeof l=="number"&&Ge(l)?l:0);var h=[],p=s==="top"||s==="bottom"?"width":"height",x=d&&p==="width"?zd(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},g=function(k,S){var w=ar(u)?u(k.value,S):k.value;return p==="width"?aae(zd(w,{fontSize:t,letterSpacing:r}),x,f):zd(w,{fontSize:t,letterSpacing:r})[p]},b=a.length>=2?Ri(a[1].coordinate-a[0].coordinate):1,y=iae(i,b,p);return l==="equidistantPreserveStart"?sae(b,y,g,a,o):(l==="preserveStart"||l==="preserveStartEnd"?h=fae(b,y,g,a,o,l==="preserveStartEnd"):h=dae(b,y,g,a,o),h.filter(function(m){return m.isShow}))}var hae=["viewBox"],pae=["viewBox"],mae=["ticks"];function bu(e){"@babel/helpers - typeof";return bu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bu(e)}function Oc(){return Oc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Oc.apply(this,arguments)}function UM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function In(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?UM(Object(r),!0).forEach(function(n){dw(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ty(e,t){if(e==null)return{};var r=gae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function xae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function zM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,AA(n.key),n)}}function yae(e,t,r){return t&&zM(e.prototype,t),r&&zM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function bae(e,t,r){return t=am(t),vae(e,CA()?Reflect.construct(t,r||[],am(e).constructor):t.apply(e,r))}function vae(e,t){if(t&&(bu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wae(e)}function wae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function CA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(CA=function(){return!!e})()}function am(e){return am=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},am(e)}function kae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Cb(e,t)}function Cb(e,t){return Cb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Cb(e,t)}function dw(e,t,r){return t=AA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function AA(e){var t=Sae(e,"string");return bu(t)=="symbol"?t:t+""}function Sae(e,t){if(bu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var qu=function(e){function t(r){var n;return xae(this,t),n=bae(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return kae(t,e),yae(t,[{key:"shouldComponentUpdate",value:function(n,a){var i=n.viewBox,o=ty(n,hae),s=this.props,l=s.viewBox,u=ty(s,pae);return!Uc(i,l)||!Uc(o,u)||!Uc(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,i=a.x,o=a.y,s=a.width,l=a.height,u=a.orientation,d=a.tickSize,f=a.mirror,h=a.tickMargin,p,x,g,b,y,m,k=f?-1:1,S=n.tickSize||d,w=Ge(n.tickCoord)?n.tickCoord:n.coordinate;switch(u){case"top":p=x=n.coordinate,b=o+ +!f*l,g=b-k*S,m=g-k*h,y=w;break;case"left":g=b=n.coordinate,x=i+ +!f*s,p=x-k*S,y=p-k*h,m=w;break;case"right":g=b=n.coordinate,x=i+ +f*s,p=x+k*S,y=p+k*h,m=w;break;default:p=x=n.coordinate,b=o+ +f*l,g=b+k*S,m=g+k*h,y=w;break}return{line:{x1:p,y1:g,x2:x,y2:b},tick:{x:y,y:m}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,i=n.mirror,o;switch(a){case"left":o=i?"start":"end";break;case"right":o=i?"end":"start";break;default:o="middle";break}return o}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,i=n.mirror,o="end";switch(a){case"left":case"right":o="middle";break;case"top":o=i?"start":"end";break;default:o=i?"end":"start";break}return o}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.orientation,u=n.mirror,d=n.axisLine,f=In(In(In({},Qt(this.props,!1)),Qt(d,!1)),{},{fill:"none"});if(l==="top"||l==="bottom"){var h=+(l==="top"&&!u||l==="bottom"&&u);f=In(In({},f),{},{x1:a,y1:i+h*s,x2:a+o,y2:i+h*s})}else{var p=+(l==="left"&&!u||l==="right"&&u);f=In(In({},f),{},{x1:a+p*o,y1:i,x2:a+p*o,y2:i+s})}return ee.createElement("line",Oc({},f,{className:kr("recharts-cartesian-axis-line",gi(d,"className"))}))}},{key:"renderTicks",value:function(n,a,i){var o=this,s=this.props,l=s.tickLine,u=s.stroke,d=s.tick,f=s.tickFormatter,h=s.unit,p=uw(In(In({},this.props),{},{ticks:n}),a,i),x=this.getTickTextAnchor(),g=this.getTickVerticalAnchor(),b=Qt(this.props,!1),y=Qt(d,!1),m=In(In({},b),{},{fill:"none"},Qt(l,!1)),k=p.map(function(S,w){var v=o.getTickLineCoord(S),M=v.line,N=v.tick,_=In(In(In(In({textAnchor:x,verticalAnchor:g},b),{},{stroke:"none",fill:u},y),N),{},{index:w,payload:S,visibleTicksCount:p.length,tickFormatter:f});return ee.createElement(Er,Oc({className:"recharts-cartesian-axis-tick",key:"tick-".concat(S.value,"-").concat(S.coordinate,"-").concat(S.tickCoord)},gf(o.props,S,w)),l&&ee.createElement("line",Oc({},m,M,{className:kr("recharts-cartesian-axis-tick-line",gi(l,"className"))})),d&&t.renderTickItem(d,_,"".concat(ar(f)?f(S.value,w):S.value).concat(h||"")))});return ee.createElement("g",{className:"recharts-cartesian-axis-ticks"},k)}},{key:"render",value:function(){var n=this,a=this.props,i=a.axisLine,o=a.width,s=a.height,l=a.ticksGenerator,u=a.className,d=a.hide;if(d)return null;var f=this.props,h=f.ticks,p=ty(f,mae),x=h;return ar(l)&&(x=h&&h.length>0?l(this.props):l(p)),o<=0||s<=0||!x||!x.length?null:ee.createElement(Er,{className:kr("recharts-cartesian-axis",u),ref:function(b){n.layerReference=b}},i&&this.renderAxisLine(),this.renderTicks(x,this.state.fontSize,this.state.letterSpacing),Jn.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,i){var o,s=kr(a.className,"recharts-cartesian-axis-tick-value");return ee.isValidElement(n)?o=ee.cloneElement(n,In(In({},a),{},{className:s})):ar(n)?o=n(In(In({},a),{},{className:s})):o=ee.createElement(Mp,Oc({},a,{className:"recharts-cartesian-axis-tick-value"}),i),o}}])}(j.Component);dw(qu,"displayName","CartesianAxis");dw(qu,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var Mae=["x1","y1","x2","y2","key"],jae=["offset"];function Hl(e){"@babel/helpers - typeof";return Hl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Hl(e)}function WM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ua(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?WM(Object(r),!0).forEach(function(n){Nae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Nae(e,t,r){return t=_ae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _ae(e){var t=Pae(e,"string");return Hl(t)=="symbol"?t:t+""}function Pae(e,t){if(Hl(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Hl(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function bl(){return bl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},bl.apply(this,arguments)}function VM(e,t){if(e==null)return{};var r=Cae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Cae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var Aae=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,i=t.y,o=t.width,s=t.height,l=t.ry;return ee.createElement("rect",{x:a,y:i,ry:l,width:o,height:s,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function OA(e,t){var r;if(ee.isValidElement(e))r=ee.cloneElement(e,t);else if(ar(e))r=e(t);else{var n=t.x1,a=t.y1,i=t.x2,o=t.y2,s=t.key,l=VM(t,Mae),u=Qt(l,!1);u.offset;var d=VM(u,jae);r=ee.createElement("line",bl({},d,{x1:n,y1:a,x2:i,y2:o,fill:"none",key:s}))}return r}function Oae(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,i=e.horizontalPoints;if(!a||!i||!i.length)return null;var o=i.map(function(s,l){var u=ua(ua({},e),{},{x1:t,y1:s,x2:t+r,y2:s,key:"line-".concat(l),index:l});return OA(a,u)});return ee.createElement("g",{className:"recharts-cartesian-grid-horizontal"},o)}function Tae(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,i=e.verticalPoints;if(!a||!i||!i.length)return null;var o=i.map(function(s,l){var u=ua(ua({},e),{},{x1:s,y1:t,x2:s,y2:t+r,key:"line-".concat(l),index:l});return OA(a,u)});return ee.createElement("g",{className:"recharts-cartesian-grid-vertical"},o)}function Eae(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,i=e.width,o=e.height,s=e.horizontalPoints,l=e.horizontal,u=l===void 0?!0:l;if(!u||!t||!t.length)return null;var d=s.map(function(h){return Math.round(h+a-a)}).sort(function(h,p){return h-p});a!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var x=!d[p+1],g=x?a+o-h:d[p+1]-h;if(g<=0)return null;var b=p%t.length;return ee.createElement("rect",{key:"react-".concat(p),y:h,x:n,height:g,width:i,stroke:"none",fill:t[b],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return ee.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function Iae(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,i=e.x,o=e.y,s=e.width,l=e.height,u=e.verticalPoints;if(!r||!n||!n.length)return null;var d=u.map(function(h){return Math.round(h+i-i)}).sort(function(h,p){return h-p});i!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var x=!d[p+1],g=x?i+s-h:d[p+1]-h;if(g<=0)return null;var b=p%n.length;return ee.createElement("rect",{key:"react-".concat(p),x:h,y:o,width:g,height:l,stroke:"none",fill:n[b],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return ee.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var Rae=function(t,r){var n=t.xAxis,a=t.width,i=t.height,o=t.offset;return GC(uw(ua(ua(ua({},qu.defaultProps),n),{},{ticks:Co(n,!0),viewBox:{x:0,y:0,width:a,height:i}})),o.left,o.left+o.width,r)},Dae=function(t,r){var n=t.yAxis,a=t.width,i=t.height,o=t.offset;return GC(uw(ua(ua(ua({},qu.defaultProps),n),{},{ticks:Co(n,!0),viewBox:{x:0,y:0,width:a,height:i}})),o.top,o.top+o.height,r)},mc={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function Di(e){var t,r,n,a,i,o,s=sw(),l=lw(),u=Sne(),d=ua(ua({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:mc.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:mc.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:mc.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:mc.horizontalFill,vertical:(i=e.vertical)!==null&&i!==void 0?i:mc.vertical,verticalFill:(o=e.verticalFill)!==null&&o!==void 0?o:mc.verticalFill,x:Ge(e.x)?e.x:u.left,y:Ge(e.y)?e.y:u.top,width:Ge(e.width)?e.width:u.width,height:Ge(e.height)?e.height:u.height}),f=d.x,h=d.y,p=d.width,x=d.height,g=d.syncWithTicks,b=d.horizontalValues,y=d.verticalValues,m=vne(),k=wne();if(!Ge(p)||p<=0||!Ge(x)||x<=0||!Ge(f)||f!==+f||!Ge(h)||h!==+h)return null;var S=d.verticalCoordinatesGenerator||Rae,w=d.horizontalCoordinatesGenerator||Dae,v=d.horizontalPoints,M=d.verticalPoints;if((!v||!v.length)&&ar(w)){var N=b&&b.length,_=w({yAxis:k?ua(ua({},k),{},{ticks:N?b:k.ticks}):void 0,width:s,height:l,offset:u},N?!0:g);To(Array.isArray(_),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(Hl(_),"]")),Array.isArray(_)&&(v=_)}if((!M||!M.length)&&ar(S)){var P=y&&y.length,E=S({xAxis:m?ua(ua({},m),{},{ticks:P?y:m.ticks}):void 0,width:s,height:l,offset:u},P?!0:g);To(Array.isArray(E),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(Hl(E),"]")),Array.isArray(E)&&(M=E)}return ee.createElement("g",{className:"recharts-cartesian-grid"},ee.createElement(Aae,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),ee.createElement(Oae,bl({},d,{offset:u,horizontalPoints:v,xAxis:m,yAxis:k})),ee.createElement(Tae,bl({},d,{offset:u,verticalPoints:M,xAxis:m,yAxis:k})),ee.createElement(Eae,bl({},d,{horizontalPoints:v})),ee.createElement(Iae,bl({},d,{verticalPoints:M})))}Di.displayName="CartesianGrid";var $ae=["type","layout","connectNulls","ref"],Lae=["key"];function vu(e){"@babel/helpers - typeof";return vu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vu(e)}function HM(e,t){if(e==null)return{};var r=Fae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Fae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Xd(){return Xd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Xd.apply(this,arguments)}function XM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Va(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?XM(Object(r),!0).forEach(function(n){Oi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):XM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gc(e){return zae(e)||Uae(e)||Gae(e)||Bae()}function Bae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gae(e,t){if(e){if(typeof e=="string")return Ab(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ab(e,t)}}function Uae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function zae(e){if(Array.isArray(e))return Ab(e)}function Ab(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Wae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function KM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EA(n.key),n)}}function Vae(e,t,r){return t&&KM(e.prototype,t),r&&KM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Hae(e,t,r){return t=im(t),Xae(e,TA()?Reflect.construct(t,r||[],im(e).constructor):t.apply(e,r))}function Xae(e,t){if(t&&(vu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Kae(e)}function Kae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function TA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(TA=function(){return!!e})()}function im(e){return im=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},im(e)}function Yae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ob(e,t)}function Ob(e,t){return Ob=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Ob(e,t)}function Oi(e,t,r){return t=EA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EA(e){var t=qae(e,"string");return vu(t)=="symbol"?t:t+""}function qae(e,t){if(vu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ln=function(e){function t(){var r;Wae(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Hae(this,t,[].concat(a)),Oi(r,"state",{isAnimationFinished:!0,totalLength:0}),Oi(r,"generateSimpleStrokeDasharray",function(o,s){return"".concat(s,"px ").concat(o-s,"px")}),Oi(r,"getStrokeDasharray",function(o,s,l){var u=l.reduce(function(y,m){return y+m});if(!u)return r.generateSimpleStrokeDasharray(s,o);for(var d=Math.floor(o/u),f=o%u,h=s-o,p=[],x=0,g=0;x<l.length;g+=l[x],++x)if(g+l[x]>f){p=[].concat(gc(l.slice(0,x)),[f-g]);break}var b=p.length%2===0?[0,h]:[h];return[].concat(gc(t.repeat(l,d)),gc(p),b).map(function(y){return"".concat(y,"px")}).join(", ")}),Oi(r,"id",Jl("recharts-line-")),Oi(r,"pathRef",function(o){r.mainCurve=o}),Oi(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Oi(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Yae(t,e),Vae(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,s=i.xAxis,l=i.yAxis,u=i.layout,d=i.children,f=Fa(d,Yu);if(!f)return null;var h=function(g,b){return{x:g.x,y:g.y,value:g.value,errorVal:Gn(g.payload,b)}},p={clipPath:n?"url(#clipPath-".concat(a,")"):null};return ee.createElement(Er,p,f.map(function(x){return ee.cloneElement(x,{key:"bar-".concat(x.props.dataKey),data:o,xAxis:s,yAxis:l,layout:u,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var s=this.props,l=s.dot,u=s.points,d=s.dataKey,f=Qt(this.props,!1),h=Qt(l,!0),p=u.map(function(g,b){var y=Va(Va(Va({key:"dot-".concat(b),r:3},f),h),{},{index:b,cx:g.x,cy:g.y,value:g.value,dataKey:d,payload:g.payload,points:u});return t.renderDotItem(l,y)}),x={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return ee.createElement(Er,Xd({className:"recharts-line-dots",key:"dots"},x),p)}},{key:"renderCurveStatically",value:function(n,a,i,o){var s=this.props,l=s.type,u=s.layout,d=s.connectNulls;s.ref;var f=HM(s,$ae),h=Va(Va(Va({},Qt(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(i,")"):null,points:n},o),{},{type:l,layout:u,connectNulls:d});return ee.createElement(_l,Xd({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,l=o.strokeDasharray,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,p=o.animationId,x=o.animateNewValues,g=o.width,b=o.height,y=this.state,m=y.prevPoints,k=y.totalLength;return ee.createElement(Bi,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(S){var w=S.t;if(m){var v=m.length/s.length,M=s.map(function(R,T){var G=Math.floor(T*v);if(m[G]){var L=m[G],C=wn(L.x,R.x),$=wn(L.y,R.y);return Va(Va({},R),{},{x:C(w),y:$(w)})}if(x){var A=wn(g*2,R.x),O=wn(b/2,R.y);return Va(Va({},R),{},{x:A(w),y:O(w)})}return Va(Va({},R),{},{x:R.x,y:R.y})});return i.renderCurveStatically(M,n,a)}var N=wn(0,k),_=N(w),P;if(l){var E="".concat(l).split(/[,\s]+/gim).map(function(R){return parseFloat(R)});P=i.getStrokeDasharray(_,k,E)}else P=i.generateSimpleStrokeDasharray(k,_);return i.renderCurveStatically(s,n,a,{strokeDasharray:P})})}},{key:"renderCurve",value:function(n,a){var i=this.props,o=i.points,s=i.isAnimationActive,l=this.state,u=l.prevPoints,d=l.totalLength;return s&&o&&o.length&&(!u&&d>0||!zl(u,o))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(o,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,l=a.className,u=a.xAxis,d=a.yAxis,f=a.top,h=a.left,p=a.width,x=a.height,g=a.isAnimationActive,b=a.id;if(i||!s||!s.length)return null;var y=this.state.isAnimationFinished,m=s.length===1,k=kr("recharts-line",l),S=u&&u.allowDataOverflow,w=d&&d.allowDataOverflow,v=S||w,M=Yt(b)?this.id:b,N=(n=Qt(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},_=N.r,P=_===void 0?3:_,E=N.strokeWidth,R=E===void 0?2:E,T=R_(o)?o:{},G=T.clipDot,L=G===void 0?!0:G,C=P*2+R;return ee.createElement(Er,{className:k},S||w?ee.createElement("defs",null,ee.createElement("clipPath",{id:"clipPath-".concat(M)},ee.createElement("rect",{x:S?h:h-p/2,y:w?f:f-x/2,width:S?p:p*2,height:w?x:x*2})),!L&&ee.createElement("clipPath",{id:"clipPath-dots-".concat(M)},ee.createElement("rect",{x:h-C/2,y:f-C/2,width:p+C,height:x+C}))):null,!m&&this.renderCurve(v,M),this.renderErrorBar(v,M),(m||o)&&this.renderDots(v,L,M),(!g||y)&&ao.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var i=n.length%2!==0?[].concat(gc(n),[0]):n,o=[],s=0;s<a;++s)o=[].concat(gc(o),gc(i));return o}},{key:"renderDotItem",value:function(n,a){var i;if(ee.isValidElement(n))i=ee.cloneElement(n,a);else if(ar(n))i=n(a);else{var o=a.key,s=HM(a,Lae),l=kr("recharts-line-dot",typeof n!="boolean"?n.className:"");i=ee.createElement(gg,Xd({key:o},s,{className:l}))}return i}}])}(j.PureComponent);Oi(Ln,"displayName","Line");Oi(Ln,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Hs.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Oi(Ln,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,i=e.yAxisTicks,o=e.dataKey,s=e.bandSize,l=e.displayedData,u=e.offset,d=t.layout,f=l.map(function(h,p){var x=Gn(h,o);return d==="horizontal"?{x:du({axis:r,ticks:a,bandSize:s,entry:h,index:p}),y:Yt(x)?null:n.scale(x),value:x,payload:h}:{x:Yt(x)?null:r.scale(x),y:du({axis:n,ticks:i,bandSize:s,entry:h,index:p}),value:x,payload:h}});return Va({points:f,layout:d},u)});var Zae=["layout","type","stroke","connectNulls","isRange","ref"],Jae=["key"],IA;function wu(e){"@babel/helpers - typeof";return wu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wu(e)}function RA(e,t){if(e==null)return{};var r=Qae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Qae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function vl(){return vl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},vl.apply(this,arguments)}function YM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function os(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?YM(Object(r),!0).forEach(function(n){Ji(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function eie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function qM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,$A(n.key),n)}}function tie(e,t,r){return t&&qM(e.prototype,t),r&&qM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function rie(e,t,r){return t=om(t),nie(e,DA()?Reflect.construct(t,r||[],om(e).constructor):t.apply(e,r))}function nie(e,t){if(t&&(wu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return aie(e)}function aie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(DA=function(){return!!e})()}function om(e){return om=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},om(e)}function iie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Tb(e,t)}function Tb(e,t){return Tb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Tb(e,t)}function Ji(e,t,r){return t=$A(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function $A(e){var t=oie(e,"string");return wu(t)=="symbol"?t:t+""}function oie(e,t){if(wu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var pi=function(e){function t(){var r;eie(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=rie(this,t,[].concat(a)),Ji(r,"state",{isAnimationFinished:!0}),Ji(r,"id",Jl("recharts-area-")),Ji(r,"handleAnimationEnd",function(){var o=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),ar(o)&&o()}),Ji(r,"handleAnimationStart",function(){var o=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),ar(o)&&o()}),r}return iie(t,e),tie(t,[{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive,s=this.state.isAnimationFinished;if(o&&!s)return null;var l=this.props,u=l.dot,d=l.points,f=l.dataKey,h=Qt(this.props,!1),p=Qt(u,!0),x=d.map(function(b,y){var m=os(os(os({key:"dot-".concat(y),r:3},h),p),{},{index:y,cx:b.x,cy:b.y,dataKey:f,value:b.value,payload:b.payload,points:d});return t.renderDotItem(u,m)}),g={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return ee.createElement(Er,vl({className:"recharts-area-dots"},g),x)}},{key:"renderHorizontalRect",value:function(n){var a=this.props,i=a.baseLine,o=a.points,s=a.strokeWidth,l=o[0].x,u=o[o.length-1].x,d=n*Math.abs(l-u),f=ws(o.map(function(h){return h.y||0}));return Ge(i)&&typeof i=="number"?f=Math.max(i,f):i&&Array.isArray(i)&&i.length&&(f=Math.max(ws(i.map(function(h){return h.y||0})),f)),Ge(f)?ee.createElement("rect",{x:l<u?l:l-d,y:0,width:d,height:Math.floor(f+(s?parseInt("".concat(s),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var a=this.props,i=a.baseLine,o=a.points,s=a.strokeWidth,l=o[0].y,u=o[o.length-1].y,d=n*Math.abs(l-u),f=ws(o.map(function(h){return h.x||0}));return Ge(i)&&typeof i=="number"?f=Math.max(i,f):i&&Array.isArray(i)&&i.length&&(f=Math.max(ws(i.map(function(h){return h.x||0})),f)),Ge(f)?ee.createElement("rect",{x:0,y:l<u?l:l-d,width:f+(s?parseInt("".concat(s),10):1),height:Math.floor(d)}):null}},{key:"renderClipRect",value:function(n){var a=this.props.layout;return a==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,a,i,o){var s=this.props,l=s.layout,u=s.type,d=s.stroke,f=s.connectNulls,h=s.isRange;s.ref;var p=RA(s,Zae);return ee.createElement(Er,{clipPath:i?"url(#clipPath-".concat(o,")"):null},ee.createElement(_l,vl({},Qt(p,!0),{points:n,connectNulls:f,type:u,baseLine:a,layout:l,stroke:"none",className:"recharts-area-area"})),d!=="none"&&ee.createElement(_l,vl({},Qt(this.props,!1),{className:"recharts-area-curve",layout:l,type:u,connectNulls:f,fill:"none",points:n})),d!=="none"&&h&&ee.createElement(_l,vl({},Qt(this.props,!1),{className:"recharts-area-curve",layout:l,type:u,connectNulls:f,fill:"none",points:a})))}},{key:"renderAreaWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,l=o.baseLine,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,p=o.animationId,x=this.state,g=x.prevPoints,b=x.prevBaseLine;return ee.createElement(Bi,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"area-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(y){var m=y.t;if(g){var k=g.length/s.length,S=s.map(function(N,_){var P=Math.floor(_*k);if(g[P]){var E=g[P],R=wn(E.x,N.x),T=wn(E.y,N.y);return os(os({},N),{},{x:R(m),y:T(m)})}return N}),w;if(Ge(l)&&typeof l=="number"){var v=wn(b,l);w=v(m)}else if(Yt(l)||Uu(l)){var M=wn(b,0);w=M(m)}else w=l.map(function(N,_){var P=Math.floor(_*k);if(b[P]){var E=b[P],R=wn(E.x,N.x),T=wn(E.y,N.y);return os(os({},N),{},{x:R(m),y:T(m)})}return N});return i.renderAreaStatically(S,w,n,a)}return ee.createElement(Er,null,ee.createElement("defs",null,ee.createElement("clipPath",{id:"animationClipPath-".concat(a)},i.renderClipRect(m))),ee.createElement(Er,{clipPath:"url(#animationClipPath-".concat(a,")")},i.renderAreaStatically(s,l,n,a)))})}},{key:"renderArea",value:function(n,a){var i=this.props,o=i.points,s=i.baseLine,l=i.isAnimationActive,u=this.state,d=u.prevPoints,f=u.prevBaseLine,h=u.totalLength;return l&&o&&o.length&&(!d&&h>0||!zl(d,o)||!zl(f,s))?this.renderAreaWithAnimation(n,a):this.renderAreaStatically(o,s,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,l=a.className,u=a.top,d=a.left,f=a.xAxis,h=a.yAxis,p=a.width,x=a.height,g=a.isAnimationActive,b=a.id;if(i||!s||!s.length)return null;var y=this.state.isAnimationFinished,m=s.length===1,k=kr("recharts-area",l),S=f&&f.allowDataOverflow,w=h&&h.allowDataOverflow,v=S||w,M=Yt(b)?this.id:b,N=(n=Qt(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},_=N.r,P=_===void 0?3:_,E=N.strokeWidth,R=E===void 0?2:E,T=R_(o)?o:{},G=T.clipDot,L=G===void 0?!0:G,C=P*2+R;return ee.createElement(Er,{className:k},S||w?ee.createElement("defs",null,ee.createElement("clipPath",{id:"clipPath-".concat(M)},ee.createElement("rect",{x:S?d:d-p/2,y:w?u:u-x/2,width:S?p:p*2,height:w?x:x*2})),!L&&ee.createElement("clipPath",{id:"clipPath-dots-".concat(M)},ee.createElement("rect",{x:d-C/2,y:u-C/2,width:p+C,height:x+C}))):null,m?null:this.renderArea(v,M),(o||m)&&this.renderDots(v,L,M),(!g||y)&&ao.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:a.curPoints,prevBaseLine:a.curBaseLine}:n.points!==a.curPoints||n.baseLine!==a.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(j.PureComponent);IA=pi;Ji(pi,"displayName","Area");Ji(pi,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Hs.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Ji(pi,"getBaseValue",function(e,t,r,n){var a=e.layout,i=e.baseValue,o=t.props.baseValue,s=o??i;if(Ge(s)&&typeof s=="number")return s;var l=a==="horizontal"?n:r,u=l.scale.domain();if(l.type==="number"){var d=Math.max(u[0],u[1]),f=Math.min(u[0],u[1]);return s==="dataMin"?f:s==="dataMax"||d<0?d:Math.max(Math.min(u[0],u[1]),0)}return s==="dataMin"?u[0]:s==="dataMax"?u[1]:u[0]});Ji(pi,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,a=e.yAxis,i=e.xAxisTicks,o=e.yAxisTicks,s=e.bandSize,l=e.dataKey,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=t.layout,x=u&&u.length,g=IA.getBaseValue(t,r,n,a),b=p==="horizontal",y=!1,m=f.map(function(S,w){var v;x?v=u[d+w]:(v=Gn(S,l),Array.isArray(v)?y=!0:v=[g,v]);var M=v[1]==null||x&&Gn(S,l)==null;return b?{x:du({axis:n,ticks:i,bandSize:s,entry:S,index:w}),y:M?null:a.scale(v[1]),value:v,payload:S}:{x:M?null:n.scale(v[1]),y:du({axis:a,ticks:o,bandSize:s,entry:S,index:w}),value:v,payload:S}}),k;return x||y?k=m.map(function(S){var w=Array.isArray(S.value)?S.value[0]:null;return b?{x:S.x,y:w!=null&&S.y!=null?a.scale(w):null}:{x:w!=null?n.scale(w):null,y:S.y}}):k=b?a.scale(g):n.scale(g),os({points:m,baseLine:k,layout:p,isRange:y},h)});Ji(pi,"renderDotItem",function(e,t){var r;if(ee.isValidElement(e))r=ee.cloneElement(e,t);else if(ar(e))r=e(t);else{var n=kr("recharts-area-dot",typeof e!="boolean"?e.className:""),a=t.key,i=RA(t,Jae);r=ee.createElement(gg,vl({},i,{key:a,className:n}))}return r});function ku(e){"@babel/helpers - typeof";return ku=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ku(e)}function sie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function lie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,BA(n.key),n)}}function cie(e,t,r){return t&&lie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function uie(e,t,r){return t=sm(t),die(e,LA()?Reflect.construct(t,r||[],sm(e).constructor):t.apply(e,r))}function die(e,t){if(t&&(ku(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fie(e)}function fie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function LA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(LA=function(){return!!e})()}function sm(e){return sm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},sm(e)}function hie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Eb(e,t)}function Eb(e,t){return Eb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Eb(e,t)}function FA(e,t,r){return t=BA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function BA(e){var t=pie(e,"string");return ku(t)=="symbol"?t:t+""}function pie(e,t){if(ku(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ku(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var kg=function(e){function t(){return sie(this,t),uie(this,t,arguments)}return hie(t,e),cie(t,[{key:"render",value:function(){return null}}])}(j.Component);FA(kg,"displayName","ZAxis");FA(kg,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var mie=["option","isActive"];function Kd(){return Kd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Kd.apply(this,arguments)}function gie(e,t){if(e==null)return{};var r=xie(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xie(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function yie(e){var t=e.option,r=e.isActive,n=gie(e,mie);return typeof t=="string"?j.createElement(bb,Kd({option:j.createElement(ng,Kd({type:t},n)),isActive:r,shapeType:"symbols"},n)):j.createElement(bb,Kd({option:t,isActive:r,shapeType:"symbols"},n))}function Su(e){"@babel/helpers - typeof";return Su=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Su(e)}function Yd(){return Yd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Yd.apply(this,arguments)}function ZM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ci(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?ZM(Object(r),!0).forEach(function(n){Ms(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ZM(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function bie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function JM(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,UA(n.key),n)}}function vie(e,t,r){return t&&JM(e.prototype,t),r&&JM(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function wie(e,t,r){return t=lm(t),kie(e,GA()?Reflect.construct(t,r||[],lm(e).constructor):t.apply(e,r))}function kie(e,t){if(t&&(Su(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Sie(e)}function Sie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function GA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(GA=function(){return!!e})()}function lm(e){return lm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lm(e)}function Mie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ib(e,t)}function Ib(e,t){return Ib=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Ib(e,t)}function Ms(e,t,r){return t=UA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function UA(e){var t=jie(e,"string");return Su(t)=="symbol"?t:t+""}function jie(e,t){if(Su(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Su(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var xa=function(e){function t(){var r;bie(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=wie(this,t,[].concat(a)),Ms(r,"state",{isAnimationFinished:!1}),Ms(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0})}),Ms(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1})}),Ms(r,"id",Jl("recharts-scatter-")),r}return Mie(t,e),vie(t,[{key:"renderSymbolsStatically",value:function(n){var a=this,i=this.props,o=i.shape,s=i.activeShape,l=i.activeIndex,u=Qt(this.props,!1);return n.map(function(d,f){var h=l===f,p=h?s:o,x=ci(ci({},u),d);return ee.createElement(Er,Yd({className:"recharts-scatter-symbol",key:"symbol-".concat(d==null?void 0:d.cx,"-").concat(d==null?void 0:d.cy,"-").concat(d==null?void 0:d.size,"-").concat(f)},gf(a.props,d,f),{role:"img"}),ee.createElement(yie,Yd({option:p,isActive:h,key:"symbol-".concat(f)},x)))})}},{key:"renderSymbolsWithAnimation",value:function(){var n=this,a=this.props,i=a.points,o=a.isAnimationActive,s=a.animationBegin,l=a.animationDuration,u=a.animationEasing,d=a.animationId,f=this.state.prevPoints;return ee.createElement(Bi,{begin:s,duration:l,isActive:o,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(h){var p=h.t,x=i.map(function(g,b){var y=f&&f[b];if(y){var m=wn(y.cx,g.cx),k=wn(y.cy,g.cy),S=wn(y.size,g.size);return ci(ci({},g),{},{cx:m(p),cy:k(p),size:S(p)})}var w=wn(0,g.size);return ci(ci({},g),{},{size:w(p)})});return ee.createElement(Er,null,n.renderSymbolsStatically(x))})}},{key:"renderSymbols",value:function(){var n=this.props,a=n.points,i=n.isAnimationActive,o=this.state.prevPoints;return i&&a&&a.length&&(!o||!zl(o,a))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(a)}},{key:"renderErrorBar",value:function(){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var a=this.props,i=a.points,o=a.xAxis,s=a.yAxis,l=a.children,u=Fa(l,Yu);return u?u.map(function(d,f){var h=d.props,p=h.direction,x=h.dataKey;return ee.cloneElement(d,{key:"".concat(p,"-").concat(x,"-").concat(i[f]),data:i,xAxis:o,yAxis:s,layout:p==="x"?"vertical":"horizontal",dataPointFormatter:function(b,y){return{x:b.cx,y:b.cy,value:p==="x"?+b.node.x:+b.node.y,errorVal:Gn(b,y)}}})}):null}},{key:"renderLine",value:function(){var n=this.props,a=n.points,i=n.line,o=n.lineType,s=n.lineJointType,l=Qt(this.props,!1),u=Qt(i,!1),d,f;if(o==="joint")d=a.map(function(k){return{x:k.cx,y:k.cy}});else if(o==="fitting"){var h=Q$(a),p=h.xmin,x=h.xmax,g=h.a,b=h.b,y=function(S){return g*S+b};d=[{x:p,y:y(p)},{x,y:y(x)}]}var m=ci(ci(ci({},l),{},{fill:"none",stroke:l&&l.fill},u),{},{points:d});return ee.isValidElement(i)?f=ee.cloneElement(i,m):ar(i)?f=i(m):f=ee.createElement(_l,Yd({},m,{type:s})),ee.createElement(Er,{className:"recharts-scatter-line",key:"recharts-scatter-line"},f)}},{key:"render",value:function(){var n=this.props,a=n.hide,i=n.points,o=n.line,s=n.className,l=n.xAxis,u=n.yAxis,d=n.left,f=n.top,h=n.width,p=n.height,x=n.id,g=n.isAnimationActive;if(a||!i||!i.length)return null;var b=this.state.isAnimationFinished,y=kr("recharts-scatter",s),m=l&&l.allowDataOverflow,k=u&&u.allowDataOverflow,S=m||k,w=Yt(x)?this.id:x;return ee.createElement(Er,{className:y,clipPath:S?"url(#clipPath-".concat(w,")"):null},m||k?ee.createElement("defs",null,ee.createElement("clipPath",{id:"clipPath-".concat(w)},ee.createElement("rect",{x:m?d:d-h/2,y:k?f:f-p/2,width:m?h:h*2,height:k?p:p*2}))):null,o&&this.renderLine(),this.renderErrorBar(),ee.createElement(Er,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!g||b)&&ao.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}}])}(j.PureComponent);Ms(xa,"displayName","Scatter");Ms(xa,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Hs.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});Ms(xa,"getComposedData",function(e){var t=e.xAxis,r=e.yAxis,n=e.zAxis,a=e.item,i=e.displayedData,o=e.xAxisTicks,s=e.yAxisTicks,l=e.offset,u=a.props.tooltipType,d=Fa(a.props.children,A2),f=Yt(t.dataKey)?a.props.dataKey:t.dataKey,h=Yt(r.dataKey)?a.props.dataKey:r.dataKey,p=n&&n.dataKey,x=n?n.range:kg.defaultProps.range,g=x&&x[0],b=t.scale.bandwidth?t.scale.bandwidth():0,y=r.scale.bandwidth?r.scale.bandwidth():0,m=i.map(function(k,S){var w=Gn(k,f),v=Gn(k,h),M=!Yt(p)&&Gn(k,p)||"-",N=[{name:Yt(t.dataKey)?a.props.name:t.name||t.dataKey,unit:t.unit||"",value:w,payload:k,dataKey:f,type:u},{name:Yt(r.dataKey)?a.props.name:r.name||r.dataKey,unit:r.unit||"",value:v,payload:k,dataKey:h,type:u}];M!=="-"&&N.push({name:n.name||n.dataKey,unit:n.unit||"",value:M,payload:k,dataKey:p,type:u});var _=du({axis:t,ticks:o,bandSize:b,entry:k,index:S,dataKey:f}),P=du({axis:r,ticks:s,bandSize:y,entry:k,index:S,dataKey:h}),E=M!=="-"?n.scale(M):g,R=Math.sqrt(Math.max(E,0)/Math.PI);return ci(ci({},k),{},{cx:_,cy:P,x:_-R,y:P-R,xAxis:t,yAxis:r,zAxis:n,width:2*R,height:2*R,size:E,node:{x:w,y:v,z:M},tooltipPayload:N,tooltipPosition:{x:_,y:P},payload:k},d&&d[S]&&d[S].props)});return ci({points:m},l)});function Mu(e){"@babel/helpers - typeof";return Mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mu(e)}function Nie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _ie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VA(n.key),n)}}function Pie(e,t,r){return t&&_ie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Cie(e,t,r){return t=cm(t),Aie(e,zA()?Reflect.construct(t,r||[],cm(e).constructor):t.apply(e,r))}function Aie(e,t){if(t&&(Mu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Oie(e)}function Oie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zA=function(){return!!e})()}function cm(e){return cm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},cm(e)}function Tie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Rb(e,t)}function Rb(e,t){return Rb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Rb(e,t)}function WA(e,t,r){return t=VA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VA(e){var t=Eie(e,"string");return Mu(t)=="symbol"?t:t+""}function Eie(e,t){if(Mu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Mu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Db(){return Db=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Db.apply(this,arguments)}function Iie(e){var t=e.xAxisId,r=sw(),n=lw(),a=vA(t);return a==null?null:j.createElement(qu,Db({},a,{className:kr("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(o){return Co(o,!0)}}))}var wa=function(e){function t(){return Nie(this,t),Cie(this,t,arguments)}return Tie(t,e),Pie(t,[{key:"render",value:function(){return j.createElement(Iie,this.props)}}])}(j.Component);WA(wa,"displayName","XAxis");WA(wa,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function ju(e){"@babel/helpers - typeof";return ju=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ju(e)}function Rie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Die(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,KA(n.key),n)}}function $ie(e,t,r){return t&&Die(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Lie(e,t,r){return t=um(t),Fie(e,HA()?Reflect.construct(t,r||[],um(e).constructor):t.apply(e,r))}function Fie(e,t){if(t&&(ju(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Bie(e)}function Bie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function HA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(HA=function(){return!!e})()}function um(e){return um=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},um(e)}function Gie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$b(e,t)}function $b(e,t){return $b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},$b(e,t)}function XA(e,t,r){return t=KA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function KA(e){var t=Uie(e,"string");return ju(t)=="symbol"?t:t+""}function Uie(e,t){if(ju(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ju(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Lb(){return Lb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lb.apply(this,arguments)}var zie=function(t){var r=t.yAxisId,n=sw(),a=lw(),i=wA(r);return i==null?null:j.createElement(qu,Lb({},i,{className:kr("recharts-".concat(i.axisType," ").concat(i.axisType),i.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(s){return Co(s,!0)}}))},ka=function(e){function t(){return Rie(this,t),Lie(this,t,arguments)}return Gie(t,e),$ie(t,[{key:"render",value:function(){return j.createElement(zie,this.props)}}])}(j.Component);XA(ka,"displayName","YAxis");XA(ka,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function QM(e){return Xie(e)||Hie(e)||Vie(e)||Wie()}function Wie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Vie(e,t){if(e){if(typeof e=="string")return Fb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Fb(e,t)}}function Hie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Xie(e){if(Array.isArray(e))return Fb(e)}function Fb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Bb=function(t,r,n,a,i){var o=Fa(t,Ss),s=Fa(t,u0),l=[].concat(QM(o),QM(s)),u=Fa(t,d0),d="".concat(a,"Id"),f=a[0],h=r;if(l.length&&(h=l.reduce(function(g,b){if(b.props[d]===n&&io(b.props,"extendDomain")&&Ge(b.props[f])){var y=b.props[f];return[Math.min(g[0],y),Math.max(g[1],y)]}return g},h)),u.length){var p="".concat(f,"1"),x="".concat(f,"2");h=u.reduce(function(g,b){if(b.props[d]===n&&io(b.props,"extendDomain")&&Ge(b.props[p])&&Ge(b.props[x])){var y=b.props[p],m=b.props[x];return[Math.min(g[0],y,m),Math.max(g[1],y,m)]}return g},h)}return i&&i.length&&(h=i.reduce(function(g,b){return Ge(b)?[Math.min(g[0],b),Math.max(g[1],b)]:g},h)),h},YA={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,f||l,h),x=r?r+u:u;return l._events[x]?l._events[x].fn?l._events[x]=[l._events[x],p]:l._events[x].push(p):(l._events[x]=p,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},s.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,x=new Array(p);h<p;h++)x[h]=f[h].fn;return x},s.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},s.prototype.emit=function(u,d,f,h,p,x){var g=r?r+u:u;if(!this._events[g])return!1;var b=this._events[g],y=arguments.length,m,k;if(b.fn){switch(b.once&&this.removeListener(u,b.fn,void 0,!0),y){case 1:return b.fn.call(b.context),!0;case 2:return b.fn.call(b.context,d),!0;case 3:return b.fn.call(b.context,d,f),!0;case 4:return b.fn.call(b.context,d,f,h),!0;case 5:return b.fn.call(b.context,d,f,h,p),!0;case 6:return b.fn.call(b.context,d,f,h,p,x),!0}for(k=1,m=new Array(y-1);k<y;k++)m[k-1]=arguments[k];b.fn.apply(b.context,m)}else{var S=b.length,w;for(k=0;k<S;k++)switch(b[k].once&&this.removeListener(u,b[k].fn,void 0,!0),y){case 1:b[k].fn.call(b[k].context);break;case 2:b[k].fn.call(b[k].context,d);break;case 3:b[k].fn.call(b[k].context,d,f);break;case 4:b[k].fn.call(b[k].context,d,f,h);break;default:if(!m)for(w=1,m=new Array(y-1);w<y;w++)m[w-1]=arguments[w];b[k].fn.apply(b[k].context,m)}}return!0},s.prototype.on=function(u,d,f){return i(this,u,d,f,!1)},s.prototype.once=function(u,d,f){return i(this,u,d,f,!0)},s.prototype.removeListener=function(u,d,f,h){var p=r?r+u:u;if(!this._events[p])return this;if(!d)return o(this,p),this;var x=this._events[p];if(x.fn)x.fn===d&&(!h||x.once)&&(!f||x.context===f)&&o(this,p);else{for(var g=0,b=[],y=x.length;g<y;g++)(x[g].fn!==d||h&&!x[g].once||f&&x[g].context!==f)&&b.push(x[g]);b.length?this._events[p]=b.length===1?b[0]:b:o(this,p)}return this},s.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(YA);var Kie=YA.exports;const Yie=Vr(Kie);var ry=new Yie,ny="recharts.syncMouseEvents";function qf(e){"@babel/helpers - typeof";return qf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},qf(e)}function qie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Zie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,qA(n.key),n)}}function Jie(e,t,r){return t&&Zie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function ay(e,t,r){return t=qA(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qA(e){var t=Qie(e,"string");return qf(t)=="symbol"?t:t+""}function Qie(e,t){if(qf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(qf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var eoe=function(){function e(){qie(this,e),ay(this,"activeIndex",0),ay(this,"coordinateList",[]),ay(this,"layout","horizontal")}return Jie(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,i=a===void 0?null:a,o=r.container,s=o===void 0?null:o,l=r.layout,u=l===void 0?null:l,d=r.offset,f=d===void 0?null:d,h=r.mouseHandlerCallback,p=h===void 0?null:h;this.coordinateList=(n=i??this.coordinateList)!==null&&n!==void 0?n:[],this.container=s??this.container,this.layout=u??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),i=a.x,o=a.y,s=a.height,l=this.coordinateList[this.activeIndex].coordinate,u=((r=window)===null||r===void 0?void 0:r.scrollX)||0,d=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=i+l+u,h=o+this.offset.top+s/2+d;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function toe(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],a=e==null?void 0:e[1];if(n&&a&&Ge(n)&&Ge(a))return!0}return!1}function roe(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function ZA(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,i=e.endAngle,o=Qn(t,r,n,a),s=Qn(t,r,n,i);return{points:[o,s],cx:t,cy:r,radius:n,startAngle:a,endAngle:i}}function noe(e,t,r){var n,a,i,o;if(e==="horizontal")n=t.x,i=n,a=r.top,o=r.top+r.height;else if(e==="vertical")a=t.y,o=a,n=r.left,i=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var s=t.cx,l=t.cy,u=t.innerRadius,d=t.outerRadius,f=t.angle,h=Qn(s,l,u,f),p=Qn(s,l,d,f);n=h.x,a=h.y,i=p.x,o=p.y}else return ZA(t);return[{x:n,y:a},{x:i,y:o}]}function Zf(e){"@babel/helpers - typeof";return Zf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zf(e)}function e4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function sh(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?e4(Object(r),!0).forEach(function(n){aoe(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):e4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function aoe(e,t,r){return t=ioe(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ioe(e){var t=ooe(e,"string");return Zf(t)=="symbol"?t:t+""}function ooe(e,t){if(Zf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Zf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function soe(e){var t,r,n=e.element,a=e.tooltipEventType,i=e.isActive,o=e.activeCoordinate,s=e.activePayload,l=e.offset,u=e.activeTooltipIndex,d=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,p=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!p||!i||!o||h!=="ScatterChart"&&a!=="axis")return null;var x,g=_l;if(h==="ScatterChart")x=o,g=Eee;else if(h==="BarChart")x=roe(f,o,l,d),g=rw;else if(f==="radial"){var b=ZA(o),y=b.cx,m=b.cy,k=b.radius,S=b.startAngle,w=b.endAngle;x={cx:y,cy:m,startAngle:S,endAngle:w,innerRadius:k,outerRadius:k},g=HC}else x={points:noe(f,o,l)},g=_l;var v=sh(sh(sh(sh({stroke:"#ccc",pointerEvents:"none"},l),x),Qt(p,!1)),{},{payload:s,payloadIndex:u,className:kr("recharts-tooltip-cursor",p.className)});return j.isValidElement(p)?j.cloneElement(p,v):j.createElement(g,v)}var loe=["item"],coe=["children","className","width","height","style","compact","title","desc"];function Nu(e){"@babel/helpers - typeof";return Nu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nu(e)}function Tc(){return Tc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Tc.apply(this,arguments)}function t4(e,t){return foe(e)||doe(e,t)||QA(e,t)||uoe()}function uoe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function doe(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function foe(e){if(Array.isArray(e))return e}function r4(e,t){if(e==null)return{};var r=hoe(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function hoe(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function poe(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function moe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,eO(n.key),n)}}function goe(e,t,r){return t&&moe(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function xoe(e,t,r){return t=dm(t),yoe(e,JA()?Reflect.construct(t,r||[],dm(e).constructor):t.apply(e,r))}function yoe(e,t){if(t&&(Nu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return boe(e)}function boe(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function JA(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(JA=function(){return!!e})()}function dm(e){return dm=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},dm(e)}function voe(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Gb(e,t)}function Gb(e,t){return Gb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Gb(e,t)}function _u(e){return Soe(e)||koe(e)||QA(e)||woe()}function woe(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function QA(e,t){if(e){if(typeof e=="string")return Ub(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ub(e,t)}}function koe(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Soe(e){if(Array.isArray(e))return Ub(e)}function Ub(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function n4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?n4(Object(r),!0).forEach(function(n){Et(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):n4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Et(e,t,r){return t=eO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eO(e){var t=Moe(e,"string");return Nu(t)=="symbol"?t:t+""}function Moe(e,t){if(Nu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Nu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var joe={xAxis:["bottom","top"],yAxis:["left","right"]},Noe={width:"100%",height:"100%"},tO={x:0,y:0};function lh(e){return e}var _oe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},Poe=function(t,r,n,a){var i=r.find(function(d){return d&&d.index===n});if(i){if(t==="horizontal")return{x:i.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:i.coordinate};if(t==="centric"){var o=i.coordinate,s=a.radius;return ve(ve(ve({},a),Qn(a.cx,a.cy,s,o)),{},{angle:o,radius:s})}var l=i.coordinate,u=a.angle;return ve(ve(ve({},a),Qn(a.cx,a.cy,l,u)),{},{angle:u,radius:l})}return tO},Sg=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,i=r.dataEndIndex,o=(n??[]).reduce(function(s,l){var u=l.props.data;return u&&u.length?[].concat(_u(s),_u(u)):s},[]);return o.length>0?o:t&&t.length&&Ge(a)&&Ge(i)?t.slice(a,i+1):[]};function rO(e){return e==="number"?[0,"auto"]:void 0}var zb=function(t,r,n,a){var i=t.graphicalItems,o=t.tooltipAxis,s=Sg(r,t);return n<0||!i||!i.length||n>=s.length?null:i.reduce(function(l,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(o.dataKey&&!o.allowDuplicatedCategory){var p=f===void 0?s:f;h=cp(p,o.dataKey,a)}else h=f&&f[n]||s[n];return h?[].concat(_u(l),[zC(u,h)]):l},[])},a4=function(t,r,n,a){var i=a||{x:t.chartX,y:t.chartY},o=_oe(i,n),s=t.orderedTooltipTicks,l=t.tooltipAxis,u=t.tooltipTicks,d=dZ(o,s,u,l);if(d>=0&&u){var f=u[d]&&u[d].value,h=zb(t,r,d,f),p=Poe(n,s,d,i);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},Coe=function(t,r){var n=r.axes,a=r.graphicalItems,i=r.axisType,o=r.axisIdKey,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=BC(d,i);return n.reduce(function(x,g){var b,y=g.type.defaultProps!==void 0?ve(ve({},g.type.defaultProps),g.props):g.props,m=y.type,k=y.dataKey,S=y.allowDataOverflow,w=y.allowDuplicatedCategory,v=y.scale,M=y.ticks,N=y.includeHidden,_=y[o];if(x[_])return x;var P=Sg(t.data,{graphicalItems:a.filter(function(W){var H,Y=o in W.props?W.props[o]:(H=W.type.defaultProps)===null||H===void 0?void 0:H[o];return Y===_}),dataStartIndex:l,dataEndIndex:u}),E=P.length,R,T,G;toe(y.domain,S,m)&&(R=nb(y.domain,null,S),p&&(m==="number"||v!=="auto")&&(G=Vd(P,k,"category")));var L=rO(m);if(!R||R.length===0){var C,$=(C=y.domain)!==null&&C!==void 0?C:L;if(k){if(R=Vd(P,k,m),m==="category"&&p){var A=J$(R);w&&A?(T=R,R=Yp(0,E)):w||(R=R5($,R,g).reduce(function(W,H){return W.indexOf(H)>=0?W:[].concat(_u(W),[H])},[]))}else if(m==="category")w?R=R.filter(function(W){return W!==""&&!Yt(W)}):R=R5($,R,g).reduce(function(W,H){return W.indexOf(H)>=0||H===""||Yt(H)?W:[].concat(_u(W),[H])},[]);else if(m==="number"){var O=gZ(P,a.filter(function(W){var H,Y,te=o in W.props?W.props[o]:(H=W.type.defaultProps)===null||H===void 0?void 0:H[o],U="hide"in W.props?W.props.hide:(Y=W.type.defaultProps)===null||Y===void 0?void 0:Y.hide;return te===_&&(N||!U)}),k,i,d);O&&(R=O)}p&&(m==="number"||v!=="auto")&&(G=Vd(P,k,"category"))}else p?R=Yp(0,E):s&&s[_]&&s[_].hasStack&&m==="number"?R=h==="expand"?[0,1]:UC(s[_].stackGroups,l,u):R=FC(P,a.filter(function(W){var H=o in W.props?W.props[o]:W.type.defaultProps[o],Y="hide"in W.props?W.props.hide:W.type.defaultProps.hide;return H===_&&(N||!Y)}),m,d,!0);if(m==="number")R=Bb(f,R,_,i,M),$&&(R=nb($,R,S));else if(m==="category"&&$){var F=$,D=R.every(function(W){return F.indexOf(W)>=0});D&&(R=F)}}return ve(ve({},x),{},Et({},_,ve(ve({},y),{},{axisType:i,domain:R,categoricalDomain:G,duplicateDomain:T,originalDomain:(b=y.domain)!==null&&b!==void 0?b:L,isCategorical:p,layout:d})))},{})},Aoe=function(t,r){var n=r.graphicalItems,a=r.Axis,i=r.axisType,o=r.axisIdKey,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=Sg(t.data,{graphicalItems:n,dataStartIndex:l,dataEndIndex:u}),p=h.length,x=BC(d,i),g=-1;return n.reduce(function(b,y){var m=y.type.defaultProps!==void 0?ve(ve({},y.type.defaultProps),y.props):y.props,k=m[o],S=rO("number");if(!b[k]){g++;var w;return x?w=Yp(0,p):s&&s[k]&&s[k].hasStack?(w=UC(s[k].stackGroups,l,u),w=Bb(f,w,k,i)):(w=nb(S,FC(h,n.filter(function(v){var M,N,_=o in v.props?v.props[o]:(M=v.type.defaultProps)===null||M===void 0?void 0:M[o],P="hide"in v.props?v.props.hide:(N=v.type.defaultProps)===null||N===void 0?void 0:N.hide;return _===k&&!P}),"number",d),a.defaultProps.allowDataOverflow),w=Bb(f,w,k,i)),ve(ve({},b),{},Et({},k,ve(ve({axisType:i},a.defaultProps),{},{hide:!0,orientation:gi(joe,"".concat(i,".").concat(g%2),null),domain:w,originalDomain:S,isCategorical:x,layout:d})))}return b},{})},Ooe=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,i=r.AxisComp,o=r.graphicalItems,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.children,f="".concat(a,"Id"),h=Fa(d,i),p={};return h&&h.length?p=Coe(t,{axes:h,graphicalItems:o,axisType:a,axisIdKey:f,stackGroups:s,dataStartIndex:l,dataEndIndex:u}):o&&o.length&&(p=Aoe(t,{Axis:i,graphicalItems:o,axisType:a,axisIdKey:f,stackGroups:s,dataStartIndex:l,dataEndIndex:u})),p},Toe=function(t){var r=hs(t),n=Co(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:P2(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:Fp(r,n)}},i4=function(t){var r=t.children,n=t.defaultShowTooltip,a=Ka(r,pu),i=0,o=0;return t.data&&t.data.length!==0&&(o=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(i=a.props.startIndex),a.props.endIndex>=0&&(o=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:i,dataEndIndex:o,activeTooltipIndex:-1,isTooltipActive:!!n}},Eoe=function(t){return!t||!t.length?!1:t.some(function(r){var n=Oo(r&&r.type);return n&&n.indexOf("Bar")>=0})},o4=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},Ioe=function(t,r){var n=t.props,a=t.graphicalItems,i=t.xAxisMap,o=i===void 0?{}:i,s=t.yAxisMap,l=s===void 0?{}:s,u=n.width,d=n.height,f=n.children,h=n.margin||{},p=Ka(f,pu),x=Ka(f,ro),g=Object.keys(l).reduce(function(w,v){var M=l[v],N=M.orientation;return!M.mirror&&!M.hide?ve(ve({},w),{},Et({},N,w[N]+M.width)):w},{left:h.left||0,right:h.right||0}),b=Object.keys(o).reduce(function(w,v){var M=o[v],N=M.orientation;return!M.mirror&&!M.hide?ve(ve({},w),{},Et({},N,gi(w,"".concat(N))+M.height)):w},{top:h.top||0,bottom:h.bottom||0}),y=ve(ve({},b),g),m=y.bottom;p&&(y.bottom+=p.props.height||pu.defaultProps.height),x&&r&&(y=pZ(y,a,n,r));var k=u-y.left-y.right,S=d-y.top-y.bottom;return ve(ve({brushBottom:m},y),{},{width:Math.max(k,0),height:Math.max(S,0)})},Roe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},fw=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,i=a===void 0?"axis":a,o=t.validateTooltipEventTypes,s=o===void 0?["axis"]:o,l=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(y,m){var k=m.graphicalItems,S=m.stackGroups,w=m.offset,v=m.updateId,M=m.dataStartIndex,N=m.dataEndIndex,_=y.barSize,P=y.layout,E=y.barGap,R=y.barCategoryGap,T=y.maxBarSize,G=o4(P),L=G.numericAxisName,C=G.cateAxisName,$=Eoe(k),A=[];return k.forEach(function(O,F){var D=Sg(y.data,{graphicalItems:[O],dataStartIndex:M,dataEndIndex:N}),W=O.type.defaultProps!==void 0?ve(ve({},O.type.defaultProps),O.props):O.props,H=W.dataKey,Y=W.maxBarSize,te=W["".concat(L,"Id")],U=W["".concat(C,"Id")],Se={},re=l.reduce(function(K,_e){var Te=m["".concat(_e.axisType,"Map")],Le=W["".concat(_e.axisType,"Id")];Te&&Te[Le]||_e.axisType==="zAxis"||Vl();var ft=Te[Le];return ve(ve({},K),{},Et(Et({},_e.axisType,ft),"".concat(_e.axisType,"Ticks"),Co(ft)))},Se),J=re[C],ne=re["".concat(C,"Ticks")],ce=S&&S[te]&&S[te].hasStack&&PZ(O,S[te].stackGroups),ie=Oo(O.type).indexOf("Bar")>=0,se=Fp(J,ne),oe=[],ke=$&&fZ({barSize:_,stackGroups:S,totalSize:Roe(re,C)});if(ie){var le,fe,Pe=Yt(Y)?T:Y,Fe=(le=(fe=Fp(J,ne,!0))!==null&&fe!==void 0?fe:Pe)!==null&&le!==void 0?le:0;oe=hZ({barGap:E,barCategoryGap:R,bandSize:Fe!==se?Fe:se,sizeList:ke[U],maxBarSize:Pe}),Fe!==se&&(oe=oe.map(function(K){return ve(ve({},K),{},{position:ve(ve({},K.position),{},{offset:K.position.offset-Fe/2})})}))}var Ue=O&&O.type&&O.type.getComposedData;Ue&&A.push({props:ve(ve({},Ue(ve(ve({},re),{},{displayedData:D,props:y,dataKey:H,item:O,bandSize:se,barPosition:oe,offset:w,stackedData:ce,layout:P,dataStartIndex:M,dataEndIndex:N}))),{},Et(Et(Et({key:O.key||"item-".concat(F)},L,re[L]),C,re[C]),"animationId",v)),childIndex:d9(O,y.children),item:O})}),A},p=function(y,m){var k=y.props,S=y.dataStartIndex,w=y.dataEndIndex,v=y.updateId;if(!C3({props:k}))return null;var M=k.children,N=k.layout,_=k.stackOffset,P=k.data,E=k.reverseStackOrder,R=o4(N),T=R.numericAxisName,G=R.cateAxisName,L=Fa(M,n),C=jZ(P,L,"".concat(T,"Id"),"".concat(G,"Id"),_,E),$=l.reduce(function(W,H){var Y="".concat(H.axisType,"Map");return ve(ve({},W),{},Et({},Y,Ooe(k,ve(ve({},H),{},{graphicalItems:L,stackGroups:H.axisType===T&&C,dataStartIndex:S,dataEndIndex:w}))))},{}),A=Ioe(ve(ve({},$),{},{props:k,graphicalItems:L}),m==null?void 0:m.legendBBox);Object.keys($).forEach(function(W){$[W]=d(k,$[W],A,W.replace("Map",""),r)});var O=$["".concat(G,"Map")],F=Toe(O),D=h(k,ve(ve({},$),{},{dataStartIndex:S,dataEndIndex:w,updateId:v,graphicalItems:L,stackGroups:C,offset:A}));return ve(ve({formattedGraphicalItems:D,graphicalItems:L,offset:A,stackGroups:C},F),$)},x=function(b){function y(m){var k,S,w;return poe(this,y),w=xoe(this,y,[m]),Et(w,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),Et(w,"accessibilityManager",new eoe),Et(w,"handleLegendBBoxUpdate",function(v){if(v){var M=w.state,N=M.dataStartIndex,_=M.dataEndIndex,P=M.updateId;w.setState(ve({legendBBox:v},p({props:w.props,dataStartIndex:N,dataEndIndex:_,updateId:P},ve(ve({},w.state),{},{legendBBox:v}))))}}),Et(w,"handleReceiveSyncEvent",function(v,M,N){if(w.props.syncId===v){if(N===w.eventEmitterSymbol&&typeof w.props.syncMethod!="function")return;w.applySyncEvent(M)}}),Et(w,"handleBrushChange",function(v){var M=v.startIndex,N=v.endIndex;if(M!==w.state.dataStartIndex||N!==w.state.dataEndIndex){var _=w.state.updateId;w.setState(function(){return ve({dataStartIndex:M,dataEndIndex:N},p({props:w.props,dataStartIndex:M,dataEndIndex:N,updateId:_},w.state))}),w.triggerSyncEvent({dataStartIndex:M,dataEndIndex:N})}}),Et(w,"handleMouseEnter",function(v){var M=w.getMouseInfo(v);if(M){var N=ve(ve({},M),{},{isTooltipActive:!0});w.setState(N),w.triggerSyncEvent(N);var _=w.props.onMouseEnter;ar(_)&&_(N,v)}}),Et(w,"triggeredAfterMouseMove",function(v){var M=w.getMouseInfo(v),N=M?ve(ve({},M),{},{isTooltipActive:!0}):{isTooltipActive:!1};w.setState(N),w.triggerSyncEvent(N);var _=w.props.onMouseMove;ar(_)&&_(N,v)}),Et(w,"handleItemMouseEnter",function(v){w.setState(function(){return{isTooltipActive:!0,activeItem:v,activePayload:v.tooltipPayload,activeCoordinate:v.tooltipPosition||{x:v.cx,y:v.cy}}})}),Et(w,"handleItemMouseLeave",function(){w.setState(function(){return{isTooltipActive:!1}})}),Et(w,"handleMouseMove",function(v){v.persist(),w.throttleTriggeredAfterMouseMove(v)}),Et(w,"handleMouseLeave",function(v){w.throttleTriggeredAfterMouseMove.cancel();var M={isTooltipActive:!1};w.setState(M),w.triggerSyncEvent(M);var N=w.props.onMouseLeave;ar(N)&&N(M,v)}),Et(w,"handleOuterEvent",function(v){var M=u9(v),N=gi(w.props,"".concat(M));if(M&&ar(N)){var _,P;/.*touch.*/i.test(M)?P=w.getMouseInfo(v.changedTouches[0]):P=w.getMouseInfo(v),N((_=P)!==null&&_!==void 0?_:{},v)}}),Et(w,"handleClick",function(v){var M=w.getMouseInfo(v);if(M){var N=ve(ve({},M),{},{isTooltipActive:!0});w.setState(N),w.triggerSyncEvent(N);var _=w.props.onClick;ar(_)&&_(N,v)}}),Et(w,"handleMouseDown",function(v){var M=w.props.onMouseDown;if(ar(M)){var N=w.getMouseInfo(v);M(N,v)}}),Et(w,"handleMouseUp",function(v){var M=w.props.onMouseUp;if(ar(M)){var N=w.getMouseInfo(v);M(N,v)}}),Et(w,"handleTouchMove",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.throttleTriggeredAfterMouseMove(v.changedTouches[0])}),Et(w,"handleTouchStart",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.handleMouseDown(v.changedTouches[0])}),Et(w,"handleTouchEnd",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.handleMouseUp(v.changedTouches[0])}),Et(w,"handleDoubleClick",function(v){var M=w.props.onDoubleClick;if(ar(M)){var N=w.getMouseInfo(v);M(N,v)}}),Et(w,"handleContextMenu",function(v){var M=w.props.onContextMenu;if(ar(M)){var N=w.getMouseInfo(v);M(N,v)}}),Et(w,"triggerSyncEvent",function(v){w.props.syncId!==void 0&&ry.emit(ny,w.props.syncId,v,w.eventEmitterSymbol)}),Et(w,"applySyncEvent",function(v){var M=w.props,N=M.layout,_=M.syncMethod,P=w.state.updateId,E=v.dataStartIndex,R=v.dataEndIndex;if(v.dataStartIndex!==void 0||v.dataEndIndex!==void 0)w.setState(ve({dataStartIndex:E,dataEndIndex:R},p({props:w.props,dataStartIndex:E,dataEndIndex:R,updateId:P},w.state)));else if(v.activeTooltipIndex!==void 0){var T=v.chartX,G=v.chartY,L=v.activeTooltipIndex,C=w.state,$=C.offset,A=C.tooltipTicks;if(!$)return;if(typeof _=="function")L=_(A,v);else if(_==="value"){L=-1;for(var O=0;O<A.length;O++)if(A[O].value===v.activeLabel){L=O;break}}var F=ve(ve({},$),{},{x:$.left,y:$.top}),D=Math.min(T,F.x+F.width),W=Math.min(G,F.y+F.height),H=A[L]&&A[L].value,Y=zb(w.state,w.props.data,L),te=A[L]?{x:N==="horizontal"?A[L].coordinate:D,y:N==="horizontal"?W:A[L].coordinate}:tO;w.setState(ve(ve({},v),{},{activeLabel:H,activeCoordinate:te,activePayload:Y,activeTooltipIndex:L}))}else w.setState(v)}),Et(w,"renderCursor",function(v){var M,N=w.state,_=N.isTooltipActive,P=N.activeCoordinate,E=N.activePayload,R=N.offset,T=N.activeTooltipIndex,G=N.tooltipAxisBandSize,L=w.getTooltipEventType(),C=(M=v.props.active)!==null&&M!==void 0?M:_,$=w.props.layout,A=v.key||"_recharts-cursor";return ee.createElement(soe,{key:A,activeCoordinate:P,activePayload:E,activeTooltipIndex:T,chartName:r,element:v,isActive:C,layout:$,offset:R,tooltipAxisBandSize:G,tooltipEventType:L})}),Et(w,"renderPolarAxis",function(v,M,N){var _=gi(v,"type.axisType"),P=gi(w.state,"".concat(_,"Map")),E=v.type.defaultProps,R=E!==void 0?ve(ve({},E),v.props):v.props,T=P&&P[R["".concat(_,"Id")]];return j.cloneElement(v,ve(ve({},T),{},{className:kr(_,T.className),key:v.key||"".concat(M,"-").concat(N),ticks:Co(T,!0)}))}),Et(w,"renderPolarGrid",function(v){var M=v.props,N=M.radialLines,_=M.polarAngles,P=M.polarRadius,E=w.state,R=E.radiusAxisMap,T=E.angleAxisMap,G=hs(R),L=hs(T),C=L.cx,$=L.cy,A=L.innerRadius,O=L.outerRadius;return j.cloneElement(v,{polarAngles:Array.isArray(_)?_:Co(L,!0).map(function(F){return F.coordinate}),polarRadius:Array.isArray(P)?P:Co(G,!0).map(function(F){return F.coordinate}),cx:C,cy:$,innerRadius:A,outerRadius:O,key:v.key||"polar-grid",radialLines:N})}),Et(w,"renderLegend",function(){var v=w.state.formattedGraphicalItems,M=w.props,N=M.children,_=M.width,P=M.height,E=w.props.margin||{},R=_-(E.left||0)-(E.right||0),T=$C({children:N,formattedGraphicalItems:v,legendWidth:R,legendContent:u});if(!T)return null;var G=T.item,L=r4(T,loe);return j.cloneElement(G,ve(ve({},L),{},{chartWidth:_,chartHeight:P,margin:E,onBBoxUpdate:w.handleLegendBBoxUpdate}))}),Et(w,"renderTooltip",function(){var v,M=w.props,N=M.children,_=M.accessibilityLayer,P=Ka(N,$n);if(!P)return null;var E=w.state,R=E.isTooltipActive,T=E.activeCoordinate,G=E.activePayload,L=E.activeLabel,C=E.offset,$=(v=P.props.active)!==null&&v!==void 0?v:R;return j.cloneElement(P,{viewBox:ve(ve({},C),{},{x:C.left,y:C.top}),active:$,label:L,payload:$?G:[],coordinate:T,accessibilityLayer:_})}),Et(w,"renderBrush",function(v){var M=w.props,N=M.margin,_=M.data,P=w.state,E=P.offset,R=P.dataStartIndex,T=P.dataEndIndex,G=P.updateId;return j.cloneElement(v,{key:v.key||"_recharts-brush",onChange:nh(w.handleBrushChange,v.props.onChange),data:_,x:Ge(v.props.x)?v.props.x:E.left,y:Ge(v.props.y)?v.props.y:E.top+E.height+E.brushBottom-(N.bottom||0),width:Ge(v.props.width)?v.props.width:E.width,startIndex:R,endIndex:T,updateId:"brush-".concat(G)})}),Et(w,"renderReferenceElement",function(v,M,N){if(!v)return null;var _=w,P=_.clipPathId,E=w.state,R=E.xAxisMap,T=E.yAxisMap,G=E.offset,L=v.type.defaultProps||{},C=v.props,$=C.xAxisId,A=$===void 0?L.xAxisId:$,O=C.yAxisId,F=O===void 0?L.yAxisId:O;return j.cloneElement(v,{key:v.key||"".concat(M,"-").concat(N),xAxis:R[A],yAxis:T[F],viewBox:{x:G.left,y:G.top,width:G.width,height:G.height},clipPathId:P})}),Et(w,"renderActivePoints",function(v){var M=v.item,N=v.activePoint,_=v.basePoint,P=v.childIndex,E=v.isRange,R=[],T=M.props.key,G=M.item.type.defaultProps!==void 0?ve(ve({},M.item.type.defaultProps),M.item.props):M.item.props,L=G.activeDot,C=G.dataKey,$=ve(ve({index:P,dataKey:C,cx:N.x,cy:N.y,r:4,fill:tw(M.item),strokeWidth:2,stroke:"#fff",payload:N.payload,value:N.value},Qt(L,!1)),up(L));return R.push(y.renderActiveDot(L,$,"".concat(T,"-activePoint-").concat(P))),_?R.push(y.renderActiveDot(L,ve(ve({},$),{},{cx:_.x,cy:_.y}),"".concat(T,"-basePoint-").concat(P))):E&&R.push(null),R}),Et(w,"renderGraphicChild",function(v,M,N){var _=w.filterFormatItem(v,M,N);if(!_)return null;var P=w.getTooltipEventType(),E=w.state,R=E.isTooltipActive,T=E.tooltipAxis,G=E.activeTooltipIndex,L=E.activeLabel,C=w.props.children,$=Ka(C,$n),A=_.props,O=A.points,F=A.isRange,D=A.baseLine,W=_.item.type.defaultProps!==void 0?ve(ve({},_.item.type.defaultProps),_.item.props):_.item.props,H=W.activeDot,Y=W.hide,te=W.activeBar,U=W.activeShape,Se=!!(!Y&&R&&$&&(H||te||U)),re={};P!=="axis"&&$&&$.props.trigger==="click"?re={onClick:nh(w.handleItemMouseEnter,v.props.onClick)}:P!=="axis"&&(re={onMouseLeave:nh(w.handleItemMouseLeave,v.props.onMouseLeave),onMouseEnter:nh(w.handleItemMouseEnter,v.props.onMouseEnter)});var J=j.cloneElement(v,ve(ve({},_.props),re));function ne(_e){return typeof T.dataKey=="function"?T.dataKey(_e.payload):null}if(Se)if(G>=0){var ce,ie;if(T.dataKey&&!T.allowDuplicatedCategory){var se=typeof T.dataKey=="function"?ne:"payload.".concat(T.dataKey.toString());ce=cp(O,se,L),ie=F&&D&&cp(D,se,L)}else ce=O==null?void 0:O[G],ie=F&&D&&D[G];if(U||te){var oe=v.props.activeIndex!==void 0?v.props.activeIndex:G;return[j.cloneElement(v,ve(ve(ve({},_.props),re),{},{activeIndex:oe})),null,null]}if(!Yt(ce))return[J].concat(_u(w.renderActivePoints({item:_,activePoint:ce,basePoint:ie,childIndex:G,isRange:F})))}else{var ke,le=(ke=w.getItemByXY(w.state.activeCoordinate))!==null&&ke!==void 0?ke:{graphicalItem:J},fe=le.graphicalItem,Pe=fe.item,Fe=Pe===void 0?v:Pe,Ue=fe.childIndex,K=ve(ve(ve({},_.props),re),{},{activeIndex:Ue});return[j.cloneElement(Fe,K),null,null]}return F?[J,null,null]:[J,null]}),Et(w,"renderCustomized",function(v,M,N){return j.cloneElement(v,ve(ve({key:"recharts-customized-".concat(N)},w.props),w.state))}),Et(w,"renderMap",{CartesianGrid:{handler:lh,once:!0},ReferenceArea:{handler:w.renderReferenceElement},ReferenceLine:{handler:lh},ReferenceDot:{handler:w.renderReferenceElement},XAxis:{handler:lh},YAxis:{handler:lh},Brush:{handler:w.renderBrush,once:!0},Bar:{handler:w.renderGraphicChild},Line:{handler:w.renderGraphicChild},Area:{handler:w.renderGraphicChild},Radar:{handler:w.renderGraphicChild},RadialBar:{handler:w.renderGraphicChild},Scatter:{handler:w.renderGraphicChild},Pie:{handler:w.renderGraphicChild},Funnel:{handler:w.renderGraphicChild},Tooltip:{handler:w.renderCursor,once:!0},PolarGrid:{handler:w.renderPolarGrid,once:!0},PolarAngleAxis:{handler:w.renderPolarAxis},PolarRadiusAxis:{handler:w.renderPolarAxis},Customized:{handler:w.renderCustomized}}),w.clipPathId="".concat((k=m.id)!==null&&k!==void 0?k:Jl("recharts"),"-clip"),w.throttleTriggeredAfterMouseMove=LP(w.triggeredAfterMouseMove,(S=m.throttleDelay)!==null&&S!==void 0?S:1e3/60),w.state={},w}return voe(y,b),goe(y,[{key:"componentDidMount",value:function(){var k,S;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(k=this.props.margin.left)!==null&&k!==void 0?k:0,top:(S=this.props.margin.top)!==null&&S!==void 0?S:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var k=this.props,S=k.children,w=k.data,v=k.height,M=k.layout,N=Ka(S,$n);if(N){var _=N.props.defaultIndex;if(!(typeof _!="number"||_<0||_>this.state.tooltipTicks.length-1)){var P=this.state.tooltipTicks[_]&&this.state.tooltipTicks[_].value,E=zb(this.state,w,_,P),R=this.state.tooltipTicks[_].coordinate,T=(this.state.offset.top+v)/2,G=M==="horizontal",L=G?{x:R,y:T}:{y:R,x:T},C=this.state.formattedGraphicalItems.find(function(A){var O=A.item;return O.type.name==="Scatter"});C&&(L=ve(ve({},L),C.props.points[_].tooltipPosition),E=C.props.points[_].tooltipPayload);var $={activeTooltipIndex:_,isTooltipActive:!0,activeLabel:P,activePayload:E,activeCoordinate:L};this.setState($),this.renderCursor(N),this.accessibilityManager.setIndex(_)}}}},{key:"getSnapshotBeforeUpdate",value:function(k,S){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==S.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==k.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==k.margin){var w,v;this.accessibilityManager.setDetails({offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(v=this.props.margin.top)!==null&&v!==void 0?v:0}})}return null}},{key:"componentDidUpdate",value:function(k){y1([Ka(k.children,$n)],[Ka(this.props.children,$n)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var k=Ka(this.props.children,$n);if(k&&typeof k.props.shared=="boolean"){var S=k.props.shared?"axis":"item";return s.indexOf(S)>=0?S:i}return i}},{key:"getMouseInfo",value:function(k){if(!this.container)return null;var S=this.container,w=S.getBoundingClientRect(),v=$H(w),M={chartX:Math.round(k.pageX-v.left),chartY:Math.round(k.pageY-v.top)},N=w.width/S.offsetWidth||1,_=this.inRange(M.chartX,M.chartY,N);if(!_)return null;var P=this.state,E=P.xAxisMap,R=P.yAxisMap,T=this.getTooltipEventType(),G=a4(this.state,this.props.data,this.props.layout,_);if(T!=="axis"&&E&&R){var L=hs(E).scale,C=hs(R).scale,$=L&&L.invert?L.invert(M.chartX):null,A=C&&C.invert?C.invert(M.chartY):null;return ve(ve({},M),{},{xValue:$,yValue:A},G)}return G?ve(ve({},M),G):null}},{key:"inRange",value:function(k,S){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,v=this.props.layout,M=k/w,N=S/w;if(v==="horizontal"||v==="vertical"){var _=this.state.offset,P=M>=_.left&&M<=_.left+_.width&&N>=_.top&&N<=_.top+_.height;return P?{x:M,y:N}:null}var E=this.state,R=E.angleAxisMap,T=E.radiusAxisMap;if(R&&T){var G=hs(R);return L5({x:M,y:N},G)}return null}},{key:"parseEventsOfWrapper",value:function(){var k=this.props.children,S=this.getTooltipEventType(),w=Ka(k,$n),v={};w&&S==="axis"&&(w.props.trigger==="click"?v={onClick:this.handleClick}:v={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var M=up(this.props,this.handleOuterEvent);return ve(ve({},M),v)}},{key:"addListener",value:function(){ry.on(ny,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){ry.removeListener(ny,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(k,S,w){for(var v=this.state.formattedGraphicalItems,M=0,N=v.length;M<N;M++){var _=v[M];if(_.item===k||_.props.key===k.key||S===Oo(_.item.type)&&w===_.childIndex)return _}return null}},{key:"renderClipPath",value:function(){var k=this.clipPathId,S=this.state.offset,w=S.left,v=S.top,M=S.height,N=S.width;return ee.createElement("defs",null,ee.createElement("clipPath",{id:k},ee.createElement("rect",{x:w,y:v,height:M,width:N})))}},{key:"getXScales",value:function(){var k=this.state.xAxisMap;return k?Object.entries(k).reduce(function(S,w){var v=t4(w,2),M=v[0],N=v[1];return ve(ve({},S),{},Et({},M,N.scale))},{}):null}},{key:"getYScales",value:function(){var k=this.state.yAxisMap;return k?Object.entries(k).reduce(function(S,w){var v=t4(w,2),M=v[0],N=v[1];return ve(ve({},S),{},Et({},M,N.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(k){var S;return(S=this.state.xAxisMap)===null||S===void 0||(S=S[k])===null||S===void 0?void 0:S.scale}},{key:"getYScaleByAxisId",value:function(k){var S;return(S=this.state.yAxisMap)===null||S===void 0||(S=S[k])===null||S===void 0?void 0:S.scale}},{key:"getItemByXY",value:function(k){var S=this.state,w=S.formattedGraphicalItems,v=S.activeItem;if(w&&w.length)for(var M=0,N=w.length;M<N;M++){var _=w[M],P=_.props,E=_.item,R=E.type.defaultProps!==void 0?ve(ve({},E.type.defaultProps),E.props):E.props,T=Oo(E.type);if(T==="Bar"){var G=(P.data||[]).find(function(A){return See(k,A)});if(G)return{graphicalItem:_,payload:G}}else if(T==="RadialBar"){var L=(P.data||[]).find(function(A){return L5(k,A)});if(L)return{graphicalItem:_,payload:L}}else if(xg(_,v)||yg(_,v)||Vf(_,v)){var C=jte({graphicalItem:_,activeTooltipItem:v,itemData:R.data}),$=R.activeIndex===void 0?C:R.activeIndex;return{graphicalItem:ve(ve({},_),{},{childIndex:$}),payload:Vf(_,v)?R.data[C]:_.props.data[C]}}}return null}},{key:"render",value:function(){var k=this;if(!C3(this))return null;var S=this.props,w=S.children,v=S.className,M=S.width,N=S.height,_=S.style,P=S.compact,E=S.title,R=S.desc,T=r4(S,coe),G=Qt(T,!1);if(P)return ee.createElement(EM,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ee.createElement(v1,Tc({},G,{width:M,height:N,title:E,desc:R}),this.renderClipPath(),O3(w,this.renderMap)));if(this.props.accessibilityLayer){var L,C;G.tabIndex=(L=this.props.tabIndex)!==null&&L!==void 0?L:0,G.role=(C=this.props.role)!==null&&C!==void 0?C:"application",G.onKeyDown=function(A){k.accessibilityManager.keyboardEvent(A)},G.onFocus=function(){k.accessibilityManager.focus()}}var $=this.parseEventsOfWrapper();return ee.createElement(EM,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},ee.createElement("div",Tc({className:kr("recharts-wrapper",v),style:ve({position:"relative",cursor:"default",width:M,height:N},_)},$,{ref:function(O){k.container=O}}),ee.createElement(v1,Tc({},G,{width:M,height:N,title:E,desc:R,style:Noe}),this.renderClipPath(),O3(w,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(j.Component);Et(x,"displayName",r),Et(x,"defaultProps",ve({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),Et(x,"getDerivedStateFromProps",function(b,y){var m=b.dataKey,k=b.data,S=b.children,w=b.width,v=b.height,M=b.layout,N=b.stackOffset,_=b.margin,P=y.dataStartIndex,E=y.dataEndIndex;if(y.updateId===void 0){var R=i4(b);return ve(ve(ve({},R),{},{updateId:0},p(ve(ve({props:b},R),{},{updateId:0}),y)),{},{prevDataKey:m,prevData:k,prevWidth:w,prevHeight:v,prevLayout:M,prevStackOffset:N,prevMargin:_,prevChildren:S})}if(m!==y.prevDataKey||k!==y.prevData||w!==y.prevWidth||v!==y.prevHeight||M!==y.prevLayout||N!==y.prevStackOffset||!Uc(_,y.prevMargin)){var T=i4(b),G={chartX:y.chartX,chartY:y.chartY,isTooltipActive:y.isTooltipActive},L=ve(ve({},a4(y,k,M)),{},{updateId:y.updateId+1}),C=ve(ve(ve({},T),G),L);return ve(ve(ve({},C),p(ve({props:b},C),y)),{},{prevDataKey:m,prevData:k,prevWidth:w,prevHeight:v,prevLayout:M,prevStackOffset:N,prevMargin:_,prevChildren:S})}if(!y1(S,y.prevChildren)){var $,A,O,F,D=Ka(S,pu),W=D&&($=(A=D.props)===null||A===void 0?void 0:A.startIndex)!==null&&$!==void 0?$:P,H=D&&(O=(F=D.props)===null||F===void 0?void 0:F.endIndex)!==null&&O!==void 0?O:E,Y=W!==P||H!==E,te=!Yt(k),U=te&&!Y?y.updateId:y.updateId+1;return ve(ve({updateId:U},p(ve(ve({props:b},y),{},{updateId:U,dataStartIndex:W,dataEndIndex:H}),y)),{},{prevChildren:S,dataStartIndex:W,dataEndIndex:H})}return null}),Et(x,"renderActiveDot",function(b,y,m){var k;return j.isValidElement(b)?k=j.cloneElement(b,y):ar(b)?k=b(y):k=ee.createElement(gg,y),ee.createElement(Er,{className:"recharts-active-dot",key:m},k)});var g=j.forwardRef(function(y,m){return ee.createElement(x,Tc({},y,{ref:m}))});return g.displayName=x.displayName,g},wl=fw({chartName:"LineChart",GraphicalChild:Ln,axisComponents:[{axisType:"xAxis",AxisComp:wa},{axisType:"yAxis",AxisComp:ka}],formatAxisMap:nw}),Doe=fw({chartName:"ScatterChart",GraphicalChild:xa,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:wa},{axisType:"yAxis",AxisComp:ka},{axisType:"zAxis",AxisComp:kg}],formatAxisMap:nw}),nO=fw({chartName:"AreaChart",GraphicalChild:pi,axisComponents:[{axisType:"xAxis",AxisComp:wa},{axisType:"yAxis",AxisComp:ka}],formatAxisMap:nw});const $oe={keys:["R","G","B"],keyToIndex:{R:0,G:1,B:2},availableIndices:[0,1,2],indexLabels:{0:"Red",1:"Green",2:"Blue",3:"Unused"},histogramLabels:{c0:"Red",c1:"Green",c2:"Blue",c3:"Unused"},colors:{c0:"#ef4444",c1:"#22c55e",c2:"#3b82f6",c3:"#64748b"},selfAdjacentStep:1,defaultPrimaryKey:"G",defaultSecondaryKey:"B"},Loe={keys:["R","G1","G2","B"],keyToIndex:{R:0,G1:1,G2:2,B:3},availableIndices:[0,1,2,3],indexLabels:{0:"Red",1:"Green 1",2:"Green 2",3:"Blue"},histogramLabels:{c0:"Red",c1:"Green 1",c2:"Green 2",c3:"Blue"},colors:{c0:"#ef4444",c1:"#22c55e",c2:"#4ade80",c3:"#3b82f6"},selfAdjacentStep:2,defaultPrimaryKey:"G1",defaultSecondaryKey:"B"},Foe={keys:["B","G1","G2","R"],keyToIndex:{B:0,G1:1,G2:2,R:3},availableIndices:[0,1,2,3],indexLabels:{0:"Blue",1:"Green 1",2:"Green 2",3:"Red"},histogramLabels:{c0:"Blue",c1:"Green 1",c2:"Green 2",c3:"Red"},colors:{c0:"#3b82f6",c1:"#22c55e",c2:"#4ade80",c3:"#ef4444"},selfAdjacentStep:2,defaultPrimaryKey:"G1",defaultSecondaryKey:"R"},Mg=(e,t)=>e?$oe:t?Foe:Loe,wo=(e,t)=>{const r=localStorage.getItem(e);return r===null?t:typeof t=="boolean"?r==="true":typeof t=="number"?Number(r):r},Boe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,zIndex:o,onFocus:s,initialPosition:l,initialInternalState:u,onUpdateState:d,stackFiles:f})=>{const h=!!(n!=null&&n.isThreePlane),p=j.useMemo(()=>Mg(h,i),[h,i]),[x,g]=j.useState(()=>(u==null?void 0:u.channelMode)??wo("hist_mode","All")),[b,y]=j.useState(()=>(u==null?void 0:u.minVal)??wo("hist_min",0)),[m,k]=j.useState(()=>(u==null?void 0:u.maxVal)??wo("hist_max",16383)),[S,w]=j.useState(()=>(u==null?void 0:u.binCount)??wo("hist_bins",100)),[v,M]=j.useState(()=>(u==null?void 0:u.pointToPoint)??wo("hist_ptp",!1)),[N,_]=j.useState(()=>(u==null?void 0:u.showTheo)??wo("hist_show_theo",!1)),[P,E]=j.useState(()=>(u==null?void 0:u.theoMean)??wo("hist_theo_mean","512")),[R,T]=j.useState(()=>(u==null?void 0:u.theoSigma)??wo("hist_theo_sigma","10")),[G,L]=j.useState(()=>(u==null?void 0:u.theoAmp)??wo("hist_theo_amp","1000")),[C,$]=j.useState(!1),[A,O]=j.useState(0),[F,D]=j.useState([]),[W,H]=j.useState(null),[Y,te]=j.useState(l||{x:100,y:100}),[U,Se]=j.useState(!1),re=j.useRef({x:0,y:0});j.useEffect(()=>{x!=="All"&&!p.availableIndices.includes(Number(x))&&g("All")},[x,p]),j.useEffect(()=>{localStorage.setItem("hist_mode",x),localStorage.setItem("hist_min",String(b)),localStorage.setItem("hist_max",String(m)),localStorage.setItem("hist_bins",String(S)),localStorage.setItem("hist_ptp",String(v)),localStorage.setItem("hist_show_theo",String(N)),localStorage.setItem("hist_theo_mean",P),localStorage.setItem("hist_theo_sigma",R),localStorage.setItem("hist_theo_amp",G),d&&d({channelMode:x,minVal:b,maxVal:m,binCount:S,pointToPoint:v,showTheo:N,theoMean:P,theoSigma:R,theoAmp:G})},[x,b,m,S,v,N,P,R,G]),j.useEffect(()=>{if(!e||!a||!n&&(!f||f.length===0))return;if(m<=b){H("Invalid range: Max must be greater than Min");return}H(null),$(!0),O(0);const fe=new AbortController,Pe=[],Ue=setTimeout(async()=>{try{let K=[];if(f&&f.length>1){const _e=Math.min(f.length,navigator.hardwareConcurrency||4);for(let Ie=0;Ie<_e;Ie++){const ht=new Worker(new URL("/assets/histogramWorker-dnUrfHr1.js",import.meta.url),{type:"module"});Pe.push(ht)}let Te=0,Le=0;const ft=[],Xe=async Ie=>{for(;Te<f.length;){if(fe.signal.aborted)return;const ht=Te++,xt=f[ht];try{const nt=await xt.arrayBuffer();await new Promise((Gt,yt)=>{Ie.onmessage=et=>{const{success:He,hist:mt,error:jt}=et.data;He?(ft.push(mt),Le++,O(Le),Gt()):(console.error(`Error processing ${xt.name}:`,jt),Gt())},Ie.onerror=et=>{console.error("Worker Error",et),Gt()},Ie.postMessage({buffer:nt,roi:a,binCount:S,minVal:b,maxVal:m,pointToPoint:v},[nt])})}catch(nt){console.error("File Read Error",nt)}}};if(await Promise.all(Pe.map(Ie=>Xe(Ie))),Pe.forEach(Ie=>Ie.terminate()),Pe.length=0,ft.length>0){K=ft[0];for(let Ie=1;Ie<ft.length;Ie++){const ht=ft[Ie];for(let xt=0;xt<ht.length;xt++)K[xt]&&(K[xt].c0+=ht[xt].c0,K[xt].c1+=ht[xt].c1,K[xt].c2+=ht[xt].c2,K[xt].c3+=ht[xt].c3)}}}else n&&(K=Y8(n.data,n.width,n.height,a.x,a.y,a.w,a.h,S,b,m,v,!!n.isThreePlane));fe.signal.aborted||D(K)}catch(K){console.error("Histogram calc error:",K),H("Error calculating histogram")}finally{fe.signal.aborted||$(!1)}},50);return()=>{clearTimeout(Ue),fe.abort(),Pe.length>0&&(console.log(`Terminating ${Pe.length} active histogram workers...`),Pe.forEach(K=>K.terminate()))}},[e,n,a==null?void 0:a.x,a==null?void 0:a.y,a==null?void 0:a.w,a==null?void 0:a.h,S,b,m,v,f]);const J=j.useMemo(()=>{if(!N)return F;const fe=parseFloat(P),Pe=parseFloat(R),Fe=parseFloat(G);return isNaN(fe)||isNaN(Pe)||isNaN(Fe)||Pe<=0?F:F.map(Ue=>{const K=Ue.binStart,_e=-Math.pow(K-fe,2)/(2*Math.pow(Pe,2)),Te=Fe*Math.exp(_e);return{...Ue,theory:Te}})},[F,N,P,R,G]),ne=()=>{if(F.length===0)return;let fe=0,Pe=0;if(F.forEach(Fe=>{const Ue=p.availableIndices.reduce((K,_e)=>{const Te=Fe[`c${_e}`]||0;return Math.max(K,Te)},0);Ue>fe&&(fe=Ue,Pe=Fe.binStart)}),E(Pe.toFixed(2)),L(fe.toString()),parseFloat(R)===0||isNaN(parseFloat(R))){const Fe=m-b;T((Fe/20).toFixed(2))}},ce=(fe,Pe,Fe)=>{s&&s(),!(Fe.closest("button")||Fe.closest("input")||Fe.closest("select"))&&(Se(!0),re.current={x:fe-Y.x,y:Pe-Y.y})},ie=fe=>{ce(fe.clientX,fe.clientY,fe.target)},se=fe=>{const Pe=fe.touches[0];ce(Pe.clientX,Pe.clientY,fe.target)};if(j.useEffect(()=>{const fe=Fe=>{if(U){const Ue="touches"in Fe?Fe.touches[0].clientX:Fe.clientX,K="touches"in Fe?Fe.touches[0].clientY:Fe.clientY;te({x:Ue-re.current.x,y:K-re.current.y})}},Pe=()=>Se(!1);return U&&(window.addEventListener("mousemove",fe),window.addEventListener("mouseup",Pe),window.addEventListener("touchmove",fe,{passive:!1}),window.addEventListener("touchend",Pe)),()=>{window.removeEventListener("mousemove",fe),window.removeEventListener("mouseup",Pe),window.removeEventListener("touchmove",fe),window.removeEventListener("touchend",Pe)}},[U]),!e)return null;const oe=p.histogramLabels,ke=p.colors,le="step";return c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl resize-both overflow-hidden min-w-[500px] min-h-[400px] w-[900px] h-[650px]",style:{left:Y.x,top:Y.y,zIndex:o??100},onMouseDownCapture:s,children:[c.jsxs("div",{className:`flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 flex-shrink-0 bg-white dark:bg-slate-900 select-none touch-none ${U?"cursor-grabbing":"cursor-grab"}`,onMouseDown:ie,onTouchStart:se,children:[c.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 pointer-events-none flex items-center gap-2",children:["ROI Histogram",f&&f.length>1&&c.jsxs("span",{className:"text-[10px] font-normal bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded border border-purple-200 dark:border-purple-800 shadow-sm",children:["Stack Count: ",f.length]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-slate-800/50 flex flex-wrap gap-x-6 gap-y-3 items-center border-b border-gray-200 dark:border-slate-700 text-xs flex-shrink-0 relative z-10",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold uppercase tracking-tight",children:"Channel:"}),c.jsxs("select",{value:x,onChange:fe=>g(fe.target.value),className:"bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-cyan-500",children:[c.jsx("option",{value:"All",children:"All Colors"}),p.availableIndices.map(fe=>{const Pe=`c${fe}`;return c.jsx("option",{value:String(fe),children:oe[Pe]},fe)})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold uppercase tracking-tight",children:"Range:"}),c.jsx("input",{type:"number",value:b,onChange:fe=>y(Number(fe.target.value)),className:"w-16 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",value:m,onChange:fe=>k(Number(fe.target.value)),className:"w-16 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:v,onChange:fe=>M(fe.target.checked),className:"w-3.5 h-3.5 text-cyan-600 rounded border-gray-300 focus:ring-cyan-500"}),c.jsx("span",{className:"text-gray-700 dark:text-slate-300 select-none font-semibold",children:"PTP"})]}),!v&&c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"Bins:"}),c.jsx("input",{type:"number",value:S,onChange:fe=>w(Math.max(1,Number(fe.target.value))),className:"w-12 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"})]})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700"}),c.jsxs("div",{className:`flex items-center gap-3 p-1.5 rounded-lg border transition-all ${N?"bg-amber-50/30 dark:bg-amber-900/10 border-amber-200/50 dark:border-amber-800/50":"bg-transparent border-transparent"}`,children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:N,onChange:fe=>_(fe.target.checked),className:"w-3.5 h-3.5 text-amber-500 rounded border-gray-300 focus:ring-amber-500 bg-white dark:bg-slate-700"}),c.jsx("span",{className:`font-bold uppercase tracking-tight ${N?"text-amber-600 dark:text-amber-400":"text-gray-400"}`,children:"Theoretical Bell"})]}),N&&c.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-left-2 duration-200",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Mean()"}),c.jsx("input",{type:"text",value:P,onChange:fe=>E(fe.target.value),className:"w-14 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Sigma()"}),c.jsx("input",{type:"text",value:R,onChange:fe=>T(fe.target.value),className:"w-12 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Scale(A)"}),c.jsx("input",{type:"text",value:G,onChange:fe=>L(fe.target.value),className:"w-16 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsx("button",{onClick:ne,className:"mt-3 px-2 py-0.5 bg-amber-600 hover:bg-amber-500 text-white text-[9px] font-bold rounded shadow-sm active:scale-95 transition-all",title:"Set Mean and Amplitude based on current peak",children:"AUTO FIT"})]})]})]}),c.jsxs("div",{className:"flex-1 p-4 relative bg-white dark:bg-slate-900 overflow-hidden min-h-0",children:[c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 pointer-events-none select-none opacity-10 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),C&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 bg-white/50 dark:bg-slate-900/50 backdrop-blur-[1px]",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mb-2"}),c.jsx("span",{className:"text-sm text-cyan-600 dark:text-cyan-400 font-semibold",children:f&&f.length>1?`Stacking Histogram... ${A}/${f.length}`:"Calculating Histogram..."})]}),W?c.jsx("div",{className:"flex items-center justify-center h-full text-red-500 relative z-10",children:W}):c.jsx("div",{className:"relative z-10 w-full h-full",children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:J,children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),c.jsx(wa,{dataKey:"binStart",type:"number",domain:[b,m],tickFormatter:fe=>Math.floor(fe).toString(),tick:{fill:"#9ca3af",fontSize:12},allowDataOverflow:!0,label:{value:"DN Value",position:"insideBottom",offset:-5,fill:"#9ca3af",fontSize:12}}),c.jsx(ka,{tick:{fill:"#9ca3af",fontSize:12},label:{value:"Count",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12}}),c.jsx($n,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6"},itemStyle:{fontSize:"12px"},labelFormatter:fe=>`DN: ${Math.round(Number(fe))}`,formatter:(fe,Pe)=>[Math.round(fe),Pe]}),c.jsx(ro,{wrapperStyle:{paddingTop:"10px"}}),N&&c.jsx(Ln,{type:"monotone",dataKey:"theory",name:"Ideal Bell (Gaussian)",stroke:"#f59e0b",strokeWidth:2.5,strokeDasharray:"5 5",dot:!1,isAnimationActive:!1}),p.availableIndices.map(fe=>{if(x!=="All"&&x!==String(fe))return null;const Pe=`c${fe}`;return c.jsx(Ln,{type:le,dataKey:Pe,name:oe[Pe],stroke:ke[Pe],dot:!1,strokeWidth:1.5,activeDot:{r:4},isAnimationActive:!1},Pe)})]})})})]})]})},qs=({initialPosition:e={x:20,y:80},children:t,className:r="",onClose:n,zIndex:a,onFocus:i})=>{const[o,s]=j.useState(e),[l,u]=j.useState(!1),[d,f]=j.useState({x:0,y:0}),h=j.useRef(null),p=(b,y,m)=>{i&&i(),!(m.closest("button")||m.closest("input"))&&(u(!0),f({x:b-o.x,y:y-o.y}))},x=b=>{p(b.clientX,b.clientY,b.target)},g=b=>{const y=b.touches[0];p(y.clientX,y.clientY,b.target)};return j.useEffect(()=>{const b=m=>{var k,S;if(l){m.cancelable&&m.preventDefault();const w="touches"in m?m.touches[0].clientX:m.clientX,v="touches"in m?m.touches[0].clientY:m.clientY,M=w-d.x,N=v-d.y,_=window.innerWidth-(((k=h.current)==null?void 0:k.offsetWidth)||100),P=window.innerHeight-(((S=h.current)==null?void 0:S.offsetHeight)||100);s({x:Math.max(0,Math.min(M,_)),y:Math.max(0,Math.min(N,P))})}},y=()=>{u(!1)};return l&&(window.addEventListener("mousemove",b),window.addEventListener("mouseup",y),window.addEventListener("touchmove",b,{passive:!1}),window.addEventListener("touchend",y)),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",y)}},[l,d]),c.jsxs("div",{ref:h,style:{left:o.x,top:o.y,zIndex:a??90},onMouseDownCapture:i,className:`fixed border-2 border-black dark:border-gray-500 bg-white dark:bg-black shadow-[8px_8px_0px_rgba(0,0,0,0.5)] dark:shadow-[8px_8px_0px_rgba(255,255,255,0.2)] transition-shadow duration-200 ${l?"cursor-grabbing shadow-[4px_4px_0px_rgba(0,0,0,0.5)]":""} ${r}`,children:[c.jsx("div",{onMouseDown:x,onTouchStart:g,className:"absolute inset-0 w-full h-8 cursor-grab active:cursor-grabbing z-0 touch-none bg-gray-200 dark:bg-gray-800 border-b-2 border-black dark:border-gray-500",title:"Drag to move"}),c.jsx("div",{className:"relative z-10 pointer-events-none",children:c.jsx("div",{className:"pointer-events-auto",children:t})})]})},Goe=({isOpen:e,onClose:t,rawImageData:r,roi:n,selectedChannel:a,channelName:i,zIndex:o,onFocus:s,initialPosition:l})=>{const u=j.useRef(null),[d,f]=j.useState(!1),[h,p]=j.useState(null),[x,g]=j.useState(null),[b,y]=j.useState(!0),[m,k]=j.useState(!0),[S,w]=j.useState("-1"),[v,M]=j.useState("8"),[N,_]=j.useState(64),[P,E]=j.useState(45),[R,T]=j.useState(60),G=j.useRef(!1),L=j.useRef({x:0,y:0});j.useEffect(()=>{!e||!r||!n||(f(!0),g(null),setTimeout(()=>{try{const O=Z8(r.data,r.width,r.height,n,a,m,!!r.isThreePlane);O?p(O):g("Could not extract valid data from ROI.")}catch(O){console.error("2D FFT Error",O),g("Calculation Error: "+O.message)}finally{f(!1)}},50))},[e,r,n,a,m]),j.useEffect(()=>{if(!h||!u.current)return;const O=u.current,F=O.getContext("2d");if(!F)return;const D=O.width,W=O.height;F.clearRect(0,0,D,W),F.fillStyle="#0f172a",F.fillRect(0,0,D,W);const H=h.width,Y=h.height,te=h.data,U=Math.pow(10,parseFloat(S)||-1),Se=Math.pow(10,parseFloat(v)||8);let re=U,J=Se;b&&(re=Math.log10(Math.max(1e-10,U)),J=Math.log10(Math.max(1e-10,Se)));const ne=J-re||1,ce=D/2,ie=W/2+50,se=Math.min(D,W)*.4,oe=.6,ke=P*Math.PI/180,le=R*Math.PI/180,fe=Math.cos(ke),Pe=Math.sin(ke),Fe=Math.cos(le),Ue=Math.sin(le),K=(et,He,mt)=>{const jt=et*fe-He*Pe,or=et*Pe+He*fe,zt=or*Fe-mt*Ue,ut=or*Ue+mt*Fe;return{x:ce+jt*se,y:ie-zt*se,depth:ut}},_e=Math.max(16,N),Te=Math.max(1,Math.floor(H/_e)),Le=Math.max(1,Math.floor(Y/_e)),ft=(et,He)=>{let mt=te[He*H+et];return b&&(mt=Math.log10(Math.max(1e-10,mt))),mt=Math.max(re,Math.min(J,mt)),(mt-re)/ne},Xe=et=>`hsl(${(1-et)*240}, 80%, 50%)`,Ie=[];for(let et=0;et<Y-Le;et+=Le)for(let He=0;He<H-Te;He+=Te){const mt=He,jt=et,or=He+Te,zt=et,ut=He+Te,It=et+Le,Lt=He,Me=et+Le,Z=ft(mt,jt),xe=ft(or,zt),ue=ft(ut,It),De=ft(Lt,Me),qe=(Z+xe+ue+De)/4,pt=K(mt/(H-1)-.5,jt/(Y-1)-.5,Z*oe),de=K(or/(H-1)-.5,zt/(Y-1)-.5,xe*oe),Ce=K(ut/(H-1)-.5,It/(Y-1)-.5,ue*oe),dt=K(Lt/(H-1)-.5,Me/(Y-1)-.5,De*oe),Wt=(pt.depth+de.depth+Ce.depth+dt.depth)/4;Ie.push({pts:[{x:pt.x,y:pt.y},{x:de.x,y:de.y},{x:Ce.x,y:Ce.y},{x:dt.x,y:dt.y}],avgDepth:Wt,avgZ:qe})}Ie.sort((et,He)=>et.avgDepth-He.avgDepth),F.lineWidth=.5,Ie.forEach(et=>{F.fillStyle=Xe(et.avgZ),F.beginPath(),F.moveTo(et.pts[0].x,et.pts[0].y),F.lineTo(et.pts[1].x,et.pts[1].y),F.lineTo(et.pts[2].x,et.pts[2].y),F.lineTo(et.pts[3].x,et.pts[3].y),F.closePath(),F.fill()}),F.fillStyle="#aaa",F.font="10px monospace";const ht=K(-.5,-.5,0),xt=K(.5,-.5,0),nt=K(-.5,.5,0),Gt=K(.5,.5,0);F.strokeStyle="#666",F.beginPath(),F.moveTo(ht.x,ht.y),F.lineTo(xt.x,xt.y),F.lineTo(Gt.x,Gt.y),F.lineTo(nt.x,nt.y),F.closePath(),F.stroke(),F.fillText("0",ht.x-10,ht.y+10),F.fillText("Fx",xt.x+5,xt.y),F.fillText("Fy",nt.x-15,nt.y);const yt=K(-.5,-.5,oe);F.strokeStyle="#fff",F.beginPath(),F.moveTo(ht.x,ht.y),F.lineTo(yt.x,yt.y),F.stroke(),F.fillText(`10^${v}`,yt.x-25,yt.y),F.fillText(`10^${S}`,ht.x-25,ht.y)},[h,b,P,R,S,v,N]);const C=O=>{G.current=!0,L.current={x:O.clientX,y:O.clientY}},$=O=>{if(!G.current)return;const F=O.clientX-L.current.x,D=O.clientY-L.current.y;E(W=>W-F*.5),T(W=>Math.max(0,Math.min(90,W+D*.5))),L.current={x:O.clientX,y:O.clientY}},A=()=>{G.current=!1};return e?c.jsxs(qs,{initialPosition:l||{x:100,y:100},onClose:t,zIndex:o,onFocus:s,className:"w-[700px] h-[600px] bg-slate-900 border border-slate-700 flex flex-col overflow-hidden shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b border-slate-700 bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-200 flex items-center gap-2",children:["2D FFT Power Spectrum - ",i,h&&c.jsxs("span",{className:"text-[10px] font-normal text-slate-400 bg-slate-700 px-2 py-0.5 rounded",children:[h.width,"x",h.height," (Chirp-Z)"]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("button",{onClick:t,className:"text-slate-400 hover:text-red-400 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),c.jsxs("div",{className:"p-3 bg-slate-800/80 flex flex-wrap gap-4 text-xs items-center border-b border-slate-700",children:[c.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 px-2 py-1 rounded border border-slate-600",children:[c.jsx("span",{className:"text-slate-400 font-bold",children:"Range (10^x):"}),c.jsx("input",{type:"number",value:S,onChange:O=>w(O.target.value),className:"w-10 bg-transparent text-slate-200 text-center border-b border-slate-600 focus:border-cyan-500 outline-none"}),c.jsx("span",{className:"text-slate-500",children:"to"}),c.jsx("input",{type:"number",value:v,onChange:O=>M(O.target.value),className:"w-10 bg-transparent text-slate-200 text-center border-b border-slate-600 focus:border-cyan-500 outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 px-2 py-1 rounded border border-slate-600",children:[c.jsx("span",{className:"text-slate-400 font-bold",children:"Density:"}),c.jsx("input",{type:"range",min:"16",max:"128",step:"16",value:N,onChange:O=>_(Number(O.target.value)),className:"w-20 h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),c.jsx("span",{className:"text-slate-300 w-6 text-right",children:N})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none text-slate-300 hover:text-white",children:[c.jsx("input",{type:"checkbox",checked:b,onChange:O=>y(O.target.checked),className:"rounded bg-slate-700 border-slate-600 accent-cyan-500"}),"Log Z"]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none text-slate-300 hover:text-white",children:[c.jsx("input",{type:"checkbox",checked:m,onChange:O=>k(O.target.checked),className:"rounded bg-slate-700 border-slate-600 accent-fuchsia-500"}),"Hanning"]})]}),c.jsxs("div",{className:"flex-1 relative bg-slate-900 cursor-move",children:[d&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80 z-20 backdrop-blur-sm",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"}),c.jsx("span",{className:"text-cyan-400 font-bold animate-pulse text-sm",children:"Computing full-size 2D FFT..."})]})}),x&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80 z-20 text-red-400 p-4 text-center",children:x}),c.jsx("canvas",{ref:u,width:700,height:500,className:"w-full h-full block",onMouseDown:C,onMouseMove:$,onMouseUp:A,onMouseLeave:A}),c.jsx("div",{className:"absolute bottom-2 right-2 text-[9px] text-slate-600 pointer-events-none",children:"Drag to Rotate"})]})]}):null},Uoe=.5,Wb=1e-10,s4=(e,t)=>{const r=e.length-1;if(r<0)return Wb;const n=t/Uoe*r,a=Math.round(n),i=e[Math.min(Math.max(0,a),r)]||0;return Math.max(i,Wb)},zoe=(e,t)=>{if(t<=0)return[1];const r=new Array(e);let n=0;for(let a=0;a<e;a++){const i=a-(e-1)/2,o=Math.exp(-(i*i)/(2*t*t));r[a]=o,n+=o}for(let a=0;a<e;a++)r[a]/=n;return r},Woe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,onUpdateROI:o,zIndex:s,onFocus:l,initialPosition:u,initialInternalState:d,onUpdateState:f,stackFiles:h})=>{const[p,x]=j.useState((d==null?void 0:d.selectedChannel)??0),[g,b]=j.useState(()=>(d==null?void 0:d.yMinExp)||localStorage.getItem("fft_y_min")||"1.73"),[y,m]=j.useState(()=>(d==null?void 0:d.yMaxExp)||localStorage.getItem("fft_y_max")||"8.00"),[k,S]=j.useState((d==null?void 0:d.useHanning)??!0),[w,v]=j.useState((d==null?void 0:d.doAverage)??!0),[M,N]=j.useState((d==null?void 0:d.welchSegments)??1),[_,P]=j.useState((d==null?void 0:d.showH)??!0),[E,R]=j.useState((d==null?void 0:d.showV)??!0),[T,G]=j.useState((d==null?void 0:d.interlaceRows)??!1),[L,C]=j.useState((d==null?void 0:d.rowGroup)??0),[$,A]=j.useState((d==null?void 0:d.interlaceCols)??!1),[O,F]=j.useState((d==null?void 0:d.colGroup)??0),[D,W]=j.useState(()=>(d==null?void 0:d.theoSigma)||localStorage.getItem("fft_theo_sigma")||"0.00"),[H,Y]=j.useState(()=>(d==null?void 0:d.theoKernelSize)||localStorage.getItem("fft_theo_ksize")||"3"),[te,U]=j.useState(()=>(d==null?void 0:d.theoNoiseStd)||localStorage.getItem("fft_theo_noise")||"7.5"),[Se,re]=j.useState(()=>(d==null?void 0:d.theoScale)||localStorage.getItem("fft_theo_scale")||"1.0"),[J,ne]=j.useState((d==null?void 0:d.intStart)||"0"),[ce,ie]=j.useState((d==null?void 0:d.intEnd)||"0.5"),[se,oe]=j.useState(!1),[ke,le]=j.useState([]),[fe,Pe]=j.useState(!1),[Fe,Ue]=j.useState(0),[K,_e]=j.useState(null),[Te,Le]=j.useState(!1),[ft,Xe]=j.useState(!1),[Ie,ht]=j.useState(null),[xt,nt]=j.useState(!1),[Gt,yt]=j.useState(null),[et,He]=j.useState(u||{x:50,y:50}),[mt,jt]=j.useState(!1),[or,zt]=j.useState(null),[ut,It]=j.useState({}),Lt=j.useRef({x:0,y:0}),Me=!!(n!=null&&n.isThreePlane),Z=j.useMemo(()=>Mg(Me,i),[Me,i]),xe=Z.availableIndices,ue=Z.colors,De=Z.indexLabels;j.useEffect(()=>{p!==-1&&!xe.includes(p)&&x(xe[0])},[p,xe]),j.useEffect(()=>{localStorage.setItem("fft_y_min",g),localStorage.setItem("fft_y_max",y),localStorage.setItem("fft_theo_sigma",D),localStorage.setItem("fft_theo_ksize",H),localStorage.setItem("fft_theo_noise",te),localStorage.setItem("fft_theo_scale",Se)},[g,y,D,H,te,Se]),j.useEffect(()=>{if(!e||!n||!a)return;Pe(!0),_e(null),Ue(0);const be=setTimeout(async()=>{try{const tt=p===-1?xe:[p],it=h&&h.length>1?h:[null],Zt=it.length,Vt={};let ot={h:0,v:0};for(let Ht=0;Ht<Zt;Ht++){Ue(Ht+1);let Dt;if(it[Ht]){const Ee=await it[Ht].arrayBuffer();Dt=await Bl(Ee)}else Dt=n;for(const Ee of tt){const er=q8(Dt.data,Dt.width,Dt.height,a,Ee,!1,k,{rows:T,rowGroup:L,cols:$,colGroup:O},w,M,!!Dt.isThreePlane);er&&(Vt[Ee]||(Vt[Ee]={h:new Array(er.avgHoriz.length).fill(0),v:new Array(er.avgVert.length).fill(0)}),er.avgHoriz.forEach((B,ge)=>Vt[Ee].h[ge]+=B/Zt),er.avgVert.forEach((B,ge)=>Vt[Ee].v[ge]+=B/Zt),ot=er.sampleCount)}}if(Object.keys(Vt).length===0)throw new Error("ROI too small or no data found.");const ir=1024,yr=[];for(let Ht=0;Ht<ir;Ht++){const Dt=Ht/(ir-1)*.5,Ee={freq:parseFloat(Dt.toFixed(6))};for(const er of tt)Vt[er]&&(Ee[`c${er}_h`]=s4(Vt[er].h,Dt),Ee[`c${er}_v`]=s4(Vt[er].v,Dt));yr.push(Ee)}zt(ot),le(yr)}catch(tt){console.error("FFT Loop Failed:",tt),_e(tt.message||"Unknown error during FFT processing")}finally{Pe(!1)}},100);return()=>clearTimeout(be)},[e,n,a==null?void 0:a.x,a==null?void 0:a.y,a==null?void 0:a.w,a==null?void 0:a.h,p,k,w,M,T,L,$,O,h,xe]);const qe=()=>{const be=parseFloat(J),tt=parseFloat(ce);if(isNaN(be)||isNaN(tt))return;const it={},Zt=p===-1?xe:[p],Vt=ke.filter(ot=>ot.freq>=be&&ot.freq<=tt);if(Vt.length===0){It({});return}Zt.forEach(ot=>{let ir=0,yr=0;Vt.forEach(Ht=>{const Dt=Ht[`c${ot}_h`],Ee=Ht[`c${ot}_v`];typeof Dt=="number"&&(ir+=Dt),typeof Ee=="number"&&(yr+=Ee)}),it[ot]={h:ir/Vt.length,v:yr/Vt.length,count:Vt.length}}),It(it)},pt=j.useMemo(()=>{const be=parseFloat(D),tt=parseInt(H),it=parseFloat(te),Zt=parseFloat(Se);if(isNaN(be)||isNaN(tt)||isNaN(it)||isNaN(Zt)||ke.length===0)return ke;const Vt=zoe(tt,be),ot=Vt.reduce((Ht,Dt)=>Ht+Dt*Dt,0),ir=(tt-1)/2,yr=it*it*Zt;return ke.map(Ht=>{const Dt=Ht.freq,Ee=2*Math.PI*Dt;let er=0,B=0;for(let ye=0;ye<tt;ye++){const vt=ye-ir,We=Vt[ye],st=-Ee*vt;er+=We*Math.cos(st),B+=We*Math.sin(st)}const ge=er*er+B*B;return{...Ht,theory:Math.max(Wb,yr*ot*ge)}})},[ke,D,H,te,Se]),de=be=>{be&&be.activeLabel!==void 0&&(nt(!0),yt(Number(be.activeLabel)),ht(null))},Ce=be=>{if(xt&&Gt!==null&&be&&be.activeLabel!==void 0){const tt=Number(be.activeLabel);ht([Math.min(Gt,tt),Math.max(Gt,tt)])}},dt=()=>nt(!1),Wt=(be,tt,it)=>{l&&l(),!(it.closest("button")||it.closest("input"))&&(jt(!0),Lt.current={x:be-et.x,y:tt-et.y})},Rt=be=>{Wt(be.clientX,be.clientY,be.target)},kt=be=>{const tt=be.touches[0];Wt(tt.clientX,tt.clientY,be.target)};j.useEffect(()=>{const be=it=>{if(mt){const Zt="touches"in it?it.touches[0].clientX:it.clientX,Vt="touches"in it?it.touches[0].clientY:it.clientY;He({x:Zt-Lt.current.x,y:Vt-Lt.current.y})}},tt=()=>jt(!1);return mt&&(window.addEventListener("mousemove",be),window.addEventListener("mouseup",tt),window.addEventListener("touchmove",be,{passive:!1}),window.addEventListener("touchend",tt)),()=>{window.removeEventListener("mousemove",be),window.removeEventListener("mouseup",tt),window.removeEventListener("touchmove",be),window.removeEventListener("touchend",tt)}},[mt]);const qt=j.useMemo(()=>{if(!Ie||ke.length===0)return null;const[be,tt]=Ie,it=ke.filter(ot=>ot.freq>=be&&ot.freq<=tt);if(it.length===0)return null;const Zt=p===-1?xe:[p],Vt={};return Zt.forEach(ot=>{["h","v"].forEach(ir=>{const yr=`c${ot}_${ir}`;let Ht=0,Dt=0;for(const Ee of it){const er=Ee[yr];typeof er=="number"&&(Ht+=er,Dt++)}Dt>0&&(Vt[`${yr}_sigma`]=Math.sqrt(Ht/Dt))})}),{count:it.length,stats:Vt}},[Ie,ke,p,xe]),xr=()=>{if(ke.length===0)return;let be=1/0,tt=-1/0;if(ke.forEach(ir=>{ir.freq<.01||ir.freq>.49||Object.keys(ir).forEach(yr=>{if(yr==="freq"||yr==="theory")return;const Ht=ir[yr];typeof Ht=="number"&&Ht>0&&(Ht<be&&(be=Ht),Ht>tt&&(tt=Ht))})}),be===1/0)return;const it=Math.log10(be),Zt=Math.log10(tt),Vt=Zt-it,ot=(Vt===0?1:Vt)*.1;b((it-ot).toFixed(2)),m((Zt+ot).toFixed(2))},Ir=(be,tt)=>{a&&o&&o({...a,x:a.x+be,y:a.y+tt})},fr=(be,tt)=>{a&&o&&o({...a,w:Math.max(2,a.w+be),h:Math.max(2,a.h+tt)})};return e?c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl overflow-hidden resize-both min-w-[750px] min-h-[500px]",style:{left:et.x,top:et.y,width:"1000px",height:"850px",zIndex:s??100},onMouseDownCapture:l,children:[c.jsxs("div",{className:`flex justify-between items-center p-3 border-b border-gray-200 dark:border-slate-700 flex-shrink-0 bg-gray-50 dark:bg-slate-800 z-50 relative select-none touch-none ${mt?"cursor-grabbing":"cursor-grab"}`,onMouseDown:Rt,onTouchStart:kt,children:[c.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2 pointer-events-none",children:["Power Spectrum Analysis",c.jsx("span",{className:"text-[10px] font-normal bg-white dark:bg-slate-700 px-2 py-1 rounded text-gray-500 border border-gray-200 dark:border-slate-600 shadow-sm",children:h&&h.length>1?`Stack Avg (${h.length} frames)`:"Single Mode"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"flex flex-col bg-gray-50 dark:bg-slate-900/80 border-b border-gray-200 dark:border-slate-800 flex-shrink-0 z-40 relative px-4 py-3 gap-3 overflow-x-auto",children:[c.jsxs("div",{className:"flex items-center gap-6",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase tracking-widest",children:"Channel"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 rounded-lg p-0.5 border border-gray-200 dark:border-slate-700 shadow-inner",children:[c.jsx("button",{onClick:()=>x(-1),className:`px-3 py-1 rounded text-[10px] font-bold transition-all ${p===-1?"bg-slate-700 text-white shadow-md":"text-gray-500 dark:text-slate-500 hover:bg-white dark:hover:bg-slate-700"}`,children:"All"}),xe.map(be=>c.jsx("button",{onClick:()=>x(be),className:`px-3 py-1 rounded text-[10px] font-bold transition-all ${p===be?"bg-cyan-600 text-white shadow-md":"text-gray-500 dark:text-slate-500 hover:bg-white dark:hover:bg-slate-700"}`,children:De[be]},be))]})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700 mx-2"}),c.jsxs("button",{onClick:()=>oe(!0),className:"flex items-center gap-1.5 px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-[10px] font-bold rounded-lg shadow-lg shadow-indigo-500/30 transition-all active:scale-95 group border border-indigo-400/30",children:[c.jsx("svg",{className:"w-3.5 h-3.5 group-hover:animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"2D Diagonal"]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700 mx-2"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-400 uppercase tracking-widest",children:"Model"}),c.jsx("div",{className:"flex gap-2",children:[{label:"KSize",val:H,set:Y,w:"w-10"},{label:"Sigma",val:D,set:W,w:"w-12"},{label:"Noise()",val:te,set:U,w:"w-12"},{label:"Scale",val:Se,set:re,w:"w-12"}].map(be=>c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[8px] text-gray-400 dark:text-slate-500 uppercase font-bold mb-0.5",children:be.label}),c.jsx("input",{type:"text",value:be.val,onChange:tt=>be.set(tt.target.value),className:`${be.w} text-[11px] bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-1.5 py-0.5 text-center text-gray-900 dark:text-slate-100 outline-none focus:border-indigo-500 shadow-sm`})]},be.label))})]})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[c.jsxs("div",{className:"flex items-center gap-3 mr-2",children:[c.jsx("span",{className:"text-[10px] font-bold text-fuchsia-600 dark:text-fuchsia-500 uppercase tracking-widest",children:"Welch"}),c.jsx("input",{type:"range",min:"1",max:"16",step:"1",value:M,onChange:be=>N(parseInt(be.target.value)),className:"w-24 h-1.5 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-fuchsia-500"}),c.jsx("span",{className:"text-[10px] font-mono text-fuchsia-600 dark:text-fuchsia-400 w-4 font-bold",children:M})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700"}),c.jsxs("div",{className:"flex flex-col gap-1 px-2",children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-[10px] text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-slate-200 select-none",children:[c.jsx("input",{type:"checkbox",checked:T,onChange:be=>G(be.target.checked),className:"w-3 h-3 rounded text-cyan-600 border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-800"})," Row Int."]}),c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-[10px] text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-slate-200 select-none",children:[c.jsx("input",{type:"checkbox",checked:$,onChange:be=>A(be.target.checked),className:"w-3 h-3 rounded text-cyan-600 border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-800"})," Col Int."]})]}),c.jsxs("div",{className:"flex flex-col gap-1.5 bg-gray-100 dark:bg-slate-800/60 p-1.5 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("div",{className:`w-3.5 h-3.5 rounded-md border flex items-center justify-center transition-colors ${k?"bg-fuchsia-600 border-fuchsia-600":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-600"}`,children:k&&c.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:4,children:c.jsx("path",{d:"M5 13l4 4L19 7"})})}),c.jsx("input",{type:"checkbox",checked:k,onChange:be=>S(be.target.checked),className:"hidden"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-700 dark:text-slate-300",children:"Hanning"})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("div",{className:`w-3.5 h-3.5 rounded-md border flex items-center justify-center transition-colors ${w?"bg-cyan-600 border-cyan-600":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-600"}`,children:w&&c.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:4,children:c.jsx("path",{d:"M5 13l4 4L19 7"})})}),c.jsx("input",{type:"checkbox",checked:w,onChange:be=>v(be.target.checked),className:"hidden"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-700 dark:text-slate-300",children:"Average"})]})]}),c.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("button",{onClick:()=>P(!_),className:`px-2.5 py-1 rounded-md border text-[11px] font-bold transition-all flex items-center gap-1.5 ${_?"bg-cyan-900/40 text-cyan-400 border-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.3)]":"bg-white dark:bg-slate-900 text-gray-400 border-gray-300 dark:border-slate-700"}`,children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${_?"bg-cyan-400":"bg-gray-400"}`})," H"]}),c.jsxs("button",{onClick:()=>R(!E),className:`px-2.5 py-1 rounded-md border text-[11px] font-bold transition-all flex items-center gap-1.5 ${E?"bg-cyan-900/40 text-cyan-400 border-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.3)]":"bg-white dark:bg-slate-900 text-gray-400 border-gray-300 dark:border-slate-700"}`,children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${_?"bg-cyan-400":"bg-gray-400"}`})," V"]})]}),c.jsxs("div",{className:"ml-auto flex gap-2",children:[c.jsx("button",{onClick:()=>Xe(!ft),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${ft?"bg-emerald-600 text-white border-emerald-600 shadow-md":"bg-white dark:bg-slate-900 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800 hover:bg-emerald-50"}`,children:""}),c.jsx("button",{onClick:()=>Le(!Te),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${Te?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-white dark:bg-slate-900 text-indigo-600 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800 hover:bg-indigo-50"}`,children:"ROI"})]})]}),c.jsxs("div",{className:"flex items-center gap-4 justify-end border-t border-gray-200 dark:border-slate-800/50 pt-2.5",children:[c.jsx("button",{onClick:xr,className:"px-4 py-1 text-[10px] font-bold bg-cyan-600/10 text-cyan-600 dark:text-cyan-400 hover:bg-cyan-600/20 rounded-md border border-cyan-500/30 transition-all uppercase tracking-widest shadow-sm",children:"Auto"}),c.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:["Y-AXIS (LOG)",c.jsxs("div",{className:"flex items-center bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-md overflow-hidden shadow-sm",children:[c.jsx("input",{type:"text",value:g,onChange:be=>b(be.target.value),className:"w-14 px-2 py-1 bg-transparent text-center outline-none text-gray-900 dark:text-slate-100 border-r border-gray-200 dark:border-slate-700"}),c.jsx("span",{className:"px-2 text-gray-400",children:"to"}),c.jsx("input",{type:"text",value:y,onChange:be=>m(be.target.value),className:"w-14 px-2 py-1 bg-transparent text-center outline-none text-gray-900 dark:text-slate-100"})]})]})]})]}),c.jsxs("div",{className:"flex-1 p-4 overflow-hidden flex flex-col gap-2 relative bg-gray-50/30 dark:bg-slate-900/30",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[50] select-none opacity-10",children:c.jsx("svg",{viewBox:"0 0 500 100",className:"w-3/4 h-auto drop-shadow-lg",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"24",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),fe&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-[55] bg-white/90 dark:bg-slate-900/90 backdrop-blur-[2px]",children:[c.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mb-4"}),c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:"Computing FFT Stack..."}),h&&h.length>1&&c.jsxs("span",{className:"text-xs text-gray-500 mt-2 font-mono",children:["Processing frame ",Fe," / ",h.length]})]}),K?c.jsx("div",{className:"flex items-center justify-center h-full text-red-500 font-semibold",children:K}):c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-800 rounded-xl p-2 flex flex-col relative z-20 shadow-xl overflow-hidden",children:[c.jsx("div",{className:"flex-1 relative z-10",onMouseDown:de,onMouseMove:Ce,onMouseUp:dt,style:{cursor:xt?"col-resize":"crosshair"},children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:pt,margin:{top:10,right:10,bottom:20,left:0},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.08}),c.jsx(wa,{dataKey:"freq",type:"number",domain:[0,.5],tickCount:6,tick:{fill:"#6b7280",fontSize:10},label:{value:"Frequency (cy/px)",position:"insideBottom",offset:-10,fill:"#6b7280",fontSize:11}}),c.jsx(ka,{scale:"log",domain:[Math.pow(10,parseFloat(g)),Math.pow(10,parseFloat(y))],allowDataOverflow:!0,tick:{fill:"#6b7280",fontSize:10},tickFormatter:be=>Number(be).toExponential(0),width:45}),c.jsx($n,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.95)",border:"1px solid #334155",color:"#f3f4f6",fontSize:"11px",borderRadius:"8px"},formatter:be=>[Number(be).toExponential(3),""],labelFormatter:be=>`Freq: ${Number(be).toFixed(4)}`}),c.jsx(ro,{wrapperStyle:{fontSize:"10px"}}),c.jsx(Ln,{type:"monotone",dataKey:"theory",name:"Theory Model",stroke:"#6366f1",strokeWidth:2,dot:!1,isAnimationActive:!1}),xe.flatMap(be=>{if(p!==-1&&p!==be)return[];const tt=`c${be}_h`,it=`c${be}_v`,Zt=ue[`c${be}`],Vt=[];return _&&Vt.push(c.jsx(Ln,{type:"linear",dataKey:tt,name:`${De[be]} (H)`,stroke:Zt,strokeWidth:1,dot:!1,isAnimationActive:!1},`${be}_h`)),E&&Vt.push(c.jsx(Ln,{type:"linear",dataKey:it,name:`${De[be]} (V)`,stroke:Zt,strokeWidth:1,strokeDasharray:"3 3",dot:!1,isAnimationActive:!1},`${be}_v`)),Vt}),Ie&&c.jsx(d0,{x1:Ie[0],x2:Ie[1],fill:"#8884d8",fillOpacity:.15})]})})}),qt&&Ie&&c.jsxs("div",{className:"absolute bottom-12 left-12 bg-slate-900/90 backdrop-blur-md p-3 rounded-lg border border-indigo-500/50 shadow-2xl z-30 text-[10px] font-mono text-slate-100",children:[c.jsxs("div",{className:"text-indigo-400 font-bold mb-1 border-b border-indigo-500/30 pb-1",children:["Range: ",Ie[0].toFixed(3),"-",Ie[1].toFixed(3)]}),Object.entries(qt.stats).map(([be,tt])=>c.jsxs("div",{className:"flex justify-between gap-4",children:[c.jsxs("span",{className:"text-slate-400",children:[be,":"]}),c.jsx("span",{className:"font-bold text-cyan-400",children:tt.toFixed(5)})]},be))]})]})]}),ft&&c.jsxs("div",{className:"absolute top-48 right-8 z-[55] w-72 bg-white dark:bg-slate-900 rounded-xl shadow-2xl border border-gray-200 dark:border-slate-700 p-4 animate-in slide-in-from-top-2",children:[c.jsx("h4",{className:"text-[10px] uppercase font-bold text-emerald-600 dark:text-emerald-400 mb-2 border-b border-gray-100 dark:border-slate-800 pb-1",children:"Range Averaging"}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx("input",{type:"number",step:"0.01",value:J,onChange:be=>ne(be.target.value),className:"w-16 px-1 py-0.5 text-xs border rounded bg-transparent dark:border-slate-600 dark:text-white"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",step:"0.01",value:ce,onChange:be=>ie(be.target.value),className:"w-16 px-1 py-0.5 text-xs border rounded bg-transparent dark:border-slate-600 dark:text-white"}),c.jsx("button",{onClick:qe,className:"flex-1 bg-emerald-600 text-white text-[10px] font-bold py-1 rounded",children:"Avg"})]}),c.jsx("div",{className:"flex flex-col gap-2 max-h-48 overflow-y-auto",children:xe.map(be=>{const tt=ut[be];if(!tt)return null;const it=ue[`c${be}`];return c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-2 rounded text-[10px] border border-gray-100 dark:border-slate-800",children:[c.jsxs("div",{className:"flex items-center gap-2 font-bold mb-1",style:{color:it},children:[De[be]," ",c.jsxs("span",{className:"text-gray-400 font-normal",children:["(",tt.count," pts)"]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-x-2 text-gray-700 dark:text-slate-300 font-mono",children:[c.jsxs("div",{children:["H: ",tt.h.toExponential(3)]}),c.jsxs("div",{children:["V: ",tt.v.toExponential(3)]})]})]},be)})})]}),Te&&c.jsx("div",{className:"absolute top-48 right-8 z-[55] w-56 bg-white dark:bg-slate-900 rounded-xl shadow-2xl border border-gray-200 dark:border-slate-700 p-4 animate-in slide-in-from-top-2",children:c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-[9px] uppercase font-bold text-gray-400 mb-1",children:"Move"}),c.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[c.jsx("div",{}),c.jsx("button",{onClick:()=>Ir(0,-1),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Ir(-1,0),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Ir(1,0),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Ir(0,1),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-[9px] uppercase font-bold text-gray-400 mb-1",children:"Size"}),c.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[c.jsx("button",{onClick:()=>fr(2,0),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"W+"}),c.jsx("button",{onClick:()=>fr(-2,0),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"W-"}),c.jsx("button",{onClick:()=>fr(0,2),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"H+"}),c.jsx("button",{onClick:()=>fr(0,-2),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"H-"})]})]})]})}),c.jsx(Goe,{isOpen:se,onClose:()=>oe(!1),rawImageData:n,roi:a,selectedChannel:p===-1?xe[0]:p,channelName:p===-1?`${De[xe[0]]} (Default)`:De[p],zIndex:s?s+2:102,onFocus:l})]}):null},Voe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,zIndex:o,onFocus:s,initialPosition:l,initialInternalState:u,onUpdateState:d})=>{const f=!!(n!=null&&n.isThreePlane),h=j.useMemo(()=>Mg(f,i),[f,i]),p=h.keys,x=h.keyToIndex,[g,b]=j.useState((u==null?void 0:u.selectedChannelKey)||h.defaultPrimaryKey),[y,m]=j.useState((u==null?void 0:u.blackLevel)??0),[k,S]=j.useState((u==null?void 0:u.whiteLevel)??16383),[w,v]=j.useState(null),[M,N]=j.useState(!1),[_,P]=j.useState(null),[E,R]=j.useState(l||{x:150,y:150}),[T,G]=j.useState(!1),L=j.useRef({x:0,y:0});j.useEffect(()=>{d&&d({selectedChannelKey:g,blackLevel:y,whiteLevel:k})},[g,y,k]),j.useEffect(()=>{p.includes(g)||b(h.defaultPrimaryKey)},[p,g,h]),j.useEffect(()=>{if(e&&n&&!u){const F=n.blackLevels?Math.floor(n.blackLevels[1]):0;m(F),S(n.whiteLevel||16383),v(null)}},[e,n]);const C=()=>{if(!n||!a)return;P(null),N(!0);const F=x[g];if(F===void 0){P("Invalid channel selection."),N(!1);return}setTimeout(()=>{try{const D=J8(n.data,n.width,n.height,a,F,y,k,!!n.isThreePlane);D?v(D):(P("No data found in selection with current filters."),v(null))}catch(D){console.error("Analysis failed:",D),P(D.message||"Analysis error")}finally{N(!1)}},50)},$=(F,D,W)=>{s&&s(),!(W.closest("button")||W.closest("input")||W.closest("select"))&&(G(!0),L.current={x:F-E.x,y:D-E.y})},A=F=>{$(F.clientX,F.clientY,F.target)},O=F=>{const D=F.touches[0];$(D.clientX,D.clientY,F.target)};return j.useEffect(()=>{const F=W=>{if(T){const H="touches"in W?W.touches[0].clientX:W.clientX,Y="touches"in W?W.touches[0].clientY:W.clientY;R({x:H-L.current.x,y:Y-L.current.y})}},D=()=>G(!1);return T&&(window.addEventListener("mousemove",F),window.addEventListener("mouseup",D),window.addEventListener("touchmove",F,{passive:!1}),window.addEventListener("touchend",D)),()=>{window.removeEventListener("mousemove",F),window.removeEventListener("mouseup",D),window.removeEventListener("touchmove",F),window.removeEventListener("touchend",D)}},[T]),e?c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl resize-both overflow-hidden min-w-[500px] min-h-[400px] w-[900px] h-[700px]",style:{left:E.x,top:E.y,zIndex:o??100},onMouseDownCapture:s,children:[c.jsxs("div",{className:`flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 select-none touch-none ${T?"cursor-grabbing":"cursor-grab"}`,onMouseDown:A,onTouchStart:O,children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2 pointer-events-none",children:"Quantization Step Analysis"}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 p-2",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 border-b border-gray-200 dark:border-slate-700 flex flex-wrap gap-4 items-end flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Channel"}),c.jsx("select",{value:g,onChange:F=>b(F.target.value),className:"bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded px-3 py-1.5 text-sm text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-cyan-500 min-w-[80px]",children:p.map(F=>c.jsx("option",{value:F,children:F},F))})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Black Level"}),c.jsx("input",{type:"number",value:y,onChange:F=>m(Number(F.target.value)),className:"w-24 px-3 py-1.5 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-sm text-gray-900 dark:text-slate-100"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"White Level"}),c.jsx("input",{type:"number",value:k,onChange:F=>S(Number(F.target.value)),className:"w-24 px-3 py-1.5 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-sm text-gray-900 dark:text-slate-100"})]}),c.jsx("button",{onClick:C,disabled:M,className:"mb-0.5 px-5 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded shadow-sm hover:shadow transition-colors disabled:opacity-50 text-sm",children:M?"Analyzing...":"Run Analysis"})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 bg-white dark:bg-slate-900 min-h-0",children:[_&&c.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-sm text-center flex-shrink-0",children:_}),!w&&!M&&!_&&c.jsx("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 dark:text-slate-500 h-full",children:c.jsx("p",{children:"Configure parameters and click Run Analysis"})}),w&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 flex-shrink-0",children:[c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700 text-center",children:[c.jsx("div",{className:"text-xs text-gray-500 dark:text-slate-400 uppercase mb-1",children:"Unique Codes"}),c.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:w.uniqueCount})]}),c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700 text-center",children:[c.jsx("div",{className:"text-xs text-gray-500 dark:text-slate-400 uppercase mb-1",children:"Total Diffs"}),c.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:w.diffCount})]})]}),c.jsxs("div",{className:"bg-white dark:bg-slate-800/50 rounded-xl border border-gray-200 dark:border-slate-700 overflow-hidden flex-shrink-0",children:[c.jsx("div",{className:"px-4 py-2 bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Step Distribution"}),c.jsx("div",{className:"p-4 flex flex-wrap gap-x-8 gap-y-2 text-sm font-mono max-h-32 overflow-y-auto",children:Object.entries(w.stepCounts).sort((F,D)=>parseFloat(F[0])-parseFloat(D[0])).map(([F,D])=>c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("span",{className:"text-gray-500 dark:text-slate-400",children:["Step ",F,":"]}),c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:String(D)})]},F))})]}),c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl p-2 relative overflow-hidden min-h-[300px]",children:[c.jsx("div",{className:"absolute top-2 left-4 text-xs font-bold text-gray-400 dark:text-slate-500 pointer-events-none z-20 bg-white/80 dark:bg-slate-900/80 px-2 rounded",children:"Step Size vs Code Value"}),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 pointer-events-none select-none opacity-10 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),c.jsx("div",{className:"relative z-10 w-full h-full",children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:w.plotData,margin:{top:20,right:20,bottom:20,left:10},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(wa,{dataKey:"x",type:"number",domain:["auto","auto"],tick:{fill:"#9ca3af",fontSize:10},label:{value:"Code Value (Shifted)",position:"insideBottom",offset:-10,fill:"#9ca3af",fontSize:11}}),c.jsx(ka,{tick:{fill:"#9ca3af",fontSize:10},domain:[0,"auto"],allowDataOverflow:!1,label:{value:"Step Size (Delta)",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:11}}),c.jsx($n,{contentStyle:{backgroundColor:"rgba(17, 24, 39, 0.95)",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6",fontSize:"12px"},labelFormatter:F=>`Val: ${F}`,formatter:F=>[F,"Step Size"]}),c.jsx(Ln,{type:"stepAfter",dataKey:"y",stroke:"#0891b2",strokeWidth:1.5,dot:{r:1.5,fill:"#0891b2",strokeWidth:0},activeDot:{r:4},isAnimationActive:!1})]})})})]})]})]})]}):null},Hoe=({isOpen:e,onClose:t,rawImageData:r,roi:n,isBGGR:a,zIndex:i,onFocus:o,initialPosition:s,stackFiles:l})=>{const u=!!(r!=null&&r.isThreePlane),d=j.useMemo(()=>Mg(u,a),[u,a]),f=d.keyToIndex,h=d.keys,[p,x]=j.useState("cross"),[g,b]=j.useState(d.defaultPrimaryKey),[y,m]=j.useState(d.defaultSecondaryKey),[k,S]=j.useState("H"),[w,v]=j.useState(null),[M,N]=j.useState(!1),[_,P]=j.useState(0),[E,R]=j.useState(0),[T,G]=j.useState("single");j.useEffect(()=>{h.includes(g)||b(d.defaultPrimaryKey),h.includes(y)||m(d.defaultSecondaryKey)},[h,g,y,d]);const L=async C=>{if(!r||!n)return;N(!0),G(C),P(0),v(null);const $=f[g],A=p==="cross"?f[y]:$;if($===void 0||A===void 0){N(!1);return}let O=0,F=0;if(p==="self"){const D=d.selfAdjacentStep;k==="H"?F=D:O=D}setTimeout(async()=>{try{let D={sumCov:0,sumVar1:0,sumVar2:0,n:0};if(C==="single")D=h3(r.data,r.width,r.height,n,$,A,O,F,!!r.isThreePlane);else if(l&&l.length>0)for(let W=0;W<l.length;W++){P(W+1);const H=await l[W].arrayBuffer(),Y=await Bl(H),te=h3(Y.data,Y.width,Y.height,n,$,A,O,F,!!Y.isThreePlane);D.sumCov+=te.sumCov,D.sumVar1+=te.sumVar1,D.sumVar2+=te.sumVar2,D.n+=te.n}R(D.n),v(K8(D))}catch(D){console.error("Pearson calculation failed",D),alert("Calculation error: "+D.message)}finally{N(!1)}},50)};return e?c.jsxs(qs,{initialPosition:s||{x:200,y:200},onClose:t,zIndex:i,onFocus:o,className:"w-80 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl overflow-hidden",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-gray-700 dark:text-slate-200 flex items-center gap-2",children:["Pearson Correlation",c.jsx("span",{className:"text-[10px] font-normal bg-white dark:bg-slate-700 px-1.5 py-0.5 rounded border border-gray-200 dark:border-slate-600",children:"r"})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>x("cross"),className:`flex-1 py-1 text-[10px] font-bold rounded transition-all ${p==="cross"?"bg-indigo-600 text-white shadow":"text-gray-500 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:"Cross-Channel"}),c.jsx("button",{onClick:()=>x("self"),className:`flex-1 py-1 text-[10px] font-bold rounded transition-all ${p==="self"?"bg-indigo-600 text-white shadow":"text-gray-500 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:"Self-Adjacent"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] uppercase font-bold text-gray-400",children:p==="cross"?"Channel 1":"Channel"}),c.jsx("select",{value:g,onChange:C=>b(C.target.value),className:"bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-2 py-1.5 text-xs text-gray-700 dark:text-slate-200 outline-none focus:ring-1 focus:ring-indigo-500",children:h.map(C=>c.jsx("option",{value:C,children:C},C))})]}),c.jsx("div",{className:"text-gray-300 dark:text-slate-600 mt-4 font-mono",children:p==="cross"?"x":"->"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] uppercase font-bold text-gray-400",children:p==="cross"?"Channel 2":"Direction"}),p==="cross"?c.jsx("select",{value:y,onChange:C=>m(C.target.value),className:"bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-2 py-1.5 text-xs text-gray-700 dark:text-slate-200 outline-none focus:ring-1 focus:ring-indigo-500",children:h.map(C=>c.jsx("option",{value:C,children:C},C))}):c.jsxs("div",{className:"flex h-[28px] bg-gray-100 dark:bg-slate-800 rounded border border-gray-200 dark:border-slate-700 p-0.5",children:[c.jsx("button",{onClick:()=>S("H"),className:`flex-1 text-[9px] font-bold rounded ${k==="H"?"bg-slate-300 dark:bg-slate-600 text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"Horiz"}),c.jsx("button",{onClick:()=>S("V"),className:`flex-1 text-[9px] font-bold rounded ${k==="V"?"bg-slate-300 dark:bg-slate-600 text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"Vert"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[c.jsx("button",{onClick:()=>L("single"),disabled:M,className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-400 text-white font-bold rounded shadow-md transition-all active:scale-95 text-xs",children:M&&T==="single"?"Calculating...":"Calc Current Frame"}),l&&l.length>0&&c.jsxs("button",{onClick:()=>L("stack"),disabled:M,className:"w-full py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-400 text-white font-bold rounded shadow-md transition-all active:scale-95 text-xs flex flex-col items-center justify-center",children:[c.jsx("span",{children:"Calc Stack Concatenated"}),M&&T==="stack"&&c.jsxs("span",{className:"text-[9px] font-normal opacity-80",children:["Progress: ",_," / ",l.length]})]})]}),w!==null&&c.jsxs("div",{className:"mt-2 p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl border border-gray-200 dark:border-slate-700 text-center animate-in fade-in slide-in-from-top-2",children:[c.jsxs("div",{className:"text-[10px] uppercase font-bold text-gray-400 dark:text-slate-500 mb-1",children:[p==="cross"?"Cross-Channel":`Self-Adj (${k})`," r"]}),c.jsx("div",{className:"text-2xl font-mono font-bold text-indigo-600 dark:text-indigo-400 select-all",style:{fontSize:"24px"},children:w.toFixed(5)}),c.jsxs("div",{className:"text-[9px] text-gray-400 mt-2 font-mono",children:["N = ",E.toLocaleString()," pairs"]}),c.jsx("div",{className:"mt-3 text-[10px] font-bold",children:Math.abs(w)>.5?c.jsx("span",{className:"text-red-500",children:"Significant Correlation"}):Math.abs(w)>.1?c.jsx("span",{className:"text-amber-500",children:"Weak Correlation"}):c.jsx("span",{className:"text-emerald-500",children:"Near-Zero (Uncorrelated)"})})]})]}),c.jsx("div",{className:"p-3 bg-gray-50/50 dark:bg-slate-800/30 text-[9px] text-gray-400 dark:text-slate-600 italic border-t border-gray-100 dark:border-slate-800",children:p==="cross"?u?"Comparing two channels at the same RGB pixel.":"Comparing two color channels in the same Bayer 2x2 cells.":`Comparing pixel (r,c) with (r${k==="V"?`+${d.selfAdjacentStep}`:""}, c${k==="H"?`+${d.selfAdjacentStep}`:""}) in the same channel.`})]}):null},Xoe=[{href:"https://y-g-jiang.github.io/CBLD.html",text:" (Primary Source)",abbr:"CBLD",description:"ISO",highlight:!0},{href:"https://y-G-jiang.github.io/LAC.html",text:"",abbr:"LAC",description:""},{href:"https://y-G-jiang.github.io/CCGV.html",text:"adobeIECMF",abbr:"CCGV",description:"acrRAWxy"},{href:"https://y-G-jiang.github.io/JTJS.html",text:"",abbr:"JTJS",description:"CMF/"},{href:"https://y-G-jiang.github.io/XJZS.html",text:"",abbr:"XJZS",description:""}],Koe=["5","9","0","8","2","1","4","7","3","6"],l4=e=>!e||e==="--"?"--":String(e).split("").map(t=>{const r=parseInt(t);return isNaN(r)?t:Koe[r]}).join(""),Yoe=({isOpen:e,onClose:t})=>{const[r,n]=j.useState({pv:"--",uv:"--"});return j.useEffect(()=>{if(e){const a=()=>{const o=document.getElementById("vercount_value_site_pv"),s=document.getElementById("vercount_value_site_uv");o&&s&&n({pv:o.innerText||"--",uv:s.innerText||"--"})};a();const i=setTimeout(a,1e3);return()=>clearTimeout(i)}},[e]),e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-3xl rounded-2xl shadow-2xl border border-gray-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]",onClick:a=>a.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"About / Tools"}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700 relative",children:[c.jsx("div",{className:"mb-8 p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl border border-gray-100 dark:border-slate-700 text-center",children:c.jsxs("p",{className:"text-lg text-gray-700 dark:text-slate-300",children:[c.jsx("span",{className:"font-bold mr-2",children:"about:"}),c.jsx("a",{href:"https://y-g-jiang.github.io/JOindex.html",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-600 dark:text-cyan-400 hover:underline break-all font-mono",children:"https://y-g-jiang.github.io/JOindex.html"})]})}),c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 flex-1"}),c.jsx("span",{className:"text-sm font-bold text-gray-400 dark:text-slate-500 uppercase tracking-wider",children:"Primary Resources"}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 flex-1"})]}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:Xoe.map(a=>c.jsxs("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",className:`group block p-4 rounded-xl border transition-all duration-200 relative overflow-hidden ${a.highlight?"border-cyan-500 dark:border-cyan-400 bg-cyan-50/30 dark:bg-cyan-900/10 shadow-lg scale-[1.02] ring-2 ring-cyan-500/20":"border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800/30 hover:bg-gray-50 dark:hover:bg-slate-800 hover:border-cyan-500"}`,children:[c.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-cyan-500/5 to-transparent -mr-8 -mt-8 rounded-full pointer-events-none group-hover:from-cyan-500/10 transition-colors"}),c.jsxs("div",{className:"flex items-center gap-3 mb-2 relative z-10",children:[c.jsx("span",{className:`px-2 py-1 text-xs font-bold rounded transition-colors border ${a.highlight?"bg-cyan-600 text-white border-cyan-500":"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 border-gray-200 dark:border-slate-600 group-hover:border-cyan-200"}`,children:a.abbr}),c.jsx("h3",{className:`font-bold transition-colors ${a.highlight?"text-cyan-700 dark:text-cyan-300":"text-gray-800 dark:text-slate-200 group-hover:text-cyan-600"}`,children:a.text})]}),c.jsx("p",{className:`text-xs pl-1 transition-colors relative z-10 ${a.highlight?"text-cyan-600/80 dark:text-cyan-400/80":"text-gray-500 dark:text-slate-400"}`,children:a.description})]},a.abbr))}),c.jsx("div",{className:"flex justify-end mt-4",children:c.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 rounded border border-gray-200 dark:border-slate-800 p-1.5 opacity-40 hover:opacity-100 transition-opacity cursor-default select-none group",children:c.jsxs("div",{className:"font-mono text-[10px] text-gray-400 dark:text-slate-600 leading-tight text-right flex flex-col",children:[c.jsx("span",{className:"group-hover:text-indigo-400 transition-colors",children:l4(r.pv)}),c.jsx("span",{className:"group-hover:text-emerald-400 transition-colors",children:l4(r.uv)})]})})})]})]})}):null},qoe=({isOpen:e,onClose:t,data:r,fileName:n,warning:a})=>{const[i,o]=j.useState(""),s=d=>{const f=new WeakSet;try{return JSON.stringify(d,(h,p)=>{if(typeof p=="bigint")return p.toString()+"n";if(typeof p=="object"&&p!==null){if(f.has(p))return"[Circular]";if(f.add(p),ArrayBuffer.isView(p))return`[${p.constructor.name}]`}return p})}catch{return"[Unable to serialize object]"}},l=j.useMemo(()=>{if(!r)return[];const d=[],f=(h,p=0)=>{if(p>5)return"...";if(h==null)return String(h);if(h instanceof Date)return h.toLocaleString();if(typeof h=="number")return h.toString();if(typeof h=="string")return h;if(typeof h=="bigint")return h.toString()+"n";if(ArrayBuffer.isView(h))return`<${h.constructor.name} len=${h.length} bytes=${h.byteLength}>`;if(h instanceof ArrayBuffer)return`<ArrayBuffer bytes=${h.byteLength}>`;if(typeof h=="object"){if(Array.isArray(h))return h.length===0?"[]":h.length>20?`[${h.slice(0,10).map(b=>typeof b=="number"?b.toFixed(2):f(b,p+1)).join(", ")}, ... (+${h.length-10} more)]`:`[${h.map(g=>typeof g=="number"?Number.isInteger(g)?g:g.toFixed(4):f(g,p+1)).join(", ")}]`;try{const x=Object.keys(h);return x.length>5?`{Object with ${x.length} keys}`:s(h)}catch{return"<Complex Object>"}}return String(h)};try{if(typeof r!="object")return[{key:"Value",value:String(r)}];Object.keys(r).sort().forEach(p=>{if(p==="MakerNote"||p==="UserComment"||p.includes("Strip")||p.includes("Offset")){d.push({key:p,value:"<Binary/Internal Data>"});return}const x=r[p];d.push({key:p,value:f(x)})})}catch(h){console.error("Error processing EXIF data:",h),d.push({key:"Error",value:"Failed to process metadata structure."})}return d},[r]);if(!e)return null;const u=l.filter(d=>d.key.toLowerCase().includes(i.toLowerCase())||d.value.toLowerCase().includes(i.toLowerCase()));return c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-3xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"overflow-hidden",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:"EXIF Data"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1 font-mono truncate",children:n})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a&&c.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 px-4 py-2 border-b border-amber-100 dark:border-amber-800/50 text-center",children:c.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 whitespace-pre-line font-medium leading-relaxed",children:a})}),c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:c.jsxs("div",{className:"relative",children:[c.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),c.jsx("input",{type:"text",placeholder:"Search tags...",value:i,onChange:d=>o(d.target.value),className:"w-full pl-9 pr-4 py-2 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded-lg text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-gray-900 dark:text-slate-100 transition-colors placeholder-gray-400"})]})}),c.jsx("div",{className:"overflow-y-auto flex-1 p-0 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700",children:u.length>0?c.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[c.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800 sticky top-0 shadow-sm z-10",children:c.jsxs("tr",{children:[c.jsx("th",{className:"py-3 px-5 font-semibold text-xs text-gray-500 dark:text-slate-400 uppercase tracking-wider w-1/3 border-b border-gray-200 dark:border-slate-700",children:"Tag Name"}),c.jsx("th",{className:"py-3 px-5 font-semibold text-xs text-gray-500 dark:text-slate-400 uppercase tracking-wider w-2/3 border-b border-gray-200 dark:border-slate-700",children:"Value"})]})}),c.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800",children:u.map(d=>c.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors group",children:[c.jsx("td",{className:"py-2 px-5 text-sm font-medium text-cyan-600 dark:text-cyan-400 font-mono break-words align-top",children:d.key}),c.jsx("td",{className:"py-2 px-5 text-sm text-gray-700 dark:text-slate-300 font-mono break-words align-top group-hover:text-gray-900 dark:group-hover:text-slate-100",children:d.value})]},d.key))})]}):c.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 dark:text-slate-500",children:c.jsxs("p",{children:['No tags found matching "',i,'"']})})}),c.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50 flex justify-end rounded-b-2xl",children:c.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-white rounded-lg text-sm font-semibold transition-colors",children:"Close"})})]})})},Zoe=100,iy=e=>{if(e.length===0)return 0;if(e.length===1)return e[0];if(e.length===2)return .5*(e[0]+e[1]);let t=[...e].sort((r,n)=>r-n);for(;t.length>4;){let r=1/0,n=0;const a=t.length,i=Math.floor(a/2);for(let o=0;o<=a-i;o++){const s=t[o+i-1]-t[o];s<r&&(r=s,n=o)}t=t.slice(n,n+i)}return t.reduce((r,n)=>r+n,0)/t.length},c4=({min:e,max:t,value:r,onChange:n,vertical:a=!1,logScale:i=!1})=>{const o=j.useRef(null),s=j.useRef(null),l=j.useCallback(m=>{const k=i?Math.max(1e-6,e):e,S=i?Math.max(k*1.0001,t):t,w=Math.max(k,Math.min(S,m));if(i){const v=Math.log10(k),M=Math.log10(S);return(Math.log10(w)-v)/(M-v)}return(w-k)/(S-k)},[e,t,i]),u=j.useCallback(m=>{const k=i?Math.max(1e-6,e):e,S=i?Math.max(k*1.0001,t):t;if(i){const w=Math.log10(k),v=Math.log10(S);return Math.pow(10,w+m*(v-w))}return k+m*(S-k)},[e,t,i]),d=(m,k)=>{m.preventDefault(),m.stopPropagation(),s.current=k;const S=v=>{if(!s.current||!o.current)return;const M=o.current.getBoundingClientRect();let N=0;a?N=(M.bottom-v.clientY)/M.height:N=(v.clientX-M.left)/M.width,N=Math.max(0,Math.min(1,N));const _=u(N);if(s.current==="min"){const P=r[1];n([Math.min(_,P),P])}else{const P=r[0];n([P,Math.max(_,P)])}},w=()=>{s.current=null,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",w)};window.addEventListener("mousemove",S),window.addEventListener("mouseup",w)},f=l(r[0])*100,h=l(r[1])*100,p=a?{left:"50%",top:0,bottom:0,width:"4px",transform:"translateX(-50%)"}:{top:"50%",left:0,right:0,height:"4px",transform:"translateY(-50%)"},x=a?{left:"50%",bottom:`${f}%`,height:`${h-f}%`,width:"4px",transform:"translateX(-50%)"}:{top:"50%",left:`${f}%`,width:`${h-f}%`,height:"4px",transform:"translateY(-50%)"},g="absolute w-3 h-3 bg-white border-2 border-cyan-600 rounded-full shadow-md cursor-pointer hover:scale-125 transition-transform z-10",b=a?{left:"50%",bottom:`${f}%`,transform:"translate(-50%, 50%)"}:{top:"50%",left:`${f}%`,transform:"translate(-50%, -50%)"},y=a?{left:"50%",bottom:`${h}%`,transform:"translate(-50%, 50%)"}:{top:"50%",left:`${h}%`,transform:"translate(-50%, -50%)"};return c.jsxs("div",{ref:o,className:`relative select-none ${a?"h-full w-4 py-2":"w-full h-4 px-2"}`,children:[c.jsx("div",{className:"absolute bg-gray-300 dark:bg-slate-600 rounded-full",style:p}),c.jsx("div",{className:"absolute bg-cyan-500 dark:bg-cyan-400 rounded-full",style:x}),c.jsx("div",{className:g,style:b,onMouseDown:m=>d(m,"min")}),c.jsx("div",{className:g,style:y,onMouseDown:m=>d(m,"max")})]})},Joe=({isOpen:e,onClose:t,data:r,blackLevel:n,imageHeight:a,isBGGR:i,importedMetadata:o,theme:s,initialCameraModel:l,initialISO:u})=>{const[d,f]=j.useState("Noise"),[h,p]=j.useState(!0),[x,g]=j.useState(null),[b,y]=j.useState("default"),[m,k]=j.useState(!1),[S,w]=j.useState(!1),[v,M]=j.useState({R:!0,G1:!0,G2:!0,B:!0}),[N,_]=j.useState(""),[P,E]=j.useState(""),[R,T]=j.useState(""),[G,L]=j.useState(""),[C,$]=j.useState("10"),[A,O]=j.useState(""),[F,D]=j.useState("0 0 0 0"),[W,H]=j.useState("0 0 0 0"),[Y,te]=j.useState(!1),[U,Se]=j.useState(null),[re,J]=j.useState(!1),[ne,ce]=j.useState(0),[ie,se]=j.useState([]),[oe,ke]=j.useState(""),[le,fe]=j.useState(""),Pe=()=>{const ae=parseFloat(oe),me=parseFloat(le);!isNaN(ae)&&!isNaN(me)&&(se([...ie,{id:Date.now(),x:ae,y:me}]),ke(""),fe(""))},[Fe,Ue]=j.useState(()=>localStorage.getItem("ptc_tester_name")||""),[K,_e]=j.useState(""),[Te,Le]=j.useState("");j.useEffect(()=>{localStorage.setItem("ptc_tester_name",Fe)},[Fe]);const ft=j.useRef(Y),Xe=j.useRef(re),Ie=j.useRef(ne);j.useEffect(()=>{ft.current=Y,Xe.current=re,Ie.current=ne},[Y,re,ne]);const[ht,xt]=j.useState(null),[nt,Gt]=j.useState({min:.01,max:90}),[yt,et]=j.useState({readNoise:0,gain:1,prnu:.5}),[He,mt]=j.useState(2e6),jt=j.useRef(yt),or=j.useRef(nt),zt=j.useRef(He);j.useEffect(()=>{jt.current=yt,or.current=nt,zt.current=He},[yt,nt,He]);const[ut,It]=j.useState({read:"0",gain:"1.0",prnu:"0.5",rangeMin:"0.01",rangeMax:"90"}),[Lt,Me]=j.useState({read:!0,shot:!0,prnu:!0,total:!0,fitRange:!0}),[Z,xe]=j.useState(!1),[ue,De]=j.useState([]),[qe,pt]=j.useState(null),[de,Ce]=j.useState(""),dt=j.useMemo(()=>n?n.join(","):"",[n]);j.useEffect(()=>{if(e){let ae="0 0 0 0";o&&o.blackLevel?ae=o.blackLevel.join(" "):ae=n&&n.length===4?n.join(" "):"0 0 0 0",D(ae),H(ae);let me="";if(o&&o.height?me=o.height.toString():a&&(me=a.toString()),O(me),me){const Q=parseFloat(me);!isNaN(Q)&&Q>0?$((2309.4/Q).toFixed(2)):$("10")}else $("10");Se(null),te(!1),J(!1),ce(0),De([]),pt(null),Gt({min:.01,max:90}),It({read:"0",gain:"0",prnu:"0",rangeMin:"0.01",rangeMax:"90"});const je={readNoise:0,gain:0,prnu:0};et(je),jt.current=je,_(""),E(""),T(""),L(""),f("Noise"),xt(null),mt(2e6),Ce(""),w(!1),se([]),_e(Q=>Q.trim()===""&&l?l:Q),Le(Q=>Q.trim()===""&&u?u:Q)}},[e,dt,o,a,r,l,u]);const Wt=ae=>{if(ae.key==="Enter"){const me=parseFloat(A);if(!isNaN(me)&&me>0){const je=(2309.4/me).toFixed(2);$(je)}ae.target.blur()}},Rt=j.useMemo(()=>{let me=W.trim().split(/[\s,]+/).filter(Boolean).map(Number);for(me.length===1&&(me=[me[0],me[0],me[0],me[0]]);me.length<4;)me.push(0);const je=Q=>{switch(Q){case"R":return me[0];case"G1":return me[1];case"G2":return me[2];case"B":return me[3];default:return 0}};return r.map(Q=>{const ze=Q.mean-je(Q.channel),rt=Q.std>0?ze/Q.std:0;return{...Q,x:ze,std:Q.std,snr:rt}}).filter(Q=>Q.std>0)},[r,W]),kt=j.useMemo(()=>{const ae=yt.readNoise,me=ae*ae;return Rt.map(je=>{let Q=0;if(d==="Noise")Q=je.std;else if(d==="SNR")Q=je.snr;else if(d==="Linear"){const rt=je.std*je.std-me;Q=je.x!==0?rt/je.x:0}return{...je,y:Q}})},[Rt,d,yt.readNoise]),qt=j.useMemo(()=>{if(Rt.length===0)return"G1";const ae={R:0,G1:0,G2:0,B:0},me={R:0,G1:0,G2:0,B:0};for(const ze of Rt)ae[ze.channel]+=ze.x,me[ze.channel]++;let je="G1",Q=-1/0;return Object.keys(ae).forEach(ze=>{const rt=me[ze],wt=rt>0?ae[ze]/rt:-1/0;wt>Q&&(Q=wt,je=ze)}),je},[Rt]),xr=j.useCallback(()=>{let ae=1/0,me=-1/0;if(Rt.length===0)return{min:.1,max:1};for(let je=0;je<Rt.length;je++){const Q=Rt[je].x;h&&Q<=0||(Q<ae&&(ae=Q),Q>me&&(me=Q))}return ae===1/0?{min:.1,max:1}:{min:ae,max:me}},[Rt,h]),Ir=j.useCallback(()=>{let ae=1/0,me=-1/0;if(kt.length===0)return{min:.1,max:1};for(let je=0;je<kt.length;je++){const Q=kt[je].y;h&&Q<=0||(Q<ae&&(ae=Q),Q>me&&(me=Q))}return ae===1/0?{min:.1,max:1}:{min:ae*.9,max:me*1.1}},[kt,h]),{min:fr,max:be}=xr(),{min:tt,max:it}=Ir(),Zt=be*(nt.min/100),Vt=be*(nt.max/100),ot=j.useMemo(()=>{if(!h&&kt.length===0)return{shot:[],read:[],prnu:[],total:[]};const ae=N?parseFloat(N):fr,me=P?parseFloat(P):be,je=100,Q=Math.max(.1,ae),ze=Math.max(1,me);if(Q>=ze)return{shot:[],read:[],prnu:[],total:[]};const rt=Math.log10(Q),Ot=(Math.log10(ze)-rt)/je,Jt=yt.readNoise,At=yt.gain>0?yt.gain:1,pr=yt.prnu/100,vr=[],Dr=[],Xr=[],Ae=[];for(let nr=0;nr<=je;nr++){const gt=Math.pow(10,rt+nr*Ot);if(d==="Linear"){const Tr=1/At,Cr=pr*pr,Mn=Tr+Cr*gt;Ae.push({x:gt,y:Mn}),vr.push({x:gt,y:Tr}),Xr.push({x:gt,y:Cr*gt})}else{const Tr=Jt,Cr=Math.sqrt(gt/At),Mn=pr*gt,Sr=Math.sqrt(Tr*Tr+Cr*Cr+Mn*Mn);d==="Noise"?(vr.push({x:gt,y:Cr}),Dr.push({x:gt,y:Tr}),Xr.push({x:gt,y:Mn}),Ae.push({x:gt,y:Sr})):(Cr>0&&vr.push({x:gt,y:gt/Cr}),Tr>0&&Dr.push({x:gt,y:gt/Tr}),Mn>0&&Xr.push({x:gt,y:gt/Mn}),Sr>0&&Ae.push({x:gt,y:gt/Sr}))}}return{shot:vr,read:Dr,prnu:Xr,total:Ae}},[kt,h,N,P,yt,d,fr,be]),ir=j.useMemo(()=>{if(d==="Linear")return[];const ae=parseFloat(C);if(isNaN(ae)||ae<=0)return[];const me=N?parseFloat(N):fr,je=P?parseFloat(P):be;return d==="SNR"?[{x:me,y:ae},{x:je,y:ae}]:[{x:me,y:me/ae},{x:je,y:je/ae}]},[kt,C,d,N,P,fr,be]),yr=j.useCallback((ae,me)=>{if(!me||me.length===0)return null;const je=[...me].sort((Q,ze)=>Q.x-ze.x);for(let Q=0;Q<je.length-1;Q++){const ze=je[Q],rt=je[Q+1];if(ze.snr<=ae&&rt.snr>=ae||ze.snr>=ae&&rt.snr<=ae){const wt=(ae-ze.snr)/(rt.snr-ze.snr);return ze.x+wt*(rt.x-ze.x)}}return null},[]),Ht=j.useMemo(()=>{const ae=Rt,me=1e3,je=ze=>{if(ze.length===0)return[];if(ze.length<=me)return ze;const rt=[...ze].sort((Jt,At)=>Jt.x-At.x),wt=[],Ot=rt.length/me;for(let Jt=0;Jt<me;Jt++){const At=Math.floor(Jt*Ot),pr=Math.floor((Jt+1)*Ot),vr=rt.slice(At,pr);if(vr.length===0)continue;vr.sort((Xr,Ae)=>Xr.std-Ae.std);const Dr=Math.floor(vr.length/2);wt.push(vr[Dr])}return wt},Q={R:[],G1:[],G2:[],B:[]};return ae.forEach(ze=>{Q[ze.channel]&&Q[ze.channel].push(ze)}),{R:je(Q.R),G1:je(Q.G1),G2:je(Q.G2),B:je(Q.B)}},[Rt]),Dt=j.useMemo(()=>U&&yt.gain?U*yt.gain:null,[U,yt.gain]),Ee=j.useMemo(()=>{if(U===null||U===0)return null;const ae=parseFloat(C);let me=null;if(!isNaN(ae)&&ae>0){let wt=0,Ot=0;if(["R","G1","G2","B"].forEach(Jt=>{const At=yr(ae,Ht[Jt]);At!==null&&(wt+=At,Ot++)}),Ot>0){const Jt=wt/Ot;me=Math.log2(U/Jt)}}const je=parseFloat(A);let Q=null,ze=NaN;if(!isNaN(je)&&je>0){ze=16e3/je;let wt=0,Ot=0;if(["R","G1","G2","B"].forEach(Jt=>{const At=yr(ze,Ht[Jt]);At!==null&&(wt+=At,Ot++)}),Ot>0){const Jt=wt/Ot;Q=Math.log2(U/Jt)}}let rt=null;if(!isNaN(je)&&je>0){const wt=yr(ze,Ht[qt]);wt!==null&&(rt=Math.log2(U/wt))}return{manualDR:me,ptpDR:Q,d55DR:rt,manualTarget:ae,ptpTarget:ze,saturationSignal:U,dominantChannel:qt}},[U,C,A,Ht,yr,qt]),er=j.useMemo(()=>{if(d==="Linear"||!Ee||!Ee.ptpTarget||isNaN(Ee.ptpTarget))return[];const ae=Ee.ptpTarget,me=N?parseFloat(N):fr,je=P?parseFloat(P):be;return d==="SNR"?[{x:me,y:ae},{x:je,y:ae}]:[{x:me,y:me/ae},{x:je,y:je/ae}]},[d,Ee,N,P,fr,be]),B=j.useCallback(()=>{const je=document.createElement("canvas");je.width=2048,je.height=1536;const Q=je.getContext("2d");if(!Q)return;const ze=s==="dark",rt=ze?"#0f172a":"#ffffff",wt=ze?"#ffffff":"#000000",Ot=ze?"#475569":"#cbd5e1",Jt=ze?"#1e293b":"#f1f5f9",At=i?{R:"#ef4444",G1:"#22c55e",G2:"#4ade80",B:"#3b82f6"}:{R:"#ef4444",G1:"#22c55e",G2:"#4ade80",B:"#3b82f6"};Q.fillStyle=rt,Q.fillRect(0,0,2048,1536);let pr=N?parseFloat(N):fr,vr=P?parseFloat(P):be,Dr=R?parseFloat(R):tt,Xr=G?parseFloat(G):it;isNaN(pr)&&(pr=.1),isNaN(vr)&&(vr=1e4),isNaN(Dr)&&(Dr=.1),isNaN(Xr)&&(Xr=1e3);const Ae={top:80,right:80,bottom:100,left:120},nr=2048-Ae.left-Ae.right,gt=1536-Ae.top-Ae.bottom,Tr=Ye=>{if(h){const dr=Math.log10(Math.max(1e-9,pr)),Tt=Math.log10(Math.max(1e-9,vr)),cr=Math.log10(Math.max(1e-9,Ye));return Ae.left+(cr-dr)/(Tt-dr)*nr}else return Ae.left+(Ye-pr)/(vr-pr)*nr},Cr=Ye=>{if(h){const dr=Math.log10(Math.max(1e-9,Dr)),Tt=Math.log10(Math.max(1e-9,Xr)),cr=Math.log10(Math.max(1e-9,Ye));return Ae.top+gt-(cr-dr)/(Tt-dr)*gt}else return Ae.top+gt-(Ye-Dr)/(Xr-Dr)*gt};if(Q.beginPath(),h){const Ye=(dr,Tt,cr)=>{const pn=Math.log10(Math.max(1e-9,dr)),ha=Math.log10(Math.max(1e-9,Tt)),bn=Math.floor(pn),ki=Math.ceil(ha);for(let Yn=bn;Yn<=ki;Yn++){const _a=Math.pow(10,Yn);let Kr=cr?Tr(_a):Cr(_a);(cr?Kr>=Ae.left-1&&Kr<=Ae.left+nr+1:Kr>=Ae.top-1&&Kr<=Ae.top+gt+1)&&(Q.lineWidth=1.5,Q.strokeStyle=Ot,Q.beginPath(),cr?(Q.moveTo(Kr,Ae.top),Q.lineTo(Kr,Ae.top+gt)):(Q.moveTo(Ae.left,Kr),Q.lineTo(Ae.left+nr,Kr)),Q.stroke()),Q.lineWidth=.5,Q.strokeStyle=Jt;for(let mo=2;mo<10;mo++){const Xo=mo*_a;Kr=cr?Tr(Xo):Cr(Xo),(cr?Kr>=Ae.left&&Kr<=Ae.left+nr:Kr>=Ae.top&&Kr<=Ae.top+gt)&&(Q.beginPath(),cr?(Q.moveTo(Kr,Ae.top),Q.lineTo(Kr,Ae.top+gt)):(Q.moveTo(Ae.left,Kr),Q.lineTo(Ae.left+nr,Kr)),Q.stroke())}}};Ye(pr,vr,!0),Ye(Dr,Xr,!1)}else{Q.strokeStyle=Ot,Q.lineWidth=1;for(let Ye=0;Ye<=5;Ye++){const dr=Ae.left+nr*Ye/5;Q.beginPath(),Q.moveTo(dr,Ae.top),Q.lineTo(dr,Ae.top+gt),Q.stroke();const Tt=Ae.top+gt*Ye/5;Q.beginPath(),Q.moveTo(Ae.left,Tt),Q.lineTo(Ae.left+nr,Tt),Q.stroke()}}Q.strokeStyle=wt,Q.lineWidth=2,Q.strokeRect(Ae.left,Ae.top,nr,gt);const Mn=(Ye,dr,Tt)=>{Ye<Ae.left||Ye>Ae.left+nr||dr<Ae.top||dr>Ae.top+gt||(Q.fillStyle=Tt,Q.fillRect(Ye-1.5,dr-1.5,3,3))},Sr=kt.filter(Ye=>!(h&&(Ye.x<=0||Ye.y<=0)));Sr.forEach(Ye=>{v[Ye.channel]&&Ye.channel!==qt&&Mn(Tr(Ye.x),Cr(Ye.y),At[Ye.channel])}),Sr.forEach(Ye=>{v[Ye.channel]&&Ye.channel===qt&&Mn(Tr(Ye.x),Cr(Ye.y),At[Ye.channel])}),ie.forEach(Ye=>{const dr=Tr(Ye.x),Tt=Cr(Ye.y);if(dr<Ae.left||dr>Ae.left+nr||Tt<Ae.top||Tt>Ae.top+gt)return;Q.strokeStyle="#d946ef",Q.lineWidth=2.5;const cr=6;Q.beginPath(),Q.moveTo(dr-cr,Tt-cr),Q.lineTo(dr+cr,Tt+cr),Q.moveTo(dr+cr,Tt-cr),Q.lineTo(dr-cr,Tt+cr),Q.stroke()});const an=(Ye,dr,Tt=[])=>{if(Ye.length<2)return;Q.beginPath(),Q.strokeStyle=dr,Q.lineWidth=3,Q.setLineDash(Tt);let cr=!1;for(const pn of Ye){const ha=Tr(pn.x),bn=Cr(pn.y);if(ha<Ae.left-100||ha>Ae.left+nr+100||bn<Ae.top-100||bn>Ae.top+gt+100){cr=!1;continue}cr?Q.lineTo(ha,bn):(Q.moveTo(ha,bn),cr=!0)}Q.stroke(),Q.setLineDash([])},zn=ze?"#ffffff":"#000000";if(Lt.shot&&an(ot.shot,"#94a3b8",[5,5]),Lt.read&&an(ot.read,"#f43f5e",[3,3]),Lt.prnu&&an(ot.prnu,"#f59e0b",[3,3]),Lt.total&&an(ot.total,zn,[]),ir.length===2){const Ye="#6366f1";an(ir,Ye,[4,2]);const dr=ir[1],Tt=Cr(dr.y);Tt>=Ae.top&&Tt<=Ae.top+gt&&(Q.fillStyle=Ye,Q.font="bold 20px sans-serif",Q.textAlign="right",Q.textBaseline="bottom",Q.fillText(`M.Tgt=${C}`,Ae.left+nr-10,Tt-8))}if(er.length===2&&(Ee!=null&&Ee.ptpTarget)){const Ye="#10b981";an(er,Ye,[4,4]);const dr=er[1],Tt=Cr(dr.y);if(Tt>=Ae.top&&Tt<=Ae.top+gt){Q.fillStyle=Ye,Q.font="bold 20px sans-serif",Q.textAlign="right",Q.textBaseline="bottom";const cr=Ee.ptpTarget.toFixed(1),pn=ir.length===2?Cr(ir[1].y):-100,ha=Math.abs(Tt-pn)<25?25:0;Q.fillText(`PTP=${cr}`,Ae.left+nr-10,Tt-8-ha)}}if(Lt.fitRange||re){const Ye=(dr,Tt)=>{const cr=Tr(dr);cr>=Ae.left&&cr<=Ae.left+nr&&(Q.beginPath(),Q.strokeStyle=Tt,Q.lineWidth=2,Q.setLineDash([8,8]),Q.moveTo(cr,Ae.top),Q.lineTo(cr,Ae.top+gt),Q.stroke(),Q.setLineDash([]))};Ye(Zt,"#22d3ee"),Ye(Vt,"#22d3ee")}if(U){const Ye=Tr(U);Ye>=Ae.left&&Ye<=Ae.left+nr&&(Q.strokeStyle="#ef4444",Q.lineWidth=3,Q.setLineDash([10,10]),Q.beginPath(),Q.moveTo(Ye,Ae.top),Q.lineTo(Ye,Ae.top+gt),Q.stroke(),Q.setLineDash([]),Q.fillStyle="#ef4444",Q.font="bold 24px sans-serif",Q.textAlign="center",Q.fillText("Sat",Ye,Ae.top-10))}Q.fillStyle=wt,Q.font="28px monospace",Q.textAlign="center",Q.fillText(pr.toExponential(1),Ae.left,Ae.top+gt+40),Q.fillText(vr.toExponential(1),Ae.left+nr,Ae.top+gt+40),Q.fillText("Signal (DN)",Ae.left+nr/2,Ae.top+gt+80),Q.textAlign="right",Q.textBaseline="middle",Q.fillText(Dr.toExponential(1),Ae.left-20,Ae.top+gt),Q.fillText(Xr.toExponential(1),Ae.left-20,Ae.top),Q.save(),Q.translate(Ae.left-80,Ae.top+gt/2),Q.rotate(-Math.PI/2),Q.textAlign="center",Q.fillText(d==="Linear"?"(Var - RN) / Mean":d,0,0),Q.restore(),Q.save(),Q.translate(2048/2,1536/2),Q.rotate(-Math.PI/6),Q.textAlign="center",Q.textBaseline="middle",Q.fillStyle=ze?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",Q.font="bold 150px sans-serif",Q.fillText(" y-g-jiang.github.io",0,0),Q.restore(),Q.fillStyle=wt,Q.font="bold 36px sans-serif",Q.textAlign="left",Q.textBaseline="top",Q.fillText(`PTC Export: ${d} Mode`,Ae.left,20),Q.font="24px sans-serif",Q.fillStyle=ze?"#94a3b8":"#64748b",Q.fillText(`Points: ${kt.length} | Sat Channel: ${qt}`,Ae.left,65);const zi=Ae.left+30,Wi=Ae.top+30,Zu=70,Zs=Ye=>{if(!U||Ye<=0)return"--";const dr=yt.readNoise,Tt=yt.gain,cr=yt.prnu/100;if(Tt<=0)return"--";const pn=Ye*Ye,ha=dr*dr,bn=1-pn*cr*cr,ki=-(pn/Tt),Yn=-(pn*ha);let _a=0;if(Math.abs(bn)<1e-8)Math.abs(ki)>1e-8&&(_a=-Yn/ki);else{const Kr=ki*ki-4*bn*Yn;Kr>=0&&(_a=(-ki+Math.sqrt(Kr))/(2*bn))}return _a>0?Math.log2(U/_a).toFixed(2)+" EV":"--"},Ju=Ee!=null&&Ee.ptpTarget&&!isNaN(Ee.ptpTarget)?Zs(Ee.ptpTarget):"--",rc=C?Zs(parseFloat(C)):"--";Q.font="bold 48px monospace",Q.textAlign="left",Q.textBaseline="top",Q.shadowColor=ze?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)",Q.shadowBlur=4,Q.shadowOffsetX=1,Q.shadowOffsetY=1;const cn=(Ye,dr,Tt,cr)=>{const pn=Wi+Tt*Zu;Q.fillStyle=wt,Q.fillText(Ye,zi,pn);const ha=Q.measureText(Ye).width;Q.fillStyle=cr||wt,Q.fillText(dr,zi+ha,pn)},Ga=ut.read,fo=parseFloat(ut.gain).toFixed(3),Ua=parseFloat(ut.prnu).toFixed(2)+"%";let ho=`M.DR@SNR${C}: `;const Vi=parseFloat(A);if(!isNaN(Vi)&&Vi>0){const Ye=(2309.4/Vi).toFixed(2);Math.abs(parseFloat(C)-parseFloat(Ye))<.05&&(ho="8mpSNR=1 DR: ")}cn("Tester: ",Fe||"N/A",0),cn("Model : ",K||"Unknown",1),cn("ISO   : ",Te||"N/A",2),cn("RN/FPN: ",Ga,3,"#f43f5e"),cn("KADC  : ",fo,4,"#06b6d4"),cn("PRNU  : ",Ua,5,"#f59e0b"),cn("PTP DR: ",Ee!=null&&Ee.ptpDR?Ee.ptpDR.toFixed(2)+" EV":"--",6,"#10b981"),cn("D55 DR: ",Ee!=null&&Ee.d55DR?Ee.d55DR.toFixed(2)+" EV":"--",7,"#8b5cf6"),cn("FWC   : ",Dt?Dt>1e4?(Dt/1e3).toFixed(1)+"k":Math.round(Dt).toString():"--",8,"#f97316"),cn(ho,Ee!=null&&Ee.manualDR?Ee.manualDR.toFixed(2)+" EV":"--",9,"#06b6d4"),cn("PTCFitDR(PTP): ",Ju,10,"#10b981"),cn("PTCFitDR(Man): ",rc,11,"#06b6d4"),Q.save(),Q.textAlign="right",Q.textBaseline="bottom",Q.fillStyle="#3b82f6",Q.font="bold 80px sans-serif",Q.shadowColor=ze?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)",Q.shadowBlur=4,Q.shadowOffsetX=2,Q.shadowOffsetY=2;const po=1988,Js=1476,Hi=90;Q.fillText("Online",po,Js),Q.fillText("Jiangtherapee",po,Js-Hi),Q.restore();const Ho=document.createElement("a");Ho.download=`ptc_complete_${d}_${Date.now()}.jpg`,Ho.href=je.toDataURL("image/jpeg",.9),Ho.click()},[kt,qt,v,N,P,R,G,fr,be,tt,it,h,s,d,U,i,Lt,ot,Zt,Vt,nt,re,Fe,K,Te,Ee,Dt,C,ir,er,ut,A,ie]),ge=j.useMemo(()=>{let ae=kt;if(h&&(ae=ae.filter(ze=>ze.y>0&&ze.x>0)),b==="top3"){const ze=[...ae].sort((wt,Ot)=>Ot.x-wt.x),rt=Math.max(50,Math.ceil(ze.length*.03));ae=ze.slice(0,rt)}const me={R:[],G1:[],G2:[],B:[]};if(ae.forEach(ze=>{me[ze.channel]&&me[ze.channel].push(ze)}),b==="raw")return me;const je=b==="top3"?500:Zoe,Q=ze=>{if(ze.length<=je)return ze;const rt=[...ze].sort((Jt,At)=>Jt.x-At.x),wt=[],Ot=rt.length/je;for(let Jt=0;Jt<je;Jt++){const At=Math.floor(Jt*Ot),pr=Math.floor((Jt+1)*Ot),vr=rt.slice(At,pr);if(vr.length===0)continue;vr.sort((Xr,Ae)=>Xr.y-Ae.y);const Dr=Math.floor(vr.length/2);wt.push(vr[Dr])}return wt};return{R:Q(me.R),G1:Q(me.G1),G2:Q(me.G2),B:Q(me.B)}},[kt,b,h]),ye=j.useMemo(()=>{if(Rt.length<5)return[];const ae=Rt.filter(je=>je.channel===qt);return[...ae.length>20?ae:Rt].sort((je,Q)=>je.x-Q.x).map(je=>({mean:je.x,std:je.std}))},[Rt,qt]),vt=ae=>{const me=ae.length;if(me===0)return[];const je=ae.reduce((nr,gt)=>nr+gt,0)/me,Q=ae.reduce((nr,gt)=>nr+Math.pow(gt-je,2),0)/(me-1||1),ze=Math.sqrt(Q);if(ze===0)return[{x:je-.001,density:0},{x:je,density:1},{x:je+.001,density:0}];const rt=1.06*ze*Math.pow(me,-.2),wt=Math.min(...ae),Ot=Math.max(...ae),Jt=(Ot-wt)*.2||wt*.1,At=Math.max(0,wt-Jt),pr=Ot+Jt,vr=100,Dr=(pr-At)/(vr-1),Xr=nr=>1/Math.sqrt(2*Math.PI)*Math.exp(-.5*nr*nr),Ae=[];for(let nr=0;nr<vr;nr++){const gt=At+nr*Dr;let Tr=0;for(let Cr=0;Cr<me;Cr++)Tr+=Xr((gt-ae[Cr])/rt);Tr/=me*rt,Ae.push({x:gt,density:Tr})}return Ae},We=j.useCallback((ae,me,je,Q)=>{if(ae.length<5)return{gain:0,prnu:0};const ze=ae[ae.length-1].mean,rt=ze*(je.min/100),wt=ze*(je.max/100),Ot=ae.filter(Sr=>Sr.mean>=rt&&Sr.mean<=wt);if(Ot.length<5)return{gain:0,prnu:0};xt({nPoints:Ot.length});const Jt=me*me,At=[],pr=[];if(Ot.forEach(Sr=>{const zn=Sr.std*Sr.std-Jt;if(Sr.mean>1&&zn>0){const zi=Sr.mean,Wi=zn/Sr.mean;At.push({x:zi,y:Wi}),pr.push(Sr.mean/zn)}}),At.length<5)return{gain:0,prnu:0};const vr=[],Dr=At.length,Xr=Q,Ae=Dr*(Dr-1)/2;if(Ae<=Xr)for(let Sr=0;Sr<Dr;Sr++)for(let an=Sr+1;an<Dr;an++){const zn=At[an].x-At[Sr].x;Math.abs(zn)>1e-5&&vr.push((At[an].y-At[Sr].y)/zn)}else{const Sr=Math.max(1,Math.floor(Ae/Xr));for(let an=0;an<Dr;an++)for(let zn=an+1;zn<Dr;zn+=Sr){const zi=At[zn].x-At[an].x;Math.abs(zi)>1e-5&&vr.push((At[zn].y-At[an].y)/zi)}}const nr=iy(vr),gt=At.map(Sr=>Sr.y-nr*Sr.x),Tr=iy(gt);let Cr=0,Mn=0;if(Tr>1e-6?Cr=1/Tr:Cr=iy(pr),nr>0&&(Mn=Math.sqrt(nr)*100),pr.length>0){const Sr=vt(pr);De(Sr),pt(Cr)}else De([]);return{gain:Cr,prnu:Mn}},[]),st=j.useCallback(ae=>{let me=ae.read??jt.current.readNoise;const je=ae.gRange??or.current,Q=zt.current;if((ae.read!==void 0||ae.gRange!==void 0)&&ae.gain===void 0&&ae.prnu===void 0&&ye.length>0&&me>=0)w(!0),setTimeout(()=>{const rt=We(ye,me,je,Q);let wt=jt.current.gain,Ot=jt.current.prnu;rt.gain>0&&(wt=rt.gain,Ot=rt.prnu),et({readNoise:me,gain:wt,prnu:Ot}),ae.gRange!==void 0&&Gt(ae.gRange),It(Jt=>{var At,pr;return{...Jt,read:me.toString(),gain:wt>0?wt.toFixed(3):"0",prnu:Ot.toFixed(2),rangeMin:(((At=ae.gRange)==null?void 0:At.min)??Jt.rangeMin).toString(),rangeMax:(((pr=ae.gRange)==null?void 0:pr.max)??Jt.rangeMax).toString()}}),w(!1)},50);else{let rt=ae.gain!==void 0?ae.gain:jt.current.gain,wt=ae.prnu!==void 0?ae.prnu:jt.current.prnu;et({readNoise:me,gain:rt,prnu:wt}),ae.gRange!==void 0&&Gt(ae.gRange),It(Ot=>{var Jt,At;return{...Ot,read:me.toString(),gain:rt>0?rt.toFixed(3):"0",prnu:wt.toFixed(2),rangeMin:(((Jt=ae.gRange)==null?void 0:Jt.min)??Ot.rangeMin).toString(),rangeMax:(((At=ae.gRange)==null?void 0:At.max)??Ot.rangeMax).toString()}})}},[ye,We]),Be=`${W}-${r.length}`;j.useEffect(()=>{if(!e||!r||r.length===0)return;const ae=ge[qt];if(!ae||ae.length===0||de===Be)return;M({R:qt==="R",G1:qt==="G1",G2:qt==="G2",B:qt==="B"});const me=[...ae].sort((rt,wt)=>rt.x-wt.x);let je=0;me.length>0&&(je=me[0].std);const Q=Rt.filter(rt=>rt.channel===qt);let ze=-1/0;for(const rt of Q)rt.x>ze&&(ze=rt.x);ze!==-1/0&&Se(ze),st({read:je}),Ce(Be)},[e,r,de,Be,ge,qt,st,Rt]);const tr=(ae,me)=>{It(je=>({...je,[ae]:me}))},br=ae=>{let me=parseFloat(ut[ae]);isNaN(me)||me<0||st({[ae]:me})},Pr=()=>{H(F),Ce("")},Xt=()=>{const ae=parseFloat(ut.rangeMin),me=parseFloat(ut.rangeMax);!isNaN(ae)&&!isNaN(me)&&ae<me&&ae>=0&&me<=100&&st({gRange:{min:ae,max:me}})},Hr=(ae,me)=>{ae.key==="Enter"&&(me==="rangeMin"||me==="rangeMax"?Xt():br(me),ae.target.blur())};j.useEffect(()=>{e&&ye.length>0&&st({})},[e,He,ye]);const Br=ae=>{M(me=>({...me,[ae]:!me[ae]}))},Ur=()=>{y(ae=>ae==="top3"?"default":"top3")},ur=()=>{b==="raw"?y("default"):k(!0)},sr=()=>{k(!1),y("raw")},hr=(ae,me)=>{const je=parseFloat(ae),Q=parseFloat(me);let ze=isNaN(je)?"auto":je,rt=isNaN(Q)?"auto":Q;return h&&typeof ze=="number"&&ze<=0&&(ze="auto"),[ze,rt]},Ze=ae=>{if(!ae||!ae.payload)return;const me=ae.payload;if(g(me),ft.current&&(Se(me.x),te(!1)),Xe.current){const je=or.current.min,Q=or.current.max,{max:ze}=xr();if(ze<=0)return;const rt=Math.max(0,Math.min(100,me.x/ze*100));if(Ie.current===1){const wt=Math.min(rt,Q-.5);st({gRange:{min:wt,max:Q}}),ce(2)}else if(Ie.current===2){const wt=Math.max(rt,je+.5);st({gRange:{min:je,max:wt}}),ce(0),J(!1)}}},rr=j.useCallback(ae=>{const{cx:me,cy:je,fill:Q}=ae;return c.jsx("circle",{cx:me,cy:je,r:3,fill:Q,stroke:"none",style:{cursor:"pointer"}})},[]),Rr=({active:ae,payload:me})=>{if(ae&&me&&me.length){const je=me[0].payload;return c.jsxs("div",{className:"bg-slate-800 text-white text-xs p-2 rounded border border-slate-600 shadow-xl opacity-90 font-mono z-50",children:[c.jsx("div",{className:"font-bold border-b border-slate-600 pb-1 mb-1",children:je.channel}),c.jsxs("div",{children:["Signal: ",je.x.toFixed(2)]}),c.jsxs("div",{children:[d,": ",je.y.toFixed(4)]}),je.row!==void 0&&je.col!==void 0&&!isNaN(je.row)&&!isNaN(je.col)&&c.jsxs("div",{className:"text-cyan-400 mt-0.5",children:["Loc: Row ",je.row,", Col ",je.col]}),je.filename&&c.jsx("div",{className:"text-gray-400 mt-1 max-w-[200px] truncate",title:je.filename,children:je.filename})]})}return null},hn=ae=>{f(ae),ae==="Linear"&&p(!1)};if(!e)return null;const ra=s==="dark"?"#ffffff":"#000000";let Sn=d;d==="Linear"&&(Sn="(Var - RN) / Mean");const Na=F!==W;return c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:ae=>{ae.stopPropagation()},children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-[98vw] max-w-[2200px] h-[95vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700 overflow-hidden relative",onClick:ae=>ae.stopPropagation(),children:[c.jsx(Is,{isOpen:m,onClose:()=>k(!1),onConfirm:sr,title:"Warning: High Performance Cost",message:"Displaying all data points may cause the browser to freeze or become unresponsive, especially with large datasets. Are you sure you want to continue?",confirmText:"Yes, Show All"}),x&&c.jsxs("div",{className:"absolute top-20 right-8 z-30 bg-white/90 dark:bg-slate-800/90 border border-cyan-500 rounded-xl p-4 shadow-xl backdrop-blur-md max-w-xs animate-in fade-in zoom-in-95 duration-200",children:[c.jsxs("div",{className:"flex justify-between items-start mb-2 border-b border-gray-200 dark:border-slate-700 pb-2",children:[c.jsx("h4",{className:"font-bold text-gray-900 dark:text-white text-sm",children:"Selected Point"}),c.jsx("button",{onClick:()=>g(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"space-y-1 text-xs font-mono text-gray-700 dark:text-slate-300",children:c.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Channel:"}),c.jsx("span",{className:"font-bold",children:x.channel}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Signal (DN):"}),c.jsx("span",{children:x.x.toFixed(4)}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Noise (Std):"}),c.jsx("span",{children:x.std.toFixed(4)}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"SNR:"}),c.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:(x.x/x.std).toFixed(2)})]})})]}),Z&&c.jsx("div",{className:"absolute inset-0 z-40 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm flex flex-col items-center justify-center p-8 animate-in fade-in zoom-in-95 duration-200",children:c.jsxs("div",{className:"w-full max-w-2xl h-[60vh] bg-gray-50 dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 shadow-2xl p-4 flex flex-col relative",children:[c.jsx("button",{onClick:()=>xe(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),c.jsxs("div",{className:"mb-4 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-slate-200",children:"Gain Density Estimation"}),c.jsxs("p",{className:"text-xs text-gray-500 dark:text-slate-400",children:["HSM Mode: ",c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:qe==null?void 0:qe.toFixed(4)}),c.jsx("span",{className:"mx-2",children:"|"}),"Data Points: ",ue.length>0?"Density Curve Generated":"No Data"]})]}),c.jsx("div",{className:"flex-1 min-h-0",children:ue.length>0?c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(nO,{data:ue,margin:{top:10,right:30,left:0,bottom:20},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3,vertical:!1}),c.jsx(wa,{dataKey:"x",tickFormatter:ae=>ae.toFixed(2),tick:{fill:"#9ca3af",fontSize:10},label:{value:"Gain (e/ADU)",position:"insideBottom",offset:-15,fill:"#9ca3af",fontSize:12}}),c.jsx(ka,{tick:{fill:"#9ca3af",fontSize:10}}),c.jsx($n,{cursor:{stroke:"rgba(255,255,255,0.2)"},contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6"}}),c.jsx(pi,{type:"monotone",dataKey:"density",stroke:"#0ea5e9",fill:"#0ea5e9",fillOpacity:.3,strokeWidth:2}),qe!==null&&c.jsx(Ss,{x:qe,stroke:"#ef4444",strokeWidth:2,label:{value:"HSM",fill:"#ef4444",fontSize:10,position:"top"}})]})}):c.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No data in selected range"})})]})}),c.jsxs("div",{className:"flex flex-wrap justify-between items-center p-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50 gap-4 flex-shrink-0",children:[c.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2",children:["Photon Transfer Curve",c.jsxs("span",{className:"text-xs font-normal bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-300 px-2 py-0.5 rounded border border-purple-200 dark:border-purple-800",children:[r.length," Pts"]})]}),c.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[c.jsxs("button",{onClick:B,className:"bg-green-600 hover:bg-green-500 text-white font-bold py-1 px-3 rounded text-xs shadow-md transition-all active:scale-95 flex items-center gap-1",title:"Render all points, target lines, and metadata to a high-res JPG",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export Complete Result"]}),c.jsxs("div",{className:"flex bg-white dark:bg-slate-700 rounded-lg p-1 border border-gray-200 dark:border-slate-600",children:[c.jsx("button",{onClick:()=>hn("Noise"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="Noise"?"bg-cyan-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"Noise ()"}),c.jsx("button",{onClick:()=>hn("SNR"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="SNR"?"bg-purple-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"SNR"}),c.jsx("button",{onClick:()=>hn("Linear"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="Linear"?"bg-indigo-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"Linear (PTC)"})]}),c.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-slate-300 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:h,onChange:ae=>p(ae.target.checked),className:"rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-100 dark:bg-slate-700 dark:border-slate-600"}),"Log-Log"]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-0 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm flex-shrink-0",children:[c.jsxs("div",{className:"lg:col-span-9 p-5 flex flex-col gap-5 border-r border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between text-xs",children:[c.jsxs("div",{className:"flex gap-4 items-center",children:[c.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-50 dark:bg-slate-800 rounded-md p-1 border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400 pl-1",children:"X:"}),c.jsx("input",{type:"number",placeholder:"Min",value:N,onChange:ae=>_(ae.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",placeholder:"Max",value:P,onChange:ae=>E(ae.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-50 dark:bg-slate-800 rounded-md p-1 border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400 pl-1",children:"Y:"}),c.jsx("input",{type:"number",placeholder:"Min",value:R,onChange:ae=>T(ae.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",placeholder:"Max",value:G,onChange:ae=>L(ae.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"})]}),c.jsx("button",{onClick:()=>{_(""),E(""),T(""),L("")},className:"text-xs text-cyan-600 dark:text-cyan-400 hover:underline",children:"Auto"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-slate-700 p-1 rounded-lg border border-gray-200 dark:border-slate-600",children:[c.jsx("button",{onClick:()=>Br("R"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.R?"bg-red-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"R"}),c.jsx("button",{onClick:()=>Br("G1"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.G1?"bg-green-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"G1"}),c.jsx("button",{onClick:()=>Br("G2"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.G2?"bg-green-400 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"G2"}),c.jsx("button",{onClick:()=>Br("B"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.B?"bg-blue-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"B"})]})]}),c.jsxs("div",{className:"flex flex-wrap items-end gap-8",children:[c.jsxs("div",{className:"flex flex-col bg-gray-50 dark:bg-slate-800/50 p-2 rounded border border-gray-100 dark:border-slate-700",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-gray-500 dark:text-slate-400 mb-1",children:"Black Level (0,0 0,1 1,0 1,1)"}),c.jsx("input",{type:"text",value:F,onChange:ae=>D(ae.target.value),className:"w-32 text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-cyan-500 font-mono",placeholder:"0 0 0 0"})]}),c.jsxs("div",{className:"flex flex-col justify-between bg-gray-50 dark:bg-slate-800/50 p-2 rounded border border-gray-100 dark:border-slate-700",children:[c.jsxs("div",{className:"flex justify-between items-center mb-1",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-gray-500 dark:text-slate-400 mr-2",children:"Fit Range % (Robust)"}),c.jsx("button",{onClick:()=>{J(!re),ce(re?0:1)},className:`px-1.5 py-0.5 text-[9px] rounded border transition-colors ${re?"bg-cyan-100 text-cyan-700 border-cyan-300 animate-pulse":"bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300 hover:bg-gray-50"}`,children:re?ne===1?"Pick Min":"Pick Max":"Select"})]}),c.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"number",step:"0.1",value:ut.rangeMin,onChange:ae=>tr("rangeMin",ae.target.value),onBlur:Xt,onKeyDown:ae=>Hr(ae,"rangeMin"),className:"w-10 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-0.5 text-center font-bold"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",step:"0.1",value:ut.rangeMax,onChange:ae=>tr("rangeMax",ae.target.value),onBlur:Xt,onKeyDown:ae=>Hr(ae,"rangeMax"),className:"w-10 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-0.5 text-center font-bold"})]})]}),c.jsxs("div",{className:"flex flex-col bg-indigo-50 dark:bg-indigo-900/20 p-2 rounded border border-indigo-100 dark:border-indigo-800/50",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-indigo-600 dark:text-indigo-400 mb-1",children:"DR Params"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-300",children:"Img H:"}),c.jsx("input",{type:"number",value:A,onChange:ae=>O(ae.target.value),onKeyDown:Wt,placeholder:"Empty",className:"w-14 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-200 dark:border-indigo-800 rounded text-center font-bold text-indigo-700 dark:text-indigo-300 text-xs placeholder:font-normal placeholder:text-gray-300"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-300",children:"Tgt SNR:"}),c.jsx("input",{type:"number",value:C,onChange:ae=>$(ae.target.value),className:"w-10 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-200 dark:border-indigo-800 rounded text-center font-bold text-indigo-700 dark:text-indigo-300 text-xs"})]})]})]}),c.jsxs("div",{className:"flex flex-col gap-1 text-[10px] justify-end pb-0.5",children:[c.jsx("button",{onClick:()=>{te(!Y),U&&Se(null)},disabled:re,className:`font-bold rounded border shadow-sm transition-all px-3 py-1.5 ${Y?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border-amber-500 animate-pulse":"bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border-gray-300 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:Y?"Pick Point":"Select Linear Limit"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:Ur,className:`flex-1 font-bold rounded border shadow-sm transition-all px-2 py-1 ${b==="top3"?"bg-indigo-600 text-white border-indigo-700":"bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border-gray-300 dark:border-slate-600 hover:bg-gray-50"}`,children:"Top 3%"}),c.jsx("button",{onClick:ur,className:`font-bold rounded border shadow-sm transition-all px-2 py-1 ${b==="raw"?"bg-red-600 text-white border-red-700":"text-red-500 border-red-200 hover:bg-red-50"}`,children:"All"})]})]})]}),c.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-gray-50/50 dark:bg-slate-800/20 p-2 rounded-lg border border-gray-100 dark:border-slate-800",children:[c.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 dark:text-slate-500",children:"Metadata"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:Fe,onChange:ae=>Ue(ae.target.value),placeholder:"Tester Name",className:"w-24 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"}),c.jsx("input",{type:"text",value:K,onChange:ae=>_e(ae.target.value),placeholder:"Camera Model",className:"w-32 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"}),c.jsx("input",{type:"text",value:Te,onChange:ae=>Le(ae.target.value),placeholder:"ISO",className:"w-16 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"})]})]}),c.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-fuchsia-50/50 dark:bg-fuchsia-900/10 p-2 rounded-lg border border-fuchsia-100 dark:border-fuchsia-900/30",children:[c.jsx("span",{className:"text-[10px] uppercase font-bold text-fuchsia-500 dark:text-fuchsia-400",children:"Markers"}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("input",{type:"number",value:oe,onChange:ae=>ke(ae.target.value),placeholder:"X (Signal)",className:"w-20 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 outline-none focus:border-fuchsia-500 transition-colors"}),c.jsx("input",{type:"number",value:le,onChange:ae=>fe(ae.target.value),placeholder:"Y (Value)",className:"w-20 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 outline-none focus:border-fuchsia-500 transition-colors"}),c.jsx("button",{onClick:Pe,className:"px-3 py-1 bg-fuchsia-600 hover:bg-fuchsia-500 text-white text-xs font-bold rounded shadow-sm transition-colors active:scale-95",children:"+"}),ie.length>0&&c.jsx("button",{onClick:()=>se([]),className:"px-2 py-1 bg-gray-200 dark:bg-slate-700 hover:bg-red-500 hover:text-white text-gray-600 dark:text-slate-300 text-xs font-bold rounded shadow-sm transition-colors active:scale-95",children:"Clr"})]}),c.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono",children:[ie.length," pts"]})]}),c.jsxs("div",{className:"flex gap-4 text-[10px] pt-1 justify-center sm:justify-start flex-wrap",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Lt.shot,onChange:ae=>Me({...Lt,shot:ae.target.checked}),className:"rounded text-gray-500"})," ",c.jsx("span",{className:"text-gray-500",children:"Shot Noise"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Lt.read,onChange:ae=>Me({...Lt,read:ae.target.checked}),className:"rounded text-rose-500"})," ",c.jsx("span",{className:"text-rose-500",children:"Read Noise"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Lt.prnu,onChange:ae=>Me({...Lt,prnu:ae.target.checked}),className:"rounded text-amber-500"})," ",c.jsx("span",{className:"text-amber-500",children:"PRNU"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Lt.total,onChange:ae=>Me({...Lt,total:ae.target.checked}),className:"rounded text-white"})," ",c.jsx("span",{className:"text-gray-900 dark:text-white font-bold",children:"Model"})]})]})]}),c.jsxs("div",{className:"lg:col-span-3 bg-slate-100 dark:bg-slate-800 p-4 flex flex-col justify-center gap-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-center mb-1 px-1",children:[c.jsxs("h3",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase flex items-center gap-2",children:["Fit Parameters (D55 SAT Channel:",qt,")",S&&c.jsx("span",{className:"text-orange-500 animate-pulse text-[10px]",children:"Calculating..."})]}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("button",{onClick:Pr,disabled:S,className:`px-3 py-1 text-white text-[10px] font-bold rounded shadow-sm transition-all flex items-center gap-1 active:scale-95 
                                            ${S?"bg-gray-400 cursor-wait":Na?"bg-orange-500 hover:bg-orange-600 animate-pulse ring-2 ring-orange-400/50":"bg-cyan-600 hover:bg-cyan-500"}
                                        `,title:"Apply Black Level, Auto-detect Read Noise, then Recalculate Fit",children:S?c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-3 h-3 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),c.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Fitting..."]}):c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Apply & Calc"]})}),c.jsxs("select",{value:He,onChange:ae=>mt(Number(ae.target.value)),className:"text-[9px] bg-slate-200 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded px-1 py-0.5 border-none outline-none cursor-pointer hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",title:"Number of point-pairs to sample for robust regression (Theil-Sen)",children:[c.jsx("option",{value:1e5,children:"100k Pairs"}),c.jsx("option",{value:5e5,children:"500k Pairs"}),c.jsx("option",{value:2e6,children:"2M Pairs"}),c.jsx("option",{value:5e6,children:"5M Pairs"}),c.jsx("option",{value:1e7,children:"10M Pairs"})]}),ht&&c.jsxs("span",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono",title:"Number of points used in regression",children:["N=",ht.nPoints]})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1",children:"rn/fpn"}),c.jsx("input",{type:"text",inputMode:"decimal",value:ut.read,onChange:ae=>tr("read",ae.target.value),onBlur:()=>br("read"),onKeyDown:ae=>Hr(ae,"read"),className:"w-full text-center text-2xl font-light bg-transparent text-rose-500 outline-none border-b border-transparent focus:border-rose-500 transition-colors"})]}),c.jsxs("div",{className:"flex flex-col items-center relative group",children:[c.jsxs("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1 flex items-center gap-1",children:["Kadc (HSM)",c.jsx("button",{onClick:()=>xe(!0),className:"text-[9px] text-cyan-600 dark:text-cyan-400 hover:underline",children:"Dist."})]}),c.jsx("input",{type:"text",inputMode:"decimal",value:ut.gain,onChange:ae=>tr("gain",ae.target.value),onBlur:()=>br("gain"),onKeyDown:ae=>Hr(ae,"gain"),className:"w-full text-center text-2xl font-light bg-transparent text-slate-700 dark:text-slate-200 outline-none border-b border-transparent focus:border-cyan-500 transition-colors"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1",children:"PRNU (%)"}),c.jsx("input",{type:"text",inputMode:"decimal",value:ut.prnu,onChange:ae=>tr("prnu",ae.target.value),onBlur:()=>br("prnu"),onKeyDown:ae=>Hr(ae,"prnu"),className:"w-full text-center text-2xl font-light bg-transparent text-amber-500 outline-none border-b border-transparent focus:border-amber-500 transition-colors"})]})]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[c.jsxs("div",{className:"flex flex-col justify-center bg-cyan-50 dark:bg-cyan-900/10 p-2 rounded-lg border border-cyan-100 dark:border-cyan-900/30",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-500 uppercase tracking-wide mb-1 truncate",title:`Manual DR at SNR=${(Ee==null?void 0:Ee.manualTarget)||C}`,children:["M.DR @ SNR=",(Ee==null?void 0:Ee.manualTarget)||C]}),c.jsx("div",{className:"text-base font-bold text-cyan-700 dark:text-cyan-400 whitespace-nowrap",children:Ee!=null&&Ee.manualDR?`${Ee.manualDR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-emerald-50 dark:bg-emerald-900/10 p-2 rounded-lg border border-emerald-100 dark:border-emerald-900/30",title:isNaN((Ee==null?void 0:Ee.ptpTarget)||NaN)?"Requires Image Height":`Standard Point-to-Point DR (Target SNR = 16000/${A||"H"})`,children:[c.jsx("h4",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-500 uppercase tracking-wide mb-1",children:"PTP DR"}),c.jsx("div",{className:"text-base font-bold text-emerald-700 dark:text-emerald-400 whitespace-nowrap",children:Ee!=null&&Ee.ptpDR?`${Ee.ptpDR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-purple-50 dark:bg-purple-900/10 p-2 rounded-lg border border-purple-100 dark:border-purple-900/30",title:isNaN((Ee==null?void 0:Ee.ptpTarget)||NaN)?"Requires Image Height":`D55 Saturation DR (Target SNR = 16000/${A||"H"} on ${Ee==null?void 0:Ee.dominantChannel} Channel)`,children:[c.jsxs("h4",{className:"text-[10px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wide mb-1 truncate",children:["D55 DR (",Ee==null?void 0:Ee.dominantChannel,")"]}),c.jsx("div",{className:"text-base font-bold text-purple-700 dark:text-purple-400 whitespace-nowrap",children:Ee!=null&&Ee.d55DR?`${Ee.d55DR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-orange-50 dark:bg-orange-900/10 p-2 rounded-lg border border-orange-100 dark:border-orange-900/30",children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wide mb-1",children:"FWC"}),c.jsx("div",{className:"text-base font-bold text-orange-600 dark:text-orange-400 font-mono whitespace-nowrap truncate",title:Dt!==null?`${Math.round(Dt)}`:"",children:Dt!==null?Dt>1e4?`${(Dt/1e3).toFixed(1)}k`:`${Math.round(Dt)}`:"--"})]})]}),U===null&&c.jsx("div",{className:"text-center text-[10px] text-red-500 animate-pulse font-bold mt-[-10px]",children:"Please select Linear Limit on chart to calc DR"})]})]}),c.jsxs("div",{className:`flex-1 p-4 bg-white dark:bg-slate-900 relative grid grid-cols-[auto_1fr] grid-rows-[1fr_auto] gap-2 ${Y||re?"cursor-crosshair":""}`,children:[c.jsx("div",{className:"row-start-1 col-start-1 h-full",children:c.jsx(c4,{vertical:!0,min:tt,max:it,value:[R?parseFloat(R):tt,G?parseFloat(G):it],onChange:([ae,me])=>{T(ae.toString()),L(me.toString())},logScale:h})}),c.jsxs("div",{className:"row-start-1 col-start-2 relative",children:[kt.length===0?c.jsx("div",{className:"flex h-full items-center justify-center text-gray-400",children:"No valid data points found."}):c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(Doe,{margin:{top:20,right:20,bottom:0,left:0},onClick:Ze,children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",height:"300%",width:"300%",x:"-100%",y:"-100%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),c.jsx(wa,{type:"number",dataKey:"x",name:"Signal",scale:h?"log":"linear",domain:hr(N,P),allowDataOverflow:!0,hide:!0}),c.jsx(ka,{type:"number",dataKey:"y",name:d,scale:h?"log":"linear",domain:hr(R,G),label:{value:Sn,angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12},tick:{fill:"#9ca3af",fontSize:10},allowDataOverflow:!0}),c.jsx($n,{content:c.jsx(Rr,{}),cursor:{strokeDasharray:"3 3"}}),U&&c.jsx(Ss,{x:U,stroke:"red",strokeDasharray:"3 3",label:{position:"top",value:"Sat",fill:"red",fontSize:10}}),(Lt.fitRange||re)&&c.jsxs(c.Fragment,{children:[c.jsx(Ss,{x:Zt,stroke:"#22d3ee",strokeDasharray:"5 5",label:{position:"insideTopLeft",value:`Min: ${nt.min}%`,fill:"#22d3ee",fontSize:9}}),c.jsx(Ss,{x:Vt,stroke:"#22d3ee",strokeDasharray:"5 5",label:{position:"insideTopLeft",value:`Max: ${nt.max}%`,fill:"#22d3ee",fontSize:9}})]}),v.R&&c.jsx(xa,{name:"Red",data:ge.R,fill:"#ef4444",shape:rr,onClick:Ze,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-R"),v.G1&&c.jsx(xa,{name:"Green 1",data:ge.G1,fill:"#22c55e",shape:rr,onClick:Ze,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-G1"),v.G2&&c.jsx(xa,{name:"Green 2",data:ge.G2,fill:"#4ade80",shape:rr,onClick:Ze,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-G2"),v.B&&c.jsx(xa,{name:"Blue",data:ge.B,fill:"#3b82f6",shape:rr,onClick:Ze,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-B"),Lt.shot&&ot.shot.length>0&&c.jsx(xa,{name:"Shot Noise (Ideal)",data:ot.shot,line:{stroke:"#94a3b8",strokeWidth:1,strokeDasharray:"5 5"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-shot"),Lt.read&&ot.read.length>0&&c.jsx(xa,{name:"Read Noise Floor",data:ot.read,line:{stroke:"#f43f5e",strokeWidth:1,strokeDasharray:"3 3"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-read"),Lt.prnu&&ot.prnu.length>0&&c.jsx(xa,{name:"PRNU (Non-uniformity)",data:ot.prnu,line:{stroke:"#f59e0b",strokeWidth:1,strokeDasharray:"3 3"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-prnu"),Lt.total&&ot.total.length>0&&c.jsx(xa,{name:"Total Noise Model",data:ot.total,line:{stroke:ra,strokeWidth:2},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-total"),ir.length>0&&c.jsx(xa,{name:`Target SNR=${C}`,data:ir,line:{stroke:"#6366f1",strokeWidth:2,strokeDasharray:"4 2"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-target"),er.length>0&&c.jsx(xa,{name:`PTP Target SNR=${Ee!=null&&Ee.ptpTarget?Ee.ptpTarget.toFixed(1):"?"}`,data:er,line:{stroke:"#10b981",strokeWidth:2,strokeDasharray:"4 4"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-ptp"),ie.length>0&&c.jsx(xa,{name:"Manual Markers",data:ie,fill:"#d946ef",shape:"star",legendType:"star"},"manual-points")]})}),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none select-none opacity-25 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})})]}),c.jsx("div",{className:"row-start-2 col-start-2 w-full",children:c.jsx(c4,{min:fr,max:be,value:[N?parseFloat(N):fr,P?parseFloat(P):be],onChange:([ae,me])=>{_(ae.toString()),E(me.toString())},logScale:h})})]})]})})},Qoe=({searchTerm:e,onSearchChange:t,manufacturers:r,selectedManufacturer:n,onManufacturerChange:a,cameras:i,onCameraSelect:o})=>c.jsx("div",{className:"sticky top-4 z-10 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm p-4 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[c.jsxs("div",{className:"relative md:col-span-3",children:[c.jsx("input",{type:"text",placeholder:"Search camera model...",value:e,onChange:s=>t(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400"}),c.jsx("svg",{className:"w-5 h-5 text-gray-400 dark:text-slate-400 absolute top-1/2 left-3 transform -translate-y-1/2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),c.jsx("select",{value:n,onChange:s=>a(s.target.value),className:"w-full md:col-span-1 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 appearance-none text-gray-900 dark:text-slate-200",children:r.map(s=>c.jsx("option",{value:s,children:s},s))}),c.jsxs("select",{onChange:s=>o(s.target.value),className:"w-full md:col-span-1 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 appearance-none text-gray-900 dark:text-slate-200",value:"","aria-label":"Jump to camera model",children:[c.jsx("option",{value:"",disabled:!0,children:"Jump to model..."}),i.map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),ese=({active:e,payload:t,label:r,theme:n})=>{if(e&&t&&t.length){const a=t[0].payload,i=n==="dark"?"bg-slate-800/80 border-slate-600 text-slate-300":"bg-white/90 border-gray-200 text-gray-700";return c.jsxs("div",{className:`${i} backdrop-blur-sm border p-3 rounded-lg shadow-lg`,children:[c.jsx("p",{className:"label font-bold",children:`ISO ${r}`}),c.jsx("div",{className:"mt-2 space-y-1 text-sm",children:c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{color:"#f87171"},children:["Red: ",a.R_avg.toFixed(2)," (Range: ",a.R_range[0]," - ",a.R_range[1],")"]}),c.jsxs("div",{style:{color:"#4ade80"},children:["Green 1: ",a.G1_avg.toFixed(2)," (Range: ",a.G1_range[0]," - ",a.G1_range[1],")"]}),c.jsxs("div",{style:{color:"#60a5fa"},children:["Blue: ",a.B_avg.toFixed(2)," (Range: ",a.B_range[0]," - ",a.B_range[1],")"]}),c.jsxs("div",{style:{color:"#86efac"},children:["Green 2: ",a.G2_avg.toFixed(2)," (Range: ",a.G2_range[0]," - ",a.G2_range[1],")"]})]})})]})}return null},tse=({data:e,theme:t="dark"})=>{const r=j.useMemo(()=>!e||e.length===0?[]:[...new Set(e.map(o=>o.iso))].sort((o,s)=>Number(o)-Number(s)),[e]),n=j.useMemo(()=>{if(!e||e.length===0)return[0,4096];const o=e.flatMap(x=>[...x.R_range,...x.G1_range,...x.G2_range,...x.B_range]);if(o.length===0)return[0,4096];let s=Math.min(...o),l=Math.max(...o);const u=.25,d=l-s;if(d<u){const x=u-d;s-=x/2,l+=x/2}const f=(l-s)*.1,h=s-f,p=l+f;return[h,p]},[e]),a=t==="dark"?"#475569":"#e5e7eb",i=t==="dark"?"#94a3b8":"#6b7280";return!e||e.length===0?c.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-slate-500",children:c.jsx("p",{children:"No data available for this mode."})}):c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(nO,{data:e,margin:{top:5,right:20,left:0,bottom:5},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:a}),c.jsx(wa,{dataKey:"iso",type:"number",domain:["dataMin","dataMax"],tick:{fill:i,fontSize:12},scale:"log",allowDuplicatedCategory:!1,ticks:r}),c.jsx(ka,{tick:{fill:i,fontSize:12},domain:n,allowDecimals:!0,tickFormatter:o=>Number(o).toFixed(3)}),c.jsx($n,{content:c.jsx(ese,{theme:t})}),c.jsx(ro,{wrapperStyle:{fontSize:"14px",color:i}}),c.jsx(pi,{type:"monotone",dataKey:"R_range",fill:"#f87171",stroke:"none",fillOpacity:.2,name:"Red",legendType:"none"}),c.jsx(Ln,{type:"monotone",dataKey:"R_avg",stroke:"#f87171",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Red"}),c.jsx(pi,{type:"monotone",dataKey:"G1_range",fill:"#4ade80",stroke:"none",fillOpacity:.2,name:"Green 1",legendType:"none"}),c.jsx(Ln,{type:"monotone",dataKey:"G1_avg",stroke:"#4ade80",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Green 1"}),c.jsx(pi,{type:"monotone",dataKey:"B_range",fill:"#60a5fa",stroke:"none",fillOpacity:.2,name:"Blue",legendType:"none"}),c.jsx(Ln,{type:"monotone",dataKey:"B_avg",stroke:"#60a5fa",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Blue"}),c.jsx(pi,{type:"monotone",dataKey:"G2_range",fill:"#86efac",stroke:"none",fillOpacity:.2,name:"Green 2",legendType:"none"}),c.jsx(Ln,{type:"monotone",dataKey:"G2_avg",stroke:"#86efac",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Green 2"})]})})},rse=ee.forwardRef(({camera:e,theme:t="dark"},r)=>{const n=j.useMemo(()=>e.shootingModes.map(f=>f.modeName),[e.shootingModes]),[a,i]=j.useState(n[0]||""),{chartData:o,tableData:s}=j.useMemo(()=>{const f=e.shootingModes.find(x=>x.modeName===a);if(!(f!=null&&f.data))return{chartData:[],tableData:[]};const h=f.data.map(x=>({iso:x.iso,R_range:x.r.range,R_avg:x.r.avg,G1_range:x.g1.range,G1_avg:x.g1.avg,B_range:x.b.range,B_avg:x.b.avg,G2_range:x.g2.range,G2_avg:x.g2.avg})),p=f.data.map(x=>({iso:x.iso,levels:[x.r.avg,x.g1.avg,x.g2.avg,x.b.avg],clipping:x.clipping}));return{chartData:h,tableData:p}},[e.shootingModes,a]),l=`Raw Data (${a})`,u=j.useRef(null),d=j.useRef(null);return j.useEffect(()=>{const f=u.current,h=d.current;if(!f||!h)return;const p=new ResizeObserver(x=>{for(let g of x){const{width:b}=g.contentRect,m=Math.max(8,b/35);h.style.fontSize=`${m}px`}});return p.observe(f),()=>p.disconnect()},[]),c.jsxs("div",{ref:r,className:"bg-white dark:bg-slate-800/50 border border-gray-200 dark:border-slate-700 rounded-xl shadow-lg p-6 flex flex-col gap-6 transform hover:scale-[1.02] hover:border-cyan-500/50 transition-all duration-500 ease-in-out",children:[c.jsxs("div",{className:"border-b border-gray-200 dark:border-slate-700 pb-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-slate-100",children:e.name}),c.jsx("p",{className:"text-cyan-600 dark:text-cyan-400",children:e.manufacturer})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-slate-300",children:"Black Level vs. ISO"}),c.jsx("select",{value:a,onChange:f=>i(f.target.value),className:"w-full sm:w-auto bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-md px-3 py-1 text-sm outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-300 text-gray-900 dark:text-slate-200","aria-label":`Select shooting mode for ${e.name}`,children:n.map(f=>c.jsx("option",{value:f,children:f},f))})]}),c.jsxs("div",{ref:u,className:"h-64 relative",children:[c.jsx(tse,{data:o,theme:t},a),c.jsx("div",{className:"absolute top-1/2 left-[52%] transform -translate-x-1/2 -translate-y-1/2 -rotate-30 pointer-events-none",children:c.jsx("p",{ref:d,className:"font-bold text-gray-900/10 dark:text-slate-200/40 whitespace-nowrap",children:" y-g-jiang.github.io"})})]})]}),c.jsxs("div",{className:"overflow-x-auto",children:[c.jsx("div",{className:"flex justify-between items-center mb-4",children:c.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-slate-300",children:l})}),c.jsxs("table",{className:"w-full text-left border-collapse",children:[c.jsx("thead",{className:"bg-gray-100 dark:bg-slate-700/50",children:c.jsxs("tr",{children:[c.jsx("th",{className:"p-3 font-semibold text-sm text-gray-700 dark:text-slate-300",children:"ISO"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-red-500 dark:text-red-400",children:"Red"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-green-600 dark:text-green-400",children:"Green 1"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-blue-500 dark:text-blue-400",children:"Blue"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-green-500 dark:text-green-300",children:"Green 2"})]})}),c.jsx("tbody",{children:s.map(({iso:f,levels:h,clipping:p})=>c.jsxs("tr",{className:"border-b border-gray-200 dark:border-slate-700/50 last:border-b-0",children:[c.jsxs("td",{className:"p-3 font-mono text-gray-700 dark:text-slate-300 whitespace-nowrap",children:[f,p&&c.jsx("span",{className:"ml-3 text-xs font-semibold text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-900/50 px-2 py-1 rounded-full align-middle",children:"Clipping"})]}),c.jsx("td",{className:"p-3 font-mono text-red-500 dark:text-red-400",children:h[0].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-green-600 dark:text-green-400",children:h[1].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-blue-500 dark:text-blue-400",children:h[3].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-green-500 dark:text-green-300",children:h[2].toFixed(2)})]},f))})]})]})]})}),Qe=(e,t,r)=>({avg:e,range:[t,r]}),oy=[{id:"sony-a7r2",name:"Sony ILCE-7RM2 (A7R II)",manufacturer:"Sony",shootingModes:[{modeName:"Still (Mechanical Shutter)",data:[{iso:100,r:Qe(512.1,511.95,512.25),g1:Qe(512.05,511.9,512.2),b:Qe(512.12,511.98,512.28),g2:Qe(512.06,511.92,512.22)},{iso:200,r:Qe(512.15,512,512.3),g1:Qe(512.1,511.95,512.25),b:Qe(512.18,512.05,512.35),g2:Qe(512.12,511.98,512.28)},{iso:400,r:Qe(512.25,512.1,512.45),g1:Qe(512.2,512.05,512.4),b:Qe(512.3,512.15,512.5),g2:Qe(512.22,512.08,512.42)},{iso:800,r:Qe(512.5,512.2,512.8),g1:Qe(512.45,512.15,512.75),b:Qe(512.55,512.25,512.85),g2:Qe(512.48,512.18,512.78)},{iso:1600,r:Qe(513.1,512.8,513.4),g1:Qe(513.05,512.75,513.35),b:Qe(513.15,512.85,513.45),g2:Qe(513.08,512.78,513.38)}]}]},{id:"sony-a7c",name:"Sony ILCE-7C",manufacturer:"Sony",shootingModes:[{modeName:"Still (Mechanical)",data:[{iso:100,r:Qe(512.02,511.98,512.05),g1:Qe(512.01,511.97,512.04),b:Qe(512.03,511.99,512.06),g2:Qe(512.01,511.97,512.04)},{iso:640,r:Qe(512.15,512.05,512.25),g1:Qe(512.12,512.02,512.22),b:Qe(512.18,512.08,512.28),g2:Qe(512.13,512.03,512.23)}]}]},{id:"canon-r5",name:"Canon EOS R5",manufacturer:"Canon",shootingModes:[{modeName:"Mechanical Shutter",data:[{iso:100,r:Qe(512,511.8,512.2),g1:Qe(512,511.8,512.2),b:Qe(512,511.8,512.2),g2:Qe(512,511.8,512.2)},{iso:400,r:Qe(512,511.7,512.3),g1:Qe(512,511.7,512.3),b:Qe(512,511.7,512.3),g2:Qe(512,511.7,512.3)},{iso:1600,r:Qe(512.2,511.5,512.8),g1:Qe(512.2,511.5,512.8),b:Qe(512.2,511.5,512.8),g2:Qe(512.2,511.5,512.8)}]}]},{id:"canon-r6",name:"Canon EOS R6",manufacturer:"Canon",shootingModes:[{modeName:"Mechanical Shutter",data:[{iso:100,r:Qe(511.95,511.8,512.1),g1:Qe(511.95,511.8,512.1),b:Qe(511.95,511.8,512.1),g2:Qe(511.95,511.8,512.1)},{iso:800,r:Qe(512.1,511.9,512.3),g1:Qe(512.1,511.9,512.3),b:Qe(512.1,511.9,512.3),g2:Qe(512.1,511.9,512.3)}]}]},{id:"nikon-z9",name:"Nikon Z9",manufacturer:"Nikon",shootingModes:[{modeName:"Electronic Shutter",data:[{iso:64,r:Qe(400,399.9,400.1),g1:Qe(400,399.9,400.1),b:Qe(400,399.9,400.1),g2:Qe(400,399.9,400.1)},{iso:100,r:Qe(400,399.9,400.1),g1:Qe(400,399.9,400.1),b:Qe(400,399.9,400.1),g2:Qe(400,399.9,400.1)}]}]},{id:"nikon-z6-2",name:"Nikon Z 6II",manufacturer:"Nikon",shootingModes:[{modeName:"Still (Lossless)",data:[{iso:100,r:Qe(400.1,399.8,400.3),g1:Qe(400.1,399.8,400.3),b:Qe(400.1,399.8,400.3),g2:Qe(400.1,399.8,400.3)},{iso:800,r:Qe(400.3,399.5,401.1),g1:Qe(400.3,399.5,401.1),b:Qe(400.3,399.5,401.1),g2:Qe(400.3,399.5,401.1)}]}]},{id:"fujifilm-xt4",name:"Fujifilm X-T4",manufacturer:"Fujifilm",shootingModes:[{modeName:"Still (RAF)",data:[{iso:160,r:Qe(1024,1023.8,1024.2),g1:Qe(1024,1023.8,1024.2),b:Qe(1024,1023.8,1024.2),g2:Qe(1024,1023.8,1024.2)},{iso:800,r:Qe(1024.2,1023.5,1025),g1:Qe(1024.2,1023.5,1025),b:Qe(1024.2,1023.5,1025),g2:Qe(1024.2,1023.5,1025)}]}]}],nse=({isOpen:e,onClose:t,theme:r})=>{const[n,a]=j.useState(""),[i,o]=j.useState("All"),s=j.useMemo(()=>["All",...Array.from(new Set(oy.map(f=>f.manufacturer))).sort()],[]),l=j.useMemo(()=>oy.filter(d=>{const f=d.name.toLowerCase().includes(n.toLowerCase()),h=i==="All"||d.manufacturer===i;return f&&h}),[n,i]),u=d=>{const f=document.getElementById(`camera-${d}`);f&&f.scrollIntoView({behavior:"smooth"})};return e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700 overflow-hidden",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:[c.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2",children:["Camera Black Level Database",c.jsxs("span",{className:"text-xs font-normal bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600 dark:text-cyan-400 px-2 py-0.5 rounded border border-cyan-200 dark:border-cyan-800",children:[oy.length," Models"]})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/30",children:c.jsx(Qoe,{searchTerm:n,onSearchChange:a,manufacturers:s,selectedManufacturer:i,onManufacturerChange:o,cameras:l,onCameraSelect:u})}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700 bg-gray-100 dark:bg-slate-950",children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-6",children:[l.map(d=>c.jsx("div",{id:`camera-${d.id}`,children:c.jsx(rse,{camera:d,theme:r})},d.id)),l.length===0&&c.jsx("div",{className:"col-span-full flex flex-col items-center justify-center py-20 text-gray-400 dark:text-slate-600",children:c.jsx("p",{className:"text-lg",children:"No cameras found matching your criteria."})})]})})]})}):null},ase=({isOpen:e,onClose:t,zIndex:r=150})=>{const[n,a]=j.useState(""),[i,o]=j.useState(""),[s,l]=j.useState(""),[u,d]=j.useState(""),[f,h]=j.useState(null),p=()=>{const x=parseFloat(n),g=parseFloat(i),b=parseFloat(s),y=parseFloat(u);if(isNaN(x)||isNaN(g)||isNaN(b)||isNaN(y)){h(null);return}const m=x,k=g,S=b*b,w=y*y,v=(m+k)/2;if(v<=1e-9){h(0);return}const M=S*w/v,N=Math.sqrt(M);h(N)};return e?c.jsxs(qs,{initialPosition:{x:window.innerWidth/2-160,y:window.innerHeight/2-200},onClose:t,zIndex:r,className:"w-80 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsx("h3",{className:"text-sm font-bold text-gray-700 dark:text-slate-200",children:"Cross-Compensation Calc"}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 text-xs",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"H Mean (Power/Var)"}),c.jsx("input",{type:"number",step:"any",value:n,onChange:x=>a(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"V Mean (Power/Var)"}),c.jsx("input",{type:"number",step:"any",value:i,onChange:x=>o(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"H RMS 0 (Sigma)"}),c.jsx("input",{type:"number",step:"any",value:s,onChange:x=>l(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"V RMS 0 (Sigma)"}),c.jsx("input",{type:"number",step:"any",value:u,onChange:x=>d(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsx("button",{onClick:p,className:"mt-2 w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded shadow transition-colors active:scale-95",children:"Calculate Sigma"}),f!==null&&c.jsxs("div",{className:"mt-2 p-3 bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800 rounded text-center animate-in fade-in slide-in-from-top-1",children:[c.jsx("span",{className:"block text-[10px] uppercase font-bold text-gray-500 dark:text-slate-400 mb-1",children:"Original White Noise Sigma"}),c.jsx("span",{className:"text-lg font-mono font-bold text-indigo-700 dark:text-indigo-300 select-all",children:f.toFixed(5)})]})]})]}):null},Vb=[[.1725,.0838,.0576],[.5481,.2985,.217],[.1103,.1968,.3359],[.1038,.1502,.0521],[.2244,.2177,.4302],[.1232,.519,.4044],[.7168,.199,.0271],[.065,.1063,.3924],[.5417,.0884,.1203],[.1042,.0438,.1396],[.3547,.5078,.0482],[.7805,.3541,.0215],[.0234,.0492,.2916],[.0653,.3019,.0645],[.4294,.0319,.0402],[.8568,.5754,.0079],[.5032,.0889,.3055],[0,.249,.383],[.9163,.9155,.8705],[.5819,.5911,.5839],[.3552,.361,.359],[.1876,.1924,.1917],[.0871,.0901,.0908],[.0321,.0319,.0326]],ise=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]];function ose(e,t,r,n,a,i,o=.5){const u=[],d=Math.max(.1,Math.min(.9,o)),f=Math.hypot(t.x-e.x,t.y-e.y),h=Math.hypot(n.x-r.x,n.y-r.y),p=Math.hypot(r.x-e.x,r.y-e.y),x=Math.hypot(n.x-t.x,n.y-t.y),g=(f+h)/2/5,b=(p+x)/2/3,y=g*d,m=b*d;for(let k=0;k<4;k++)for(let S=0;S<6;S++){const w=S/5,v=k/3,M=(1-w)*(1-v)*e.x+w*(1-v)*t.x+(1-w)*v*r.x+w*v*n.x,N=(1-w)*(1-v)*e.y+w*(1-v)*t.y+(1-w)*v*r.y+w*v*n.y;u.push({x:M-y/2,y:N-m/2,w:y,h:m})}return u}function aO(e){e.length;const t=e[0].length;return Array(t).fill(0).map((r,n)=>e.map(a=>a[n]))}function Oh(e,t){const r=e.length,n=e[0].length,a=t.length,i=t[0].length;if(n!==a)throw new Error("Matrix dimensions mismatch");const o=Array(r).fill(0).map(()=>Array(i).fill(0));for(let s=0;s<r;s++)for(let l=0;l<i;l++)for(let u=0;u<n;u++)o[s][l]+=e[s][u]*t[u][l];return o}function sse(e,t){const r=aO(e),n=Oh(r,e);for(let u=0;u<3;u++)n[u][u]+=1e-9;const a=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],i=Lo(a);if(!i)throw new Error("Singular Matrix (Check Input Data)");const o=[[i[0][0],i[0][1],i[0][2]],[i[1][0],i[1][1],i[1][2]],[i[2][0],i[2][1],i[2][2]]],s=Oh(r,t);return Oh(o,s)}function lse(e){const t=e.length,r=e.map((n,a)=>[...n,...Array(t).fill(0).map((i,o)=>a===o?1:0)]);for(let n=0;n<t;n++){let a=n;for(let s=n+1;s<t;s++)Math.abs(r[s][n])>Math.abs(r[a][n])&&(a=s);const i=r[n];r[n]=r[a],r[a]=i;const o=r[n][n];if(Math.abs(o)<1e-12)throw new Error("Singular Matrix");for(let s=n;s<2*t;s++)r[n][s]/=o;for(let s=0;s<t;s++)if(s!==n){const l=r[s][n];for(let u=n;u<2*t;u++)r[s][u]-=l*r[n][u]}}return r.map(n=>n.slice(t))}function cse(e,t,r){const n=[...e].sort((g,b)=>g.id-b.id);if(n.length!==24)throw new Error("Requires exactly 24 patches");const a=[];n.forEach(g=>{const b=g.rawMeans,y=[b[0]-t[0],b[1]-t[1],b[2]-t[2],b[3]-t[3]];let m,k,S;r?(S=y[0],k=(y[1]+y[2])/2,m=y[3]):(m=y[0],k=(y[1]+y[2])/2,S=y[3]),m=Math.max(0,m),k=Math.max(0,k),S=Math.max(0,S),a.push([m,k,S])});const o=a[18],s=(o[0]+o[1]+o[2])/3,l=1/Math.max(1e-9,s),u=a.map(g=>[g[0]*l,g[1]*l,g[2]*l]),f=sse(u,Vb),h=aO(f);let p;try{p=lse(h)}catch{throw new Error("CCM Inversion Failed. Input data might be too dark or clipped.")}return{matrix:Oh(p,ise)}}const use=({isOpen:e,onClose:t,patchStats:r,initialIsBGGR:n,zIndex:a=200,sizeRatio:i,onSizeChange:o})=>{const[s,l]=j.useState(n),[u,d]=j.useState(["0","0","0","0"]),[f,h]=j.useState(null),[p,x]=j.useState(null);if(j.useEffect(()=>{if(e&&r&&r.length===24){const v=r[23].rawMeans;u[0]==="0"&&u[1]==="0"&&d([v[0].toFixed(2),v[1].toFixed(2),v[2].toFixed(2),v[3].toFixed(2)])}},[e,r]),j.useEffect(()=>{if(!e||!r||r.length!==24)return;const w=u.map(v=>parseFloat(v));if(!w.some(isNaN))try{const v=cse(r,w,s);h(v),x(null)}catch(v){x(v.message)}},[e,r,s,u]),!e)return null;const g=(w,v)=>{d(M=>{const N=[...M];return N[w]=v,N})},b=w=>{navigator.clipboard.writeText(w)},y=w=>w?w.map(v=>v.map(M=>M.toFixed(4))):[],m=f?y(f.matrix).flat().join(" "):"",k=s?["B","G1","G2","R"]:["R","G1","G2","B"],S=s?["text-blue-500","text-green-500","text-green-500","text-red-500"]:["text-red-500","text-green-500","text-green-500","text-blue-500"];return c.jsxs(qs,{initialPosition:{x:window.innerWidth/2-200,y:100},onClose:t,zIndex:a,className:"w-[500px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl rounded-xl overflow-hidden",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-gray-800 dark:text-slate-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"Color Lab Result"]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-5 flex flex-col gap-5",children:[c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"flex justify-between items-center mb-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Patch Sampling Size"}),c.jsxs("span",{className:"text-xs font-mono font-bold text-cyan-600 dark:text-cyan-400",children:[Math.round(i*100),"%"]})]}),c.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i,onChange:w=>o(parseFloat(w.target.value)),className:"w-full h-1.5 bg-gray-300 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),c.jsx("div",{className:"flex justify-center",children:c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>l(!1),className:`px-4 py-1.5 text-xs font-bold rounded transition-all ${s?"text-gray-500 dark:text-slate-400 hover:text-gray-700":"bg-white dark:bg-slate-600 text-indigo-600 dark:text-indigo-300 shadow-sm"}`,children:"RGGB Mode"}),c.jsx("button",{onClick:()=>l(!0),className:`px-4 py-1.5 text-xs font-bold rounded transition-all ${s?"bg-white dark:bg-slate-600 text-indigo-600 dark:text-indigo-300 shadow-sm":"text-gray-500 dark:text-slate-400 hover:text-gray-700"}`,children:"BGGR Mode"})]})}),c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-3 rounded-lg border border-gray-100 dark:border-slate-700",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase mb-2",children:"Input Black Levels ()"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:[0,1,2,3].map(w=>c.jsxs("div",{className:"flex flex-col",children:[c.jsx("label",{className:`text-[10px] font-bold mb-1 ${S[w]}`,children:k[w]}),c.jsx("input",{type:"number",step:"0.01",value:u[w],onChange:v=>g(w,v.target.value),className:"w-full px-2 py-1 text-sm font-mono border border-gray-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-yellow-500"})]},w))})]}),p?c.jsx("div",{className:"text-red-500 text-sm text-center bg-red-50 dark:bg-red-900/20 p-2 rounded",children:p}):f?c.jsx(c.Fragment,{children:c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-3 rounded-lg border border-gray-100 dark:border-slate-700",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase mb-2",children:"Calculated Color Matrix (XYZ  Camera RGB)"}),c.jsx("div",{className:"font-mono text-xs text-gray-700 dark:text-slate-300 grid grid-rows-3 gap-1 mb-3",children:y(f.matrix).map((w,v)=>c.jsxs("div",{className:"flex justify-between bg-white dark:bg-slate-900 px-2 py-1 rounded",children:[c.jsx("span",{className:"text-red-500/80 w-1/3 text-right",children:w[0]}),c.jsx("span",{className:"text-green-500/80 w-1/3 text-right",children:w[1]}),c.jsx("span",{className:"text-blue-500/80 w-1/3 text-right",children:w[2]})]},v))}),c.jsx("button",{onClick:()=>b(m),className:"w-full py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded shadow transition-transform active:scale-95 flex items-center justify-center gap-2",children:"Copy Matrix String (for customMatrix)"})]})}):c.jsx("div",{className:"text-gray-400 text-sm text-center",children:"Calculating..."})]})]})};function hw(e,t){const r=e.length;let n=0,a=0,i=0,o=0;for(let l=0;l<r;l++)n+=e[l],a+=t[l],i+=e[l]*t[l],o+=e[l]*e[l];const s=r*o-n*n;return s===0?{slope:0,intercept:0}:{slope:(r*i-n*a)/s,intercept:(a*o-n*i)/s}}function dse(e,t){const r=e.length,n=new Array(r).fill(0),a=2*t;for(let i=0;i<r;i++){const o=i>0?e[i-1]:e[0],s=i<r-1?e[i+1]:e[r-1];n[i]=(s-o)/a}return n}function fse(e){const t=new Array(e.length).fill(0);t[0]=e[0];for(let r=1;r<e.length;r++){let n=e[r]-e[r-1];n>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),t[r]=t[r-1]+n}return t}function hse(e){const t=e.length,r=new Array(t).fill(0).map((i,o)=>o),{slope:n,intercept:a}=hw(r,e);return e.map((i,o)=>i-(n*o+a))}function pse(e,t,r="RGGB"){const n=r.toUpperCase(),a=t%2,i=e%2;return n==="RGGB"||n==="BGGR"?(a+i)%2!==0:n==="GBRG"||n==="GRBG"?(a+i)%2===0:(a+i)%2!==0}function Hb(e,t,r,n,a){const i=Math.floor(n.x),o=Math.floor(n.y),s=Math.floor(n.w),l=Math.floor(n.h);if(s<8||l<8)return null;let u=[];for(let J=0;J<l;J++){const ne=[],ce=(o+J)*t;for(let ie=0;ie<s;ie++)ne.push(e[ce+i+ie]);u.push(ne)}let d=0,f=0;for(let J=1;J<l-1;J+=2)for(let ne=1;ne<s-1;ne+=2)d+=Math.abs(u[J][ne+1]-u[J][ne-1]),f+=Math.abs(u[J+1][ne]-u[J-1][ne]);let h=s,p=l,x=u,g=2,b=!1;if(f>d){g=1,b=!0,x=Array(s).fill(0).map(()=>Array(l).fill(0));for(let J=0;J<l;J++)for(let ne=0;ne<s;ne++)x[ne][l-1-J]=u[J][ne];h=l,p=s}else g=2;const y=[],m=[];for(let J=0;J<p;J++){const ne=x[J],ce=ne.map((oe,ke)=>ke===0?0:Math.abs(oe-ne[ke-1])),ie=Math.max(...ce),se=ce.indexOf(ie);if(ie>1){const oe=Math.max(0,se-3),ke=Math.min(h,se+4);let le=0,fe=0;for(let Pe=oe;Pe<ke;Pe++)le+=ce[Pe],fe+=Pe*ce[Pe];le>0&&(y.push(fe/le),m.push(J))}}if(y.length<p*.4)return null;const{slope:k,intercept:S}=hw(m,y),w=Math.cos(Math.atan(k)),v=[],M=[],N=(a==null?void 0:a.greenOnly)??!1,_=(a==null?void 0:a.globalX)??0,P=(a==null?void 0:a.globalY)??0,E=(a==null?void 0:a.bayerPattern)||"RGGB";for(let J=0;J<p;J++){const ne=k*J+S;for(let ce=0;ce<h;ce++){if(N){let ie,se;if(b){const oe=l-1-ce,ke=J;ie=_+i+ke,se=P+o+oe}else ie=_+i+ce,se=P+o+J;if(!pse(ie,se,E))continue}v.push((ce-ne)*w),M.push(x[J][ce])}}const T=Math.min(s,l)/2;let G=0;for(const J of v)Math.abs(J)<=T&&G++;let L=.125;if(a!=null&&a.manualBinSize&&a.manualBinSize>0)L=Math.max(.01,Math.min(.5,a.manualBinSize));else if(G>0){const J=40*T/G;L=Math.max(.01,Math.min(.125,J))}const C=L,$=Array.from(v.keys()).sort((J,ne)=>v[J]-v[ne]),A=$.map(J=>v[J]),O=$.map(J=>M[J]);if(A.length===0)return null;const F=A[0],D=A[A.length-1],W=Math.floor((D-F)/C),H=new Array(W).fill(0),Y=new Array(W).fill(0);for(let J=0;J<A.length;J++){const ne=Math.floor((A[J]-F)/C);ne>=0&&ne<W&&(H[ne]+=O[J],Y[ne]++)}let te=O[0];for(let J=0;J<W;J++)Y[J]>0?(H[J]/=Y[J],te=H[J]):H[J]=te;const U=H.slice(0,10).reduce((J,ne)=>J+ne,0)/10,Se=H.slice(-10).reduce((J,ne)=>J+ne,0)/10;if(U>Se){const J=Math.max(...H),ne=Math.min(...H);for(let ce=0;ce<H.length;ce++)H[ce]=J-H[ce]+ne}const re=dse(H,C);return{esf:H,lsfFull:re,binSize:C,orientation:g}}function iO(e,t,r,n=!1,a=0,i=!1){if(e.length===0)return null;const o=4096,s=new Il(o),l=r?1e3/r:1,u=new Float32Array(501);for(let m=0;m<=500;m++)u[m]=m/500*l*2;const d=new Float32Array(501).fill(0);let f=0,h=[],p=[],x=0,g=[];for(const m of e){let k=[...m.lsfFull];const S=m.binSize;let w=0,v=-1/0;for(let Y=0;Y<k.length;Y++)k[Y]>v&&(v=k[Y],w=Y);const M=v*.2;let N=0,_=k.length-1;for(let Y=w;Y>=0;Y--)if(k[Y]<M){N=Y;break}for(let Y=w;Y<k.length;Y++)if(k[Y]<M){_=Y;break}const P=_-N;let E=!1;if(n&&P>0){const Y=P*4,te=[],U=[];if(a>0){const Se=Math.max(0,w-Y-a),re=Math.max(0,w-Y);for(let ce=Se;ce<re;ce++)te.push(ce),U.push(k[ce]);const J=Math.min(k.length,w+Y),ne=Math.min(k.length,w+Y+a);for(let ce=J;ce<ne;ce++)te.push(ce),U.push(k[ce])}else{for(let Se=0;Se<Math.max(0,w-Y);Se++)te.push(Se),U.push(k[Se]);for(let Se=Math.min(k.length,w+Y);Se<k.length;Se++)te.push(Se),U.push(k[Se])}if(te.length>2){const{slope:Se,intercept:re}=hw(te,U);for(let J=0;J<k.length;J++)k[J]=k[J]-(Se*J+re);v=-1/0;for(let J=0;J<k.length;J++)k[J]>v&&(v=k[J],w=J);E=!0}}let R=0,T=0;if(t>0)T=t,R=Math.round(t/S);else{const Y=v*.2;let te=0,U=k.length-1;for(let ne=w;ne>=0;ne--)if(k[ne]<Y){te=ne;break}for(let ne=w;ne<k.length;ne++)if(k[ne]<Y){U=ne;break}const re=(U-te)*S;let J=Math.max(2,re*8);T=J,R=Math.round(J/S)}x+=T;const G=Math.max(0,w-R),L=Math.min(k.length,w+R),C=k.slice(G,L);if(C.length<8)continue;const $=new Float32Array(o).fill(0);let A=-1/0,O=0;for(let Y=0;Y<C.length;Y++)C[Y]>A&&(A=C[Y],O=Y);for(let Y=0;Y<C.length;Y++){let te=1;i&&(te=.5*(1-Math.cos(2*Math.PI*Y/(C.length-1))));const U=C[Y]*te,Se=(Y-O+o)%o;$[Se]=U}s.transform($);const F=[],D=[],W=[];for(let Y=0;Y<=o/2;Y++){const te=s._real[Y],U=s._imag[Y],Se=Math.sqrt(te*te+U*U);F.push(Se),D.push(Y/(o*S)*l),W.push(Math.atan2(U,te))}const H=F[0];if(H>0){for(let Y=0;Y<=500;Y++){const te=u[Y];d[Y]+=u4(te,D,F)/H}if(f++,h.length===0){h=C,p=E?mse(k):m.esf;const Y=fse(W),te=hse(Y);for(let U=0;U<=500;U++){const Se=u[U];g.push(u4(Se,D,te))}}}}if(f===0)return null;const b=Array.from(d).map(m=>m/f);let y=null;for(let m=0;m<b.length-1;m++)if(b[m]>=.5&&b[m+1]<.5){y=u[m]+(.5-b[m])*(u[m+1]-u[m])/(b[m+1]-b[m]);break}return{esf:p,lsf:[],lsfCropped:h,mtf:b,ptf:g,freqs:Array.from(u),mtf50:y,calcRadius:x/f}}function mse(e){const t=new Array(e.length).fill(0);let r=0;for(let n=0;n<e.length;n++)r+=e[n],t[n]=r;return t}function u4(e,t,r){if(e<=t[0])return r[0];if(e>=t[t.length-1])return r[r.length-1];let n=0;for(;e>t[n+1];)n++;const a=(e-t[n])/(t[n+1]-t[n]);return r[n]+a*(r[n+1]-r[n])}const ns=({locked:e,onToggle:t,title:r})=>c.jsx("span",{className:"inline-flex items-center justify-center p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors cursor-pointer select-none",title:r??(e?"Locked (Auto Fit will NOT change)":"Unlocked (Auto Fit may change)"),onMouseDown:n=>{n.stopPropagation()},onClick:n=>{n.stopPropagation(),t()},children:c.jsx("span",{className:`w-4 h-4 rounded-full border-2 transition-all active:scale-90 flex items-center justify-center ${e?"border-indigo-600 bg-indigo-600":"border-gray-400 dark:border-slate-500 bg-transparent hover:border-gray-500"}`,children:e&&c.jsx("span",{className:"w-2 h-2 rounded-full bg-white"})})}),gse=({isOpen:e,onClose:t,rawImageData:r,roi:n,zIndex:a=110,onFocus:i,displaySettings:o,isSfrLabOpen:s})=>{const[l,u]=j.useState([]),[d,f]=j.useState(""),[h,p]=j.useState(""),[x,g]=j.useState(12),[b,y]=j.useState(!0),[m,k]=j.useState(!0),[S,w]=j.useState(!0),[v,M]=j.useState(!1),[N,_]=j.useState(!1),[P,E]=j.useState(!1),[R,T]=j.useState(!1),[G,L]=j.useState("50"),[C,$]=j.useState(!1),[A,O]=j.useState("0.125"),[F,D]=j.useState(!1),[W,H]=j.useState({aperture:4,olpfSeparationPx:.7,fillFactor:.9,coreSigmaPx:.15,haloSigmaPx:.8,haloWeight:.25,wavelengthUm:.55,rolloff:1}),[Y,te]=j.useState({aperture:!1,olpfSeparationPx:!1,fillFactor:!1,coreSigmaPx:!1,haloSigmaPx:!1,haloWeight:!1,wavelengthUm:!1,rolloff:!1}),[U,Se]=j.useState("0"),[re,J]=j.useState(""),[ne,ce]=j.useState(!1),[ie,se]=j.useState(""),[oe,ke]=j.useState(1),[le,fe]=j.useState(null),[Pe,Fe]=j.useState({x:100,y:50}),[Ue,K]=j.useState({w:1e3,h:800}),[_e,Te]=j.useState(!1),[Le,ft]=j.useState(!1),Xe=j.useRef({x:0,y:0}),Ie=j.useRef({w:0,h:0}),[ht,xt]=j.useState(!1),[nt,Gt]=j.useState(!1),yt=l.length>0?l[l.length-1].binSize:null,et=yt?(1/yt).toFixed(1):"-",He=j.useMemo(()=>n?Math.max(n.w,n.h):100,[n]),jt=(o==null?void 0:o.renderMode)==="advanced-zero-dep",or=j.useMemo(()=>{const B=parseFloat(d);return Number.isFinite(B)&&B>0?B:null},[d]),zt=or!==null,ut=zt?"lp/mm":"cy/px",It=(B,ge,ye)=>Math.min(ye,Math.max(ge,B)),Lt=B=>{if(Math.abs(B)<1e-12)return 1;const ge=Math.PI*B;return Math.sin(ge)/ge},Me=B=>B<=0?1:B>=1?0:2/Math.PI*(Math.acos(B)-B*Math.sqrt(1-B*B)),Z=(B,ge,ye,vt)=>{const We=It(vt,0,1),st=Math.max(0,ge),Be=Math.max(0,ye),tr=Math.exp(-2*Math.PI*Math.PI*st*st*B*B),br=Math.exp(-2*Math.PI*Math.PI*Be*Be*B*B);return(1-We)*tr+We*br},xe=j.useMemo(()=>zt&&or?1e3/or:1,[zt,or]),ue=(B,ge)=>{const{aperture:ye,olpfSeparationPx:vt,fillFactor:We,coreSigmaPx:st,haloSigmaPx:Be,haloWeight:tr,wavelengthUm:br,rolloff:Pr}=ge,Xt=zt?B/xe:B,Hr=Math.max(1e-9,br)/1e3,Br=zt&&or?or/1e3:5/1e3,Ur=Math.max(1e-6,ye),sr=1/(Hr*Ur)*Br,hr=sr>0?Xt/sr:1e9,Ze=Me(hr),rr=Math.max(0,vt),Rr=Math.abs(Math.cos(Math.PI*Xt*rr)),hn=It(We,0,1),ra=Math.abs(Lt(Xt*hn)),Sn=Math.max(0,st),Na=Math.max(0,Be),ae=Z(Xt,Sn,Na,tr);let me=Ze*Rr*ra*ae;const je=Math.max(.1,Pr);return me=Math.pow(Math.max(0,me),je),Math.min(1.2,Math.max(0,me))},De=()=>{if(!(!r||!n)){if(!jt){alert("Scalar Unmixing is required. Please configure Background/Foreground/BlackLevel in the Sidebar and click 'RUN UNMIXING' first.");return}try{let B=null;const ge=C?parseFloat(A):void 0;if(o!=null&&o.advancedZeroDep){const ye=i2(r,n,o);B=Hb(ye.data,ye.width,ye.height,{x:0,y:0,w:ye.width,h:ye.height},{greenOnly:S,globalX:n.x,globalY:n.y,bayerPattern:r.bayerPattern,manualBinSize:ge})}else B=Hb(r.data,r.width,r.height,n,{greenOnly:S,globalX:n.x,globalY:n.y,bayerPattern:r.bayerPattern,manualBinSize:ge});B?u(ye=>[...ye,B]):alert("Could not detect valid edge.")}catch(B){console.error(B),alert("Error processing ROI")}}},qe=()=>{u([]),fe(null),ke(1)},pt=()=>{if(!le)return;const B=parseFloat(d),vt=`data:text/csv;charset=utf-8,Frequency (${!isNaN(B)&&B>0?"lp/mm":"cy/px"}),MTF,Phase(Rad)
`+le.freqs.map((Be,tr)=>{const br=le.ptf?le.ptf[tr]:0;return`${Be.toFixed(6)},${le.mtf[tr].toFixed(6)},${br?br.toFixed(6):0}`}).join(`
`),We=encodeURI(vt),st=document.createElement("a");st.setAttribute("href",We),st.setAttribute("download",`sfr_data_${Date.now()}.csv`),document.body.appendChild(st),st.click(),document.body.removeChild(st)},de=()=>{if(!(le!=null&&le.mtf50)||!n)return;const B=n.x+n.w/2,ge=n.y+n.h/2,ye=`{${B.toFixed(1)},${ge.toFixed(1)},${le.mtf50.toFixed(4)}}`;navigator.clipboard.writeText(ye)};j.useEffect(()=>{if(l.length===0){fe(null);return}const B=parseFloat(d),ge=!isNaN(B)&&B>0?B:null,ye=b?-1:x,vt=R&&parseFloat(G)||0,We=iO(l,ye,ge,m,vt,v);fe(We)},[l,x,b,m,d,R,G,v]),j.useEffect(()=>{e&&jt&&l.length===0&&n&&r&&De()},[e]);const Ce=B=>{i&&i(),!nt&&(B.target.closest("button")||B.target.closest("input")||B.target.closest("select")||B.target.closest("label")||(Te(!0),Xe.current={x:B.clientX-Pe.x,y:B.clientY-Pe.y}))},dt=B=>{nt||(B.stopPropagation(),B.preventDefault(),ft(!0),Xe.current={x:B.clientX,y:B.clientY},Ie.current={w:Ue.w,h:Ue.h})};j.useEffect(()=>{const B=ye=>{if(_e)Fe({x:ye.clientX-Xe.current.x,y:ye.clientY-Xe.current.y});else if(Le){const vt=ye.clientX-Xe.current.x,We=ye.clientX-Xe.current.y;K({w:Math.max(600,Ie.current.w+vt),h:Math.max(500,Ie.current.h+We)})}},ge=()=>{Te(!1),ft(!1)};return(_e||Le)&&(window.addEventListener("mousemove",B),window.addEventListener("mouseup",ge)),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",ge)}},[_e,Le]);const Wt=j.useMemo(()=>{if(!(le!=null&&le.mtf50)||!h)return null;const B=parseFloat(h);if(isNaN(B)||B<=0)return null;let ge=le.mtf50;const ye=parseFloat(d);return!isNaN(ye)&&ye>0&&(ge=le.mtf50*(ye/1e3)),ge*2*B},[le,h,d]),Rt=N?2:1,kt=Rt*xe,qt=.004,xr=j.useMemo(()=>{if(!F)return[];const B=[];for(let ge=0;ge<=Rt+1e-12;ge+=qt){const ye=ge*xe;B.push({freq:ye,modelMtf:ue(ye,W)})}return B},[F,W,Rt,xe]),Ir=j.useMemo(()=>{const B=le?le.mtf.map((ye,vt)=>({freq:le.freqs[vt],mtf:ye})).filter(ye=>ye.freq<=kt):[];if(!F||xr.length===0)return B.map(ye=>({freq:ye.freq,mtf:ye.mtf,modelMtf:null}));const ge=new Map;for(const ye of xr){const vt=ye.freq.toFixed(6);ge.set(vt,{freq:ye.freq,mtf:null,modelMtf:ye.modelMtf})}for(const ye of B){const vt=ye.freq.toFixed(6),We=ge.get(vt);We?We.mtf=ye.mtf:ge.set(vt,{freq:ye.freq,mtf:ye.mtf,modelMtf:null})}return Array.from(ge.values()).sort((ye,vt)=>ye.freq-vt.freq)},[le,kt,F,xr]),fr=le?le.lsfCropped.map((B,ge)=>({x:ge,y:B})):[],be=le?le.esf.map((B,ge)=>({x:ge,y:B})):[],tt=j.useMemo(()=>le!=null&&le.ptf?le.ptf.map((B,ge)=>({freq:le.freqs[ge],ptf:B})).filter(B=>B.freq<=kt):[],[le,kt]);if(!e)return null;const it={aperture:[.7,64],olpfSeparationPx:[0,5],fillFactor:[.05,1],coreSigmaPx:[0,3],haloSigmaPx:[0,50],haloWeight:[0,1],wavelengthUm:[.4,.7],rolloff:[.2,6]},Zt={aperture:.2,olpfSeparationPx:.05,fillFactor:.03,coreSigmaPx:.03,haloSigmaPx:.2,haloWeight:.05,wavelengthUm:.01,rolloff:.1},Vt=()=>{let B=0,ge=0;for(;B===0;)B=Math.random();for(;ge===0;)ge=Math.random();return Math.sqrt(-2*Math.log(B))*Math.cos(2*Math.PI*ge)},ot=()=>["aperture","olpfSeparationPx","fillFactor","coreSigmaPx","haloSigmaPx","haloWeight","wavelengthUm","rolloff"].filter(ge=>!Y[ge]),ir=(B,ge)=>ge.map(ye=>B[ye]),yr=(B,ge,ye,vt)=>{const We={...ge};for(let tr=0;tr<ye.length;tr++){const br=ye[tr],[Pr,Xt]=it[br];We[br]=It(B[tr],Pr,Xt)}Object.keys(vt).forEach(tr=>{vt[tr]&&(We[tr]=ge[tr])});const st=vt.coreSigmaPx,Be=vt.haloSigmaPx;return Be&&!st?We.coreSigmaPx=Math.min(We.coreSigmaPx,ge.haloSigmaPx):st&&!Be?We.haloSigmaPx=Math.max(We.haloSigmaPx,ge.coreSigmaPx):!st&&!Be&&(We.haloSigmaPx=Math.max(We.haloSigmaPx,We.coreSigmaPx)),We},Ht=(B,ge)=>{const ye=[...B];for(let vt=0;vt<ge.length;vt++){const We=ge[vt],st=Zt[We],Be=We==="aperture"?.1:We==="wavelengthUm"?.02:.2;ye[vt]=ye[vt]+Be*st*Vt()}return ye},Dt=(B,ge,ye,vt)=>{const We=B.map(st=>1/(1+.5*st*st));return st=>{const Be=yr(st,ye,vt,Y);let tr=0;for(let Xt=0;Xt<B.length;Xt++){const Hr=ge[Xt],Ur=ue(B[Xt],Be)-Hr;tr+=We[Xt]*Ur*Ur}const Pr=1e-4*((Y.olpfSeparationPx?0:Be.olpfSeparationPx*Be.olpfSeparationPx)+(Y.coreSigmaPx?0:Be.coreSigmaPx*Be.coreSigmaPx)+(Y.haloSigmaPx?0:Be.haloSigmaPx*Be.haloSigmaPx)+(Y.rolloff?0:(Be.rolloff-1)*(Be.rolloff-1)));return tr+Pr}},Ee=(B,ge,ye,vt=320)=>{const We=ge.length,st=new Array(We+1);st[0]=[...ge];for(let ur=0;ur<We;ur++){const sr=[...ge];sr[ur]=sr[ur]+ye[ur],st[ur+1]=sr}const Be=st.map(ur=>B(ur)),tr=()=>{const ur=Be.map((Ze,rr)=>[Ze,rr]).sort((Ze,rr)=>Ze[0]-rr[0]).map(Ze=>Ze[1]),sr=ur.map(Ze=>st[Ze]),hr=ur.map(Ze=>Be[Ze]);for(let Ze=0;Ze<st.length;Ze++)st[Ze]=sr[Ze];for(let Ze=0;Ze<Be.length;Ze++)Be[Ze]=hr[Ze]},br=()=>{const ur=new Array(We).fill(0);for(let sr=0;sr<We;sr++){const hr=st[sr];for(let Ze=0;Ze<We;Ze++)ur[Ze]+=hr[Ze]}for(let sr=0;sr<We;sr++)ur[sr]/=We;return ur},Pr=(ur,sr,hr=1)=>ur.map((Ze,rr)=>Ze+hr*sr[rr]),Xt=(ur,sr)=>ur.map((hr,Ze)=>hr-sr[Ze]),Hr=1,Br=2,Ur=.5;for(let ur=0;ur<vt;ur++){tr();const sr=st[0],hr=st[We],Ze=br(),rr=Pr(Ze,Xt(Ze,hr),Hr),Rr=B(rr);if(Rr<Be[0]){const Sn=Pr(Ze,Xt(rr,Ze),Br),Na=B(Sn);Na<Rr?(st[We]=Sn,Be[We]=Na):(st[We]=rr,Be[We]=Rr);continue}if(Rr<Be[We-1]){st[We]=rr,Be[We]=Rr;continue}const hn=Pr(Ze,Xt(hr,Ze),-.5),ra=B(hn);if(ra<Be[We]){st[We]=hn,Be[We]=ra;continue}for(let Sn=1;Sn<We+1;Sn++)st[Sn]=Pr(sr,Xt(st[Sn],sr),Ur),Be[Sn]=B(st[Sn])}return tr(),{x:st[0],fx:Be[0]}},er=async()=>{if(!(le!=null&&le.freqs)||!(le!=null&&le.mtf)||le.freqs.length<10){se("No enough MTF data to fit.");return}const B=ot();if(B.length===0){se("All parameters are locked.");return}const ge=Math.max(0,parseFloat(U||"0")||0),ye=kt,vt=(()=>{const Ze=parseFloat(re||"");return Number.isFinite(Ze)&&Ze>0?Ze:ye})(),We=[];for(let Ze=0;Ze<le.freqs.length;Ze++){const rr=le.freqs[Ze],Rr=le.mtf[Ze];rr>=ge&&rr<=vt&&Number.isFinite(Rr)&&We.push([rr,Rr])}if(We.length<10){se("Fit range too narrow (need >= 10 points).");return}const Be=Math.max(1,Math.floor(We.length/300)),tr=We.filter((Ze,rr)=>rr%Be===0).map(Ze=>Ze[0]),br=We.filter((Ze,rr)=>rr%Be===0).map(Ze=>Ze[1]);ce(!0),se(`Fitting ${B.length} params (${tr.length} pts) in [${ge.toFixed(3)}, ${vt.toFixed(3)}] ${ut} ...`);const Pr=W,Xt=ir(Pr,B),Hr=B.map(Ze=>Zt[Ze]),Br=Dt(tr,br,Pr,B),Ur=7;let ur=Xt,sr=Br(Xt);for(let Ze=0;Ze<Ur;Ze++){const rr=Ze===0?Xt:Ht(Xt,B),Rr=Ee(Br,rr,Hr,320);Rr.fx<sr&&(sr=Rr.fx,ur=Rr.x),await new Promise(requestAnimationFrame)}const hr=yr(ur,Pr,B,Y);H(hr),se(`Fit done. SSE=${sr.toExponential(3)}  unlocked=${B.length}  range=[${ge.toFixed(3)}, ${vt.toFixed(3)}] ${ut}`),ce(!1)};return c.jsxs("div",{className:`fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl overflow-hidden ${nt?"rounded-none":"rounded-xl"}`,style:nt?{inset:0,width:"100vw",height:"100vh",zIndex:a??100}:{left:Pe.x,top:Pe.y,width:Ue.w,height:ht?"auto":Ue.h,zIndex:a??100},onMouseDownCapture:i,children:[c.jsxs("div",{className:`flex justify-between items-center px-4 py-2 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 select-none ${!nt&&_e?"cursor-grabbing":nt?"":"cursor-grab"}`,onMouseDown:Ce,onDoubleClick:()=>Gt(!nt),children:[c.jsxs("h3",{className:"text-sm font-bold text-orange-600 dark:text-orange-400 flex items-center gap-2 pointer-events-none",children:["SFR Expert (Adaptive Edge Method)",c.jsxs("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:[l.length," ROI",l.length!==1?"s":""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>Gt(!nt),className:"text-gray-400 hover:text-orange-500 transition-colors",title:nt?"Restore":"Maximize",children:nt?c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 14h6v6M20 10h-6V4"})}):c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M20 8V4m0 0h-4M4 16v4m0 0h4M20 16v4m0 0h-4"})})}),c.jsx("button",{onClick:()=>xt(!ht),className:"text-gray-400 hover:text-orange-500 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]})]}),!ht&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"p-3 bg-gray-50/50 dark:bg-slate-800/30 border-b border-gray-200 dark:border-slate-700 flex items-center gap-4 flex-wrap text-xs flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:"Pixel Pitch (m):"}),c.jsx("input",{type:"number",value:d,onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>f(B.target.value),placeholder:"Default (cy/px)",className:"w-20 px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-orange-500"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:"Image Height:"}),c.jsx("input",{type:"number",value:h,onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>p(B.target.value),placeholder:"px",className:"w-16 px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-orange-500"})]}),c.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded border border-blue-100 dark:border-blue-800",children:[c.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"Bin:"}),yt?c.jsxs("span",{className:"font-mono text-gray-700 dark:text-gray-300",children:[yt.toFixed(3),"px",c.jsxs("span",{className:"text-[10px] ml-1 text-gray-500",children:["(",et,"x)"]})]}):c.jsx("span",{className:"text-gray-400 italic",children:"..."}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none ml-2 border-l border-blue-200 dark:border-blue-700 pl-2",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:C,onChange:B=>{B.stopPropagation(),$(B.target.checked)},className:"w-3 h-3 text-blue-600 rounded focus:ring-blue-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-blue-600 dark:text-blue-400",children:"Manual"})]}),C&&c.jsx("input",{type:"number",value:A,onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>O(B.target.value),step:"0.001",min:"0.01",max:"0.5",className:"w-16 px-1 py-0.5 text-xs bg-white dark:bg-slate-900 border border-blue-300 dark:border-blue-600 rounded outline-none focus:border-orange-500",placeholder:"0.125"})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-[500px] border-l border-gray-300 dark:border-slate-600 pl-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",title:"Linear detrending with limited fitting width",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:m,onChange:B=>{B.stopPropagation(),k(B.target.checked)},className:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-purple-600 dark:text-purple-400",children:"Deshading"})]}),m&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none border-l border-purple-200 dark:border-purple-800 pl-2",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:R,onChange:B=>{B.stopPropagation(),T(B.target.checked)},className:"w-3 h-3 text-purple-600 rounded focus:ring-purple-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-purple-600 dark:text-purple-400",children:"Limit Fit"})]}),R&&c.jsxs("div",{className:"flex items-center gap-1",title:"Width of data used for fitting (pixels)",children:[c.jsx("input",{type:"number",value:G,onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>L(B.target.value),step:"5",min:"10",max:"500",className:"w-14 px-1 py-0.5 text-xs bg-white dark:bg-slate-900 border border-purple-300 dark:border-purple-600 rounded outline-none focus:border-orange-500"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]})]})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:S,onChange:B=>{B.stopPropagation(),w(B.target.checked)},className:"w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:"G-Only"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),title:"Apply Hann windowing before FFT",children:[c.jsx("input",{type:"checkbox",checked:v,onChange:B=>{B.stopPropagation(),M(B.target.checked)},className:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400",children:"Hann On"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:N,onChange:B=>{B.stopPropagation(),_(B.target.checked)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"2 Freq"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:P,onChange:B=>{B.stopPropagation(),E(B.target.checked)},className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:"Show PTF"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:b,onChange:B=>{B.stopPropagation();const ge=B.target.checked;y(ge),ge||g(He)},className:"w-4 h-4 text-orange-600 rounded focus:ring-orange-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Jiang's official NR"})]}),c.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[c.jsxs("div",{className:"flex justify-between items-baseline",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:b?"Calculated:":"Manual:"}),c.jsxs("span",{className:`font-mono font-bold ${b?"text-green-600 dark:text-green-400":"text-gray-700 dark:text-gray-300"}`,children:[b&&(le!=null&&le.calcRadius)?le.calcRadius.toFixed(2):x.toFixed(1)," px"]})]}),c.jsx("input",{type:"range",min:"2",max:He,step:"0.5",value:x,onMouseDown:B=>B.stopPropagation(),onChange:B=>{g(parseFloat(B.target.value)),y(!1)},disabled:b,className:`w-full h-1.5 rounded-lg appearance-none cursor-pointer ${b?"bg-gray-200 dark:bg-slate-800":"bg-gray-300 dark:bg-slate-600 accent-orange-500"}`})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onMouseDown:B=>B.stopPropagation(),onClick:B=>{B.stopPropagation(),De()},disabled:!jt,title:jt?"":"Scalar Unmixing must be active. Run Unmixing in Sidebar first.",className:`px-3 py-1.5 text-white font-bold rounded shadow-sm transition-transform active:scale-95 ${jt?"bg-orange-600 hover:bg-orange-500":"bg-gray-400 cursor-not-allowed"}`,children:jt?"Add Current ROI":"Unmixing Required"}),c.jsx("button",{onMouseDown:B=>B.stopPropagation(),onClick:B=>{B.stopPropagation(),de()},disabled:!le||!le.mtf50||!n,className:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold rounded shadow-sm transition-transform active:scale-95",children:"Copy Pos/MTF50"}),c.jsx("button",{onMouseDown:B=>B.stopPropagation(),onClick:B=>{B.stopPropagation(),pt()},disabled:!le,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold rounded shadow-sm transition-transform active:scale-95",children:"Export CSV"}),c.jsx("button",{onMouseDown:B=>B.stopPropagation(),onClick:B=>{B.stopPropagation(),qe()},className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-600 dark:text-slate-300 font-bold rounded transition-colors",children:"Clear"})]})]}),c.jsxs("div",{className:"px-3 py-2 bg-indigo-50 dark:bg-indigo-900/20 border-b border-indigo-200 dark:border-indigo-800 flex items-center gap-4 flex-wrap text-xs",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:F,onChange:B=>{B.stopPropagation(),D(B.target.checked)},className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-indigo-700 dark:text-indigo-400 text-sm",children:"Show Model Line"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"F-number (Aperture)",children:[c.jsx(ns,{locked:Y.aperture,onToggle:()=>te(B=>({...B,aperture:!B.aperture}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"F/"}),c.jsx("input",{type:"number",value:W.aperture,step:"0.05",min:"0.7",max:"64",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,aperture:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"OLPF two-image split separation d (px)",children:[c.jsx(ns,{locked:Y.olpfSeparationPx,onToggle:()=>te(B=>({...B,olpfSeparationPx:!B.olpfSeparationPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"OLPF d:"}),c.jsx("input",{type:"number",value:W.olpfSeparationPx,step:"0.01",min:"0",max:"5",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,olpfSeparationPx:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Pixel Fill Factor (0..1)",children:[c.jsx(ns,{locked:Y.fillFactor,onToggle:()=>te(B=>({...B,fillFactor:!B.fillFactor}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Fill:"}),c.jsx("input",{type:"number",value:W.fillFactor,step:"0.01",min:"0",max:"1",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,fillFactor:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Spherical core sigma (px)",children:[c.jsx(ns,{locked:Y.coreSigmaPx,onToggle:()=>te(B=>({...B,coreSigmaPx:!B.coreSigmaPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Core :"}),c.jsx("input",{type:"number",value:W.coreSigmaPx,step:"0.01",min:"0",max:"10",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,coreSigmaPx:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Spherical halo sigma (px)",children:[c.jsx(ns,{locked:Y.haloSigmaPx,onToggle:()=>te(B=>({...B,haloSigmaPx:!B.haloSigmaPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Halo :"}),c.jsx("input",{type:"number",value:W.haloSigmaPx,step:"0.01",min:"0",max:"50",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,haloSigmaPx:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Halo weight 0..1",children:[c.jsx(ns,{locked:Y.haloWeight,onToggle:()=>te(B=>({...B,haloWeight:!B.haloWeight}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Halo w:"}),c.jsx("input",{type:"number",value:W.haloWeight,step:"0.01",min:"0",max:"1",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,haloWeight:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Wavelength (m) for diffraction model",children:[c.jsx(ns,{locked:Y.wavelengthUm,onToggle:()=>te(B=>({...B,wavelengthUm:!B.wavelengthUm}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:":"}),c.jsx("input",{type:"number",value:W.wavelengthUm,step:"0.01",min:"0.35",max:"0.75",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,wavelengthUm:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"m"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Manual rolloff exponent",children:[c.jsx(ns,{locked:Y.rolloff,onToggle:()=>te(B=>({...B,rolloff:!B.rolloff}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Rolloff:"}),c.jsx("input",{type:"number",value:W.rolloff,step:"0.01",min:"0.1",max:"10",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>{const ge=parseFloat(B.target.value);Number.isFinite(ge)&&H(ye=>({...ye,rolloff:ge}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Fit:"}),c.jsx("input",{type:"number",value:U,step:"0.001",min:"0",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>Se(B.target.value),className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs",title:`Fit range min (${ut})`}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"to"}),c.jsx("input",{type:"number",value:re,step:"0.001",min:"0",onMouseDown:B=>B.stopPropagation(),onClick:B=>B.stopPropagation(),onChange:B=>J(B.target.value),className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs",placeholder:`${kt.toFixed(2)}`,title:`Fit range max (${ut}), blank = current max`}),c.jsx("button",{onMouseDown:B=>B.stopPropagation(),onClick:B=>{B.stopPropagation(),ne||er()},disabled:ne||!le,className:`px-2 py-1 rounded font-bold text-white text-xs transition-transform active:scale-95 ${ne?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-500"}`,title:"Auto fit UNLOCKED params to measured MTF in the given frequency range",children:ne?"Fitting":"Auto Fit"})]}),c.jsx("span",{className:"text-[10px] text-gray-500 dark:text-slate-400 italic ml-2",children:"Dot filled = locked. Auto Fit only changes unlocked params."}),ie&&c.jsx("span",{className:"text-[10px] text-gray-500 dark:text-slate-400 italic ml-2",children:ie})]}),c.jsxs("div",{className:"flex-1 p-4 overflow-hidden flex flex-col gap-4 bg-white dark:bg-slate-950",children:[c.jsxs("div",{className:"h-[35%] min-h-[180px] flex gap-4",children:[c.jsxs("div",{className:"flex-1 bg-gray-50 dark:bg-slate-900/50 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 absolute top-2 left-3 z-10 bg-white/80 dark:bg-slate-900/80 px-1 rounded",children:"ESF"}),c.jsx("div",{className:"flex-1 min-h-0 w-full",children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:be,children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(wa,{dataKey:"x",hide:!0}),c.jsx(ka,{hide:!0,domain:["auto","auto"]}),c.jsx($n,{contentStyle:{fontSize:"10px"}}),c.jsx(Ln,{type:"monotone",dataKey:"y",stroke:"#3b82f6",strokeWidth:1,dot:!1,isAnimationActive:!1})]})})})]}),c.jsxs("div",{className:"flex-1 bg-gray-50 dark:bg-slate-900/50 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsxs("div",{className:"absolute top-2 left-3 z-10 flex items-center gap-3",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 bg-white/80 dark:bg-slate-900/80 px-1 rounded",children:["LSF ",oe>1?`(x${oe.toFixed(0)})`:""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white/80 dark:bg-slate-900/80 px-1 rounded border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold",children:"Zoom"}),c.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:oe,onMouseDown:B=>B.stopPropagation(),onChange:B=>ke(parseFloat(B.target.value)),className:"w-16 h-1 bg-gray-300 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-red-500"})]})]}),c.jsx("div",{className:"flex-1 min-h-0 w-full",children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:fr,children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(Ss,{y:0,stroke:"#9ca3af",strokeOpacity:.5,strokeDasharray:"3 3"}),c.jsx(wa,{dataKey:"x",hide:!0}),c.jsx(ka,{hide:!1,width:30,tick:{fontSize:9,fill:"#888"},domain:[B=>B,B=>B/oe],allowDataOverflow:!0,tickFormatter:B=>B.toFixed(3)}),c.jsx($n,{contentStyle:{fontSize:"10px"},formatter:B=>[B.toFixed(5),"Amplitude"]}),c.jsx(Ln,{type:"monotone",dataKey:"y",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]})]}),c.jsxs("div",{className:"flex-1 flex gap-4 min-h-[250px]",children:[c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsxs("div",{className:"flex justify-between items-start px-2 mb-1",children:[c.jsx("h4",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"MTF"}),c.jsxs("div",{className:"flex gap-4 items-center",children:[(le==null?void 0:le.mtf50)&&c.jsxs("div",{className:"text-sm font-bold text-gray-600 dark:text-slate-300",children:["MTF50 = ",c.jsxs("span",{className:"text-orange-600 dark:text-orange-400",children:[le.mtf50.toFixed(2)," ",ut]})]}),Wt!==null&&c.jsxs("div",{className:"text-lg font-bold text-white bg-orange-500 px-3 py-0.5 rounded shadow-lg animate-in fade-in",children:[Math.round(Wt)," LW/PH"]})]})]}),c.jsxs("div",{className:"flex-1 relative min-h-0 w-full",children:[c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none select-none opacity-10",children:c.jsx("svg",{viewBox:"0 0 400 60",className:"w-[30rem] h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"24",fontWeight:"bold",children:" y-g-jiang.github.io"})})}),c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:Ir,margin:{top:10,right:30,left:10,bottom:20},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.15}),c.jsx(wa,{dataKey:"freq",type:"number",domain:[0,kt],tick:{fontSize:10,fill:"#9ca3af"},label:{value:`Frequency (${ut})`,position:"insideBottom",offset:-10,fontSize:11,fill:"#9ca3af"}}),c.jsx(ka,{domain:[0,1.1],tick:{fontSize:10,fill:"#9ca3af"},label:{value:"MTF",angle:-90,position:"insideLeft",fontSize:11,fill:"#9ca3af"}}),c.jsx($n,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.9)",border:"none",color:"#fff",fontSize:"11px",borderRadius:"4px"},labelFormatter:B=>`Freq: ${Number(B).toFixed(3)} ${ut}`,formatter:(B,ge)=>ge==="Model"?[B==null?void 0:B.toFixed(4),"Model"]:[B==null?void 0:B.toFixed(4),"Measured"]}),c.jsx(ro,{verticalAlign:"top",height:20}),c.jsx(Ln,{type:"monotone",dataKey:"mtf",name:"Measured",stroke:"#000000",strokeWidth:2,className:"dark:stroke-white",dot:!1,isAnimationActive:!1,connectNulls:!1}),F&&c.jsx(Ln,{type:"monotone",dataKey:"modelMtf",name:"Model",stroke:"#0066cc",strokeWidth:2,strokeDasharray:"5 5",dot:!1,isAnimationActive:!1,connectNulls:!0}),(le==null?void 0:le.mtf50)&&c.jsx(u0,{x:le.mtf50,y:.5,r:4,fill:"#f97316",stroke:"none",children:c.jsx(Jn,{value:"MTF50",position:"top",fill:"#f97316",fontSize:10,fontWeight:"bold"})})]})})]})]}),P&&c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsx("div",{className:"flex justify-between items-start px-2 mb-1",children:c.jsx("h4",{className:"text-xs font-bold text-teal-600 dark:text-teal-400 uppercase",children:"PTF / Phase"})}),c.jsx("div",{className:"flex-1 relative min-h-0 w-full",children:c.jsx(qi,{width:"100%",height:"100%",children:c.jsxs(wl,{data:tt,margin:{top:10,right:30,left:10,bottom:20},children:[c.jsx(Di,{strokeDasharray:"3 3",stroke:"#374151",opacity:.15}),c.jsx(wa,{dataKey:"freq",type:"number",domain:[0,kt],tick:{fontSize:10,fill:"#9ca3af"},label:{value:`Frequency (${ut})`,position:"insideBottom",offset:-10,fontSize:11,fill:"#9ca3af"}}),c.jsx(ka,{tick:{fontSize:10,fill:"#9ca3af"},label:{value:"Phase (Rad)",angle:-90,position:"insideLeft",fontSize:11,fill:"#9ca3af"}}),c.jsx($n,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.9)",border:"none",color:"#fff",fontSize:"11px",borderRadius:"4px"},labelFormatter:B=>`Freq: ${Number(B).toFixed(3)} ${ut}`,formatter:B=>[B==null?void 0:B.toFixed(4),"Phase (Rad)"]}),c.jsx(Ln,{type:"monotone",dataKey:"ptf",name:"Phase",stroke:"#0d9488",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]})]})]})]}),!nt&&c.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-50 bg-gray-300 dark:bg-slate-600 rounded-tl hover:bg-orange-500 transition-colors",onMouseDown:dt})]})},xse=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Rational = (5,8); Ascii = (2,1); Byte = (1,1)
    Undefined = (7,1); Srational = (10,8); IFD = (13,4)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); Orientation = (274, Type.Short); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)
    BlackLevelRepeatDim = (50713, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 5 or tid == 10: 
            flat = [item for sublist in value for item in sublist]
            fmt = 'L' if tid == 5 else 'l'
            return struct.pack('<%s%s' % (len(flat), fmt), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def convert_to_dng(raw_bytes, width, height, cfa_str, black_level_list, shift, linear_shift, cm_flat):
    # 1. Pixel Data Processing
    # Ensure raw_bytes is a bytes-like object
    raw_data = np.frombuffer(raw_bytes, dtype=np.uint16).copy()
    
    # Use int32 for calculations to prevent premature overflow and allow negative offsets
    raw_data = raw_data.astype(np.int32)

    # Apply Bit Shift (<<)
    if shift > 0:
        raw_data = raw_data * (1 << shift)
    
    # Apply Linear Offset (+)
    if linear_shift != 0:
        raw_data = raw_data + linear_shift

    # Clip to 16-bit range
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    # 2. Metadata Preparation
    white_level = 65019
    # Format Color Matrix for Srational (Value, Denominator)
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]

    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}
    
    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]), 
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, "JO-Workstation"),
        dngTag(Tag.Model, "Manual-16bit"),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]), 
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, "Generic 16bit Raw")
    ]
    
    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0])) 
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)
    
    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size
    
    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC
            
    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break
            
    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))
    
    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12
        
    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)
        
    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`,yse=({isOpen:e,onClose:t,rawImageData:r,fileName:n,zIndex:a=200,onFocus:i})=>{const[o,s]=j.useState(!0),[l,u]=j.useState(!1),[d,f]=j.useState(""),h=j.useRef(null),p=j.useRef(null),[x,g]=j.useState(4),[b,y]=j.useState(0),[m,k]=j.useState(""),[S,w]=j.useState(""),[v,M]=j.useState("RGGB"),[N,_]=j.useState(!1),[P,E]=j.useState(100),[R,T]=j.useState(4e3),[G,L]=j.useState(0),[C,$]=j.useState(0),A=j.useMemo(()=>Object.keys(tu).sort(),[]);j.useEffect(()=>{e&&!h.current&&(async()=>{try{const W=await window.loadPyodide();await W.loadPackage("numpy"),await W.runPythonAsync(xse),h.current=W,s(!1)}catch(W){console.error("Pyodide Init Failed",W)}})()},[e]),j.useEffect(()=>{if(e&&r){const D=r.whiteLevel;D>1e4?g(2):D>3e3?g(4):D>6e4&&g(0);const W=r.bayerPattern?r.bayerPattern.toUpperCase():"RGGB";["RGGB","BGGR","GBRG","GRBG"].includes(W)?M(W):M("RGGB");const H=Math.min(r.width,r.height),Y=Math.max(48,Math.round(H/40));E(Y),L(Math.round(Y*10)),$(Math.round(r.height-Y*2))}},[e,r]);const O=async D=>{if(!D.target.files||D.target.files.length===0||!h.current)return;const W=Array.from(D.target.files);u(!0);const H=m.trim()?m.trim().split(/\s+/).map(Number):[0,0,0,0];for(H.length===1&&!isNaN(H[0])&&H.push(H[0],H[0],H[0]);H.length<4;)H.push(0);const Y=S.trim()?S.trim().split(/[\s,\n]+/).map(Number):[1,0,0,0,1,0,0,0,1];if(Y.length!==9){alert("Color Matrix must contain exactly 9 numeric values."),u(!1);return}const te=h.current;for(let U=0;U<W.length;U++){const Se=W[U];f(`Processing ${U+1}/${W.length}: ${Se.name}`);try{const re=await Se.arrayBuffer(),J=await Bl(re);let ne;if(N){const Pe=document.createElement("canvas");Pe.width=J.width,Pe.height=J.height;const Fe=Pe.getContext("2d");if(Fe){Fe.fillStyle="black",Fe.fillRect(0,0,Pe.width,Pe.height),Fe.font=`bold ${P}px sans-serif`,Fe.fillStyle="white",Fe.textBaseline="middle",Fe.textAlign="center",Fe.fillText("(C)  y-g-jiang.github.io",G,C);const Ue=Fe.getImageData(0,0,Pe.width,Pe.height).data;ne=new Uint16Array(J.data);const K=ne.length;for(let _e=0;_e<K;_e++)if(Ue[_e*4]>128){let Te=ne[_e]+R;Te<0&&(Te=0),Te>65535&&(Te=65535),ne[_e]=Te}}else ne=new Uint16Array(J.data)}else ne=J.data;te.globals.set("js_raw_bytes",new Uint8Array(ne.buffer,ne.byteOffset,ne.byteLength)),te.globals.set("js_width",J.width),te.globals.set("js_height",J.height),te.globals.set("js_cfa",v),te.globals.set("js_bl_list",H),te.globals.set("js_shift",x),te.globals.set("js_linear_shift",b),te.globals.set("js_cm_flat",Y);const ce=await te.runPythonAsync(`
                    convert_to_dng(
                        js_raw_bytes.to_py(), 
                        js_width, 
                        js_height, 
                        js_cfa, 
                        js_bl_list.to_py(), 
                        js_shift,
                        js_linear_shift,
                        js_cm_flat.to_py()
                    )
                `),ie=ce.toJs();ce.destroy();const se=new Blob([ie],{type:"image/x-adobe-dng"}),oe=URL.createObjectURL(se),ke=document.createElement("a");ke.href=oe;const le=Se.name.substring(0,Se.name.lastIndexOf("."))||"image",fe=N?"_wm":"";ke.download=`${le}_16bit_manual${fe}.dng`,document.body.appendChild(ke),ke.click(),document.body.removeChild(ke),URL.revokeObjectURL(oe),await new Promise(Pe=>setTimeout(Pe,200))}catch(re){console.error(`Failed to batch process ${Se.name}`,re)}}u(!1),f(""),D.target.value=""},F=async()=>{if(!(!r||!h.current)){u(!0);try{const D=h.current,W=m.trim()?m.trim().split(/\s+/).map(Number):[0,0,0,0];if(W.length===1&&!isNaN(W[0])&&W.push(W[0],W[0],W[0]),W.length<4)for(;W.length<4;)W.push(0);const H=S.trim()?S.trim().split(/[\s,\n]+/).map(Number):[1,0,0,0,1,0,0,0,1];if(H.length!==9)throw new Error("Color Matrix must contain exactly 9 numeric values.");const Y=v;let te;if(N){const se=document.createElement("canvas");se.width=r.width,se.height=r.height;const oe=se.getContext("2d");if(oe){oe.fillStyle="black",oe.fillRect(0,0,se.width,se.height),oe.font=`bold ${P}px sans-serif`,oe.fillStyle="white",oe.textBaseline="middle",oe.textAlign="center",oe.fillText("(C)  y-g-jiang.github.io",G,C);const ke=oe.getImageData(0,0,se.width,se.height).data;te=new Uint16Array(r.data);const le=te.length;for(let fe=0;fe<le;fe++)if(ke[fe*4]>128){let Pe=te[fe]+R;Pe<0&&(Pe=0),Pe>65535&&(Pe=65535),te[fe]=Pe}}else te=new Uint16Array(r.data)}else te=r.data;D.globals.set("js_raw_bytes",new Uint8Array(te.buffer,te.byteOffset,te.byteLength)),D.globals.set("js_width",r.width),D.globals.set("js_height",r.height),D.globals.set("js_cfa",Y),D.globals.set("js_bl_list",W),D.globals.set("js_shift",x),D.globals.set("js_linear_shift",b),D.globals.set("js_cm_flat",H);const U=await D.runPythonAsync(`
                convert_to_dng(
                    js_raw_bytes.to_py(), 
                    js_width, 
                    js_height, 
                    js_cfa, 
                    js_bl_list.to_py(), 
                    js_shift,
                    js_linear_shift,
                    js_cm_flat.to_py()
                )
            `),Se=U.toJs();U.destroy();const re=new Blob([Se],{type:"image/x-adobe-dng"}),J=URL.createObjectURL(re),ne=document.createElement("a");ne.href=J;const ce=n.substring(0,n.lastIndexOf("."))||"image",ie=N?"_wm":"";ne.download=`${ce}_16bit_manual${ie}.dng`,document.body.appendChild(ne),ne.click(),document.body.removeChild(ne),URL.revokeObjectURL(J)}catch(D){console.error(D),alert("Export Failed: "+D.message)}finally{u(!1)}}};return e?c.jsxs(qs,{initialPosition:{x:window.innerWidth/2-250,y:50},onClose:t,zIndex:a,onFocus:i,className:"w-[500px] bg-white dark:bg-black border-2 border-black dark:border-white shadow-2xl rounded-none flex flex-col font-mono max-h-[90vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b-2 border-black dark:border-gray-500 bg-gray-200 dark:bg-gray-800",children:[c.jsx("h3",{className:"text-sm font-bold text-black dark:text-white uppercase tracking-widest",children:"16-bit DNG Workstation"}),c.jsx("button",{onClick:t,className:"text-black dark:text-white hover:text-red-600 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-6 flex flex-col gap-6",children:o?c.jsxs("div",{className:"flex flex-col items-center justify-center py-10 gap-4",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-black dark:border-white border-t-transparent animate-spin"}),c.jsx("p",{className:"text-xs font-bold text-gray-500 animate-pulse"})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Width (Read Only)"}),c.jsx("input",{type:"text",readOnly:!0,value:(r==null?void 0:r.width)||0,className:"w-full bg-gray-100 dark:bg-gray-900 border border-black dark:border-gray-600 px-2 py-1 text-sm text-gray-400"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Height (Read Only)"}),c.jsx("input",{type:"text",readOnly:!0,value:(r==null?void 0:r.height)||0,className:"w-full bg-gray-100 dark:bg-gray-900 border border-black dark:border-gray-600 px-2 py-1 text-sm text-gray-400"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-400 uppercase",children:"Bit Shift (<<)"}),c.jsx("input",{type:"number",value:x,onChange:D=>g(parseInt(D.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold"})]}),c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-400 uppercase",children:"Offset (+)"}),c.jsx("input",{type:"number",value:b,onChange:D=>y(parseInt(D.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold"})]}),c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400 uppercase",children:"Pattern"}),c.jsxs("select",{value:v,onChange:D=>M(D.target.value),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-1 py-1 text-sm font-bold",children:[c.jsx("option",{value:"RGGB",children:"RGGB"}),c.jsx("option",{value:"BGGR",children:"BGGR"}),c.jsx("option",{value:"GBRG",children:"GBRG"}),c.jsx("option",{value:"GRBG",children:"GRBG"})]})]})]}),c.jsx("div",{className:"mt-[-10px] grid grid-cols-3 gap-4",children:c.jsx("div",{className:"text-[9px] text-gray-400 dark:text-gray-500 col-span-2",children:"Shift: 4=12bit(x16), 2=14bit(x4). Added after shift."})}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase",children:"16bit Black Level (Manual Fill)"}),c.jsx("input",{type:"text",value:m,onChange:D=>k(D.target.value),placeholder:"R G1 B G2",className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold font-mono placeholder:font-normal placeholder:text-gray-400"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("div",{className:"flex justify-between items-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Color Matrix (XYZ to Raw - 9 Values)"}),c.jsxs("select",{className:"text-[10px] bg-gray-100 dark:bg-gray-800 border border-black dark:border-gray-500 rounded-none px-1 py-0.5 max-w-[180px] cursor-pointer",onChange:D=>{const W=tu[D.target.value];W&&w(W),D.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Camera Preset..."}),A.map(D=>c.jsx("option",{value:D,children:D},D))]})]}),c.jsx("textarea",{value:S,onChange:D=>w(D.target.value),placeholder:"e.g. 0.94 -0.39 -0.07 -0.28 1.09 0.22 -0.01 0.09 0.57",className:"w-full h-20 bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-xs font-mono resize-none placeholder:font-normal placeholder:text-gray-400"}),c.jsx("span",{className:"text-[8px] text-gray-400 mt-0.5",children:"Enter 9 numbers separated by space or comma."})]}),c.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 rounded p-3",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("input",{type:"checkbox",id:"enableWatermark",checked:N,onChange:D=>_(D.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),c.jsx("label",{htmlFor:"enableWatermark",className:"text-xs font-bold text-gray-700 dark:text-gray-300 select-none",children:"Add Watermark: (C)  y-g-jiang.github.io"})]}),N&&c.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-1",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Size (px)"}),c.jsx("input",{type:"number",value:P,onChange:D=>E(Math.max(10,parseInt(D.target.value)||10)),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Depth (Shift DN)"}),c.jsx("input",{type:"number",value:R,onChange:D=>T(parseInt(D.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs",placeholder:"+/- value"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Center X"}),c.jsx("input",{type:"number",value:G,onChange:D=>L(parseInt(D.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Center Y"}),c.jsx("input",{type:"number",value:C,onChange:D=>$(parseInt(D.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]})]})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"file",ref:p,multiple:!0,className:"hidden",accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:O}),c.jsx("button",{onClick:()=>{var D;return(D=p.current)==null?void 0:D.click()},disabled:l,className:"flex-1 py-4 text-sm font-bold uppercase tracking-widest transition-all shadow-[4px_4px_0px_black] active:shadow-none active:translate-x-1 active:translate-y-1 bg-white dark:bg-slate-800 border-2 border-black dark:border-white text-black dark:text-white hover:bg-gray-100 dark:hover:bg-slate-700",children:"Batch Export (Files)"}),c.jsx("button",{onClick:F,disabled:l,className:`flex-[2] py-4 text-sm font-bold uppercase tracking-widest transition-all shadow-[4px_4px_0px_black] active:shadow-none active:translate-x-1 active:translate-y-1 ${l?"bg-gray-400 cursor-wait":"bg-cyan-600 hover:bg-cyan-500 text-white border-2 border-black"}`,children:l?"Processing...":"Export Single"})]}),d&&c.jsx("div",{className:"text-center text-xs font-bold text-cyan-600 dark:text-cyan-400 animate-pulse",children:d})]})})]}):null},oO=1196311626,Xb=3,jg=40,kl=20,Ec=20,pw=4+Ec*4,bse=kl*pw,d4=jg,Th=jg+bse,sO=0,lO=1,vse=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],cO=0,js=new Set(["R","G","B"]),wse=e=>{const t=(e||"RGGB").toUpperCase().trim();return t.length>=4&&js.has(t[0])&&js.has(t[1])&&js.has(t[2])&&js.has(t[3])?t.slice(0,4):"RGGB"},kse=e=>{const t=wse(e);return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Sse=e=>{if(!e||e.length<4)return null;const t=e.slice(0,4).map(r=>String.fromCharCode(Math.round(r))).join("").toUpperCase();return t.length===4&&js.has(t[0])&&js.has(t[1])&&js.has(t[2])&&js.has(t[3])?t:null},Mse=e=>{if(!e.customMatrix||e.customMatrix.length!==9)return[[1,0,0],[0,1,0],[0,0,1]];const t=[[e.customMatrix[0],e.customMatrix[1],e.customMatrix[2]],[e.customMatrix[3],e.customMatrix[4],e.customMatrix[5]],[e.customMatrix[6],e.customMatrix[7],e.customMatrix[8]]],r=Lo(t);return r?Jc(vse,r):[[1,0,0],[0,1,0],[0,0,1]]};function jse(e,t,r,n,a="RGGB",i=[],o=[],s=null){if(e<=0||t<=0)throw new Error("Invalid JDNG size.");const l=e*t;let u=1;if(r.length===l*3)u=3;else if(r.length!==l)throw new Error("JDNG float data size mismatch.");if(i.length>kl)throw new Error(`JDNG tag count exceeds ${kl}.`);let d=0;for(let M=0;M<r.length;M++){const N=r[M];Number.isFinite(N)&&N>d&&(d=N)}const f=!!s&&s.length===l;if(s&&s.length!==l)throw new Error("JDNG source map length mismatch.");const h=f?o.map(M=>String(M)):[],p=new TextEncoder,x=f?p.encode(JSON.stringify(h)):new Uint8Array(0),g=4+(f?12+x.length+s.length*2:0),b=Th+r.length*4+g,y=new ArrayBuffer(b),m=new DataView(y);m.setUint32(0,oO,!0),m.setUint32(4,Xb,!0),m.setUint32(8,e,!0),m.setUint32(12,t,!0),m.setFloat32(16,n[0],!0),m.setFloat32(20,n[1],!0),m.setFloat32(24,n[2],!0),m.setFloat32(28,n[3],!0),m.setFloat32(32,d,!0),m.setUint32(36,u,!0);const k=Array.from({length:kl},(M,N)=>(i[N]||[]).slice(0,Ec));k[cO]=kse(a);const S=jg;for(let M=0;M<kl;M++){const N=k[M]||[];if(N.length>Ec)throw new Error(`JDNG tag ${M} exceeds max length ${Ec}.`);const _=S+M*pw;m.setUint32(_,N.length,!0);for(let P=0;P<Ec;P++){const E=P<N.length?N[P]:0;m.setFloat32(_+4+P*4,Number.isFinite(E)?E:0,!0)}}new Float32Array(y,Th,r.length).set(r);let v=Th+r.length*4;if(m.setUint32(v,f?lO:sO,!0),v+=4,f&&s){m.setUint32(v,h.length,!0),v+=4,m.setUint32(v,x.length,!0),v+=4,m.setUint32(v,s.length,!0),v+=4,new Uint8Array(y,v,x.length).set(x),v+=x.length;for(let M=0;M<s.length;M++)m.setInt16(v+M*2,s[M],!0)}return y}function Nse(e){if(e.byteLength<d4)throw new Error("Invalid JDNG file: header too short.");const t=new DataView(e);if(t.getUint32(0,!0)!==oO)throw new Error("Invalid JDNG file: bad magic.");const n=t.getUint32(4,!0);if(n!==1&&n!==2&&n!==Xb)throw new Error(`Unsupported JDNG version: ${n}`);const a=t.getUint32(8,!0),i=t.getUint32(12,!0);if(!Number.isFinite(a)||!Number.isFinite(i)||a<=0||i<=0)throw new Error("Invalid JDNG dimensions.");const o=a*i;let s=Math.max(1,Math.floor(t.getUint32(36,!0)||1));s!==1&&s!==3&&(s=1);const l=n===1?d4:Th,u=o*s,d=l+u*4;if(e.byteLength<d)throw new Error(`Invalid JDNG payload size: expected at least ${d}, got ${e.byteLength}.`);const f=[t.getFloat32(16,!0),t.getFloat32(20,!0),t.getFloat32(24,!0),t.getFloat32(28,!0)],h=t.getFloat32(32,!0),p=Array.from({length:kl},()=>[]);if(n>=2){const y=jg;for(let m=0;m<kl;m++){const k=y+m*pw,S=t.getUint32(k,!0);if(S>Ec)throw new Error(`Invalid JDNG tag length at tag ${m}: ${S}.`);const w=[];for(let v=0;v<S;v++)w.push(t.getFloat32(k+4+v*4,!0));p[m]=w}}const x=new Float32Array(u);x.set(new Float32Array(e,l,u));let g=[],b=null;if(n===Xb){let y=d;if(e.byteLength<y+4)throw new Error("Invalid JDNG provenance header.");const m=t.getUint32(y,!0);if(y+=4,m===sO){if(e.byteLength!==d+4)throw new Error("Invalid JDNG size: unexpected trailing bytes without provenance.")}else if(m===lO){if(e.byteLength<y+12)throw new Error("Invalid JDNG provenance metadata.");const k=t.getUint32(y,!0);y+=4;const S=t.getUint32(y,!0);y+=4;const w=t.getUint32(y,!0);if(y+=4,e.byteLength<y+S+w*2)throw new Error("Invalid JDNG provenance payload length.");const v=new Uint8Array(e,y,S);y+=S;const M=new TextDecoder().decode(v),N=JSON.parse(M);if(!Array.isArray(N))throw new Error("Invalid JDNG provenance names payload.");if(g=N.map(_=>String(_)),g.length!==k)throw new Error("JDNG provenance source count mismatch.");if(w!==o)throw new Error(`JDNG provenance map length mismatch: expected ${o}, got ${w}.`);b=new Int16Array(w);for(let _=0;_<w;_++)b[_]=t.getInt16(y+_*2,!0);if(y+=w*2,y!==e.byteLength){const _=new Uint8Array(e,y,e.byteLength-y);let P=!1;for(let E=0;E<_.length;E++)if(_[E]!==0){P=!0;break}if(P)throw new Error("Invalid JDNG size: trailing bytes after provenance payload.")}}else throw new Error(`Unsupported JDNG provenance version: ${m}`)}else if(e.byteLength!==d)throw new Error(`Invalid JDNG payload size: expected ${d}, got ${e.byteLength}.`);return{version:n,width:a,height:i,channels:s,blackLevel:f,whiteLevel:h,tags:p,data:x,sourceNames:g,sourceMap:b}}const Kb=e=>Math.max(0,Math.min(1,e)),as=e=>{const t=Kb(e),r=t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055;return Math.round(Kb(r)*255)},f4=(e,t,r)=>{const n=Kb((r-e)/Math.max(t-e,1e-9));return n*n*n*(n*(n*6-15)+10)},_se=e=>{const t=(e||"RGGB").toUpperCase();return t.length>=4?t.slice(0,4):"RGGB"},mw=(e,t,r)=>{const n=(r&1)<<1|t&1;return e[n]||"G"},sy=(e,t,r,n,a,i,o)=>{const s=d=>d<0?0:d>=n?n-1:d,l=d=>d<0?0:d>=a?a-1:d,u=[[0,0],[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,-1],[-1,1],[1,1]];for(let d=0;d<u.length;d++){const f=s(e+u[d][0]),h=l(t+u[d][1]);if(mw(i,f,h)===r)return o[h*n+f]}return o[t*n+e]},is=(e,t,r,n,a,i,o,s)=>{const l=h=>h<0?0:h>=n?n-1:h,u=h=>h<0?0:h>=a?a-1:h;let d=0,f=0;for(let h=0;h<s.length;h++){const p=l(e+s[h][0]),x=u(t+s[h][1]);mw(i,p,x)===r&&(d+=o[x*n+p],f++)}return f>0?d/f:NaN};function ly(e,t){var W,H,Y,te;const r=e.width,n=e.height,a=r*n,i=e.floatData;if(!i||i.length===0)throw new Error("JDNG render requires floatData in RawImageData.");const o=e.floatChannels||(i.length===a*3?3:1),s=Math.pow(2,Number(t.exposure)||0),l=t.wbGains||[1,1],u=Number(l[0])||1,d=Number(l[1])||1,f=_se(e.bayerPattern),h=t.blackLevel||[((W=e.blackLevels)==null?void 0:W[0])||0,((H=e.blackLevels)==null?void 0:H[1])||0,((Y=e.blackLevels)==null?void 0:Y[2])||0,((te=e.blackLevels)==null?void 0:te[3])||0],p=Number(h[0])||0,x=((Number(h[1])||0)+(Number(h[2])||0))*.5,g=Number(h[3])||0,b=e.metadata||{};let y=Number(b.sourceWhiteLevel);if(!Number.isFinite(y)||y<=1e-9){const U=Number(b.sourceMax);Number.isFinite(U)&&U>1e-9&&(y=U)}(!Number.isFinite(y)||y<=1e-9)&&(y=Math.max(1,e.whiteLevel||1));let m=y;if(t.highlightRecovery){const U=Number(t.customWhiteLevel);Number.isFinite(U)&&U>1e-9&&(m=U)}const k=Mse(t),S=k[0][0],w=k[0][1],v=k[0][2],M=k[1][0],N=k[1][1],_=k[1][2],P=k[2][0],E=k[2][1],R=k[2][2],T=!!t.highlightRecovery;let G=[1,1,1];if(T){const U=Lo(k);if(U){const Se=VN(U,[1,1,1]),re=Math.max(Math.abs(Se[0]),Math.max(Math.abs(Se[1]),Math.abs(Se[2])));re>1e-9&&(G=[Se[0]/re,Se[1]/re,Se[2]/re])}}const L=new Float32Array(a*3),C=new Uint8ClampedArray(a*4);if(t.renderMode==="zero-dependency"){if(o===3&&i.length>=a*3){const U=Math.max(1e-9,y-p),Se=Math.max(1e-9,y-x),re=Math.max(1e-9,y-g);for(let J=0,ne=0;J<a;J++,ne+=3){const ce=Math.max(0,(i[ne]-p)/U*s*u),ie=Math.max(0,(i[ne+1]-x)/Se*s),se=Math.max(0,(i[ne+2]-g)/re*s*d),oe=(ce+ie+se)/3;L[ne]=oe,L[ne+1]=oe,L[ne+2]=oe;const ke=J*4,le=as(oe);C[ke]=le,C[ke+1]=le,C[ke+2]=le,C[ke+3]=255}}else{if(i.length<a)throw new Error("JDNG floatData length does not match image size.");for(let U=0;U<n;U++){const Se=U*r;for(let re=0;re<r;re++){const J=Se+re,ne=(U&1)<<1|re&1,ce=f[ne]||"G",ie=Number(h[ne])||0,se=Math.max(1e-9,y-ie);let oe=(i[J]-ie)/se;(!Number.isFinite(oe)||oe<0)&&(oe=0),ce==="R"&&(oe*=u),ce==="B"&&(oe*=d),oe*=s;const ke=J*3;L[ke]=oe,L[ke+1]=oe,L[ke+2]=oe;const le=J*4,fe=as(oe);C[le]=fe,C[le+1]=fe,C[le+2]=fe,C[le+3]=255}}}return{imageData:new ImageData(C,r,n),floatRgb:L,width:r,height:n}}if(o===3&&i.length>=a*3){const U=Math.max(1e-9,m-p),Se=Math.max(1e-9,m-x),re=Math.max(1e-9,m-g);for(let J=0,ne=0;J<a;J++,ne+=3){let ce=Math.max(0,(i[ne]-p)/U*u),ie=Math.max(0,(i[ne+1]-x)/Se),se=Math.max(0,(i[ne+2]-g)/re*d);if(T){const Pe=Math.max(ce/Math.max(u,1e-6),Math.max(ie,se/Math.max(d,1e-6))),Fe=f4(.85,1,Pe);if(Fe>0){const Ue=Math.max(ce,Math.max(ie,se)),K=G[0]*Ue,_e=G[1]*Ue,Te=G[2]*Ue;ce=ce+(K-ce)*Fe,ie=ie+(_e-ie)*Fe,se=se+(Te-se)*Fe}}const oe=Math.max(0,(S*ce+w*ie+v*se)*s),ke=Math.max(0,(M*ce+N*ie+_*se)*s),le=Math.max(0,(P*ce+E*ie+R*se)*s);L[ne]=oe,L[ne+1]=ke,L[ne+2]=le;const fe=J*4;C[fe]=as(oe),C[fe+1]=as(ke),C[fe+2]=as(le),C[fe+3]=255}return{imageData:new ImageData(C,r,n),floatRgb:L,width:r,height:n}}if(i.length<a)throw new Error("JDNG floatData length does not match image size.");const A=new Float32Array(a);for(let U=0;U<n;U++){const Se=U*r;for(let re=0;re<r;re++){const J=Se+re,ne=(U&1)<<1|re&1,ce=f[ne]||"G",ie=Number(h[ne])||0,se=Math.max(1e-9,m-ie);let oe=(i[J]-ie)/se;(!Number.isFinite(oe)||oe<0)&&(oe=0),ce==="R"&&(oe*=u),ce==="B"&&(oe*=d),A[J]=oe*s}}const O=t.demosaicMethod===0,F=[[-1,0],[1,0],[0,-1],[0,1]],D=[[-1,-1],[1,-1],[-1,1],[1,1]];for(let U=0;U<n;U++){const Se=U*r;for(let re=0;re<r;re++){const J=Se+re,ne=mw(f,re,U);let ce=0,ie=0,se=0;if(O)ce=sy(re,U,"R",r,n,f,A),ie=sy(re,U,"G",r,n,f,A),se=sy(re,U,"B",r,n,f,A);else{const Fe=A[J];ne==="R"?(ce=Fe,ie=is(re,U,"G",r,n,f,A,F),se=is(re,U,"B",r,n,f,A,D)):ne==="B"?(se=Fe,ie=is(re,U,"G",r,n,f,A,F),ce=is(re,U,"R",r,n,f,A,D)):(ie=Fe,ce=is(re,U,"R",r,n,f,A,F),se=is(re,U,"B",r,n,f,A,F),Number.isFinite(ce)||(ce=is(re,U,"R",r,n,f,A,D)),Number.isFinite(se)||(se=is(re,U,"B",r,n,f,A,D))),Number.isFinite(ce)||(ce=Fe),Number.isFinite(ie)||(ie=Fe),Number.isFinite(se)||(se=Fe)}if(T){const Fe=ce/Math.max(u,1e-6),Ue=ie,K=se/Math.max(d,1e-6),_e=Math.max(Fe,Math.max(Ue,K)),Te=f4(.85,1,_e);if(Te>0){const Le=Math.max(ce,Math.max(ie,se)),ft=G[0]*Le,Xe=G[1]*Le,Ie=G[2]*Le;ce=ce+(ft-ce)*Te,ie=ie+(Xe-ie)*Te,se=se+(Ie-se)*Te}}const oe=Math.max(0,S*ce+w*ie+v*se),ke=Math.max(0,M*ce+N*ie+_*se),le=Math.max(0,P*ce+E*ie+R*se),fe=J*3;L[fe]=oe,L[fe+1]=ke,L[fe+2]=le;const Pe=J*4;C[Pe]=as(oe),C[Pe+1]=as(ke),C[Pe+2]=as(le),C[Pe+3]=255}}return{imageData:new ImageData(C,r,n),floatRgb:L,width:r,height:n}}async function Pse(e){const t=Nse(e),{width:r,height:n,data:a,blackLevel:i,whiteLevel:o,channels:s}=t,l=Sse(t.tags[cO])||"RGGB",u=r*n;let d=1/0,f=-1/0;for(let _=0;_<a.length;_++){const P=a[_];Number.isFinite(P)&&(P<d&&(d=P),P>f&&(f=P))}(!Number.isFinite(d)||!Number.isFinite(f))&&(d=0,f=1);const h=Math.max(1e-12,f-d),p=d<0?-d:0,x=Math.max(0,f+p),g=x>65535?65535/x:1,b=Math.max(1,Math.min(65535,Math.round(x*g))),y=s===3?3:1,m=new Uint16Array(u*y),k=new Uint8ClampedArray(u*4);if(y===3)for(let _=0,P=0;_<u;_++,P+=3){const E=Number.isFinite(a[P])?a[P]:0,R=Number.isFinite(a[P+1])?a[P+1]:0,T=Number.isFinite(a[P+2])?a[P+2]:0;m[P]=Math.max(0,Math.min(65535,Math.round((E+p)*g))),m[P+1]=Math.max(0,Math.min(65535,Math.round((R+p)*g))),m[P+2]=Math.max(0,Math.min(65535,Math.round((T+p)*g)));const G=Math.max(0,Math.min(1,(E-d)/h)),L=Math.max(0,Math.min(1,(R-d)/h)),C=Math.max(0,Math.min(1,(T-d)/h)),$=_*4;k[$]=Math.round(Math.pow(G,1/2.2)*255),k[$+1]=Math.round(Math.pow(L,1/2.2)*255),k[$+2]=Math.round(Math.pow(C,1/2.2)*255),k[$+3]=255}else for(let _=0;_<u;_++){const P=Number.isFinite(a[_])?a[_]:0,E=(P+p)*g;m[_]=Math.max(0,Math.min(65535,Math.round(E)));const R=Math.max(0,Math.min(1,(P-d)/h)),T=Math.pow(R,1/2.2),G=Math.round(T*255),L=_*4;k[L]=G,k[L+1]=G,k[L+2]=G,k[L+3]=255}const S=new ImageData(k,r,n),w=document.createElement("canvas");w.width=r,w.height=n;const v=w.getContext("2d");if(!v)throw new Error("Failed to create canvas context for JDNG preview.");v.putImageData(S,0,0);const M=await new Promise((_,P)=>{w.toBlob(E=>E?_(E):P(new Error("Failed to encode JDNG preview.")),"image/png")}),N={data:m,width:r,height:n,bayerPattern:l,blackLevels:i.map(_=>Math.max(0,Math.round(_))),whiteLevel:b,floatData:a,floatChannels:y,metadata:{format:`JDNG_FLOAT32_V${t.version}`,cfaPattern:l,channels:y,reservedTags:t.tags,sourceNames:t.sourceNames,sourceMap:t.sourceMap,sourceWhiteLevel:o,sourceMin:d,sourceMax:f,quantOffset:p,quantScaleToU16:g},isThreePlane:y===3,isXTrans:!1};return{previewBlob:M,renderedImageData:S,analysisData:N}}const Cse=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]];function Ase(e){const t=e.length;if(t===0)return 16383;const r=Math.max(1,Math.floor(t/1e6));let n=0;for(let a=0;a<t;a+=r){const i=e[a];i>n&&(n=i)}return n>17e3?65535:16383}const Ose=`
struct Uniforms {
    width: u32,
    height: u32,
    whiteLevel: f32,
    exposureScale: f32,

    bl0: f32, bl1: f32, bl2: f32, bl3: f32,
    wb0: f32, wb1: f32, wb2: f32, wb3: f32,

    cm0: f32, cm1: f32, cm2: f32,
    cm3: f32, cm4: f32, cm5: f32,
    cm6: f32, cm7: f32, cm8: f32,

    renderMode: u32,
    isBGGR: u32,
    colorDemosaicMode: u32,

    neutral0: f32, neutral1: f32, neutral2: f32,

    hlrEnabled: u32,
    
    // Export specific flags (packed into padding or new fields)
    exportStretch: u32, 
    exportSrgb: u32,
};

struct UnmixParams {
    bl0: f32, bl1: f32, bl2: f32, bl3: f32,
    bg0: f32, bg1: f32, bg2: f32, bg3: f32,
    fg0: f32, fg1: f32, fg2: f32, fg3: f32,
};

@group(0) @binding(0) var<uniform> u : Uniforms;
@group(0) @binding(1) var<storage, read> rawData : array<u32>;
@group(0) @binding(3) var<uniform> unmix : UnmixParams;
@group(0) @binding(4) var<storage, read> lut : array<f32>; // 1024 float buffer

fn srgb_gamma(linear: f32) -> f32 {
    if (linear <= 0.0031308) { return 12.92 * linear; }
    return 1.055 * pow(linear, 1.0 / 2.4) - 0.055;
}

fn clamp01(x: f32) -> f32 { return max(0.0, min(1.0, x)); }
fn clamp_i32(v: i32, lo: i32, hi: i32) -> i32 { return max(lo, min(v, hi)); }

fn smootherstep(edge0: f32, edge1: f32, x: f32) -> f32 {
    let t = clamp01((x - edge0) / max(edge1 - edge0, 1e-6));
    return t*t*t*(t*(t*6.0 - 15.0) + 10.0);
}

fn get_raw_val(idx: u32) -> f32 {
    let u32Idx = idx / 2u;
    let shift = (idx % 2u) * 16u;
    let packed = rawData[u32Idx];
    return f32((packed >> shift) & 0xFFFFu);
}

fn get_bayer_idx(x: u32, y: u32) -> u32 {
    let rowIsOdd = (y % 2u);
    let colIsOdd = (x % 2u);
    return (rowIsOdd * 2u) + colIsOdd;
}

fn get_norm_pixel(x: i32, y: i32) -> f32 {
    let w = i32(u.width);
    let h = i32(u.height);
    let sx = clamp_i32(x, 0, w - 1);
    let sy = clamp_i32(y, 0, h - 1);
    let sxu = u32(sx);
    let syu = u32(sy);
    let idx = syu * u.width + sxu;
    let rawVal = get_raw_val(idx);
    let bIdx = get_bayer_idx(sxu, syu);

    var bl = 0.0;
    var wb = 1.0;
    if (bIdx == 0u) { bl = u.bl0; wb = u.wb0; }
    else if (bIdx == 1u) { bl = u.bl1; wb = u.wb1; }
    else if (bIdx == 2u) { bl = u.bl2; wb = u.wb2; }
    else { bl = u.bl3; wb = u.wb3; }

    let denom = max(u.whiteLevel - bl, 1.0);
    let val = max(0.0, rawVal - bl);
    return (val / denom) * wb;
}

fn shoulder_hue_preserve(rgbIn: vec3f) -> vec3f {
    var rgb = rgbIn;
    let knee = 0.90;
    let mx = max(rgb.x, max(rgb.y, rgb.z));
    if (mx <= knee) { return rgb; }
    let d = mx - knee;
    let mx2 = knee + (d * (1.0 - knee)) / (d + (1.0 - knee));
    let s = mx2 / max(mx, 1e-6);
    return rgb * s;
}

fn apply_lut(val: f32, offset: u32) -> f32 {
    let v = clamp01(val);
    let pos = v * 255.0;
    let idx = u32(pos);
    let f = fract(pos);
    let p0 = lut[offset + idx];
    let idxNext = min(idx + 1u, 255u);
    let p1 = lut[offset + idxNext];
    return mix(p0, p1, f);
}

fn interp_green_edge(xi: i32, yi: i32) -> f32 {
    let left = get_norm_pixel(xi - 1, yi);
    let right = get_norm_pixel(xi + 1, yi);
    let up = get_norm_pixel(xi, yi - 1);
    let down = get_norm_pixel(xi, yi + 1);
    let gradH = abs(left - right);
    let gradV = abs(up - down);
    if (gradH + 1e-6 < gradV) { return (left + right) * 0.5; }
    if (gradV + 1e-6 < gradH) { return (up + down) * 0.5; }
    return (left + right + up + down) * 0.25;
}

fn interp_diag_edge(xi: i32, yi: i32) -> f32 {
    let d1a = get_norm_pixel(xi - 1, yi - 1);
    let d1b = get_norm_pixel(xi + 1, yi + 1);
    let d2a = get_norm_pixel(xi + 1, yi - 1);
    let d2b = get_norm_pixel(xi - 1, yi + 1);
    let gradD1 = abs(d1a - d1b);
    let gradD2 = abs(d2a - d2b);
    if (gradD1 + 1e-6 < gradD2) { return (d1a + d1b) * 0.5; }
    if (gradD2 + 1e-6 < gradD1) { return (d2a + d2b) * 0.5; }
    return (d1a + d1b + d2a + d2b) * 0.25;
}

fn ratio_or_ha(center: f32, nearV: f32, farV: f32) -> f32 {
    let ratio = (2.0 * nearV) / (center + farV + 1e-6);
    let ha = nearV + 0.5 * (center - farV);
    if (abs(1.0 - ratio) < 0.75) { return center * ratio; }
    return ha;
}

fn amaze_green_rb(xi: i32, yi: i32) -> f32 {
    let c = get_norm_pixel(xi, yi);
    let gu = ratio_or_ha(c, get_norm_pixel(xi, yi - 1), get_norm_pixel(xi, yi - 2));
    let gd = ratio_or_ha(c, get_norm_pixel(xi, yi + 1), get_norm_pixel(xi, yi + 2));
    let gl = ratio_or_ha(c, get_norm_pixel(xi - 1, yi), get_norm_pixel(xi - 2, yi));
    let gr = ratio_or_ha(c, get_norm_pixel(xi + 1, yi), get_norm_pixel(xi + 2, yi));

    let wu = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi - 2) - c) + abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1)));
    let wd = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi + 2) - c) + abs(get_norm_pixel(xi, yi + 1) - get_norm_pixel(xi, yi - 1)));
    let wl = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 2, yi) - c) + abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi)));
    let wr = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 2, yi) - c) + abs(get_norm_pixel(xi + 1, yi) - get_norm_pixel(xi - 1, yi)));

    let gv = (wu * gu + wd * gd) / max(wu + wd, 1e-6);
    let gh = (wl * gl + wr * gr) / max(wl + wr, 1e-6);

    let gradH = abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi))
              + abs(get_norm_pixel(xi - 2, yi) - c)
              + abs(c - get_norm_pixel(xi + 2, yi));
    let gradV = abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1))
              + abs(get_norm_pixel(xi, yi - 2) - c)
              + abs(c - get_norm_pixel(xi, yi + 2));
    let wH = 1.0 / (1e-6 + gradH);
    let wV = 1.0 / (1e-6 + gradV);
    return (wH * gh + wV * gv) / max(wH + wV, 1e-6);
}

fn amaze_diag_rb(xi: i32, yi: i32) -> f32 {
    let c = get_norm_pixel(xi, yi);
    let ne = ratio_or_ha(c, get_norm_pixel(xi + 1, yi - 1), get_norm_pixel(xi + 2, yi - 2));
    let sw = ratio_or_ha(c, get_norm_pixel(xi - 1, yi + 1), get_norm_pixel(xi - 2, yi + 2));
    let nw = ratio_or_ha(c, get_norm_pixel(xi - 1, yi - 1), get_norm_pixel(xi - 2, yi - 2));
    let se = ratio_or_ha(c, get_norm_pixel(xi + 1, yi + 1), get_norm_pixel(xi + 2, yi + 2));
    let wp = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 1, yi - 1) - get_norm_pixel(xi - 1, yi + 1))
                         + abs(get_norm_pixel(xi + 2, yi - 2) - get_norm_pixel(xi - 2, yi + 2)));
    let wm = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 1, yi - 1) - get_norm_pixel(xi + 1, yi + 1))
                         + abs(get_norm_pixel(xi - 2, yi - 2) - get_norm_pixel(xi + 2, yi + 2)));
    return (wp * (ne + sw) + wm * (nw + se)) / max(2.0 * (wp + wm), 1e-6);
}

fn amaze_axis_g(xi: i32, yi: i32, horizontal: bool) -> f32 {
    let c = get_norm_pixel(xi, yi);
    if (horizontal) {
        let l = ratio_or_ha(c, get_norm_pixel(xi - 1, yi), get_norm_pixel(xi - 2, yi));
        let r = ratio_or_ha(c, get_norm_pixel(xi + 1, yi), get_norm_pixel(xi + 2, yi));
        let wl = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 2, yi) - c) + abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi)));
        let wr = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 2, yi) - c) + abs(get_norm_pixel(xi + 1, yi) - get_norm_pixel(xi - 1, yi)));
        return (wl * l + wr * r) / max(wl + wr, 1e-6);
    }
    let u0 = ratio_or_ha(c, get_norm_pixel(xi, yi - 1), get_norm_pixel(xi, yi - 2));
    let d0 = ratio_or_ha(c, get_norm_pixel(xi, yi + 1), get_norm_pixel(xi, yi + 2));
    let wu = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi - 2) - c) + abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1)));
    let wd = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi + 2) - c) + abs(get_norm_pixel(xi, yi + 1) - get_norm_pixel(xi, yi - 1)));
    return (wu * u0 + wd * d0) / max(wu + wd, 1e-6);
}
`,Tse=`
    let x = global_id.x;
    let y = global_id.y;
    if (x >= u.width || y >= u.height) { return; }
    let idx = y * u.width + x;

    var finalR: f32 = 0.0;
    var finalG: f32 = 0.0;
    var finalB: f32 = 0.0;
    
    // We compute 'linear-ish' float values first. 
    // In standard modes, these are 0..1.

    // MODE 0: mosaic gray
    if (u.renderMode == 0u) {
        let rawVal = get_raw_val(idx);
        let bIdx = get_bayer_idx(x, y);
        var bl = 0.0; var wb = 1.0;
        if (bIdx == 0u) { bl = u.bl0; wb = u.wb0; }
        else if (bIdx == 1u) { bl = u.bl1; wb = u.wb1; }
        else if (bIdx == 2u) { bl = u.bl2; wb = u.wb2; }
        else { bl = u.bl3; wb = u.wb3; }

        let val = max(0.0, rawVal - bl);
        var norm = val / max(u.whiteLevel - bl, 1.0);
        norm = clamp01(norm * u.exposureScale * wb);
        // Note: Gamma is applied at output stage for modularity
        finalR = norm; finalG = norm; finalB = norm;
    }
    // MODE 2: advanced unmix
    else if (u.renderMode == 2u) {
        let rawVal = get_raw_val(idx);
        let bIdx = get_bayer_idx(x, y);
        var bl = 0.0; var bg = 0.0; var fg = 0.0;
        if (bIdx == 0u) { bl = unmix.bl0; bg = unmix.bg0; fg = unmix.fg0; }
        else if (bIdx == 1u) { bl = unmix.bl1; bg = unmix.bg1; fg = unmix.fg1; }
        else if (bIdx == 2u) { bl = unmix.bl2; bg = unmix.bg2; fg = unmix.fg2; }
        else { bl = unmix.bl3; bg = unmix.bg3; fg = unmix.fg3; }

        let ref_bg = (unmix.bg1 + unmix.bg3) * 0.5;
        let ref_fg = (unmix.fg1 + unmix.fg3) * 0.5;
        let img_linear = max(0.0, rawVal - bl);
        let denom = fg - bg;
        var alpha = 0.0;
        if (abs(denom) > 1e-9) { alpha = (img_linear - bg) / denom; }

        var val = 0.0;
        if (alpha < 0.0) { val = img_linear * (ref_bg / max(bg, 1e-9)); }
        else if (alpha > 1.0) { val = img_linear * (ref_fg / max(fg, 1e-9)); }
        else { val = (1.0 - alpha) * ref_bg + alpha * ref_fg; }

        var norm = clamp01((val * u.exposureScale) / 65535.0);
        finalR = norm; finalG = norm; finalB = norm;
    }
    // MODE 1: color (bilinear or AMaZE)
    else {
        let xi = i32(x); let yi = i32(y);
        let rowIsOdd = (yi & 1); let colIsOdd = (xi & 1);
        var isRed = false; var isBlue = false;
        if (rowIsOdd == 0 && colIsOdd == 0) {
            if (u.isBGGR == 1u) { isBlue = true; } else { isRed = true; }
        } else if (rowIsOdd == 1 && colIsOdd == 1) {
            if (u.isBGGR == 1u) { isRed = true; } else { isBlue = true; }
        }

        var r_lin: f32 = 0.0; var g_lin: f32 = 0.0; var b_lin: f32 = 0.0;
        let useAmaze = (u.colorDemosaicMode == 1u);
        if (isRed) {
            r_lin = get_norm_pixel(xi, yi);
            if (useAmaze) {
                g_lin = amaze_green_rb(xi, yi);
                b_lin = amaze_diag_rb(xi, yi);
            } else {
                g_lin = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1) + get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.25;
                b_lin = (get_norm_pixel(xi-1, yi-1) + get_norm_pixel(xi+1, yi-1) + get_norm_pixel(xi-1, yi+1) + get_norm_pixel(xi+1, yi+1)) * 0.25;
            }
        } else if (isBlue) {
            b_lin = get_norm_pixel(xi, yi);
            if (useAmaze) {
                g_lin = amaze_green_rb(xi, yi);
                r_lin = amaze_diag_rb(xi, yi);
            } else {
                g_lin = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1) + get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.25;
                r_lin = (get_norm_pixel(xi-1, yi-1) + get_norm_pixel(xi+1, yi-1) + get_norm_pixel(xi-1, yi+1) + get_norm_pixel(xi+1, yi+1)) * 0.25;
            }
        } else {
            g_lin = get_norm_pixel(xi, yi);
            var horizIsRed = false;
            if (rowIsOdd == 0) { horizIsRed = (u.isBGGR == 0u); }
            else { horizIsRed = (u.isBGGR == 1u); }
            if (useAmaze) {
                if (horizIsRed) {
                    r_lin = amaze_axis_g(xi, yi, true);
                    b_lin = amaze_axis_g(xi, yi, false);
                } else {
                    b_lin = amaze_axis_g(xi, yi, true);
                    r_lin = amaze_axis_g(xi, yi, false);
                }
            } else {
                let valH = (get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.5;
                let valV = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1)) * 0.5;
                if (horizIsRed) { r_lin = valH; b_lin = valV; }
                else { b_lin = valH; r_lin = valV; }
            }
        }

        // HLR
        if (u.hlrEnabled == 1u) {
            let targetWhite = vec3f(u.neutral0, u.neutral1, u.neutral2);
            let isBG = (u.isBGGR == 1u);
            let wbR = select(u.wb0, u.wb3, isBG); 
            let wbB = select(u.wb3, u.wb0, isBG);
            let r_s = r_lin / max(wbR, 1e-6);
            let g_s = g_lin;
            let b_s = b_lin / max(wbB, 1e-6);
            let mag_sensor = max(r_s, max(g_s, b_s));
            let mag_wb = max(r_lin, max(g_lin, b_lin));
            let hl_mask = smootherstep(0.85, 1.00, mag_sensor);
            if (hl_mask > 0.0) {
                let corrected = targetWhite * mag_wb;
                r_lin = mix(r_lin, corrected.x, hl_mask);
                g_lin = mix(g_lin, corrected.y, hl_mask);
                b_lin = mix(b_lin, corrected.z, hl_mask);
            }
        }

        // Matrix
        var rr = u.cm0*r_lin + u.cm1*g_lin + u.cm2*b_lin;
        var gg = u.cm3*r_lin + u.cm4*g_lin + u.cm5*b_lin;
        var bb = u.cm6*r_lin + u.cm7*g_lin + u.cm8*b_lin;

        // Exposure
        rr *= u.exposureScale;
        gg *= u.exposureScale;
        bb *= u.exposureScale;

        // Shoulder
        var rgb2 = shoulder_hue_preserve(vec3f(rr, gg, bb));

        // Curves
        let rgbPos = max(rgb2, vec3f(0.0));
        let luma = dot(rgbPos, vec3f(0.2126, 0.7152, 0.0722));
        let luma2 = apply_lut(luma, 0u);
        var masterScale = 1.0;
        if (luma > 1e-6) { masterScale = luma2 / luma; }
        let mr = rgb2.x * masterScale;
        let mg = rgb2.y * masterScale;
        let mb = rgb2.z * masterScale;

        finalR = apply_lut(mr, 256u);
        finalG = apply_lut(mg, 512u);
        finalB = apply_lut(mb, 768u);
    }
`;function h4(e){let t="",r="";return e==="display"?(t="@group(0) @binding(2) var<storage, read_write> output : array<u32>;",r=`
            // Standard Display Output (Always sRGB Gamma + 8-bit Packing)
            let r_gamma = srgb_gamma(clamp01(finalR));
            let g_gamma = srgb_gamma(clamp01(finalG));
            let b_gamma = srgb_gamma(clamp01(finalB));

            let r8 = u32(r_gamma * 255.0 + 0.5);
            let g8 = u32(g_gamma * 255.0 + 0.5);
            let b8 = u32(b_gamma * 255.0 + 0.5);
            let a8 = 255u;
            output[idx] = (a8 << 24u) | (b8 << 16u) | (g8 << 8u) | r8;
        `):(t="@group(0) @binding(2) var<storage, read_write> output : array<u32>;",r=`
            var r_out = clamp01(finalR);
            var g_out = clamp01(finalG);
            var b_out = clamp01(finalB);

            if (u.exportSrgb == 1u) {
                r_out = srgb_gamma(r_out);
                g_out = srgb_gamma(g_out);
                b_out = srgb_gamma(b_out);
            }

            var scale = 65535.0;
            if (u.exportStretch == 0u) {
                // Approximate raw magnitude restoration
                // get_norm_pixel divided by (White - Black)
                // So multiply by that range to restore DNs
                // Average green BL? Just use bl0 for simplicity or max range
                let bl = u.bl0; 
                scale = max(u.whiteLevel - bl, 1.0);
            }

            let r16 = u32(min(65535.0, r_out * scale));
            let g16 = u32(min(65535.0, g_out * scale));
            let b16 = u32(min(65535.0, b_out * scale));
            let a16 = 65535u; // Fully opaque

            // Pack: Little Endian logic
            // RG pack: (G << 16) | R
            // BA pack: (A << 16) | B
            
            let packedRG = (g16 << 16u) | r16;
            let packedBA = (a16 << 16u) | b16;

            output[idx * 2u] = packedRG;
            output[idx * 2u + 1u] = packedBA;
        `),`
        ${Ose}
        ${t}
        @compute @workgroup_size(16, 16)
        fn main(@builtin(global_invocation_id) global_id : vec3u) {
            ${Tse}
            ${r}
        }
    `}class Ese{constructor(){wr(this,"device",null);wr(this,"displayPipeline",null);wr(this,"exportPipeline",null);wr(this,"resources",new Map);wr(this,"uniformBuffer",null);wr(this,"unmixParamsBuffer",null);wr(this,"lutBuffer",null);wr(this,"isInitialized",!1)}async init(){if(this.isInitialized)return!0;if(!navigator.gpu)return console.warn("WebGPU not supported."),!1;try{const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("No GPU adapter found.");const r={};t.limits.maxStorageBufferBindingSize&&(r.maxStorageBufferBindingSize=1024*1024*1024),t.limits.maxBufferSize&&(r.maxBufferSize=1024*1024*1024),this.device=await t.requestDevice({requiredLimits:r});const n=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]}),a=this.device.createShaderModule({code:h4("display")});this.displayPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[n]}),compute:{module:a,entryPoint:"main"}});const i=this.device.createShaderModule({code:h4("export")});return this.exportPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[n]}),compute:{module:i,entryPoint:"main"}}),this.uniformBuffer=this.device.createBuffer({size:256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.unmixParamsBuffer=this.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.lutBuffer=this.device.createBuffer({size:4096,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.isInitialized=!0,console.log("WebGPU Renderer Initialized"),!0}catch(t){return console.error("WebGPU Init Failed:",t),!1}}hasImage(t){return this.resources.has(t)}async uploadImage(t,r,n,a,i){if(this.isInitialized||await this.init(),!!this.device){if(this.resources.has(t)){const o=this.resources.get(t);if(o&&o.width===n&&o.height===a)return;this.disposeImage(t)}try{const o=n*a,s=Math.ceil(o*2/4)*4,l=this.device.createBuffer({size:s,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Uint16Array(l.getMappedRange()).set(r),l.unmap();const u=o*4,d=this.device.createBuffer({size:u,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),f=this.device.createBuffer({size:u,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),h=this.device.createBindGroup({layout:this.displayPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:d}},{binding:3,resource:{buffer:this.unmixParamsBuffer}},{binding:4,resource:{buffer:this.lutBuffer}}]}),p=i??Ase(r);this.resources.set(t,{width:n,height:a,rawBuffer:l,outputBuffer:d,readBuffer:f,bindGroup:h,whiteLevel:p,busy:!1})}catch(o){console.error("[WebGPU] Buffer creation failed",o)}}}updateUniforms(t,r,n,a){const i=Math.pow(2,r.exposure),o=r.blackLevel||[0,0,0,0],s=r.wbGains||[1,1];let l=65532;r.highlightRecovery&&(l=r.customWhiteLevel??t.whiteLevel??16383);let u=[1,1,1,1];r.isBGGR?u=[s[1],1,1,s[0]]:u=[s[0],1,1,s[1]];let d=[[1,0,0],[0,1,0],[0,0,1]],f=[1,0,0,0,1,0,0,0,1],h=null;if(r.customMatrix&&r.customMatrix.length===9){const v=[[r.customMatrix[0],r.customMatrix[1],r.customMatrix[2]],[r.customMatrix[3],r.customMatrix[4],r.customMatrix[5]],[r.customMatrix[6],r.customMatrix[7],r.customMatrix[8]]],M=Lo(v);M&&(d=Jc(Cse,M),f=[d[0][0],d[0][1],d[0][2],d[1][0],d[1][1],d[1][2],d[2][0],d[2][1],d[2][2]],h=Lo(d))}const p=f;let x=0;r.renderMode==="zero-dep-color"&&(x=1),r.renderMode==="advanced-zero-dep"&&(x=2);const g=r.zeroDepColorDemosaic==="bilinear"?0:1;let b=[1,1,1];if(h){b=VN(h,[1,1,1]);const v=Math.max(Math.abs(b[0]),Math.max(Math.abs(b[1]),Math.abs(b[2])));v>1e-6?b=[b[0]/v,b[1]/v,b[2]/v]:b=[1,1,1]}const y=new Float32Array([0,0,l,i,o[0],o[1],o[2],o[3],u[0],u[1],u[2],u[3],p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],0,0,0,b[0],b[1],b[2],0,0,0]),m=new Uint32Array(y.buffer);m[0]=t.width,m[1]=t.height,m[21]=x,m[22]=r.isBGGR?1:0,m[23]=g,m[27]=1,m[28]=a.stretch?1:0,m[29]=a.srgb?1:0,this.device.queue.writeBuffer(this.uniformBuffer,0,y);const k=new Float32Array(16);if(x===2&&r.advancedZeroDep){const v=r.advancedZeroDep;k.set([v.bl[0],v.bl[1],v.bl[2],v.bl[3],Math.max(0,v.bg[0]-v.bl[0]),Math.max(0,v.bg[1]-v.bl[1]),Math.max(0,v.bg[2]-v.bl[2]),Math.max(0,v.bg[3]-v.bl[3]),Math.max(0,v.fg[0]-v.bl[0]),Math.max(0,v.fg[1]-v.bl[1]),Math.max(0,v.fg[2]-v.bl[2]),Math.max(0,v.fg[3]-v.bl[3])])}this.device.queue.writeBuffer(this.unmixParamsBuffer,0,k);const S=new Float32Array(1024),w=r.curves||{master:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]};S.set(da(w.master),0),S.set(da(w.red),256),S.set(da(w.green),512),S.set(da(w.blue),768),this.device.queue.writeBuffer(this.lutBuffer,0,S)}async render(t,r,n){if(this.isInitialized||await this.init(),!this.device||!this.displayPipeline)return null;const a=this.resources.get(t);if(!a||a.busy)return null;a.busy=!0;try{this.updateUniforms(a,r,!1,{stretch:!1,srgb:!0});const i=this.device.createCommandEncoder(),o=i.beginComputePass();o.setPipeline(this.displayPipeline),o.setBindGroup(0,a.bindGroup),o.dispatchWorkgroups(Math.ceil(a.width/16),Math.ceil(a.height/16)),o.end(),i.copyBufferToBuffer(a.outputBuffer,0,a.readBuffer,0,a.width*a.height*4),this.device.queue.submit([i.finish()]),await a.readBuffer.mapAsync(GPUMapMode.READ);const s=new Uint8ClampedArray(a.readBuffer.getMappedRange()),l=new ImageData(new Uint8ClampedArray(s),a.width,a.height);return a.readBuffer.unmap(),l}catch(i){console.error("WebGPU Render Error",i);try{a.readBuffer.unmap()}catch{}return null}finally{a.busy=!1}}async export16Bit(t,r,n,a){if(this.isInitialized||await this.init(),!this.device||!this.exportPipeline)return null;const i=this.resources.get(t);if(!i)return null;const o=i.width*i.height*8,s=this.device.createBuffer({size:o,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),l=this.device.createBuffer({size:o,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),u=this.device.createBindGroup({layout:this.exportPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:i.rawBuffer}},{binding:2,resource:{buffer:s}},{binding:3,resource:{buffer:this.unmixParamsBuffer}},{binding:4,resource:{buffer:this.lutBuffer}}]});this.updateUniforms(i,r,!0,{stretch:n,srgb:a});const d=this.device.createCommandEncoder(),f=d.beginComputePass();f.setPipeline(this.exportPipeline),f.setBindGroup(0,u),f.dispatchWorkgroups(Math.ceil(i.width/16),Math.ceil(i.height/16)),f.end(),d.copyBufferToBuffer(s,0,l,0,o),this.device.queue.submit([d.finish()]),await l.mapAsync(GPUMapMode.READ);const h=new Uint32Array(l.getMappedRange()),p=i.width*i.height,x=new Uint16Array(p*3);for(let g=0;g<p;g++){const b=h[g*2],y=h[g*2+1],m=b&65535,k=b>>>16&65535,S=y&65535;x[g*3]=m,x[g*3+1]=k,x[g*3+2]=S}return l.unmap(),s.destroy(),l.destroy(),x}disposeImage(t){const r=this.resources.get(t);r&&(r.rawBuffer.destroy(),r.outputBuffer.destroy(),r.readBuffer.destroy(),this.resources.delete(t))}disposeAll(){this.resources.forEach(t=>{t.rawBuffer.destroy(),t.outputBuffer.destroy(),t.readBuffer.destroy()}),this.resources.clear()}}const Ya=new Ese,ko=-1,cy=-2,Ise=/\.(arw|cr2|cr3|dng|nef|orf|raf|rw2|pef|srw|sr2|srf|x3f|erf|mef|mos|mrw|kdc|dcr|iiq|3fr|fff|rwl|nrw|raw)$/i,Rse=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Ascii = (2,1); Byte = (1,1)
    Srational = (10,8)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevelRepeatDim = (50713, Type.Short)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 10:
            flat = [item for sublist in value for item in sublist]  # [[num,den]...]
            return struct.pack('<%sl' % len(flat), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def pack_dng_from_u16(raw_u16_bytes_le, width, height, cfa_str, black_level_list, cm_flat, make_str, model_str, unique_model_str):
    raw_data = np.frombuffer(raw_u16_bytes_le, dtype=np.uint16).copy()
    raw_data = raw_data.astype(np.int32)
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    white_level = 65019
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]
    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}

    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]),
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, make_str),
        dngTag(Tag.Model, model_str),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]),
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, unique_model_str),
    ]

    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0]))
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)

    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size

    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC

    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break

    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))

    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12

    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)

    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`;let uy=null;async function Dse(e){return uy||(uy=(async()=>{if(!window.loadPyodide)throw new Error("Pyodide missing: window.loadPyodide not found.");e==null||e("Loading Pyodide...");const t=await window.loadPyodide();return e==null||e("Loading numpy..."),await t.loadPackage("numpy"),e==null||e("Init DNG writer kernel..."),await t.runPythonAsync(Rse),t})()),uy}function at(e,t,r){const n=new Date().toISOString();r?console.log(`[StackDBG][${n}][${e}] ${t}`,r):console.log(`[StackDBG][${n}][${e}] ${t}`)}function xc(e,t){try{const r=performance==null?void 0:performance.memory;if(!r){at(e,`${t} | heap=N/A`);return}at(e,`${t} | heap`,{usedMB:Number(r.usedJSHeapSize||0)/(1024*1024),totalMB:Number(r.totalJSHeapSize||0)/(1024*1024),limitMB:Number(r.jsHeapSizeLimit||0)/(1024*1024)})}catch{}}let ch=null;async function $se(e,t="global"){return at(t,"getOpenCv: enter",{hasCachedPromise:!!ch}),ch||(ch=(async()=>{const r=performance.now();e==null||e("Loading OpenCV.js (html script)..."),at(t,"getOpenCv: html-script mode");const n=o=>{if(!o||typeof o.getBuildInformation!="function")return!1;try{const s=o.getBuildInformation();return typeof s=="string"&&s.length>0}catch{return!1}};let a=window.cv;if(!a){at(t,"getOpenCv: window.cv missing, waiting/injecting script");const o="https://docs.opencv.org/4.x/opencv.js";let s=document.querySelector(`script[src="${o}"]`);s||(s=document.createElement("script"),s.src=o,s.async=!0,s.setAttribute("data-opencv-loader","injected"),document.head.appendChild(s),at(t,"getOpenCv: injected opencv script tag")),await new Promise((l,u)=>{const f=performance.now();let h=0;const p=setInterval(()=>{h+=1,at(t,"getOpenCv: waiting window.cv",{seconds:h,elapsedMs:performance.now()-f,hasWindowCv:!!window.cv})},1e3),x=(k,S)=>{clearInterval(p),k?l():u(S||new Error("OpenCV.js script load failed."))},g=setTimeout(()=>{x(!1,new Error("OpenCV.js script load timeout."))},9e4),b=()=>{window.cv&&(clearTimeout(g),at(t,"getOpenCv: window.cv detected",{elapsedMs:performance.now()-f}),x(!0))};if(b(),window.cv)return;const y=()=>{at(t,"getOpenCv: script onload"),b()},m=()=>{clearTimeout(g),x(!1,new Error("OpenCV.js script onerror."))};s.addEventListener("load",y,{once:!0}),s.addEventListener("error",m,{once:!0})}),a=window.cv}if(!a)throw new Error("OpenCV.js unavailable after script load.");if(n(a)||(at(t,"getOpenCv: waiting onRuntimeInitialized"),await new Promise((o,s)=>{const l=setTimeout(()=>{at(t,"getOpenCv: runtime init timeout"),s(new Error("OpenCV.js runtime init timeout."))},9e4),u=a.onRuntimeInitialized;a.onRuntimeInitialized=()=>{if(clearTimeout(l),at(t,"getOpenCv: onRuntimeInitialized fired",{elapsedMs:performance.now()-r}),typeof u=="function")try{u()}catch{}o()}})),!n(a))throw new Error("OpenCV.js loaded but not ready.");const i=typeof(a==null?void 0:a.then)=="function";return at(t,"getOpenCv: cv readiness details",{hasThen:i}),at(t,"getOpenCv: ready",{elapsedMs:performance.now()-r}),{cv:a}})()),at(t,"getOpenCv: return cached Promise"),ch}const Ut=(e,t,r)=>e<t?t:e>r?r:e,Lse=e=>Ut(e,0,1),Pu=e=>{const t=String(e||"RGGB").toUpperCase();return t.length>=4?t.slice(0,4):"RGGB"},Cu=(e,t,r)=>{const n=(r&1)<<1|t&1;return e[n]||"G"};function Nr(e){if(!(!e||typeof e.delete!="function"))try{e.delete()}catch(t){if(!String(t??"").includes("already deleted"))throw t}}function uh(e,t){if(typeof e=="number"){if(t&&typeof t.exceptionFromPtr=="function")try{const r=t.exceptionFromPtr(e),n=[];if(typeof(r==null?void 0:r.code)<"u"&&n.push(`code=${r.code}`),r!=null&&r.msg&&n.push(`msg=${r.msg}`),r!=null&&r.func&&n.push(`func=${r.func}`),r!=null&&r.file&&n.push(`file=${r.file}`),typeof(r==null?void 0:r.line)<"u"&&n.push(`line=${r.line}`),Nr(r),n.length>0)return`OpenCV(=${e}): ${n.join(", ")}`}catch{}return`OpenCV/WASM: ${e}`}if(e&&typeof e=="object"){const r=[];if(e.name&&r.push(String(e.name)),e.message&&r.push(String(e.message)),typeof e.stack=="string"&&e.stack.length>0){const n=e.stack.split(`
`)[0];n&&!r.includes(n)&&r.push(n)}if(r.length>0)return r.join(" | ")}return String(e)}function Fse(e,t=31,r=!0){if(!Number.isFinite(e)||e<0||e===0)return r?0:1;let n=Math.round(e);return n&1||(n+=1),n=Math.max(1,Math.min(t,n)),n}function Bse(e,t){return t==="translation"?e.MOTION_TRANSLATION:t==="euclidean"?e.MOTION_EUCLIDEAN:t==="homography"?e.MOTION_HOMOGRAPHY:e.MOTION_AFFINE}function Gse(e,t,r){if(!Number.isFinite(r)||r<=0||r>=1)return;const n=(e==null?void 0:e.data32F)||(e==null?void 0:e.data64F)||null;n&&(t==="homography"?(n[2]/=r,n[5]/=r,n[6]*=r,n[7]*=r):(n[2]/=r,n[5]/=r))}function Use(e,t){const r=(e==null?void 0:e.data32F)||(e==null?void 0:e.data64F)||null;if(!r)throw new Error("ECC warp matrix has no numeric data.");const n=t==="homography"?9:6,a=new Float64Array(n);for(let i=0;i<n;i++)a[i]=Number(r[i]??(i%4===0?1:0));return t==="homography"&&Math.abs(a[8])<1e-12&&(a[8]=1),{motionModel:t,coeffs:a}}function Yb(e,t,r){const n=e.coeffs;if(e.motionModel==="homography"){const o=n[6]*t+n[7]*r+n[8];if(!Number.isFinite(o)||Math.abs(o)<1e-9)return{sx:0,sy:0,valid:!1};const s=(n[0]*t+n[1]*r+n[2])/o,l=(n[3]*t+n[4]*r+n[5])/o;return{sx:s,sy:l,valid:Number.isFinite(s)&&Number.isFinite(l)}}const a=n[0]*t+n[1]*r+n[2],i=n[3]*t+n[4]*r+n[5];return{sx:a,sy:i,valid:Number.isFinite(a)&&Number.isFinite(i)}}function zse(e,t,r){const n=[[0,0],[t-1,0],[0,r-1],[t-1,r-1],[.5*(t-1),.5*(r-1)]];let a=0,i=0,o=0;for(const[s,l]of n){const u=Yb(e,s,l);u.valid&&(a+=u.sx-s,i+=u.sy-l,o++)}return o<=0?{dx:0,dy:0}:{dx:a/o,dy:i/o}}function p4(e,t){const r=Math.min(e.length,t.length);if(r<=0)return 1;const n=Math.max(1,Math.floor(Math.sqrt(r/22e4)));let a=0,i=0;for(let o=0;o<r;o+=n){const s=e[o],l=t[o];!Number.isFinite(s)||!Number.isFinite(l)||(a+=s*l,i+=l*l)}return!Number.isFinite(a)||!Number.isFinite(i)||i<=1e-12?1:Ut(a/i,.25,4)}function Wse(e,t,r,n,a){const i=t*r;if(n&&e.length>=i*3){const u=new Float32Array(i*3),d=new Uint16Array(i),f=a[0]||0,h=a[1]||0,p=a[3]||0;for(let x=0,g=0;x<i;x++,g+=3)u[g]=e[g]-f,u[g+1]=e[g+1]-h,u[g+2]=e[g+2]-p,d[x]=e[g+1];return{workF32:u,maskU16:d,channels:3}}const o=new Float32Array(i),s=new Uint16Array(i);let l=0;for(let u=0;u<r;u++){const d=(u&1)<<1;for(let f=0;f<t;f++){const h=d|f&1;o[l]=e[l]-a[h],s[l]=e[l],l++}}return{workF32:o,maskU16:s,channels:1}}function Vse(e,t,r,n){const a=t*r,i=new Uint16Array(a);let o=0;for(let s=0;s<r;s++){const l=(s&1)<<1;for(let u=0;u<t;u++){const d=l|u&1;let f=e[o]+n[d];f<0&&(f=0),f>65535&&(f=65535),i[o]=f+.5|0,o++}}return i}function Hse(e,t){const r=new Float32Array(e.length),n=t[0]||0,a=((t[1]||0)+(t[2]||0))*.5,i=t[3]||0;for(let o=0;o<e.length;o+=3)r[o]=e[o]+n,r[o+1]=e[o+1]+a,r[o+2]=e[o+2]+i;return r}function uO(e,t="global"){const r=performance.now(),{width:n,height:a,channels:i,workF32:o}=e,s=n*a;if(i===3){const f=new Float32Array(s);for(let h=0,p=0;h<s;h++,p+=3)f[h]=o[p+1];return at(t,`makeGuidePlane ${e.key}: done (rgb)`,{elapsedMs:performance.now()-r,width:n,height:a}),f}const l=new Float32Array(s),u=Pu(e.cfaPattern),d=Math.max(1,Math.floor(a/16));for(let f=0;f<a;f++){(f%d===0||f===a-1)&&at(t,`makeGuidePlane ${e.key}: row progress`,{row:f,totalRows:a,elapsedMs:performance.now()-r});for(let h=0;h<n;h++){const p=f*n+h;if(Cu(u,h,f)==="G"){l[p]=o[p];continue}let x=0,g=0;const b=[h-1,h+1,h,h],y=[f,f,f-1,f+1];for(let m=0;m<4;m++){const k=b[m],S=y[m];k<0||S<0||k>=n||S>=a||Cu(u,k,S)==="G"&&(x+=o[S*n+k],g++)}l[p]=g>0?x/g:o[p]}}return at(t,`makeGuidePlane ${e.key}: done (mosaic)`,{elapsedMs:performance.now()-r,width:n,height:a}),l}function Xse(e){if(Cu(e,0,0)==="G")return{parityX:0,parityY:0,exact00:!0};for(let t=0;t<=1;t=t+1)for(let r=0;r<=1;r=r+1)if(Cu(e,r,t)==="G")return{parityX:r,parityY:t,exact00:!1};return{parityX:0,parityY:0,exact00:!1}}function Kse(e,t="global"){const r=performance.now(),{width:n,height:a,channels:i,workF32:o}=e,s=n*a;if(i===3){const h=new Float32Array(s);for(let p=0,x=0;p<s;p++,x+=3)h[p]=o[x+1];return at(t,`makeSingleGreenGuidePlaneFrom00 ${e.key}: done (rgb)`,{elapsedMs:performance.now()-r,width:n,height:a}),{guide:h,parityX:0,parityY:0,exact00:!0}}const l=Pu(e.cfaPattern),u=Xse(l),d=new Float32Array(s),f=Math.max(1,Math.floor(a/16));for(let h=0;h<a;h++){(h%f===0||h===a-1)&&at(t,`makeSingleGreenGuidePlaneFrom00 ${e.key}: row progress`,{row:h,totalRows:a,elapsedMs:performance.now()-r});const p=h*n;for(let x=0;x<n;x++)d[p+x]=Xl(o,n,a,x,h,u.parityX,u.parityY)}return at(t,`makeSingleGreenGuidePlaneFrom00 ${e.key}: done (mosaic)`,{elapsedMs:performance.now()-r,width:n,height:a,cfaPattern:l,parityX:u.parityX,parityY:u.parityY,exact00:u.exact00,cfaAt00:Cu(l,0,0)}),{guide:d,parityX:u.parityX,parityY:u.parityY,exact00:u.exact00}}async function Yse(e,t){if(e.channels!==1||e.isThreePlane||typeof navigator>"u"||!navigator.gpu||!await Ya.init())return null;const n=`stack-guide-amaze-${Date.now()}-${Math.random().toString(36).slice(2)}-${e.key}`;try{await Ya.uploadImage(n,e.origMaskU16,e.width,e.height);const a=await Ya.render(n,{exposure:0,demosaicMethod:-1,blackLevel:[t[0],t[1],t[2],t[3]],wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dep-color",isBGGR:Pu(e.cfaPattern)==="BGGR",zeroDepColorDemosaic:"amaze"},65535);if(!a)return null;const i=e.width*e.height,o=new Float32Array(i),s=a.data;for(let l=0,u=0;l<i;l++,u+=4)o[l]=s[u+1]/255;return o}catch{return null}finally{Ya.hasImage(n)&&Ya.disposeImage(n)}}function dh(e,t,r="global",n="default"){const a=new Map;let i=n==="default";return async o=>{const s=performance.now(),l=a.get(o.key);if(l)return at(r,`guide ${o.key}: cache hit`,{elapsedMs:performance.now()-s}),l;at(r,`guide ${o.key}: cache miss`,{width:o.width,height:o.height,channels:o.channels,gpuGuideAvailable:i});let u=null;if(i&&o.channels===1&&!o.isThreePlane){const d=performance.now();at(r,`guide ${o.key}: trying AMaZE GPU`),u=await Yse(o,e),u?(t==null||t(`Align guide ${o.key}: AMaZE (GPU)`),at(r,`guide ${o.key}: AMaZE GPU success`,{elapsedMs:performance.now()-d})):(at(r,`guide ${o.key}: AMaZE GPU failed, fallback to CPU`,{elapsedMs:performance.now()-d}),i=!1)}if(!u){const d=performance.now();if(n==="singleGreen00"){const f=Kse(o,r);u=f.guide,t==null||t(`Align guide ${o.key}: single-green parity=(${f.parityX},${f.parityY})${f.exact00?" @raw(0,0)":" near raw(0,0)"}`),at(r,`guide ${o.key}: single-green CPU guide generated`,{elapsedMs:performance.now()-d,parityX:f.parityX,parityY:f.parityY,exact00:f.exact00})}else u=uO(o,r),at(r,`guide ${o.key}: CPU guide generated`,{elapsedMs:performance.now()-d})}return a.set(o.key,u),at(r,`guide ${o.key}: ready`,{elapsedMs:performance.now()-s,cacheSize:a.size}),u}}function m4(e,t,r,n,a){const i=new e.Mat(n,r,e.CV_32FC1);i.data32F.set(t);const o=Math.min(1,Math.max(1,a)/Math.max(r,n));if(o>=1)return{mat:i,scale:1};const s=new e.Mat;return e.resize(i,s,new e.Size,o,o,e.INTER_AREA),Nr(i),{mat:s,scale:o}}function Au(e){if(!e)return!0;if(typeof e.empty=="function")try{return!!e.empty()}catch{}const t=Number(e.rows||0),r=Number(e.cols||0);return t<=0||r<=0}function qb(){return[1,0,0,0,1,0,0,0,1]}function dO(e){if(!e||e.length!==9)return null;const t=e[8];if(!Number.isFinite(t)||Math.abs(t)<1e-12)return null;const r=new Array(9);for(let n=0;n<9;n++)r[n]=e[n]/t;return r}function Zb(e){const t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],o=e[5],s=e[6],l=e[7],u=e[8],d=i*u-o*l,f=-(a*u-o*s),h=a*l-i*s,p=-(r*u-n*l),x=t*u-n*s,g=-(t*l-r*s),b=r*o-n*i,y=-(t*o-n*a),m=t*i-r*a,k=t*d+r*f+n*h;if(!Number.isFinite(k)||Math.abs(k)<1e-12)return null;const S=1/k;return[d*S,p*S,b*S,f*S,x*S,y*S,h*S,g*S,m*S]}function g4(e,t,r){const n=e[6]*t+e[7]*r+e[8];if(!Number.isFinite(n)||Math.abs(n)<1e-9)return null;const a=1/n;return{x:(e[0]*t+e[1]*r+e[2])*a,y:(e[3]*t+e[4]*r+e[5])*a}}function qse(e,t){if(e.ORB&&typeof e.ORB.create=="function")return e.ORB.create(t);const r=new e.ORB;return typeof r.setMaxFeatures=="function"&&r.setMaxFeatures(t),r}function fO(e,t,r){const n=qse(e,r),a=new e.KeyPointVector,i=new e.Mat,o=new e.Mat;try{n.detectAndCompute(t,o,a,i,!1)}finally{Nr(o),Nr(n)}return{keypoints:a,descriptors:i}}function x4(e,t,r,n){const a=e.BFMatcher&&typeof e.BFMatcher.create=="function"?e.BFMatcher.create(e.NORM_HAMMING,!1):new e.BFMatcher(e.NORM_HAMMING,!1),i=new e.DMatchVectorVector,o=new Map;let s=0;try{a.knnMatch(t,r,i,2),s=i.size();for(let l=0;l<s;l+=1){const u=i.get(l);try{if(u.size()<2)continue;const d=u.get(0),f=u.get(1);try{d.distance<n*f.distance&&o.set(d.queryIdx,{trainIdx:d.trainIdx,distance:d.distance})}finally{Nr(d),Nr(f)}}finally{Nr(u)}}}finally{Nr(i),Nr(a)}return{map:o,total:s}}function Zse(e,t,r,n,a,i,o,s){const l=x4(e,r,a,i),u=x4(e,a,r,i),d=[],f=[],h=[];for(const[p,x]of l.map.entries()){const g=u.map.get(x.trainIdx);if(!g||g.trainIdx!==p)continue;const b=t.get(p),y=n.get(x.trainIdx);try{f.push({x:b.pt.x*o,y:b.pt.y*s}),d.push({x:y.pt.x*o,y:y.pt.y*s}),h.push(x.distance)}finally{Nr(b),Nr(y)}}return{srcPts:d,dstPts:f,total:l.total,good:d.length,mutual:d.length,forward:l.map.size,backward:u.map.size,avgDistance:h.length>0?h.reduce((p,x)=>p+x,0)/h.length:0}}function Jse(e,t,r){if(t.length<4||r.length<4)return{H:qb(),inliers:0,inlierSrcPts:[],inlierDstPts:[]};const n=Math.min(t.length,r.length),a=new Float32Array(n*2),i=new Float32Array(n*2);for(let d=0;d<n;d++)a[d*2]=t[d].x,a[d*2+1]=t[d].y,i[d*2]=r[d].x,i[d*2+1]=r[d].y;let o=null,s=null,l=null,u=null;try{o=e.matFromArray(n,1,e.CV_32FC2,a),s=e.matFromArray(n,1,e.CV_32FC2,i),l=new e.Mat,u=e.findHomography(o,s,e.RANSAC,3,l);let d=qb();if(u&&!Au(u)){const x=(u.data64F?Array.from(u.data64F.slice(0,9)):Array.from(u.data32F.slice(0,9))).map(b=>Number(b)),g=dO(x);g&&(d=g)}const f=[],h=[],p=l&&l.data?l.data:null;if(p&&p.length>=n)for(let x=0;x<n;x++)p[x]&&(f.push(t[x]),h.push(r[x]));return{H:d,inliers:f.length,inlierSrcPts:f,inlierDstPts:h}}finally{Nr(o),Nr(s),Nr(l),Nr(u)}}function Qse(e,t,r,n){const a=t.length;if(a<4||r.length!==a||n.length!==a)return null;const i=[];for(let h=0;h<a;h++)i.push({i:h,w:n[h]});i.sort((h,p)=>p.w-h.w);const o=Math.min(a,Math.max(12,Math.min(96,a))),s=new Float32Array(o*2),l=new Float32Array(o*2);for(let h=0;h<o;h++){const p=i[h].i;s[h*2]=t[p].x,s[h*2+1]=t[p].y,l[h*2]=r[p].x,l[h*2+1]=r[p].y}let u=null,d=null,f=null;try{if(u=e.matFromArray(o,1,e.CV_32FC2,s),d=e.matFromArray(o,1,e.CV_32FC2,l),f=e.findHomography(u,d,e.RANSAC,2.5),(!f||Au(f))&&(Nr(f),f=e.findHomography(u,d,0,3)),!f||Au(f))return null;const h=(f.data64F?Array.from(f.data64F.slice(0,9)):Array.from(f.data32F.slice(0,9))).map(p=>Number(p));return dO(h)}finally{Nr(u),Nr(d),Nr(f)}}function ele(e,t,r,n,a,i,o,s){if(t.length<4||r.length<4)return{H:s,confidence:0};const l=Math.max(1,i*i),u=[];for(let S=0;S<r.length;S++){const w=r[S].x-n,v=r[S].y-a,M=Math.exp(-(w*w+v*v)/(2*l));M>1e-6&&u.push({i:S,w:M})}if(u.length<4)return{H:s,confidence:0};u.sort((S,w)=>w.w-S.w);const d=u.slice(0,Math.max(4,Math.min(u.length,o)));if(d.length<4)return{H:s,confidence:0};const f=[],h=[],p=[];let x=0,g=0;for(const S of d)f.push(t[S.i]),h.push(r[S.i]),p.push(S.w),x+=S.w,S.w>g&&(g=S.w);const b=Qse(e,f,h,p),y=Math.min(1,d.length/Math.max(8,o)),m=x/Math.max(1,d.length),k=Math.max(0,Math.min(1,y*(.5*m+.5*g)));return!b||!Zb(b)?{H:s,confidence:0}:{H:b,confidence:k}}function y4(e,t){const r=[0],n=Math.max(16,Math.floor(t));for(let a=n;a<e-1;a+=n)r.push(a);return r[r.length-1]!==e-1&&r.push(e-1),r}function tle(e,t,r,n,a,i,o){const s=r.length,l=n.length;for(let u=0;u<l-1;u++){const d=n[u],f=n[u+1],h=u===l-2?f:f-1,p=Math.max(1,f-d);for(let x=0;x<s-1;x++){const g=r[x],b=r[x+1],y=x===s-2?b:b-1,m=Math.max(1,b-g),k=u*s+x,S=k+1,w=(u+1)*s+x,v=w+1,M=a[k],N=i[k],_=a[S],P=i[S],E=a[w],R=i[w],T=a[v],G=i[v];for(let L=d;L<=h;L++){const C=(L-d)/p,$=L*o;for(let A=g;A<=y;A++){const O=(A-g)/m,F=M+(_-M)*O,D=N+(P-N)*O,W=E+(T-E)*O,H=R+(G-R)*O;e[$+A]=F+(W-F)*C,t[$+A]=D+(H-D)*C}}}}}function hO(e,t,r,n,a){let i=null,o=null,s=null;try{i=new e.Mat(n,r,e.CV_32FC1),i.data32F.set(t);const l=Math.min(1,Math.max(1,a)/Math.max(r,n));return l<1?(o=new e.Mat,e.resize(i,o,new e.Size,l,l,e.INTER_AREA)):(o=i,i=null),s=new e.Mat,e.normalize(o,s,0,255,e.NORM_MINMAX,e.CV_8U),{mat:s,scale:l}}finally{Nr(i),Nr(o)}}function rle(e,t,r,n,a,i,o){let s=null,l=null,u=null,d=null;try{s=hO(e,r,n,a,o.featMaxDim).mat,(s.cols!==i.featWidth||s.rows!==i.featHeight)&&(l=new e.Mat,e.resize(s,l,new e.Size(i.featWidth,i.featHeight),0,0,e.INTER_AREA));const h=fO(e,l||s,o.maxFeatures);if(u=h.keypoints,d=h.descriptors,Au(i.descriptors)||Au(d))throw new Error("APAP ORB descriptors empty.");const p=n/i.featWidth,x=a/i.featHeight,g=Zse(e,i.keypoints,i.descriptors,u,d,o.matchRatio,p,x);if(g.good<8)throw new Error(`APAP matches insufficient: ${g.good}`);const b=Jse(e,g.srcPts,g.dstPts),y=b.inlierSrcPts.length>=8?b.inlierSrcPts:g.srcPts,m=b.inlierDstPts.length>=8?b.inlierDstPts:g.dstPts,k=Zb(b.H)||qb(),S=y4(n,o.gridStep),w=y4(a,o.gridStep),v=S.length,M=w.length,N=new Float32Array(v*M),_=new Float32Array(v*M);for(let R=0;R<M;R++)for(let T=0;T<v;T++){const G=S[T],L=w[R],C=ele(e,y,m,G,L,o.sigma,o.localMaxPoints,b.H),$=Zb(C.H),A=g4(k,G,L)||{x:G,y:L},O=$&&g4($,G,L)||A,F=.2+.8*C.confidence,D={x:A.x*(1-F)+O.x*F,y:A.y*(1-F)+O.y*F},W=R*v+T;N[W]=D.x,_[W]=D.y}const P=new Float32Array(n*a),E=new Float32Array(n*a);return tle(P,E,S,w,N,_,n),{mapX:P,mapY:E,totalMatches:g.total,goodMatches:g.good,mutualMatches:g.mutual,forwardMatches:g.forward,backwardMatches:g.backward,avgDistance:g.avgDistance,inliers:b.inliers,gridCells:(v-1)*(M-1)}}finally{Nr(s),Nr(l),Nr(u),Nr(d)}}function nle(e,t,r,n,a=1,i){const{width:o,height:s,channels:l}=e,u=o*s;if(t.length!==u||r.length!==u)throw new Error(`APAP map size mismatch: expected ${u}, got ${t.length}/${r.length}`);const d=new Float32Array(u*l),f=new Uint16Array(u),h=n.width===o&&n.height===s&&n.channels===l,p=h?n.workF32:e.workF32,x=h?n.origMaskU16:e.origMaskU16,g=Number.isFinite(a)?Ut(a,.25,4):1;let b=0,y=0,m=0;const k=(i==null?void 0:i.tag)||"global",S=(i==null?void 0:i.frameKey)||e.key,w=Math.max(1,i==null?void 0:i.logEveryRows),v=performance.now();if(at(k,`warpSlotDataWithApapMaps ${S}: start`,{width:o,height:s,channels:l,logEveryRows:w}),l===3)for(let _=0;_<s;_++){(_%w===0||_===s-1)&&at(k,`warpSlotDataWithApapMaps ${S}: row progress`,{row:_,totalRows:s,elapsedMs:performance.now()-v});const P=_*o;for(let E=0;E<o;E++){const R=P+E,T=t[R],G=r[R],L=R*3;if(Ng(T,G,o,s)){b++,y+=T-E,m+=G-_,d[L]=Ra(e.workF32,o,s,3,T,G,0)*g,d[L+1]=Ra(e.workF32,o,s,3,T,G,1)*g,d[L+2]=Ra(e.workF32,o,s,3,T,G,2)*g;const $=Ra(e.origMaskU16,o,s,1,T,G,0);f[R]=Ut(Math.round($),0,65535)}else d[L]=p[L],d[L+1]=p[L+1],d[L+2]=p[L+2],f[R]=x[R]}}else for(let _=0;_<s;_++){(_%w===0||_===s-1)&&at(k,`warpSlotDataWithApapMaps ${S}: row progress`,{row:_,totalRows:s,elapsedMs:performance.now()-v});const P=_*o;for(let E=0;E<o;E++){const R=P+E,T=t[R],G=r[R],L=E&1,C=_&1;if(_g(T,G,o,s,L,C)){b++,y+=T-E,m+=G-_,d[R]=Xl(e.workF32,o,s,T,G,L,C)*g;const A=Xl(e.origMaskU16,o,s,T,G,L,C);f[R]=Ut(Math.round(A),0,65535)}else d[R]=p[R],f[R]=x[R]}}e.workF32=d,e.origMaskU16=f;const M=b>0?y/b:0,N=b>0?m/b:0;return at(k,`warpSlotDataWithApapMaps ${S}: done`,{elapsedMs:performance.now()-v,validRatio:u>0?b/u:0,meanDx:M,meanDy:N}),{validRatio:u>0?b/u:0,meanDx:M,meanDy:N}}function b4(e,t){if(t<=1)return 0;let r=e;for(;r<0||r>=t;)r=r<0?-r-1:2*t-1-r;return r}function ale(e){const t=Math.max(.001,e),r=Math.max(1,Math.ceil(3*t)),n=new Float32Array(r*2+1);let a=0;for(let i=-r;i<=r;i++){const o=Math.exp(-(i*i)/(2*t*t));n[i+r]=o,a+=o}if(a>0)for(let i=0;i<n.length;i++)n[i]/=a;return n}function pO(e,t,r,n){const a=ale(n),i=a.length-1>>1,o=new Float32Array(t*r),s=new Float32Array(t*r);for(let l=0;l<r;l++){const u=l*t;for(let d=0;d<t;d++){let f=0;for(let h=-i;h<=i;h++){const p=b4(d+h,t);f+=e[u+p]*a[h+i]}o[u+d]=f}}for(let l=0;l<r;l++)for(let u=0;u<t;u++){let d=0;for(let f=-i;f<=i;f++){const h=b4(l+f,r);d+=o[h*t+u]*a[f+i]}s[l*t+u]=d}return s}function ile(e,t,r,n){if(n<=1)return{data:e,w:t,h:r};const a=pO(e,t,r,n*.5),i=Math.max(1,Math.floor(t/n)),o=Math.max(1,Math.floor(r/n)),s=new Float32Array(i*o);for(let l=0;l<o;l++){const d=l*n*t;for(let f=0;f<i;f++)s[l*i+f]=a[d+f*n]}return{data:s,w:i,h:o}}const qa={factors:[1,2,4,4],tileSizes:[16,16,16,8],searchRadii:[1,4,4,4],metrics:["L1","L2","L2","L2"],subpixels:[!1,!1,!1,!1],icaIter:3,icaSigmaBlur:0,robustnessMotionThreshold:20,robustnessConfFloor:.65,confidenceBlendStrength:0};function ole(e,t,r,n=0){const a=n>1e-6?pO(e,t,r,n):e,i=new Float32Array(t*r),o=new Float32Array(t*r);for(let s=0;s<r;s++){const l=s>0?s-1:s,u=s+1<r?s+1:s;for(let d=0;d<t;d++){const f=d>0?d-1:d,h=d+1<t?d+1:d,p=s*t+d;i[p]=.5*(a[s*t+h]-a[s*t+f]),o[p]=.5*(a[u*t+d]-a[l*t+d])}}return{gx:i,gy:o}}function dy(e,t,r,n,a,i,o,s,l){let u=0;for(let d=0;d<o;d++){const h=(i+d)*r+a;for(let p=0;p<o;p++){const x=e[h+p],g=a+p+s,b=i+d+l,y=Ra(t,r,n,1,g,b,0),m=x-y;u+=m*m}}return u}function sle(e,t,r,n,a,i,o,s,l,u,d,f){let h=0,p=0,x=0;for(let v=0;v<l;v++){const M=(s+v)*a+o;for(let N=0;N<l;N++){const _=M+N,P=r[_],E=n[_];h+=P*P,p+=P*E,x+=E*E}}h+=1e-6,x+=1e-6;const g=h*x-p*p;if(!Number.isFinite(g)||Math.abs(g)<1e-9)return{dx:u,dy:d};const b=x/g,y=-p/g,m=h/g;let k=u,S=d,w=dy(e,t,a,i,o,s,l,k,S);for(let v=0;v<f;v++){let M=0,N=0;for(let A=0;A<l;A++){const O=(s+A)*a+o;for(let F=0;F<l;F++){const D=O+F,W=e[D],Y=Ra(t,a,i,1,o+F+k,s+A+S,0)-W,te=r[D],U=n[D];M+=te*Y,N+=U*Y}}let _=b*M+y*N,P=y*M+m*N;const E=Math.hypot(_,P);if(!Number.isFinite(E)||E<1e-5)break;if(E>1){const A=1/E;_*=A,P*=A}const R=k-_,T=S-P,G=dy(e,t,a,i,o,s,l,R,T);if(G<=w){k=R,S=T,w=G;continue}const L=k-.5*_,C=S-.5*P,$=dy(e,t,a,i,o,s,l,L,C);if($<=w){k=L,S=C,w=$;continue}break}return{dx:k,dy:S}}function fm(e,t,r){const n=qa.factors,a=[{data:e,w:t,h:r,scale:1}];let i=a[0];for(let o=1;o<n.length;o++){const s=n[o];i={...ile(i.data,i.w,i.h,s),scale:i.scale*s},a.push(i)}return a.reverse()}function mO(e){const t=[.25,-.5,.25,.5,-1,.5,.25,-.5,.25],r=[.25,.5,.25,-.5,-1,-.5,.25,.5,.25],n=[.25,0,-.25,0,0,0,-.25,0,.25],a=[-.125,0,.125,-.25,0,.25,-.125,0,.125],i=[-.125,-.25,-.125,0,0,0,.125,.25,.125];let o=0,s=0,l=0,u=0,d=0;for(let g=0;g<9;g++){const b=e[g];o+=t[g]*b,s+=n[g]*b,l+=r[g]*b,u+=a[g]*b,d+=i[g]*b}o=Math.max(0,o),l=Math.max(0,l),o*l-s*s<0&&(s=0);const f=o*l-s*s;if(Math.abs(f)<1e-12)return{dx:0,dy:0};const h=-(o*d-s*u)/f,p=-(l*u-s*d)/f;return Math.hypot(p,h)>=1?{dx:0,dy:0}:{dx:p,dy:h}}function qd(e,t,r,n,a,i,o,s,l,u,d="invalid",f=65535){let h=a+s,p=i+l;if(d==="clip")h=Ut(h,0,Math.max(0,r-o)),p=Ut(p,0,Math.max(0,n-o));else if(d==="invalid"&&(h<0||p<0||h+o>r||p+o>n))return Number.POSITIVE_INFINITY;const x=Math.trunc(h),g=Math.trunc(p);let b=0;for(let y=0;y<o;y++){const k=(i+y)*r+a,S=g+y;for(let w=0;w<o;w++){const v=e[k+w],M=x+w;let N;S>=0&&S<n&&M>=0&&M<r?N=t[S*r+M]:N=d==="pad"?f:0;const _=v-N;b+=u?Math.abs(_):_*_}}return b}function lle(e){const t=Math.floor(e.vec.length/2);if(t<=0)return{dx:0,dy:0,mag:0};let r=0,n=0,a=0;for(let i=0;i<e.vec.length;i+=2){const o=e.vec[i],s=e.vec[i+1];r+=s,n+=o,a+=Math.hypot(s,o)}return{dx:r/t,dy:n/t,mag:a/t}}function gw(e,t,r){const n=Math.max(1,Math.floor(r*.5)),a=Math.max(0,Math.floor((t-r)/n)+1);return{gw:Math.max(0,Math.floor((e-r)/n)+1),gh:a,step:n}}function fy(e,t,r,n,a){const i=Ut(n,0,Math.max(0,r-1)),o=Ut(a,0,Math.max(0,t-1)),s=(i*t+o)*2;return{dy:e[s],dx:e[s+1]}}function cle(e,t,r,n,a,i){const o=gw(t.w,t.h,a);if(o.gw<=0||o.gh<=0)return new Float32Array(0);const s=e.gw,l=e.gh;if(s<=0||l<=0||i<=0)return new Float32Array(o.gw*o.gh*2);const u=new Float32Array(e.vectors.length);for(let v=0;v<e.vectors.length;v++)u[v]=e.vectors[v]*n;const d=Math.max(1,Math.floor(a/i)),f=Math.max(1,Math.floor(n/d)),h=s*f,p=l*f,x=new Float32Array(h*p*2);for(let v=0;v<p;v++){const M=Math.floor(v/f);for(let N=0;N<h;N++){const _=Math.floor(N/f),P=(M*s+_)*2,E=(v*h+N)*2;x[E]=u[P],x[E+1]=u[P+1]}}const g=s+2,b=l+2,y=new Float32Array(g*b*2);for(let v=0;v<b;v++){const M=Ut(v-1,0,l-1);for(let N=0;N<g;N++){const _=Ut(N-1,0,s-1),P=(M*s+_)*2,E=(v*g+N)*2;y[E]=u[P],y[E+1]=u[P+1]}}const m=new Float32Array(o.gw*o.gh*2),k=Math.min(o.gh,p),S=Math.min(o.gw,h),w=o.step;for(let v=0;v<k;v++)for(let M=0;M<S;M++){const N=(v*o.gw+M)*2,_=v%f,P=M%f,E=_<f*.5,R=P<f*.5,T=Math.floor(v/f),G=Math.floor(M/f),L=fy(x,h,p,v,M),C=Ut(2+T+(E?-1:1),0,b-1),$=Ut(2+G,0,g-1),A=Ut(2+T,0,b-1),O=Ut(2+G+(R?-1:1),0,g-1),F=fy(y,g,b,C,$),D=fy(y,g,b,A,O),W=v*w,H=M*w,Y=qd(t.data,r.data,t.w,t.h,H,W,a,Math.round(L.dx),Math.round(L.dy),!0,"clip"),te=qd(t.data,r.data,t.w,t.h,H,W,a,Math.round(F.dx),Math.round(F.dy),!0,"clip"),U=qd(t.data,r.data,t.w,t.h,H,W,a,Math.round(D.dx),Math.round(D.dy),!0,"clip");te<Y&&te<=U?(m[N]=F.dy,m[N+1]=F.dx):U<Y&&U<te?(m[N]=D.dy,m[N+1]=D.dx):(m[N]=L.dy,m[N+1]=L.dx)}return m}function ule(e,t,r,n,a,i,o,s,l){const u=gw(e.w,e.h,n),{gw:d,gh:f,step:h}=u,p=new Float32Array(d*f*2);if(d<=0||f<=0)return{vectors:p,gw:d,gh:f,tileSize:n};let x=new Float32Array(d*f*2);l&&a&&(x=cle(l,e,t,r,n,a));const g=2*i+1,b=o==="L1",y=new Float64Array(g*g);for(let m=0;m<f;m++)for(let k=0;k<d;k++){const S=(m*d+k)*2,w=Math.round(x[S]),v=Math.round(x[S+1]),M=m*h,N=k*h;let _=0,P=Number.POSITIVE_INFINITY,E=0;for(let C=-i;C<=i;C++)for(let $=-i;$<=i;$++,E++){const A=w+C,O=v+$,F=qd(e.data,t.data,e.w,e.h,N,M,n,O,A,b,"pad");y[E]=F,F<P&&(P=F,_=E)}const R=Math.floor(_/g),T=_-R*g;let G=w+(R-i),L=v+(T-i);if(s&&T>0&&T<g-1&&R>0&&R<g-1){const C=[y[(R-1)*g+(T-1)],y[(R-1)*g+T],y[(R-1)*g+(T+1)],y[R*g+(T-1)],y[R*g+T],y[R*g+(T+1)],y[(R+1)*g+(T-1)],y[(R+1)*g+T],y[(R+1)*g+(T+1)]],$=mO(C);G+=$.dy,L+=$.dx}p[S]=G,p[S+1]=L}return{vectors:p,gw:d,gh:f,tileSize:n}}function dle(e,t,r,n,a){const i=[16,16,16,8],o=[1,4,4,4],s=["L1","L2","L2","L2"],l=[!1,!0,!0,!0],u=a==="bayer";let d=e,f=t,h=r,p=n,x=1,g=1;if(u){const S=hm(e,r,n),w=hm(t,r,n);d=S.data,f=w.data,h=S.w,p=S.h,x=2,g=2}const b=fm(d,h,p),y=fm(f,h,p);let m=null,k=0;for(let S=0;S<b.length;S++){const w=b[S],v=y[S],M=i.length-1-S,N=i[M],_=o[M],P=s[M],E=l[M],R=m?Math.max(1,Math.round(k/w.scale)):1;m=ule(w,v,R,N,m?m.tileSize:null,_,P,E,m),k=w.scale}if(!m||m.vectors.length===0)return{vec:new Float32Array(0),w:0,h:0,tileSize:u?32:16};if(x!==1)for(let S=0;S<m.vectors.length;S++)m.vectors[S]*=x;return{vec:m.vectors,w:m.gw,h:m.gh,tileSize:m.tileSize*g}}function fle(e,t,r){const n=e.channels,a=e.width,i=e.height,o=new Float32Array(a*i*n),s=new Float32Array(a*i),l=new Uint16Array(a*i),u=new Float32Array(a*i),d=gw(a,i,r),f=Math.max(0,i-r),h=Math.max(0,a-r);for(let p=0;p<d.gh;p++){const x=p*d.step;for(let g=0;g<d.gw;g++){const b=g*d.step;let y=x,m=b;if(p<t.h&&g<t.w){const k=(p*t.w+g)*2;let S=t.vec[k],w=t.vec[k+1];n===1?(S=Math.round(S*.5)*2,w=Math.round(w*.5)*2):(S=Math.round(S),w=Math.round(w)),y=Ut(x+S,0,f),m=Ut(b+w,0,h)}for(let k=0;k<r;k++){const S=(y+k)*a+m,w=(x+k)*a+b;for(let v=0;v<r;v++){const M=w+v,N=S+v;for(let _=0;_<n;_++)o[M*n+_]+=e.workF32[N*n+_];s[M]+=e.origMaskU16[N],u[M]+=1}}}}for(let p=0;p<u.length;p++)if(u[p]>0){const x=1/u[p];for(let g=0;g<n;g++)o[p*n+g]*=x;l[p]=Ut(Math.round(s[p]*x),0,65535)}else{for(let x=0;x<n;x++)o[p*n+x]=e.workF32[p*n+x];l[p]=e.origMaskU16[p]}e.workF32=o,e.origMaskU16=l}function gO(e,t,r){const n=Math.max(1,r),a=Math.max(0,Math.floor(t/n));return{gw:Math.max(0,Math.floor(e/n)),gh:a,step:n}}function hle(e,t,r,n,a,i){const o=gO(t.w,t.h,a);if(o.gw<=0||o.gh<=0)return new Float32Array(0);const s=e.gw,l=e.gh;if(s<=0||l<=0||i<=0)return new Float32Array(o.gw*o.gh*2);const u=new Float32Array(e.vectors.length);for(let p=0;p<e.vectors.length;p++)u[p]=e.vectors[p]*n;const d=Math.max(1,Math.floor(a/i)),f=Math.max(1,Math.floor(n/d)),h=new Float32Array(o.gw*o.gh*2);for(let p=0;p<o.gh;p++){const x=Math.floor(p/f);if(!(x<0||x>=l))for(let g=0;g<o.gw;g++){const b=Math.floor(g/f);if(b<0||b>=s)continue;const y=(x*s+b)*2,m=(p*o.gw+g)*2;h[m]=u[y],h[m+1]=u[y+1]}}return h}function ple(e,t,r,n,a,i,o,s,l,u,d,f){const h=gO(e.w,e.h,n),{gw:p,gh:x,step:g}=h,b=new Float32Array(p*x*2);if(p<=0||x<=0)return{vectors:b,gw:p,gh:x,tileSize:n};let y=new Float32Array(p*x*2);l&&a&&(y=hle(l,e,t,r,n,a));const m=2*i+1,k=o==="L1",S="invalid",w=new Float64Array(m*m),v=!!u&&!!d;for(let M=0;M<x;M++)for(let N=0;N<p;N++){const _=(M*p+N)*2,P=Math.round(y[_]),E=Math.round(y[_+1]),R=M*g,T=N*g;let G=0,L=Number.POSITIVE_INFINITY,C=0;for(let D=-i;D<=i;D++)for(let W=-i;W<=i;W++,C++){const H=P+D,Y=E+W,te=qd(e.data,t.data,e.w,e.h,T,R,n,Y,H,k,S,0);w[C]=te,te<L&&(L=te,G=C)}if(!Number.isFinite(L)){b[_]=y[_],b[_+1]=y[_+1];continue}const $=Math.floor(G/m),A=G-$*m;let O=P+($-i),F=E+(A-i);if(s&&A>0&&A<m-1&&$>0&&$<m-1){const D=[w[($-1)*m+(A-1)],w[($-1)*m+A],w[($-1)*m+(A+1)],w[$*m+(A-1)],w[$*m+A],w[$*m+(A+1)],w[($+1)*m+(A-1)],w[($+1)*m+A],w[($+1)*m+(A+1)]],W=mO(D);O+=W.dy,F+=W.dx}if(v){const D=sle(e.data,t.data,u,d,e.w,e.h,T,R,n,F,O,f);F=D.dx,O=D.dy}b[_]=O,b[_+1]=F}return{vectors:b,gw:p,gh:x,tileSize:n}}function hm(e,t,r){const n=Math.max(1,Math.floor(t*.5)),a=Math.max(1,Math.floor(r*.5)),i=new Float32Array(n*a);for(let o=0;o<a;o++)for(let s=0;s<n;s++){const l=s*2,u=o*2,d=u*t+l,f=u*t+Math.min(t-1,l+1),h=Math.min(r-1,u+1)*t+l,p=Math.min(r-1,u+1)*t+Math.min(t-1,l+1);i[o*n+s]=.25*(e[d]+e[f]+e[h]+e[p])}return{data:i,w:n,h:a}}function mle(e,t,r){const n=new Float32Array(t*r),a=new Float32Array(t*r);if(e.gw<=0||e.gh<=0)return{flowX:n,flowY:a};const i=Math.max(1,e.tileSize);for(let o=0;o<r;o++){const s=Ut(Math.floor(o/i),0,e.gh-1);for(let l=0;l<t;l++){const u=Ut(Math.floor(l/i),0,e.gw-1),d=(s*e.gw+u)*2,f=o*t+l;n[f]=e.vectors[d+1],a[f]=e.vectors[d]}}return{flowX:n,flowY:a}}function gle(e,t){const{gw:r,gh:n,vectors:a}=e,i=new Float32Array(r*n);if(r<=0||n<=0)return i;const o=Math.max(1e-6,t),s=Ut(qa.robustnessConfFloor,0,1);for(let l=0;l<n;l++)for(let u=0;u<r;u++){let d=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;for(let b=-1;b<=1;b++){const y=Ut(l+b,0,n-1);for(let m=-1;m<=1;m++){const k=Ut(u+m,0,r-1),S=(y*r+k)*2,w=a[S],v=a[S+1];v<d&&(d=v),v>h&&(h=v),w<f&&(f=w),w>p&&(p=w)}}const x=Math.hypot(h-d,p-f),g=l*r+u;if(x<=o)i[g]=1;else{const b=(x-o)/(o*.8),y=Math.exp(-.5*b*b);i[g]=Math.max(s,y)}}return i}function xle(e,t,r,n){return e}function yle(e,t,r,n,a,i){const o=new Float32Array(a*i);if(t<=0||r<=0)return o;const s=Math.max(1,n);for(let l=0;l<i;l++){const u=Ut(Math.floor(l/s),0,r-1);for(let d=0;d<a;d++){const f=Ut(Math.floor(d/s),0,t-1);o[l*a+d]=e[u*t+f]}}return o}function ble(e,t,r,n){const{width:a,height:i,channels:o}=e,s=a*i;if(s<=0)return{validRatio:0,oobRatio:0,meanConfOnValid:0,effectiveRatio:0,strongRatio:0};let l=0,u=0,d=0,f=0,h=0;for(let m=0;m<i;m++){const k=m*a;for(let S=0;S<a;S++){const w=k+S,v=S+t[w],M=m+r[w];if(!(o===1?_g(v,M,a,i,S&1,m&1):Ng(v,M,a,i))){u++;continue}l++;const _=n?Ut(n[w],0,1):1,P=Ut(qa.confidenceBlendStrength,0,1),E=1-P+P*_;d+=_,f+=E,E>=.5&&h++}}const p=l/s,x=u/s,g=l>0?d/l:0,b=f/s,y=h/s;return{validRatio:p,oobRatio:x,meanConfOnValid:g,effectiveRatio:b,strongRatio:y}}function vle(e,t,r,n,a=null){const{width:i,height:o,channels:s}=e,l=i*o,u=new Float32Array(l*s),d=new Uint16Array(l),f=n.width===i&&n.height===o&&n.channels===s,h=f?n.workF32:e.workF32,p=f?n.origMaskU16:e.origMaskU16;if(s===3)for(let x=0;x<o;x++){const g=x*i;for(let b=0;b<i;b++){const y=g+b,m=b+t[y],k=x+r[y],S=y*3;if(Ng(m,k,i,o)){const v=a?Ut(a[y],0,1):1,M=Ut(qa.confidenceBlendStrength,0,1),N=1-M+M*v,_=Ra(e.workF32,i,o,3,m,k,0),P=Ra(e.workF32,i,o,3,m,k,1),E=Ra(e.workF32,i,o,3,m,k,2);u[S]=_*N+h[S]*(1-N),u[S+1]=P*N+h[S+1]*(1-N),u[S+2]=E*N+h[S+2]*(1-N);const T=Ra(e.origMaskU16,i,o,1,m,k,0)*N+p[y]*(1-N);d[y]=Ut(Math.round(T),0,65535)}else u[S]=h[S],u[S+1]=h[S+1],u[S+2]=h[S+2],d[y]=p[y]}}else for(let x=0;x<o;x++){const g=x*i;for(let b=0;b<i;b++){const y=g+b,m=b+t[y],k=x+r[y],S=b&1,w=x&1;if(_g(m,k,i,o,S,w)){const M=a?Ut(a[y],0,1):1,N=Ut(qa.confidenceBlendStrength,0,1),_=1-N+N*M,P=Xl(e.workF32,i,o,m,k,S,w);u[y]=P*_+h[y]*(1-_);const R=Xl(e.origMaskU16,i,o,m,k,S,w)*_+p[y]*(1-_);d[y]=Ut(Math.round(R),0,65535)}else u[y]=h[y],d[y]=p[y]}}e.workF32=u,e.origMaskU16=d}function wle(e,t,r,n=1,a){const{width:i,height:o,channels:s}=e,l=i*o,u=new Float32Array(l*s),d=new Uint16Array(l),f=r.width===i&&r.height===o&&r.channels===s,h=f?r.workF32:e.workF32,p=f?r.origMaskU16:e.origMaskU16,x=Number.isFinite(n)?Ut(n,.25,4):1;let g=0;const b=(a==null?void 0:a.tag)||"global",y=(a==null?void 0:a.frameKey)||e.key,m=Math.max(1,a==null?void 0:a.logEveryRows),k=performance.now();if(at(b,`warpSlotDataWithEccTransform ${y}: start`,{width:i,height:o,channels:s,logEveryRows:m}),s===3)for(let S=0;S<o;S++){(S%m===0||S===o-1)&&at(b,`warpSlotDataWithEccTransform ${y}: row progress`,{row:S,totalRows:o,elapsedMs:performance.now()-k});const w=S*i;for(let v=0;v<i;v++){const M=w+v,N=M*3,_=Yb(t,v,S);if(_.valid&&Ng(_.sx,_.sy,i,o)){g++,u[N]=Ra(e.workF32,i,o,3,_.sx,_.sy,0)*x,u[N+1]=Ra(e.workF32,i,o,3,_.sx,_.sy,1)*x,u[N+2]=Ra(e.workF32,i,o,3,_.sx,_.sy,2)*x;const E=Ra(e.origMaskU16,i,o,1,_.sx,_.sy,0);d[M]=Ut(Math.round(E),0,65535)}else u[N]=h[N],u[N+1]=h[N+1],u[N+2]=h[N+2],d[M]=p[M]}}else for(let S=0;S<o;S++){(S%m===0||S===o-1)&&at(b,`warpSlotDataWithEccTransform ${y}: row progress`,{row:S,totalRows:o,elapsedMs:performance.now()-k});const w=S*i;for(let v=0;v<i;v++){const M=w+v,N=v&1,_=S&1,P=Yb(t,v,S);if(P.valid&&_g(P.sx,P.sy,i,o,N,_)){g++,u[M]=Xl(e.workF32,i,o,P.sx,P.sy,N,_)*x;const R=Xl(e.origMaskU16,i,o,P.sx,P.sy,N,_);d[M]=Ut(Math.round(R),0,65535)}else u[M]=h[M],d[M]=p[M]}}return e.workF32=u,e.origMaskU16=d,at(b,`warpSlotDataWithEccTransform ${y}: done`,{elapsedMs:performance.now()-k,validRatio:l>0?g/l:0}),{validRatio:l>0?g/l:0}}function kle(e,t,r,n,a,i){const o=qa.tileSizes,s=qa.searchRadii,l=qa.metrics,u=qa.subpixels;let d=e,f=t,h=r,p=n,x=1,g=1;if(a){const P=hm(e,r,n),E=hm(t,r,n);d=P.data,f=E.data,h=P.w,p=P.h,x=2,g=2}const b=fm(d,h,p),y=fm(f,h,p),m=Math.min(b.length,o.length);let k=null,S=0,w=-1/0;for(let P=0;P<m;P++){const E=b[P],R=y[P],T=o.length-1-P,G=o[T],L=s[T],C=l[T],$=u[T],A=k?Math.max(1,Math.round(S/E.scale)):1,O=ole(E.data,E.w,E.h,qa.icaSigmaBlur),F=ple(E,R,A,G,k?k.tileSize:null,L,C,$,k,O.gx,O.gy,qa.icaIter);if(k=F,S=E.scale,F.vectors.length>0){let D=0;for(let W=0;W<F.vectors.length;W+=2)D+=Math.hypot(F.vectors[W+1],F.vectors[W]);w=D/Math.max(1,F.vectors.length/2)}}if(!k||k.vectors.length===0)return{flowX:new Float32Array(r*n),flowY:new Float32Array(r*n),flowConf:new Float32Array(r*n),score:-1/0};if(x!==1)for(let P=0;P<k.vectors.length;P++)k.vectors[P]*=x;const v=mle({vectors:k.vectors,gw:k.gw,gh:k.gh,tileSize:k.tileSize*g},r,n),M=gle({vectors:k.vectors,gw:k.gw,gh:k.gh,tileSize:k.tileSize},typeof i=="number"&&Number.isFinite(i)?Math.max(.1,i):qa.robustnessMotionThreshold),N=xle(M,k.gw,k.gh),_=yle(N,k.gw,k.gh,k.tileSize*g,r,n);return{flowX:v.flowX,flowY:v.flowY,flowConf:_,score:w}}function Ra(e,t,r,n,a,i,o){const s=Ut(a,0,t-1),l=Ut(i,0,r-1),u=Math.floor(s),d=Math.floor(l),f=Math.min(t-1,u+1),h=Math.min(r-1,d+1),p=s-u,x=l-d,g=(d*t+u)*n+o,b=(d*t+f)*n+o,y=(h*t+u)*n+o,m=(h*t+f)*n+o,k=e[g]*(1-p)+e[b]*p,S=e[y]*(1-p)+e[m]*p;return k*(1-x)+S*x}function Xl(e,t,r,n,a,i,o){const s=Math.floor((t-1-i)/2)+1,l=Math.floor((r-1-o)/2)+1;let u=(n-i)/2,d=(a-o)/2;u=Ut(u,0,s-1),d=Ut(d,0,l-1);const f=Math.floor(u),h=Math.floor(d),p=Math.min(s-1,f+1),x=Math.min(l-1,h+1),g=u-f,b=d-h,y=i+f*2,m=i+p*2,k=o+h*2,S=o+x*2,w=k*t+y,v=k*t+m,M=S*t+y,N=S*t+m,_=e[w]*(1-g)+e[v]*g,P=e[M]*(1-g)+e[N]*g;return _*(1-b)+P*b}function Ng(e,t,r,n){return e>=0&&e<=r-1&&t>=0&&t<=n-1}function _g(e,t,r,n,a,i){const o=a+2*Math.floor((r-1-a)*.5),s=i+2*Math.floor((n-1-i)*.5);return e>=a&&e<=o&&t>=i&&t<=s}function fh(e,t,r,n,a,i,o,s,l,u){const d=Math.max(1e-4,s*.5),f=Math.max(1e-4,l*.5),h=i-d,p=i+d,x=o-f,g=o+f,b=Math.max(0,Math.floor(h)),y=Math.min(r-1,Math.floor(p)),m=Math.max(0,Math.floor(x)),k=Math.min(n-1,Math.floor(g));for(let S=m;S<=k;S++){const w=Math.max(S,x),M=Math.min(S+1,g)-w;if(!(M<=0))for(let N=b;N<=y;N++){const _=Math.max(N,h),E=Math.min(N+1,p)-_;if(E<=0)continue;const R=E*M,T=(S*r+N)*3+a;e[T]+=u*R,t[T]+=R}}}function Sle(e,t,r,n,a){const i=t*r,o=new Float32Array(i),s=new Float32Array(i),l=new Float32Array(i);let u=0;for(let g=0;g<r;g++){const b=g>0?g-1:g,y=g+1<r?g+1:g;for(let m=0;m<t;m++){const k=m>0?m-1:m,S=m+1<t?m+1:m,w=g*t+m,v=.5*(e[g*t+S]-e[g*t+k]),M=.5*(e[y*t+m]-e[b*t+m]),N=Math.hypot(v,M);o[w]=v,s[w]=M,l[w]=N,u+=N}}u/=Math.max(1,i);const d=new Float32Array(i),f=new Float32Array(i),h=Math.max(1e-6,u*3),p=Math.max(.35,.4*n),x=Math.max(p+1e-4,2.4*n);for(let g=0;g<i;g++){const b=l[g],y=Lse(b/h),m=1+a*y,k=n*m,S=n/m,w=1/Math.max(1e-6,b),v=o[g]*w,M=s[g]*w,N=-M,_=v,P=Math.sqrt(k*N*(k*N)+S*v*(S*v)),E=Math.sqrt(k*_*(k*_)+S*M*(S*M));d[g]=Ut(P,p,x),f[g]=Ut(E,p,x)}return{dropX:d,dropY:f}}function Mle(e,t,r,n=8){const a=(i,o)=>e[o*t+i];for(let i=0;i<n;i++){let o=!1;const s=new Float32Array(e);for(let l=0;l<r;l++)for(let u=0;u<t;u++){const d=l*t+u;if(Number.isFinite(e[d]))continue;const f=u>0&&Number.isFinite(a(u-1,l)),h=u+1<t&&Number.isFinite(a(u+1,l)),p=l>0&&Number.isFinite(a(u,l-1)),x=l+1<r&&Number.isFinite(a(u,l+1));let g=NaN;if(f&&h&&p&&x){const b=Math.abs(a(u-1,l)-a(u+1,l)),y=Math.abs(a(u,l-1)-a(u,l+1));g=b<=y?(a(u-1,l)+a(u+1,l))*.5:(a(u,l-1)+a(u,l+1))*.5}else{let b=0,y=0;f&&(b+=a(u-1,l),y++),h&&(b+=a(u+1,l),y++),p&&(b+=a(u,l-1),y++),x&&(b+=a(u,l+1),y++),y>0&&(g=b/y)}Number.isFinite(g)&&(s[d]=g,o=!0)}if(e.set(s),!o)break}for(let i=0;i<e.length;i++)Number.isFinite(e[i])||(e[i]=0)}function v4(e,t,r,n,a=8){const i=(o,s,l)=>o[l*r+s];for(let o=0;o<a;o++){let s=!1;const l=new Float32Array(e);for(let u=0;u<n;u++)for(let d=0;d<r;d++){const f=u*r+d;if(Number.isFinite(e[f]))continue;const h=d>0&&Number.isFinite(i(e,d-1,u)),p=d+1<r&&Number.isFinite(i(e,d+1,u)),x=u>0&&Number.isFinite(i(e,d,u-1)),g=u+1<n&&Number.isFinite(i(e,d,u+1));let b=NaN;if(h&&p&&x&&g){const y=Math.abs(i(t,d-1,u)-i(t,d+1,u)),m=Math.abs(i(t,d,u-1)-i(t,d,u+1));b=y<=m?(i(e,d-1,u)+i(e,d+1,u))*.5:(i(e,d,u-1)+i(e,d,u+1))*.5}else{let y=0,m=0;h&&(y+=i(e,d-1,u),m++),p&&(y+=i(e,d+1,u),m++),x&&(y+=i(e,d,u-1),m++),g&&(y+=i(e,d,u+1),m++),m>0&&(b=y/m)}Number.isFinite(b)&&(l[f]=b,s=!0)}if(e.set(l),!s)break}for(let o=0;o<e.length;o++)Number.isFinite(e[o])||(e[o]=t[o])}function jle(e,t,r,n,a,i,o,s){const l=Math.max(1,Math.round(i)),u=t*l,d=r*l,f=Math.max(.05,Math.min(1,o))*l,{dropX:h,dropY:p}=Sle(s,t,r,f,1.2),x=new Float32Array(u*d*3),g=new Float32Array(u*d*3),b=Pu(a);if(n===3)for(let w=0;w<r;w++)for(let v=0;v<t;v++){const M=(w*t+v)*3,N=w*t+v,_=(v+.5)*l-.5,P=(w+.5)*l-.5;fh(x,g,u,d,0,_,P,h[N],p[N],e[M]),fh(x,g,u,d,1,_,P,h[N],p[N],e[M+1]),fh(x,g,u,d,2,_,P,h[N],p[N],e[M+2])}else for(let w=0;w<r;w++)for(let v=0;v<t;v++){const M=w*t+v,N=(v+.5)*l-.5,_=(w+.5)*l-.5,P=Cu(b,v,w);fh(x,g,u,d,P==="R"?0:P==="B"?2:1,N,_,h[M],p[M],e[M])}const y=new Float32Array(u*d*3),m=new Float32Array(u*d),k=new Float32Array(u*d),S=new Float32Array(u*d);for(let w=0,v=0;w<u*d;w++,v+=3)m[w]=g[v]>1e-9?x[v]/g[v]:Number.NaN,k[w]=g[v+1]>1e-9?x[v+1]/g[v+1]:Number.NaN,S[w]=g[v+2]>1e-9?x[v+2]/g[v+2]:Number.NaN;Mle(k,u,d,10),v4(m,k,u,d,10),v4(S,k,u,d,10);for(let w=0,v=0;w<u*d;w++,v+=3)y[v]=m[w],y[v+1]=k[w],y[v+2]=S[w];return{data:y,width:u,height:d}}function Nle(e,t,r,n,a){if(n===t&&a===r)return e.slice();const i=new Int16Array(n*a);for(let o=0;o<a;o++){const l=Ut(Math.floor((o+.5)*r/a),0,r-1)*t,u=o*n;for(let d=0;d<n;d++){const f=Ut(Math.floor((d+.5)*t/n),0,t-1);i[u+d]=e[l+f]}}return i}function _le(e){const t=new Uint16Array([255]);if(new Uint8Array(t.buffer)[0]===255)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const n=new Uint8Array(e.length*2),a=new DataView(n.buffer);for(let i=0;i<e.length;i++)a.setUint16(i*2,e[i],!0);return n}function Ple(e){const t=e.trim(),r=[];let n=0;const a=d=>d>="0"&&d<="9",i=d=>d>="A"&&d<="Z"||d>="a"&&d<="z";for(;n<t.length;){const d=t[n];if(d<=" "){n++;continue}if(d==="("){r.push({t:"lp"}),n++;continue}if(d===")"){r.push({t:"rp"}),n++;continue}if(d===","){r.push({t:"comma"}),n++;continue}if(d==="+"&&t[n+1]==="+"){r.push({t:"op",v:"++"}),n+=2;continue}if(d==="+"){r.push({t:"op",v:"+"}),n++;continue}if(d==="-"){r.push({t:"op",v:"-"}),n++;continue}if(d==="*"){r.push({t:"op",v:"*"}),n++;continue}if(d==="/"){r.push({t:"op",v:"/"}),n++;continue}if(a(d)||d==="."){let f=n+1;for(;f<t.length&&(a(t[f])||t[f]===".");)f++;const h=Number(t.slice(n,f));if(!Number.isFinite(h))throw new Error(`Bad number: ${t.slice(n,f)}`);r.push({t:"num",v:h}),n=f;continue}if(i(d)){let f=n+1;for(;f<t.length&&i(t[f]);)f++;const h=t.slice(n,f).toUpperCase();let p=f;for(;p<t.length&&t[p]<=" ";)p++;t[p]==="("&&(h==="MAX"||h==="MIN"||h==="MID")?r.push({t:"func",name:h}):r.push({t:"id",v:h}),n=f;continue}throw new Error(`Unexpected char at ${n}: ${d}`)}const o=[];for(let d=0;d<r.length;d++){const f=r[d],h=o[o.length-1],p=!h||h.t==="op"||h.t==="lp"||h.t==="comma";if(f.t==="op"&&(f.v==="-"||f.v==="+")&&p){o.push({t:"num",v:0}),o.push(f);continue}o.push(f)}const s=[],l=d=>d.t==="num"||d.t==="id"||d.t==="rp",u=d=>d.t==="num"||d.t==="id"||d.t==="lp"||d.t==="func";for(let d=0;d<o.length;d++){const f=o[d],h=s[s.length-1];h&&l(h)&&u(f)&&s.push({t:"op",v:"*"}),s.push(f)}return s}function w4(e){return e==="*"||e==="/"?2:1}function Cle(e){const t=[],r=[],n=[];for(const a of e){if(a.t==="num"||a.t==="id"){t.push(a);continue}if(a.t==="func"){r.push(a),n.push(1);continue}if(a.t==="comma"){for(;r.length&&r[r.length-1].t!=="lp";)t.push(r.pop());if(!r.length)throw new Error("Comma found outside parentheses.");if(!n.length)throw new Error("Comma found but no function context.");n[n.length-1]+=1;continue}if(a.t==="lp"){r.push(a);continue}if(a.t==="rp"){for(;r.length&&r[r.length-1].t!=="lp";)t.push(r.pop());if(!r.length)throw new Error("Mismatched parentheses");if(r.pop(),r.length&&r[r.length-1].t==="func"){const i=r.pop(),o=n.pop()??1;t.push({t:"func",name:i.name,argc:o})}continue}if(a.t==="op"){for(;r.length;){const i=r[r.length-1];if(i.t!=="op")break;const o=w4(a.v);if(w4(i.v)>=o)t.push(r.pop());else break}r.push(a);continue}}for(;r.length;){const a=r.pop();if(a.t==="lp"||a.t==="rp")throw new Error("Mismatched parentheses");if(a.t==="func"){const i=n.pop()??1;t.push({t:"func",name:a.name,argc:i})}else t.push(a)}if(n.length!==0)throw new Error("Internal error: argCountStack not empty.");return t}function Ale(e,t){for(let n=1;n<t;n++){const a=e[n];let i=n-1;for(;i>=0&&e[i]>a;)e[i+1]=e[i],i--;e[i+1]=a}const r=t-1>>1;return e[r]}function Ole(e,t,r){if(t.size===0)throw new Error("No RAW loaded.");const n=t.values().next().value,a=n.width,i=n.height,o=a*i,s=new Map,l=new Map,u=new Map;let d=0;for(const v of t.keys())u.set(v,d++);const f=v=>{const M=t.get(v);if(!M)throw new Error(`Unknown RAW key: ${v}`);if(M.width!==a||M.height!==i)throw new Error("Dimension mismatch among RAWs.");let N=s.get(v);if(!N){N=new Float64Array(o*M.channels);const P=M.workF32;for(let E=0;E<N.length;E++)N[E]=P[E];s.set(v,N)}let _=l.get(v);return _||(_=new Int16Array(o),_.fill(u.get(v)??ko),l.set(v,_)),{kind:"img",v:N,w:a,h:i,c:M.channels,firstId:v,src:_}},h=v=>({kind:"scalar",v}),p=(v,M=1)=>{if(v.kind==="img"){if(v.c===M)return v;const _=new Float64Array(o*M);if(v.c===1&&M===3)for(let P=0;P<o;P++){const E=v.v[P],R=P*3;_[R]=E,_[R+1]=E,_[R+2]=E}else throw new Error("Unsupported channel conversion.");return{kind:"img",v:_,w:a,h:i,c:M,firstId:v.firstId,src:v.src}}const N=new Float64Array(o*M);return N.fill(v.v),{kind:"img",v:N,w:a,h:i,c:M,firstId:void 0,src:null}},x=(v,M)=>v??M,g=(v,M)=>{const N=v.c===3||M.c===3?3:1;return[p(v,N),p(M,N),N]},b=[];for(const v of e){if(v.t==="num"){b.push(h(v.v));continue}if(v.t==="id"){b.push(f(v.v));continue}if(v.t==="func"){const M=v.argc??1;if(M<1)throw new Error(`${v.name.toLowerCase()}(...) requires at least 1 argument.`);const N=[];for(let C=0;C<M;C++){const $=b.pop();if(!$)throw new Error(`${v.name.toLowerCase()}(...) missing argument(s).`);N.push($)}if(N.reverse(),N.every(C=>C.kind==="scalar")){const C=N.map($=>$.v);for(let $=1;$<C.length;$++){const A=C[$];let O=$-1;for(;O>=0&&C[O]>A;)C[O+1]=C[O],O--;C[O+1]=A}if(v.name==="MAX")b.push(h(C[C.length-1]));else if(v.name==="MIN")b.push(h(C[0]));else{const $=C.length-1>>1;b.push(h(C[$]))}continue}const P=N.map(C=>p(C)),E=P.some(C=>C.c===3)?3:1,R=P.map(C=>p(C,E)),T=P.reduce((C,$)=>x(C,$.firstId),void 0),G=o*E,L=new Float64Array(G);if(v.name==="MAX"||v.name==="MIN"){const C=R[0].v,$=new Int16Array(o),A=R[0].src;for(let O=0;O<o;O++){const F=O*E;for(let D=0;D<E;D++)L[F+D]=C[F+D];$[O]=A?A[O]:ko}if(v.name==="MAX")for(let O=1;O<R.length;O++){const F=R[O].v,D=R[O].src;for(let W=0;W<o;W++){const H=W*E;let Y=!1;for(let te=0;te<E;te++)if(F[H+te]>L[H+te]){Y=!0;break}if(Y){for(let te=0;te<E;te++)L[H+te]=F[H+te];$[W]=D?D[W]:ko}}}else for(let O=1;O<R.length;O++){const F=R[O].v,D=R[O].src;for(let W=0;W<o;W++){const H=W*E;let Y=!1;for(let te=0;te<E;te++)if(F[H+te]<L[H+te]){Y=!0;break}if(Y){for(let te=0;te<E;te++)L[H+te]=F[H+te];$[W]=D?D[W]:ko}}}b.push({kind:"img",v:L,w:a,h:i,c:E,firstId:T,src:$});continue}if(v.name==="MID"){const C=R.length,$=new Float64Array(C);for(let O=0;O<o;O++){const F=O*E;for(let D=0;D<E;D++){for(let W=0;W<C;W++)$[W]=R[W].v[F+D];L[F+D]=Ale($,C)}}let A;if(C===1){const O=R[0].src;O?A=O.slice():(A=new Int16Array(o),A.fill(ko))}else A=new Int16Array(o),A.fill(cy);b.push({kind:"img",v:L,w:a,h:i,c:E,firstId:T,src:A});continue}throw new Error(`Unknown function: ${v.name}`)}if(v.t==="op"){const M=v.v,N=b.pop(),_=b.pop();if(!_||!N)throw new Error(`Operator ${M} missing operands`);if(M==="++"){if(!r)throw new Error("Formula uses '++' but ppRange is null.");const O=p(_),F=p(N),[D,W,H]=g(O,F),Y=W.firstId;if(!Y){b.push(D);continue}const te=t.get(Y);if(!te)throw new Error(`Mask source RAW not found: ${Y}`);const U=D.v,Se=W.v,re=new Float64Array(o*H),J=new Int16Array(o),ne=r.min,ce=r.max,ie=te.origMaskU16,se=u.get(Y)??ko;for(let oe=0;oe<o;oe++){const ke=ie[oe],le=oe*H;if(ke>=ne&&ke<=ce){for(let fe=0;fe<H;fe++)re[le+fe]=Se[le+fe];J[oe]=W.src?W.src[oe]:se}else{for(let fe=0;fe<H;fe++)re[le+fe]=U[le+fe];J[oe]=D.src?D.src[oe]:ko}}b.push({kind:"img",v:re,w:a,h:i,c:H,firstId:x(D.firstId,Y),src:J});continue}if(_.kind==="scalar"&&N.kind==="scalar"){if(M==="+")b.push(h(_.v+N.v));else if(M==="-")b.push(h(_.v-N.v));else if(M==="*")b.push(h(_.v*N.v));else if(M==="/")b.push(h(_.v/N.v));else throw new Error(`Unsupported op ${M}`);continue}if(_.kind==="scalar"&&N.kind==="img"){const O=N.v,F=new Float64Array(O.length);if(M==="+")for(let D=0;D<O.length;D++)F[D]=_.v+O[D];else if(M==="-")for(let D=0;D<O.length;D++)F[D]=_.v-O[D];else if(M==="*")for(let D=0;D<O.length;D++)F[D]=_.v*O[D];else if(M==="/")for(let D=0;D<O.length;D++)F[D]=_.v/O[D];else throw new Error(`Unsupported op ${M}`);b.push({kind:"img",v:F,w:a,h:i,c:N.c,firstId:N.firstId,src:N.src});continue}if(_.kind==="img"&&N.kind==="scalar"){const O=_.v,F=new Float64Array(O.length);if(M==="+")for(let D=0;D<O.length;D++)F[D]=O[D]+N.v;else if(M==="-")for(let D=0;D<O.length;D++)F[D]=O[D]-N.v;else if(M==="*")for(let D=0;D<O.length;D++)F[D]=O[D]*N.v;else if(M==="/")for(let D=0;D<O.length;D++)F[D]=O[D]/N.v;else throw new Error(`Unsupported op ${M}`);b.push({kind:"img",v:F,w:a,h:i,c:_.c,firstId:_.firstId,src:_.src});continue}const P=p(_),E=p(N),[R,T,G]=g(P,E),L=R.v,C=T.v,$=new Float64Array(L.length);if(M==="+")for(let O=0;O<L.length;O++)$[O]=L[O]+C[O];else if(M==="-")for(let O=0;O<L.length;O++)$[O]=L[O]-C[O];else if(M==="*")for(let O=0;O<L.length;O++)$[O]=L[O]*C[O];else if(M==="/")for(let O=0;O<L.length;O++)$[O]=L[O]/C[O];else throw new Error(`Unsupported op ${M}`);const A=new Int16Array(o);if(R.src&&T.src)for(let O=0;O<o;O++)A[O]=R.src[O]===T.src[O]?R.src[O]:cy;else!R.src&&!T.src?A.fill(ko):A.fill(cy);b.push({kind:"img",v:$,w:a,h:i,c:G,firstId:x(R.firstId,T.firstId),src:A});continue}}if(b.length!==1)throw new Error("Expression did not reduce to a single value.");const y=b[0],m=y.kind==="img"?y:p(y,1),k=new Float32Array(m.v.length),S=m.v;for(let v=0;v<S.length;v++)k[v]=S[v];let w=m.src;return w||(w=new Int16Array(o),w.fill(ko)),{data:k,sourceMap:w.slice(),channels:m.c}}async function Tle(e,t,r,n,a,i,o,s,l,u,d,f,h="dng16"){var Ue;const p=`stack-${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`,x=performance.now();if(at(p,"processStacking: enter",{fileCount:Object.keys(e).length,formula:t,outputMode:h,alignConfig:{...d}}),xc(p,"processStacking: heap before"),Object.keys(e).length===0)throw new Error("No files loaded.");if(!t.trim())throw new Error("Formula empty.");const g=t.includes("++");if(g&&!o)throw new Error("Formula contains '++' but ++Range is not provided.");f==null||f("Parsing formula..."),at(p,"processStacking: parsing formula");const b=Ple(t),y=Cle(b),m=new Set;for(const K of b)K.t==="id"&&m.add(K.v);const k=Array.from(m);if(k.length===0)throw new Error("Formula must reference at least one loaded image key (A, B, ...).");for(const K of k)if(!e[K])throw new Error(`Formula references "${K}" but it is not loaded.`);const S=[];let w=0,v=0;for(let K=0;K<k.length;K++){const _e=performance.now(),Te=k[K],Le=e[Te];f==null||f(`Decoding ${Te}: ${Le.name}...`),at(p,`decode ${Te}: start`,{fileName:Le.name,fileSize:Le.size});const ft=Le.name.toLowerCase();let Xe;if(Ise.test(ft)){const yt=await Le.arrayBuffer();Xe=await Bl(yt)}else Xe=(await v_(Le)).analysisData;const Ie=Xe.width,ht=Xe.height,xt=Xe.data,nt=!!Xe.isThreePlane&&xt.length>=Ie*ht*3,Gt=Wse(xt,Ie,ht,nt,r);if(at(p,`decode ${Te}: done`,{elapsedMs:performance.now()-_e,width:Ie,height:ht,channels:Gt.channels,isThreePlane:nt,cfa:Xe.bayerPattern||i}),S.length===0)w=Ie,v=ht;else if(Ie!==w||ht!==v)throw new Error(`Dimension mismatch: ${Te} is ${Ie}x${ht}, expected ${w}x${v}.`);S.push({key:Te,file:Le,width:Ie,height:ht,channels:Gt.channels,isThreePlane:nt,cfaPattern:Pu(Xe.bayerPattern||i),origMaskU16:Gt.maskU16,workF32:Gt.workF32})}if(S.length===0)throw new Error("No referenced RAWs loaded.");at(p,"decode: all slots ready",{slotCount:S.length,refW:w,refH:v,elapsedMs:performance.now()-x}),xc(p,"after decode");const M=!!(d!=null&&d.align1Enabled),N=!!(d!=null&&d.align2Enabled),_=typeof(d==null?void 0:d.align3Enabled)=="boolean"?d.align3Enabled:!1,P=typeof(d==null?void 0:d.align1MaxShift)=="number"&&Number.isFinite(d.align1MaxShift)?Math.max(1,d.align1MaxShift):64,E=(()=>{const K=String((d==null?void 0:d.align3MotionModel)||"affine").toLowerCase();return K==="translation"||K==="euclidean"||K==="affine"||K==="homography"?K:"affine"})(),R=String((d==null?void 0:d.align3Method)||"ecc").toLowerCase()==="apap"?"apap":"ecc",T=typeof(d==null?void 0:d.align3Iterations)=="number"&&Number.isFinite(d.align3Iterations)?Math.max(20,Math.min(5e4,Math.round(d.align3Iterations))):5e3,G=typeof(d==null?void 0:d.align3Epsilon)=="number"&&Number.isFinite(d.align3Epsilon)?Ut(d.align3Epsilon,1e-8,.01):1e-5,L=Fse(typeof(d==null?void 0:d.align3GaussSize)=="number"&&Number.isFinite(d.align3GaussSize)?d.align3GaussSize:5,31,!0),C=typeof(d==null?void 0:d.align3MaxDim)=="number"&&Number.isFinite(d.align3MaxDim)?Math.max(320,Math.min(4096,Math.round(d.align3MaxDim))):1600,$=typeof(d==null?void 0:d.align3ApapFeatMaxDim)=="number"&&Number.isFinite(d.align3ApapFeatMaxDim)?Math.max(640,Math.min(4096,Math.round(d.align3ApapFeatMaxDim))):1600,A=typeof(d==null?void 0:d.align3ApapMaxFeatures)=="number"&&Number.isFinite(d.align3ApapMaxFeatures)?Math.max(300,Math.min(12e3,Math.round(d.align3ApapMaxFeatures))):3200,O=typeof(d==null?void 0:d.align3ApapGridStep)=="number"&&Number.isFinite(d.align3ApapGridStep)?Math.max(64,Math.min(2e3,Math.round(d.align3ApapGridStep))):320,F=typeof(d==null?void 0:d.align3ApapSigma)=="number"&&Number.isFinite(d.align3ApapSigma)?Ut(d.align3ApapSigma,50,1e4):900,D=typeof(d==null?void 0:d.align3ApapLocalMaxPoints)=="number"&&Number.isFinite(d.align3ApapLocalMaxPoints)?Math.max(8,Math.min(512,Math.round(d.align3ApapLocalMaxPoints))):120,W=typeof(d==null?void 0:d.align3ApapMatchRatio)=="number"&&Number.isFinite(d.align3ApapMatchRatio)?Ut(d.align3ApapMatchRatio,.5,.98):.68,H=!!(d!=null&&d.align3IlluminationNormalize);if((M?1:0)+(N?1:0)+(_?1:0)>1)throw new Error("At most one alignment method can be enabled at a time.");let te=null;const U=typeof(d==null?void 0:d.align2RobustnessThreshold)=="number"&&Number.isFinite(d.align2RobustnessThreshold)?Math.max(.1,d.align2RobustnessThreshold):qa.robustnessMotionThreshold;if((M||_||N)&&S.length>1){const K=S[0];if(at(p,"alignment: start",{align1Enabled:M,align2Enabled:N,align3Enabled:_,frameCount:S.length}),M){f==null||f(`Align1: strict HDR+ block-matching (legacy maxShift=${P.toFixed(1)}px ignored)...`);const _e=dh(r,f,p),Te=await _e(K);te=Te;const ft=K.channels===1&&!K.isThreePlane?"bayer":"gray";for(let Xe=1;Xe<S.length;Xe++){const Ie=S[Xe],ht=await _e(Ie),xt=dle(Te,ht,K.width,K.height,ft),nt=lle(xt);f==null||f(`Align1 ${Ie.key}: strict field mag=${nt.mag.toFixed(2)},meanDx=${nt.dx.toFixed(2)},meanDy=${nt.dy.toFixed(2)},tile=${xt.tileSize}`),nt.mag>1e-4&&fle(Ie,xt,xt.tileSize),Ie.shiftX=(Ie.shiftX||0)+nt.dx,Ie.shiftY=(Ie.shiftY||0)+nt.dy}}if(_){at(p,"align3: before await getOpenCv");const _e=$se(f,p);at(p,"align3: getOpenCv promise created");const Te=await _e,Le=(Te==null?void 0:Te.cv)??Te;if(at(p,"align3: after await getOpenCv"),at(p,"align3: OpenCV ready"),R==="ecc"){f==null||f(`Align3(ECC): model=${E}, iterations=${T}, epsilon=${G}, gauss=${L}, maxDim=${C}, illumNorm=${H?"ON":"OFF"}`),f==null||f("Align3(ECC): guide mode=single-green-from-(0,0)");const ft=dh(r,f,p,"singleGreen00");f==null||f("Align3(ECC): preparing reference guide..."),at(p,"align3: before await ref guide");const Xe=await ft(K);at(p,"align3: after await ref guide"),te=Xe,at(p,"align3: reference guide ready",{width:K.width,height:K.height});const Ie=m4(Le,Xe,K.width,K.height,C);f==null||f(`Align3(ECC) ref: ${Ie.mat.cols}x${Ie.mat.rows} (${(Ie.scale*100).toFixed(1)}%)`);const ht=Le.TERM_CRITERIA_COUNT??Le.TermCriteria_COUNT??1,xt=Le.TERM_CRITERIA_EPS??Le.TermCriteria_EPS??2,nt=ht|xt,Gt=new Le.TermCriteria(nt,T,G),yt=Bse(Le,E);at(p,"align3: criteria/motion ready",{criteriaType:nt,align3Iterations:T,align3Epsilon:G,motionType:yt});try{for(let et=1;et<S.length;et++){const He=S[et],mt=performance.now();let jt=null,or=null,zt=null,ut=null;try{at(p,`align3 ${He.key}: frame begin`,{width:He.width,height:He.height,channels:He.channels});const It=await ft(He);if(at(p,`align3 ${He.key}: source guide ready`),jt=m4(Le,It,He.width,He.height,C),at(p,`align3 ${He.key}: guideToCvMatEcc done`,{cols:jt.mat.cols,rows:jt.mat.rows,scale:jt.scale}),jt.mat.cols!==Ie.mat.cols||jt.mat.rows!==Ie.mat.rows){const dt=performance.now();or=new Le.Mat,Le.resize(jt.mat,or,new Le.Size(Ie.mat.cols,Ie.mat.rows),0,0,Le.INTER_AREA),at(p,`align3 ${He.key}: resized guide to ref ECC size`,{elapsedMs:performance.now()-dt,cols:Ie.mat.cols,rows:Ie.mat.rows})}const Lt=or||jt.mat,Me=H?p4(Xe,It):1;if(at(p,`align3 ${He.key}: illumination gain`,{illumGain:Me}),Math.abs(Me-1)>1e-6){const dt=Lt.data32F;for(let Wt=0;Wt<dt.length;Wt++)dt[Wt]*=Me;at(p,`align3 ${He.key}: illumination gain applied`,{valueCount:dt.length})}zt=E==="homography"?Le.Mat.eye(3,3,Le.CV_32F):Le.Mat.eye(2,3,Le.CV_32F),ut=new Le.Mat;const Z=performance.now(),xe=`[StackDBG][${p}] findTransformECC ${He.key}`;let ue=0,De=null,qe=Number.NaN;try{De=setInterval(()=>{ue+=1,at(p,`align3 ${He.key}: findTransformECC running`,{seconds:ue,elapsedMs:performance.now()-Z})},1e3),console.time(xe),at(p,`align3 ${He.key}: findTransformECC enter`,{refCols:Ie.mat.cols,refRows:Ie.mat.rows,srcCols:Lt.cols,srcRows:Lt.rows,gauss:L}),qe=L>0?Le.findTransformECC(Ie.mat,Lt,zt,yt,Gt,ut,L):Le.findTransformECC(Ie.mat,Lt,zt,yt,Gt,ut)}finally{De&&clearInterval(De)}console.timeEnd(xe),at(p,`align3 ${He.key}: findTransformECC exit`,{elapsedMs:performance.now()-Z,cc:Number(qe)}),Gse(zt,E,Ie.scale);const pt=Use(zt,E),de=wle(He,pt,K,H?Me:1,{tag:p,frameKey:He.key,logEveryRows:256}),Ce=zse(pt,K.width,K.height);He.shiftX=(He.shiftX||0)+Ce.dx,He.shiftY=(He.shiftY||0)+Ce.dy,f==null||f(`Align3(ECC) ${He.key}: time=${(performance.now()-Z).toFixed(1)}ms, cc=${Number(qe).toFixed(6)}, valid=${(de.validRatio*100).toFixed(1)}%, illumGain=${Me.toFixed(4)}, meanDx=${Ce.dx.toFixed(2)}, meanDy=${Ce.dy.toFixed(2)}`),at(p,`align3 ${He.key}: frame done`,{frameElapsedMs:performance.now()-mt,validRatio:de.validRatio,meanShift:Ce}),xc(p,`align3 ${He.key}: after frame`)}catch(It){f==null||f(`Align3(ECC) ${He.key}: failed, keep source. ${uh(It,Le)}`),at(p,`align3 ${He.key}: failed`,{frameElapsedMs:performance.now()-mt,error:uh(It,Le)})}finally{Nr(ut),Nr(zt),Nr(or),jt&&Nr(jt.mat)}}}finally{Nr(Gt),Nr(Ie.mat)}}else{f==null||f(`Align3(APAP): featMaxDim=${$}, maxFeatures=${A}, gridStep=${O}, sigma=${F}, localMaxPoints=${D}, matchRatio=${W}, illumNorm=${H?"ON":"OFF"}`),f==null||f("Align3(APAP): guide mode=single-green-from-(0,0)");const ft=dh(r,f,p,"singleGreen00");f==null||f("Align3(APAP): preparing reference guide...");const Xe=await ft(K);te=Xe;let Ie=null,ht=null,xt=null;try{Ie=hO(Le,Xe,K.width,K.height,$);const nt=fO(Le,Ie.mat,A);ht=nt.keypoints,xt=nt.descriptors;const Gt=typeof(ht==null?void 0:ht.size)=="function"?ht.size():0;if(f==null||f(`Align3(APAP) ref: ${Ie.mat.cols}x${Ie.mat.rows} (${(Ie.scale*100).toFixed(1)}%), kp=${Gt}`),Au(xt))throw new Error("APAP reference ORB descriptors empty.");const yt={featWidth:Ie.mat.cols,featHeight:Ie.mat.rows,keypoints:ht,descriptors:xt};for(let et=1;et<S.length;et++){const He=S[et],mt=performance.now();try{const jt=await ft(He),or=H?p4(Xe,jt):1,zt=performance.now(),ut=rle(Le,Xe,jt,He.width,He.height,yt,{featMaxDim:$,maxFeatures:A,gridStep:O,sigma:F,localMaxPoints:D,matchRatio:W}),It=nle(He,ut.mapX,ut.mapY,K,H?or:1,{tag:p,frameKey:He.key,logEveryRows:256});He.shiftX=(He.shiftX||0)+It.meanDx,He.shiftY=(He.shiftY||0)+It.meanDy,f==null||f(`Align3(APAP) ${He.key}: time=${(performance.now()-zt).toFixed(1)}ms, ratioMatch=${ut.goodMatches}/${ut.totalMatches}, mutual=${ut.mutualMatches}, inliers=${ut.inliers}, avgDist=${ut.avgDistance.toFixed(2)}, valid=${(It.validRatio*100).toFixed(1)}%, illumGain=${or.toFixed(4)}, meanDx=${It.meanDx.toFixed(2)}, meanDy=${It.meanDy.toFixed(2)}, grid=${ut.gridCells}`),at(p,`align3 apap ${He.key}: frame done`,{frameElapsedMs:performance.now()-mt,validRatio:It.validRatio,goodMatches:ut.goodMatches,totalMatches:ut.totalMatches,inliers:ut.inliers}),xc(p,`align3 apap ${He.key}: after frame`)}catch(jt){f==null||f(`Align3(APAP) ${He.key}: failed, keep source. ${uh(jt,Le)}`),at(p,`align3 apap ${He.key}: failed`,{frameElapsedMs:performance.now()-mt,error:uh(jt,Le)})}}}finally{Nr(ht),Nr(xt),Ie&&Nr(Ie.mat)}}}if(N){f==null||f(`Align2: estimating dense flow (robustnessThreshold=${U.toFixed(2)})...`);const _e=dh(r,f,p),Te=await _e(K);te=Te;let Le=0,ft=0,Xe=0;for(let xt=1;xt<S.length;xt++){const nt=S[xt],Gt=await _e(nt),yt=kle(Te,Gt,K.width,K.height,K.channels===1,U),et=ble(nt,yt.flowX,yt.flowY,yt.flowConf);Le+=et.effectiveRatio,Xe+=et.effectiveRatio,et.effectiveRatio>=.15&&ft++;const He=yt.flowX.length,mt=Math.max(1,Math.floor(He/2e5));let jt=0,or=0,zt=0,ut=0;for(let Z=0;Z<He;Z+=mt){const xe=yt.flowX[Z],ue=yt.flowY[Z];jt+=xe,or+=ue,zt+=Math.hypot(xe,ue),ut++}const It=ut>0?jt/ut:0,Lt=ut>0?or/ut:0,Me=ut>0?zt/ut:0;f==null||f(`Align2 ${nt.key}: meanDx=${It.toFixed(2)},meanDy=${Lt.toFixed(2)},mag=${Me.toFixed(2)},score=${yt.score.toFixed(2)},valid=${(et.validRatio*100).toFixed(1)}%,oob=${(et.oobRatio*100).toFixed(1)}%,conf=${(et.meanConfOnValid*100).toFixed(1)}%,eff=${(et.effectiveRatio*100).toFixed(1)}%`),Me>1e-4&&vle(nt,yt.flowX,yt.flowY,K,yt.flowConf),nt.shiftX=(nt.shiftX||0)+It,nt.shiftY=(nt.shiftY||0)+Lt}const Ie=Math.max(1,S.length-1);Xe=Xe/Ie*100;const ht=1+Le;f==null||f(`Align2 summary: adopted=${ft}/${Math.max(0,S.length-1)} extras, effectiveExtras=${Le.toFixed(2)}, effectiveTotal=${ht.toFixed(2)}/${S.length}, meanEffPerFrame=${Xe.toFixed(1)}%`)}}te||(te=uO(S[0]),at(p,"refGuideForKernel generated from makeGuidePlane fallback")),f==null||f("Evaluating expression (float domain)..."),at(p,"eval: start");const Se=new Map(S.map(K=>[K.key,K])),re=Ole(y,Se,g?o:null),J=re.data,ne=re.sourceMap,ce=Array.from(Se.keys()).map(K=>{const _e=Se.get(K);return`${K}: ${_e.file.name}`});if(s){let K=-1/0;for(let _e=0;_e<J.length;_e++)J[_e]>K&&(K=J[_e]);if(K>1e-6){const Le=(65019-Math.max(...n))/K;f==null||f(`Highlight stretch: Max=${K.toFixed(2)}, Factor=${Le.toFixed(4)}`);for(let ft=0;ft<J.length;ft++)J[ft]*=Le}}const ie=((Ue=S[0])==null?void 0:Ue.cfaPattern)||Pu(i);if(h==="jdngf32"){f==null||f("Kernel merge (TS, no denoise)...");const Te=jle(J,w,v,re.channels,ie,1,1,te);f==null||f("Finalizing Float32 JDNG data (RGB + OutputBL pedestal)...");const Le=Hse(Te.data,n),ft=Nle(ne,w,v,Te.width,Te.height);f==null||f("Packing Float32 JDNG container...");const Xe=await jse(Te.width,Te.height,Le,n,ie,[],ce,ft);return at(p,"processStacking: done (jdngf32)",{totalElapsedMs:performance.now()-x,outputBytes:Xe.byteLength,outWidth:Te.width,outHeight:Te.height}),xc(p,"processStacking: heap end (jdngf32)"),Xe}if(re.channels!==1)throw new Error("16-bit DNG output only supports single-channel mosaic. Use Float32 JDNG for 3-channel output.");f==null||f("Finalizing to 16-bit (add OutputBL pedestal + clip)...");const se=Vse(J,w,v,n),oe=_le(se),ke=a&&a.length===9?a:[1,0,0,0,1,0,0,0,1],le=await Dse(f);f==null||f("Packing DNG container..."),at(p,"dng pack: start pyodide"),le.globals.set("js_raw_u16_le",oe),le.globals.set("js_width",w),le.globals.set("js_height",v),le.globals.set("js_cfa",String(i||"RGGB")),le.globals.set("js_bl_out",Array.from(n)),le.globals.set("js_cm_flat",ke),le.globals.set("js_make","JO-Workstation"),le.globals.set("js_model","StackingTool"),le.globals.set("js_unique_model","JO StackingTool 16bit");const fe=await le.runPythonAsync(`
pack_dng_from_u16(
  js_raw_u16_le.to_py(),
  js_width,
  js_height,
  js_cfa,
  js_bl_out.to_py(),
  js_cm_flat.to_py(),
  js_make,
  js_model,
  js_unique_model
)
  `),Pe=fe.toJs();fe.destroy&&fe.destroy();const Fe=new Uint8Array(Pe.byteLength);return Fe.set(Pe),at(p,"processStacking: done",{totalElapsedMs:performance.now()-x,outputBytes:Fe.byteLength}),xc(p,"processStacking: heap end"),Fe.buffer}const k4=[{key:"fast",label:"ECC Fast (Translation)",motionModel:"translation",iterations:"2000",epsilon:"0.0001",gaussSize:"3",maxDim:"1200"},{key:"balanced",label:"ECC Balanced (Affine)",motionModel:"affine",iterations:"5000",epsilon:"0.00001",gaussSize:"5",maxDim:"1600"},{key:"perspective",label:"ECC Perspective (Homography)",motionModel:"homography",iterations:"8000",epsilon:"0.000001",gaussSize:"5",maxDim:"2000"}],Ele=({isOpen:e,onClose:t,zIndex:r,onFocus:n})=>{const[a,i]=j.useState({}),[o,s]=j.useState(0),[l,u]=j.useState("0 0 0 0"),[d,f]=j.useState("0 0 0 0"),[h,p]=j.useState(()=>localStorage.getItem("stacking_formula")||""),[x,g]=j.useState(!0),[b,y]=j.useState("0-14000"),[m,k]=j.useState(!0),[S,w]=j.useState("dng16"),[v,M]=j.useState(!1),[N,_]=j.useState("64"),[P,E]=j.useState(!1),[R,T]=j.useState("20"),[G,L]=j.useState(!1),[C,$]=j.useState("ecc"),[A,O]=j.useState("balanced"),[F,D]=j.useState("affine"),[W,H]=j.useState("5000"),[Y,te]=j.useState("0.00001"),[U,Se]=j.useState("5"),[re,J]=j.useState("1600"),[ne,ce]=j.useState("1600"),[ie,se]=j.useState("3200"),[oe,ke]=j.useState("320"),[le,fe]=j.useState("900"),[Pe,Fe]=j.useState("120"),[Ue,K]=j.useState("0.68"),[_e,Te]=j.useState(!1),Le=1,ft=1,[Xe,Ie]=j.useState(""),[ht,xt]=j.useState("RGGB"),[nt,Gt]=j.useState("Idle"),[yt,et]=j.useState(!1),[He,mt]=j.useState(null),jt=j.useRef(null),or=j.useMemo(()=>Object.keys(tu).sort(),[]);j.useEffect(()=>{localStorage.setItem("stacking_formula",h)},[h]);const zt=de=>{let Ce="",dt=de;for(;dt>=0;)Ce=String.fromCharCode(dt%26+65)+Ce,dt=Math.floor(dt/26)-1;return Ce},ut=de=>{if(de.target.files&&de.target.files.length>0){const Ce={...a};let dt=o;Array.from(de.target.files).forEach(Wt=>{const Rt=zt(dt++);Ce[Rt]=Wt}),i(Ce),s(dt)}de.target.value=""},It=()=>{i({}),s(0),mt(null),Gt("Idle")},Lt=de=>{const Ce=k4.find(dt=>dt.key===de);Ce&&(O(Ce.key),D(Ce.motionModel),H(Ce.iterations),te(Ce.epsilon),Se(Ce.gaussSize),J(Ce.maxDim))},Me=()=>{const de=!v;M(de),de&&(E(!1),L(!1))},Z=()=>{const de=!P;E(de),de&&(M(!1),L(!1))},xe=()=>{const de=!G;L(de),de&&(M(!1),E(!1))},ue=(de,Ce)=>{const dt=de.trim().split(/[\s,]+/).map(Number);if(dt.length<1||dt.some(isNaN))throw new Error(`Invalid ${Ce} Black Level format.`);return[dt[0],dt.length>1?dt[1]:dt[0],dt.length>2?dt[2]:dt[0],dt.length>3?dt[3]:dt[0]]},De=async()=>{if(Object.keys(a).length===0){mt("No files loaded.");return}const de=h.trim();if(!de){mt("Please enter a formula.");return}let Ce,dt;try{Ce=ue(l,"Input"),dt=ue(d,"Output")}catch(ye){mt(ye.message);return}let Wt=null;if(x){const ye=b.split("-").map(vt=>parseFloat(vt.trim()));if(ye.length===2&&!isNaN(ye[0])&&!isNaN(ye[1]))Wt={min:Math.min(ye[0],ye[1]),max:Math.max(ye[0],ye[1])};else{mt("Invalid ++Range format. Use min-max (e.g., 0-14000).");return}}else if(h.includes("++")){mt("Formula contains '++' operator but ++Range is disabled.");return}let Rt=null;if(Xe.trim()&&(Rt=Xe.trim().split(/[\s,\n]+/).map(Number),Rt.length!==9||Rt.some(isNaN))){mt("Color Matrix must be 9 numbers.");return}const kt=Number(N),qt=Number(R),xr=Number(W),Ir=Number(Y),fr=Number(U),be=Number(re),tt=Number(ne),it=Number(ie),Zt=Number(oe),Vt=Number(le),ot=Number(Pe),ir=Number(Ue);if((v?1:0)+(P?1:0)+(G?1:0)>1){mt("At most one alignment method can be enabled at a time.");return}if(v&&(!Number.isFinite(kt)||kt<1||kt>512)){mt("Align1 Max Shift must be in range [1, 512].");return}if(P&&(!Number.isFinite(qt)||qt<.1||qt>128)){mt("Align2 Robustness Threshold must be in range [0.1, 128].");return}if(G&&C==="ecc"&&(!Number.isFinite(xr)||xr<20||xr>5e4)){mt("Align3 ECC iterations must be in range [20, 50000].");return}if(G&&C==="ecc"&&(!Number.isFinite(Ir)||Ir<1e-8||Ir>.01)){mt("Align3 ECC epsilon must be in range [1e-8, 1e-2].");return}if(G&&C==="ecc"&&(!Number.isFinite(fr)||fr<0||fr>31)){mt("Align3 ECC gauss size must be in range [0, 31].");return}if(G&&C==="ecc"&&(!Number.isFinite(be)||be<320||be>4096)){mt("Align3 ECC max dim must be in range [320, 4096].");return}if(G&&C==="apap"&&(!Number.isFinite(tt)||tt<640||tt>4096)){mt("Align3 APAP feat max dim must be in range [640, 4096].");return}if(G&&C==="apap"&&(!Number.isFinite(it)||it<300||it>12e3)){mt("Align3 APAP max features must be in range [300, 12000].");return}if(G&&C==="apap"&&(!Number.isFinite(Zt)||Zt<64||Zt>2e3)){mt("Align3 APAP grid step must be in range [64, 2000].");return}if(G&&C==="apap"&&(!Number.isFinite(Vt)||Vt<50||Vt>1e4)){mt("Align3 APAP sigma must be in range [50, 10000].");return}if(G&&C==="apap"&&(!Number.isFinite(ot)||ot<8||ot>512)){mt("Align3 APAP local max points must be in range [8, 512].");return}if(G&&C==="apap"&&(!Number.isFinite(ir)||ir<.5||ir>.98)){mt("Align3 APAP match ratio must be in range [0.5, 0.98].");return}const Ht={align1Enabled:v,align1MaxShift:kt,align2Enabled:P,align2RobustnessThreshold:qt,align3Enabled:G,align3Method:C,align3MotionModel:F,align3Iterations:xr,align3Epsilon:Ir,align3GaussSize:fr,align3MaxDim:be,align3ApapFeatMaxDim:tt,align3ApapMaxFeatures:it,align3ApapGridStep:Zt,align3ApapSigma:Vt,align3ApapLocalMaxPoints:ot,align3ApapMatchRatio:ir,align3IlluminationNormalize:_e};et(!0),mt(null),Gt("Starting...");const Dt=Date.now(),Ee=`Stacked_Result_${Dt}`,er=[];let B=!1;const ge=ye=>{const vt=new Date().toISOString();er.push(`[${vt}] ${ye}`),console.log(`[StackModalLog][${vt}] ${ye}`)};try{await new Promise(Ur=>setTimeout(Ur,50)),ge("Processing started."),ge(`Files loaded: ${Object.keys(a).length}`),ge(`Formula: ${de}`),ge(`Mode: ${S}, Stretch: ${m?"ON":"OFF"}`),ge(`Align1: ${v?"ON":"OFF"} | Align2: ${P?"ON":"OFF"} | Align3(${C.toUpperCase()}): ${G?"ON":"OFF"}`),ge(`InputBL: ${Ce.join(" ")} | OutputBL: ${dt.join(" ")}`),ge(`CFA: ${ht} | SR scale: ${Le} | SR point area: ${ft}`),v&&ge(`Align1 max shift: ${kt}px`),P&&ge(`Align2 robustness threshold: ${qt}`),G&&C==="ecc"&&ge(`Align3 ECC: model=${F}, iterations=${xr}, epsilon=${Ir}, gaussSize=${fr}, maxDim=${be}, illumNorm=${_e?"ON":"OFF"}`),G&&C==="apap"&&ge(`Align3 APAP: featMaxDim=${tt}, maxFeatures=${it}, gridStep=${Zt}, sigma=${Vt}, localMaxPoints=${ot}, matchRatio=${ir}, illumNorm=${_e?"ON":"OFF"}`),console.time("[StackModal] processStacking"),B=!0;const ye=await Tle(a,de,Ce,dt,Rt,ht,Wt,m,Le,ft,Ht,Ur=>{Gt(Ur),ge(Ur),console.log(`[StackModalStatus] ${Ur}`)},S);console.timeEnd("[StackModal] processStacking"),B=!1,Gt("Creating Download..."),ge("Creating output download.");const vt=S==="jdngf32",We=new Blob([ye],{type:vt?"application/octet-stream":"image/x-adobe-dng"}),st=URL.createObjectURL(We),Be=document.createElement("a");Be.href=st,Be.download=`${Ee}${vt?".jdng":".dng"}`,document.body.appendChild(Be),Be.click(),document.body.removeChild(Be),URL.revokeObjectURL(st),ge(`Saved output: ${Be.download}`);const tr=Object.entries(a).map(([Ur,ur])=>`${Ur}: ${ur.name}`),Pr=[...["Jiangtherapee Stacking Log",`RunId: ${Dt}`,`Output: ${Be.download}`,`Files: ${Object.keys(a).length}`,...tr,"","Status Timeline:"],...er].join(`\r
`),Xt=new Blob([Pr],{type:"text/plain;charset=utf-8"}),Hr=URL.createObjectURL(Xt),Br=document.createElement("a");Br.href=Hr,Br.download=`${Ee}.txt`,document.body.appendChild(Br),Br.click(),document.body.removeChild(Br),URL.revokeObjectURL(Hr),Gt("Done!"),ge("Done.")}catch(ye){B&&(console.timeEnd("[StackModal] processStacking"),B=!1),console.error(ye),mt(ye.message),Gt("Failed"),ge(`Failed: ${(ye==null?void 0:ye.message)||String(ye)}`);const vt=Object.entries(a).map(([Pr,Xt])=>`${Pr}: ${Xt.name}`),st=[...["Jiangtherapee Stacking Log",`RunId: ${Dt}`,"Output: FAILED",`Files: ${Object.keys(a).length}`,...vt,"","Status Timeline:"],...er].join(`\r
`),Be=new Blob([st],{type:"text/plain;charset=utf-8"}),tr=URL.createObjectURL(Be),br=document.createElement("a");br.href=tr,br.download=`${Ee}_FAILED.txt`,document.body.appendChild(br),br.click(),document.body.removeChild(br),URL.revokeObjectURL(tr)}finally{et(!1)}},qe=()=>{f(l)},pt=()=>{const de=Object.keys(a);if(de.length){if(de.length===1){p(de[0]);return}p(`(${de.join(" + ")}) / ${de.length}`)}};return e?c.jsxs(qs,{initialPosition:{x:window.innerWidth/2-250,y:100},onClose:t,zIndex:r,onFocus:n,className:"w-[500px] bg-white dark:bg-slate-900 border-2 border-black dark:border-white shadow-2xl flex flex-col font-mono",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b-2 border-black dark:border-gray-500 bg-emerald-700 text-white",children:[c.jsx("h3",{className:"text-sm font-bold uppercase tracking-widest",children:"Advanced Math Stacking Tool"}),c.jsx("button",{onClick:t,className:"hover:text-red-300 transition-colors",children:"?                "})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-4 overflow-y-auto max-h-[80vh]",children:[c.jsx("div",{className:"h-28 border border-gray-300 dark:border-slate-700 bg-gray-50 dark:bg-black/30 rounded p-2 overflow-y-auto",children:Object.keys(a).length===0?c.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-xs",children:"No files loaded. Click 'Add Files' below."}):c.jsx("div",{className:"space-y-1",children:Object.entries(a).map(([de,Ce])=>{const dt=Ce;return c.jsxs("div",{className:"flex justify-between text-xs border-b border-gray-200 dark:border-slate-800 pb-1 last:border-0",children:[c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400 w-8",children:de}),c.jsx("span",{className:"truncate text-gray-700 dark:text-slate-300 flex-1",children:dt.name}),c.jsxs("span",{className:"text-gray-400",children:[(dt.size/1024/1024).toFixed(1),"MB"]})]},de)})})}),c.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"file",ref:jt,multiple:!0,className:"hidden",onChange:ut,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var de;return(de=jt.current)==null?void 0:de.click()},className:"flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-slate-800 dark:hover:bg-slate-700 py-1 rounded text-xs font-bold transition-colors",children:"Add Files"}),c.jsx("button",{onClick:It,className:"px-3 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 py-1 rounded text-xs font-bold transition-colors",children:"Clear"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Input BL (Subtract)"}),c.jsx("input",{type:"text",value:l,onChange:de=>u(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"}),c.jsx("div",{className:"text-[9px] text-gray-400 mt-0.5",children:"(0,0), (0,1), (1,0), (1,1)"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Output BL (Add to Result)"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"text",value:d,onChange:de=>f(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"}),c.jsx("button",{onClick:qe,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 rounded text-[9px]",title:"Copy Input to Output",children:"Copy"})]})]})]}),c.jsxs("div",{className:"flex flex-col justify-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Options"}),c.jsxs("div",{className:"mb-2",children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Output"}),c.jsxs("select",{value:S,onChange:de=>w(de.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"dng16",children:"16-bit DNG (Mosaic Output)"}),c.jsx("option",{value:"jdngf32",children:"Float32 JDNG (Kernel Merge, No Denoise)"})]})]}),c.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-gray-500 dark:text-slate-400",children:"Highlight Stretch to Container Max"}),c.jsx("button",{type:"button",onClick:()=>k(de=>!de),className:`px-2 py-0.5 text-[10px] font-bold rounded border ${m?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"Scale result so highlights reach container max code value",children:m?"ON":"OFF"})]}),c.jsxs("div",{className:"space-y-2 mb-2",children:[c.jsxs("div",{className:"border border-gray-300 dark:border-slate-700 rounded p-2",children:[c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-gray-600 dark:text-slate-300",children:"1"}),c.jsx("button",{type:"button",onClick:Me,className:`px-2 py-0.5 text-[10px] font-bold rounded border ${v?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"HDR+ style global shift alignment",children:v?"ON":"OFF"})]}),v&&c.jsxs("div",{className:"mt-2",children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Max Shift (px)"}),c.jsx("input",{type:"number",min:1,max:512,step:1,value:N,onChange:de=>_(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]}),c.jsxs("div",{className:"border border-gray-300 dark:border-slate-700 rounded p-2",children:[c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-gray-600 dark:text-slate-300",children:"2"}),c.jsx("button",{type:"button",onClick:Z,className:`px-2 py-0.5 text-[10px] font-bold rounded border ${P?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"HDR+ style dense flow alignment",children:P?"ON":"OFF"})]}),P&&c.jsxs("div",{className:"mt-2",children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Robustness"}),c.jsx("input",{type:"number",min:.1,max:128,step:.1,value:R,onChange:de=>T(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none",title:"Larger value = more tolerant to local flow span mismatch, usually keeps more stack contribution."})]})]}),c.jsxs("div",{className:"border border-emerald-300 dark:border-emerald-700 rounded p-2",children:[c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-emerald-700 dark:text-emerald-300",children:"3 (ECC/APAP)"}),c.jsx("button",{type:"button",onClick:xe,className:`px-2 py-0.5 text-[10px] font-bold rounded border ${G?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"OpenCV ECC / APAP RAW",children:G?"ON":"OFF"})]}),G&&c.jsxs("div",{className:"mt-2 space-y-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Mode"}),c.jsxs("select",{value:C,onChange:de=>$(de.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"ecc",children:"ecc"}),c.jsx("option",{value:"apap",children:"apap"})]})]}),C==="ecc"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Preset"}),c.jsx("select",{value:A,onChange:de=>Lt(de.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:k4.map(de=>c.jsx("option",{value:de.key,children:de.label},de.key))})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Motion Model"}),c.jsxs("select",{value:F,onChange:de=>D(de.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"translation",children:"translation"}),c.jsx("option",{value:"euclidean",children:"euclidean"}),c.jsx("option",{value:"affine",children:"affine"}),c.jsx("option",{value:"homography",children:"homography"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Iterations"}),c.jsx("input",{type:"number",min:20,max:5e4,step:10,value:W,onChange:de=>H(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Epsilon"}),c.jsx("input",{type:"number",min:1e-8,max:.01,step:1e-6,value:Y,onChange:de=>te(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Gauss Size"}),c.jsx("input",{type:"number",min:0,max:31,step:1,value:U,onChange:de=>Se(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"ECC Max Dim"}),c.jsx("input",{type:"number",min:320,max:4096,step:32,value:re,onChange:de=>J(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]})]}),C==="apap"&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Feat Max Dim"}),c.jsx("input",{type:"number",min:640,max:4096,step:32,value:ne,onChange:de=>ce(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Max Features"}),c.jsx("input",{type:"number",min:300,max:12e3,step:100,value:ie,onChange:de=>se(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Grid Step"}),c.jsx("input",{type:"number",min:64,max:2e3,step:16,value:oe,onChange:de=>ke(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Sigma"}),c.jsx("input",{type:"number",min:50,max:1e4,step:10,value:le,onChange:de=>fe(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Local Max Points"}),c.jsx("input",{type:"number",min:8,max:512,step:1,value:Pe,onChange:de=>Fe(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Match Ratio"}),c.jsx("input",{type:"number",min:.5,max:.98,step:.01,value:Ue,onChange:de=>K(de.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]})]}),c.jsxs("div",{className:"flex items-center justify-between gap-2",children:[c.jsx("span",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400",children:""}),c.jsx("button",{type:"button",onClick:()=>Te(de=>!de),className:`px-2 py-0.5 text-[10px] font-bold rounded border ${_e?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"",children:_e?"ON":"OFF"})]})]})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Scale"}),c.jsx("input",{type:"number",min:1,max:1,step:1,value:Le,disabled:!0,className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Point Area"}),c.jsx("input",{type:"number",min:1,max:1,step:1,value:ft,disabled:!0,className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]})]}),c.jsx("div",{className:"text-[9px] text-gray-400 mb-1 leading-tight",children:"These parameters affect Float32 JDNG output only. They are fixed at scale=1 and point area=1."}),c.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[c.jsx("input",{type:"checkbox",checked:x,onChange:de=>g(de.target.checked),className:"rounded",title:"Enable Conditional ++ Operator"}),c.jsx("span",{className:`text-[9px] font-bold uppercase ${x?"text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"++Range:"}),c.jsx("input",{type:"text",value:b,onChange:de=>y(de.target.value),disabled:!x,placeholder:"min-max",className:"w-full text-[10px] px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none disabled:opacity-50"})]})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block",children:"Math Formula ( + - * / and ++ )"}),c.jsx("button",{type:"button",onClick:pt,className:"px-2 py-0.5 text-[9px] font-bold rounded bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600",title:"Auto-generate average formula from loaded files",children:"Auto Avg"})]}),c.jsx("textarea",{value:h,onChange:de=>p(de.target.value),placeholder:"e.g. (A+B)/2 or A ++ 4*B",className:"w-full h-14 text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none resize-none font-mono"}),c.jsxs("p",{className:"text-[9px] text-gray-400 mt-1 leading-tight",children:["Operators: +, -, *, /, ( ). ",c.jsx("br",{}),c.jsx("span",{className:"text-indigo-400 font-bold",children:"++"})," Operator: ",c.jsx("code",{children:"A ++ B"}),' means "Use B if B is in range, else use A". ',c.jsx("br",{}),"Inputs are linearized float32 (Raw - InputBL)."]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 items-end",children:[c.jsxs("div",{className:"col-span-2",children:[c.jsxs("div",{className:"flex justify-between items-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Color Matrix (9 vals)"}),c.jsxs("select",{className:"text-[9px] bg-gray-100 dark:bg-slate-800 border border-black dark:border-slate-500 rounded-none px-1 py-0.5 max-w-[120px] cursor-pointer",onChange:de=>{const Ce=tu[de.target.value];Ce&&Ie(Ce),de.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Presets..."}),or.map(de=>c.jsx("option",{value:de,children:de},de))]})]}),c.jsx("input",{type:"text",value:Xe,onChange:de=>Ie(de.target.value),placeholder:"e.g. 1 0 0 0 1 0 0 0 1",className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"CFA Pattern"}),c.jsxs("select",{value:ht,onChange:de=>xt(de.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"RGGB",children:"RGGB"}),c.jsx("option",{value:"BGGR",children:"BGGR"}),c.jsx("option",{value:"GBRG",children:"GBRG"}),c.jsx("option",{value:"GRBG",children:"GRBG"})]})]})]}),He&&c.jsx("div",{className:"text-red-500 text-xs bg-red-50 dark:bg-red-900/20 p-2 rounded text-center font-bold",children:He}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[c.jsx("div",{className:"flex-1 text-xs text-emerald-600 dark:text-emerald-400 font-bold truncate",children:nt}),c.jsx("button",{onClick:De,disabled:yt,className:`px-6 py-2 text-sm font-bold uppercase tracking-wide text-white rounded shadow-md transition-all active:scale-95 ${yt?"bg-gray-400 cursor-wait":"bg-emerald-600 hover:bg-emerald-500"}`,children:S==="jdngf32"?"Process & Save Float32 JDNG":"Process & Save DNG"})]})]})]})]}):null},Ile=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Rational = (5,8); Ascii = (2,1); Byte = (1,1)
    Undefined = (7,1); Srational = (10,8); IFD = (13,4)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); Orientation = (274, Type.Short); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)
    BlackLevelRepeatDim = (50713, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 5 or tid == 10: 
            flat = [item for sublist in value for item in sublist]
            fmt = 'L' if tid == 5 else 'l'
            return struct.pack('<%s%s' % (len(flat), fmt), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def convert_to_dng(raw_bytes, width, height, cfa_str, black_level_list, shift, linear_shift, cm_flat):
    # 1. Pixel Data Processing
    # Ensure raw_bytes is a bytes-like object
    raw_data = np.frombuffer(raw_bytes, dtype=np.uint16).copy()
    
    # Use int32 for calculations
    raw_data = raw_data.astype(np.int32)

    # Apply Bit Shift (<<)
    if shift > 0:
        raw_data = raw_data * (1 << shift)
    
    # Apply Linear Offset (+)
    if linear_shift != 0:
        raw_data = raw_data + linear_shift

    # Clip to 16-bit range
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    # 2. Metadata Preparation
    white_level = 65019
    # Format Color Matrix for Srational (Value, Denominator)
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]

    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}
    
    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]), 
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, "JO-Workstation"),
        dngTag(Tag.Model, "Z8-Rescued"),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]), 
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, "Nikon Z 8") 
    ]
    
    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0])) 
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)
    
    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size
    
    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC
            
    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break
            
    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))
    
    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12
        
    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)
        
    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`,Rle=[1.1423,-.4564,-.1123,-.4816,1.2895,.2119,-.021,.1061,.7282],Dle=[4032,4032,4032,4032],$le=2,Lle=({isOpen:e,onClose:t,zIndex:r=250,onFocus:n})=>{const[a,i]=j.useState(!0),[o,s]=j.useState(!1),[l,u]=j.useState(""),d=j.useRef(null),f=j.useRef(null);j.useEffect(()=>{e&&!d.current&&(async()=>{try{const x=await window.loadPyodide();await x.loadPackage("numpy"),await x.runPythonAsync(Ile),d.current=x,i(!1)}catch(x){console.error("Pyodide Init Failed",x),u("Error loading Python environment.")}})()},[e]);const h=async p=>{if(!p.target.files||p.target.files.length===0||!d.current)return;const x=Array.from(p.target.files);s(!0),u("Starting batch...");const g=d.current;for(let b=0;b<x.length;b++){const y=x[b];u(`Processing ${b+1}/${x.length}: ${y.name}`);try{const m=await y.arrayBuffer(),k=await Bl(m),{data:S,width:w,height:v}=k,M=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];for(let C=0;C<v;C+=2){const $=C*w,A=(C+1)*w;for(let O=0;O<w;O+=2){const F=[$+O,$+O+1,A+O,A+O+1];for(let D=0;D<4;D++){const W=S[F[D]];W>=1006&&W<=1008&&M[D][W-1006]++}}}const N=[-1,-1,-1,-1];for(let C=0;C<4;C++){const $=M[C][0],A=M[C][1],O=M[C][2];O<A?N[C]=1007:O>A&&A<$&&(N[C]=1006)}let _=!1;if(N.some(C=>C>-1)){_=!0;for(let C=0;C<v;C+=2){const $=C*w,A=(C+1)*w;for(let O=0;O<w;O+=2){const F=[$+O,$+O+1,A+O,A+O+1];for(let D=0;D<4;D++){const W=N[D];W>-1&&S[F[D]]<=W&&(S[F[D]]+=1)}}}}g.globals.set("js_raw_bytes",new Uint8Array(S.buffer,S.byteOffset,S.byteLength)),g.globals.set("js_width",w),g.globals.set("js_height",v),g.globals.set("js_cfa","RGGB"),g.globals.set("js_bl_list",Dle),g.globals.set("js_shift",$le),g.globals.set("js_linear_shift",0),g.globals.set("js_cm_flat",Rle);const P=await g.runPythonAsync(`
                    convert_to_dng(
                        js_raw_bytes.to_py(), 
                        js_width, 
                        js_height, 
                        js_cfa, 
                        js_bl_list.to_py(), 
                        js_shift,
                        js_linear_shift,
                        js_cm_flat.to_py()
                    )
                `),E=P.toJs();P.destroy();const R=new Blob([E],{type:"image/x-adobe-dng"}),T=URL.createObjectURL(R),G=document.createElement("a");G.href=T;const L=y.name.substring(0,y.name.lastIndexOf("."))||"image";G.download=`${L}_Z8Rescued_16bit.dng`,document.body.appendChild(G),G.click(),document.body.removeChild(G),URL.revokeObjectURL(T),await new Promise(C=>setTimeout(C,100))}catch(m){console.error(`Error processing ${y.name}`,m),u(`Error on ${y.name}: ${m.message}`)}}s(!1),u("Batch Complete."),p.target.value=""};return e?c.jsxs(qs,{initialPosition:{x:window.innerWidth/2-200,y:150},onClose:t,zIndex:r,onFocus:n,className:"w-[400px] bg-white dark:bg-slate-900 border-2 border-red-600 shadow-[8px_8px_0px_rgba(220,38,38,0.3)] rounded-none flex flex-col font-mono",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 bg-red-600 text-white border-b-2 border-black dark:border-white",children:[c.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"text-xl",children:""}),"  Z8 (Z8 Rescue)"]}),c.jsx("button",{onClick:t,className:"hover:text-black transition-colors font-bold",children:""})]}),c.jsx("div",{className:"p-6 flex flex-col gap-4",children:a?c.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[c.jsx("div",{className:"w-6 h-6 border-4 border-red-600 border-t-transparent animate-spin rounded-full"}),c.jsx("p",{className:"text-xs mt-2 text-gray-500",children:"Loading Python Kernel..."})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 p-3 text-[10px] text-gray-700 dark:text-gray-300 leading-relaxed",children:[c.jsx("strong",{className:"block mb-1 text-red-600 dark:text-red-400",children:"Logic:"}),"1. iso64 preferred",c.jsx("br",{}),"2. PTC",c.jsx("br",{}),"3. Apply bit-shift (x4) to 16-bit.",c.jsx("br",{}),"4. Export DNG with BL=4032 & Z8 Matrix."]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:f,multiple:!0,accept:".nef,.dng",className:"hidden",onChange:h}),c.jsx("button",{onClick:()=>{var p;return(p=f.current)==null?void 0:p.click()},disabled:o,className:`w-full py-3 font-bold uppercase text-xs tracking-widest shadow-md transition-all active:translate-y-1 ${o?"bg-gray-400 text-gray-700 cursor-wait":"bg-red-600 hover:bg-red-500 text-white border-2 border-black dark:border-white"}`,children:o?"Rescuing...":"Select Z8 Files & Rescue"})]}),l&&c.jsx("div",{className:"text-center text-[10px] font-bold text-red-600 dark:text-red-400 border-t border-gray-200 dark:border-slate-800 pt-2 animate-pulse",children:l})]})})]}):null};function S4(e,t,r,n=3){const i=r.byteLength,o=8,s=o+i,l=[{id:256,type:4,count:1,value:e},{id:257,type:4,count:1,value:t},{id:258,type:3,count:n,value:n===1?16:[16,16,16]},{id:259,type:3,count:1,value:1},{id:262,type:3,count:1,value:n===1?1:2},{id:273,type:4,count:1,value:o},{id:277,type:3,count:1,value:n},{id:278,type:4,count:1,value:t},{id:279,type:4,count:1,value:i}],u=2+l.length*12+4;let d=0;const f=l.map(m=>{let k=m.type===3?2:4;const S=m.count*k,w=S<=4;let v=0;return w||(v=d,d+=S),{...m,fits:w,totalBytes:S,extraOffset:v}}),h=s+u+d,p=new ArrayBuffer(h),x=new DataView(p),g=new Uint8Array(p);x.setUint16(0,18761,!0),x.setUint16(2,42,!0),x.setUint32(4,s,!0),g.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),o);let b=s;x.setUint16(b,l.length,!0),b+=2;const y=s+u;return f.forEach(m=>{if(x.setUint16(b,m.id,!0),x.setUint16(b+2,m.type,!0),x.setUint32(b+4,m.count,!0),m.fits)Array.isArray(m.value)||(m.type===3?x.setUint16(b+8,m.value,!0):x.setUint32(b+8,m.value,!0));else{const k=y+m.extraOffset;x.setUint32(b+8,k,!0),Array.isArray(m.value)&&m.value.forEach((S,w)=>{x.setUint16(k+w*2,S,!0)})}b+=12}),x.setUint32(b,0,!0),p}const Fle="http://localhost:5428",Ble=(e=!1)=>{const[t,r]=j.useState({isConnected:!1,message:"Initializing...",hasDngConverter:!1});return j.useEffect(()=>{if(e){r({isConnected:!1,message:"Bridge Paused",hasDngConverter:!1});return}const n=async()=>{try{const i=new AbortController,o=setTimeout(()=>i.abort(),1e3),s=await fetch(`${Fle}/health`,{method:"GET",signal:i.signal});if(clearTimeout(o),s.ok){const l=await s.json(),u=`Connected (${l.exiftool||"Ready"})`;r(d=>d.isConnected===!0&&d.message===u&&d.version===l.exiftool&&d.hasDngConverter===!!l.dng_converter?d:{isConnected:!0,message:u,version:l.exiftool,hasDngConverter:!!l.dng_converter})}else r(l=>l.isConnected===!1&&l.message==="Service Error"?l:{isConnected:!1,message:"Service Error",hasDngConverter:!1})}catch{r(o=>o.isConnected===!1&&o.message==="Not Detected"?o:{isConnected:!1,message:"Not Detected",hasDngConverter:!1})}};n();const a=setInterval(n,2e3);return()=>clearInterval(a)},[e]),t},Gle="JTR_BlobStore",lo="raw_files",Ule=1,Pg=()=>new Promise((e,t)=>{const r=indexedDB.open(Gle,Ule);r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(lo)||a.createObjectStore(lo)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)}),zle=async(e,t)=>{const r=await Pg();return new Promise((n,a)=>{const i=r.transaction(lo,"readwrite");i.objectStore(lo).put(t,e),i.oncomplete=()=>n(),i.onerror=()=>a(i.error)})},Wle=async e=>{const t=await Pg();return new Promise((r,n)=>{const o=t.transaction(lo,"readonly").objectStore(lo).get(e);o.onsuccess=()=>r(o.result),o.onerror=()=>n(o.error)})},Vle=async()=>{const e=await Pg();return new Promise((t,r)=>{const n=e.transaction(lo,"readwrite");n.objectStore(lo).clear(),n.oncomplete=()=>t(),n.onerror=()=>r(n.error)})},xO="jtr_workspace_index",Hle=e=>{try{const t=JSON.stringify(e);localStorage.setItem(xO,t)}catch(t){console.error("Failed to save workspace index",t)}},Xle=()=>{try{const e=localStorage.getItem(xO);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load workspace index",e),null}},Kle=async e=>{const n=(await Pg()).transaction(lo,"readwrite").objectStore(lo),a=n.getAllKeys();a.onsuccess=()=>{a.result.forEach(o=>{e.includes(o)||n.delete(o)})}},Yle=[{x:3050,y:1973},{x:4245,y:1980},{x:3043,y:2870},{x:4243,y:2876}],qle=1195,M4=150,j4=50,Zle=[{x:3528,y:2437.5,ori:2},{x:3775,y:2419,ori:2},{x:3638.5,y:2303,ori:1},{x:3653,y:2548.5,ori:1},{x:3082,y:2413,ori:2},{x:2825,y:2427,ori:2},{x:2946,y:2300.5,ori:1},{x:2966,y:2550,ori:1},{x:3638.5,y:3e3,ori:1},{x:3657.5,y:3248.5,ori:1},{x:3521.5,y:3135,ori:2},{x:3770,y:3108.5,ori:2},{x:4375.5,y:3064.5,ori:2},{x:4620.5,y:3040,ori:2},{x:4486.5,y:2934,ori:1},{x:4509.5,y:3182.5,ori:1},{x:2066.5,y:1726,ori:2},{x:2176.5,y:1597,ori:1},{x:2194.5,y:1843,ori:1},{x:2313.5,y:1705,ori:2},{x:2675.5,y:1799.5,ori:2},{x:2789.5,y:1674,ori:1},{x:2926,y:1787.5,ori:2},{x:2810.5,y:1921.5,ori:1},{x:4380.5,y:1816,ori:2},{x:4497.5,y:1687,ori:1},{x:4513,y:1934.5,ori:1},{x:4628,y:1799.5,ori:2},{x:5099,y:1622.5,ori:1},{x:4985.5,y:1751,ori:2},{x:5122,y:1867.5,ori:1},{x:5229,y:1732,ori:2},{x:2194.5,y:2428,ori:2},{x:2305.5,y:2295.5,ori:1},{x:2327,y:2544,ori:1},{x:2442,y:2405,ori:2},{x:3530.5,y:1741.5,ori:2},{x:3640.5,y:1610,ori:1},{x:3777.5,y:1719.5,ori:2},{x:3666,y:1856.5,ori:1},{x:4222,y:2443.5,ori:2},{x:4470.5,y:2422,ori:2},{x:4334.5,y:2309,ori:1},{x:4356.5,y:2554,ori:1},{x:4965,y:2313,ori:1},{x:4852.5,y:2446,ori:2},{x:4987,y:2561,ori:1},{x:5097,y:2427,ori:2},{x:4981.5,y:3141.5,ori:2},{x:5096,y:3009,ori:1},{x:5222.5,y:3122.5,ori:2},{x:5115.5,y:3256.5,ori:1},{x:2779,y:2928,ori:1},{x:2667,y:3064.5,ori:2},{x:2799,y:3173.5,ori:1},{x:2917.5,y:3043,ori:2},{x:2167.5,y:2993,ori:1},{x:2052,y:3130,ori:2},{x:2187.5,y:3243.5,ori:1},{x:2304.5,y:3108.5,ori:2}];function Jle(e,t){let r=[],n=[];for(let o=0;o<4;o++){let s=e[o].x,l=e[o].y,u=t[o].x,d=t[o].y;r.push([s,l,1,0,0,0,-s*u,-l*u]),r.push([0,0,0,s,l,1,-s*d,-l*d]),n.push(u),n.push(d)}const a=8;for(let o=0;o<a;o++){let s=o;for(let l=o+1;l<a;l++)Math.abs(r[l][o])>Math.abs(r[s][o])&&(s=l);[r[o],r[s]]=[r[s],r[o]],[n[o],n[s]]=[n[s],n[o]];for(let l=o+1;l<a;l++){const u=r[l][o]/r[o][o];n[l]-=u*n[o];for(let d=o;d<a;d++)r[l][d]-=u*r[o][d]}}const i=new Array(a).fill(0);for(let o=a-1;o>=0;o--){let s=0;for(let l=o+1;l<a;l++)s+=r[o][l]*i[l];i[o]=(n[o]-s)/r[o][o]}return[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],1]]}function Qle(e,t,r){const n=e[2][0]*t+e[2][1]*r+e[2][2];return{x:(e[0][0]*t+e[0][1]*r+e[0][2])/n,y:(e[1][0]*t+e[1][1]*r+e[1][2])/n}}function ece(e){if(e.length!==4)return[];const t=Jle(Yle,e),n=Math.hypot(e[1].x-e[0].x,e[1].y-e[0].y)/qle;return Zle.map(a=>{const i=Qle(t,a.x,a.y);let o,s;return a.ori===1?(o=M4*n,s=j4*n):(o=j4*n,s=M4*n),{x:i.x-o/2,y:i.y-s/2,w:o,h:s,ori:a.ori}})}const tce=`
struct LayerUniforms {
  width: u32,
  height: u32,
  blendMode: u32,  // 0=add, 1=subtract
  enabled: u32,
  opacity: f32,
  exposure: f32,
  temperature: f32,
  tint: f32,
  contrast: f32,
  highlights: f32,
  shadows: f32,
  vibrance: f32,
  saturation: f32,
  pad0: f32,
  pad1: f32,
  pad2: f32,
  mixerHue0: vec4f, // red, orange, yellow, green
  mixerHue1: vec4f, // aqua, blue, purple, magenta
  mixerSat0: vec4f,
  mixerSat1: vec4f,
  mixerLum0: vec4f,
  mixerLum1: vec4f,
};

@group(0) @binding(0) var<uniform> u: LayerUniforms;
@group(0) @binding(1) var<storage, read_write> work: array<vec4f>;
@group(0) @binding(2) var<storage, read> maskAlpha: array<f32>;
@group(0) @binding(3) var<storage, read> curveLut: array<f32>;

fn clamp01(x: f32) -> f32 {
  return max(0.0, min(1.0, x));
}

fn smoothstep01(edge0: f32, edge1: f32, x: f32) -> f32 {
  let denom = max(1e-6, edge1 - edge0);
  let t = clamp01((x - edge0) / denom);
  return t * t * (3.0 - 2.0 * t);
}

fn tone_adjust(value: f32, amount: f32, weight: f32) -> f32 {
  let amt = clamp(amount, -1.0, 1.0);
  let w = clamp01(weight);
  if (amt >= 0.0) {
    return value + (1.0 - value) * amt * w;
  }
  return value + value * amt * w;
}

fn rgb_to_hsl(c: vec3f) -> vec3f {
  let r = c.x;
  let g = c.y;
  let b = c.z;
  let maxc = max(r, max(g, b));
  let minc = min(r, min(g, b));
  let l = (maxc + minc) * 0.5;
  if (maxc == minc) {
    return vec3f(0.0, 0.0, l);
  }
  let d = maxc - minc;
  var h = 0.0;
  let s = select(d / (maxc + minc), d / (2.0 - maxc - minc), l > 0.5);
  if (maxc == r) {
    h = (g - b) / d + select(6.0, 0.0, g >= b);
  } else if (maxc == g) {
    h = (b - r) / d + 2.0;
  } else {
    h = (r - g) / d + 4.0;
  }
  h = h / 6.0;
  return vec3f(h, s, l);
}

fn hue2rgb(p: f32, q: f32, t: f32) -> f32 {
  var tt = t;
  if (tt < 0.0) { tt = tt + 1.0; }
  if (tt > 1.0) { tt = tt - 1.0; }
  if (tt < (1.0 / 6.0)) { return p + (q - p) * 6.0 * tt; }
  if (tt < 0.5) { return q; }
  if (tt < (2.0 / 3.0)) { return p + (q - p) * ((2.0 / 3.0) - tt) * 6.0; }
  return p;
}

fn hsl_to_rgb(hsl: vec3f) -> vec3f {
  let h = hsl.x;
  let s = hsl.y;
  let l = hsl.z;
  if (s == 0.0) {
    return vec3f(l, l, l);
  }
  let q = select(l * (1.0 + s), l + s - l * s, l >= 0.5);
  let p = 2.0 * l - q;
  return vec3f(
    hue2rgb(p, q, h + (1.0 / 3.0)),
    hue2rgb(p, q, h),
    hue2rgb(p, q, h - (1.0 / 3.0))
  );
}

fn hue_distance_deg(a: f32, b: f32) -> f32 {
  let d = abs(a - b);
  return min(d, 360.0 - d);
}

fn band_weight(hueDeg: f32, centerDeg: f32) -> f32 {
  return clamp01(1.0 - hue_distance_deg(hueDeg, centerDeg) / 45.0);
}

fn apply_lut(val: f32, offset: u32) -> f32 {
  let v = clamp01(val);
  let pos = v * 255.0;
  let idx = u32(pos);
  let f = fract(pos);
  let p0 = curveLut[offset + idx];
  let idxNext = min(idx + 1u, 255u);
  let p1 = curveLut[offset + idxNext];
  return p0 * (1.0 - f) + p1 * f;
}

@compute @workgroup_size(16, 16)
fn main(@builtin(global_invocation_id) gid: vec3u) {
  if (gid.x >= u.width || gid.y >= u.height) { return; }
  if (u.enabled == 0u) { return; }
  let idx = gid.y * u.width + gid.x;

  let mask = clamp01(maskAlpha[idx] * u.opacity);
  if (mask <= 0.0) { return; }

  let src = work[idx].xyz;
  var adjusted = src;

  if (u.exposure != 0.0) {
    adjusted = adjusted * exp2(u.exposure);
  }

  if (u.temperature != 0.0 || u.tint != 0.0) {
    let t = u.temperature / 100.0;
    let ti = u.tint / 100.0;
    adjusted = vec3f(
      adjusted.x * (1.0 + 0.18 * t + 0.08 * ti),
      adjusted.y * (1.0 - 0.16 * ti),
      adjusted.z * (1.0 - 0.18 * t + 0.08 * ti)
    );
  }

  if (u.contrast != 0.0) {
    let contrastScale = 1.0 + (u.contrast / 100.0);
    adjusted = (adjusted - vec3f(0.5, 0.5, 0.5)) * contrastScale + vec3f(0.5, 0.5, 0.5);
  }

  if (u.highlights != 0.0 || u.shadows != 0.0) {
    let lumaNow = clamp01(dot(adjusted, vec3f(0.2126, 0.7152, 0.0722)));
    let wHighlights = smoothstep01(0.5, 1.0, lumaNow);
    let wShadows = 1.0 - smoothstep01(0.0, 0.5, lumaNow);
    let highlightAmount = u.highlights / 100.0;
    let shadowAmount = u.shadows / 100.0;
    adjusted = vec3f(
      tone_adjust(adjusted.x, highlightAmount, wHighlights),
      tone_adjust(adjusted.y, highlightAmount, wHighlights),
      tone_adjust(adjusted.z, highlightAmount, wHighlights)
    );
    adjusted = vec3f(
      tone_adjust(adjusted.x, shadowAmount, wShadows),
      tone_adjust(adjusted.y, shadowAmount, wShadows),
      tone_adjust(adjusted.z, shadowAmount, wShadows)
    );
  }

  if (
    u.vibrance != 0.0 || u.saturation != 0.0 ||
    u.mixerHue0.x != 0.0 || u.mixerHue0.y != 0.0 || u.mixerHue0.z != 0.0 || u.mixerHue0.w != 0.0 ||
    u.mixerHue1.x != 0.0 || u.mixerHue1.y != 0.0 || u.mixerHue1.z != 0.0 || u.mixerHue1.w != 0.0 ||
    u.mixerSat0.x != 0.0 || u.mixerSat0.y != 0.0 || u.mixerSat0.z != 0.0 || u.mixerSat0.w != 0.0 ||
    u.mixerSat1.x != 0.0 || u.mixerSat1.y != 0.0 || u.mixerSat1.z != 0.0 || u.mixerSat1.w != 0.0 ||
    u.mixerLum0.x != 0.0 || u.mixerLum0.y != 0.0 || u.mixerLum0.z != 0.0 || u.mixerLum0.w != 0.0 ||
    u.mixerLum1.x != 0.0 || u.mixerLum1.y != 0.0 || u.mixerLum1.z != 0.0 || u.mixerLum1.w != 0.0
  ) {
    var hsl = rgb_to_hsl(vec3f(clamp01(adjusted.x), clamp01(adjusted.y), clamp01(adjusted.z)));

    if (u.vibrance != 0.0) {
      let vib = u.vibrance / 100.0;
      hsl.y = select(clamp01(hsl.y + vib * hsl.y), clamp01(hsl.y + vib * (1.0 - hsl.y)), vib >= 0.0);
    }
    if (u.saturation != 0.0) {
      hsl.y = clamp01(hsl.y + (u.saturation / 100.0));
    }

    let hueDeg = fract(hsl.x) * 360.0;
    let w0 = band_weight(hueDeg, 0.0);
    let w1 = band_weight(hueDeg, 30.0);
    let w2 = band_weight(hueDeg, 60.0);
    let w3 = band_weight(hueDeg, 120.0);
    let w4 = band_weight(hueDeg, 180.0);
    let w5 = band_weight(hueDeg, 240.0);
    let w6 = band_weight(hueDeg, 285.0);
    let w7 = band_weight(hueDeg, 320.0);

    let sumW = w0 + w1 + w2 + w3 + w4 + w5 + w6 + w7;
    if (sumW > 1e-6) {
      let hueSum =
        w0 * u.mixerHue0.x + w1 * u.mixerHue0.y + w2 * u.mixerHue0.z + w3 * u.mixerHue0.w +
        w4 * u.mixerHue1.x + w5 * u.mixerHue1.y + w6 * u.mixerHue1.z + w7 * u.mixerHue1.w;
      let satSum =
        w0 * u.mixerSat0.x + w1 * u.mixerSat0.y + w2 * u.mixerSat0.z + w3 * u.mixerSat0.w +
        w4 * u.mixerSat1.x + w5 * u.mixerSat1.y + w6 * u.mixerSat1.z + w7 * u.mixerSat1.w;
      let lumSum =
        w0 * u.mixerLum0.x + w1 * u.mixerLum0.y + w2 * u.mixerLum0.z + w3 * u.mixerLum0.w +
        w4 * u.mixerLum1.x + w5 * u.mixerLum1.y + w6 * u.mixerLum1.z + w7 * u.mixerLum1.w;
      let invW = 1.0 / sumW;
      let chromaWeight = clamp01((hsl.y - 0.03) / 0.25);
      let hueShiftNorm = ((hueSum * invW) / 100.0) * (45.0 / 360.0) * chromaWeight;
      hsl.x = fract(hsl.x + hueShiftNorm);
      hsl.y = clamp01(hsl.y + ((satSum * invW) / 100.0) * chromaWeight);
      hsl.z = clamp01(hsl.z + ((lumSum * invW) / 100.0) * chromaWeight);
    }

    adjusted = hsl_to_rgb(hsl);
  }

  let luma = max(0.0, dot(adjusted, vec3f(0.2126, 0.7152, 0.0722)));
  let lumaMapped = apply_lut(luma, 0u);
  let masterScale = select(1.0, lumaMapped / luma, luma > 1e-6);
  let mr = clamp01(adjusted.x * masterScale);
  let mg = clamp01(adjusted.y * masterScale);
  let mb = clamp01(adjusted.z * masterScale);
  adjusted = vec3f(
    apply_lut(mr, 256u),
    apply_lut(mg, 512u),
    apply_lut(mb, 768u)
  );

  let blendValue = select(adjusted, (2.0 * src - adjusted), u.blendMode == 1u);
  let mixed = src * (1.0 - mask) + blendValue * mask;
  work[idx] = vec4f(mixed, 1.0);
}
`,rce=`
struct OutputUniforms {
  width: u32,
  height: u32,
};

@group(0) @binding(0) var<uniform> u: OutputUniforms;
@group(0) @binding(1) var<storage, read> work: array<vec4f>;
@group(0) @binding(2) var<storage, read_write> outBuf: array<u32>;

fn clamp01(x: f32) -> f32 {
  return max(0.0, min(1.0, x));
}

fn linear_to_srgb(x: f32) -> f32 {
  let v = clamp01(x);
  if (v <= 0.0031308) {
    return 12.92 * v;
  }
  return 1.055 * pow(v, 1.0 / 2.4) - 0.055;
}

@compute @workgroup_size(16, 16)
fn main(@builtin(global_invocation_id) gid: vec3u) {
  if (gid.x >= u.width || gid.y >= u.height) { return; }
  let idx = gid.y * u.width + gid.x;
  let v = work[idx];
  let r8 = u32(linear_to_srgb(v.x) * 255.0 + 0.5);
  let g8 = u32(linear_to_srgb(v.y) * 255.0 + 0.5);
  let b8 = u32(linear_to_srgb(v.z) * 255.0 + 0.5);
  let a8 = 255u;
  outBuf[idx] = (a8 << 24u) | (b8 << 16u) | (g8 << 8u) | r8;
}
`;class nce{constructor(){wr(this,"device",null);wr(this,"layerPipeline",null);wr(this,"outputPipeline",null);wr(this,"layerBindGroupLayout",null);wr(this,"outputBindGroupLayout",null);wr(this,"layerUniformBuffer",null);wr(this,"outputUniformBuffer",null);wr(this,"initialized",!1);wr(this,"resources",new Map);wr(this,"maskCpuCache",new Map);wr(this,"maxBufferSize",256*1024*1024);wr(this,"maxStorageBufferBindingSize",128*1024*1024);wr(this,"lastRenderBusy",!1)}async init(){var t,r;if(this.initialized)return!0;if(!navigator.gpu)return!1;try{const n=await navigator.gpu.requestAdapter();if(!n)return!1;const a={};(t=n.limits)!=null&&t.maxBufferSize&&(this.maxBufferSize=Number(n.limits.maxBufferSize),a.maxBufferSize=this.maxBufferSize),(r=n.limits)!=null&&r.maxStorageBufferBindingSize&&(this.maxStorageBufferBindingSize=Number(n.limits.maxStorageBufferBindingSize),a.maxStorageBufferBindingSize=this.maxStorageBufferBindingSize),this.device=await n.requestDevice({requiredLimits:Object.keys(a).length?a:void 0});const i=this.device.createShaderModule({code:tce}),o=this.device.createShaderModule({code:rce});return this.layerBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]}),this.outputBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.layerPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[this.layerBindGroupLayout]}),compute:{module:i,entryPoint:"main"}}),this.outputPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[this.outputBindGroupLayout]}),compute:{module:o,entryPoint:"main"}}),this.layerUniformBuffer=this.device.createBuffer({size:160,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.outputUniformBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.initialized=!0,!0}catch(n){return console.error("[PS GPU] init failed",n),!1}}getMaskData(t){const r=`${t.id}:${t.version}`,n=this.maskCpuCache.get(r);if(n)return n;const a=t.alpha;if(this.maskCpuCache.set(r,a),this.maskCpuCache.size>48){const i=this.maskCpuCache.keys().next().value;i&&this.maskCpuCache.delete(i)}return a}ensureResource(t){if(!this.device)return null;let r=this.resources.get(t.id);const n=t.width*t.height,a=n*16,i=n*4;if(a>this.maxBufferSize||a>this.maxStorageBufferBindingSize)return console.warn(`[PS GPU] image too large for current storage buffer limits: ${a} bytes, maxStorageBufferBindingSize=${this.maxStorageBufferBindingSize}, maxBufferSize=${this.maxBufferSize}`),null;if(i>this.maxBufferSize||i>this.maxStorageBufferBindingSize)return console.warn(`[PS GPU] output too large for current storage buffer limits: ${i} bytes, maxStorageBufferBindingSize=${this.maxStorageBufferBindingSize}, maxBufferSize=${this.maxBufferSize}`),null;if(r&&(r.width!==t.width||r.height!==t.height)&&(this.dispose(t.id),r=void 0),r){if(r.baseSourceRef!==t.baseRgb){const o=new Float32Array(n*4);for(let s=0,l=0;s<n;s++,l+=3){const u=s*4;o[u]=t.baseRgb[l],o[u+1]=t.baseRgb[l+1],o[u+2]=t.baseRgb[l+2],o[u+3]=1}this.device.queue.writeBuffer(r.baseBuffer,0,o),r.baseSourceRef=t.baseRgb}}else{const o=new Float32Array(n*4);for(let f=0,h=0;f<n;f++,h+=3){const p=f*4;o[p]=t.baseRgb[h],o[p+1]=t.baseRgb[h+1],o[p+2]=t.baseRgb[h+2],o[p+3]=1}const s=this.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(s,0,o);const l=this.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE}),u=this.device.createBuffer({size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),d=this.device.createBuffer({size:i,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});r={width:t.width,height:t.height,pixelCount:n,baseBuffer:s,baseSourceRef:t.baseRgb,workBuffer:l,outputBuffer:u,readBuffer:d,busy:!1,maskGpuCache:new Map,curveGpuCache:new Map},this.resources.set(t.id,r)}return r}ensureMaskBuffer(t,r){if(!this.device)return null;const n=`${r.id}:${r.version}`,a=[];for(const l of t.maskGpuCache.keys())l.startsWith(`${r.id}:`)&&l!==n&&a.push(l);for(const l of a){const u=t.maskGpuCache.get(l);u&&u.destroy(),t.maskGpuCache.delete(l)}const i=t.maskGpuCache.get(n);if(i)return i;const o=this.getMaskData(r),s=this.device.createBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});return this.device.queue.writeBuffer(s,0,o),t.maskGpuCache.set(n,s),s}ensureCurveBuffer(t,r,n){if(!this.device)return null;const a=Om(n),i=JSON.stringify(a),o=new Float32Array(1024);o.set(da(a.master),0),o.set(da(a.red),256),o.set(da(a.green),512),o.set(da(a.blue),768);let s=t.curveGpuCache.get(r);return s||(s={buffer:this.device.createBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),signature:""},t.curveGpuCache.set(r,s)),s.signature!==i&&(this.device.queue.writeBuffer(s.buffer,0,o),s.signature=i),s.buffer}async renderPreview(t){if(!this.initialized&&!await this.init()||!this.device||!this.layerPipeline||!this.outputPipeline||!this.layerUniformBuffer||!this.outputUniformBuffer)return null;const r=this.ensureResource(t);if(!r)return null;if(r.busy)return this.lastRenderBusy=!0,null;this.lastRenderBusy=!1,r.busy=!0;const n=[];try{const a=new Map;for(const f of t.layers)f.enabled&&a.set(f.maskId,f);const i=this.device.createCommandEncoder();i.copyBufferToBuffer(r.baseBuffer,0,r.workBuffer,0,r.pixelCount*16);for(const f of t.masks){const h=a.get(f.id);if(!h||!f.visible)continue;const p=this.ensureMaskBuffer(r,f),x=this.ensureCurveBuffer(r,h.id,h.curves);if(!p||!x)continue;const g=Qc(h.basic),b=eu(h.mixer),y=new Float32Array(40),m=new Uint32Array(y.buffer);m[0]=r.width,m[1]=r.height,m[2]=h.blendMode==="subtract"?1:0,m[3]=h.enabled?1:0,y[4]=h.opacity,y[5]=g.exposure,y[6]=g.temperature,y[7]=g.tint,y[8]=g.contrast,y[9]=g.highlights,y[10]=g.shadows,y[11]=g.vibrance,y[12]=g.saturation,y[16]=b.red.hue,y[17]=b.orange.hue,y[18]=b.yellow.hue,y[19]=b.green.hue,y[20]=b.aqua.hue,y[21]=b.blue.hue,y[22]=b.purple.hue,y[23]=b.magenta.hue,y[24]=b.red.saturation,y[25]=b.orange.saturation,y[26]=b.yellow.saturation,y[27]=b.green.saturation,y[28]=b.aqua.saturation,y[29]=b.blue.saturation,y[30]=b.purple.saturation,y[31]=b.magenta.saturation,y[32]=b.red.luminance,y[33]=b.orange.luminance,y[34]=b.yellow.luminance,y[35]=b.green.luminance,y[36]=b.aqua.luminance,y[37]=b.blue.luminance,y[38]=b.purple.luminance,y[39]=b.magenta.luminance;const k=this.device.createBuffer({size:160,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(k,0,y),n.push(k);const S=this.device.createBindGroup({layout:this.layerBindGroupLayout,entries:[{binding:0,resource:{buffer:k}},{binding:1,resource:{buffer:r.workBuffer}},{binding:2,resource:{buffer:p}},{binding:3,resource:{buffer:x}}]}),w=i.beginComputePass();w.setPipeline(this.layerPipeline),w.setBindGroup(0,S),w.dispatchWorkgroups(Math.ceil(r.width/16),Math.ceil(r.height/16)),w.end()}const o=new Uint32Array(4);o[0]=r.width,o[1]=r.height,this.device.queue.writeBuffer(this.outputUniformBuffer,0,o);const s=this.device.createBindGroup({layout:this.outputBindGroupLayout,entries:[{binding:0,resource:{buffer:this.outputUniformBuffer}},{binding:1,resource:{buffer:r.workBuffer}},{binding:2,resource:{buffer:r.outputBuffer}}]}),l=i.beginComputePass();l.setPipeline(this.outputPipeline),l.setBindGroup(0,s),l.dispatchWorkgroups(Math.ceil(r.width/16),Math.ceil(r.height/16)),l.end(),i.copyBufferToBuffer(r.outputBuffer,0,r.readBuffer,0,r.pixelCount*4),this.device.queue.submit([i.finish()]),await r.readBuffer.mapAsync(GPUMapMode.READ);const u=new Uint8ClampedArray(r.readBuffer.getMappedRange()),d=new ImageData(new Uint8ClampedArray(u),r.width,r.height);return r.readBuffer.unmap(),d}catch(a){console.error("[PS GPU] render failed",a);try{r.readBuffer.unmap()}catch{}return null}finally{for(const a of n)try{a.destroy()}catch{}r.busy=!1}}dispose(t){const r=this.resources.get(t);if(r){r.baseBuffer.destroy(),r.workBuffer.destroy(),r.outputBuffer.destroy(),r.readBuffer.destroy();for(const n of r.maskGpuCache.values())n.destroy();for(const n of r.curveGpuCache.values())n.buffer.destroy();this.resources.delete(t)}}wasBusyLastRender(){return this.lastRenderBusy}}const hh=new nce,ph=1024,N4=/\.(arw|cr2|cr3|dng|nef|orf|raf|rw2|pef|srw|sr2|srf|x3f|erf|mef|mos|mrw|kdc|dcr|iiq|3fr|fff|rwl|nrw|raw)$/i,Nd="jiangtherapee onlinecsv",_4="jiangtherapee.ps.workflow.json",P4=80,ace=20,ice=6,Cn=e=>({x:e.x,y:e.y}),Pl=e=>({...e,p1:Cn(e.p1),p2:Cn(e.p2)}),yO=e=>({model:e.model,focal:Number(e.focal)||0,k1:Number(e.k1)||0,k2:Number(e.k2)||0,a:Number(e.a)||0,b:Number(e.b)||0,c:Number(e.c)||0,lensLabel:e.lensLabel||""}),bO=e=>{switch(e.type){case"crop":return{type:"crop",rect:{...e.rect}};case"rotate":return{type:"rotate",angleDeg:e.angleDeg};case"flipH":return{type:"flipH"};case"flipV":return{type:"flipV"};case"lensDistortion":return{type:"lensDistortion",params:yO(e.params)};case"upright":return{type:"upright",guides:e.guides.map(Pl)}}},us=e=>e.map(bO),Ou=e=>e.type==="ellipse"?{...e,center:Cn(e.center)}:{...e,points:e.points.map(t=>Cn(t))},xw=e=>{const t=Qc(e==null?void 0:e.basic),r=e==null?void 0:e.hsl;return!(e!=null&&e.basic)&&r&&(t.saturation=Math.max(-100,Math.min(100,Number(r.saturation)||0)),t.exposure=Math.max(-5,Math.min(5,(Number(r.lightness)||0)/100*1.5))),t},yw=e=>{const t=eu(e==null?void 0:e.mixer),r=e==null?void 0:e.hsl;if(!(e!=null&&e.mixer)&&r&&Number.isFinite(Number(r.hue))){const n=Math.max(-100,Math.min(100,Number(r.hue)/180*100));return{red:{...t.red,hue:n},orange:{...t.orange,hue:n},yellow:{...t.yellow,hue:n},green:{...t.green,hue:n},aqua:{...t.aqua,hue:n},blue:{...t.blue,hue:n},purple:{...t.purple,hue:n},magenta:{...t.magenta,hue:n}}}return t},mh=e=>({...e,baseRgb:e.baseRgb,masks:e.masks.map(t=>({...t,alpha:t.alpha,items:(t.items||[]).map(Ou)})),layers:e.layers.map(t=>({...t,basic:xw(t),mixer:yw(t),curves:{master:t.curves.master.map(Cn),red:t.curves.red.map(Cn),green:t.curves.green.map(Cn),blue:t.curves.blue.map(Cn)}})),guides:e.guides.map(t=>({...t,p1:Cn(t.p1),p2:Cn(t.p2)})),transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null},history:e.history.map(t=>({...t}))}),pm=e=>{var t,r,n,a;return{...e,basic:xw(e),mixer:yw(e),curves:{master:(((t=e.curves)==null?void 0:t.master)||[{x:0,y:0},{x:1,y:1}]).map(Cn),red:(((r=e.curves)==null?void 0:r.red)||[{x:0,y:0},{x:1,y:1}]).map(Cn),green:(((n=e.curves)==null?void 0:n.green)||[{x:0,y:0},{x:1,y:1}]).map(Cn),blue:(((a=e.curves)==null?void 0:a.blue)||[{x:0,y:0},{x:1,y:1}]).map(Cn)}}},oce=e=>({id:e.id,name:e.name,shape:e.shape,visible:e.visible,overlayVisible:e.overlayVisible??!0,items:(e.items||[]).map(Ou)}),C4=(e,t)=>({width:e.width,height:e.height,transformOps:us(t),masks:e.masks.map(oce),layers:e.layers.map(pm),guides:e.guides.map(Pl),selectedMaskId:e.selectedMaskId,selectedLayerId:e.selectedLayerId,selectedMaskItemId:e.selectedMaskItemId,selectedGuideId:e.selectedGuideId,transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null}}),A4=(e,t)=>{var x,g,b;const r=Number(t.width),n=Number(t.height);if(!Number.isFinite(r)||!Number.isFinite(n)||r<=0||n<=0)throw new Error("Invalid workflow canvas size.");const a=us(t.transformOps||[]),i=sce(e,a);if(i.width!==r||i.height!==n)throw new Error(`Workflow transform replay size mismatch: expected ${r}x${n}, got ${i.width}x${i.height}.`);const o=(t.masks||[]).map(y=>({id:y.id,name:y.name,shape:y.shape||"full",width:r,height:n,alpha:new Float32Array(r*n),featherPx:0,visible:y.visible!==!1,overlayVisible:y.overlayVisible!==!1,version:1,items:(y.items||[]).map(Ou)})),s=((x=o[0])==null?void 0:x.id)||"",l=(t.layers||[]).map(y=>({...pm(y),maskId:o.some(m=>m.id===y.maskId)?y.maskId:s})),u=(t.guides||[]).map(Pl),d=o.some(y=>y.id===t.selectedMaskId)?t.selectedMaskId:((g=o[0])==null?void 0:g.id)||"",f=l.some(y=>y.id===t.selectedLayerId)?t.selectedLayerId:((b=l[0])==null?void 0:b.id)||"",h=t.selectedGuideId&&u.some(y=>y.id===t.selectedGuideId)?t.selectedGuideId:null,p=t.selectedMaskItemId&&o.some(y=>(y.items||[]).some(m=>m.id===t.selectedMaskItemId))?t.selectedMaskItemId:null;return XN({...i,width:r,height:n,masks:o,layers:l,guides:u,selectedMaskId:d,selectedLayerId:f,selectedMaskItemId:p,selectedGuideId:h,transform:t.transform?{rotationDeg:Number(t.transform.rotationDeg)||0,crop:t.transform.crop?{...t.transform.crop}:null}:{rotationDeg:0,crop:null}})},hy=e=>{const t={...e,baseRgb:e.baseRgb,masks:e.masks.map(r=>({...r,alpha:new Float32Array(r.width*r.height),items:(r.items||[]).map(Ou)})),layers:e.layers.map(r=>({...r,basic:xw(r),mixer:yw(r),curves:{master:r.curves.master.map(Cn),red:r.curves.red.map(Cn),green:r.curves.green.map(Cn),blue:r.curves.blue.map(Cn)}})),guides:e.guides.map(r=>({...r,p1:Cn(r.p1),p2:Cn(r.p2)})),transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null},history:e.history.map(r=>({...r}))};return XN(t)},sce=(e,t)=>{var n;let r=e;for(const a of t){if(a.type==="crop"){r=JN(r,a.rect);continue}if(a.type==="rotate"){r=QN(r,a.angleDeg);continue}if(a.type==="flipH"){r=e_(r);continue}if(a.type==="flipV"){r=t_(r);continue}if(a.type==="lensDistortion"){r=r_(r,a.params);continue}const i={...r,guides:a.guides.map(Pl),selectedGuideId:((n=a.guides[0])==null?void 0:n.id)||null};r=n_(i)}return r},lce=e=>{const t=atob(e);let r="";for(let n=0;n<t.length;n++)r+=`%${t.charCodeAt(n).toString(16).padStart(2,"0")}`;return decodeURIComponent(r)},O4=e=>{const t=e.trim();return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1).replace(/""/g,'"'):t},cce=e=>{const t=[];let r="",n=!1;for(let a=0;a<e.length;a++){const i=e[a];if(i==='"'){n&&e[a+1]==='"'?(r+='"',a++):n=!n;continue}if(i===","&&!n){t.push(r),r="";continue}r+=i}return t.push(r),t},T4=e=>(e||"image").replace(/\.[^/.]+$/,"")||"image",uce=(e,t,r)=>{const n=e.width,a=e.height,i=new ImageData(t,r),o=e.data,s=i.data,l=n/t,u=a/r;for(let d=0;d<r;d++){const f=Math.floor(d*u),h=d*t*4,p=f*n*4;for(let x=0;x<t;x++){const b=Math.floor(x*l)*4,y=h+x*4,m=p+b;s[y]=o[m],s[y+1]=o[m+1],s[y+2]=o[m+2],s[y+3]=o[m+3]}}return i},dce=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];if(f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),n("B").forEach(h=>d),f.some(h=>h>0))return f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN)&&l.some(u=>u>0))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},fce=({stats:e,onClose:t,onMinimize:r,isBGGR:n,onToggleBGGR:a,onOpenWindow:i,displaySettings:o,zIndex:s,onFocus:l,rawImageData:u})=>{if(!e)return null;const d=!!o.showKadc,f=o.blackLevel||[0,0,0,0],h=!!o.subtractBlackLevelFromStats&&!!o.blackLevel,p=!!(u!=null&&u.isThreePlane),x=j.useMemo(()=>{if(!e||!u||!o.advancedZeroDep||o.renderMode!=="advanced-zero-dep")return null;try{const{x:w,y:v,width:M,height:N}=e,_=i2(u,{x:w,y:v,w:M,h:N},o),P=[0,0,0,0],E=[0,0,0,0],R=Math.floor(v),T=Math.floor(w);for(let G=0;G<_.height;G++){const L=G*_.width;for(let C=0;C<_.width;C++){const $=_.data[L+C],A=R+G,O=T+C,F=A%2,D=O%2,W=F*2+D;P[W]+=$,E[W]++}}return P.map((G,L)=>E[L]>0?G/E[L]:0)}catch(w){return console.error("Unmix calc error",w),null}},[e,u,o]),g=(w,v,M)=>d?v<=1e-4?0:(w-M)/v:null,b=(w,v)=>h?w-f[v]:w,y=()=>{if(!h){alert(`Sub. BL
Please enable 'Sub. BL' in Tools sidebar first.`);return}let w,v,M,N;n?(N=0,v=1,M=2,w=3):(w=0,v=1,M=2,N=3);const _=E=>e.means[E]-f[E],P=E=>e.stdDevs[E];localStorage.setItem("import_signal_r",_(w).toString()),localStorage.setItem("import_signal_g1",_(v).toString()),localStorage.setItem("import_signal_g2",_(M).toString()),localStorage.setItem("import_signal_b",_(N).toString()),localStorage.setItem("import_sigma_r",P(w).toString()),localStorage.setItem("import_sigma_g1",P(v).toString()),localStorage.setItem("import_sigma_g2",P(M).toString()),localStorage.setItem("import_sigma_b",P(N).toString()),window.open("https://y-g-jiang.github.io/XJZS.html","_blank")},m=p?[{name:"R",desc:"RGB",mean:b(e.means[0],0),std:e.stdDevs[0],color:"text-red-500",snr:g(e.means[0],e.stdDevs[0],f[0]),unmixed:null},{name:"G",desc:"RGB",mean:b(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:g(e.means[1],e.stdDevs[1],f[1]),unmixed:null},{name:"B",desc:"RGB",mean:b(e.means[2],2),std:e.stdDevs[2],color:"text-blue-500",snr:g(e.means[2],e.stdDevs[2],f[2]),unmixed:null}]:n?[{name:"B",desc:"(0,0)",mean:b(e.means[0],0),std:e.stdDevs[0],color:"text-blue-500",snr:g(e.means[0],e.stdDevs[0],f[0]),unmixed:x?x[0]:null},{name:"G1",desc:"(0,1)",mean:b(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:g(e.means[1],e.stdDevs[1],f[1]),unmixed:x?x[1]:null},{name:"G2",desc:"(1,0)",mean:b(e.means[2],2),std:e.stdDevs[2],color:"text-green-500",snr:g(e.means[2],e.stdDevs[2],f[2]),unmixed:x?x[2]:null},{name:"R",desc:"(1,1)",mean:b(e.means[3],3),std:e.stdDevs[3],color:"text-red-500",snr:g(e.means[3],e.stdDevs[3],f[3]),unmixed:x?x[3]:null}]:[{name:"R",desc:"(0,0)",mean:b(e.means[0],0),std:e.stdDevs[0],color:"text-red-500",snr:g(e.means[0],e.stdDevs[0],f[0]),unmixed:x?x[0]:null},{name:"G1",desc:"(0,1)",mean:b(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:g(e.means[1],e.stdDevs[1],f[1]),unmixed:x?x[1]:null},{name:"G2",desc:"(1,0)",mean:b(e.means[2],2),std:e.stdDevs[2],color:"text-green-500",snr:g(e.means[2],e.stdDevs[2],f[2]),unmixed:x?x[2]:null},{name:"B",desc:"(1,1)",mean:b(e.means[3],3),std:e.stdDevs[3],color:"text-blue-500",snr:g(e.means[3],e.stdDevs[3],f[3]),unmixed:x?x[3]:null}],k=x?"w-96":d?"w-80":"w-60",S=j.useMemo(()=>{if(!e||!u||Math.round(e.width)!==1||Math.round(e.height)!==1)return null;const w=u.metadata||{},v=Array.isArray(w.sourceNames)?w.sourceNames:[];if(!v.length)return null;const M=w.sourceMap;if(!M)return null;const N=Math.max(0,Math.min(u.width-1,Math.round(e.x))),P=Math.max(0,Math.min(u.height-1,Math.round(e.y)))*u.width+N;let E=Number.NaN;if((Array.isArray(M)||ArrayBuffer.isView(M))&&(E=Number(M[P])),!Number.isFinite(E))return null;const R=Math.round(E);return R>=0&&R<v.length?v[R]:R===-1?"Scalar / No RAW Source":R===-2?"Mixed Source":`Source #${R}`},[e,u]);return c.jsxs(qs,{className:`${k} p-0 overflow-hidden transition-all duration-300 bg-white dark:bg-black border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] dark:shadow-[4px_4px_0px_rgba(255,255,255,0.2)]`,onClose:t,zIndex:s,onFocus:l,initialPosition:{x:20,y:80},children:[c.jsxs("div",{className:"flex justify-between items-center px-3 py-2 border-b border-gray-100 dark:border-slate-800 bg-gray-50/50 dark:bg-slate-800/50 select-none",children:[c.jsxs("h3",{className:"text-xs font-bold text-gray-700 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2",children:["ROI Analysis",c.jsxs("span",{className:"text-[10px] font-normal text-gray-400 bg-gray-200 dark:bg-slate-700 px-1.5 py-0.5 rounded",children:[Math.round(e.width),"",Math.round(e.height)]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 transition-colors p-1 rounded-md hover:bg-gray-200 dark:hover:bg-slate-700 relative z-20",children:c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors p-1 rounded-md hover:bg-gray-200 dark:hover:bg-slate-700 relative z-20",children:c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-3",children:[c.jsxs("div",{className:"flex justify-between items-center mb-3",children:[c.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono leading-tight",children:["X: ",Math.round(e.x),c.jsx("br",{}),"Y: ",Math.round(e.y),S&&c.jsxs(c.Fragment,{children:[c.jsx("br",{}),c.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:["Src: ",S]})]})]}),!p&&c.jsx("button",{onClick:()=>a(!n),className:"text-[10px] font-bold px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 transition-colors border border-gray-200 dark:border-slate-700 relative z-20",title:"Toggle Bayer Pattern Interpretation",children:n?"BGGR":"RGGB"})]}),c.jsxs("table",{className:"w-full mb-3",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-[10px] text-gray-400 dark:text-slate-500 border-b border-gray-100 dark:border-slate-800",children:[c.jsx("th",{className:"text-left pb-1 font-medium",children:"Ch"}),c.jsxs("th",{className:"text-right pb-1 font-medium",children:["Mean",h?"*":""]}),c.jsx("th",{className:"text-right pb-1 font-medium",children:"Std()"}),d&&c.jsx("th",{className:"text-right pb-1 font-medium text-cyan-600 dark:text-cyan-400",children:"k"}),x&&c.jsx("th",{className:"text-right pb-1 font-medium text-indigo-600 dark:text-indigo-400",children:"Unmix"})]})}),c.jsx("tbody",{className:"font-mono text-xs",children:m.map((w,v)=>c.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-slate-800/30 transition-colors",children:[c.jsxs("td",{className:"py-1",children:[c.jsx("span",{className:`font-bold ${w.color}`,children:w.name}),c.jsx("span",{className:"text-[9px] text-gray-300 dark:text-slate-600 ml-1 hidden group-hover:inline",children:w.desc})]}),c.jsx("td",{className:"py-1 text-right text-gray-700 dark:text-slate-200 font-semibold",children:w.mean.toFixed(2)}),c.jsx("td",{className:"py-1 text-right text-gray-500 dark:text-slate-400",children:w.std.toFixed(2)}),d&&c.jsx("td",{className:"py-1 text-right text-cyan-600 dark:text-cyan-400 font-bold",children:w.snr!==null?w.snr.toFixed(2):"-"}),x&&c.jsx("td",{className:"py-1 text-right text-indigo-600 dark:text-indigo-400 font-bold",children:w.unmixed!==null?w.unmixed.toFixed(1):"-"})]},v))})]}),h&&c.jsx("div",{className:"mb-2 text-[9px] text-gray-400 dark:text-slate-500 text-right italic",children:"* Mean adjusted by Black Level"}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx("button",{onClick:()=>i("histogram"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"Hist"}),c.jsx("button",{onClick:()=>i("quant"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-teal-600 hover:bg-teal-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"Quant"}),c.jsx("button",{onClick:()=>i("fft"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-purple-600 hover:bg-purple-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"FFT"}),c.jsx("button",{onClick:()=>i("pearson"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"PCC"}),!p&&c.jsx("button",{onClick:y,className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-pink-600 hover:bg-pink-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"ColorN"})]})]})]})},hce=()=>{var Pw;const[e,t]=j.useState("init"),[r,n]=j.useState("Checking storage..."),[a,i]=j.useState(null),o=j.useRef(!1),[s,l]=j.useState("dark"),[u,d]=j.useState(!1);j.useEffect(()=>((async()=>{const z=await Ya.init();d(z),console.log("WebGPU Available:",z)})(),()=>{Ya.disposeAll()}),[]),j.useEffect(()=>{const I=window.document.documentElement;I.classList.remove(s==="dark"?"light":"dark"),I.classList.add(s)},[s]);const[f,h]=j.useState(!1),[p,x]=j.useState(!1),[g,b]=j.useState(!1),[y,m]=j.useState(!1),[k,S]=j.useState(!1),[w,v]=j.useState(!1),M=Ble(f||p||g),[N,_]=j.useState(!1),[P,E]=j.useState([]),[R,T]=j.useState(-1),[G,L]=j.useState([]),C=j.useMemo(()=>P[R],[P,R]),$=j.useRef(null);j.useEffect(()=>{$.current=C||null},[C]);const A=j.useRef({}),O=(C==null?void 0:C.file)||null,F=(C==null?void 0:C.imageElement)||null,D=(C==null?void 0:C.rawImageData)||null,W=(C==null?void 0:C.rawFileBuffer)||null,H=(C==null?void 0:C.renderedRawImageData)||null,Y=(C==null?void 0:C.referenceImageData)||null,te=(C==null?void 0:C.sampledImageData)||null,U=(C==null?void 0:C.exifData)||null,Se=(C==null?void 0:C.isThreePlane)||!1,re=(C==null?void 0:C.psDocument)||null,J=(C==null?void 0:C.xtransPhase)||{x:0,y:0},ne=(C==null?void 0:C.displaySettings)||{exposure:0,demosaicMethod:3,blackLevel:void 0,wbGains:[1,1],showKadc:!0,subtractBlackLevelFromStats:!0},ce=j.useMemo(()=>re?{...re,guides:[],selectedGuideId:null}:null,[re==null?void 0:re.id,re==null?void 0:re.width,re==null?void 0:re.height,re==null?void 0:re.baseRgb,re==null?void 0:re.masks,re==null?void 0:re.layers,re==null?void 0:re.selectedMaskId,re==null?void 0:re.selectedLayerId,re==null?void 0:re.transform,re==null?void 0:re.historyIndex]),[ie,se]=j.useState(!1),[oe,ke]=j.useState(null),[le,fe]=j.useState(!1),[Pe,Fe]=j.useState(!1),[Ue,K]=j.useState(null),[_e,Te]=j.useState([]),[Le,ft]=j.useState(100),[Xe,Ie]=j.useState(!0),[ht,xt]=j.useState(!1),[nt,Gt]=j.useState(null),[yt,et]=j.useState(!1),[He,mt]=j.useState(!1),[jt,or]=j.useState(!1),[zt,ut]=j.useState(!1),[It,Lt]=j.useState(!1),[Me,Z]=j.useState("1.0"),[xe,ue]=j.useState(!1),[De,qe]=j.useState(!1),[pt,de]=j.useState(!1),[Ce,dt]=j.useState(!1),[Wt,Rt]=j.useState(!1),[kt,qt]=j.useState(32),[xr,Ir]=j.useState(.35),[fr,be]=j.useState(.6),[tt,it]=j.useState(24),[Zt,Vt]=j.useState("add"),[ot,ir]=j.useState(null),[yr,Ht]=j.useState("off"),[Dt,Ee]=j.useState(null),[er,B]=j.useState(null),[ge,ye]=j.useState(!1),[vt,We]=j.useState(null),[st,Be]=j.useState(null),[tr,br]=j.useState(0),Pr=j.useRef({}),Xt=j.useRef(null),Hr=j.useRef(null),Br=j.useRef([]),Ur=j.useRef(null),ur=j.useRef(null);j.useEffect(()=>{Ur.current=vt},[vt]),j.useEffect(()=>{ur.current=st},[st]);const[sr,hr]=j.useState([]),[Ze,rr]=j.useState(!1),[Rr,hn]=j.useState(0),[ra,Sn]=j.useState([]),[Na,ae]=j.useState(!1),[me,je]=j.useState({x:0,y:0}),[Q,ze]=j.useState(!1),[rt,wt]=j.useState(!1),[Ot,Jt]=j.useState([]),[At,pr]=j.useState(0),[vr,Dr]=j.useState(null),[Xr,Ae]=j.useState(!1),[nr,gt]=j.useState([]),[Tr,Cr]=j.useState(.5),[Mn,Sr]=j.useState(!1),[an,zn]=j.useState(2),[zi,Wi]=j.useState(1),[Zu,Zs]=j.useState([]),[Ju,rc]=j.useState(null),[cn,Ga]=j.useState(0),[fo,Ua]=j.useState([]),[ho,Vi]=j.useState([]),[po,Js]=j.useState(64),[Hi,Ho]=j.useState(10),[Ye,dr]=j.useState(10),[Tt,cr]=j.useState(4),[pn,ha]=j.useState(1),[bn,ki]=j.useState(0),[Yn,_a]=j.useState("processed"),[Kr,na]=j.useState(!1),mo=j.useMemo(()=>ne.blackLevel?ne.blackLevel:D!=null&&D.blackLevels?[D.blackLevels[0],D.blackLevels[1],D.blackLevels[2],D.blackLevels[3]]:[0,0,0,0],[ne.blackLevel,D]),Xo=(U==null?void 0:U.ImageHeight)||(U==null?void 0:U.ExifImageHeight)||(D==null?void 0:D.height)||0,[Qs,_t]=j.useState(null),[nc,Ct]=j.useState(null),[Ko,Yo]=j.useState({x:0,y:0}),[el,Qu]=j.useState(1),[Pa,f0]=j.useState("pan"),tl=j.useRef(null),go=j.useRef(null);j.useEffect(()=>{if(u&&C&&C.rawImageData&&C.id){if(!!C.rawImageData.floatData&&/\.jdng$/i.test(C.fileName||""))return;const{data:z,width:X,height:q}=C.rawImageData;Ya.uploadImage(C.id,z,X,q)}},[u,C==null?void 0:C.id]),j.useEffect(()=>{const I=Xle();I&&I.sessions.length>0?(i(I),t("prompt")):t("idle")},[]),j.useCallback(async()=>{o.current=!0,n("Cleaning up..."),localStorage.removeItem("jtr_workspace_index");try{await Vle()}catch(I){console.error("Failed to clear DB",I)}t("idle"),i(null),o.current=!1},[]),j.useCallback(async()=>{if(!a)return;t("restoring"),n("Restoring layout...");const I=a;if(l(I.theme),Ie(I.sidebarOpen),I.sessions.length>0){n(`Restoring ${I.sessions.length} images...`);const z=[];for(const X of I.sessions){if(o.current)return;await new Promise(q=>setTimeout(q,50));try{const q=await Wle(X.id);if(q){const he={id:X.id,fileName:X.fileName,file:null,imageElement:null,rawImageData:null,rawFileBuffer:q,renderedRawImageData:null,referenceImageData:null,sampledImageData:null,exifData:null,isThreePlane:X.isThreePlane,displaySettings:X.displaySettings,originalRawFileBuffer:null,isXTransOriginal:!1,isXTransConverted:!1,xtransPhase:{x:0,y:0},psDocument:null},{previewBlob:Ne,analysisData:$e}=await fc(q);let pe=null;if($e)try{X.displaySettings.renderMode==="zero-dependency"?pe=await _x(q,X.displaySettings):X.displaySettings.renderMode==="advanced-zero-dep"?pe=await tI(q,X.displaySettings):X.displaySettings.renderMode==="zero-dep-color"?pe=await eI(q,X.displaySettings):pe=await Q8(q,X.displaySettings)}catch(Ke){console.error("Render failed",Ke),pe=await _x(q,X.displaySettings)}const Je=URL.createObjectURL(Ne),Ve=new Image;Ve.src=Je,await new Promise(Ke=>{Ve.onload=()=>Ke()}),z.push({...he,rawImageData:$e,renderedRawImageData:pe,previewUrl:Je,imageElement:Ve,exifData:$e.metadata})}}catch(q){console.error(`Failed to restore session ${X.id}`,q)}}if(o.current)return;if(E(z),I.activeSessionId){const X=z.findIndex(q=>q.id===I.activeSessionId);X>=0?T(X):z.length>0&&T(0)}Te(I.windows)}o.current||t("idle")},[a]);const h0=j.useCallback(async()=>{or(!1);const I=C;if(u&&I&&I.id&&Ya.hasImage(I.id)&&(I.displaySettings.renderMode||"standard")!=="standard"){Ct("Exporting via WebGPU...");try{const q=await Ya.export16Bit(I.id,I.displaySettings,zt,It);if(q){const he=S4(I.rawImageData.width,I.rawImageData.height,q,3),Ne=new Blob([he],{type:"image/tiff"}),$e=URL.createObjectURL(Ne),pe=document.createElement("a");pe.href=$e,pe.download=`export_webgpu_${Date.now()}.tiff`,document.body.appendChild(pe),pe.click(),document.body.removeChild(pe),URL.revokeObjectURL($e),Ct(null);return}}catch(q){console.error("WebGPU Export Failed, falling back to CPU",q)}}!W||!C||(Ct("Exporting 16-bit TIFF (CPU)..."),setTimeout(async()=>{try{const z=await w_(W,ne,zt,It),X=S4(z.width,z.height,z.data,z.channels),q=new Blob([X],{type:"image/tiff"}),he=URL.createObjectURL(q),Ne=document.createElement("a");Ne.href=he,Ne.download=`export_${Date.now()}.tiff`,document.body.appendChild(Ne),Ne.click(),document.body.removeChild(Ne),URL.revokeObjectURL(he)}catch(z){_t("Export failed: "+z.message)}finally{Ct(null)}},100))},[W,C,ne,zt,It,u]),p0=j.useCallback(()=>{!W||!C||or(!0)},[W,C]),Cg=j.useCallback(async()=>{},[D,C,Me,mo]);j.useEffect(()=>{const I=z=>{(z.ctrlKey||z.metaKey)&&z.key.toLowerCase()==="s"&&(z.preventDefault(),p0())};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[p0]);const ed=j.useRef(null),m0=j.useCallback(()=>{e==="idle"&&(ed.current&&clearTimeout(ed.current),ed.current=window.setTimeout(async()=>{var X;const I={version:1,timestamp:Date.now(),activeSessionId:((X=P[R])==null?void 0:X.id)||null,theme:s,sidebarOpen:Xe,sessions:P.map(q=>({id:q.id,fileName:q.fileName,fileType:q.file?q.file.type:"application/octet-stream",fileSize:q.rawFileBuffer?q.rawFileBuffer.byteLength:0,displaySettings:q.displaySettings,isThreePlane:q.isThreePlane})),windows:_e.map(q=>({id:q.id,type:q.type,roi:q.roi,zIndex:q.zIndex,initialPosition:q.initialPosition,sessionId:q.sessionId,isBGGR:q.isBGGR,isMinimized:q.isMinimized||!1,internalState:q.internalState}))};Hle(I);const z=P.map(q=>q.id);Kle(z)},1e3))},[P,_e,R,s,Xe,e]);j.useEffect(()=>{m0()},[m0]);const ni=j.useCallback(I=>{E(z=>z.map((X,q)=>q===R?{...X,...I}:X))},[R]),za=j.useCallback((I,z)=>{E(X=>X.map(q=>q.id===I?{...q,...z}:q))},[]),Wa=j.useCallback((I,z)=>({...I,history:z.entries.map(X=>({id:X.id,label:X.label,timestamp:X.timestamp})),historyIndex:z.index}),[]),ac=j.useCallback((I,z,X="Initialize PS Document",q=[])=>{const he=mh(z),$e={entries:[{id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:X,timestamp:Date.now(),doc:he,transformOps:us(q)}],index:0};return A.current[I]=$e,Wa(z,$e)},[Wa]);j.useEffect(()=>{const I=new Set(P.map(z=>z.id));Object.keys(A.current).forEach(z=>{I.has(z)||delete A.current[z]}),Object.keys(Pr.current).forEach(z=>{I.has(z)||delete Pr.current[z]})},[P]);const td=()=>T(I=>Math.min(I+1,P.length-1)),rd=()=>T(I=>Math.max(0,I-1)),g0=j.useCallback(I=>{if(!D)return null;const z=Math.max(0,Math.floor(I.x)),X=Math.max(0,Math.floor(I.y)),q=Math.min(D.width,Math.ceil(I.x+I.w)),he=Math.min(D.height,Math.ceil(I.y+I.h));if(q<=z||he<=X)return null;let Ne=0,$e=0,pe=null;if(H)Ne=H.width,$e=H.height,pe=H.data;else if(F&&F.naturalWidth>0&&F.naturalHeight>0){const $t=document.createElement("canvas");$t.width=F.naturalWidth,$t.height=F.naturalHeight;const Zr=$t.getContext("2d");if(!Zr)return null;Zr.drawImage(F,0,0);const Nn=Zr.getImageData(0,0,$t.width,$t.height);Ne=Nn.width,$e=Nn.height,pe=Nn.data}else return null;const Je=Math.max(0,Math.min(Ne-1,Math.floor(z*Ne/D.width))),Ve=Math.max(0,Math.min($e-1,Math.floor(X*$e/D.height))),Ke=Math.max(Je+1,Math.min(Ne,Math.ceil(q*Ne/D.width))),Nt=Math.max(Ve+1,Math.min($e,Math.ceil(he*$e/D.height)));let Oe=0,Pt=0,mr=0,Yr=0,Mr=0,Kt=0,Ft=0;for(let $t=Ve;$t<Nt;$t++){const Zr=$t*Ne;for(let Nn=Je;Nn<Ke;Nn++){const Ca=(Zr+Nn)*4,Aa=pe[Ca],Qo=pe[Ca+1],Si=pe[Ca+2];Oe+=Aa,Pt+=Qo,mr+=Si,Yr+=Aa*Aa,Mr+=Qo*Qo,Kt+=Si*Si,Ft++}}if(Ft<=0)return null;const qr=Oe/Ft,jn=Pt/Ft,mn=mr/Ft,on=Math.sqrt(Math.max(0,Yr/Ft-qr*qr)),ii=Math.sqrt(Math.max(0,Mr/Ft-jn*jn)),ma=Math.sqrt(Math.max(0,Kt/Ft-mn*mn));return{x:z,y:X,width:q-z,height:he-X,means:[qr,jn,mn,0],stdDevs:[on,ii,ma,0],pixelCount:Ft}},[D,H,F]),nd=j.useCallback(I=>D?D.isThreePlane&&g0(I)||nl(D.data,D.width,D.height,I.x,I.y,I.w,I.h):null,[D,g0]);j.useEffect(()=>{if(!D||!oe)return;const I=nd({x:oe.x,y:oe.y,w:oe.width,h:oe.height});I&&ke(I)},[D,H,F,nd]);const rl=j.useCallback(async I=>{var Ne;const z=I.displaySettings.renderMode||"standard",X=!!((Ne=I.rawImageData)!=null&&Ne.floatData)&&/\.jdng$/i.test(I.fileName||"");if(u&&Ya.hasImage(I.id)&&z!=="standard"&&!I.isThreePlane&&!X&&I.rawImageData){const $e=await Ya.export16Bit(I.id,I.displaySettings,!0,!1);if($e)return{width:I.rawImageData.width,height:I.rawImageData.height,data:JE($e)}}if(X&&I.rawImageData){const $e=ly(I.rawImageData,I.displaySettings);return{width:$e.width,height:$e.height,data:$e.floatRgb}}return N4.test(I.fileName)&&I.rawFileBuffer?await rI(I.rawFileBuffer,I.displaySettings):I.renderedRawImageData?{width:I.renderedRawImageData.width,height:I.renderedRawImageData.height,data:KN(I.renderedRawImageData)}:I.imageElement?await QE(I.imageElement):null},[u]),ic=j.useCallback(async I=>{if(I.psDocument)return;const z=await rl(I);if(!z)throw new Error("Failed to build PS source buffer.");const X=zk(I.id,z.width,z.height,z.data),q=ac(I.id,X,"Initialize PS Document");za(I.id,{psDocument:q})},[rl,za,ac]),Ag=j.useCallback(async()=>{if(Ce){_t("PS Mode is locked and cannot be closed in this build.");return}const I=!Ce;if(I&&C){Ct("Preparing PS Mode Float32 source...");try{await ic(C)}catch(z){_t(`PS Mode init failed: ${z.message||z}`),Ct(null);return}Ct(null)}dt(I),I?(xe&&ue(!1),De&&qe(!1),rt&&wt(!1),pt&&de(!1),pr(0),gt([]),hr([]),rr(!1),hn(0)):(Rt(!1),ir(null),Ht("off"),Ee(null),Be(null),We(null))},[Ce,C,ic,xe,De,rt,pt]);j.useEffect(()=>{if(!Ce||!C||C.psDocument)return;let I=!1;return(async()=>{try{await ic(C)}catch(z){I||console.error("PS document auto-init failed:",z)}})(),()=>{I=!0}},[Ce,C,ic]),j.useEffect(()=>{if(!Ce||!ce){We(null);return}if(ge)return;let I=!1;return(async()=>{var Ne;let z=null;const X=ur.current,q=Ur.current,he=((Ne=$.current)==null?void 0:Ne.id)||ce.id;if(u)if(z=await hh.renderPreview(ce),z)Pr.current[he]=!0;else{const $e=hh.wasBusyLastRender(),pe=!!Pr.current[he];if($e||pe){I||(Xt.current&&clearTimeout(Xt.current),Xt.current=setTimeout(()=>{Xt.current=null,br(Je=>Je+1)},16));return}}z||(X&&q?z=g8(ce,q,X):z=l1(ce)),I||(We(z),X&&Be(null))})(),()=>{I=!0,Xt.current&&(clearTimeout(Xt.current),Xt.current=null)}},[Ce,ce,u,ge,tr]);const St=j.useCallback((I,z)=>{var Oe;const X=$.current;if(!(X!=null&&X.psDocument))return;const q={label:(z==null?void 0:z.label)||"PS Edit",trackHistory:(z==null?void 0:z.trackHistory)!==!1,transformOp:z==null?void 0:z.transformOp},he=I(X.psDocument);if(he===X.psDocument)return;if(!q.trackHistory){const Pt=A.current[X.id],mr=Pt?Wa(he,Pt):he;za(X.id,{psDocument:mr});return}let Ne=A.current[X.id];Ne||(Ne={entries:[{id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:"Initialize PS Document",timestamp:Date.now(),doc:mh(X.psDocument),transformOps:[]}],index:0});const $e=((Oe=Ne.entries[Ne.index])==null?void 0:Oe.transformOps)||[],pe=q.transformOp?[...$e,bO(q.transformOp)]:$e,Je=Ne.entries.slice(0,Ne.index+1);Je.push({id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:q.label,timestamp:Date.now(),doc:mh(he),transformOps:us(pe)});let Ve=Je.length-1;if(Je.length>P4){const Pt=Je.length-P4;Je.splice(0,Pt),Ve=Math.max(0,Ve-Pt)}const Ke={entries:Je,index:Ve};A.current[X.id]=Ke;const Nt=Wa(he,Ke);za(X.id,{psDocument:Nt})},[za,Wa]),Og=j.useCallback(()=>{const I=$.current;if(!(I!=null&&I.psDocument))return;const z=A.current[I.id];if(!z||z.index<=0)return;const X=z.index-1,q={...z,index:X};A.current[I.id]=q;const he=hy(q.entries[X].doc),Ne=Wa(he,q);za(I.id,{psDocument:Ne}),Be(null),We(null)},[za,Wa]),Tg=j.useCallback(I=>{const z=$.current;if(!(z!=null&&z.psDocument))return;const X=A.current[z.id];if(!X||I<0||I>=X.entries.length)return;const q={...X,index:I};A.current[z.id]=q;const he=hy(q.entries[I].doc),Ne=Wa(he,q);za(z.id,{psDocument:Ne}),Be(null),We(null)},[za,Wa]),qo=j.useCallback((I,z)=>{const X=URL.createObjectURL(I),q=document.createElement("a");q.href=X,q.download=z,document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(X)},[]),oc=j.useCallback((I,z,X)=>new Promise((q,he)=>{const Ne=document.createElement("canvas");Ne.width=I.width,Ne.height=I.height;const $e=Ne.getContext("2d");if(!$e){he(new Error("Failed to get 2D canvas context."));return}$e.putImageData(I,0,0),Ne.toBlob(pe=>{if(!pe){he(new Error("Failed to encode image blob."));return}q(pe)},z,X)}),[]),sc=j.useCallback(async()=>{const I=$.current;if(!I)return null;const z=T4(I.fileName);if(Ce&&I.psDocument){if(Ur.current)return{imageData:Ur.current,baseName:z};let X=null;if(u)if(X=await hh.renderPreview(I.psDocument),X)Pr.current[I.id]=!0;else{const q=hh.wasBusyLastRender(),he=!!Pr.current[I.id];if(q||he)return null}return X||(X=l1(I.psDocument)),{imageData:X,baseName:z}}if(Yn==="reference"&&I.referenceImageData)return{imageData:I.referenceImageData,baseName:z};if(Yn==="sampled"&&I.sampledImageData)return{imageData:I.sampledImageData,baseName:z};if(I.renderedRawImageData)return{imageData:I.renderedRawImageData,baseName:z};if(I.imageElement){const X=I.imageElement.naturalWidth||I.imageElement.width,q=I.imageElement.naturalHeight||I.imageElement.height,he=document.createElement("canvas");he.width=X,he.height=q;const Ne=he.getContext("2d");return Ne?(Ne.drawImage(I.imageElement,0,0,X,q),{imageData:Ne.getImageData(0,0,X,q),baseName:z}):null}return null},[Ce,u,Yn]),Eg=j.useCallback(async()=>{try{const I=await sc();if(!I){_t("No image available for PNG export.");return}const z=await oc(I.imageData,"image/png");qo(z,`${I.baseName}_ps_export_${Date.now()}.png`)}catch(I){_t(`PNG export failed: ${(I==null?void 0:I.message)||I}`)}},[sc,oc,qo]),Ig=j.useCallback(async()=>{try{const I=await sc();if(!I){_t("No image available for JPEG export.");return}const z=await oc(I.imageData,"image/jpeg",.92);qo(z,`${I.baseName}_ps_export_${Date.now()}.jpg`)}catch(I){_t(`JPEG export failed: ${(I==null?void 0:I.message)||I}`)}},[sc,oc,qo]),Rg=j.useCallback(async()=>{var z,X,q,he,Ne,$e;const I=$.current;if(!(I!=null&&I.psDocument)){_t("No PS workflow to export.");return}Ct("Exporting PS workflow...");try{const pe=I.psDocument,Je=((z=I.rawImageData)==null?void 0:z.width)||((X=I.imageElement)==null?void 0:X.naturalWidth)||((q=I.imageElement)==null?void 0:q.width)||pe.width,Ve=((he=I.rawImageData)==null?void 0:he.height)||((Ne=I.imageElement)==null?void 0:Ne.naturalHeight)||(($e=I.imageElement)==null?void 0:$e.height)||pe.height,Ke={signature:Nd,version:3,exportedAt:new Date().toISOString(),sourceFileName:I.fileName,sourceWidth:Je,sourceHeight:Ve,width:pe.width,height:pe.height,displaySettings:{...I.displaySettings},psUi:{brushEnabled:Wt,brushSize:kt,brushOpacity:xr,brushFeather:fr,ellipseFeather:tt,brushMode:Zt},flow:(()=>{var Mr,Kt;const mr=A.current[I.id],Yr=((Kt=(Mr=mr==null?void 0:mr.entries)==null?void 0:Mr[mr.index])==null?void 0:Kt.transformOps)||[];return C4(pe,Yr)})(),history:(()=>{const mr=A.current[I.id];if(!mr||mr.entries.length===0)return;const Yr=Math.max(0,Math.min(mr.entries.length-1,mr.index)),Mr=Math.max(0,Yr-ace+1),Kt=mr.entries.slice(Mr,Yr+1);return{index:Kt.length-1,entries:Kt.map(Ft=>({id:Ft.id,label:Ft.label,timestamp:Ft.timestamp,flow:C4(Ft.doc,Ft.transformOps||[])}))}})()},Oe=JSON.stringify({format:_4,version:1,payload:Ke}),Pt=new Blob([Oe],{type:"application/json;charset=utf-8"});qo(Pt,`${T4(I.fileName)}_ps_workflow.json`)}catch(pe){_t(`Export workflow failed: ${(pe==null?void 0:pe.message)||pe}`)}finally{Ct(null)}},[qo,Wt,kt,xr,fr,tt,Zt]),Dg=j.useCallback(async I=>{var X,q,he,Ne,$e,pe,Je;if(!$.current){_t("Load an image first, then import workflow file.");return}Ct("Importing PS workflow...");try{const Ve=$.current;if(!Ve)throw new Error("Session disappeared during import.");const Ke=await I.text(),Nt=Ke.trim();if(!Nt)throw new Error("Workflow file is empty.");let Oe=null;if(Nt.startsWith("{")){let $t;try{$t=JSON.parse(Nt)}catch{throw new Error("Invalid workflow JSON.")}const Zr=$t;if((Zr==null?void 0:Zr.format)===_4&&(Zr!=null&&Zr.payload))Oe=Zr.payload;else if($t!=null&&$t.payload&&((X=$t==null?void 0:$t.payload)==null?void 0:X.signature)===Nd)Oe=$t.payload;else if(($t==null?void 0:$t.signature)===Nd)Oe=$t;else throw new Error("Invalid workflow JSON signature.")}else{const $t={};if(Ke.split(/\r?\n/).map(Zr=>Zr.trim()).filter(Boolean).forEach(Zr=>{const Nn=cce(Zr);if(Nn.length<2)return;const Ca=O4(Nn[0]).trim().toLowerCase(),Aa=O4(Nn.slice(1).join(","));$t[Ca]=Aa}),$t.signature!==Nd)throw new Error("Invalid workflow CSV signature.");Oe=$t.payload_json?JSON.parse($t.payload_json):$t.payload_b64?JSON.parse(lce($t.payload_b64)):null}if(!Oe)throw new Error("Missing workflow payload.");if(Oe.signature!==Nd)throw new Error("Workflow payload signature mismatch.");const Pt=Number(Oe.sourceWidth||Oe.width),mr=Number(Oe.sourceHeight||Oe.height),Yr=((q=Ve.rawImageData)==null?void 0:q.width)||((he=Ve.imageElement)==null?void 0:he.naturalWidth)||((Ne=Ve.imageElement)==null?void 0:Ne.width)||Pt,Mr=(($e=Ve.rawImageData)==null?void 0:$e.height)||((pe=Ve.imageElement)==null?void 0:pe.naturalHeight)||((Je=Ve.imageElement)==null?void 0:Je.height)||mr;if(Pt!==Yr||mr!==Mr)throw new Error(`Source size mismatch: workflow expects ${Pt}x${mr}, current file is ${Yr}x${Mr}.`);const Kt=Number(Oe.width),Ft=Number(Oe.height);if(!Number.isFinite(Kt)||!Number.isFinite(Ft)||Kt<=0||Ft<=0)throw new Error("Invalid workflow canvas size.");const qr=await rl(Ve);if(!qr)throw new Error("Failed to rebuild source image for workflow import.");const jn=zk(Ve.id,qr.width,qr.height,qr.data),mn={width:Number(Oe.flow.width||Oe.width),height:Number(Oe.flow.height||Oe.height),transformOps:us(Oe.flow.transformOps||[]),masks:(Oe.flow.masks||[]).map($t=>({...$t,items:($t.items||[]).map(Ou)})),layers:(Oe.flow.layers||[]).map(pm),guides:(Oe.flow.guides||[]).map(Pl),selectedMaskId:Oe.flow.selectedMaskId||"",selectedLayerId:Oe.flow.selectedLayerId||"",selectedMaskItemId:Oe.flow.selectedMaskItemId??null,selectedGuideId:Oe.flow.selectedGuideId??null,transform:Oe.flow.transform?{rotationDeg:Number(Oe.flow.transform.rotationDeg)||0,crop:Oe.flow.transform.crop?{...Oe.flow.transform.crop}:null}:{rotationDeg:0,crop:null}},on=A4(jn,mn);let ii;const ma=Oe.history;if(ma&&Array.isArray(ma.entries)&&ma.entries.length>0){const $t=Number(ma.index),Zr=Number.isFinite($t)?Math.max(0,Math.min(ma.entries.length-1,$t)):ma.entries.length-1,Nn=Math.max(0,Zr-ice+1),Ca=ma.entries.slice(Nn,Zr+1),Aa=[];for(const cc of Ca){const ia=cc.flow||mn,Cw={width:Number(ia.width||mn.width),height:Number(ia.height||mn.height),transformOps:us(ia.transformOps||[]),masks:(ia.masks||[]).map(Aw=>({...Aw,items:(Aw.items||[]).map(Ou)})),layers:(ia.layers||[]).map(pm),guides:(ia.guides||[]).map(Pl),selectedMaskId:ia.selectedMaskId||"",selectedLayerId:ia.selectedLayerId||"",selectedMaskItemId:ia.selectedMaskItemId??null,selectedGuideId:ia.selectedGuideId??null,transform:ia.transform?{rotationDeg:Number(ia.transform.rotationDeg)||0,crop:ia.transform.crop?{...ia.transform.crop}:null}:{rotationDeg:0,crop:null}},p6=A4(jn,Cw);Aa.push({id:cc.id||`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:cc.label||"PS Edit",timestamp:Number(cc.timestamp)||Date.now(),doc:mh(p6),transformOps:us(Cw.transformOps||[])})}const Qo=Aa.length-1,Si={entries:Aa,index:Qo};A.current[Ve.id]=Si;const lc=hy(Aa[Qo].doc);ii=Wa(lc,Si)}else{const $t=us(mn.transformOps||[]);ii=ac(Ve.id,on,"Import Workflow",$t)}za(Ve.id,{psDocument:ii,displaySettings:Oe.displaySettings?{...Oe.displaySettings}:Ve.displaySettings}),Oe.psUi&&(Rt(!!Oe.psUi.brushEnabled),qt(Math.max(1,Number(Oe.psUi.brushSize)||32)),Ir(Math.max(0,Math.min(1,Number(Oe.psUi.brushOpacity)||.35))),be(Math.max(0,Math.min(1,Number(Oe.psUi.brushFeather)||0))),it(Math.max(0,Number(Oe.psUi.ellipseFeather)||0)),Vt(Oe.psUi.brushMode==="subtract"?"subtract":"add")),ir(null),Ht("off"),Ee(null),Be(null),We(null)}catch(Ve){_t(`Import workflow failed: ${(Ve==null?void 0:Ve.message)||Ve}`)}finally{Ct(null)}},[rl,ac,za,Wa]),Zo=j.useCallback(I=>{St(z=>{const X=z.layers.find(q=>q.id===I);return{...z,selectedLayerId:I,selectedMaskId:X?X.maskId:z.selectedMaskId}},{trackHistory:!1}),Be(null)},[St]),$g=j.useCallback(I=>{St(z=>YN(z,I),{trackHistory:!1}),Be(null)},[St]),Lg=j.useCallback(I=>{St(z=>o8(z,I),{trackHistory:!1})},[St]),x0=j.useCallback((I,z)=>{St(X=>s8(X,I,z),{label:"Edit Ellipse"}),Be(null)},[St]),Fg=j.useCallback((I,z)=>{St(X=>l8(X,I,z),{label:"Toggle Mask Overlay"})},[St]),Bg=j.useCallback(()=>{St(I=>Yv(I),{label:"Add Mask"}),Be(null)},[St]),y0=j.useCallback(()=>{Ht("center"),Ee(null)},[]),b0=j.useCallback(()=>{Ht("off"),Ee(null)},[]),v0=j.useCallback(I=>{yr==="center"&&(Ee({center:I,radiusX:1,radiusY:1,rotationDeg:0}),Ht("drag"))},[yr]),V=j.useCallback((I,z)=>{if(yr!=="drag"||!Dt)return;const X=I.x-Dt.center.x,q=I.y-Dt.center.y,he={...Dt,radiusX:Math.max(1,Math.abs(X)),radiusY:Math.max(1,Math.abs(q))};Ee(he),z==="end"&&(St(Ne=>n8(Ne,he,tt,Zt),{label:"Add Ellipse Item"}),Ht("off"),Ee(null),Be(null))},[yr,Dt,St,tt,Zt]),we=j.useCallback(()=>{if(!oe){_t("Create an ROI first, then crop.");return}const I={x:oe.x,y:oe.y,w:oe.width,h:oe.height};St(z=>JN(z,I),{label:"Crop To ROI",transformOp:{type:"crop",rect:I}}),Be(null),We(null),ke(null),K(null)},[St,oe]),bt=j.useCallback(I=>{St(z=>QN(z,I),{label:`Rotate ${I.toFixed(1)}deg`,transformOp:{type:"rotate",angleDeg:I}}),Be(null),We(null),ke(null),K(null)},[St]),lr=j.useCallback(()=>{St(I=>e_(I),{label:"Flip Horizontal",transformOp:{type:"flipH"}}),Be(null),We(null),ke(null),K(null)},[St]),zr=j.useCallback(()=>{St(I=>t_(I),{label:"Flip Vertical",transformOp:{type:"flipV"}}),Be(null),We(null),ke(null),K(null)},[St]),En=j.useCallback(()=>{var z,X;const I=(((X=(z=$.current)==null?void 0:z.psDocument)==null?void 0:X.guides)||[]).map(Pl);St(q=>n_(q),{label:"Apply Upright",transformOp:{type:"upright",guides:I}}),Be(null),We(null),ke(null),K(null)},[St]),Ar=j.useCallback(I=>{const z=yO(I);St(X=>r_(X,z),{label:z.lensLabel?`Lens Correction (${z.lensLabel})`:`Lens Correction (${z.model})`,transformOp:{type:"lensDistortion",params:z}}),Be(null),We(null),ke(null),K(null)},[St]),aa=j.useCallback(I=>{St(z=>e8(z,I),{label:`Add ${I==="horizontal"?"H":"V"} Guide`})},[St]),xo=j.useCallback(I=>{St(z=>t8(z,I),{trackHistory:!1})},[St]),ai=j.useCallback((I,z,X)=>{St(q=>Wk(q,I,z,X),{label:"Edit Guide"})},[St]),Jo=j.useCallback(I=>{ir(I)},[]),yo=j.useCallback(()=>{ir(null)},[]),pa=j.useCallback(I=>{const z=ot;z&&(St(X=>{if(!X.selectedGuideId)return X;const q=X.guides.find(Ne=>Ne.id===X.selectedGuideId);if(!q)return X;const he={x:I.x,y:I.y};return Wk(X,q.id,z==="p1"?he:q.p1,z==="p2"?he:q.p2)},{label:"Pick Guide Endpoint"}),ir(null))},[St,ot]),Gg=j.useCallback(I=>{St(z=>r8(z,I),{label:"Delete Guide"})},[St]),wO=j.useCallback((I,z)=>{St(X=>({...X,layers:X.layers.map(q=>q.id===I?{...q,maskId:z}:q),selectedLayerId:I,selectedMaskId:z}),{label:"Bind Layer To Mask"}),Be(null)},[St]),kO=j.useCallback((I,z)=>{St(X=>({...X,layers:X.layers.map(q=>q.id===I?{...q,blendMode:z}:q)}),{label:"Set Layer Blend"})},[St]),SO=j.useCallback((I,z)=>{St(X=>({...X,layers:X.layers.map(q=>q.id===I?{...q,opacity:Math.max(0,Math.min(1,z))}:q)}),{label:"Set Layer Opacity"})},[St]),MO=j.useCallback((I,z)=>{const X=Qc(z);St(q=>({...q,layers:q.layers.map(he=>he.id===I?{...he,basic:X}:he)}),{label:"Set Layer Basic"}),Be(null)},[St]),jO=j.useCallback((I,z)=>{const X=Qc(z);St(q=>({...q,layers:q.layers.map(he=>he.id===I?{...he,basic:X}:he)}),{trackHistory:!1}),Be(null)},[St]),NO=j.useCallback((I,z)=>{const X=eu(z);St(q=>({...q,layers:q.layers.map(he=>he.id===I?{...he,mixer:X}:he)}),{label:"Set Layer Mixer"}),Be(null)},[St]),_O=j.useCallback((I,z)=>{const X=eu(z);St(q=>({...q,layers:q.layers.map(he=>he.id===I?{...he,mixer:X}:he)}),{trackHistory:!1}),Be(null)},[St]),PO=j.useCallback((I,z)=>{var $e,pe;const X=Je=>{const Ve=(Je||[]).map(Ke=>({x:Math.max(0,Math.min(1,Number((Ke==null?void 0:Ke.x)??0))),y:Math.max(0,Math.min(1,Number((Ke==null?void 0:Ke.y)??0)))})).filter(Ke=>!Number.isNaN(Ke.x)&&!Number.isNaN(Ke.y)).sort((Ke,Nt)=>Ke.x-Nt.x);return Ve.length<2?[{x:0,y:0},{x:1,y:1}]:(Ve[0].x=0,Ve[Ve.length-1].x=1,Ve)};St(Je=>({...Je,layers:Je.layers.map(Ve=>Ve.id===I?{...Ve,curves:{master:X(z.master),red:X(z.red),green:X(z.green),blue:X(z.blue)}}:Ve)}),{label:`Edit ${I} Curves`});const q=$.current,he=($e=q==null?void 0:q.psDocument)==null?void 0:$e.layers.find(Je=>Je.id===I),Ne=he?(pe=q==null?void 0:q.psDocument)==null?void 0:pe.masks.find(Je=>Je.id===he.maskId):null;Be(Ne?ZE(Ne):null)},[St]),Ug=j.useCallback(I=>{Br.current.push({x:I.x,y:I.y}),St(X=>a8(X,I.x,I.y,kt,xr,Zt,fr),{trackHistory:!1});const z={x0:Math.floor(I.x-kt-2),y0:Math.floor(I.y-kt-2),x1:Math.ceil(I.x+kt+2),y1:Math.ceil(I.y+kt+2)};Be(X=>X?{x0:Math.min(X.x0,z.x0),y0:Math.min(X.y0,z.y0),x1:Math.max(X.x1,z.x1),y1:Math.max(X.y1,z.y1)}:z)},[St,kt,xr,Zt,fr]),CO=j.useCallback((I,z)=>{if(!Wt)return;if(z==="start"&&(ye(!0),Br.current=[]),z==="end"){er!==null&&(cancelAnimationFrame(er),B(null));const q=Hr.current;q&&Ug(q);const he=Br.current;he.length>0&&St(Ne=>i8(Ne,he,kt,xr,Zt,fr),{label:"Brush Stroke"}),Hr.current=null,Br.current=[],ye(!1);return}if(Hr.current=I,er!==null)return;const X=requestAnimationFrame(()=>{B(null);const q=Hr.current;q&&Ug(q)});B(X)},[Wt,er,Ug,St,kt,xr,Zt,fr]);j.useEffect(()=>()=>{er!==null&&cancelAnimationFrame(er)},[er]);const AO=I=>{if(!oe||!C)return;const z=Date.now().toString()+Math.random().toString().slice(2,5),X=Math.max(Le,..._e.map(Ne=>Ne.zIndex),100),q=_e.length%10*30,he=I==="fft"?{x:50,y:50}:I==="histogram"?{x:100,y:100}:{x:150,y:150};Te(Ne=>[...Ne,{id:z,type:I,roi:{x:oe.x,y:oe.y,w:oe.width,h:oe.height},zIndex:X+1,initialPosition:{x:he.x+q,y:he.y+q},sessionId:C.id,isBGGR:le,isMinimized:!1,stackFiles:(I==="fft"||I==="pearson"||I==="histogram")&&G.length>0?G:void 0}])},OO=I=>{Te(z=>z.filter(X=>X.id!==I))},TO=I=>{Te(z=>z.map(X=>X.id===I?{...X,isMinimized:!0}:X))},EO=I=>{Te(z=>z.map(X=>X.id===I?{...X,isMinimized:!1}:X)),bw(I)},bw=I=>{Te(z=>{const X=Math.max(Le,...z.map(q=>q.zIndex));return z.map(q=>q.id===I?{...q,zIndex:X+1}:q)})},IO=(I,z)=>{Te(X=>X.map(q=>q.id===I?{...q,internalState:{...q.internalState,...z}}:q))},ad=()=>{const I=Math.max(Le,..._e.map(z=>z.zIndex));ft(I+1)},RO=(I,z)=>{Te(X=>X.map(q=>q.id===I?{...q,roi:z}:q))};j.useEffect(()=>{if(!U)return;const I=U.CFAPattern2||U.CFAPattern;if(I){let z="";Array.isArray(I)?z=I.join(""):typeof I=="string"?z=I.replace(/[\s,]+/g,""):typeof I=="number"&&(z=String(I)),z==="0112"?fe(!1):z==="2110"&&fe(!0)}},[U]),j.useEffect(()=>{Ce||(Rt(!1),ir(null),Ht("off"),Ee(null),ye(!1),Be(null))},[Ce]),j.useEffect(()=>{(!Ce||!(re!=null&&re.selectedGuideId))&&ir(null)},[Ce,re==null?void 0:re.selectedGuideId]),j.useEffect(()=>{let I;const z=()=>{if(Mn&&Na){const X=Date.now()/1e3,q=.55+.45*Math.sin(X*an);Wi(q),I=requestAnimationFrame(z)}else Wi(1)};return Mn&&Na?z():Wi(1),()=>{I&&cancelAnimationFrame(I)}},[Mn,Na,an]),j.useEffect(()=>{const I=z=>{z.key==="Escape"&&Na&&(ae(!1),je({x:0,y:0}),Sr(!1))};return window.addEventListener("keydown",I),()=>window.removeEventListener("keydown",I)},[Na]),j.useEffect(()=>()=>{P.forEach(I=>{I.previewUrl&&URL.revokeObjectURL(I.previewUrl)}),go.current&&go.current.terminate()},[]);const id=async(I,z=!0)=>{var Ve;z&&(Yo({x:0,y:0}),Qu(1),Ga(0),Ua([]),Vi([]),xt(!1),Gt(null),se(!1),wt(!1),Jt([]),gt([]),pr(0),hr([]));let X=null;if(M.isConnected){const Ke=new FormData;Ke.append("file",I);try{const Oe=await(await fetch("http://localhost:5428/read",{method:"POST",body:Ke})).json();if(Oe.success){let Pt=Oe.data;Array.isArray(Pt)&&Pt.length===1&&(Pt=Pt[0]),X=Pt}}catch(Nt){console.warn("Auto Exif fetch failed",Nt)}}const q=I.name.toLowerCase(),he=N4.test(q),Ne=I.type==="image/x-adobe-dng"||/\.dng$/i.test(q),$e=/\.jdng$/i.test(q);let pe={file:I,exifData:X,psDocument:null};if($e)try{z?Ct("Processing JDNG file..."):na(!0);const Ke=await I.arrayBuffer(),{previewBlob:Nt,analysisData:Oe}=await Pse(Ke);pe.rawImageData=Oe,!X&&Oe.metadata&&(pe.exifData=Oe.metadata),pe.rawFileBuffer=null;const mr={exposure:0,demosaicMethod:-1,blackLevel:(((Ve=Oe.blackLevels)==null?void 0:Ve.length)||0)>=4?[Oe.blackLevels[0],Oe.blackLevels[1],Oe.blackLevels[2],Oe.blackLevels[3]]:void 0,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"standard"},Yr=ly(Oe,mr);pe.renderedRawImageData=Yr.imageData,pe.displaySettings=mr,pe.isThreePlane=Oe.isThreePlane||!1,pe.isXTransOriginal=!1,pe.isXTransConverted=!1,pe.originalRawFileBuffer=null,pe.xtransPhase={x:0,y:0};const Mr=URL.createObjectURL(Nt);pe.previewUrl=Mr;const Kt=new Image;Kt.src=Mr,await new Promise(Ft=>{Kt.onload=()=>{pe.imageElement=Kt,Ft()},Kt.onerror=()=>{_t("Could not load the JDNG preview image."),Ft()}})}catch(Ke){_t(`Failed to process JDNG file: ${Ke.message}`),Ct(null),na(!1);return}else if(he||Ne)try{z?Ct("Processing RAW file (this may take a moment)..."):na(!0);const Ke=await I.arrayBuffer();pe.rawFileBuffer=Ke;const{previewBlob:Nt,analysisData:Oe}=await fc(Ke);pe.rawImageData=Oe,!X&&Oe.metadata&&(pe.exifData=Oe.metadata),pe.isThreePlane=Oe.isThreePlane||!1,Oe.isThreePlane&&z&&se(!0);let Pt=!1,mr=null,Yr=!1;if(Oe.isXTrans){Yr=!0,mr=Ke;const Ft=(await X0(Ke,0,0)).dngBuffer,qr=await fc(Ft);pe.rawFileBuffer=Ft,pe.rawImageData=qr.analysisData,pe.previewUrl=URL.createObjectURL(qr.previewBlob),Pt=!0}else pe.previewUrl=URL.createObjectURL(Nt);pe.originalRawFileBuffer=mr,pe.isXTransOriginal=Yr,pe.isXTransConverted=Pt,pe.xtransPhase={x:0,y:0};const Mr=new Image;if(Mr.src=pe.previewUrl||"",await new Promise((Kt,Ft)=>{Mr.onload=()=>{pe.imageElement=Mr,Kt()},Mr.onerror=()=>{Kt()}}),z){const Kt=pe.rawImageData||Oe,Ft=dce(Kt,X||Kt.metadata);let qr;Ft&&Ft.some(on=>on>0)&&(qr=Ft);const jn={exposure:0,demosaicMethod:-1,blackLevel:qr,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dependency"},mn=pe.rawFileBuffer;if(mn&&(he||I.type==="image/x-adobe-dng"))try{const on=await _x(mn,jn);pe.renderedRawImageData=on,pe.displaySettings=jn}catch(on){console.error("Initial Zero-Dep Render Failed",on)}}}catch(Ke){_t(`Failed to process RAW file: ${Ke.message}`),Ct(null),na(!1);return}else try{Ct("Processing image...");const{previewBlob:Ke,analysisData:Nt}=await v_(I);pe.rawImageData=Nt,!X&&Nt.metadata&&(pe.exifData=Nt.metadata),pe.rawFileBuffer=await I.arrayBuffer(),pe.isThreePlane=Nt.isThreePlane||!1,pe.isXTransOriginal=!1,pe.isXTransConverted=!1,pe.originalRawFileBuffer=null;const Oe=URL.createObjectURL(Ke);pe.previewUrl=Oe;const Pt=new Image;Pt.src=Oe,await new Promise(mr=>{Pt.onload=()=>{pe.imageElement=Pt,mr()},Pt.onerror=()=>{_t("Could not load the image file."),mr()}})}catch(Ke){_t(`Failed to process image: ${Ke.message}`),Ct(null);return}const Je=Date.now().toString()+Math.random();if(pe.rawFileBuffer&&await zle(Je,pe.rawFileBuffer),z){const Ke={exposure:0,demosaicMethod:-1,blackLevel:void 0,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dependency"},Nt={id:Je,fileName:I.name,file:I,imageElement:null,rawImageData:null,rawFileBuffer:null,renderedRawImageData:null,referenceImageData:null,sampledImageData:null,exifData:null,isThreePlane:!1,displaySettings:Ke,originalRawFileBuffer:null,isXTransOriginal:!1,isXTransConverted:!1,xtransPhase:{x:0,y:0},psDocument:null,...pe};E(Oe=>{const Pt=[...Oe,Nt];return T(Pt.length-1),Pt})}else ni(pe);Ct(null),na(!1)},vw=j.useCallback(async()=>{const I=ph,z=ph,X=new Uint16Array(I*z),q=Math.max(2,Tt),he=bn*q;for(let Je=0;Je<z;Je++)for(let Ve=0;Ve<I;Ve++){const Ke=.5+.5*Math.sin(2*Math.PI*(Ve+he)/q);X[Je*I+Ve]=Math.round(1e3+Ke*9e3)}const Ne=Ch(I,z,X,[0,0,0,0],16383,"RGGB"),$e=new Blob([Ne],{type:"image/x-adobe-dng"}),pe=new File([$e],"pattern_test.dng",{type:"image/x-adobe-dng"});await id(pe,(O==null?void 0:O.name)!=="pattern_test.dng")},[Tt,bn,pn,O]),DO=I=>{var X;if(Ce){_t("Load Image is disabled while PS Mode is active."),I.target.value="";return}const z=(X=I.target.files)==null?void 0:X[0];z&&id(z,!0)},$O=async(I,z)=>{if(Ce){_t("Load Image is disabled while PS Mode is active.");return}if(z==="convert"){Ct("Converting RAW via Bridge...");try{const X=new FormData;X.append("file",I);const q=await fetch("http://localhost:5428/convert",{method:"POST",body:X});if(!q.ok)throw new Error("Conversion failed on server");const he=await q.blob(),Ne=new File([he],I.name.replace(/\.[^/.]+$/,"")+".dng",{type:"image/x-adobe-dng"});await id(Ne,!0)}catch(X){_t("DNG Conversion Failed: "+X.message)}finally{Ct(null)}}else id(I,!0)},LO=async(I,z,X,q)=>{Ct("Processing Pair Difference...");try{const he=await I.arrayBuffer(),Ne=await z.arrayBuffer(),$e=await Nx(he,Ne,X,q),pe=Ch($e.width,$e.height,$e.rawData,[32768,32768,32768,32768],65535,"RGGB"),Je=new Blob([pe],{type:"image/x-adobe-dng"}),Ve=new File([Je],`Diff_${I.name}_${z.name}.dng`,{type:"image/x-adobe-dng"});await id(Ve,!0)}catch(he){_t("Pair Processing Failed: "+he.message)}finally{Ct(null)}},FO=async I=>{const z=Array.from(I).sort((X,q)=>X.name.localeCompare(q.name,void 0,{numeric:!0}));if(z.length<2){_t("Need at least 2 files for batch diff.");return}Ct("Batch Difference Processing...");try{for(let X=0;X<z.length-1;X+=2){const q=z[X],he=z[X+1];Ct(`Processing pair ${X/2+1}: ${q.name} - ${he.name}`);const Ne=await q.arrayBuffer(),$e=await he.arrayBuffer(),pe=await Nx(Ne,$e,!1,!0),Je=Ch(pe.width,pe.height,pe.rawData,[32768,32768,32768,32768],65535,"RGGB"),Ve=new Blob([Je],{type:"image/x-adobe-dng"}),Ke=URL.createObjectURL(Ve),Nt=document.createElement("a");Nt.href=Ke,Nt.download=`Diff_${q.name}_vs_${he.name}.dng`,document.body.appendChild(Nt),Nt.click(),document.body.removeChild(Nt),URL.revokeObjectURL(Ke),await new Promise(Oe=>setTimeout(Oe,200))}}catch(X){_t("Batch Diff Failed: "+X.message)}finally{Ct(null)}},BO=I=>{L(Array.from(I)),Ct(`Loaded ${I.length} files for Stack FFT. Open Stack Lab to process.`),setTimeout(()=>Ct(null),2e3)},GO=()=>{et(!0)},UO=()=>{et(!1),_a("sampled"),Ct("Generating..."),setTimeout(()=>vw(),50)},w0=j.useRef({period:Tt,fill:pn,phase:bn});j.useEffect(()=>{(O==null?void 0:O.name)==="pattern_test.dng"&&(w0.current.period!==Tt||w0.current.fill!==pn||w0.current.phase!==bn)&&(w0.current={period:Tt,fill:pn,phase:bn},vw())},[Tt,pn,bn,O]);const zO=j.useCallback(async I=>{var Ne,$e;if(ni({displaySettings:I}),!$.current)return;const z=$.current,X=z.id;if(!!((Ne=z.rawImageData)!=null&&Ne.floatData)&&/\.jdng$/i.test(z.fileName||"")&&z.rawImageData){try{na(!0);const pe=ly(z.rawImageData,I);ni({renderedRawImageData:pe.imageData})}catch(pe){_t(`JDNG render failed: ${pe.message||pe}`)}finally{na(!1)}return}if(I.renderMode==="zero-dependency"||I.renderMode==="zero-dep-color"||I.renderMode==="advanced-zero-dep")if(u)try{na(!0);const pe=(($e=$.current.rawImageData)==null?void 0:$e.whiteLevel)||16383,Je=await Ya.render(X,I,pe);if(Je){ni({renderedRawImageData:Je}),na(!1);return}else throw new Error("WebGPU returned null frame.")}catch(pe){console.error("WebGPU Render failed:",pe),na(!1);return}else{_t("WebGPU not ready/supported. These modes require WebGPU.");return}if(!W)return;na(!0),go.current&&go.current.terminate();const he=new Worker(new URL("/assets/renderWorker-CpYFhYTH.js",import.meta.url),{type:"module"});go.current=he,he.onmessage=pe=>{const{success:Je,imageData:Ve,error:Ke}=pe.data;if(Je){let Nt=Ve;(O==null?void 0:O.name)==="pattern_test.dng"&&(Nt=uce(Ve,ph,ph)),ni({renderedRawImageData:Nt})}else _t(Ke||"Unknown worker error");na(!1),he.terminate(),go.current=null},he.postMessage({buffer:W.slice(0),settings:I})},[W,O,ni,u]),WO=async(I,z)=>{Ct("Re-sampling X-Trans with new Phase...");try{const q=(await X0(z,I.x,I.y)).dngBuffer,he=await fc(q),Ne=URL.createObjectURL(he.previewBlob),$e=new Image;$e.src=Ne,await new Promise(pe=>{$e.onload=()=>pe()}),C!=null&&C.previewUrl&&URL.revokeObjectURL(C.previewUrl),ni({rawFileBuffer:q,rawImageData:he.analysisData,previewUrl:Ne,imageElement:$e,xtransPhase:I}),ke(null)}catch(X){console.error("X-Trans Phase Update Failed",X),_t("Phase Update Failed: "+X.message)}finally{Ct(null)}},VO=I=>{if(!C||!C.originalRawFileBuffer||!C.isXTransConverted)return;const z={...C.xtransPhase,...I};WO(z,C.originalRawFileBuffer)},HO=j.useCallback(async I=>{if(C)if(I){if(C.isXTransConverted)return;const z=C.originalRawFileBuffer||C.rawFileBuffer;if(!z)return;Ct("Converting X-Trans to Pseudo-Bayer DNG...");try{const X=C.xtransPhase||{x:0,y:0},he=(await X0(z,X.x,X.y)).dngBuffer,Ne=await fc(he),$e=URL.createObjectURL(Ne.previewBlob),pe=new Image;pe.src=$e,await new Promise(Je=>{pe.onload=()=>Je()}),C.previewUrl&&URL.revokeObjectURL(C.previewUrl),ni({rawFileBuffer:he,rawImageData:Ne.analysisData,previewUrl:$e,imageElement:pe,isXTransConverted:!0,originalRawFileBuffer:z}),ke(null)}catch(X){console.error("X-Trans Conversion Failed",X),_t("Failed to convert X-Trans: "+X.message)}finally{Ct(null)}}else{if(!C.isXTransConverted)return;const z=C.originalRawFileBuffer;if(!z){_t("Original X-Trans buffer lost. Cannot revert.");return}Ct("Reverting to Native X-Trans...");try{const X=await fc(z),q=URL.createObjectURL(X.previewBlob),he=new Image;he.src=q,await new Promise(Ne=>{he.onload=()=>Ne()}),C.previewUrl&&URL.revokeObjectURL(C.previewUrl),ni({rawFileBuffer:z,rawImageData:X.analysisData,previewUrl:q,imageElement:he,isXTransConverted:!1}),ke(null)}catch(X){console.error("X-Trans Revert Failed",X),_t("Failed to revert X-Trans: "+X.message)}finally{Ct(null)}}},[C,ni]),ww=I=>{if(tl.current){const z=tl.current,{width:X,height:q}=z.getBoundingClientRect(),he=X/2,Ne=q/2,$e=I/el,pe=he-(he-Ko.x)*$e,Je=Ne-(Ne-Ko.y)*$e;Yo({x:pe,y:Je})}Qu(I)},kw=I=>{if(!I)return;if(!D){ke(null);return}if(Ze){I.w>0&&I.h>0&&hr(X=>[...X,I]);return}Pe&&Fe(!1);const z=nd(I);ke(z)},XO=I=>{K(I),kw(I)},KO=()=>{f0(I=>I==="pan"?"select":"pan")},YO=(I,z,X)=>{hr(q=>{if(q.length===0)return q;if(I==="move")return q.map(he=>({...he,x:he.x+z,y:he.y+X}));if(I==="scale"){const he=q.reduce(($e,pe)=>$e+pe.x+pe.w/2,0)/q.length,Ne=q.reduce(($e,pe)=>$e+pe.y+pe.h/2,0)/q.length;return q.map($e=>{const pe=$e.x+$e.w/2,Je=$e.y+$e.h/2,Ve=he+(pe-he)*z,Ke=Ne+(Je-Ne)*X,Nt=$e.w*z,Oe=$e.h*X;return{...$e,x:Ve-Nt/2,y:Ke-Oe/2,w:Nt,h:Oe}})}return q})},qO=()=>{if(sr.length===0){_t("No ROIs to save.");return}let I=`Index,X,Y,W,H,Orientation
`;sr.forEach((he,Ne)=>{I+=`${Ne+1},${he.x.toFixed(2)},${he.y.toFixed(2)},${he.w.toFixed(2)},${he.h.toFixed(2)},${he.ori||0}
`});const z=new Blob([I],{type:"text/csv;charset=utf-8;"}),X=URL.createObjectURL(z),q=document.createElement("a");q.setAttribute("href",X),q.setAttribute("download",`sfr_plate_template_${Date.now()}.csv`),document.body.appendChild(q),q.click(),document.body.removeChild(q),URL.revokeObjectURL(X)},ZO=I=>{if(!I||I.length===0){_t("No valid ROIs found in file.");return}hr(z=>[...z,...I])},Sw=I=>{if(sr.length===0){_t("ROIs ");return}if(!D||ne.renderMode!=="advanced-zero-dep"){_t("Advanced Zero-Dep (Unmixed) mode required for scalar SFR calc.");return}Ct("Computing Batch SFR..."),setTimeout(()=>{try{const z=[];for(const X of sr){const q=i2(D,X,ne),he=Hb(q.data,q.width,q.height,{x:0,y:0,w:q.width,h:q.height},{greenOnly:I.greenOnly,globalX:X.x,globalY:X.y,bayerPattern:D.bayerPattern});if(he){const Ne=I.useNR?-1:12,$e=iO([he],Ne,null,I.useDeshading);$e&&$e.mtf50!==null&&z.push({x:X.x+X.w/2,y:X.y+X.h/2,mtf50:$e.mtf50,orientation:he.orientation})}}if(z.length>0){const X=z.map(q=>`{${q.x.toFixed(1)},${q.y.toFixed(1)},${q.mtf50.toFixed(4)},${q.orientation}}`).join("");navigator.clipboard.writeText(X).then(()=>alert(`Computed ${z.length}/${sr.length} ROIs. Copied results to clipboard.`)).catch(q=>_t("Failed to copy results: "+q))}else _t("Failed to compute valid SFR for any selected ROIs.")}catch(z){_t("Batch Compute Failed: "+z.message)}finally{Ct(null)}},100)},JO=I=>{if(cn===0||cn>4)return;const z=[...fo,I];Ua(z),cn===4?(QO(z),Ga(0)):Ga(cn+1)},Mw=(I,z,X,q)=>{const he=I[0],Ne=I[1],$e=I[2],pe=I[3],Je=z/2,Ve=[];for(let Ke=0;Ke<X;Ke++){const Nt=X>1?Ke/(X-1):.5;for(let Oe=0;Oe<q;Oe++){const Pt=q>1?Oe/(q-1):.5,mr=he.x*(1-Pt)+Ne.x*Pt,Yr=he.y*(1-Pt)+Ne.y*Pt,Mr=$e.x*(1-Pt)+pe.x*Pt,Kt=$e.y*(1-Pt)+pe.y*Pt,Ft=mr*(1-Nt)+Mr*Nt,qr=Yr*(1-Nt)+Kt*Nt,jn=Ft-Je,mn=qr-Je;Ve.push({x:jn,y:mn,w:z,h:z})}}return Ve},QO=I=>{!D||!C||(Ct("Calculating DR Lab Grid..."),setTimeout(()=>{try{const z=Mw(I,po,Hi,Ye);Vi(z);const Ne=[...[`#BlackLevel: ${(ne.blackLevel||[0,0,0,0]).join(",")}`,`#ImageHeight: ${D.height}`],"Filename,Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std"],$e=`img${C.fileName||"image"}`;z.forEach((Nt,Oe)=>{const Pt=Math.floor(Oe/Ye)+1,mr=Oe%Ye+1,Yr=nl(D.data,D.width,D.height,Nt.x,Nt.y,Nt.w,Nt.h),Mr=Yr.means,Kt=Yr.stdDevs,Ft=`${$e},${Pt},${mr},${Mr[0].toFixed(4)},${Mr[1].toFixed(4)},${Mr[2].toFixed(4)},${Mr[3].toFixed(4)},${Kt[0].toFixed(4)},${Kt[1].toFixed(4)},${Kt[2].toFixed(4)},${Kt[3].toFixed(4)}`;Ne.push(Ft)});const pe=Ne.join(`
`),Je=new Blob([pe],{type:"text/csv;charset=utf-8;"}),Ve=URL.createObjectURL(Je),Ke=document.createElement("a");Ke.setAttribute("href",Ve),Ke.setAttribute("download","dr_lab_results.csv"),document.body.appendChild(Ke),Ke.click(),document.body.removeChild(Ke),URL.revokeObjectURL(Ve),Ua([])}catch(z){_t("DR Lab Error: "+z.message)}finally{Ct(null)}},100))},e6=async(I,z)=>{if(fo.length<4&&ho.length<1){_t("Please mark the grid on an image first before running batch processing.");return}let X=ho;if(X.length===0&&fo.length===4&&(X=Mw(fo,po,Hi,Ye)),X.length===0){_t("No grid definitions found. Mark corners first.");return}Ct(z==="pair"?"Batch Pair Difference (Sigma = Diff/sqrt(2))":"Batch Processing...");const he=(ne.blackLevel||[0,0,0,0]).join(","),Ne=D?D.height:0,pe=[...[`#BlackLevel: ${he}`,`#ImageHeight: ${Ne}`,z==="pair"?"#Mode: Pair Difference (Sigma = Diff/sqrt(2), Full Float Stats)":"#Mode: Independent"],"Filename,Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std"],Je=Array.from(I).sort((Oe,Pt)=>Oe.name.localeCompare(Pt.name,void 0,{numeric:!0}));if(z==="pair"&&Je.length<2){_t("Need at least 2 files for Pair processing."),Ct(null);return}const Ve=$.current,Ke=(Ve==null?void 0:Ve.isXTransConverted)||!1,Nt=(Ve==null?void 0:Ve.xtransPhase)||{x:0,y:0};try{const Oe=async Kt=>{let Ft=await Kt.arrayBuffer();return Ke&&(Ft=(await X0(Ft,Nt.x,Nt.y)).dngBuffer),Ft};if(z==="single")for(let Kt=0;Kt<Je.length;Kt++){const Ft=Je[Kt];Ct(`Processing ${Kt+1}/${Je.length}: ${Ft.name}...`);const qr=await Oe(Ft),jn=await Bl(qr),mn=`img${Ft.name}`;X.forEach((on,ii)=>{const ma=Math.floor(ii/Hi)+1,$t=ii%Ye+1,Zr=nl(jn.data,jn.width,jn.height,on.x,on.y,on.w,on.h),Nn=Zr.means,Ca=Zr.stdDevs,Aa=`${mn},${ma},${$t},${Nn[0].toFixed(4)},${Nn[1].toFixed(4)},${Nn[2].toFixed(4)},${Nn[3].toFixed(4)},${Ca[0].toFixed(4)},${Ca[1].toFixed(4)},${Ca[2].toFixed(4)},${Ca[3].toFixed(4)}`;pe.push(Aa)})}else for(let Kt=0;Kt<Je.length-1;Kt+=2){const Ft=Je[Kt],qr=Je[Kt+1],jn=`img${Ft.name} & ${qr.name}`;Ct(`Processing Pair ${Math.floor(Kt/2)+1}/${Math.floor(Je.length/2)}: ${Ft.name} & ${qr.name}...`);const mn=await Oe(Ft),on=await Bl(mn),ii=await Oe(qr),ma=await Nx(mn,ii,!1,!1);X.forEach(($t,Zr)=>{const Nn=Math.floor(Zr/Hi)+1,Ca=Zr%Ye+1,Aa=nl(on.data,on.width,on.height,$t.x,$t.y,$t.w,$t.h),Qo=nl(ma.rawData,ma.width,ma.height,$t.x,$t.y,$t.w,$t.h),Si=Aa.means,lc=Qo.stdDevs.map(ia=>ia/1.41421356),cc=`${jn},${Nn},${Ca},${Si[0].toFixed(4)},${Si[1].toFixed(4)},${Si[2].toFixed(4)},${Si[3].toFixed(4)},${lc[0].toFixed(4)},${lc[1].toFixed(4)},${lc[2].toFixed(4)},${lc[3].toFixed(4)}`;pe.push(cc)})}const Pt=pe.join(`
`),mr=new Blob([Pt],{type:"text/csv;charset=utf-8;"}),Yr=URL.createObjectURL(mr),Mr=document.createElement("a");Mr.href=Yr,Mr.setAttribute("download",`dr_lab_batch_${z}_${new Date().getTime()}.csv`),document.body.appendChild(Mr),Mr.click(),document.body.removeChild(Mr),URL.revokeObjectURL(Yr)}catch(Oe){console.error("Batch Error",Oe),_t("Batch Processing Failed: "+Oe.message)}finally{Ct(null)}},t6=()=>{Jt([]),pr(1)},r6=I=>{if(!rt||At===0)return;const z=[...Ot,I];Jt(z),z.length===4&&D?(jw(z,Tr),pr(0)):pr(X=>X+1)},jw=(I,z)=>{D&&(Ct("Analyzing Color Chart..."),setTimeout(()=>{try{const X=ose(I[0],I[1],I[2],I[3],D.width,D.height,z);gt(X);const he=X.map((Ne,$e)=>{const pe=nl(D.data,D.width,D.height,Ne.x,Ne.y,Ne.w,Ne.h);return{id:$e,rawMeans:pe.means,refRGB:[0,0,0]}}).map((Ne,$e)=>({...Ne,refRGB:Vb[$e]||[0,0,0]}));Dr(he),Ae(!0)}catch(X){_t("Color Lab Error: "+X.message)}finally{Ct(null)}},100))},n6=I=>{Cr(I),Ot.length===4&&jw(Ot,I)},a6=()=>{Ae(!1)},i6=()=>{U||Gt("No EXIF data found. The file might not contain metadata or it was stripped during processing."),xt(!0)},o6=async I=>{Ct("Parsing PTC Data...");const z=[];let X=null;try{for(let q=0;q<I.length;q++){const Ne=(await I[q].text()).split(`
`);let $e=!0;for(const pe of Ne){const Je=pe.trim();if(!Je)continue;if(Je.startsWith("#")){if(Je.includes("BlackLevel:")){const on=Je.split(":")[1].trim().split(",");if(on.length>=4){const ii=on.map(Number);X||(X={}),X.blackLevel=ii}}if(Je.includes("ImageHeight:")){const on=parseInt(Je.split(":")[1].trim());isNaN(on)||(X||(X={}),X.height=on)}continue}if($e){Je.toLowerCase().includes("mean")&&Je.toLowerCase().includes("std")&&($e=!1);continue}const Ve=Je.split(",");if(Ve.length<5)continue;let Ke=0,Nt;isNaN(parseFloat(Ve[0]))&&(Nt=Ve[0],Ke=1);const Oe=parseInt(Ve[Ke]),Pt=parseInt(Ve[Ke+1]),mr=parseFloat(Ve[Ke+2]),Yr=parseFloat(Ve[Ke+3]),Mr=parseFloat(Ve[Ke+4]),Kt=parseFloat(Ve[Ke+5]),Ft=parseFloat(Ve[Ke+6]),qr=parseFloat(Ve[Ke+7]),jn=parseFloat(Ve[Ke+8]),mn=parseFloat(Ve[Ke+9]);!isNaN(mr)&&!isNaN(Ft)&&z.push({channel:"R",mean:mr,std:Ft,filename:Nt,row:Oe,col:Pt}),!isNaN(Yr)&&!isNaN(qr)&&z.push({channel:"G1",mean:Yr,std:qr,filename:Nt,row:Oe,col:Pt}),!isNaN(Mr)&&!isNaN(jn)&&z.push({channel:"G2",mean:Mr,std:jn,filename:Nt,row:Oe,col:Pt}),!isNaN(Kt)&&!isNaN(mn)&&z.push({channel:"B",mean:Kt,std:mn,filename:Nt,row:Oe,col:Pt})}}Zs(z),rc(X),h(!0)}catch(q){console.error("PTC Parse Error",q),_t("Failed to parse CSV files: "+q.message)}finally{Ct(null)}},s6=()=>{if(!W||!C)return;const I=new Blob([W],{type:"image/x-adobe-dng"}),z=URL.createObjectURL(I),X=document.createElement("a");X.href=z;const q=C.fileName||"image.dng",he=q.toLowerCase().endsWith(".dng")?q:q.replace(/\.[^/.]+$/,"")+".dng";X.download=he,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(z)},l6=()=>{Ga(1),Ua([]),Vi([])},Nw=()=>{window.open("https://github.com/y-g-jiang/y-g-jiang.github.io/blob/main/drtest.png","_blank")},c6=j.useMemo(()=>vr?vr.map((I,z)=>({...I,refRGB:Vb[z]||[0,0,0]})):[],[vr]),u6=()=>{hn(1),Sn([]),hr([])},d6=I=>{if(Rr===0)return;const z=[...ra,I];if(Sn(z),z.length===4){hn(0);try{const X=ece(z);hr(X),Sw({useNR:!0,useDeshading:!0,greenOnly:!1})}catch(X){console.error("Standard Chart Gen Error",X),_t("Failed to generate chart ROIs.")}}else hn(X=>X+1)},f6=j.useMemo(()=>{if(!Ce||!re)return null;const I=re.masks.find(z=>z.id===re.selectedMaskId);return!I||!(I.overlayVisible??!0)?null:{alpha:I.alpha,width:I.width,height:I.height,version:I.version}},[Ce,re]),h6=j.useMemo(()=>{if(!Ce||!re||yr!=="off")return null;const I=re.masks.find(X=>X.id===re.selectedMaskId);if(!I)return null;const z=(I.items||[]).find(X=>X.id===re.selectedMaskItemId);return!z||z.type!=="ellipse"?null:{id:z.id,center:z.center,radiusX:z.radiusX,radiusY:z.radiusY,rotationDeg:z.rotationDeg}},[Ce,re,yr]);let k0=vt||H||F;Ce||(Yn==="reference"&&Y?k0=Y:Yn==="sampled"&&te&&(k0=te));const _w=nc||Kr;return c.jsxs("div",{className:"flex flex-col h-screen bg-[#d4d4d4] dark:bg-[#111111] text-black dark:text-gray-200 font-mono transition-colors duration-300 overflow-hidden",children:[c.jsx("div",{className:"p-4 pb-0 flex-shrink-0",children:c.jsx(zE,{onLoadImage:DO,onFileSelected:$O,onGenerateFakeDng:GO,fileName:O?O.name:null,hasGeneratedData:(O==null?void 0:O.name)==="pattern_test.dng",viewMode:Yn,onSetViewMode:_a,patternPeriod:Tt,onPatternPeriodChange:cr,fillFactor:pn,onFillFactorChange:ha,patternPhase:bn,onPatternPhaseChange:ki,showPatternControls:(O==null?void 0:O.name)==="pattern_test.dng",onOpenAbout:()=>mt(!0),onShowExif:i6,bridgeStatus:M,onBridgeClick:()=>_(!0),isDrLabOpen:xe,onToggleDrLab:()=>{if(Ce){_t("Cannot switch labs while PS Mode is locked.");return}ue(!xe),Ga(0),Ua([]),Vi([]),De&&qe(!1),rt&&wt(!1),pt&&de(!1),pr(0),gt([]),hr([]),rr(!1),hn(0)},isColorLabOpen:rt,onToggleColorLab:()=>{if(Ce){_t("Cannot switch labs while PS Mode is locked.");return}wt(!rt),Jt([]),pr(0),gt([]),xe&&ue(!1),De&&qe(!1),pt&&de(!1),hr([]),rr(!1),hn(0)},isFftLabOpen:De,onToggleFftLab:()=>{if(Ce){_t("Cannot switch labs while PS Mode is locked.");return}qe(!De),xe&&ue(!1),rt&&wt(!1),pt&&de(!1),pr(0),gt([]),hr([]),rr(!1),hn(0)},isSfrLabOpen:pt,onToggleSfrLab:()=>{if(Ce){_t("Cannot switch labs while PS Mode is locked.");return}de(!pt),xe&&ue(!1),rt&&wt(!1),De&&qe(!1),pr(0),gt([]),hr([]),rr(!1),hn(0)},isPsModeOpen:Ce,onTogglePsMode:Ag,onGenerateTestPic:Nw,onPTCFilesSelected:o6,onDownloadDng:s6,isThreePlane:Se,onOpenDatabase:()=>x(!0),isSidebarOpen:Xe,onToggleSidebar:()=>Ie(!Xe),stretchMultiplier:Me,onStretchMultiplierChange:Z,onStretchDngExport:Cg,isRawLoaded:!!D,onOpenSaveZ8:()=>v(!0)})}),c.jsxs("div",{className:"flex flex-1 overflow-hidden p-4 pt-2 gap-4 relative",children:[c.jsxs("div",{className:"flex-1 relative bg-gray-200 dark:bg-black border-4 border-gray-500 dark:border-gray-700 shadow-[inset_2px_2px_8px_rgba(0,0,0,0.2)] overflow-hidden transition-colors duration-300",ref:tl,children:[_w&&c.jsxs("div",{className:"absolute bottom-4 right-4 z-50 flex items-center gap-2 bg-white/90 dark:bg-black/90 px-3 py-1.5 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray]",children:[c.jsx("div",{className:"w-4 h-4 border-2 border-black dark:border-white border-t-transparent animate-spin"}),c.jsx("span",{className:"text-xs font-bold text-black dark:text-white uppercase",children:nc||"Processing..."})]}),u&&c.jsx("div",{className:"absolute top-2 left-2 z-30 pointer-events-none opacity-50 hover:opacity-100 transition-opacity",children:c.jsx("span",{className:"text-[9px] font-bold text-cyan-500 bg-black/50 px-1 py-0.5 rounded border border-cyan-500/50",children:" WebGPU"})}),P.length>1&&c.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 bg-white/90 dark:bg-slate-900/90 px-4 py-2 rounded-full shadow-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:rd,disabled:R===0,className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-full disabled:opacity-30",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsxs("span",{className:"font-mono text-xs font-bold text-gray-700 dark:text-gray-300",children:[R+1," / ",P.length]}),c.jsx("button",{onClick:td,disabled:R===P.length-1,className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-full disabled:opacity-30",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsxs("div",{className:"absolute bottom-4 left-4 z-40 flex flex-col-reverse gap-2 items-start pointer-events-none",children:[Pe&&oe&&c.jsxs("button",{onClick:()=>Fe(!1),className:"pointer-events-auto bg-white dark:bg-slate-800 border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] px-3 py-2 text-xs font-bold uppercase tracking-widest hover:translate-x-1 transition-transform flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"ROI Stats"]}),_e.filter(I=>I.isMinimized).map(I=>c.jsxs("button",{onClick:()=>EO(I.id),className:"pointer-events-auto bg-white dark:bg-slate-800 border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] px-3 py-2 text-xs font-bold uppercase tracking-widest hover:translate-x-1 transition-transform flex items-center gap-2",children:[c.jsx("span",{className:`w-2 h-2 rounded-full animate-pulse ${I.type==="histogram"?"bg-cyan-500":I.type==="fft"?"bg-purple-500":I.type==="quant"?"bg-teal-500":"bg-indigo-500"}`}),I.type==="histogram"?"Histogram":I.type==="fft"?"Power Spectrum":I.type==="quant"?"Quantization":"Pearson"]},I.id))]}),c.jsx(Yoe,{isOpen:He,onClose:()=>mt(!1)}),c.jsx(qoe,{isOpen:ht,onClose:()=>xt(!1),data:U,fileName:O?O.name:"",warning:nt}),c.jsx(Joe,{isOpen:f,onClose:()=>h(!1),data:Zu,blackLevel:mo,imageHeight:Xo,isBGGR:le,importedMetadata:Ju||void 0,theme:s,initialCameraModel:(U==null?void 0:U.Model)||"",initialISO:(U==null?void 0:U.ISO)||((Pw=U==null?void 0:U.ISOSpeedRatings)==null?void 0:Pw.toString())||""}),c.jsx(nse,{isOpen:p,onClose:()=>x(!1),theme:s}),c.jsx(ase,{isOpen:g,onClose:()=>b(!1),zIndex:200}),c.jsx(use,{isOpen:Xr,onClose:a6,patchStats:c6,initialIsBGGR:le,sizeRatio:Tr,onSizeChange:n6}),c.jsx(gse,{isOpen:pt,isSfrLabOpen:pt,onClose:()=>{},rawImageData:D,roi:oe?{x:oe.x,y:oe.y,w:oe.width,h:oe.height}:null,zIndex:200,onFocus:ad,displaySettings:ne}),c.jsx(yse,{isOpen:y,onClose:()=>m(!1),rawImageData:D,fileName:(O==null?void 0:O.name)||"image.dng",zIndex:300,onFocus:ad}),c.jsx(Ele,{isOpen:k,onClose:()=>S(!1),zIndex:350,onFocus:ad}),c.jsx(Lle,{isOpen:w,onClose:()=>v(!1),zIndex:400,onFocus:ad}),c.jsx(Is,{isOpen:yt,onClose:()=>et(!1),onConfirm:UO,title:"High Resource Usage Warning",confirmText:"I know the risk and insist to continue",message:c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("p",{children:"Patter DNG mode involves high-frequency refreshing and heavy computation. Due to current memory management limitations, repeated use may lead to browser memory overflow or crashes. Please proceed with caution."}),c.jsx("p",{className:"text-xs text-gray-500"})]})}),c.jsx(Is,{isOpen:N,onClose:()=>_(!1),onConfirm:()=>{window.open("https://y-g-jiang.github.io/jiangbridge.exe","_blank"),_(!1)},title:"JiangBridge Connection / ",confirmText:"Download Bridge App",cancelText:"Cancel",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsx("p",{className:"font-bold text-gray-800 dark:text-gray-200",children:"JiangBridge"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:'JiangBridge is optional for this webpage, but recommended for full functionality. Simply double-click and run it once after system startup. If the indicator light does not turn green after double-clicking, please consider checking whether the web page is allowed to "View and connect to any device on the network".'})]})}),c.jsx(Is,{isOpen:jt,onClose:()=>or(!1),onConfirm:h0,title:"Export 16-bit TIFF Options",confirmText:"Confirm Export",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-gray-50 dark:bg-slate-800/80 p-4 border border-gray-400 dark:border-600",children:[c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("span",{className:"font-bold text-xs text-gray-800 dark:text-slate-200",children:"Stretch ()"}),c.jsx("span",{className:"text-[9px] text-gray-500 dark:text-slate-400 mt-0.5",children:"Map [0, White] to [0, 65535]"})]}),c.jsx("div",{onClick:()=>ut(!zt),className:`relative w-12 h-6 border-2 border-black dark:border-white cursor-pointer ${zt?"bg-black dark:bg-white":"bg-gray-300 dark:bg-slate-600"}`,children:c.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white dark:bg-black shadow-sm transition-transform ${zt?"translate-x-6":""}`})})]}),c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("span",{className:"font-bold text-xs text-gray-800 dark:text-slate-200",children:"sRGB Gamma"}),c.jsx("span",{className:"text-[9px] text-gray-500 dark:text-slate-400 mt-0.5",children:"Apply non-linear contrast"})]}),c.jsx("div",{onClick:()=>Lt(!It),className:`relative w-12 h-6 border-2 border-black dark:border-white cursor-pointer ${It?"bg-black dark:bg-white":"bg-gray-300 dark:bg-slate-600"}`,children:c.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white dark:bg-black shadow-sm transition-transform ${It?"translate-x-6":""}`})})]})]}),c.jsxs("div",{className:"p-3 bg-gray-200 dark:bg-slate-800 text-[11px] text-black dark:text-white italic border border-gray-400 dark:border-gray-600 text-center font-mono",children:[zt&&!It&&"Mode: Stretched Linear. Histogram preserved but range expanded.",!zt&&It&&"Mode: Native DN + sRGB. Best for analyzing raw distribution contrast.",zt&&It&&"Mode: Ready-to-Use. Conventional 16-bit development.",!zt&&!It&&"Mode: Native Linear. Pure physical sensor DN values."]})]})}),!Pe&&c.jsx(fce,{stats:oe,onClose:()=>{ke(null),K(null)},onMinimize:()=>Fe(!0),isBGGR:le,onToggleBGGR:fe,onOpenWindow:AO,displaySettings:ne,zIndex:Le,onFocus:ad,rawImageData:D}),_e.map(I=>{if(I.isMinimized)return null;const z=P.find(he=>he.id===I.sessionId),X=z==null?void 0:z.rawImageData;if(!X)return null;const q={key:I.id,isOpen:!0,onClose:()=>OO(I.id),onMinimize:()=>TO(I.id),rawImageData:X,roi:I.roi,isBGGR:I.isBGGR,zIndex:I.zIndex,onFocus:()=>bw(I.id),initialPosition:I.initialPosition,initialInternalState:I.internalState,onUpdateState:he=>IO(I.id,he),stackFiles:I.stackFiles};return I.type==="histogram"?c.jsx(Boe,{...q}):I.type==="fft"?c.jsx(Woe,{...q,onUpdateROI:he=>RO(I.id,he)}):I.type==="quant"?c.jsx(Voe,{...q}):I.type==="pearson"?c.jsx(Hoe,{...q}):null}),Qs&&c.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/90 dark:bg-black/90 p-8",children:c.jsxs("div",{className:"max-w-md text-center p-6 bg-white dark:bg-black rounded-none border-2 border-red-600 shadow-[8px_8px_0px_rgba(200,0,0,0.5)]",children:[c.jsx("h3",{className:"text-xl font-bold text-red-600 uppercase mb-2",children:"Notice"}),c.jsx("p",{className:"text-black dark:text-white mb-6 whitespace-pre-wrap font-mono",children:Qs}),c.jsx("button",{onClick:()=>_t(null),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 border-2 border-black dark:border-white text-black dark:text-white transition-colors uppercase font-bold",children:"Dismiss"})]})}),!k0&&!_w&&!Qs&&c.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400 dark:text-gray-600 select-none font-mono",children:c.jsx("p",{className:"text-lg",children:"Load an image or generate a pattern"})}),c.jsx(WE,{image:k0,zoom:el,pan:Ko,onPanChange:Yo,onZoomChange:ww,onSelectionChange:kw,forcedSelection:Ue,theme:s,touchAction:Pa,isMarking:cn>0||rt&&At>0||Rr>0||Ce&&yr!=="off",onPointClick:I=>{cn>0?JO(I):rt&&At>0?r6(I):Rr>0&&d6(I)},markers:fo,gridRects:ho,colorLabPoints:Ot,colorLabRects:nr,sfrRects:sr,psMaskOverlay:f6,psMaskDirtyRect:st,psGuides:Ce&&re?re.guides:[],psSelectedGuideId:Ce&&re?re.selectedGuideId:null,psGuidePickTarget:Ce?ot:null,psEllipseTool:Ce?{mode:yr,draft:Dt}:{mode:"off",draft:null},psEditableEllipse:h6,psBrush:{enabled:Ce&&Wt,size:kt,opacity:xr,mode:Zt},onPsBrushPaint:CO,onPsGuidePickPoint:pa,onPsEllipseCenterPick:v0,onPsEllipseDrag:V,onPsEditEllipse:x0}),Rr>0&&ra.map((I,z)=>c.jsxs("div",{className:"absolute pointer-events-none z-30",style:{left:I.x*el+Ko.x,top:I.y*el+Ko.y,transform:"translate(-50%, -50%)"},children:[c.jsx("div",{className:"w-3 h-3 border-2 border-cyan-400 rounded-full flex items-center justify-center bg-transparent",children:c.jsx("div",{className:"w-1 h-1 bg-cyan-400 rounded-full"})}),c.jsx("div",{className:"text-[10px] font-bold text-cyan-400 absolute top-3 left-1/2 -translate-x-1/2 bg-black/50 px-1 rounded",children:z+1})]},z)),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/2 z-30 pointer-events-none select-none opacity-20 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-full h-auto drop-shadow-none",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-black dark:fill-white",fontSize:"26",fontWeight:"bold",style:{fontFamily:"Courier New, monospace",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),D&&!cn&&!rt&&!Ze&&!Rr&&c.jsxs("div",{className:"absolute bottom-4 left-4 z-30 pointer-events-none opacity-60 text-[10px] text-black dark:text-white font-mono bg-white/50 dark:bg-black/50 px-1",children:["Hold ",c.jsx("b",{children:"Shift"})," + Drag to calculate Raw ROI stats"]}),Ze&&c.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-red-500 bg-black/80 px-4 py-2 rounded-full border border-red-500 animate-pulse shadow-lg",children:"Manual Batch Marking Active (Shift+Drag to add)"}),Rr>0&&c.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-emerald-500 bg-black/80 px-4 py-2 rounded-full border border-emerald-500 animate-pulse shadow-lg",children:["Calibration: Click Corner ",Rr,"/4"]}),rt&&At>0&&c.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-yellow-500 bg-black/80 px-4 py-2 rounded-full border border-yellow-500 animate-pulse shadow-lg",children:[Ot.length===0&&"Click Top-Left Corner of Chart",Ot.length===1&&"Click Top-Right Corner",Ot.length===2&&"Click Bottom-Left Corner",Ot.length===3&&"Click Bottom-Right Corner",Ot.length===4&&"Processing..."]}),c.jsx(yI,{zoom:el,onZoomChange:ww,onResetView:()=>{Qu(1),Yo({x:0,y:0})},touchAction:Pa,onToggleTouchAction:KO})]}),Xe&&c.jsx("div",{className:"w-80 flex-shrink-0 bg-white dark:bg-black border-4 border-gray-500 dark:border-gray-700 shadow-[inset_2px_2px_8px_rgba(0,0,0,0.2)] overflow-hidden transition-all duration-300",children:c.jsx(uI,{rawImageData:D,displaySettings:ne,onApplyDisplaySettings:zO,onSetSelection:XO,exifData:U,isBridgeConnected:M.isConnected,isDrLabOpen:xe,drMarkingStep:cn,onStartMarking:l6,onGenerateTestPic:Nw,drRoiSize:po,onDrRoiSizeChange:Js,drGridRows:Hi,onDrGridRowsChange:Ho,drGridCols:Ye,onDrGridColsChange:dr,onBatchDrLab:e6,hasDrMarkers:ho.length>0,isFftLabOpen:De,onProcessPair:LO,onProcessBatchDiff:FO,onProcessStackFft:BO,onOpenCrossCalc:()=>b(!0),isThreePlane:Se,onToggleXTrans:HO,xtransPhase:J,onXTransPhaseChange:VO,isXTransConverted:C==null?void 0:C.isXTransConverted,roiStats:oe,isBGGR:le,isColorLabOpen:rt,colorLabMarkingStep:At,onStartColorLabMarking:t6,isSfrLabOpen:pt,onOpenDngExport:()=>m(!0),sfrRectCount:sr.length,isBatchMarkingMode:Ze,onToggleBatchMarking:()=>rr(!Ze),onClearBatchMarks:()=>hr([]),onBatchCompute:Sw,stdChartStep:Rr,onStartStandardCalibration:u6,onSaveBatchTemplate:qO,onImportBatchTemplate:ZO,onBatchTransform:YO,onOpenStackingTool:()=>S(!0),isPsModeOpen:Ce,psDocument:re,canCreatePsEllipse:!!re,psBrushEnabled:Wt,psBrushSize:kt,psBrushOpacity:xr,psBrushFeather:fr,psEllipseFeather:tt,psBrushMode:Zt,onPsAddMask:Bg,onPsAddEllipseMask:y0,onPsCancelEllipseTool:b0,onPsFlipHorizontal:lr,onPsFlipVertical:zr,onPsCropToRoi:we,onPsRotateCanvas:bt,onPsApplyUpright:En,onPsApplyLensDistortion:Ar,onPsSelectLayer:Zo,onPsSelectMask:$g,onPsBindLayerMask:wO,onPsSetLayerBlendMode:kO,onPsSetLayerOpacity:SO,onPsSetLayerBasic:MO,onPsSetLayerMixer:NO,onPsPreviewLayerBasic:jO,onPsPreviewLayerMixer:_O,onPsSetLayerCurves:PO,onPsSelectMaskItem:Lg,onPsUpdateEllipseItem:x0,onPsSetMaskOverlayVisible:Fg,onPsAddGuide:aa,onPsSelectGuide:xo,onPsSetGuideEndpoints:ai,psGuidePickTarget:ot,onPsStartGuidePointPick:Jo,onPsCancelGuidePointPick:yo,onPsDeleteGuide:Gg,onPsUndo:Og,onPsJumpHistoryIndex:Tg,onPsExportWorkflowCsv:Rg,onPsImportWorkflowCsv:Dg,onPsExportPng:Eg,onPsExportJpeg:Ig,onPsBrushEnabledChange:Rt,onPsBrushSizeChange:qt,onPsBrushOpacityChange:Ir,onPsBrushFeatherChange:be,onPsEllipseFeatherChange:it,onPsBrushModeChange:Vt})}),c.jsx(bI,{theme:s,setTheme:l})]})]})},vO=document.getElementById("root");if(!vO)throw new Error("Could not find root element to mount to");const pce=py.createRoot(vO);pce.render(c.jsx(ee.StrictMode,{children:c.jsx(hce,{})}));export{Mt as _};
