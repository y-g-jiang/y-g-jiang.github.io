var VA=Object.defineProperty;var HA=(e,t,r)=>t in e?VA(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var fr=(e,t,r)=>HA(e,typeof t!="symbol"?t+"":t,r);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();var g0=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Br(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var hj={exports:{}},rg={},pj={exports:{}},sr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wf=Symbol.for("react.element"),XA=Symbol.for("react.portal"),KA=Symbol.for("react.fragment"),YA=Symbol.for("react.strict_mode"),qA=Symbol.for("react.profiler"),ZA=Symbol.for("react.provider"),JA=Symbol.for("react.context"),QA=Symbol.for("react.forward_ref"),e6=Symbol.for("react.suspense"),t6=Symbol.for("react.memo"),r6=Symbol.for("react.lazy"),fw=Symbol.iterator;function n6(e){return e===null||typeof e!="object"?null:(e=fw&&e[fw]||e["@@iterator"],typeof e=="function"?e:null)}var gj={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},mj=Object.assign,xj={};function Mu(e,t,r){this.props=e,this.context=t,this.refs=xj,this.updater=r||gj}Mu.prototype.isReactComponent={};Mu.prototype.setState=function(e,t){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")};Mu.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function yj(){}yj.prototype=Mu.prototype;function Ib(e,t,r){this.props=e,this.context=t,this.refs=xj,this.updater=r||gj}var Rb=Ib.prototype=new yj;Rb.constructor=Ib;mj(Rb,Mu.prototype);Rb.isPureReactComponent=!0;var hw=Array.isArray,bj=Object.prototype.hasOwnProperty,Db={current:null},vj={key:!0,ref:!0,__self:!0,__source:!0};function wj(e,t,r){var n,a={},i=null,o=null;if(t!=null)for(n in t.ref!==void 0&&(o=t.ref),t.key!==void 0&&(i=""+t.key),t)bj.call(t,n)&&!vj.hasOwnProperty(n)&&(a[n]=t[n]);var s=arguments.length-2;if(s===1)a.children=r;else if(1<s){for(var l=Array(s),u=0;u<s;u++)l[u]=arguments[u+2];a.children=l}if(e&&e.defaultProps)for(n in s=e.defaultProps,s)a[n]===void 0&&(a[n]=s[n]);return{$$typeof:Wf,type:e,key:i,ref:o,props:a,_owner:Db.current}}function a6(e,t){return{$$typeof:Wf,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function $b(e){return typeof e=="object"&&e!==null&&e.$$typeof===Wf}function i6(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(r){return t[r]})}var pw=/\/+/g;function Nm(e,t){return typeof e=="object"&&e!==null&&e.key!=null?i6(""+e.key):t.toString(36)}function ah(e,t,r,n,a){var i=typeof e;(i==="undefined"||i==="boolean")&&(e=null);var o=!1;if(e===null)o=!0;else switch(i){case"string":case"number":o=!0;break;case"object":switch(e.$$typeof){case Wf:case XA:o=!0}}if(o)return o=e,a=a(o),e=n===""?"."+Nm(o,0):n,hw(a)?(r="",e!=null&&(r=e.replace(pw,"$&/")+"/"),ah(a,t,r,"",function(u){return u})):a!=null&&($b(a)&&(a=a6(a,r+(!a.key||o&&o.key===a.key?"":(""+a.key).replace(pw,"$&/")+"/")+e)),t.push(a)),1;if(o=0,n=n===""?".":n+":",hw(e))for(var s=0;s<e.length;s++){i=e[s];var l=n+Nm(i,s);o+=ah(i,t,r,l,a)}else if(l=n6(e),typeof l=="function")for(e=l.call(e),s=0;!(i=e.next()).done;)i=i.value,l=n+Nm(i,s++),o+=ah(i,t,r,l,a);else if(i==="object")throw t=String(e),Error("Objects are not valid as a React child (found: "+(t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return o}function m0(e,t,r){if(e==null)return e;var n=[],a=0;return ah(e,n,"","",function(i){return t.call(r,i,a++)}),n}function o6(e){if(e._status===-1){var t=e._result;t=t(),t.then(function(r){(e._status===0||e._status===-1)&&(e._status=1,e._result=r)},function(r){(e._status===0||e._status===-1)&&(e._status=2,e._result=r)}),e._status===-1&&(e._status=0,e._result=t)}if(e._status===1)return e._result.default;throw e._result}var ka={current:null},ih={transition:null},s6={ReactCurrentDispatcher:ka,ReactCurrentBatchConfig:ih,ReactCurrentOwner:Db};function kj(){throw Error("act(...) is not supported in production builds of React.")}sr.Children={map:m0,forEach:function(e,t,r){m0(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return m0(e,function(){t++}),t},toArray:function(e){return m0(e,function(t){return t})||[]},only:function(e){if(!$b(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};sr.Component=Mu;sr.Fragment=KA;sr.Profiler=qA;sr.PureComponent=Ib;sr.StrictMode=YA;sr.Suspense=e6;sr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s6;sr.act=kj;sr.cloneElement=function(e,t,r){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=mj({},e.props),a=e.key,i=e.ref,o=e._owner;if(t!=null){if(t.ref!==void 0&&(i=t.ref,o=Db.current),t.key!==void 0&&(a=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(l in t)bj.call(t,l)&&!vj.hasOwnProperty(l)&&(n[l]=t[l]===void 0&&s!==void 0?s[l]:t[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){s=Array(l);for(var u=0;u<l;u++)s[u]=arguments[u+2];n.children=s}return{$$typeof:Wf,type:e.type,key:a,ref:i,props:n,_owner:o}};sr.createContext=function(e){return e={$$typeof:JA,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:ZA,_context:e},e.Consumer=e};sr.createElement=wj;sr.createFactory=function(e){var t=wj.bind(null,e);return t.type=e,t};sr.createRef=function(){return{current:null}};sr.forwardRef=function(e){return{$$typeof:QA,render:e}};sr.isValidElement=$b;sr.lazy=function(e){return{$$typeof:r6,_payload:{_status:-1,_result:e},_init:o6}};sr.memo=function(e,t){return{$$typeof:t6,type:e,compare:t===void 0?null:t}};sr.startTransition=function(e){var t=ih.transition;ih.transition={};try{e()}finally{ih.transition=t}};sr.unstable_act=kj;sr.useCallback=function(e,t){return ka.current.useCallback(e,t)};sr.useContext=function(e){return ka.current.useContext(e)};sr.useDebugValue=function(){};sr.useDeferredValue=function(e){return ka.current.useDeferredValue(e)};sr.useEffect=function(e,t){return ka.current.useEffect(e,t)};sr.useId=function(){return ka.current.useId()};sr.useImperativeHandle=function(e,t,r){return ka.current.useImperativeHandle(e,t,r)};sr.useInsertionEffect=function(e,t){return ka.current.useInsertionEffect(e,t)};sr.useLayoutEffect=function(e,t){return ka.current.useLayoutEffect(e,t)};sr.useMemo=function(e,t){return ka.current.useMemo(e,t)};sr.useReducer=function(e,t,r){return ka.current.useReducer(e,t,r)};sr.useRef=function(e){return ka.current.useRef(e)};sr.useState=function(e){return ka.current.useState(e)};sr.useSyncExternalStore=function(e,t,r){return ka.current.useSyncExternalStore(e,t,r)};sr.useTransition=function(){return ka.current.useTransition()};sr.version="18.3.1";pj.exports=sr;var j=pj.exports;const re=Br(j);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var l6=j,c6=Symbol.for("react.element"),u6=Symbol.for("react.fragment"),d6=Object.prototype.hasOwnProperty,f6=l6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,h6={key:!0,ref:!0,__self:!0,__source:!0};function Sj(e,t,r){var n,a={},i=null,o=null;r!==void 0&&(i=""+r),t.key!==void 0&&(i=""+t.key),t.ref!==void 0&&(o=t.ref);for(n in t)d6.call(t,n)&&!h6.hasOwnProperty(n)&&(a[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps,t)a[n]===void 0&&(a[n]=t[n]);return{$$typeof:c6,type:e,key:i,ref:o,props:a,_owner:f6.current}}rg.Fragment=u6;rg.jsx=Sj;rg.jsxs=Sj;hj.exports=rg;var c=hj.exports,Jx={},jj={exports:{}},Ja={},Mj={exports:{}},_j={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function t(N,C){var B=N.length;N.push(C);e:for(;0<B;){var I=B-1>>>1,z=N[I];if(0<a(z,C))N[I]=C,N[B]=z,B=I;else break e}}function r(N){return N.length===0?null:N[0]}function n(N){if(N.length===0)return null;var C=N[0],B=N.pop();if(B!==C){N[0]=B;e:for(var I=0,z=N.length,V=z>>>1;I<V;){var K=2*(I+1)-1,q=N[K],G=K+1,pe=N[G];if(0>a(q,B))G<z&&0>a(pe,q)?(N[I]=pe,N[G]=B,I=G):(N[I]=q,N[K]=B,I=K);else if(G<z&&0>a(pe,B))N[I]=pe,N[G]=B,I=G;else break e}}return C}function a(N,C){var B=N.sortIndex-C.sortIndex;return B!==0?B:N.id-C.id}if(typeof performance=="object"&&typeof performance.now=="function"){var i=performance;e.unstable_now=function(){return i.now()}}else{var o=Date,s=o.now();e.unstable_now=function(){return o.now()-s}}var l=[],u=[],d=1,f=null,h=3,p=!1,x=!1,b=!1,y=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,g=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function k(N){for(var C=r(u);C!==null;){if(C.callback===null)n(u);else if(C.startTime<=N)n(u),C.sortIndex=C.expirationTime,t(l,C);else break;C=r(u)}}function S(N){if(b=!1,k(N),!x)if(r(l)!==null)x=!0,O(w);else{var C=r(u);C!==null&&$(S,C.startTime-N)}}function w(N,C){x=!1,b&&(b=!1,m(_),_=-1),p=!0;var B=h;try{for(k(C),f=r(l);f!==null&&(!(f.expirationTime>C)||N&&!R());){var I=f.callback;if(typeof I=="function"){f.callback=null,h=f.priorityLevel;var z=I(f.expirationTime<=C);C=e.unstable_now(),typeof z=="function"?f.callback=z:f===r(l)&&n(l),k(C)}else n(l);f=r(l)}if(f!==null)var V=!0;else{var K=r(u);K!==null&&$(S,K.startTime-C),V=!1}return V}finally{f=null,h=B,p=!1}}var v=!1,M=null,_=-1,P=5,A=-1;function R(){return!(e.unstable_now()-A<P)}function D(){if(M!==null){var N=e.unstable_now();A=N;var C=!0;try{C=M(!0,N)}finally{C?E():(v=!1,M=null)}}else v=!1}var E;if(typeof g=="function")E=function(){g(D)};else if(typeof MessageChannel<"u"){var W=new MessageChannel,F=W.port2;W.port1.onmessage=D,E=function(){F.postMessage(null)}}else E=function(){y(D,0)};function O(N){M=N,v||(v=!0,E())}function $(N,C){_=y(function(){N(e.unstable_now())},C)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(N){N.callback=null},e.unstable_continueExecution=function(){x||p||(x=!0,O(w))},e.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):P=0<N?Math.floor(1e3/N):5},e.unstable_getCurrentPriorityLevel=function(){return h},e.unstable_getFirstCallbackNode=function(){return r(l)},e.unstable_next=function(N){switch(h){case 1:case 2:case 3:var C=3;break;default:C=h}var B=h;h=C;try{return N()}finally{h=B}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(N,C){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var B=h;h=N;try{return C()}finally{h=B}},e.unstable_scheduleCallback=function(N,C,B){var I=e.unstable_now();switch(typeof B=="object"&&B!==null?(B=B.delay,B=typeof B=="number"&&0<B?I+B:I):B=I,N){case 1:var z=-1;break;case 2:z=250;break;case 5:z=1073741823;break;case 4:z=1e4;break;default:z=5e3}return z=B+z,N={id:d++,callback:C,priorityLevel:N,startTime:B,expirationTime:z,sortIndex:-1},B>I?(N.sortIndex=B,t(u,N),r(l)===null&&N===r(u)&&(b?(m(_),_=-1):b=!0,$(S,B-I))):(N.sortIndex=z,t(l,N),x||p||(x=!0,O(w))),N},e.unstable_shouldYield=R,e.unstable_wrapCallback=function(N){var C=h;return function(){var B=h;h=C;try{return N.apply(this,arguments)}finally{h=B}}}})(_j);Mj.exports=_j;var p6=Mj.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var g6=j,Za=p6;function Te(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Pj=new Set,zd={};function Wl(e,t){Gc(e,t),Gc(e+"Capture",t)}function Gc(e,t){for(zd[e]=t,e=0;e<t.length;e++)Pj.add(t[e])}var Ao=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Qx=Object.prototype.hasOwnProperty,m6=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,gw={},mw={};function x6(e){return Qx.call(mw,e)?!0:Qx.call(gw,e)?!1:m6.test(e)?mw[e]=!0:(gw[e]=!0,!1)}function y6(e,t,r,n){if(r!==null&&r.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function b6(e,t,r,n){if(t===null||typeof t>"u"||y6(e,t,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function Sa(e,t,r,n,a,i,o){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=n,this.attributeNamespace=a,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var Qn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){Qn[e]=new Sa(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];Qn[t]=new Sa(t,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){Qn[e]=new Sa(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){Qn[e]=new Sa(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){Qn[e]=new Sa(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){Qn[e]=new Sa(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){Qn[e]=new Sa(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){Qn[e]=new Sa(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){Qn[e]=new Sa(e,5,!1,e.toLowerCase(),null,!1,!1)});var Lb=/[\-:]([a-z])/g;function Bb(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(Lb,Bb);Qn[t]=new Sa(t,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(Lb,Bb);Qn[t]=new Sa(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(Lb,Bb);Qn[t]=new Sa(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){Qn[e]=new Sa(e,1,!1,e.toLowerCase(),null,!1,!1)});Qn.xlinkHref=new Sa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){Qn[e]=new Sa(e,1,!1,e.toLowerCase(),null,!0,!0)});function Fb(e,t,r,n){var a=Qn.hasOwnProperty(t)?Qn[t]:null;(a!==null?a.type!==0:n||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(b6(t,r,a,n)&&(r=null),n||a===null?x6(t)&&(r===null?e.removeAttribute(t):e.setAttribute(t,""+r)):a.mustUseProperty?e[a.propertyName]=r===null?a.type===3?!1:"":r:(t=a.attributeName,n=a.attributeNamespace,r===null?e.removeAttribute(t):(a=a.type,r=a===3||a===4&&r===!0?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}var Bo=g6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x0=Symbol.for("react.element"),hc=Symbol.for("react.portal"),pc=Symbol.for("react.fragment"),Gb=Symbol.for("react.strict_mode"),ey=Symbol.for("react.profiler"),Nj=Symbol.for("react.provider"),Cj=Symbol.for("react.context"),Ub=Symbol.for("react.forward_ref"),ty=Symbol.for("react.suspense"),ry=Symbol.for("react.suspense_list"),zb=Symbol.for("react.memo"),as=Symbol.for("react.lazy"),Oj=Symbol.for("react.offscreen"),xw=Symbol.iterator;function Qu(e){return e===null||typeof e!="object"?null:(e=xw&&e[xw]||e["@@iterator"],typeof e=="function"?e:null)}var sn=Object.assign,Cm;function vd(e){if(Cm===void 0)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);Cm=t&&t[1]||""}return`
`+Cm+e}var Om=!1;function Am(e,t){if(!e||Om)return"";Om=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(u){var n=u}Reflect.construct(e,[],t)}else{try{t.call()}catch(u){n=u}e.call(t.prototype)}else{try{throw Error()}catch(u){n=u}e()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var a=u.stack.split(`
`),i=n.stack.split(`
`),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(o!==1||s!==1)do if(o--,s--,0>s||a[o]!==i[s]){var l=`
`+a[o].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}while(1<=o&&0<=s);break}}}finally{Om=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?vd(e):""}function v6(e){switch(e.tag){case 5:return vd(e.type);case 16:return vd("Lazy");case 13:return vd("Suspense");case 19:return vd("SuspenseList");case 0:case 2:case 15:return e=Am(e.type,!1),e;case 11:return e=Am(e.type.render,!1),e;case 1:return e=Am(e.type,!0),e;default:return""}}function ny(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case pc:return"Fragment";case hc:return"Portal";case ey:return"Profiler";case Gb:return"StrictMode";case ty:return"Suspense";case ry:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case Cj:return(e.displayName||"Context")+".Consumer";case Nj:return(e._context.displayName||"Context")+".Provider";case Ub:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case zb:return t=e.displayName||null,t!==null?t:ny(e.type)||"Memo";case as:t=e._payload,e=e._init;try{return ny(e(t))}catch{}}return null}function w6(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ny(t);case 8:return t===Gb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function Is(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Aj(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function k6(e){var t=Aj(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var a=r.get,i=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(o){n=""+o,i.call(this,o)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function y0(e){e._valueTracker||(e._valueTracker=k6(e))}function Tj(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=Aj(e)?e.checked?"true":"false":e.value),e=n,e!==r?(t.setValue(e),!0):!1}function wh(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function ay(e,t){var r=t.checked;return sn({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??e._wrapperState.initialChecked})}function yw(e,t){var r=t.defaultValue==null?"":t.defaultValue,n=t.checked!=null?t.checked:t.defaultChecked;r=Is(t.value!=null?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function Ej(e,t){t=t.checked,t!=null&&Fb(e,"checked",t,!1)}function iy(e,t){Ej(e,t);var r=Is(t.value),n=t.type;if(r!=null)n==="number"?(r===0&&e.value===""||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if(n==="submit"||n==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?oy(e,t.type,r):t.hasOwnProperty("defaultValue")&&oy(e,t.type,Is(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function bw(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!(n!=="submit"&&n!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}r=e.name,r!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,r!==""&&(e.name=r)}function oy(e,t,r){(t!=="number"||wh(e.ownerDocument)!==e)&&(r==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var wd=Array.isArray;function Oc(e,t,r,n){if(e=e.options,t){t={};for(var a=0;a<r.length;a++)t["$"+r[a]]=!0;for(r=0;r<e.length;r++)a=t.hasOwnProperty("$"+e[r].value),e[r].selected!==a&&(e[r].selected=a),a&&n&&(e[r].defaultSelected=!0)}else{for(r=""+Is(r),t=null,a=0;a<e.length;a++){if(e[a].value===r){e[a].selected=!0,n&&(e[a].defaultSelected=!0);return}t!==null||e[a].disabled||(t=e[a])}t!==null&&(t.selected=!0)}}function sy(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(Te(91));return sn({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function vw(e,t){var r=t.value;if(r==null){if(r=t.children,t=t.defaultValue,r!=null){if(t!=null)throw Error(Te(92));if(wd(r)){if(1<r.length)throw Error(Te(93));r=r[0]}t=r}t==null&&(t=""),r=t}e._wrapperState={initialValue:Is(r)}}function Ij(e,t){var r=Is(t.value),n=Is(t.defaultValue);r!=null&&(r=""+r,r!==e.value&&(e.value=r),t.defaultValue==null&&e.defaultValue!==r&&(e.defaultValue=r)),n!=null&&(e.defaultValue=""+n)}function ww(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function Rj(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ly(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?Rj(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var b0,Dj=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,r,n,a){MSApp.execUnsafeLocalFunction(function(){return e(t,r,n,a)})}:e}(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(b0=b0||document.createElement("div"),b0.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=b0.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Wd(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&r.nodeType===3){r.nodeValue=t;return}}e.textContent=t}var Md={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},S6=["Webkit","ms","Moz","O"];Object.keys(Md).forEach(function(e){S6.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Md[t]=Md[e]})});function $j(e,t,r){return t==null||typeof t=="boolean"||t===""?"":r||typeof t!="number"||t===0||Md.hasOwnProperty(e)&&Md[e]?(""+t).trim():t+"px"}function Lj(e,t){e=e.style;for(var r in t)if(t.hasOwnProperty(r)){var n=r.indexOf("--")===0,a=$j(r,t[r],n);r==="float"&&(r="cssFloat"),n?e.setProperty(r,a):e[r]=a}}var j6=sn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function cy(e,t){if(t){if(j6[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(Te(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(Te(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(Te(61))}if(t.style!=null&&typeof t.style!="object")throw Error(Te(62))}}function uy(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var dy=null;function Wb(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var fy=null,Ac=null,Tc=null;function kw(e){if(e=Xf(e)){if(typeof fy!="function")throw Error(Te(280));var t=e.stateNode;t&&(t=sg(t),fy(e.stateNode,e.type,t))}}function Bj(e){Ac?Tc?Tc.push(e):Tc=[e]:Ac=e}function Fj(){if(Ac){var e=Ac,t=Tc;if(Tc=Ac=null,kw(e),t)for(e=0;e<t.length;e++)kw(t[e])}}function Gj(e,t){return e(t)}function Uj(){}var Tm=!1;function zj(e,t,r){if(Tm)return e(t,r);Tm=!0;try{return Gj(e,t,r)}finally{Tm=!1,(Ac!==null||Tc!==null)&&(Uj(),Fj())}}function Vd(e,t){var r=e.stateNode;if(r===null)return null;var n=sg(r);if(n===null)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(e=e.type,n=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!n;break e;default:e=!1}if(e)return null;if(r&&typeof r!="function")throw Error(Te(231,t,typeof r));return r}var hy=!1;if(Ao)try{var ed={};Object.defineProperty(ed,"passive",{get:function(){hy=!0}}),window.addEventListener("test",ed,ed),window.removeEventListener("test",ed,ed)}catch{hy=!1}function M6(e,t,r,n,a,i,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(r,u)}catch(d){this.onError(d)}}var _d=!1,kh=null,Sh=!1,py=null,_6={onError:function(e){_d=!0,kh=e}};function P6(e,t,r,n,a,i,o,s,l){_d=!1,kh=null,M6.apply(_6,arguments)}function N6(e,t,r,n,a,i,o,s,l){if(P6.apply(this,arguments),_d){if(_d){var u=kh;_d=!1,kh=null}else throw Error(Te(198));Sh||(Sh=!0,py=u)}}function Vl(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,t.flags&4098&&(r=t.return),e=t.return;while(e)}return t.tag===3?r:null}function Wj(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function Sw(e){if(Vl(e)!==e)throw Error(Te(188))}function C6(e){var t=e.alternate;if(!t){if(t=Vl(e),t===null)throw Error(Te(188));return t!==e?null:e}for(var r=e,n=t;;){var a=r.return;if(a===null)break;var i=a.alternate;if(i===null){if(n=a.return,n!==null){r=n;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===r)return Sw(a),e;if(i===n)return Sw(a),t;i=i.sibling}throw Error(Te(188))}if(r.return!==n.return)r=a,n=i;else{for(var o=!1,s=a.child;s;){if(s===r){o=!0,r=a,n=i;break}if(s===n){o=!0,n=a,r=i;break}s=s.sibling}if(!o){for(s=i.child;s;){if(s===r){o=!0,r=i,n=a;break}if(s===n){o=!0,n=i,r=a;break}s=s.sibling}if(!o)throw Error(Te(189))}}if(r.alternate!==n)throw Error(Te(190))}if(r.tag!==3)throw Error(Te(188));return r.stateNode.current===r?e:t}function Vj(e){return e=C6(e),e!==null?Hj(e):null}function Hj(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=Hj(e);if(t!==null)return t;e=e.sibling}return null}var Xj=Za.unstable_scheduleCallback,jw=Za.unstable_cancelCallback,O6=Za.unstable_shouldYield,A6=Za.unstable_requestPaint,mn=Za.unstable_now,T6=Za.unstable_getCurrentPriorityLevel,Vb=Za.unstable_ImmediatePriority,Kj=Za.unstable_UserBlockingPriority,jh=Za.unstable_NormalPriority,E6=Za.unstable_LowPriority,Yj=Za.unstable_IdlePriority,ng=null,qi=null;function I6(e){if(qi&&typeof qi.onCommitFiberRoot=="function")try{qi.onCommitFiberRoot(ng,e,void 0,(e.current.flags&128)===128)}catch{}}var Ii=Math.clz32?Math.clz32:$6,R6=Math.log,D6=Math.LN2;function $6(e){return e>>>=0,e===0?32:31-(R6(e)/D6|0)|0}var v0=64,w0=4194304;function kd(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Mh(e,t){var r=e.pendingLanes;if(r===0)return 0;var n=0,a=e.suspendedLanes,i=e.pingedLanes,o=r&268435455;if(o!==0){var s=o&~a;s!==0?n=kd(s):(i&=o,i!==0&&(n=kd(i)))}else o=r&~a,o!==0?n=kd(o):i!==0&&(n=kd(i));if(n===0)return 0;if(t!==0&&t!==n&&!(t&a)&&(a=n&-n,i=t&-t,a>=i||a===16&&(i&4194240)!==0))return t;if(n&4&&(n|=r&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=n;0<t;)r=31-Ii(t),a=1<<r,n|=e[r],t&=~a;return n}function L6(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function B6(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-Ii(i),s=1<<o,l=a[o];l===-1?(!(s&r)||s&n)&&(a[o]=L6(s,t)):l<=t&&(e.expiredLanes|=s),i&=~s}}function gy(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function qj(){var e=v0;return v0<<=1,!(v0&4194240)&&(v0=64),e}function Em(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Vf(e,t,r){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Ii(t),e[t]=r}function F6(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var a=31-Ii(r),i=1<<a;t[a]=0,n[a]=-1,e[a]=-1,r&=~i}}function Hb(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-Ii(r),a=1<<n;a&t|e[n]&t&&(e[n]|=t),r&=~a}}var Er=0;function Zj(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var Jj,Xb,Qj,eM,tM,my=!1,k0=[],Ss=null,js=null,Ms=null,Hd=new Map,Xd=new Map,ls=[],G6="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Mw(e,t){switch(e){case"focusin":case"focusout":Ss=null;break;case"dragenter":case"dragleave":js=null;break;case"mouseover":case"mouseout":Ms=null;break;case"pointerover":case"pointerout":Hd.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xd.delete(t.pointerId)}}function td(e,t,r,n,a,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:i,targetContainers:[a]},t!==null&&(t=Xf(t),t!==null&&Xb(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,a!==null&&t.indexOf(a)===-1&&t.push(a),e)}function U6(e,t,r,n,a){switch(t){case"focusin":return Ss=td(Ss,e,t,r,n,a),!0;case"dragenter":return js=td(js,e,t,r,n,a),!0;case"mouseover":return Ms=td(Ms,e,t,r,n,a),!0;case"pointerover":var i=a.pointerId;return Hd.set(i,td(Hd.get(i)||null,e,t,r,n,a)),!0;case"gotpointercapture":return i=a.pointerId,Xd.set(i,td(Xd.get(i)||null,e,t,r,n,a)),!0}return!1}function rM(e){var t=ll(e.target);if(t!==null){var r=Vl(t);if(r!==null){if(t=r.tag,t===13){if(t=Wj(r),t!==null){e.blockedOn=t,tM(e.priority,function(){Qj(r)});return}}else if(t===3&&r.stateNode.current.memoizedState.isDehydrated){e.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}e.blockedOn=null}function oh(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var r=xy(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(r===null){r=e.nativeEvent;var n=new r.constructor(r.type,r);dy=n,r.target.dispatchEvent(n),dy=null}else return t=Xf(r),t!==null&&Xb(t),e.blockedOn=r,!1;t.shift()}return!0}function _w(e,t,r){oh(e)&&r.delete(t)}function z6(){my=!1,Ss!==null&&oh(Ss)&&(Ss=null),js!==null&&oh(js)&&(js=null),Ms!==null&&oh(Ms)&&(Ms=null),Hd.forEach(_w),Xd.forEach(_w)}function rd(e,t){e.blockedOn===t&&(e.blockedOn=null,my||(my=!0,Za.unstable_scheduleCallback(Za.unstable_NormalPriority,z6)))}function Kd(e){function t(a){return rd(a,e)}if(0<k0.length){rd(k0[0],e);for(var r=1;r<k0.length;r++){var n=k0[r];n.blockedOn===e&&(n.blockedOn=null)}}for(Ss!==null&&rd(Ss,e),js!==null&&rd(js,e),Ms!==null&&rd(Ms,e),Hd.forEach(t),Xd.forEach(t),r=0;r<ls.length;r++)n=ls[r],n.blockedOn===e&&(n.blockedOn=null);for(;0<ls.length&&(r=ls[0],r.blockedOn===null);)rM(r),r.blockedOn===null&&ls.shift()}var Ec=Bo.ReactCurrentBatchConfig,_h=!0;function W6(e,t,r,n){var a=Er,i=Ec.transition;Ec.transition=null;try{Er=1,Kb(e,t,r,n)}finally{Er=a,Ec.transition=i}}function V6(e,t,r,n){var a=Er,i=Ec.transition;Ec.transition=null;try{Er=4,Kb(e,t,r,n)}finally{Er=a,Ec.transition=i}}function Kb(e,t,r,n){if(_h){var a=xy(e,t,r,n);if(a===null)zm(e,t,n,Ph,r),Mw(e,n);else if(U6(a,e,t,r,n))n.stopPropagation();else if(Mw(e,n),t&4&&-1<G6.indexOf(e)){for(;a!==null;){var i=Xf(a);if(i!==null&&Jj(i),i=xy(e,t,r,n),i===null&&zm(e,t,n,Ph,r),i===a)break;a=i}a!==null&&n.stopPropagation()}else zm(e,t,n,null,r)}}var Ph=null;function xy(e,t,r,n){if(Ph=null,e=Wb(n),e=ll(e),e!==null)if(t=Vl(e),t===null)e=null;else if(r=t.tag,r===13){if(e=Wj(t),e!==null)return e;e=null}else if(r===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Ph=e,null}function nM(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(T6()){case Vb:return 1;case Kj:return 4;case jh:case E6:return 16;case Yj:return 536870912;default:return 16}default:return 16}}var ds=null,Yb=null,sh=null;function aM(){if(sh)return sh;var e,t=Yb,r=t.length,n,a="value"in ds?ds.value:ds.textContent,i=a.length;for(e=0;e<r&&t[e]===a[e];e++);var o=r-e;for(n=1;n<=o&&t[r-n]===a[i-n];n++);return sh=a.slice(e,1<n?1-n:void 0)}function lh(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function S0(){return!0}function Pw(){return!1}function Qa(e){function t(r,n,a,i,o){this._reactName=r,this._targetInst=a,this.type=n,this.nativeEvent=i,this.target=o,this.currentTarget=null;for(var s in e)e.hasOwnProperty(s)&&(r=e[s],this[s]=r?r(i):i[s]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?S0:Pw,this.isPropagationStopped=Pw,this}return sn(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=S0)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=S0)},persist:function(){},isPersistent:S0}),t}var _u={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},qb=Qa(_u),Hf=sn({},_u,{view:0,detail:0}),H6=Qa(Hf),Im,Rm,nd,ag=sn({},Hf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zb,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==nd&&(nd&&e.type==="mousemove"?(Im=e.screenX-nd.screenX,Rm=e.screenY-nd.screenY):Rm=Im=0,nd=e),Im)},movementY:function(e){return"movementY"in e?e.movementY:Rm}}),Nw=Qa(ag),X6=sn({},ag,{dataTransfer:0}),K6=Qa(X6),Y6=sn({},Hf,{relatedTarget:0}),Dm=Qa(Y6),q6=sn({},_u,{animationName:0,elapsedTime:0,pseudoElement:0}),Z6=Qa(q6),J6=sn({},_u,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Q6=Qa(J6),eT=sn({},_u,{data:0}),Cw=Qa(eT),tT={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},rT={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nT={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function aT(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=nT[e])?!!t[e]:!1}function Zb(){return aT}var iT=sn({},Hf,{key:function(e){if(e.key){var t=tT[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=lh(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?rT[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zb,charCode:function(e){return e.type==="keypress"?lh(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?lh(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),oT=Qa(iT),sT=sn({},ag,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ow=Qa(sT),lT=sn({},Hf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zb}),cT=Qa(lT),uT=sn({},_u,{propertyName:0,elapsedTime:0,pseudoElement:0}),dT=Qa(uT),fT=sn({},ag,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),hT=Qa(fT),pT=[9,13,27,32],Jb=Ao&&"CompositionEvent"in window,Pd=null;Ao&&"documentMode"in document&&(Pd=document.documentMode);var gT=Ao&&"TextEvent"in window&&!Pd,iM=Ao&&(!Jb||Pd&&8<Pd&&11>=Pd),Aw=" ",Tw=!1;function oM(e,t){switch(e){case"keyup":return pT.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sM(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var gc=!1;function mT(e,t){switch(e){case"compositionend":return sM(t);case"keypress":return t.which!==32?null:(Tw=!0,Aw);case"textInput":return e=t.data,e===Aw&&Tw?null:e;default:return null}}function xT(e,t){if(gc)return e==="compositionend"||!Jb&&oM(e,t)?(e=aM(),sh=Yb=ds=null,gc=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return iM&&t.locale!=="ko"?null:t.data;default:return null}}var yT={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ew(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!yT[e.type]:t==="textarea"}function lM(e,t,r,n){Bj(n),t=Nh(t,"onChange"),0<t.length&&(r=new qb("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Nd=null,Yd=null;function bT(e){bM(e,0)}function ig(e){var t=yc(e);if(Tj(t))return e}function vT(e,t){if(e==="change")return t}var cM=!1;if(Ao){var $m;if(Ao){var Lm="oninput"in document;if(!Lm){var Iw=document.createElement("div");Iw.setAttribute("oninput","return;"),Lm=typeof Iw.oninput=="function"}$m=Lm}else $m=!1;cM=$m&&(!document.documentMode||9<document.documentMode)}function Rw(){Nd&&(Nd.detachEvent("onpropertychange",uM),Yd=Nd=null)}function uM(e){if(e.propertyName==="value"&&ig(Yd)){var t=[];lM(t,Yd,e,Wb(e)),zj(bT,t)}}function wT(e,t,r){e==="focusin"?(Rw(),Nd=t,Yd=r,Nd.attachEvent("onpropertychange",uM)):e==="focusout"&&Rw()}function kT(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ig(Yd)}function ST(e,t){if(e==="click")return ig(t)}function jT(e,t){if(e==="input"||e==="change")return ig(t)}function MT(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var Di=typeof Object.is=="function"?Object.is:MT;function qd(e,t){if(Di(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var a=r[n];if(!Qx.call(t,a)||!Di(e[a],t[a]))return!1}return!0}function Dw(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function $w(e,t){var r=Dw(e);e=0;for(var n;r;){if(r.nodeType===3){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=Dw(r)}}function dM(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?dM(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function fM(){for(var e=window,t=wh();t instanceof e.HTMLIFrameElement;){try{var r=typeof t.contentWindow.location.href=="string"}catch{r=!1}if(r)e=t.contentWindow;else break;t=wh(e.document)}return t}function Qb(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function _T(e){var t=fM(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&dM(r.ownerDocument.documentElement,r)){if(n!==null&&Qb(r)){if(t=n.start,e=n.end,e===void 0&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if(e=(t=r.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var a=r.textContent.length,i=Math.min(n.start,a);n=n.end===void 0?i:Math.min(n.end,a),!e.extend&&i>n&&(a=n,n=i,i=a),a=$w(r,i);var o=$w(r,n);a&&o&&(e.rangeCount!==1||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&(t=t.createRange(),t.setStart(a.node,a.offset),e.removeAllRanges(),i>n?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}}for(t=[],e=r;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<t.length;r++)e=t[r],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var PT=Ao&&"documentMode"in document&&11>=document.documentMode,mc=null,yy=null,Cd=null,by=!1;function Lw(e,t,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;by||mc==null||mc!==wh(n)||(n=mc,"selectionStart"in n&&Qb(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Cd&&qd(Cd,n)||(Cd=n,n=Nh(yy,"onSelect"),0<n.length&&(t=new qb("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=mc)))}function j0(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var xc={animationend:j0("Animation","AnimationEnd"),animationiteration:j0("Animation","AnimationIteration"),animationstart:j0("Animation","AnimationStart"),transitionend:j0("Transition","TransitionEnd")},Bm={},hM={};Ao&&(hM=document.createElement("div").style,"AnimationEvent"in window||(delete xc.animationend.animation,delete xc.animationiteration.animation,delete xc.animationstart.animation),"TransitionEvent"in window||delete xc.transitionend.transition);function og(e){if(Bm[e])return Bm[e];if(!xc[e])return e;var t=xc[e],r;for(r in t)if(t.hasOwnProperty(r)&&r in hM)return Bm[e]=t[r];return e}var pM=og("animationend"),gM=og("animationiteration"),mM=og("animationstart"),xM=og("transitionend"),yM=new Map,Bw="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function $s(e,t){yM.set(e,t),Wl(t,[e])}for(var Fm=0;Fm<Bw.length;Fm++){var Gm=Bw[Fm],NT=Gm.toLowerCase(),CT=Gm[0].toUpperCase()+Gm.slice(1);$s(NT,"on"+CT)}$s(pM,"onAnimationEnd");$s(gM,"onAnimationIteration");$s(mM,"onAnimationStart");$s("dblclick","onDoubleClick");$s("focusin","onFocus");$s("focusout","onBlur");$s(xM,"onTransitionEnd");Gc("onMouseEnter",["mouseout","mouseover"]);Gc("onMouseLeave",["mouseout","mouseover"]);Gc("onPointerEnter",["pointerout","pointerover"]);Gc("onPointerLeave",["pointerout","pointerover"]);Wl("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Wl("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Wl("onBeforeInput",["compositionend","keypress","textInput","paste"]);Wl("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Wl("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Sd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),OT=new Set("cancel close invalid load scroll toggle".split(" ").concat(Sd));function Fw(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,N6(n,t,void 0,e),e.currentTarget=null}function bM(e,t){t=(t&4)!==0;for(var r=0;r<e.length;r++){var n=e[r],a=n.event;n=n.listeners;e:{var i=void 0;if(t)for(var o=n.length-1;0<=o;o--){var s=n[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==i&&a.isPropagationStopped())break e;Fw(a,s,u),i=l}else for(o=0;o<n.length;o++){if(s=n[o],l=s.instance,u=s.currentTarget,s=s.listener,l!==i&&a.isPropagationStopped())break e;Fw(a,s,u),i=l}}}if(Sh)throw e=py,Sh=!1,py=null,e}function Xr(e,t){var r=t[jy];r===void 0&&(r=t[jy]=new Set);var n=e+"__bubble";r.has(n)||(vM(t,e,2,!1),r.add(n))}function Um(e,t,r){var n=0;t&&(n|=4),vM(r,e,n,t)}var M0="_reactListening"+Math.random().toString(36).slice(2);function Zd(e){if(!e[M0]){e[M0]=!0,Pj.forEach(function(r){r!=="selectionchange"&&(OT.has(r)||Um(r,!1,e),Um(r,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[M0]||(t[M0]=!0,Um("selectionchange",!1,t))}}function vM(e,t,r,n){switch(nM(t)){case 1:var a=W6;break;case 4:a=V6;break;default:a=Kb}r=a.bind(null,t,r,e),a=void 0,!hy||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(a=!0),n?a!==void 0?e.addEventListener(t,r,{capture:!0,passive:a}):e.addEventListener(t,r,!0):a!==void 0?e.addEventListener(t,r,{passive:a}):e.addEventListener(t,r,!1)}function zm(e,t,r,n,a){var i=n;if(!(t&1)&&!(t&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var s=n.stateNode.containerInfo;if(s===a||s.nodeType===8&&s.parentNode===a)break;if(o===4)for(o=n.return;o!==null;){var l=o.tag;if((l===3||l===4)&&(l=o.stateNode.containerInfo,l===a||l.nodeType===8&&l.parentNode===a))return;o=o.return}for(;s!==null;){if(o=ll(s),o===null)return;if(l=o.tag,l===5||l===6){n=i=o;continue e}s=s.parentNode}}n=n.return}zj(function(){var u=i,d=Wb(r),f=[];e:{var h=yM.get(e);if(h!==void 0){var p=qb,x=e;switch(e){case"keypress":if(lh(r)===0)break e;case"keydown":case"keyup":p=oT;break;case"focusin":x="focus",p=Dm;break;case"focusout":x="blur",p=Dm;break;case"beforeblur":case"afterblur":p=Dm;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=Nw;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=K6;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=cT;break;case pM:case gM:case mM:p=Z6;break;case xM:p=dT;break;case"scroll":p=H6;break;case"wheel":p=hT;break;case"copy":case"cut":case"paste":p=Q6;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Ow}var b=(t&4)!==0,y=!b&&e==="scroll",m=b?h!==null?h+"Capture":null:h;b=[];for(var g=u,k;g!==null;){k=g;var S=k.stateNode;if(k.tag===5&&S!==null&&(k=S,m!==null&&(S=Vd(g,m),S!=null&&b.push(Jd(g,S,k)))),y)break;g=g.return}0<b.length&&(h=new p(h,x,null,r,d),f.push({event:h,listeners:b}))}}if(!(t&7)){e:{if(h=e==="mouseover"||e==="pointerover",p=e==="mouseout"||e==="pointerout",h&&r!==dy&&(x=r.relatedTarget||r.fromElement)&&(ll(x)||x[To]))break e;if((p||h)&&(h=d.window===d?d:(h=d.ownerDocument)?h.defaultView||h.parentWindow:window,p?(x=r.relatedTarget||r.toElement,p=u,x=x?ll(x):null,x!==null&&(y=Vl(x),x!==y||x.tag!==5&&x.tag!==6)&&(x=null)):(p=null,x=u),p!==x)){if(b=Nw,S="onMouseLeave",m="onMouseEnter",g="mouse",(e==="pointerout"||e==="pointerover")&&(b=Ow,S="onPointerLeave",m="onPointerEnter",g="pointer"),y=p==null?h:yc(p),k=x==null?h:yc(x),h=new b(S,g+"leave",p,r,d),h.target=y,h.relatedTarget=k,S=null,ll(d)===u&&(b=new b(m,g+"enter",x,r,d),b.target=k,b.relatedTarget=y,S=b),y=S,p&&x)t:{for(b=p,m=x,g=0,k=b;k;k=oc(k))g++;for(k=0,S=m;S;S=oc(S))k++;for(;0<g-k;)b=oc(b),g--;for(;0<k-g;)m=oc(m),k--;for(;g--;){if(b===m||m!==null&&b===m.alternate)break t;b=oc(b),m=oc(m)}b=null}else b=null;p!==null&&Gw(f,h,p,b,!1),x!==null&&y!==null&&Gw(f,y,x,b,!0)}}e:{if(h=u?yc(u):window,p=h.nodeName&&h.nodeName.toLowerCase(),p==="select"||p==="input"&&h.type==="file")var w=vT;else if(Ew(h))if(cM)w=jT;else{w=kT;var v=wT}else(p=h.nodeName)&&p.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(w=ST);if(w&&(w=w(e,u))){lM(f,w,r,d);break e}v&&v(e,h,u),e==="focusout"&&(v=h._wrapperState)&&v.controlled&&h.type==="number"&&oy(h,"number",h.value)}switch(v=u?yc(u):window,e){case"focusin":(Ew(v)||v.contentEditable==="true")&&(mc=v,yy=u,Cd=null);break;case"focusout":Cd=yy=mc=null;break;case"mousedown":by=!0;break;case"contextmenu":case"mouseup":case"dragend":by=!1,Lw(f,r,d);break;case"selectionchange":if(PT)break;case"keydown":case"keyup":Lw(f,r,d)}var M;if(Jb)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else gc?oM(e,r)&&(_="onCompositionEnd"):e==="keydown"&&r.keyCode===229&&(_="onCompositionStart");_&&(iM&&r.locale!=="ko"&&(gc||_!=="onCompositionStart"?_==="onCompositionEnd"&&gc&&(M=aM()):(ds=d,Yb="value"in ds?ds.value:ds.textContent,gc=!0)),v=Nh(u,_),0<v.length&&(_=new Cw(_,e,null,r,d),f.push({event:_,listeners:v}),M?_.data=M:(M=sM(r),M!==null&&(_.data=M)))),(M=gT?mT(e,r):xT(e,r))&&(u=Nh(u,"onBeforeInput"),0<u.length&&(d=new Cw("onBeforeInput","beforeinput",null,r,d),f.push({event:d,listeners:u}),d.data=M))}bM(f,t)})}function Jd(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Nh(e,t){for(var r=t+"Capture",n=[];e!==null;){var a=e,i=a.stateNode;a.tag===5&&i!==null&&(a=i,i=Vd(e,r),i!=null&&n.unshift(Jd(e,i,a)),i=Vd(e,t),i!=null&&n.push(Jd(e,i,a))),e=e.return}return n}function oc(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Gw(e,t,r,n,a){for(var i=t._reactName,o=[];r!==null&&r!==n;){var s=r,l=s.alternate,u=s.stateNode;if(l!==null&&l===n)break;s.tag===5&&u!==null&&(s=u,a?(l=Vd(r,i),l!=null&&o.unshift(Jd(r,l,s))):a||(l=Vd(r,i),l!=null&&o.push(Jd(r,l,s)))),r=r.return}o.length!==0&&e.push({event:t,listeners:o})}var AT=/\r\n?/g,TT=/\u0000|\uFFFD/g;function Uw(e){return(typeof e=="string"?e:""+e).replace(AT,`
`).replace(TT,"")}function _0(e,t,r){if(t=Uw(t),Uw(e)!==t&&r)throw Error(Te(425))}function Ch(){}var vy=null,wy=null;function ky(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Sy=typeof setTimeout=="function"?setTimeout:void 0,ET=typeof clearTimeout=="function"?clearTimeout:void 0,zw=typeof Promise=="function"?Promise:void 0,IT=typeof queueMicrotask=="function"?queueMicrotask:typeof zw<"u"?function(e){return zw.resolve(null).then(e).catch(RT)}:Sy;function RT(e){setTimeout(function(){throw e})}function Wm(e,t){var r=t,n=0;do{var a=r.nextSibling;if(e.removeChild(r),a&&a.nodeType===8)if(r=a.data,r==="/$"){if(n===0){e.removeChild(a),Kd(t);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=a}while(r);Kd(t)}function _s(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Ww(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="$"||r==="$!"||r==="$?"){if(t===0)return e;t--}else r==="/$"&&t++}e=e.previousSibling}return null}var Pu=Math.random().toString(36).slice(2),Hi="__reactFiber$"+Pu,Qd="__reactProps$"+Pu,To="__reactContainer$"+Pu,jy="__reactEvents$"+Pu,DT="__reactListeners$"+Pu,$T="__reactHandles$"+Pu;function ll(e){var t=e[Hi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[To]||r[Hi]){if(r=t.alternate,t.child!==null||r!==null&&r.child!==null)for(e=Ww(e);e!==null;){if(r=e[Hi])return r;e=Ww(e)}return t}e=r,r=e.parentNode}return null}function Xf(e){return e=e[Hi]||e[To],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function yc(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(Te(33))}function sg(e){return e[Qd]||null}var My=[],bc=-1;function Ls(e){return{current:e}}function qr(e){0>bc||(e.current=My[bc],My[bc]=null,bc--)}function Hr(e,t){bc++,My[bc]=e.current,e.current=t}var Rs={},ua=Ls(Rs),Ea=Ls(!1),Pl=Rs;function Uc(e,t){var r=e.type.contextTypes;if(!r)return Rs;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var a={},i;for(i in r)a[i]=t[i];return n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function Ia(e){return e=e.childContextTypes,e!=null}function Oh(){qr(Ea),qr(ua)}function Vw(e,t,r){if(ua.current!==Rs)throw Error(Te(168));Hr(ua,t),Hr(Ea,r)}function wM(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var a in n)if(!(a in t))throw Error(Te(108,w6(e)||"Unknown",a));return sn({},r,n)}function Ah(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Rs,Pl=ua.current,Hr(ua,e),Hr(Ea,Ea.current),!0}function Hw(e,t,r){var n=e.stateNode;if(!n)throw Error(Te(169));r?(e=wM(e,t,Pl),n.__reactInternalMemoizedMergedChildContext=e,qr(Ea),qr(ua),Hr(ua,e)):qr(Ea),Hr(Ea,r)}var wo=null,lg=!1,Vm=!1;function kM(e){wo===null?wo=[e]:wo.push(e)}function LT(e){lg=!0,kM(e)}function Bs(){if(!Vm&&wo!==null){Vm=!0;var e=0,t=Er;try{var r=wo;for(Er=1;e<r.length;e++){var n=r[e];do n=n(!0);while(n!==null)}wo=null,lg=!1}catch(a){throw wo!==null&&(wo=wo.slice(e+1)),Xj(Vb,Bs),a}finally{Er=t,Vm=!1}}return null}var vc=[],wc=0,Th=null,Eh=0,si=[],li=0,Nl=null,ko=1,So="";function nl(e,t){vc[wc++]=Eh,vc[wc++]=Th,Th=e,Eh=t}function SM(e,t,r){si[li++]=ko,si[li++]=So,si[li++]=Nl,Nl=e;var n=ko;e=So;var a=32-Ii(n)-1;n&=~(1<<a),r+=1;var i=32-Ii(t)+a;if(30<i){var o=a-a%5;i=(n&(1<<o)-1).toString(32),n>>=o,a-=o,ko=1<<32-Ii(t)+a|r<<a|n,So=i+e}else ko=1<<i|r<<a|n,So=e}function ev(e){e.return!==null&&(nl(e,1),SM(e,1,0))}function tv(e){for(;e===Th;)Th=vc[--wc],vc[wc]=null,Eh=vc[--wc],vc[wc]=null;for(;e===Nl;)Nl=si[--li],si[li]=null,So=si[--li],si[li]=null,ko=si[--li],si[li]=null}var qa=null,Ya=null,en=!1,Ci=null;function jM(e,t){var r=ci(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,t=e.deletions,t===null?(e.deletions=[r],e.flags|=16):t.push(r)}function Xw(e,t){switch(e.tag){case 5:var r=e.type;return t=t.nodeType!==1||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,qa=e,Ya=_s(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,qa=e,Ya=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(r=Nl!==null?{id:ko,overflow:So}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},r=ci(18,null,null,0),r.stateNode=t,r.return=e,e.child=r,qa=e,Ya=null,!0):!1;default:return!1}}function _y(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Py(e){if(en){var t=Ya;if(t){var r=t;if(!Xw(e,t)){if(_y(e))throw Error(Te(418));t=_s(r.nextSibling);var n=qa;t&&Xw(e,t)?jM(n,r):(e.flags=e.flags&-4097|2,en=!1,qa=e)}}else{if(_y(e))throw Error(Te(418));e.flags=e.flags&-4097|2,en=!1,qa=e}}}function Kw(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;qa=e}function P0(e){if(e!==qa)return!1;if(!en)return Kw(e),en=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!ky(e.type,e.memoizedProps)),t&&(t=Ya)){if(_y(e))throw MM(),Error(Te(418));for(;t;)jM(e,t),t=_s(t.nextSibling)}if(Kw(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(Te(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var r=e.data;if(r==="/$"){if(t===0){Ya=_s(e.nextSibling);break e}t--}else r!=="$"&&r!=="$!"&&r!=="$?"||t++}e=e.nextSibling}Ya=null}}else Ya=qa?_s(e.stateNode.nextSibling):null;return!0}function MM(){for(var e=Ya;e;)e=_s(e.nextSibling)}function zc(){Ya=qa=null,en=!1}function rv(e){Ci===null?Ci=[e]:Ci.push(e)}var BT=Bo.ReactCurrentBatchConfig;function ad(e,t,r){if(e=r.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(Te(309));var n=r.stateNode}if(!n)throw Error(Te(147,e));var a=n,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(o){var s=a.refs;o===null?delete s[i]:s[i]=o},t._stringRef=i,t)}if(typeof e!="string")throw Error(Te(284));if(!r._owner)throw Error(Te(290,e))}return e}function N0(e,t){throw e=Object.prototype.toString.call(t),Error(Te(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Yw(e){var t=e._init;return t(e._payload)}function _M(e){function t(m,g){if(e){var k=m.deletions;k===null?(m.deletions=[g],m.flags|=16):k.push(g)}}function r(m,g){if(!e)return null;for(;g!==null;)t(m,g),g=g.sibling;return null}function n(m,g){for(m=new Map;g!==null;)g.key!==null?m.set(g.key,g):m.set(g.index,g),g=g.sibling;return m}function a(m,g){return m=Os(m,g),m.index=0,m.sibling=null,m}function i(m,g,k){return m.index=k,e?(k=m.alternate,k!==null?(k=k.index,k<g?(m.flags|=2,g):k):(m.flags|=2,g)):(m.flags|=1048576,g)}function o(m){return e&&m.alternate===null&&(m.flags|=2),m}function s(m,g,k,S){return g===null||g.tag!==6?(g=Jm(k,m.mode,S),g.return=m,g):(g=a(g,k),g.return=m,g)}function l(m,g,k,S){var w=k.type;return w===pc?d(m,g,k.props.children,S,k.key):g!==null&&(g.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===as&&Yw(w)===g.type)?(S=a(g,k.props),S.ref=ad(m,g,k),S.return=m,S):(S=gh(k.type,k.key,k.props,null,m.mode,S),S.ref=ad(m,g,k),S.return=m,S)}function u(m,g,k,S){return g===null||g.tag!==4||g.stateNode.containerInfo!==k.containerInfo||g.stateNode.implementation!==k.implementation?(g=Qm(k,m.mode,S),g.return=m,g):(g=a(g,k.children||[]),g.return=m,g)}function d(m,g,k,S,w){return g===null||g.tag!==7?(g=kl(k,m.mode,S,w),g.return=m,g):(g=a(g,k),g.return=m,g)}function f(m,g,k){if(typeof g=="string"&&g!==""||typeof g=="number")return g=Jm(""+g,m.mode,k),g.return=m,g;if(typeof g=="object"&&g!==null){switch(g.$$typeof){case x0:return k=gh(g.type,g.key,g.props,null,m.mode,k),k.ref=ad(m,null,g),k.return=m,k;case hc:return g=Qm(g,m.mode,k),g.return=m,g;case as:var S=g._init;return f(m,S(g._payload),k)}if(wd(g)||Qu(g))return g=kl(g,m.mode,k,null),g.return=m,g;N0(m,g)}return null}function h(m,g,k,S){var w=g!==null?g.key:null;if(typeof k=="string"&&k!==""||typeof k=="number")return w!==null?null:s(m,g,""+k,S);if(typeof k=="object"&&k!==null){switch(k.$$typeof){case x0:return k.key===w?l(m,g,k,S):null;case hc:return k.key===w?u(m,g,k,S):null;case as:return w=k._init,h(m,g,w(k._payload),S)}if(wd(k)||Qu(k))return w!==null?null:d(m,g,k,S,null);N0(m,k)}return null}function p(m,g,k,S,w){if(typeof S=="string"&&S!==""||typeof S=="number")return m=m.get(k)||null,s(g,m,""+S,w);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case x0:return m=m.get(S.key===null?k:S.key)||null,l(g,m,S,w);case hc:return m=m.get(S.key===null?k:S.key)||null,u(g,m,S,w);case as:var v=S._init;return p(m,g,k,v(S._payload),w)}if(wd(S)||Qu(S))return m=m.get(k)||null,d(g,m,S,w,null);N0(g,S)}return null}function x(m,g,k,S){for(var w=null,v=null,M=g,_=g=0,P=null;M!==null&&_<k.length;_++){M.index>_?(P=M,M=null):P=M.sibling;var A=h(m,M,k[_],S);if(A===null){M===null&&(M=P);break}e&&M&&A.alternate===null&&t(m,M),g=i(A,g,_),v===null?w=A:v.sibling=A,v=A,M=P}if(_===k.length)return r(m,M),en&&nl(m,_),w;if(M===null){for(;_<k.length;_++)M=f(m,k[_],S),M!==null&&(g=i(M,g,_),v===null?w=M:v.sibling=M,v=M);return en&&nl(m,_),w}for(M=n(m,M);_<k.length;_++)P=p(M,m,_,k[_],S),P!==null&&(e&&P.alternate!==null&&M.delete(P.key===null?_:P.key),g=i(P,g,_),v===null?w=P:v.sibling=P,v=P);return e&&M.forEach(function(R){return t(m,R)}),en&&nl(m,_),w}function b(m,g,k,S){var w=Qu(k);if(typeof w!="function")throw Error(Te(150));if(k=w.call(k),k==null)throw Error(Te(151));for(var v=w=null,M=g,_=g=0,P=null,A=k.next();M!==null&&!A.done;_++,A=k.next()){M.index>_?(P=M,M=null):P=M.sibling;var R=h(m,M,A.value,S);if(R===null){M===null&&(M=P);break}e&&M&&R.alternate===null&&t(m,M),g=i(R,g,_),v===null?w=R:v.sibling=R,v=R,M=P}if(A.done)return r(m,M),en&&nl(m,_),w;if(M===null){for(;!A.done;_++,A=k.next())A=f(m,A.value,S),A!==null&&(g=i(A,g,_),v===null?w=A:v.sibling=A,v=A);return en&&nl(m,_),w}for(M=n(m,M);!A.done;_++,A=k.next())A=p(M,m,_,A.value,S),A!==null&&(e&&A.alternate!==null&&M.delete(A.key===null?_:A.key),g=i(A,g,_),v===null?w=A:v.sibling=A,v=A);return e&&M.forEach(function(D){return t(m,D)}),en&&nl(m,_),w}function y(m,g,k,S){if(typeof k=="object"&&k!==null&&k.type===pc&&k.key===null&&(k=k.props.children),typeof k=="object"&&k!==null){switch(k.$$typeof){case x0:e:{for(var w=k.key,v=g;v!==null;){if(v.key===w){if(w=k.type,w===pc){if(v.tag===7){r(m,v.sibling),g=a(v,k.props.children),g.return=m,m=g;break e}}else if(v.elementType===w||typeof w=="object"&&w!==null&&w.$$typeof===as&&Yw(w)===v.type){r(m,v.sibling),g=a(v,k.props),g.ref=ad(m,v,k),g.return=m,m=g;break e}r(m,v);break}else t(m,v);v=v.sibling}k.type===pc?(g=kl(k.props.children,m.mode,S,k.key),g.return=m,m=g):(S=gh(k.type,k.key,k.props,null,m.mode,S),S.ref=ad(m,g,k),S.return=m,m=S)}return o(m);case hc:e:{for(v=k.key;g!==null;){if(g.key===v)if(g.tag===4&&g.stateNode.containerInfo===k.containerInfo&&g.stateNode.implementation===k.implementation){r(m,g.sibling),g=a(g,k.children||[]),g.return=m,m=g;break e}else{r(m,g);break}else t(m,g);g=g.sibling}g=Qm(k,m.mode,S),g.return=m,m=g}return o(m);case as:return v=k._init,y(m,g,v(k._payload),S)}if(wd(k))return x(m,g,k,S);if(Qu(k))return b(m,g,k,S);N0(m,k)}return typeof k=="string"&&k!==""||typeof k=="number"?(k=""+k,g!==null&&g.tag===6?(r(m,g.sibling),g=a(g,k),g.return=m,m=g):(r(m,g),g=Jm(k,m.mode,S),g.return=m,m=g),o(m)):r(m,g)}return y}var Wc=_M(!0),PM=_M(!1),Ih=Ls(null),Rh=null,kc=null,nv=null;function av(){nv=kc=Rh=null}function iv(e){var t=Ih.current;qr(Ih),e._currentValue=t}function Ny(e,t,r){for(;e!==null;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,n!==null&&(n.childLanes|=t)):n!==null&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Ic(e,t){Rh=e,nv=kc=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&t&&(Aa=!0),e.firstContext=null)}function pi(e){var t=e._currentValue;if(nv!==e)if(e={context:e,memoizedValue:t,next:null},kc===null){if(Rh===null)throw Error(Te(308));kc=e,Rh.dependencies={lanes:0,firstContext:e}}else kc=kc.next=e;return t}var cl=null;function ov(e){cl===null?cl=[e]:cl.push(e)}function NM(e,t,r,n){var a=t.interleaved;return a===null?(r.next=r,ov(t)):(r.next=a.next,a.next=r),t.interleaved=r,Eo(e,n)}function Eo(e,t){e.lanes|=t;var r=e.alternate;for(r!==null&&(r.lanes|=t),r=e,e=e.return;e!==null;)e.childLanes|=t,r=e.alternate,r!==null&&(r.childLanes|=t),r=e,e=e.return;return r.tag===3?r.stateNode:null}var is=!1;function sv(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function CM(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Po(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Ps(e,t,r){var n=e.updateQueue;if(n===null)return null;if(n=n.shared,br&2){var a=n.pending;return a===null?t.next=t:(t.next=a.next,a.next=t),n.pending=t,Eo(e,r)}return a=n.interleaved,a===null?(t.next=t,ov(n)):(t.next=a.next,a.next=t),n.interleaved=t,Eo(e,r)}function ch(e,t,r){if(t=t.updateQueue,t!==null&&(t=t.shared,(r&4194240)!==0)){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Hb(e,r)}}function qw(e,t){var r=e.updateQueue,n=e.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var a=null,i=null;if(r=r.firstBaseUpdate,r!==null){do{var o={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};i===null?a=i=o:i=i.next=o,r=r.next}while(r!==null);i===null?a=i=t:i=i.next=t}else a=i=t;r={baseState:n.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:n.shared,effects:n.effects},e.updateQueue=r;return}e=r.lastBaseUpdate,e===null?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Dh(e,t,r,n){var a=e.updateQueue;is=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(s!==null){a.shared.pending=null;var l=s,u=l.next;l.next=null,o===null?i=u:o.next=u,o=l;var d=e.alternate;d!==null&&(d=d.updateQueue,s=d.lastBaseUpdate,s!==o&&(s===null?d.firstBaseUpdate=u:s.next=u,d.lastBaseUpdate=l))}if(i!==null){var f=a.baseState;o=0,d=u=l=null,s=i;do{var h=s.lane,p=s.eventTime;if((n&h)===h){d!==null&&(d=d.next={eventTime:p,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var x=e,b=s;switch(h=t,p=r,b.tag){case 1:if(x=b.payload,typeof x=="function"){f=x.call(p,f,h);break e}f=x;break e;case 3:x.flags=x.flags&-65537|128;case 0:if(x=b.payload,h=typeof x=="function"?x.call(p,f,h):x,h==null)break e;f=sn({},f,h);break e;case 2:is=!0}}s.callback!==null&&s.lane!==0&&(e.flags|=64,h=a.effects,h===null?a.effects=[s]:h.push(s))}else p={eventTime:p,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},d===null?(u=d=p,l=f):d=d.next=p,o|=h;if(s=s.next,s===null){if(s=a.shared.pending,s===null)break;h=s,s=h.next,h.next=null,a.lastBaseUpdate=h,a.shared.pending=null}}while(!0);if(d===null&&(l=f),a.baseState=l,a.firstBaseUpdate=u,a.lastBaseUpdate=d,t=a.shared.interleaved,t!==null){a=t;do o|=a.lane,a=a.next;while(a!==t)}else i===null&&(a.shared.lanes=0);Ol|=o,e.lanes=o,e.memoizedState=f}}function Zw(e,t,r){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var n=e[t],a=n.callback;if(a!==null){if(n.callback=null,n=r,typeof a!="function")throw Error(Te(191,a));a.call(n)}}}var Kf={},Zi=Ls(Kf),ef=Ls(Kf),tf=Ls(Kf);function ul(e){if(e===Kf)throw Error(Te(174));return e}function lv(e,t){switch(Hr(tf,t),Hr(ef,e),Hr(Zi,Kf),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ly(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ly(t,e)}qr(Zi),Hr(Zi,t)}function Vc(){qr(Zi),qr(ef),qr(tf)}function OM(e){ul(tf.current);var t=ul(Zi.current),r=ly(t,e.type);t!==r&&(Hr(ef,e),Hr(Zi,r))}function cv(e){ef.current===e&&(qr(Zi),qr(ef))}var an=Ls(0);function $h(e){for(var t=e;t!==null;){if(t.tag===13){var r=t.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if(t.flags&128)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Hm=[];function uv(){for(var e=0;e<Hm.length;e++)Hm[e]._workInProgressVersionPrimary=null;Hm.length=0}var uh=Bo.ReactCurrentDispatcher,Xm=Bo.ReactCurrentBatchConfig,Cl=0,on=null,In=null,zn=null,Lh=!1,Od=!1,rf=0,FT=0;function aa(){throw Error(Te(321))}function dv(e,t){if(t===null)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Di(e[r],t[r]))return!1;return!0}function fv(e,t,r,n,a,i){if(Cl=i,on=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,uh.current=e===null||e.memoizedState===null?WT:VT,e=r(n,a),Od){i=0;do{if(Od=!1,rf=0,25<=i)throw Error(Te(301));i+=1,zn=In=null,t.updateQueue=null,uh.current=HT,e=r(n,a)}while(Od)}if(uh.current=Bh,t=In!==null&&In.next!==null,Cl=0,zn=In=on=null,Lh=!1,t)throw Error(Te(300));return e}function hv(){var e=rf!==0;return rf=0,e}function Vi(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return zn===null?on.memoizedState=zn=e:zn=zn.next=e,zn}function gi(){if(In===null){var e=on.alternate;e=e!==null?e.memoizedState:null}else e=In.next;var t=zn===null?on.memoizedState:zn.next;if(t!==null)zn=t,In=e;else{if(e===null)throw Error(Te(310));In=e,e={memoizedState:In.memoizedState,baseState:In.baseState,baseQueue:In.baseQueue,queue:In.queue,next:null},zn===null?on.memoizedState=zn=e:zn=zn.next=e}return zn}function nf(e,t){return typeof t=="function"?t(e):t}function Km(e){var t=gi(),r=t.queue;if(r===null)throw Error(Te(311));r.lastRenderedReducer=e;var n=In,a=n.baseQueue,i=r.pending;if(i!==null){if(a!==null){var o=a.next;a.next=i.next,i.next=o}n.baseQueue=a=i,r.pending=null}if(a!==null){i=a.next,n=n.baseState;var s=o=null,l=null,u=i;do{var d=u.lane;if((Cl&d)===d)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var f={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(s=l=f,o=n):l=l.next=f,on.lanes|=d,Ol|=d}u=u.next}while(u!==null&&u!==i);l===null?o=n:l.next=s,Di(n,t.memoizedState)||(Aa=!0),t.memoizedState=n,t.baseState=o,t.baseQueue=l,r.lastRenderedState=n}if(e=r.interleaved,e!==null){a=e;do i=a.lane,on.lanes|=i,Ol|=i,a=a.next;while(a!==e)}else a===null&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function Ym(e){var t=gi(),r=t.queue;if(r===null)throw Error(Te(311));r.lastRenderedReducer=e;var n=r.dispatch,a=r.pending,i=t.memoizedState;if(a!==null){r.pending=null;var o=a=a.next;do i=e(i,o.action),o=o.next;while(o!==a);Di(i,t.memoizedState)||(Aa=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),r.lastRenderedState=i}return[i,n]}function AM(){}function TM(e,t){var r=on,n=gi(),a=t(),i=!Di(n.memoizedState,a);if(i&&(n.memoizedState=a,Aa=!0),n=n.queue,pv(RM.bind(null,r,n,e),[e]),n.getSnapshot!==t||i||zn!==null&&zn.memoizedState.tag&1){if(r.flags|=2048,af(9,IM.bind(null,r,n,a,t),void 0,null),Wn===null)throw Error(Te(349));Cl&30||EM(r,t,a)}return a}function EM(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},t=on.updateQueue,t===null?(t={lastEffect:null,stores:null},on.updateQueue=t,t.stores=[e]):(r=t.stores,r===null?t.stores=[e]:r.push(e))}function IM(e,t,r,n){t.value=r,t.getSnapshot=n,DM(t)&&$M(e)}function RM(e,t,r){return r(function(){DM(t)&&$M(e)})}function DM(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Di(e,r)}catch{return!0}}function $M(e){var t=Eo(e,1);t!==null&&Ri(t,e,1,-1)}function Jw(e){var t=Vi();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:nf,lastRenderedState:e},t.queue=e,e=e.dispatch=zT.bind(null,on,e),[t.memoizedState,e]}function af(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},t=on.updateQueue,t===null?(t={lastEffect:null,stores:null},on.updateQueue=t,t.lastEffect=e.next=e):(r=t.lastEffect,r===null?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e)),e}function LM(){return gi().memoizedState}function dh(e,t,r,n){var a=Vi();on.flags|=e,a.memoizedState=af(1|t,r,void 0,n===void 0?null:n)}function cg(e,t,r,n){var a=gi();n=n===void 0?null:n;var i=void 0;if(In!==null){var o=In.memoizedState;if(i=o.destroy,n!==null&&dv(n,o.deps)){a.memoizedState=af(t,r,i,n);return}}on.flags|=e,a.memoizedState=af(1|t,r,i,n)}function Qw(e,t){return dh(8390656,8,e,t)}function pv(e,t){return cg(2048,8,e,t)}function BM(e,t){return cg(4,2,e,t)}function FM(e,t){return cg(4,4,e,t)}function GM(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function UM(e,t,r){return r=r!=null?r.concat([e]):null,cg(4,4,GM.bind(null,t,e),r)}function gv(){}function zM(e,t){var r=gi();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&dv(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function WM(e,t){var r=gi();t=t===void 0?null:t;var n=r.memoizedState;return n!==null&&t!==null&&dv(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function VM(e,t,r){return Cl&21?(Di(r,t)||(r=qj(),on.lanes|=r,Ol|=r,e.baseState=!0),t):(e.baseState&&(e.baseState=!1,Aa=!0),e.memoizedState=r)}function GT(e,t){var r=Er;Er=r!==0&&4>r?r:4,e(!0);var n=Xm.transition;Xm.transition={};try{e(!1),t()}finally{Er=r,Xm.transition=n}}function HM(){return gi().memoizedState}function UT(e,t,r){var n=Cs(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},XM(e))KM(t,r);else if(r=NM(e,t,r,n),r!==null){var a=wa();Ri(r,e,n,a),YM(r,t,n)}}function zT(e,t,r){var n=Cs(e),a={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(XM(e))KM(t,a);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var o=t.lastRenderedState,s=i(o,r);if(a.hasEagerState=!0,a.eagerState=s,Di(s,o)){var l=t.interleaved;l===null?(a.next=a,ov(t)):(a.next=l.next,l.next=a),t.interleaved=a;return}}catch{}finally{}r=NM(e,t,a,n),r!==null&&(a=wa(),Ri(r,e,n,a),YM(r,t,n))}}function XM(e){var t=e.alternate;return e===on||t!==null&&t===on}function KM(e,t){Od=Lh=!0;var r=e.pending;r===null?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function YM(e,t,r){if(r&4194240){var n=t.lanes;n&=e.pendingLanes,r|=n,t.lanes=r,Hb(e,r)}}var Bh={readContext:pi,useCallback:aa,useContext:aa,useEffect:aa,useImperativeHandle:aa,useInsertionEffect:aa,useLayoutEffect:aa,useMemo:aa,useReducer:aa,useRef:aa,useState:aa,useDebugValue:aa,useDeferredValue:aa,useTransition:aa,useMutableSource:aa,useSyncExternalStore:aa,useId:aa,unstable_isNewReconciler:!1},WT={readContext:pi,useCallback:function(e,t){return Vi().memoizedState=[e,t===void 0?null:t],e},useContext:pi,useEffect:Qw,useImperativeHandle:function(e,t,r){return r=r!=null?r.concat([e]):null,dh(4194308,4,GM.bind(null,t,e),r)},useLayoutEffect:function(e,t){return dh(4194308,4,e,t)},useInsertionEffect:function(e,t){return dh(4,2,e,t)},useMemo:function(e,t){var r=Vi();return t=t===void 0?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=Vi();return t=r!==void 0?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=UT.bind(null,on,e),[n.memoizedState,e]},useRef:function(e){var t=Vi();return e={current:e},t.memoizedState=e},useState:Jw,useDebugValue:gv,useDeferredValue:function(e){return Vi().memoizedState=e},useTransition:function(){var e=Jw(!1),t=e[0];return e=GT.bind(null,e[1]),Vi().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=on,a=Vi();if(en){if(r===void 0)throw Error(Te(407));r=r()}else{if(r=t(),Wn===null)throw Error(Te(349));Cl&30||EM(n,t,r)}a.memoizedState=r;var i={value:r,getSnapshot:t};return a.queue=i,Qw(RM.bind(null,n,i,e),[e]),n.flags|=2048,af(9,IM.bind(null,n,i,r,t),void 0,null),r},useId:function(){var e=Vi(),t=Wn.identifierPrefix;if(en){var r=So,n=ko;r=(n&~(1<<32-Ii(n)-1)).toString(32)+r,t=":"+t+"R"+r,r=rf++,0<r&&(t+="H"+r.toString(32)),t+=":"}else r=FT++,t=":"+t+"r"+r.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},VT={readContext:pi,useCallback:zM,useContext:pi,useEffect:pv,useImperativeHandle:UM,useInsertionEffect:BM,useLayoutEffect:FM,useMemo:WM,useReducer:Km,useRef:LM,useState:function(){return Km(nf)},useDebugValue:gv,useDeferredValue:function(e){var t=gi();return VM(t,In.memoizedState,e)},useTransition:function(){var e=Km(nf)[0],t=gi().memoizedState;return[e,t]},useMutableSource:AM,useSyncExternalStore:TM,useId:HM,unstable_isNewReconciler:!1},HT={readContext:pi,useCallback:zM,useContext:pi,useEffect:pv,useImperativeHandle:UM,useInsertionEffect:BM,useLayoutEffect:FM,useMemo:WM,useReducer:Ym,useRef:LM,useState:function(){return Ym(nf)},useDebugValue:gv,useDeferredValue:function(e){var t=gi();return In===null?t.memoizedState=e:VM(t,In.memoizedState,e)},useTransition:function(){var e=Ym(nf)[0],t=gi().memoizedState;return[e,t]},useMutableSource:AM,useSyncExternalStore:TM,useId:HM,unstable_isNewReconciler:!1};function ji(e,t){if(e&&e.defaultProps){t=sn({},t),e=e.defaultProps;for(var r in e)t[r]===void 0&&(t[r]=e[r]);return t}return t}function Cy(e,t,r,n){t=e.memoizedState,r=r(n,t),r=r==null?t:sn({},t,r),e.memoizedState=r,e.lanes===0&&(e.updateQueue.baseState=r)}var ug={isMounted:function(e){return(e=e._reactInternals)?Vl(e)===e:!1},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=wa(),a=Cs(e),i=Po(n,a);i.payload=t,r!=null&&(i.callback=r),t=Ps(e,i,a),t!==null&&(Ri(t,e,a,n),ch(t,e,a))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=wa(),a=Cs(e),i=Po(n,a);i.tag=1,i.payload=t,r!=null&&(i.callback=r),t=Ps(e,i,a),t!==null&&(Ri(t,e,a,n),ch(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=wa(),n=Cs(e),a=Po(r,n);a.tag=2,t!=null&&(a.callback=t),t=Ps(e,a,n),t!==null&&(Ri(t,e,n,r),ch(t,e,n))}};function ek(e,t,r,n,a,i,o){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(n,i,o):t.prototype&&t.prototype.isPureReactComponent?!qd(r,n)||!qd(a,i):!0}function qM(e,t,r){var n=!1,a=Rs,i=t.contextType;return typeof i=="object"&&i!==null?i=pi(i):(a=Ia(t)?Pl:ua.current,n=t.contextTypes,i=(n=n!=null)?Uc(e,a):Rs),t=new t(r,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=ug,e.stateNode=t,t._reactInternals=e,n&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function tk(e,t,r,n){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(r,n),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&ug.enqueueReplaceState(t,t.state,null)}function Oy(e,t,r,n){var a=e.stateNode;a.props=r,a.state=e.memoizedState,a.refs={},sv(e);var i=t.contextType;typeof i=="object"&&i!==null?a.context=pi(i):(i=Ia(t)?Pl:ua.current,a.context=Uc(e,i)),a.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(Cy(e,t,i,r),a.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof a.getSnapshotBeforeUpdate=="function"||typeof a.UNSAFE_componentWillMount!="function"&&typeof a.componentWillMount!="function"||(t=a.state,typeof a.componentWillMount=="function"&&a.componentWillMount(),typeof a.UNSAFE_componentWillMount=="function"&&a.UNSAFE_componentWillMount(),t!==a.state&&ug.enqueueReplaceState(a,a.state,null),Dh(e,r,a,n),a.state=e.memoizedState),typeof a.componentDidMount=="function"&&(e.flags|=4194308)}function Hc(e,t){try{var r="",n=t;do r+=v6(n),n=n.return;while(n);var a=r}catch(i){a=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:a,digest:null}}function qm(e,t,r){return{value:e,source:null,stack:r??null,digest:t??null}}function Ay(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var XT=typeof WeakMap=="function"?WeakMap:Map;function ZM(e,t,r){r=Po(-1,r),r.tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Gh||(Gh=!0,Gy=n),Ay(e,t)},r}function JM(e,t,r){r=Po(-1,r),r.tag=3;var n=e.type.getDerivedStateFromError;if(typeof n=="function"){var a=t.value;r.payload=function(){return n(a)},r.callback=function(){Ay(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(r.callback=function(){Ay(e,t),typeof n!="function"&&(Ns===null?Ns=new Set([this]):Ns.add(this));var o=t.stack;this.componentDidCatch(t.value,{componentStack:o!==null?o:""})}),r}function rk(e,t,r){var n=e.pingCache;if(n===null){n=e.pingCache=new XT;var a=new Set;n.set(t,a)}else a=n.get(t),a===void 0&&(a=new Set,n.set(t,a));a.has(r)||(a.add(r),e=s8.bind(null,e,t,r),t.then(e,e))}function nk(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function ak(e,t,r,n,a){return e.mode&1?(e.flags|=65536,e.lanes=a,e):(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(t=Po(-1,1),t.tag=2,Ps(r,t,1))),r.lanes|=1),e)}var KT=Bo.ReactCurrentOwner,Aa=!1;function ma(e,t,r,n){t.child=e===null?PM(t,null,r,n):Wc(t,e.child,r,n)}function ik(e,t,r,n,a){r=r.render;var i=t.ref;return Ic(t,a),n=fv(e,t,r,n,i,a),r=hv(),e!==null&&!Aa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Io(e,t,a)):(en&&r&&ev(t),t.flags|=1,ma(e,t,n,a),t.child)}function ok(e,t,r,n,a){if(e===null){var i=r.type;return typeof i=="function"&&!Sv(i)&&i.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(t.tag=15,t.type=i,QM(e,t,i,n,a)):(e=gh(r.type,null,n,t,t.mode,a),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,!(e.lanes&a)){var o=i.memoizedProps;if(r=r.compare,r=r!==null?r:qd,r(o,n)&&e.ref===t.ref)return Io(e,t,a)}return t.flags|=1,e=Os(i,n),e.ref=t.ref,e.return=t,t.child=e}function QM(e,t,r,n,a){if(e!==null){var i=e.memoizedProps;if(qd(i,n)&&e.ref===t.ref)if(Aa=!1,t.pendingProps=n=i,(e.lanes&a)!==0)e.flags&131072&&(Aa=!0);else return t.lanes=e.lanes,Io(e,t,a)}return Ty(e,t,r,n,a)}function e_(e,t,r){var n=t.pendingProps,a=n.children,i=e!==null?e.memoizedState:null;if(n.mode==="hidden")if(!(t.mode&1))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Hr(jc,Wa),Wa|=r;else{if(!(r&1073741824))return e=i!==null?i.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Hr(jc,Wa),Wa|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=i!==null?i.baseLanes:r,Hr(jc,Wa),Wa|=n}else i!==null?(n=i.baseLanes|r,t.memoizedState=null):n=r,Hr(jc,Wa),Wa|=n;return ma(e,t,a,r),t.child}function t_(e,t){var r=t.ref;(e===null&&r!==null||e!==null&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Ty(e,t,r,n,a){var i=Ia(r)?Pl:ua.current;return i=Uc(t,i),Ic(t,a),r=fv(e,t,r,n,i,a),n=hv(),e!==null&&!Aa?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Io(e,t,a)):(en&&n&&ev(t),t.flags|=1,ma(e,t,r,a),t.child)}function sk(e,t,r,n,a){if(Ia(r)){var i=!0;Ah(t)}else i=!1;if(Ic(t,a),t.stateNode===null)fh(e,t),qM(t,r,n),Oy(t,r,n,a),n=!0;else if(e===null){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=r.contextType;typeof u=="object"&&u!==null?u=pi(u):(u=Ia(r)?Pl:ua.current,u=Uc(t,u));var d=r.getDerivedStateFromProps,f=typeof d=="function"||typeof o.getSnapshotBeforeUpdate=="function";f||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==n||l!==u)&&tk(t,o,n,u),is=!1;var h=t.memoizedState;o.state=h,Dh(t,n,o,a),l=t.memoizedState,s!==n||h!==l||Ea.current||is?(typeof d=="function"&&(Cy(t,r,d,n),l=t.memoizedState),(s=is||ek(t,r,s,n,h,l,u))?(f||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(t.flags|=4194308)):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=u,n=s):(typeof o.componentDidMount=="function"&&(t.flags|=4194308),n=!1)}else{o=t.stateNode,CM(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:ji(t.type,s),o.props=u,f=t.pendingProps,h=o.context,l=r.contextType,typeof l=="object"&&l!==null?l=pi(l):(l=Ia(r)?Pl:ua.current,l=Uc(t,l));var p=r.getDerivedStateFromProps;(d=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(s!==f||h!==l)&&tk(t,o,n,l),is=!1,h=t.memoizedState,o.state=h,Dh(t,n,o,a);var x=t.memoizedState;s!==f||h!==x||Ea.current||is?(typeof p=="function"&&(Cy(t,r,p,n),x=t.memoizedState),(u=is||ek(t,r,u,n,h,x,l)||!1)?(d||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,x,l),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,x,l)),typeof o.componentDidUpdate=="function"&&(t.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=x),o.props=n,o.state=x,o.context=l,n=u):(typeof o.componentDidUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Ey(e,t,r,n,i,a)}function Ey(e,t,r,n,a,i){t_(e,t);var o=(t.flags&128)!==0;if(!n&&!o)return a&&Hw(t,r,!1),Io(e,t,i);n=t.stateNode,KT.current=t;var s=o&&typeof r.getDerivedStateFromError!="function"?null:n.render();return t.flags|=1,e!==null&&o?(t.child=Wc(t,e.child,null,i),t.child=Wc(t,null,s,i)):ma(e,t,s,i),t.memoizedState=n.state,a&&Hw(t,r,!0),t.child}function r_(e){var t=e.stateNode;t.pendingContext?Vw(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Vw(e,t.context,!1),lv(e,t.containerInfo)}function lk(e,t,r,n,a){return zc(),rv(a),t.flags|=256,ma(e,t,r,n),t.child}var Iy={dehydrated:null,treeContext:null,retryLane:0};function Ry(e){return{baseLanes:e,cachePool:null,transitions:null}}function n_(e,t,r){var n=t.pendingProps,a=an.current,i=!1,o=(t.flags&128)!==0,s;if((s=o)||(s=e!==null&&e.memoizedState===null?!1:(a&2)!==0),s?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(a|=1),Hr(an,a&1),e===null)return Py(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(t.mode&1?e.data==="$!"?t.lanes=8:t.lanes=1073741824:t.lanes=1,null):(o=n.children,e=n.fallback,i?(n=t.mode,i=t.child,o={mode:"hidden",children:o},!(n&1)&&i!==null?(i.childLanes=0,i.pendingProps=o):i=hg(o,n,0,null),e=kl(e,n,r,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=Ry(r),t.memoizedState=Iy,e):mv(t,o));if(a=e.memoizedState,a!==null&&(s=a.dehydrated,s!==null))return YT(e,t,o,n,s,a,r);if(i){i=n.fallback,o=t.mode,a=e.child,s=a.sibling;var l={mode:"hidden",children:n.children};return!(o&1)&&t.child!==a?(n=t.child,n.childLanes=0,n.pendingProps=l,t.deletions=null):(n=Os(a,l),n.subtreeFlags=a.subtreeFlags&14680064),s!==null?i=Os(s,i):(i=kl(i,o,r,null),i.flags|=2),i.return=t,n.return=t,n.sibling=i,t.child=n,n=i,i=t.child,o=e.child.memoizedState,o=o===null?Ry(r):{baseLanes:o.baseLanes|r,cachePool:null,transitions:o.transitions},i.memoizedState=o,i.childLanes=e.childLanes&~r,t.memoizedState=Iy,n}return i=e.child,e=i.sibling,n=Os(i,{mode:"visible",children:n.children}),!(t.mode&1)&&(n.lanes=r),n.return=t,n.sibling=null,e!==null&&(r=t.deletions,r===null?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n,t.memoizedState=null,n}function mv(e,t){return t=hg({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function C0(e,t,r,n){return n!==null&&rv(n),Wc(t,e.child,null,r),e=mv(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function YT(e,t,r,n,a,i,o){if(r)return t.flags&256?(t.flags&=-257,n=qm(Error(Te(422))),C0(e,t,o,n)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=n.fallback,a=t.mode,n=hg({mode:"visible",children:n.children},a,0,null),i=kl(i,a,o,null),i.flags|=2,n.return=t,i.return=t,n.sibling=i,t.child=n,t.mode&1&&Wc(t,e.child,null,o),t.child.memoizedState=Ry(o),t.memoizedState=Iy,i);if(!(t.mode&1))return C0(e,t,o,null);if(a.data==="$!"){if(n=a.nextSibling&&a.nextSibling.dataset,n)var s=n.dgst;return n=s,i=Error(Te(419)),n=qm(i,n,void 0),C0(e,t,o,n)}if(s=(o&e.childLanes)!==0,Aa||s){if(n=Wn,n!==null){switch(o&-o){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}a=a&(n.suspendedLanes|o)?0:a,a!==0&&a!==i.retryLane&&(i.retryLane=a,Eo(e,a),Ri(n,e,a,-1))}return kv(),n=qm(Error(Te(421))),C0(e,t,o,n)}return a.data==="$?"?(t.flags|=128,t.child=e.child,t=l8.bind(null,e),a._reactRetry=t,null):(e=i.treeContext,Ya=_s(a.nextSibling),qa=t,en=!0,Ci=null,e!==null&&(si[li++]=ko,si[li++]=So,si[li++]=Nl,ko=e.id,So=e.overflow,Nl=t),t=mv(t,n.children),t.flags|=4096,t)}function ck(e,t,r){e.lanes|=t;var n=e.alternate;n!==null&&(n.lanes|=t),Ny(e.return,t,r)}function Zm(e,t,r,n,a){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=n,i.tail=r,i.tailMode=a)}function a_(e,t,r){var n=t.pendingProps,a=n.revealOrder,i=n.tail;if(ma(e,t,n.children,r),n=an.current,n&2)n=n&1|2,t.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&ck(e,r,t);else if(e.tag===19)ck(e,r,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Hr(an,n),!(t.mode&1))t.memoizedState=null;else switch(a){case"forwards":for(r=t.child,a=null;r!==null;)e=r.alternate,e!==null&&$h(e)===null&&(a=r),r=r.sibling;r=a,r===null?(a=t.child,t.child=null):(a=r.sibling,r.sibling=null),Zm(t,!1,a,r,i);break;case"backwards":for(r=null,a=t.child,t.child=null;a!==null;){if(e=a.alternate,e!==null&&$h(e)===null){t.child=a;break}e=a.sibling,a.sibling=r,r=a,a=e}Zm(t,!0,r,null,i);break;case"together":Zm(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function fh(e,t){!(t.mode&1)&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Io(e,t,r){if(e!==null&&(t.dependencies=e.dependencies),Ol|=t.lanes,!(r&t.childLanes))return null;if(e!==null&&t.child!==e.child)throw Error(Te(153));if(t.child!==null){for(e=t.child,r=Os(e,e.pendingProps),t.child=r,r.return=t;e.sibling!==null;)e=e.sibling,r=r.sibling=Os(e,e.pendingProps),r.return=t;r.sibling=null}return t.child}function qT(e,t,r){switch(t.tag){case 3:r_(t),zc();break;case 5:OM(t);break;case 1:Ia(t.type)&&Ah(t);break;case 4:lv(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,a=t.memoizedProps.value;Hr(Ih,n._currentValue),n._currentValue=a;break;case 13:if(n=t.memoizedState,n!==null)return n.dehydrated!==null?(Hr(an,an.current&1),t.flags|=128,null):r&t.child.childLanes?n_(e,t,r):(Hr(an,an.current&1),e=Io(e,t,r),e!==null?e.sibling:null);Hr(an,an.current&1);break;case 19:if(n=(r&t.childLanes)!==0,e.flags&128){if(n)return a_(e,t,r);t.flags|=128}if(a=t.memoizedState,a!==null&&(a.rendering=null,a.tail=null,a.lastEffect=null),Hr(an,an.current),n)break;return null;case 22:case 23:return t.lanes=0,e_(e,t,r)}return Io(e,t,r)}var i_,Dy,o_,s_;i_=function(e,t){for(var r=t.child;r!==null;){if(r.tag===5||r.tag===6)e.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===t)break;for(;r.sibling===null;){if(r.return===null||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};Dy=function(){};o_=function(e,t,r,n){var a=e.memoizedProps;if(a!==n){e=t.stateNode,ul(Zi.current);var i=null;switch(r){case"input":a=ay(e,a),n=ay(e,n),i=[];break;case"select":a=sn({},a,{value:void 0}),n=sn({},n,{value:void 0}),i=[];break;case"textarea":a=sy(e,a),n=sy(e,n),i=[];break;default:typeof a.onClick!="function"&&typeof n.onClick=="function"&&(e.onclick=Ch)}cy(r,n);var o;r=null;for(u in a)if(!n.hasOwnProperty(u)&&a.hasOwnProperty(u)&&a[u]!=null)if(u==="style"){var s=a[u];for(o in s)s.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(zd.hasOwnProperty(u)?i||(i=[]):(i=i||[]).push(u,null));for(u in n){var l=n[u];if(s=a!=null?a[u]:void 0,n.hasOwnProperty(u)&&l!==s&&(l!=null||s!=null))if(u==="style")if(s){for(o in s)!s.hasOwnProperty(o)||l&&l.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in l)l.hasOwnProperty(o)&&s[o]!==l[o]&&(r||(r={}),r[o]=l[o])}else r||(i||(i=[]),i.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,s=s?s.__html:void 0,l!=null&&s!==l&&(i=i||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(i=i||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(zd.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&Xr("scroll",e),i||s===l||(i=[])):(i=i||[]).push(u,l))}r&&(i=i||[]).push("style",r);var u=i;(t.updateQueue=u)&&(t.flags|=4)}};s_=function(e,t,r,n){r!==n&&(t.flags|=4)};function id(e,t){if(!en)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:n.sibling=null}}function ia(e){var t=e.alternate!==null&&e.alternate.child===e.child,r=0,n=0;if(t)for(var a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags&14680064,n|=a.flags&14680064,a.return=e,a=a.sibling;else for(a=e.child;a!==null;)r|=a.lanes|a.childLanes,n|=a.subtreeFlags,n|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function ZT(e,t,r){var n=t.pendingProps;switch(tv(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ia(t),null;case 1:return Ia(t.type)&&Oh(),ia(t),null;case 3:return n=t.stateNode,Vc(),qr(Ea),qr(ua),uv(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(e===null||e.child===null)&&(P0(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&!(t.flags&256)||(t.flags|=1024,Ci!==null&&(Wy(Ci),Ci=null))),Dy(e,t),ia(t),null;case 5:cv(t);var a=ul(tf.current);if(r=t.type,e!==null&&t.stateNode!=null)o_(e,t,r,n,a),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(t.stateNode===null)throw Error(Te(166));return ia(t),null}if(e=ul(Zi.current),P0(t)){n=t.stateNode,r=t.type;var i=t.memoizedProps;switch(n[Hi]=t,n[Qd]=i,e=(t.mode&1)!==0,r){case"dialog":Xr("cancel",n),Xr("close",n);break;case"iframe":case"object":case"embed":Xr("load",n);break;case"video":case"audio":for(a=0;a<Sd.length;a++)Xr(Sd[a],n);break;case"source":Xr("error",n);break;case"img":case"image":case"link":Xr("error",n),Xr("load",n);break;case"details":Xr("toggle",n);break;case"input":yw(n,i),Xr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!i.multiple},Xr("invalid",n);break;case"textarea":vw(n,i),Xr("invalid",n)}cy(r,i),a=null;for(var o in i)if(i.hasOwnProperty(o)){var s=i[o];o==="children"?typeof s=="string"?n.textContent!==s&&(i.suppressHydrationWarning!==!0&&_0(n.textContent,s,e),a=["children",s]):typeof s=="number"&&n.textContent!==""+s&&(i.suppressHydrationWarning!==!0&&_0(n.textContent,s,e),a=["children",""+s]):zd.hasOwnProperty(o)&&s!=null&&o==="onScroll"&&Xr("scroll",n)}switch(r){case"input":y0(n),bw(n,i,!0);break;case"textarea":y0(n),ww(n);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(n.onclick=Ch)}n=a,t.updateQueue=n,n!==null&&(t.flags|=4)}else{o=a.nodeType===9?a:a.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=Rj(r)),e==="http://www.w3.org/1999/xhtml"?r==="script"?(e=o.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof n.is=="string"?e=o.createElement(r,{is:n.is}):(e=o.createElement(r),r==="select"&&(o=e,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):e=o.createElementNS(e,r),e[Hi]=t,e[Qd]=n,i_(e,t,!1,!1),t.stateNode=e;e:{switch(o=uy(r,n),r){case"dialog":Xr("cancel",e),Xr("close",e),a=n;break;case"iframe":case"object":case"embed":Xr("load",e),a=n;break;case"video":case"audio":for(a=0;a<Sd.length;a++)Xr(Sd[a],e);a=n;break;case"source":Xr("error",e),a=n;break;case"img":case"image":case"link":Xr("error",e),Xr("load",e),a=n;break;case"details":Xr("toggle",e),a=n;break;case"input":yw(e,n),a=ay(e,n),Xr("invalid",e);break;case"option":a=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},a=sn({},n,{value:void 0}),Xr("invalid",e);break;case"textarea":vw(e,n),a=sy(e,n),Xr("invalid",e);break;default:a=n}cy(r,a),s=a;for(i in s)if(s.hasOwnProperty(i)){var l=s[i];i==="style"?Lj(e,l):i==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&Dj(e,l)):i==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&Wd(e,l):typeof l=="number"&&Wd(e,""+l):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(zd.hasOwnProperty(i)?l!=null&&i==="onScroll"&&Xr("scroll",e):l!=null&&Fb(e,i,l,o))}switch(r){case"input":y0(e),bw(e,n,!1);break;case"textarea":y0(e),ww(e);break;case"option":n.value!=null&&e.setAttribute("value",""+Is(n.value));break;case"select":e.multiple=!!n.multiple,i=n.value,i!=null?Oc(e,!!n.multiple,i,!1):n.defaultValue!=null&&Oc(e,!!n.multiple,n.defaultValue,!0);break;default:typeof a.onClick=="function"&&(e.onclick=Ch)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return ia(t),null;case 6:if(e&&t.stateNode!=null)s_(e,t,e.memoizedProps,n);else{if(typeof n!="string"&&t.stateNode===null)throw Error(Te(166));if(r=ul(tf.current),ul(Zi.current),P0(t)){if(n=t.stateNode,r=t.memoizedProps,n[Hi]=t,(i=n.nodeValue!==r)&&(e=qa,e!==null))switch(e.tag){case 3:_0(n.nodeValue,r,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&_0(n.nodeValue,r,(e.mode&1)!==0)}i&&(t.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[Hi]=t,t.stateNode=n}return ia(t),null;case 13:if(qr(an),n=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(en&&Ya!==null&&t.mode&1&&!(t.flags&128))MM(),zc(),t.flags|=98560,i=!1;else if(i=P0(t),n!==null&&n.dehydrated!==null){if(e===null){if(!i)throw Error(Te(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(Te(317));i[Hi]=t}else zc(),!(t.flags&128)&&(t.memoizedState=null),t.flags|=4;ia(t),i=!1}else Ci!==null&&(Wy(Ci),Ci=null),i=!0;if(!i)return t.flags&65536?t:null}return t.flags&128?(t.lanes=r,t):(n=n!==null,n!==(e!==null&&e.memoizedState!==null)&&n&&(t.child.flags|=8192,t.mode&1&&(e===null||an.current&1?$n===0&&($n=3):kv())),t.updateQueue!==null&&(t.flags|=4),ia(t),null);case 4:return Vc(),Dy(e,t),e===null&&Zd(t.stateNode.containerInfo),ia(t),null;case 10:return iv(t.type._context),ia(t),null;case 17:return Ia(t.type)&&Oh(),ia(t),null;case 19:if(qr(an),i=t.memoizedState,i===null)return ia(t),null;if(n=(t.flags&128)!==0,o=i.rendering,o===null)if(n)id(i,!1);else{if($n!==0||e!==null&&e.flags&128)for(e=t.child;e!==null;){if(o=$h(e),o!==null){for(t.flags|=128,id(i,!1),n=o.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;r!==null;)i=r,e=n,i.flags&=14680066,o=i.alternate,o===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=o.childLanes,i.lanes=o.lanes,i.child=o.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=o.memoizedProps,i.memoizedState=o.memoizedState,i.updateQueue=o.updateQueue,i.type=o.type,e=o.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Hr(an,an.current&1|2),t.child}e=e.sibling}i.tail!==null&&mn()>Xc&&(t.flags|=128,n=!0,id(i,!1),t.lanes=4194304)}else{if(!n)if(e=$h(o),e!==null){if(t.flags|=128,n=!0,r=e.updateQueue,r!==null&&(t.updateQueue=r,t.flags|=4),id(i,!0),i.tail===null&&i.tailMode==="hidden"&&!o.alternate&&!en)return ia(t),null}else 2*mn()-i.renderingStartTime>Xc&&r!==1073741824&&(t.flags|=128,n=!0,id(i,!1),t.lanes=4194304);i.isBackwards?(o.sibling=t.child,t.child=o):(r=i.last,r!==null?r.sibling=o:t.child=o,i.last=o)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=mn(),t.sibling=null,r=an.current,Hr(an,n?r&1|2:r&1),t):(ia(t),null);case 22:case 23:return wv(),n=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==n&&(t.flags|=8192),n&&t.mode&1?Wa&1073741824&&(ia(t),t.subtreeFlags&6&&(t.flags|=8192)):ia(t),null;case 24:return null;case 25:return null}throw Error(Te(156,t.tag))}function JT(e,t){switch(tv(t),t.tag){case 1:return Ia(t.type)&&Oh(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return Vc(),qr(Ea),qr(ua),uv(),e=t.flags,e&65536&&!(e&128)?(t.flags=e&-65537|128,t):null;case 5:return cv(t),null;case 13:if(qr(an),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(Te(340));zc()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return qr(an),null;case 4:return Vc(),null;case 10:return iv(t.type._context),null;case 22:case 23:return wv(),null;case 24:return null;default:return null}}var O0=!1,sa=!1,QT=typeof WeakSet=="function"?WeakSet:Set,qe=null;function Sc(e,t){var r=e.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){hn(e,t,n)}else r.current=null}function $y(e,t,r){try{r()}catch(n){hn(e,t,n)}}var uk=!1;function e8(e,t){if(vy=_h,e=fM(),Qb(e)){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{r=(r=e.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var a=n.anchorOffset,i=n.focusNode;n=n.focusOffset;try{r.nodeType,i.nodeType}catch{r=null;break e}var o=0,s=-1,l=-1,u=0,d=0,f=e,h=null;t:for(;;){for(var p;f!==r||a!==0&&f.nodeType!==3||(s=o+a),f!==i||n!==0&&f.nodeType!==3||(l=o+n),f.nodeType===3&&(o+=f.nodeValue.length),(p=f.firstChild)!==null;)h=f,f=p;for(;;){if(f===e)break t;if(h===r&&++u===a&&(s=o),h===i&&++d===n&&(l=o),(p=f.nextSibling)!==null)break;f=h,h=f.parentNode}f=p}r=s===-1||l===-1?null:{start:s,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(wy={focusedElem:e,selectionRange:r},_h=!1,qe=t;qe!==null;)if(t=qe,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,qe=e;else for(;qe!==null;){t=qe;try{var x=t.alternate;if(t.flags&1024)switch(t.tag){case 0:case 11:case 15:break;case 1:if(x!==null){var b=x.memoizedProps,y=x.memoizedState,m=t.stateNode,g=m.getSnapshotBeforeUpdate(t.elementType===t.type?b:ji(t.type,b),y);m.__reactInternalSnapshotBeforeUpdate=g}break;case 3:var k=t.stateNode.containerInfo;k.nodeType===1?k.textContent="":k.nodeType===9&&k.documentElement&&k.removeChild(k.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Te(163))}}catch(S){hn(t,t.return,S)}if(e=t.sibling,e!==null){e.return=t.return,qe=e;break}qe=t.return}return x=uk,uk=!1,x}function Ad(e,t,r){var n=t.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var a=n=n.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,i!==void 0&&$y(t,r,i)}a=a.next}while(a!==n)}}function dg(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function Ly(e){var t=e.ref;if(t!==null){var r=e.stateNode;switch(e.tag){case 5:e=r;break;default:e=r}typeof t=="function"?t(e):t.current=e}}function l_(e){var t=e.alternate;t!==null&&(e.alternate=null,l_(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[Hi],delete t[Qd],delete t[jy],delete t[DT],delete t[$T])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function c_(e){return e.tag===5||e.tag===3||e.tag===4}function dk(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||c_(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function By(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.nodeType===8?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(r.nodeType===8?(t=r.parentNode,t.insertBefore(e,r)):(t=r,t.appendChild(e)),r=r._reactRootContainer,r!=null||t.onclick!==null||(t.onclick=Ch));else if(n!==4&&(e=e.child,e!==null))for(By(e,t,r),e=e.sibling;e!==null;)By(e,t,r),e=e.sibling}function Fy(e,t,r){var n=e.tag;if(n===5||n===6)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(n!==4&&(e=e.child,e!==null))for(Fy(e,t,r),e=e.sibling;e!==null;)Fy(e,t,r),e=e.sibling}var Yn=null,_i=!1;function Zo(e,t,r){for(r=r.child;r!==null;)u_(e,t,r),r=r.sibling}function u_(e,t,r){if(qi&&typeof qi.onCommitFiberUnmount=="function")try{qi.onCommitFiberUnmount(ng,r)}catch{}switch(r.tag){case 5:sa||Sc(r,t);case 6:var n=Yn,a=_i;Yn=null,Zo(e,t,r),Yn=n,_i=a,Yn!==null&&(_i?(e=Yn,r=r.stateNode,e.nodeType===8?e.parentNode.removeChild(r):e.removeChild(r)):Yn.removeChild(r.stateNode));break;case 18:Yn!==null&&(_i?(e=Yn,r=r.stateNode,e.nodeType===8?Wm(e.parentNode,r):e.nodeType===1&&Wm(e,r),Kd(e)):Wm(Yn,r.stateNode));break;case 4:n=Yn,a=_i,Yn=r.stateNode.containerInfo,_i=!0,Zo(e,t,r),Yn=n,_i=a;break;case 0:case 11:case 14:case 15:if(!sa&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){a=n=n.next;do{var i=a,o=i.destroy;i=i.tag,o!==void 0&&(i&2||i&4)&&$y(r,t,o),a=a.next}while(a!==n)}Zo(e,t,r);break;case 1:if(!sa&&(Sc(r,t),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){hn(r,t,s)}Zo(e,t,r);break;case 21:Zo(e,t,r);break;case 22:r.mode&1?(sa=(n=sa)||r.memoizedState!==null,Zo(e,t,r),sa=n):Zo(e,t,r);break;default:Zo(e,t,r)}}function fk(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var r=e.stateNode;r===null&&(r=e.stateNode=new QT),t.forEach(function(n){var a=c8.bind(null,e,n);r.has(n)||(r.add(n),n.then(a,a))})}}function wi(e,t){var r=t.deletions;if(r!==null)for(var n=0;n<r.length;n++){var a=r[n];try{var i=e,o=t,s=o;e:for(;s!==null;){switch(s.tag){case 5:Yn=s.stateNode,_i=!1;break e;case 3:Yn=s.stateNode.containerInfo,_i=!0;break e;case 4:Yn=s.stateNode.containerInfo,_i=!0;break e}s=s.return}if(Yn===null)throw Error(Te(160));u_(i,o,a),Yn=null,_i=!1;var l=a.alternate;l!==null&&(l.return=null),a.return=null}catch(u){hn(a,t,u)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)d_(t,e),t=t.sibling}function d_(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(wi(t,e),Wi(e),n&4){try{Ad(3,e,e.return),dg(3,e)}catch(b){hn(e,e.return,b)}try{Ad(5,e,e.return)}catch(b){hn(e,e.return,b)}}break;case 1:wi(t,e),Wi(e),n&512&&r!==null&&Sc(r,r.return);break;case 5:if(wi(t,e),Wi(e),n&512&&r!==null&&Sc(r,r.return),e.flags&32){var a=e.stateNode;try{Wd(a,"")}catch(b){hn(e,e.return,b)}}if(n&4&&(a=e.stateNode,a!=null)){var i=e.memoizedProps,o=r!==null?r.memoizedProps:i,s=e.type,l=e.updateQueue;if(e.updateQueue=null,l!==null)try{s==="input"&&i.type==="radio"&&i.name!=null&&Ej(a,i),uy(s,o);var u=uy(s,i);for(o=0;o<l.length;o+=2){var d=l[o],f=l[o+1];d==="style"?Lj(a,f):d==="dangerouslySetInnerHTML"?Dj(a,f):d==="children"?Wd(a,f):Fb(a,d,f,u)}switch(s){case"input":iy(a,i);break;case"textarea":Ij(a,i);break;case"select":var h=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!i.multiple;var p=i.value;p!=null?Oc(a,!!i.multiple,p,!1):h!==!!i.multiple&&(i.defaultValue!=null?Oc(a,!!i.multiple,i.defaultValue,!0):Oc(a,!!i.multiple,i.multiple?[]:"",!1))}a[Qd]=i}catch(b){hn(e,e.return,b)}}break;case 6:if(wi(t,e),Wi(e),n&4){if(e.stateNode===null)throw Error(Te(162));a=e.stateNode,i=e.memoizedProps;try{a.nodeValue=i}catch(b){hn(e,e.return,b)}}break;case 3:if(wi(t,e),Wi(e),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Kd(t.containerInfo)}catch(b){hn(e,e.return,b)}break;case 4:wi(t,e),Wi(e);break;case 13:wi(t,e),Wi(e),a=e.child,a.flags&8192&&(i=a.memoizedState!==null,a.stateNode.isHidden=i,!i||a.alternate!==null&&a.alternate.memoizedState!==null||(bv=mn())),n&4&&fk(e);break;case 22:if(d=r!==null&&r.memoizedState!==null,e.mode&1?(sa=(u=sa)||d,wi(t,e),sa=u):wi(t,e),Wi(e),n&8192){if(u=e.memoizedState!==null,(e.stateNode.isHidden=u)&&!d&&e.mode&1)for(qe=e,d=e.child;d!==null;){for(f=qe=d;qe!==null;){switch(h=qe,p=h.child,h.tag){case 0:case 11:case 14:case 15:Ad(4,h,h.return);break;case 1:Sc(h,h.return);var x=h.stateNode;if(typeof x.componentWillUnmount=="function"){n=h,r=h.return;try{t=n,x.props=t.memoizedProps,x.state=t.memoizedState,x.componentWillUnmount()}catch(b){hn(n,r,b)}}break;case 5:Sc(h,h.return);break;case 22:if(h.memoizedState!==null){pk(f);continue}}p!==null?(p.return=h,qe=p):pk(f)}d=d.sibling}e:for(d=null,f=e;;){if(f.tag===5){if(d===null){d=f;try{a=f.stateNode,u?(i=a.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(s=f.stateNode,l=f.memoizedProps.style,o=l!=null&&l.hasOwnProperty("display")?l.display:null,s.style.display=$j("display",o))}catch(b){hn(e,e.return,b)}}}else if(f.tag===6){if(d===null)try{f.stateNode.nodeValue=u?"":f.memoizedProps}catch(b){hn(e,e.return,b)}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===e)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;f.sibling===null;){if(f.return===null||f.return===e)break e;d===f&&(d=null),f=f.return}d===f&&(d=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:wi(t,e),Wi(e),n&4&&fk(e);break;case 21:break;default:wi(t,e),Wi(e)}}function Wi(e){var t=e.flags;if(t&2){try{e:{for(var r=e.return;r!==null;){if(c_(r)){var n=r;break e}r=r.return}throw Error(Te(160))}switch(n.tag){case 5:var a=n.stateNode;n.flags&32&&(Wd(a,""),n.flags&=-33);var i=dk(e);Fy(e,i,a);break;case 3:case 4:var o=n.stateNode.containerInfo,s=dk(e);By(e,s,o);break;default:throw Error(Te(161))}}catch(l){hn(e,e.return,l)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function t8(e,t,r){qe=e,f_(e)}function f_(e,t,r){for(var n=(e.mode&1)!==0;qe!==null;){var a=qe,i=a.child;if(a.tag===22&&n){var o=a.memoizedState!==null||O0;if(!o){var s=a.alternate,l=s!==null&&s.memoizedState!==null||sa;s=O0;var u=sa;if(O0=o,(sa=l)&&!u)for(qe=a;qe!==null;)o=qe,l=o.child,o.tag===22&&o.memoizedState!==null?gk(a):l!==null?(l.return=o,qe=l):gk(a);for(;i!==null;)qe=i,f_(i),i=i.sibling;qe=a,O0=s,sa=u}hk(e)}else a.subtreeFlags&8772&&i!==null?(i.return=a,qe=i):hk(e)}}function hk(e){for(;qe!==null;){var t=qe;if(t.flags&8772){var r=t.alternate;try{if(t.flags&8772)switch(t.tag){case 0:case 11:case 15:sa||dg(5,t);break;case 1:var n=t.stateNode;if(t.flags&4&&!sa)if(r===null)n.componentDidMount();else{var a=t.elementType===t.type?r.memoizedProps:ji(t.type,r.memoizedProps);n.componentDidUpdate(a,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&Zw(t,i,n);break;case 3:var o=t.updateQueue;if(o!==null){if(r=null,t.child!==null)switch(t.child.tag){case 5:r=t.child.stateNode;break;case 1:r=t.child.stateNode}Zw(t,o,r)}break;case 5:var s=t.stateNode;if(r===null&&t.flags&4){r=s;var l=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var u=t.alternate;if(u!==null){var d=u.memoizedState;if(d!==null){var f=d.dehydrated;f!==null&&Kd(f)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Te(163))}sa||t.flags&512&&Ly(t)}catch(h){hn(t,t.return,h)}}if(t===e){qe=null;break}if(r=t.sibling,r!==null){r.return=t.return,qe=r;break}qe=t.return}}function pk(e){for(;qe!==null;){var t=qe;if(t===e){qe=null;break}var r=t.sibling;if(r!==null){r.return=t.return,qe=r;break}qe=t.return}}function gk(e){for(;qe!==null;){var t=qe;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{dg(4,t)}catch(l){hn(t,r,l)}break;case 1:var n=t.stateNode;if(typeof n.componentDidMount=="function"){var a=t.return;try{n.componentDidMount()}catch(l){hn(t,a,l)}}var i=t.return;try{Ly(t)}catch(l){hn(t,i,l)}break;case 5:var o=t.return;try{Ly(t)}catch(l){hn(t,o,l)}}}catch(l){hn(t,t.return,l)}if(t===e){qe=null;break}var s=t.sibling;if(s!==null){s.return=t.return,qe=s;break}qe=t.return}}var r8=Math.ceil,Fh=Bo.ReactCurrentDispatcher,xv=Bo.ReactCurrentOwner,fi=Bo.ReactCurrentBatchConfig,br=0,Wn=null,Pn=null,Jn=0,Wa=0,jc=Ls(0),$n=0,of=null,Ol=0,fg=0,yv=0,Td=null,Ca=null,bv=0,Xc=1/0,vo=null,Gh=!1,Gy=null,Ns=null,A0=!1,fs=null,Uh=0,Ed=0,Uy=null,hh=-1,ph=0;function wa(){return br&6?mn():hh!==-1?hh:hh=mn()}function Cs(e){return e.mode&1?br&2&&Jn!==0?Jn&-Jn:BT.transition!==null?(ph===0&&(ph=qj()),ph):(e=Er,e!==0||(e=window.event,e=e===void 0?16:nM(e.type)),e):1}function Ri(e,t,r,n){if(50<Ed)throw Ed=0,Uy=null,Error(Te(185));Vf(e,r,n),(!(br&2)||e!==Wn)&&(e===Wn&&(!(br&2)&&(fg|=r),$n===4&&cs(e,Jn)),Ra(e,n),r===1&&br===0&&!(t.mode&1)&&(Xc=mn()+500,lg&&Bs()))}function Ra(e,t){var r=e.callbackNode;B6(e,t);var n=Mh(e,e===Wn?Jn:0);if(n===0)r!==null&&jw(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(r!=null&&jw(r),t===1)e.tag===0?LT(mk.bind(null,e)):kM(mk.bind(null,e)),IT(function(){!(br&6)&&Bs()}),r=null;else{switch(Zj(n)){case 1:r=Vb;break;case 4:r=Kj;break;case 16:r=jh;break;case 536870912:r=Yj;break;default:r=jh}r=v_(r,h_.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function h_(e,t){if(hh=-1,ph=0,br&6)throw Error(Te(327));var r=e.callbackNode;if(Rc()&&e.callbackNode!==r)return null;var n=Mh(e,e===Wn?Jn:0);if(n===0)return null;if(n&30||n&e.expiredLanes||t)t=zh(e,n);else{t=n;var a=br;br|=2;var i=g_();(Wn!==e||Jn!==t)&&(vo=null,Xc=mn()+500,wl(e,t));do try{i8();break}catch(s){p_(e,s)}while(!0);av(),Fh.current=i,br=a,Pn!==null?t=0:(Wn=null,Jn=0,t=$n)}if(t!==0){if(t===2&&(a=gy(e),a!==0&&(n=a,t=zy(e,a))),t===1)throw r=of,wl(e,0),cs(e,n),Ra(e,mn()),r;if(t===6)cs(e,n);else{if(a=e.current.alternate,!(n&30)&&!n8(a)&&(t=zh(e,n),t===2&&(i=gy(e),i!==0&&(n=i,t=zy(e,i))),t===1))throw r=of,wl(e,0),cs(e,n),Ra(e,mn()),r;switch(e.finishedWork=a,e.finishedLanes=n,t){case 0:case 1:throw Error(Te(345));case 2:al(e,Ca,vo);break;case 3:if(cs(e,n),(n&130023424)===n&&(t=bv+500-mn(),10<t)){if(Mh(e,0)!==0)break;if(a=e.suspendedLanes,(a&n)!==n){wa(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=Sy(al.bind(null,e,Ca,vo),t);break}al(e,Ca,vo);break;case 4:if(cs(e,n),(n&4194240)===n)break;for(t=e.eventTimes,a=-1;0<n;){var o=31-Ii(n);i=1<<o,o=t[o],o>a&&(a=o),n&=~i}if(n=a,n=mn()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*r8(n/1960))-n,10<n){e.timeoutHandle=Sy(al.bind(null,e,Ca,vo),n);break}al(e,Ca,vo);break;case 5:al(e,Ca,vo);break;default:throw Error(Te(329))}}}return Ra(e,mn()),e.callbackNode===r?h_.bind(null,e):null}function zy(e,t){var r=Td;return e.current.memoizedState.isDehydrated&&(wl(e,t).flags|=256),e=zh(e,t),e!==2&&(t=Ca,Ca=r,t!==null&&Wy(t)),e}function Wy(e){Ca===null?Ca=e:Ca.push.apply(Ca,e)}function n8(e){for(var t=e;;){if(t.flags&16384){var r=t.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var a=r[n],i=a.getSnapshot;a=a.value;try{if(!Di(i(),a))return!1}catch{return!1}}}if(r=t.child,t.subtreeFlags&16384&&r!==null)r.return=t,t=r;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function cs(e,t){for(t&=~yv,t&=~fg,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-Ii(t),n=1<<r;e[r]=-1,t&=~n}}function mk(e){if(br&6)throw Error(Te(327));Rc();var t=Mh(e,0);if(!(t&1))return Ra(e,mn()),null;var r=zh(e,t);if(e.tag!==0&&r===2){var n=gy(e);n!==0&&(t=n,r=zy(e,n))}if(r===1)throw r=of,wl(e,0),cs(e,t),Ra(e,mn()),r;if(r===6)throw Error(Te(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,al(e,Ca,vo),Ra(e,mn()),null}function vv(e,t){var r=br;br|=1;try{return e(t)}finally{br=r,br===0&&(Xc=mn()+500,lg&&Bs())}}function Al(e){fs!==null&&fs.tag===0&&!(br&6)&&Rc();var t=br;br|=1;var r=fi.transition,n=Er;try{if(fi.transition=null,Er=1,e)return e()}finally{Er=n,fi.transition=r,br=t,!(br&6)&&Bs()}}function wv(){Wa=jc.current,qr(jc)}function wl(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(r!==-1&&(e.timeoutHandle=-1,ET(r)),Pn!==null)for(r=Pn.return;r!==null;){var n=r;switch(tv(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&Oh();break;case 3:Vc(),qr(Ea),qr(ua),uv();break;case 5:cv(n);break;case 4:Vc();break;case 13:qr(an);break;case 19:qr(an);break;case 10:iv(n.type._context);break;case 22:case 23:wv()}r=r.return}if(Wn=e,Pn=e=Os(e.current,null),Jn=Wa=t,$n=0,of=null,yv=fg=Ol=0,Ca=Td=null,cl!==null){for(t=0;t<cl.length;t++)if(r=cl[t],n=r.interleaved,n!==null){r.interleaved=null;var a=n.next,i=r.pending;if(i!==null){var o=i.next;i.next=a,n.next=o}r.pending=n}cl=null}return e}function p_(e,t){do{var r=Pn;try{if(av(),uh.current=Bh,Lh){for(var n=on.memoizedState;n!==null;){var a=n.queue;a!==null&&(a.pending=null),n=n.next}Lh=!1}if(Cl=0,zn=In=on=null,Od=!1,rf=0,xv.current=null,r===null||r.return===null){$n=1,of=t,Pn=null;break}e:{var i=e,o=r.return,s=r,l=t;if(t=Jn,s.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,d=s,f=d.tag;if(!(d.mode&1)&&(f===0||f===11||f===15)){var h=d.alternate;h?(d.updateQueue=h.updateQueue,d.memoizedState=h.memoizedState,d.lanes=h.lanes):(d.updateQueue=null,d.memoizedState=null)}var p=nk(o);if(p!==null){p.flags&=-257,ak(p,o,s,i,t),p.mode&1&&rk(i,u,t),t=p,l=u;var x=t.updateQueue;if(x===null){var b=new Set;b.add(l),t.updateQueue=b}else x.add(l);break e}else{if(!(t&1)){rk(i,u,t),kv();break e}l=Error(Te(426))}}else if(en&&s.mode&1){var y=nk(o);if(y!==null){!(y.flags&65536)&&(y.flags|=256),ak(y,o,s,i,t),rv(Hc(l,s));break e}}i=l=Hc(l,s),$n!==4&&($n=2),Td===null?Td=[i]:Td.push(i),i=o;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var m=ZM(i,l,t);qw(i,m);break e;case 1:s=l;var g=i.type,k=i.stateNode;if(!(i.flags&128)&&(typeof g.getDerivedStateFromError=="function"||k!==null&&typeof k.componentDidCatch=="function"&&(Ns===null||!Ns.has(k)))){i.flags|=65536,t&=-t,i.lanes|=t;var S=JM(i,s,t);qw(i,S);break e}}i=i.return}while(i!==null)}x_(r)}catch(w){t=w,Pn===r&&r!==null&&(Pn=r=r.return);continue}break}while(!0)}function g_(){var e=Fh.current;return Fh.current=Bh,e===null?Bh:e}function kv(){($n===0||$n===3||$n===2)&&($n=4),Wn===null||!(Ol&268435455)&&!(fg&268435455)||cs(Wn,Jn)}function zh(e,t){var r=br;br|=2;var n=g_();(Wn!==e||Jn!==t)&&(vo=null,wl(e,t));do try{a8();break}catch(a){p_(e,a)}while(!0);if(av(),br=r,Fh.current=n,Pn!==null)throw Error(Te(261));return Wn=null,Jn=0,$n}function a8(){for(;Pn!==null;)m_(Pn)}function i8(){for(;Pn!==null&&!O6();)m_(Pn)}function m_(e){var t=b_(e.alternate,e,Wa);e.memoizedProps=e.pendingProps,t===null?x_(e):Pn=t,xv.current=null}function x_(e){var t=e;do{var r=t.alternate;if(e=t.return,t.flags&32768){if(r=JT(r,t),r!==null){r.flags&=32767,Pn=r;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{$n=6,Pn=null;return}}else if(r=ZT(r,t,Wa),r!==null){Pn=r;return}if(t=t.sibling,t!==null){Pn=t;return}Pn=t=e}while(t!==null);$n===0&&($n=5)}function al(e,t,r){var n=Er,a=fi.transition;try{fi.transition=null,Er=1,o8(e,t,r,n)}finally{fi.transition=a,Er=n}return null}function o8(e,t,r,n){do Rc();while(fs!==null);if(br&6)throw Error(Te(327));r=e.finishedWork;var a=e.finishedLanes;if(r===null)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(Te(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(F6(e,i),e===Wn&&(Pn=Wn=null,Jn=0),!(r.subtreeFlags&2064)&&!(r.flags&2064)||A0||(A0=!0,v_(jh,function(){return Rc(),null})),i=(r.flags&15990)!==0,r.subtreeFlags&15990||i){i=fi.transition,fi.transition=null;var o=Er;Er=1;var s=br;br|=4,xv.current=null,e8(e,r),d_(r,e),_T(wy),_h=!!vy,wy=vy=null,e.current=r,t8(r),A6(),br=s,Er=o,fi.transition=i}else e.current=r;if(A0&&(A0=!1,fs=e,Uh=a),i=e.pendingLanes,i===0&&(Ns=null),I6(r.stateNode),Ra(e,mn()),t!==null)for(n=e.onRecoverableError,r=0;r<t.length;r++)a=t[r],n(a.value,{componentStack:a.stack,digest:a.digest});if(Gh)throw Gh=!1,e=Gy,Gy=null,e;return Uh&1&&e.tag!==0&&Rc(),i=e.pendingLanes,i&1?e===Uy?Ed++:(Ed=0,Uy=e):Ed=0,Bs(),null}function Rc(){if(fs!==null){var e=Zj(Uh),t=fi.transition,r=Er;try{if(fi.transition=null,Er=16>e?16:e,fs===null)var n=!1;else{if(e=fs,fs=null,Uh=0,br&6)throw Error(Te(331));var a=br;for(br|=4,qe=e.current;qe!==null;){var i=qe,o=i.child;if(qe.flags&16){var s=i.deletions;if(s!==null){for(var l=0;l<s.length;l++){var u=s[l];for(qe=u;qe!==null;){var d=qe;switch(d.tag){case 0:case 11:case 15:Ad(8,d,i)}var f=d.child;if(f!==null)f.return=d,qe=f;else for(;qe!==null;){d=qe;var h=d.sibling,p=d.return;if(l_(d),d===u){qe=null;break}if(h!==null){h.return=p,qe=h;break}qe=p}}}var x=i.alternate;if(x!==null){var b=x.child;if(b!==null){x.child=null;do{var y=b.sibling;b.sibling=null,b=y}while(b!==null)}}qe=i}}if(i.subtreeFlags&2064&&o!==null)o.return=i,qe=o;else e:for(;qe!==null;){if(i=qe,i.flags&2048)switch(i.tag){case 0:case 11:case 15:Ad(9,i,i.return)}var m=i.sibling;if(m!==null){m.return=i.return,qe=m;break e}qe=i.return}}var g=e.current;for(qe=g;qe!==null;){o=qe;var k=o.child;if(o.subtreeFlags&2064&&k!==null)k.return=o,qe=k;else e:for(o=g;qe!==null;){if(s=qe,s.flags&2048)try{switch(s.tag){case 0:case 11:case 15:dg(9,s)}}catch(w){hn(s,s.return,w)}if(s===o){qe=null;break e}var S=s.sibling;if(S!==null){S.return=s.return,qe=S;break e}qe=s.return}}if(br=a,Bs(),qi&&typeof qi.onPostCommitFiberRoot=="function")try{qi.onPostCommitFiberRoot(ng,e)}catch{}n=!0}return n}finally{Er=r,fi.transition=t}}return!1}function xk(e,t,r){t=Hc(r,t),t=ZM(e,t,1),e=Ps(e,t,1),t=wa(),e!==null&&(Vf(e,1,t),Ra(e,t))}function hn(e,t,r){if(e.tag===3)xk(e,e,r);else for(;t!==null;){if(t.tag===3){xk(t,e,r);break}else if(t.tag===1){var n=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Ns===null||!Ns.has(n))){e=Hc(r,e),e=JM(t,e,1),t=Ps(t,e,1),e=wa(),t!==null&&(Vf(t,1,e),Ra(t,e));break}}t=t.return}}function s8(e,t,r){var n=e.pingCache;n!==null&&n.delete(t),t=wa(),e.pingedLanes|=e.suspendedLanes&r,Wn===e&&(Jn&r)===r&&($n===4||$n===3&&(Jn&130023424)===Jn&&500>mn()-bv?wl(e,0):yv|=r),Ra(e,t)}function y_(e,t){t===0&&(e.mode&1?(t=w0,w0<<=1,!(w0&130023424)&&(w0=4194304)):t=1);var r=wa();e=Eo(e,t),e!==null&&(Vf(e,t,r),Ra(e,r))}function l8(e){var t=e.memoizedState,r=0;t!==null&&(r=t.retryLane),y_(e,r)}function c8(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,a=e.memoizedState;a!==null&&(r=a.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(Te(314))}n!==null&&n.delete(t),y_(e,r)}var b_;b_=function(e,t,r){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ea.current)Aa=!0;else{if(!(e.lanes&r)&&!(t.flags&128))return Aa=!1,qT(e,t,r);Aa=!!(e.flags&131072)}else Aa=!1,en&&t.flags&1048576&&SM(t,Eh,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;fh(e,t),e=t.pendingProps;var a=Uc(t,ua.current);Ic(t,r),a=fv(null,t,n,e,a,r);var i=hv();return t.flags|=1,typeof a=="object"&&a!==null&&typeof a.render=="function"&&a.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ia(n)?(i=!0,Ah(t)):i=!1,t.memoizedState=a.state!==null&&a.state!==void 0?a.state:null,sv(t),a.updater=ug,t.stateNode=a,a._reactInternals=t,Oy(t,n,e,r),t=Ey(null,t,n,!0,i,r)):(t.tag=0,en&&i&&ev(t),ma(null,t,a,r),t=t.child),t;case 16:n=t.elementType;e:{switch(fh(e,t),e=t.pendingProps,a=n._init,n=a(n._payload),t.type=n,a=t.tag=d8(n),e=ji(n,e),a){case 0:t=Ty(null,t,n,e,r);break e;case 1:t=sk(null,t,n,e,r);break e;case 11:t=ik(null,t,n,e,r);break e;case 14:t=ok(null,t,n,ji(n.type,e),r);break e}throw Error(Te(306,n,""))}return t;case 0:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ji(n,a),Ty(e,t,n,a,r);case 1:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ji(n,a),sk(e,t,n,a,r);case 3:e:{if(r_(t),e===null)throw Error(Te(387));n=t.pendingProps,i=t.memoizedState,a=i.element,CM(e,t),Dh(t,n,null,r);var o=t.memoizedState;if(n=o.element,i.isDehydrated)if(i={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){a=Hc(Error(Te(423)),t),t=lk(e,t,n,r,a);break e}else if(n!==a){a=Hc(Error(Te(424)),t),t=lk(e,t,n,r,a);break e}else for(Ya=_s(t.stateNode.containerInfo.firstChild),qa=t,en=!0,Ci=null,r=PM(t,null,n,r),t.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(zc(),n===a){t=Io(e,t,r);break e}ma(e,t,n,r)}t=t.child}return t;case 5:return OM(t),e===null&&Py(t),n=t.type,a=t.pendingProps,i=e!==null?e.memoizedProps:null,o=a.children,ky(n,a)?o=null:i!==null&&ky(n,i)&&(t.flags|=32),t_(e,t),ma(e,t,o,r),t.child;case 6:return e===null&&Py(t),null;case 13:return n_(e,t,r);case 4:return lv(t,t.stateNode.containerInfo),n=t.pendingProps,e===null?t.child=Wc(t,null,n,r):ma(e,t,n,r),t.child;case 11:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ji(n,a),ik(e,t,n,a,r);case 7:return ma(e,t,t.pendingProps,r),t.child;case 8:return ma(e,t,t.pendingProps.children,r),t.child;case 12:return ma(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,a=t.pendingProps,i=t.memoizedProps,o=a.value,Hr(Ih,n._currentValue),n._currentValue=o,i!==null)if(Di(i.value,o)){if(i.children===a.children&&!Ea.current){t=Io(e,t,r);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var s=i.dependencies;if(s!==null){o=i.child;for(var l=s.firstContext;l!==null;){if(l.context===n){if(i.tag===1){l=Po(-1,r&-r),l.tag=2;var u=i.updateQueue;if(u!==null){u=u.shared;var d=u.pending;d===null?l.next=l:(l.next=d.next,d.next=l),u.pending=l}}i.lanes|=r,l=i.alternate,l!==null&&(l.lanes|=r),Ny(i.return,r,t),s.lanes|=r;break}l=l.next}}else if(i.tag===10)o=i.type===t.type?null:i.child;else if(i.tag===18){if(o=i.return,o===null)throw Error(Te(341));o.lanes|=r,s=o.alternate,s!==null&&(s.lanes|=r),Ny(o,r,t),o=i.sibling}else o=i.child;if(o!==null)o.return=i;else for(o=i;o!==null;){if(o===t){o=null;break}if(i=o.sibling,i!==null){i.return=o.return,o=i;break}o=o.return}i=o}ma(e,t,a.children,r),t=t.child}return t;case 9:return a=t.type,n=t.pendingProps.children,Ic(t,r),a=pi(a),n=n(a),t.flags|=1,ma(e,t,n,r),t.child;case 14:return n=t.type,a=ji(n,t.pendingProps),a=ji(n.type,a),ok(e,t,n,a,r);case 15:return QM(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,a=t.pendingProps,a=t.elementType===n?a:ji(n,a),fh(e,t),t.tag=1,Ia(n)?(e=!0,Ah(t)):e=!1,Ic(t,r),qM(t,n,a),Oy(t,n,a,r),Ey(null,t,n,!0,e,r);case 19:return a_(e,t,r);case 22:return e_(e,t,r)}throw Error(Te(156,t.tag))};function v_(e,t){return Xj(e,t)}function u8(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ci(e,t,r,n){return new u8(e,t,r,n)}function Sv(e){return e=e.prototype,!(!e||!e.isReactComponent)}function d8(e){if(typeof e=="function")return Sv(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Ub)return 11;if(e===zb)return 14}return 2}function Os(e,t){var r=e.alternate;return r===null?(r=ci(e.tag,t,e.key,e.mode),r.elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=e.flags&14680064,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function gh(e,t,r,n,a,i){var o=2;if(n=e,typeof e=="function")Sv(e)&&(o=1);else if(typeof e=="string")o=5;else e:switch(e){case pc:return kl(r.children,a,i,t);case Gb:o=8,a|=8;break;case ey:return e=ci(12,r,t,a|2),e.elementType=ey,e.lanes=i,e;case ty:return e=ci(13,r,t,a),e.elementType=ty,e.lanes=i,e;case ry:return e=ci(19,r,t,a),e.elementType=ry,e.lanes=i,e;case Oj:return hg(r,a,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case Nj:o=10;break e;case Cj:o=9;break e;case Ub:o=11;break e;case zb:o=14;break e;case as:o=16,n=null;break e}throw Error(Te(130,e==null?e:typeof e,""))}return t=ci(o,r,t,a),t.elementType=e,t.type=n,t.lanes=i,t}function kl(e,t,r,n){return e=ci(7,e,n,t),e.lanes=r,e}function hg(e,t,r,n){return e=ci(22,e,n,t),e.elementType=Oj,e.lanes=r,e.stateNode={isHidden:!1},e}function Jm(e,t,r){return e=ci(6,e,null,t),e.lanes=r,e}function Qm(e,t,r){return t=ci(4,e.children!==null?e.children:[],e.key,t),t.lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function f8(e,t,r,n,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Em(0),this.expirationTimes=Em(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Em(0),this.identifierPrefix=n,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function jv(e,t,r,n,a,i,o,s,l){return e=new f8(e,t,r,s,l),t===1?(t=1,i===!0&&(t|=8)):t=0,i=ci(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},sv(i),e}function h8(e,t,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:hc,key:n==null?null:""+n,children:e,containerInfo:t,implementation:r}}function w_(e){if(!e)return Rs;e=e._reactInternals;e:{if(Vl(e)!==e||e.tag!==1)throw Error(Te(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ia(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(Te(171))}if(e.tag===1){var r=e.type;if(Ia(r))return wM(e,r,t)}return t}function k_(e,t,r,n,a,i,o,s,l){return e=jv(r,n,!0,e,a,i,o,s,l),e.context=w_(null),r=e.current,n=wa(),a=Cs(r),i=Po(n,a),i.callback=t??null,Ps(r,i,a),e.current.lanes=a,Vf(e,a,n),Ra(e,n),e}function pg(e,t,r,n){var a=t.current,i=wa(),o=Cs(a);return r=w_(r),t.context===null?t.context=r:t.pendingContext=r,t=Po(i,o),t.payload={element:e},n=n===void 0?null:n,n!==null&&(t.callback=n),e=Ps(a,t,o),e!==null&&(Ri(e,a,o,i),ch(e,a,o)),o}function Wh(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function yk(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var r=e.retryLane;e.retryLane=r!==0&&r<t?r:t}}function Mv(e,t){yk(e,t),(e=e.alternate)&&yk(e,t)}function p8(){return null}var S_=typeof reportError=="function"?reportError:function(e){console.error(e)};function _v(e){this._internalRoot=e}gg.prototype.render=_v.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(Te(409));pg(e,t,null,null)};gg.prototype.unmount=_v.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Al(function(){pg(null,e,null,null)}),t[To]=null}};function gg(e){this._internalRoot=e}gg.prototype.unstable_scheduleHydration=function(e){if(e){var t=eM();e={blockedOn:null,target:e,priority:t};for(var r=0;r<ls.length&&t!==0&&t<ls[r].priority;r++);ls.splice(r,0,e),r===0&&rM(e)}};function Pv(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function mg(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function bk(){}function g8(e,t,r,n,a){if(a){if(typeof n=="function"){var i=n;n=function(){var u=Wh(o);i.call(u)}}var o=k_(t,n,e,0,null,!1,!1,"",bk);return e._reactRootContainer=o,e[To]=o.current,Zd(e.nodeType===8?e.parentNode:e),Al(),o}for(;a=e.lastChild;)e.removeChild(a);if(typeof n=="function"){var s=n;n=function(){var u=Wh(l);s.call(u)}}var l=jv(e,0,!1,null,null,!1,!1,"",bk);return e._reactRootContainer=l,e[To]=l.current,Zd(e.nodeType===8?e.parentNode:e),Al(function(){pg(t,l,r,n)}),l}function xg(e,t,r,n,a){var i=r._reactRootContainer;if(i){var o=i;if(typeof a=="function"){var s=a;a=function(){var l=Wh(o);s.call(l)}}pg(t,o,e,a)}else o=g8(r,t,e,a,n);return Wh(o)}Jj=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=kd(t.pendingLanes);r!==0&&(Hb(t,r|1),Ra(t,mn()),!(br&6)&&(Xc=mn()+500,Bs()))}break;case 13:Al(function(){var n=Eo(e,1);if(n!==null){var a=wa();Ri(n,e,1,a)}}),Mv(e,1)}};Xb=function(e){if(e.tag===13){var t=Eo(e,134217728);if(t!==null){var r=wa();Ri(t,e,134217728,r)}Mv(e,134217728)}};Qj=function(e){if(e.tag===13){var t=Cs(e),r=Eo(e,t);if(r!==null){var n=wa();Ri(r,e,t,n)}Mv(e,t)}};eM=function(){return Er};tM=function(e,t){var r=Er;try{return Er=e,t()}finally{Er=r}};fy=function(e,t,r){switch(t){case"input":if(iy(e,r),t=r.name,r.type==="radio"&&t!=null){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var a=sg(n);if(!a)throw Error(Te(90));Tj(n),iy(n,a)}}}break;case"textarea":Ij(e,r);break;case"select":t=r.value,t!=null&&Oc(e,!!r.multiple,t,!1)}};Gj=vv;Uj=Al;var m8={usingClientEntryPoint:!1,Events:[Xf,yc,sg,Bj,Fj,vv]},od={findFiberByHostInstance:ll,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},x8={bundleType:od.bundleType,version:od.version,rendererPackageName:od.rendererPackageName,rendererConfig:od.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Bo.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Vj(e),e===null?null:e.stateNode},findFiberByHostInstance:od.findFiberByHostInstance||p8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var T0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!T0.isDisabled&&T0.supportsFiber)try{ng=T0.inject(x8),qi=T0}catch{}}Ja.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=m8;Ja.createPortal=function(e,t){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Pv(t))throw Error(Te(200));return h8(e,t,null,r)};Ja.createRoot=function(e,t){if(!Pv(e))throw Error(Te(299));var r=!1,n="",a=S_;return t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(n=t.identifierPrefix),t.onRecoverableError!==void 0&&(a=t.onRecoverableError)),t=jv(e,1,!1,null,null,r,!1,n,a),e[To]=t.current,Zd(e.nodeType===8?e.parentNode:e),new _v(t)};Ja.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(Te(188)):(e=Object.keys(e).join(","),Error(Te(268,e)));return e=Vj(t),e=e===null?null:e.stateNode,e};Ja.flushSync=function(e){return Al(e)};Ja.hydrate=function(e,t,r){if(!mg(t))throw Error(Te(200));return xg(null,e,t,!0,r)};Ja.hydrateRoot=function(e,t,r){if(!Pv(e))throw Error(Te(405));var n=r!=null&&r.hydratedSources||null,a=!1,i="",o=S_;if(r!=null&&(r.unstable_strictMode===!0&&(a=!0),r.identifierPrefix!==void 0&&(i=r.identifierPrefix),r.onRecoverableError!==void 0&&(o=r.onRecoverableError)),t=k_(t,null,e,1,r??null,a,!1,i,o),e[To]=t.current,Zd(e),n)for(e=0;e<n.length;e++)r=n[e],a=r._getVersion,a=a(r._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[r,a]:t.mutableSourceEagerHydrationData.push(r,a);return new gg(t)};Ja.render=function(e,t,r){if(!mg(t))throw Error(Te(200));return xg(null,e,t,!1,r)};Ja.unmountComponentAtNode=function(e){if(!mg(e))throw Error(Te(40));return e._reactRootContainer?(Al(function(){xg(null,null,e,!1,function(){e._reactRootContainer=null,e[To]=null})}),!0):!1};Ja.unstable_batchedUpdates=vv;Ja.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!mg(r))throw Error(Te(200));if(e==null||e._reactInternals===void 0)throw Error(Te(38));return xg(e,t,r,!1,n)};Ja.version="18.3.1-next-f1338f8080-20240426";function j_(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(j_)}catch(e){console.error(e)}}j_(),jj.exports=Ja;var y8=jj.exports,vk=y8;Jx.createRoot=vk.createRoot,Jx.hydrateRoot=vk.hydrateRoot;const As=({isOpen:e,onClose:t,onConfirm:r,title:n,message:a,confirmText:i="I know the risk and insist to continue",cancelText:o="Cancel"})=>e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-md rounded-2xl shadow-2xl border border-amber-500/30 overflow-hidden transform transition-all scale-100",children:[c.jsxs("div",{className:"bg-amber-500/10 p-6 flex flex-col items-center justify-center border-b border-amber-500/20",children:[c.jsx("div",{className:"w-16 h-16 bg-amber-100 dark:bg-amber-900/30 rounded-full flex items-center justify-center mb-4",children:c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 text-amber-600 dark:text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),c.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white text-center",children:n})]}),c.jsx("div",{className:"p-6",children:c.jsx("div",{className:"text-gray-600 dark:text-slate-300 text-center text-sm leading-relaxed",children:a})}),c.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 flex gap-3 justify-end border-t border-gray-200 dark:border-slate-800",children:[c.jsx("button",{onClick:t,className:"px-4 py-2 bg-white hover:bg-gray-100 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-700 dark:text-slate-200 font-semibold rounded-lg border border-gray-300 dark:border-slate-600 transition-colors text-sm",children:o}),c.jsx("button",{onClick:r,className:"px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white font-bold rounded-lg shadow-lg shadow-amber-500/20 transition-all active:scale-95 text-sm",children:i})]})]})}):null,b8=({onFileSelected:e,onGenerateFakeDng:t,fileName:r,hasGeneratedData:n,viewMode:a,onSetViewMode:i,patternPeriod:o,onPatternPeriodChange:s,fillFactor:l,onFillFactorChange:u,patternPhase:d,onPatternPhaseChange:f,showPatternControls:h,onOpenAbout:p,onShowExif:x,bridgeStatus:b,onBridgeClick:y,isDrLabOpen:m,onToggleDrLab:g,isColorLabOpen:k,onToggleColorLab:S,isFftLabOpen:w,onToggleFftLab:v,isSfrLabOpen:M,onToggleSfrLab:_,onGenerateTestPic:P,onPTCFilesSelected:A,onDownloadDng:R,isThreePlane:D,onOpenDatabase:E,isSidebarOpen:W,onToggleSidebar:F,onOpenSaveZ8:O,isPsModeOpen:$,onTogglePsMode:N})=>{const C=j.useRef(null),B=j.useRef(null),[I,z]=j.useState(!1),[V,K]=j.useState(!1),[q,G]=j.useState(!1),[pe,J]=j.useState("direct"),Z=j.useRef(null),ae=j.useRef(null);j.useEffect(()=>{const se=he=>{Z.current&&!Z.current.contains(he.target)&&K(!1),ae.current&&!ae.current.contains(he.target)&&G(!1)};return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[]);const ce=se=>{var he,ue;if($){K(!1);return}K(!1),se==="direct"?(J("direct"),(he=C.current)==null||he.click()):!b.isConnected||!b.hasDngConverter?z(!0):(J("convert"),(ue=C.current)==null||ue.click())},ne=se=>{var ue;if($){se.target.value="";return}const he=(ue=se.target.files)==null?void 0:ue[0];he&&e(he,pe),se.target.value=""},le=se=>{se.target.files&&se.target.files.length>0&&A(se.target.files),se.target.value=""};return r==="pattern_test.dng"||(r==null||r.startsWith("Diff_")),c.jsxs("header",{className:"flex flex-col sm:flex-row justify-between items-center gap-4 mb-4 flex-shrink-0 relative z-50 font-mono",children:[c.jsx(As,{isOpen:I,onClose:()=>z(!1),onConfirm:()=>z(!1),title:"DNG Converter Missing",confirmText:"OK",cancelText:"Cancel",message:c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsx("p",{className:"font-bold text-red-600 dark:text-red-400 text-base",children:"JiangBridge Offline or Adobe DNG Converter not installed"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"To use the conversion feature, you must run JiangBridge locally and have Adobe DNG Converter installed on your system."})]})}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-black dark:text-white text-center sm:text-left tracking-tight border-2 border-black dark:border-white px-2 py-1 bg-white dark:bg-black",children:"Jiangtherapee_Online"}),c.jsx("p",{className:"text-sm text-gray-600 dark:text-slate-400 hidden lg:block max-w-xs truncate font-bold",title:r||"No image loaded",children:r||"No_Image_Loaded"}),D&&c.jsx("span",{className:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border-2 border-red-500 dark:border-red-800 text-[10px] font-bold px-2 py-1 animate-pulse",children:" 3-PLANE / RGB MODE"})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-wrap justify-end",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("button",{onClick:b.isConnected?void 0:y,className:`px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-black dark:border-gray-500 ${b.isConnected?"bg-emerald-100 text-emerald-900 border-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400 dark:border-emerald-600 cursor-default":"bg-pink-100 text-pink-900 border-pink-800 dark:bg-pink-900/30 dark:text-pink-400 dark:border-pink-600 hover:bg-pink-200 dark:hover:bg-pink-900/50 cursor-pointer animate-pulse"}`,title:b.isConnected?"Local Bridge Service Connected":"Click to download Jiangbridge",children:[c.jsx("span",{className:`w-2 h-2 ${b.isConnected?"bg-emerald-600":"bg-pink-600"}`}),b.isConnected?`JiangBridge Ready ${b.hasDngConverter?"DNG+":""}`:"JiangBridge Offline"]}),m&&c.jsxs("button",{onClick:g,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-indigo-800 bg-indigo-100 text-indigo-900 dark:bg-indigo-900/30 dark:text-indigo-400 dark:border-indigo-600 hover:bg-indigo-200 dark:hover:bg-indigo-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off DR Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-indigo-600 animate-pulse"}),"DR Lab On"]}),k&&c.jsxs("button",{onClick:S,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-yellow-800 bg-yellow-100 text-yellow-900 dark:bg-yellow-900/30 dark:text-yellow-400 dark:border-yellow-600 hover:bg-yellow-200 dark:hover:bg-yellow-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off Color Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-yellow-500 animate-pulse"}),"Color Lab On"]}),w&&c.jsxs("button",{onClick:v,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-fuchsia-800 bg-fuchsia-100 text-fuchsia-900 dark:bg-fuchsia-900/30 dark:text-fuchsia-400 dark:border-fuchsia-600 hover:bg-fuchsia-200 dark:hover:bg-fuchsia-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off FFT Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-fuchsia-600 animate-pulse"}),"FFT Lab On"]}),M&&c.jsxs("button",{onClick:_,className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-orange-800 bg-orange-100 text-orange-900 dark:bg-orange-900/30 dark:text-orange-400 dark:border-orange-600 hover:bg-orange-200 dark:hover:bg-orange-900/50 cursor-pointer animate-in fade-in",title:"Click to turn off SFR Lab",children:[c.jsx("span",{className:"w-2 h-2 bg-orange-600 animate-pulse"}),"SFR Lab On"]}),$&&c.jsxs("button",{className:"px-3 py-1.5 text-xs font-bold transition-all duration-200 flex items-center gap-1.5 shadow-[2px_2px_0px_black] border-2 border-teal-800 bg-teal-100 text-teal-900 dark:bg-teal-900/30 dark:text-teal-400 dark:border-teal-600 cursor-default animate-in fade-in",title:"PS Mode is locked",children:[c.jsx("span",{className:"w-2 h-2 bg-teal-500 animate-pulse"}),"PS Mode On"]})]}),c.jsx("input",{type:"file",ref:C,onChange:ne,className:"hidden"}),c.jsx("input",{type:"file",ref:B,onChange:le,className:"hidden",multiple:!0,accept:".csv"}),c.jsxs("div",{className:"relative inline-block text-left",ref:ae,children:[c.jsxs("button",{onClick:()=>G(!q),className:"bg-purple-700 hover:bg-purple-600 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2",children:["TOOLS",c.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${q?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),q&&c.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 shadow-[8px_8px_0px_rgba(0,0,0,0.5)] ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-hidden origin-top-right transition-all animate-in fade-in slide-in-from-top-2 border-2 border-black dark:border-gray-500",children:c.jsxs("div",{className:"py-1",children:[c.jsxs("button",{onClick:()=>{G(!1),N&&!$&&N(),m&&g(),w&&v(),k&&S&&S(),M&&_&&_()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${$?"bg-teal-100 dark:bg-teal-900/40 text-teal-800 dark:text-teal-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-teal-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})}),c.jsxs("span",{children:["PS Mode ",$?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{G(!1),m||g(),w&&v(),k&&S&&S(),M&&_&&_(),$&&N()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${m?"bg-indigo-100 dark:bg-indigo-900/40 text-indigo-800 dark:text-indigo-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-indigo-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),c.jsxs("span",{children:["DR Lab ",m?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{G(!1),S&&!k&&S(),m&&g(),w&&v(),M&&_&&_(),$&&N()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${k?"bg-yellow-100 dark:bg-yellow-900/40 text-yellow-800 dark:text-yellow-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-yellow-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})}),c.jsxs("span",{children:["Color Lab ",k?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{G(!1),_&&!M&&_(),m&&g(),w&&v(),k&&S&&S(),$&&N()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${M?"bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-orange-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),c.jsxs("span",{children:["SFR Lab ",M?"(On)":""]})]}),c.jsxs("button",{onClick:()=>{G(!1),w||v(),m&&g(),k&&S&&S(),M&&_&&_(),$&&N()},className:`w-full text-left px-4 py-3 text-sm transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600 ${w?"bg-fuchsia-100 dark:bg-fuchsia-900/40 text-fuchsia-800 dark:text-fuchsia-300 font-bold":"text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:[c.jsx("svg",{className:"w-4 h-4 text-fuchsia-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),c.jsxs("span",{children:["Stack Lab ",w?"(On)":""]})]}),c.jsx("div",{className:"border-t border-gray-300 dark:border-gray-600 my-1"}),c.jsxs("button",{onClick:()=>{G(!1),O==null||O()},className:"w-full text-left px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),c.jsx("span",{children:" Z8 (Save Z8)"})]}),c.jsxs("button",{onClick:()=>{G(!1),t()},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),c.jsx("span",{children:"Generate Pattern DNG"})]}),c.jsxs("button",{onClick:()=>{var se;G(!1),(se=B.current)==null||se.click()},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-emerald-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z"})}),c.jsx("span",{children:"Generate PTC"})]}),c.jsxs("button",{onClick:()=>{G(!1),window.open("https://y-g-jiang.github.io/CP.html","_blank")},className:"w-full text-left px-4 py-2 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-teal-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2m0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),c.jsx("span",{children:"Generate MTF Contour"})]})]})})]}),c.jsxs("div",{className:"relative inline-block text-left",ref:Z,children:[c.jsxs("button",{onClick:()=>!$&&K(!V),disabled:$,className:`bg-cyan-700 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2 ${$?"opacity-50 cursor-not-allowed":"hover:bg-cyan-600 active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black]"}`,title:$?"Load Image is disabled while PS Mode is active":void 0,children:["Load Image",c.jsx("svg",{className:`w-4 h-4 transition-transform duration-200 ${V?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),V&&c.jsx("div",{className:"absolute right-0 mt-2 w-56 bg-white dark:bg-slate-800 shadow-[8px_8px_0px_rgba(0,0,0,0.5)] ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-hidden origin-top-right transition-all animate-in fade-in slide-in-from-top-2 border-2 border-black dark:border-gray-500",children:c.jsxs("div",{className:"py-1",children:[c.jsxs("button",{onClick:()=>ce("direct"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2 border-b border-gray-300 dark:border-gray-600",children:[c.jsx("svg",{className:"w-4 h-4 text-cyan-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),c.jsx("span",{children:"Load Image (Direct)"})]}),c.jsxs("button",{onClick:()=>ce("convert"),className:"w-full text-left px-4 py-3 text-sm text-gray-800 dark:text-slate-200 hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors flex items-center gap-2",children:[c.jsx("svg",{className:"w-4 h-4 text-purple-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"})}),c.jsx("span",{children:"Convert to Adobe DNG & Load"})]})]})})]}),r&&x&&c.jsxs("button",{onClick:x,className:"bg-orange-600 hover:bg-orange-500 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-1",title:"View EXIF Data",children:[c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"EXIF"]}),c.jsx("button",{onClick:p,className:"bg-teal-700 hover:bg-teal-600 text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap",children:"About/Tutorial/Tools"}),c.jsx("a",{href:"https://y-g-jiang.github.io/index.html",target:"_blank",rel:"noopener noreferrer",className:"bg-gray-300 hover:bg-gray-200 dark:bg-slate-700 dark:hover:bg-slate-600 text-black dark:text-white font-bold py-2 px-4 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm no-underline",children:"Home"}),c.jsxs("button",{onClick:F,className:`bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 px-3 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray] active:translate-x-[2px] active:translate-y-[2px] active:shadow-[2px_2px_0px_black] transition-all duration-100 text-sm whitespace-nowrap flex items-center gap-2 ${W?"":"ring-2 ring-cyan-500 ring-offset-2 dark:ring-offset-black"}`,title:W?"Hide Control Panel":"Show Control Panel",children:[c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:W?c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 5l7 7-7 7M5 5l7 7-7 7"}):c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})}),c.jsx("span",{className:"hidden sm:inline",children:W?"Hide Panel":"Show Panel"})]})]})]})},v8=({image:e,zoom:t,pan:r,onPanChange:n,onZoomChange:a,onSelectionChange:i,forcedSelection:o,theme:s,touchAction:l="pan",isMarking:u=!1,onPointClick:d,markers:f=[],gridRects:h=[],colorLabPoints:p=[],colorLabRects:x=[],sfrRects:b=[],psMaskOverlay:y=null,psMaskDirtyRect:m=null,psGuides:g=[],psSelectedGuideId:k=null,psGuidePickTarget:S=null,psEllipseTool:w={mode:"off",draft:null},psEditableEllipse:v=null,psBrush:M,onPsBrushPaint:_,onPsGuidePickPoint:P,onPsEllipseCenterPick:A,onPsEllipseDrag:R,onPsEditEllipse:D})=>{var Ot;const E=j.useRef(null),W=j.useRef(document.createElement("canvas")),F=j.useRef(null),O=j.useRef(null),[$,N]=j.useState(!1),[C,B]=j.useState({x:0,y:0}),I=j.useRef(null),z=j.useRef(null),V=j.useRef(null),[K,q]=j.useState(!1),[G,pe]=j.useState(null),[J,Z]=j.useState(null),[ae,ce]=j.useState(!1),[ne,le]=j.useState(!1),[se,he]=j.useState(!1),[ue,ie]=j.useState(null),xe=j.useRef(null),Se=j.useRef(null),Ie=j.useRef(null),te=j.useRef(null),Oe=_e=>{xe.current=_e,ie(_e)};j.useEffect(()=>{o!==void 0&&Z(o)},[o]),j.useEffect(()=>{se||Oe(null)},[se,v==null?void 0:v.id]),j.useEffect(()=>{if(!y){F.current=null,O.current=null;return}if(!F.current||!O.current||O.current.width!==y.width||O.current.height!==y.height||!m){const nr=document.createElement("canvas");nr.width=y.width,nr.height=y.height;const Gt=nr.getContext("2d");if(!Gt)return;const mt=Gt.createImageData(y.width,y.height);for(let Jt=0;Jt<y.alpha.length;Jt++){const Pr=Math.max(0,Math.min(1,y.alpha[Jt])),Zr=Jt*4;mt.data[Zr]=255,mt.data[Zr+1]=56,mt.data[Zr+2]=56,mt.data[Zr+3]=Math.round(Pr*128)}Gt.putImageData(mt,0,0),F.current=nr,O.current={width:y.width,height:y.height};return}const ve=F.current.getContext("2d");if(!ve)return;const de=Math.max(0,Math.floor(m.x0)),De=Math.max(0,Math.floor(m.y0)),Ye=Math.min(y.width-1,Math.ceil(m.x1)),st=Math.min(y.height-1,Math.ceil(m.y1)),_t=Math.max(0,Ye-de+1),Xe=Math.max(0,st-De+1);if(_t<=0||Xe<=0)return;const Ar=ve.createImageData(_t,Xe);for(let nr=0;nr<Xe;nr++){const mt=(De+nr)*y.width,Jt=nr*_t;for(let Pr=0;Pr<_t;Pr++){const Zr=de+Pr,jr=Math.max(0,Math.min(1,y.alpha[mt+Zr])),we=(Jt+Pr)*4;Ar.data[we]=255,Ar.data[we+1]=56,Ar.data[we+2]=56,Ar.data[we+3]=Math.round(jr*128)}}ve.putImageData(Ar,de,De)},[y==null?void 0:y.alpha,y==null?void 0:y.width,y==null?void 0:y.height,y==null?void 0:y.version,m]);const Fe=j.useCallback(()=>{const _e=E.current,ee=_e==null?void 0:_e.getContext("2d");return{canvas:_e,ctx:ee}},[]);j.useEffect(()=>{const _e=W.current,ee=_e.getContext("2d");if(!e||!ee)return;let ve=0,de=0;e instanceof ImageData?(ve=e.width,de=e.height):e instanceof HTMLImageElement&&(ve=e.naturalWidth,de=e.naturalHeight),!(ve===0||de===0)&&((_e.width!==ve||_e.height!==de)&&(_e.width=ve,_e.height=de),e instanceof ImageData?ee.putImageData(e,0,0):(ee.clearRect(0,0,ve,de),ee.drawImage(e,0,0)))},[e]);const bt=j.useCallback(()=>{const{canvas:_e,ctx:ee}=Fe();if(!_e||!ee||!e)return;if(ee.setTransform(1,0,0,1,0,0),ee.fillStyle=s==="dark"?"rgb(15, 23, 42)":"rgb(243, 244, 246)",ee.fillRect(0,0,_e.width,_e.height),ee.setTransform(t,0,0,t,r.x,r.y),W.current.width>0&&(ee.imageSmoothingEnabled=!1,ee.drawImage(W.current,0,0)),F.current&&(ee.imageSmoothingEnabled=!1,ee.drawImage(F.current,0,0)),g&&g.length>0){ee.save();for(const de of g){if(de.visible===!1)continue;const De=k===de.id;ee.strokeStyle=De?"#f59e0b":"#22d3ee",ee.lineWidth=De?2/t:1/t,ee.setLineDash([8/t,6/t]),ee.beginPath(),ee.moveTo(de.p1.x,de.p1.y),ee.lineTo(de.p2.x,de.p2.y),ee.stroke();const Ye=3/t;ee.fillStyle=De?"#f59e0b":"#22d3ee",ee.beginPath(),ee.arc(de.p1.x,de.p1.y,Ye,0,Math.PI*2),ee.arc(de.p2.x,de.p2.y,Ye,0,Math.PI*2),ee.fill()}ee.restore()}if(w.mode!=="off"&&w.draft){const de=w.draft;ee.save(),ee.strokeStyle="#f59e0b",ee.lineWidth=2/t,ee.setLineDash([6/t,4/t]),ee.beginPath(),ee.ellipse(de.center.x,de.center.y,Math.max(1,de.radiusX),Math.max(1,de.radiusY),de.rotationDeg*Math.PI/180,0,Math.PI*2),ee.stroke(),ee.setLineDash([]),ee.fillStyle="#f59e0b",ee.beginPath(),ee.arc(de.center.x,de.center.y,3/t,0,Math.PI*2),ee.fill(),ee.restore()}const ve=se&&ue?ue:v;if(ve&&w.mode==="off"){const de=ve,De=ht(de),Ye=4/t;ee.save(),ee.strokeStyle="#14b8a6",ee.lineWidth=1.5/t,ee.setLineDash([5/t,3/t]),ee.beginPath(),ee.ellipse(de.center.x,de.center.y,Math.max(1,de.radiusX),Math.max(1,de.radiusY),de.rotationDeg*Math.PI/180,0,Math.PI*2),ee.stroke(),ee.setLineDash([]),ee.strokeStyle="#22d3ee",ee.beginPath(),ee.moveTo(De.center.x,De.center.y),ee.lineTo(De.rotHandle.x,De.rotHandle.y),ee.stroke();const st=(_t,Xe)=>{ee.fillStyle=Xe,ee.beginPath(),ee.arc(_t.x,_t.y,Ye,0,Math.PI*2),ee.fill(),ee.strokeStyle="#0f172a",ee.lineWidth=1/t,ee.stroke()};st(De.center,"#f59e0b"),st(De.rxHandle,"#38bdf8"),st(De.ryHandle,"#818cf8"),st(De.rotHandle,"#22d3ee"),ee.restore()}if(J){ee.strokeStyle="#06b6d4",ee.lineWidth=1/t,ee.fillStyle="rgba(6, 182, 212, 0.2)",ee.beginPath(),ee.rect(J.x,J.y,J.w,J.h),ee.fill(),ee.stroke(),ee.save(),ee.fillStyle="#fff";const de=Math.max(10,14/t);ee.font=`${de}px monospace`,ee.shadowColor="rgba(0,0,0,0.8)",ee.shadowBlur=4,ee.shadowOffsetX=1,ee.shadowOffsetY=1,ee.fillText(`${Math.round(J.w)}x${Math.round(J.h)}`,J.x,J.y-5/t),ee.restore()}if(h&&h.length>0){ee.save(),ee.strokeStyle="#f59e0b",ee.lineWidth=1/t,ee.globalAlpha=.8,ee.beginPath(),h.forEach(Ye=>{ee.rect(Ye.x,Ye.y,Ye.w,Ye.h)}),ee.stroke();const de=h[0];ee.fillStyle="#f59e0b";const De=Math.max(10,12/t);ee.font=`${De}px monospace`,ee.fillText(`${Math.round(de.w)}x${Math.round(de.h)}`,de.x,de.y-4/t),ee.restore()}if(f&&f.length>0){ee.save();const de=6/t,De=Math.max(12,16/t);ee.font=`bold ${De}px sans-serif`,ee.textAlign="center",ee.textBaseline="middle",f.forEach((Ye,st)=>{ee.beginPath(),ee.arc(Ye.x,Ye.y,de,0,2*Math.PI),ee.fillStyle="white",ee.fill(),ee.strokeStyle="#4338ca",ee.lineWidth=2/t,ee.stroke(),ee.fillStyle="#4338ca",ee.fillText((st+1).toString(),Ye.x,Ye.y-12/t)}),ee.restore()}if(p&&p.length>0){ee.save();const de=5/t,De=Math.max(10,14/t);ee.font=`bold ${De}px sans-serif`,ee.textAlign="center",ee.textBaseline="middle",p.forEach((Ye,st)=>{ee.fillStyle="yellow",ee.fillRect(Ye.x-de,Ye.y-de,de*2,de*2),ee.strokeStyle="black",ee.lineWidth=1/t,ee.strokeRect(Ye.x-de,Ye.y-de,de*2,de*2),ee.fillStyle="yellow",ee.shadowColor="black",ee.shadowBlur=2,ee.fillText((st+1).toString(),Ye.x,Ye.y-10/t)}),ee.restore()}if(x&&x.length>0){if(ee.save(),ee.strokeStyle="yellow",ee.lineWidth=1/t,ee.globalAlpha=.9,ee.beginPath(),x.forEach(de=>{ee.rect(de.x,de.y,de.w,de.h)}),ee.stroke(),x[0]){const de=x[0];ee.fillStyle="yellow",ee.shadowColor="black",ee.shadowBlur=3;const De=Math.max(10,12/t);ee.font=`${De}px monospace`,ee.fillText(`${Math.round(de.w)}x${Math.round(de.h)}`,de.x,de.y-4/t)}ee.restore()}b&&b.length>0&&(ee.save(),ee.strokeStyle="#ef4444",ee.lineWidth=2/t,ee.globalAlpha=.9,ee.beginPath(),b.forEach(de=>{ee.rect(de.x,de.y,de.w,de.h)}),ee.stroke(),ee.restore())},[Fe,e,t,r,s,J,h,f,p,x,b,y==null?void 0:y.version,g,k,w,v,se,ue]);j.useEffect(()=>{const{canvas:_e}=Fe();if(!_e)return;const ee=new ResizeObserver(()=>{_e.width=_e.clientWidth,_e.height=_e.clientHeight,bt()});return ee.observe(_e),()=>ee.disconnect()},[Fe,bt]),j.useEffect(()=>{bt()},[bt,e,r,t,s,J,h,f,p,x,b,g,k,v,se,ue]);const Ct=_e=>{const{canvas:ee}=Fe();if(!ee)return{x:0,y:0};const ve=ee.getBoundingClientRect();return{x:_e.clientX-ve.left,y:_e.clientY-ve.top}},ut=(_e,ee)=>({x:(_e-r.x)/t,y:(ee-r.y)/t}),dt=_e=>{const ee=_e*Math.PI/180,ve={x:Math.cos(ee),y:Math.sin(ee)},de={x:-Math.sin(ee),y:Math.cos(ee)};return{ux:ve,uy:de}},ht=_e=>{const{ux:ee,uy:ve}=dt(_e.rotationDeg),de=_e.center,De=Math.max(1,_e.radiusX),Ye=Math.max(1,_e.radiusY),st={x:de.x+ee.x*De,y:de.y+ee.y*De},_t={x:de.x+ve.x*Ye,y:de.y+ve.y*Ye},Xe={x:de.x+ee.x*(De+28/t),y:de.y+ee.y*(De+28/t)};return{center:de,rxHandle:st,ryHandle:_t,rotHandle:Xe,ux:ee,uy:ve}},tt=(_e,ee)=>{const ve=_e.x-ee.x,de=_e.y-ee.y;return ve*ve+de*de},vt=_e=>{const ee=se&&ue?ue:v;if(!ee||w.mode!=="off")return null;const ve=ht(ee),de=8/t,De=de*de;if(tt(_e,ve.rotHandle)<=De)return"rotate";if(tt(_e,ve.rxHandle)<=De)return"radiusX";if(tt(_e,ve.ryHandle)<=De)return"radiusY";if(tt(_e,ve.center)<=De)return"move";const Ye=_e.x-ve.center.x,st=_e.y-ve.center.y,_t=Ye*ve.ux.x+st*ve.ux.y,Xe=Ye*ve.uy.x+st*ve.uy.y,Ar=_t/Math.max(1,ee.radiusX),nr=Xe/Math.max(1,ee.radiusY);return Ar*Ar+nr*nr<=1.05*1.05?"move":null},Sr=_e=>{if(!v||!D||w.mode!=="off")return!1;const ee=vt(_e);return ee?(Ie.current=ee,te.current={itemId:v.id,startMouse:_e,center:{...v.center},radiusX:v.radiusX,radiusY:v.radiusY,rotationDeg:v.rotationDeg},Oe({id:v.id,center:{...v.center},radiusX:v.radiusX,radiusY:v.radiusY,rotationDeg:v.rotationDeg}),he(!0),!0):!1},Ft=_e=>{if(!se)return!1;const ee=Ie.current,ve=te.current;if(!ee||!ve)return!1;const de={id:ve.itemId,center:{...ve.center},radiusX:ve.radiusX,radiusY:ve.radiusY,rotationDeg:ve.rotationDeg};if(ee==="move")return de.center={x:ve.center.x+(_e.x-ve.startMouse.x),y:ve.center.y+(_e.y-ve.startMouse.y)},Oe(de),!0;if(ee==="rotate"){const Xe=Math.atan2(_e.y-ve.center.y,_e.x-ve.center.x)*180/Math.PI;return de.rotationDeg=Xe,Oe(de),!0}const{ux:De,uy:Ye}=dt(ve.rotationDeg),st=_e.x-ve.center.x,_t=_e.y-ve.center.y;if(ee==="radiusX"){const Xe=Math.max(1,Math.abs(st*De.x+_t*De.y));return de.radiusX=Xe,Oe(de),!0}if(ee==="radiusY"){const Xe=Math.max(1,Math.abs(st*Ye.x+_t*Ye.y));return de.radiusY=Xe,Oe(de),!0}return!1},rt=()=>{if(!se||!D)return;const _e=te.current,ee=xe.current||ue;!_e||!ee||D(_e.itemId,{center:ee.center,radiusX:ee.radiusX,radiusY:ee.radiusY,rotationDeg:ee.rotationDeg})},Kt=_e=>{_e.preventDefault();const ee=Ct(_e),ve=ut(ee.x,ee.y);if(Se.current=ve,w.mode==="center"&&A){A(ve);return}if(w.mode==="drag"&&R){R(ve,"start"),le(!0);return}if(!Sr(ve)){if(S&&P){P(ve);return}if(M!=null&&M.enabled&&_&&!u&&l!=="select"&&!_e.shiftKey){const de=ut(ee.x,ee.y);_(de,"start"),ce(!0);return}if(u&&d){const de=ut(ee.x,ee.y);d(de);return}if(l==="select"||_e.shiftKey){q(!0);const de=ut(ee.x,ee.y),De={x:Math.floor(de.x),y:Math.floor(de.y)};pe(De),Z(null),i&&i(null)}else N(!0),B({x:ee.x-r.x,y:ee.y-r.y})}},lr=_e=>{const ee=Ct(_e),ve=ut(ee.x,ee.y);if(Se.current=ve,!Ft(ve)){if(ne&&R){R(ve,"move");return}if(ae&&_){_(ve,"move");return}if(K&&G){const de=ut(ee.x,ee.y),De=Math.floor(de.x),Ye=Math.floor(de.y),st=Math.min(G.x,De),_t=Math.min(G.y,Ye),Xe=Math.max(G.x,De),Ar=Math.max(G.y,Ye),nr=Xe-st+1,Gt=Ar-_t+1;Z({x:st,y:_t,w:nr,h:Gt})}else $&&n({x:ee.x-C.x,y:ee.y-C.y})}},Vt=()=>{ne&&R&&(R(Se.current||{x:0,y:0},"end"),le(!1)),se&&(rt(),he(!1),Oe(null),Ie.current=null,te.current=null),ae&&(_&&_({x:0,y:0},"end"),ce(!1)),K&&(q(!1),J&&i&&J.w>0&&J.h>0&&i(J)),N(!1)},gr=_e=>{var ee;if(_e.touches.length===1){const ve=_e.touches[0],de=(ee=E.current)==null?void 0:ee.getBoundingClientRect();if(!de)return;const De=ve.clientX-de.left,Ye=ve.clientY-de.top,st=ut(De,Ye);if(Se.current=st,w.mode==="center"&&A){A(st);return}if(w.mode==="drag"&&R){R(st,"start"),le(!0);return}if(Sr(st))return;if(S&&P){P(st);return}if(u&&d){const _t=ut(De,Ye);d(_t);return}if(M!=null&&M.enabled&&_&&l!=="select"){const _t=ut(De,Ye);_(_t,"start"),ce(!0);return}if(l==="select"){const _t=ut(De,Ye),Xe={x:Math.floor(_t.x),y:Math.floor(_t.y)};pe(Xe),q(!0),Z(null),i&&i(null)}else V.current={x:De,y:Ye},B({x:De-r.x,y:Ye-r.y}),N(!0)}else if(_e.touches.length===2){const ve=Math.hypot(_e.touches[0].clientX-_e.touches[1].clientX,_e.touches[0].clientY-_e.touches[1].clientY);I.current=ve,z.current=t,N(!1),q(!1)}},Zt=_e=>{var ee;if(_e.touches.length===1){const ve=_e.touches[0],de=(ee=E.current)==null?void 0:ee.getBoundingClientRect();if(!de)return;const De=ve.clientX-de.left,Ye=ve.clientY-de.top,st=ut(De,Ye);if(Se.current=st,Ft(st))return;if(ne&&R){R(st,"move");return}if(u)return;if(ae&&_){_(st,"move");return}if(K&&G){const _t=ut(De,Ye),Xe=Math.floor(_t.x),Ar=Math.floor(_t.y),nr=Math.min(G.x,Xe),Gt=Math.min(G.y,Ar),mt=Math.max(G.x,Xe),Jt=Math.max(G.y,Ar),Pr=mt-nr+1,Zr=Jt-Gt+1;Z({x:nr,y:Gt,w:Pr,h:Zr})}else $&&n({x:De-C.x,y:Ye-C.y})}else if(_e.touches.length===2&&I.current&&z.current&&a){const de=Math.hypot(_e.touches[0].clientX-_e.touches[1].clientX,_e.touches[0].clientY-_e.touches[1].clientY)/I.current;a(z.current*de)}},zt=()=>{ne&&R&&(R(Se.current||{x:0,y:0},"end"),le(!1)),se&&(rt(),he(!1),Oe(null),Ie.current=null,te.current=null),ae&&_&&(_({x:0,y:0},"end"),ce(!1)),K&&(q(!1),J&&i&&J.w>0&&J.h>0&&i(J)),N(!1),I.current=null,z.current=null,V.current=null},rr=w.mode!=="off"||S?"cursor-crosshair":se?"cursor-grabbing":v?"cursor-pointer":M!=null&&M.enabled||u||l==="select"||(Ot=window.event)!=null&&Ot.shiftKey?"cursor-crosshair":"cursor-grab active:cursor-grabbing";return c.jsx("canvas",{ref:E,className:`w-full h-full block touch-none ${rr}`,onMouseDown:Kt,onMouseMove:lr,onMouseUp:Vt,onMouseLeave:Vt,onTouchStart:gr,onTouchMove:Zt,onTouchEnd:zt,onTouchCancel:zt,tabIndex:0})},w8="modulepreload",k8=function(e){return"/"+e},wk={},ct=function(t,r,n){let a=Promise.resolve();if(r&&r.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),s=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));a=Promise.allSettled(r.map(l=>{if(l=k8(l),l in wk)return;wk[l]=!0;const u=l.endsWith(".css"),d=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${d}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":w8,u||(f.as="script"),f.crossOrigin="",f.href=l,s&&f.setAttribute("nonce",s),document.head.appendChild(f),u)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const s=new Event("vite:preloadError",{cancelable:!0});if(s.payload=o,window.dispatchEvent(s),!s.defaultPrevented)throw o}return a.then(o=>{for(const s of o||[])s.status==="rejected"&&i(s.reason);return t().catch(i)})};function Ro(e){const[[t,r,n],[a,i,o],[s,l,u]]=e,d=t*(i*u-o*l)-r*(a*u-o*s)+n*(a*l-i*s);if(Math.abs(d)<1e-10)return null;const f=1/d;return[[(i*u-o*l)*f,(n*l-r*u)*f,(r*o-n*i)*f],[(o*s-a*u)*f,(t*u-n*s)*f,(n*a-t*o)*f],[(a*l-i*s)*f,(r*s-t*l)*f,(t*i-r*a)*f]]}function M_(e,t){const[[r,n,a],[i,o,s],[l,u,d]]=e,[f,h,p]=t;return[r*f+n*h+a*p,i*f+o*h+s*p,l*f+u*h+d*p]}function Kc(e,t){const r=[[0,0,0],[0,0,0],[0,0,0]];for(let n=0;n<3;n++)for(let a=0;a<3;a++)for(let i=0;i<3;i++)r[n][a]+=e[n][i]*t[i][a];return r}function S8(e){const t=e.length;if(t<2)return s=>{var l;return((l=e[0])==null?void 0:l.y)||0};const r=[...e].sort((s,l)=>s.x-l.x),n=r.map(s=>s.x),a=r.map(s=>s.y),i=new Float32Array(t-1),o=new Float32Array(t);for(let s=0;s<t-1;s++){const l=n[s+1]-n[s],u=a[s+1]-a[s];i[s]=u/(l||1e-9)}o[0]=i[0];for(let s=1;s<t-1;s++)o[s]=(i[s-1]+i[s])*.5;o[t-1]=i[t-2];for(let s=0;s<t-1;s++)if(i[s]===0)o[s]=0,o[s+1]=0;else{const l=o[s]/i[s],u=o[s+1]/i[s],d=l*l+u*u;if(d>9){const f=3/Math.sqrt(d);o[s]=l*f*i[s],o[s+1]=u*f*i[s]}}return s=>{let l=0;if(s<=n[0])return a[0];if(s>=n[t-1])return a[t-1];for(;s>n[l+1]&&l<t-2;)l++;const u=n[l+1]-n[l],d=1/u,h=(s-n[l])*d,p=h*h,x=p*h,b=2*x-3*p+1,y=x-2*p+h,m=-2*x+3*p,g=x-p,k=b*a[l]+y*u*o[l]+m*a[l+1]+g*u*o[l+1];return Math.max(0,Math.min(1,k))}}function ca(e,t=256){const r=S8(e),n=new Float32Array(t);for(let a=0;a<t;a++){const i=a/(t-1);n[a]=r(i)}return n}class Tl{constructor(t){fr(this,"size");fr(this,"isPowerOfTwo");fr(this,"_real");fr(this,"_imag");fr(this,"_scratch",null);fr(this,"_rev",null);fr(this,"_m",0);fr(this,"_internalFFT",null);fr(this,"_chirpReal",null);fr(this,"_chirpImag",null);fr(this,"_bReal",null);fr(this,"_bImag",null);fr(this,"_hanning",null);fr(this,"_windowSumSq",0);this.size=t,this.isPowerOfTwo=(t&t-1)===0&&t>0,this._real=new Float32Array(t),this._imag=new Float32Array(t),this.isPowerOfTwo?this.initRadix2():this.initBluestein()}initRadix2(){const t=this.size,r=Math.log2(t);this._rev=new Uint32Array(t);for(let n=0;n<t;n++){let a=0,i=n;for(let o=0;o<r;o++)a=a<<1|i&1,i>>>=1;this._rev[n]=a}}initBluestein(){const t=this.size;this._m=Math.pow(2,Math.ceil(Math.log2(2*t-1))),this._internalFFT=new Tl(this._m),this._chirpReal=new Float32Array(t),this._chirpImag=new Float32Array(t);for(let a=0;a<t;a++){const i=-Math.PI*(a*a)/t;this._chirpReal[a]=Math.cos(i),this._chirpImag[a]=Math.sin(i)}const r=new Float32Array(this._m),n=new Float32Array(this._m);for(let a=0;a<t;a++)r[a]=this._chirpReal[a],n[a]=-this._chirpImag[a];for(let a=1;a<t;a++)r[this._m-a]=r[a],n[this._m-a]=n[a];this._internalFFT.transform(r,n),this._bReal=new Float32Array(this._internalFFT._real),this._bImag=new Float32Array(this._internalFFT._imag)}initHanning(){if(this._hanning)return;const t=this.size;this._hanning=new Float32Array(t);let r=0;for(let n=0;n<t;n++){const a=.5*(1-Math.cos(2*Math.PI*n/(t-1)));this._hanning[n]=a,r+=a*a}this._windowSumSq=r}transform(t,r){this.isPowerOfTwo?this.transformRadix2(t,r):this.transformBluestein(t,r)}transformRadix2(t,r){const n=this.size,a=this._rev,i=this._real,o=this._imag;if(t===i)for(let s=0;s<n;s++){const l=a[s];if(s<l){const u=i[s],d=o[s];i[s]=i[l],o[s]=o[l],i[l]=u,o[l]=d}}else for(let s=0;s<n;s++){const l=a[s];i[s]=t[l],o[s]=r?r[l]:0}for(let s=2;s<=n;s*=2){const l=s/2,u=-2*Math.PI/s,d=Math.cos(u),f=Math.sin(u);for(let h=0;h<n;h+=s){let p=1,x=0;for(let b=0;b<l;b++){const y=h+b,m=h+b+l,g=p*i[m]-x*o[m],k=p*o[m]+x*i[m],S=i[y],w=o[y];i[y]=S+g,o[y]=w+k,i[m]=S-g,o[m]=w-k;const v=p*d-x*f,M=p*f+x*d;p=v,x=M}}}}transformBluestein(t,r){const n=this.size,a=this._m,i=this._internalFFT,o=i._real,s=i._imag;o.fill(0),s.fill(0);for(let f=0;f<n;f++){const h=t[f],p=r?r[f]:0,x=this._chirpReal[f],b=this._chirpImag[f];o[f]=h*x-p*b,s[f]=h*b+p*x}i.transformRadix2(o,s);for(let f=0;f<a;f++){const h=i._real[f],p=i._imag[f],x=this._bReal[f],b=this._bImag[f];i._real[f]=h*x-p*b,i._imag[f]=h*b+p*x}const l=i._real,u=i._imag;for(let f=0;f<a;f++)u[f]=-u[f];i.transformRadix2(l,u);const d=1/a;for(let f=0;f<n;f++){const h=i._real[f]*d,p=-i._imag[f]*d,x=this._chirpReal[f],b=this._chirpImag[f];this._real[f]=h*x-p*b,this._imag[f]=h*b+p*x}}calculateSpectrum(t,r,n=!1){const a=this.size;let i=0;for(let d=0;d<a;d++)i+=t[d];const o=i/a;this._scratch||(this._scratch=new Float32Array(a));const s=this._scratch;if(n){this.initHanning();const d=this._hanning;for(let f=0;f<a;f++)s[f]=(t[f]-o)*d[f]}else for(let d=0;d<a;d++)s[d]=t[d]-o;this.transform(s);const l=r.length;let u=1/a;n&&this._windowSumSq>0&&(u=1/this._windowSumSq);for(let d=0;d<l;d++){const f=this._real[d],h=this._imag[d];r[d]+=(f*f+h*h)*u}}}function kk(e,t,r,n=!1){const a=new Tl(t),i=new Tl(r),o=t*r,s=new Float32Array(o),l=new Float32Array(o);let u=null,d=null;if(n){u=new Float32Array(t);for(let b=0;b<t;b++)u[b]=.5*(1-Math.cos(2*Math.PI*b/(t-1)));d=new Float32Array(r);for(let b=0;b<r;b++)d[b]=.5*(1-Math.cos(2*Math.PI*b/(r-1)))}for(let b=0;b<r;b++){const y=b*t,m=a._real;let g=0;for(let S=0;S<t;S++)g+=e[y+S];const k=g/t;if(u)for(let S=0;S<t;S++)m[S]=(e[y+S]-k)*u[S];else for(let S=0;S<t;S++)m[S]=e[y+S]-k;a.transform(m);for(let S=0;S<t;S++)s[y+S]=a._real[S],l[y+S]=a._imag[S]}for(let b=0;b<t;b++){const y=i._real,m=i._imag;for(let g=0;g<r;g++){const k=g*t+b;let S=s[k],w=l[k];d&&(S*=d[g],w*=d[g]),y[g]=S,m[g]=w}i.transform(y,m);for(let g=0;g<r;g++){const k=g*t+b;s[k]=i._real[g],l[k]=i._imag[g]}}const f=new Float32Array(o);let h=1,p=t,x=r;if(n&&u&&d){p=0;for(let b=0;b<t;b++)p+=u[b]*u[b];x=0;for(let b=0;b<r;b++)x+=d[b]*d[b]}h=1/(p*x);for(let b=0;b<o;b++)f[b]=(s[b]*s[b]+l[b]*l[b])*h;return f}function Sk(e,t,r){const n=new Float32Array(e.length),a=Math.floor(t/2),i=Math.floor(r/2);for(let o=0;o<r;o++)for(let s=0;s<t;s++){const l=(s+a)%t,u=(o+i)%r,d=o*t+s,f=u*t+l;n[f]=e[d]}return n}const El=e=>`${e}_${Date.now()}_${Math.random().toString(36).slice(2,8)}`,yr=e=>Math.max(0,Math.min(1,e)),Dc=e=>{const t=yr(e);return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055},ex=e=>{const t=yr(e);return t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)},E0=[{x:0,y:0},{x:1,y:1}],I0=e=>e.map(t=>({x:t.x,y:t.y})),Nv=()=>({master:I0(E0),red:I0(E0),green:I0(E0),blue:I0(E0)}),j8=["red","orange","yellow","green","aqua","blue","purple","magenta"],__=()=>({exposure:0,temperature:0,tint:0,contrast:0,highlights:0,shadows:0,vibrance:0,saturation:0}),Jo=()=>({hue:0,saturation:0,luminance:0}),Cv=()=>({red:Jo(),orange:Jo(),yellow:Jo(),green:Jo(),aqua:Jo(),blue:Jo(),purple:Jo(),magenta:Jo()}),Mi=(e,t,r,n=0)=>{const a=Number(e);return Number.isFinite(a)?Math.max(t,Math.min(r,a)):n},Yc=e=>({exposure:Mi(e==null?void 0:e.exposure,-5,5,0),temperature:Mi(e==null?void 0:e.temperature,-100,100,0),tint:Mi(e==null?void 0:e.tint,-100,100,0),contrast:Mi(e==null?void 0:e.contrast,-100,100,0),highlights:Mi(e==null?void 0:e.highlights,-100,100,0),shadows:Mi(e==null?void 0:e.shadows,-100,100,0),vibrance:Mi(e==null?void 0:e.vibrance,-100,100,0),saturation:Mi(e==null?void 0:e.saturation,-100,100,0)}),qc=e=>{const t=Cv(),r=n=>{var a,i,o;return{hue:Mi((a=e==null?void 0:e[n])==null?void 0:a.hue,-100,100,t[n].hue),saturation:Mi((i=e==null?void 0:e[n])==null?void 0:i.saturation,-100,100,t[n].saturation),luminance:Mi((o=e==null?void 0:e[n])==null?void 0:o.luminance,-100,100,t[n].luminance)}};return{red:r("red"),orange:r("orange"),yellow:r("yellow"),green:r("green"),aqua:r("aqua"),blue:r("blue"),purple:r("purple"),magenta:r("magenta")}},yg=e=>{const t=Nv();if(!e)return t;const r=n=>{const a=e==null?void 0:e[n];if(!Array.isArray(a)||a.length<2)return t[n];const i=a.map(o=>({x:Math.max(0,Math.min(1,Number((o==null?void 0:o.x)??0))),y:Math.max(0,Math.min(1,Number((o==null?void 0:o.y)??0)))})).filter(o=>!Number.isNaN(o.x)&&!Number.isNaN(o.y)).sort((o,s)=>o.x-s.x);return i.length<2?t[n]:(i[0].x=0,i[i.length-1].x=1,i)};return{master:r("master"),red:r("red"),green:r("green"),blue:r("blue")}},M8=(e,t,r,n,a,i,o,s,l)=>{const u=Math.max(1,i),d=yr(o),f=yr(l),h=u,p=u*(1+f*1.5),x=p*p,b=Math.max(0,Math.floor(n-p)),y=Math.max(0,Math.floor(a-p)),m=Math.min(t-1,Math.ceil(n+p)),g=Math.min(r-1,Math.ceil(a+p));for(let k=y;k<=g;k++){const S=k*t;for(let w=b;w<=m;w++){const v=w-n,M=k-a,_=v*v+M*M;if(_>x)continue;const P=Math.sqrt(_);let A=1;if(P>h){const W=Math.max(1e-6,p-h);A=yr((p-P)/W)}const R=yr(d*A),D=S+w,E=e[D];e[D]=s==="add"?E+(1-E)*R:E*(1-R)}}},_8=(e,t,r,n)=>{const a=n.center.x,i=n.center.y,o=Math.max(1,n.radiusX),s=Math.max(1,n.radiusY),l=Math.max(1,Math.min(o,s)),u=Math.max(0,Math.min(n.featherPx,l*.95)),d=n.rotationDeg*Math.PI/180,f=Math.cos(d),h=Math.sin(d),p=Math.ceil(Math.max(o,s))+2,x=Math.max(0,Math.floor(a-p)),b=Math.max(0,Math.floor(i-p)),y=Math.min(t-1,Math.ceil(a+p)),m=Math.min(r-1,Math.ceil(i+p));for(let g=b;g<=m;g++){const k=g*t;for(let S=x;S<=y;S++){const w=S-a,v=g-i,M=w*f+v*h,_=-w*h+v*f,P=Math.sqrt(M*M/(o*o)+_*_/(s*s));if(P>1)continue;let A=1;if(u>0){const E=(1-P)*l;A=yr(E/u)}const R=k+S,D=e[R];e[R]=n.mode==="add"?D+(1-D)*A:D*(1-A)}}},Ov=e=>{const t=new Float32Array(e.width*e.height);for(const r of e.items||[])if(r.visible)if(r.type==="ellipse")_8(t,e.width,e.height,r);else for(const n of r.points)M8(t,e.width,e.height,n.x,n.y,r.sizePx,r.opacity,r.mode,r.feather);return t};function P_(e){const t=e.masks.map(r=>{const n=Ov(r);return{...r,alpha:n,version:r.version+1}});return{...e,masks:t}}function P8(e){const t=e.width,r=e.height,n=e.alpha;let a=t,i=r,o=-1,s=-1;for(let u=0;u<r;u++){const d=u*t;for(let f=0;f<t;f++)n[d+f]<=1e-4||(f<a&&(a=f),u<i&&(i=u),f>o&&(o=f),u>s&&(s=u))}if(o<a||s<i)return null;const l=2;return{x0:Math.max(0,a-l),y0:Math.max(0,i-l),x1:Math.min(t-1,o+l),y1:Math.min(r-1,s+l)}}function jk(e,t,r,n){return{id:e,width:t,height:r,baseRgb:n,masks:[],layers:[],guides:[],selectedGuideId:null,selectedMaskId:"",selectedLayerId:"",selectedMaskItemId:null,transform:{rotationDeg:0,crop:null},history:[{id:El("history"),label:"Initialize PS Document",timestamp:Date.now()}],historyIndex:0}}function N8(e){const t=new Float32Array(e.length);for(let r=0;r<e.length;r++)t[r]=e[r]/65535;return t}function N_(e){const t=new Float32Array(e.width*e.height*3),r=e.data;for(let n=0,a=0;n<r.length;n+=4,a+=3)t[a]=ex(r[n]/255),t[a+1]=ex(r[n+1]/255),t[a+2]=ex(r[n+2]/255);return t}async function C8(e){const t=e.naturalWidth||e.width,r=e.naturalHeight||e.height,n=document.createElement("canvas");n.width=t,n.height=r;const a=n.getContext("2d");if(!a)throw new Error("Failed to create 2D context for raster-to-float conversion.");a.drawImage(e,0,0,t,r);const i=a.getImageData(0,0,t,r);return{width:t,height:r,data:N_(i)}}function Av(e){const t=El("mask"),r=El("layer"),n={id:t,name:`Mask ${e.masks.length+1}`,shape:"full",width:e.width,height:e.height,alpha:new Float32Array(e.width*e.height),version:1,featherPx:0,visible:!0,overlayVisible:!0,items:[]},a={id:r,name:`Layer ${e.layers.length+1}`,maskId:t,blendMode:"add",enabled:!0,opacity:1,basic:__(),mixer:Cv(),curves:Nv()};return{...e,masks:[...e.masks,n],layers:[...e.layers,a],selectedMaskId:t,selectedLayerId:r,selectedMaskItemId:null}}function C_(e,t){if(!e.masks.some(o=>o.id===t))return e;const n=e.layers.find(o=>o.maskId===t);if(n)return{...e,selectedMaskId:t,selectedLayerId:n.id,selectedMaskItemId:null};const a=El("layer"),i={id:a,name:`Layer ${e.layers.length+1}`,maskId:t,blendMode:"add",enabled:!0,opacity:1,basic:__(),mixer:Cv(),curves:Nv()};return{...e,layers:[...e.layers,i],selectedMaskId:t,selectedLayerId:a,selectedMaskItemId:null}}function O8(e,t){const r=(e.width-1)*.5,n=(e.height-1)*.5,a=Math.max(8,e.width*.4),i=Math.max(8,e.height*.4),o={id:El("guide"),orientation:t,p1:t==="horizontal"?{x:r-a*.5,y:n}:{x:r,y:n-i*.5},p2:t==="horizontal"?{x:r+a*.5,y:n}:{x:r,y:n+i*.5},visible:!0};return{...e,guides:[...e.guides,o],selectedGuideId:o.id}}function A8(e,t){return t===null?{...e,selectedGuideId:null}:e.guides.some(n=>n.id===t)?{...e,selectedGuideId:t}:e}function Mk(e,t,r,n){const a=s=>({x:Math.max(0,Math.min(e.width-1,s.x)),y:Math.max(0,Math.min(e.height-1,s.y))});let i=!1;const o=e.guides.map(s=>{if(s.id!==t)return s;const l=a(r),u=a(n);return Math.abs(l.x-s.p1.x)<1e-6&&Math.abs(l.y-s.p1.y)<1e-6&&Math.abs(u.x-s.p2.x)<1e-6&&Math.abs(u.y-s.p2.y)<1e-6?s:(i=!0,{...s,p1:l,p2:u})});return i?{...e,guides:o}:e}function T8(e,t){const r=e.guides.filter(n=>n.id!==t);return r.length===e.guides.length?e:{...e,guides:r,selectedGuideId:e.selectedGuideId===t?null:e.selectedGuideId}}function E8(e,t,r=0,n="add"){var d;const a=e.selectedMaskId?e:Av(e),i=a.selectedMaskId;if(!i)return a;const o=a.masks.map(f=>{if(f.id!==i)return f;const h=f.items||[],p={id:El("item"),name:`Ellipse ${h.filter(y=>y.type==="ellipse").length+1}`,type:"ellipse",mode:n,visible:!0,center:{x:t.center.x,y:t.center.y},radiusX:Math.max(1,t.radiusX),radiusY:Math.max(1,t.radiusY),rotationDeg:t.rotationDeg??0,featherPx:Math.max(0,r)},x=[...h,p];return{...f,shape:"ellipse",items:x,alpha:Ov({...f,items:x}),version:f.version+1}}),s=o.find(f=>f.id===i),l=(s==null?void 0:s.items)||[],u=((d=l[l.length-1])==null?void 0:d.id)||null;return{...a,masks:o,selectedMaskItemId:u}}function I8(e,t,r,n,a,i,o=1){const s=e.selectedMaskId?e:Av(e);if(!s.selectedMaskId)return s;const l=Math.max(1,n),u=yr(a),d=yr(o),f=l,h=l*(1+d*1.5),p=h*h,x=s.masks.map(b=>{if(b.id!==s.selectedMaskId)return b;const y=b.alpha,m=Math.max(0,Math.floor(t-h)),g=Math.max(0,Math.floor(r-h)),k=Math.min(b.width-1,Math.ceil(t+h)),S=Math.min(b.height-1,Math.ceil(r+h));for(let w=g;w<=S;w++){const v=w*b.width;for(let M=m;M<=k;M++){const _=M-t,P=w-r,A=_*_+P*P;if(A>p)continue;const R=Math.sqrt(A);let D=1;if(R>f){const O=Math.max(1e-6,h-f);D=yr((h-R)/O)}const E=yr(u*D),W=v+M,F=y[W];y[W]=i==="add"?F+(1-F)*E:F*(1-E)}}return{...b,alpha:y,version:b.version+1}});return{...s,masks:x}}function R8(e,t,r,n,a,i){var d;if(!e.selectedMaskId||t.length===0)return e;const o=e.masks.map(f=>{if(f.id!==e.selectedMaskId)return f;const h=f.items||[],p=t.map(k=>({x:k.x,y:k.y})),x=Math.max(1,r),b=yr(n),y=yr(i),m=h[h.length-1];if(m&&m.type==="brush"&&F8(m,{points:p,sizePx:x,opacity:b,mode:a,feather:y})){const k=m.points[m.points.length-1],S=p.filter((v,M)=>M!==0||Math.hypot(v.x-k.x,v.y-k.y)>.5),w={...m,points:[...m.points,...S]};return{...f,shape:"brush",items:[...h.slice(0,-1),w]}}const g={id:El("item"),name:`Brush ${h.filter(k=>k.type==="brush").length+1}`,type:"brush",mode:a,visible:!0,sizePx:x,opacity:b,feather:y,points:p};return{...f,shape:"brush",items:[...h,g]}}),s=o.find(f=>f.id===e.selectedMaskId),l=(s==null?void 0:s.items)||[],u=((d=l[l.length-1])==null?void 0:d.id)||null;return{...e,masks:o,selectedMaskItemId:u}}function D8(e,t){if(!t)return{...e,selectedMaskItemId:null};const r=e.selectedMaskId?e.masks.find(i=>i.id===e.selectedMaskId):null;if(r&&(r.items||[]).some(i=>i.id===t))return{...e,selectedMaskItemId:t};const n=e.masks.find(i=>(i.items||[]).some(o=>o.id===t));return n?{...C_(e,n.id),selectedMaskItemId:t}:{...e,selectedMaskItemId:null}}function $8(e,t,r){if(!e.selectedMaskId)return e;let n=!1;const a=e.masks.map(i=>{if(i.id!==e.selectedMaskId)return i;const o=(i.items||[]).map(s=>s.id!==t||s.type!=="ellipse"?s:(n=!0,{...s,...r,center:r.center?{x:r.center.x,y:r.center.y}:s.center,radiusX:r.radiusX!==void 0?Math.max(1,r.radiusX):s.radiusX,radiusY:r.radiusY!==void 0?Math.max(1,r.radiusY):s.radiusY,featherPx:r.featherPx!==void 0?Math.max(0,r.featherPx):s.featherPx}));return n?{...i,items:o,alpha:Ov({...i,items:o}),version:i.version+1}:i});return n?{...e,masks:a}:e}function L8(e,t,r){let n=!1;const a=e.masks.map(i=>i.id!==t||(i.overlayVisible??!0)===r?i:(n=!0,{...i,overlayVisible:r}));return n?{...e,masks:a}:e}const Id=(e,t)=>[e[0]*t[0]+e[1]*t[3]+e[2]*t[6],e[0]*t[1]+e[1]*t[4]+e[2]*t[7],e[0]*t[2]+e[1]*t[5]+e[2]*t[8],e[3]*t[0]+e[4]*t[3]+e[5]*t[6],e[3]*t[1]+e[4]*t[4]+e[5]*t[7],e[3]*t[2]+e[4]*t[5]+e[5]*t[8],e[6]*t[0]+e[7]*t[3]+e[8]*t[6],e[6]*t[1]+e[7]*t[4]+e[8]*t[7],e[6]*t[2]+e[7]*t[5]+e[8]*t[8]],B8=e=>{const t=e[0],r=e[1],n=e[2],a=e[3],i=e[4],o=e[5],s=e[6],l=e[7],u=e[8],d=i*u-o*l,f=-(a*u-o*s),h=a*l-i*s,p=-(r*u-n*l),x=t*u-n*s,b=-(t*l-r*s),y=r*o-n*i,m=-(t*o-n*a),g=t*i-r*a,k=t*d+r*f+n*h;if(Math.abs(k)<1e-12)return null;const S=1/k;return[d*S,p*S,y*S,f*S,x*S,m*S,h*S,b*S,g*S]},xa=(e,t)=>{const r=t.x,n=t.y,a=e[6]*r+e[7]*n+e[8];return Math.abs(a)<1e-12?{x:0,y:0}:{x:(e[0]*r+e[1]*n+e[2])/a,y:(e[3]*r+e[4]*n+e[5])/a}},F8=(e,t)=>{if(e.mode!==t.mode||Math.abs(e.sizePx-t.sizePx)>.25||Math.abs(e.opacity-t.opacity)>.02||Math.abs(e.feather-t.feather)>.02||e.points.length===0||t.points.length===0)return!1;const r=e.points[e.points.length-1],n=t.points[0],a=Math.hypot(r.x-n.x,r.y-n.y),i=Math.max(4,Math.min(e.sizePx,t.sizePx)*1.5);return a<=i},G8=(e,t)=>{const r=e.rotationDeg*Math.PI/180,n=Math.cos(r),a=Math.sin(r),i=-a,o=n,s=e.center,l={x:s.x+n*e.radiusX,y:s.y+a*e.radiusX},u={x:s.x+i*e.radiusY,y:s.y+o*e.radiusY},d=xa(t,s),f=xa(t,l),h=xa(t,u),p=Math.max(1,Math.hypot(f.x-d.x,f.y-d.y)),x=Math.max(1,Math.hypot(h.x-d.x,h.y-d.y)),b=Math.atan2(f.y-d.y,f.x-d.x)*180/Math.PI;return{...e,center:d,radiusX:p,radiusY:x,rotationDeg:b}},hs=(e,t,r,n,a,i,o=0)=>{if(n<0||a<0||n>t-1||a>r-1)return 0;const s=Math.floor(n),l=Math.floor(a),u=Math.min(t-1,s+1),d=Math.min(r-1,l+1),f=n-s,h=a-l,p=(S,w)=>i===1?w*t+S:(w*t+S)*3+o,x=e[p(s,l)],b=e[p(u,l)],y=e[p(s,d)],m=e[p(u,d)],g=x*(1-f)+b*f,k=y*(1-f)+m*f;return g*(1-h)+k*h},O_=(e,t,r)=>{const a=[{x:0,y:0},{x:e-1,y:0},{x:e-1,y:t-1},{x:0,y:t-1}].map(s=>xa(r,s)),i=a.map(s=>s.x),o=a.map(s=>s.y);return{minX:Math.min(...i),maxX:Math.max(...i),minY:Math.min(...o),maxY:Math.max(...o)}},A_=(e,t)=>{const r=O_(e.width,e.height,t),n=-r.minX,a=-r.minY,o=Id([1,0,n,0,1,a,0,0,1],t),s=B8(o);if(!s)return e;const l=Math.max(1,Math.ceil(r.maxX-r.minX+1)),u=Math.max(1,Math.ceil(r.maxY-r.minY+1)),d=new Float32Array(l*u*3);for(let p=0;p<u;p++)for(let x=0;x<l;x++){const b=xa(s,{x,y:p}),y=(p*l+x)*3;d[y]=hs(e.baseRgb,e.width,e.height,b.x,b.y,3,0),d[y+1]=hs(e.baseRgb,e.width,e.height,b.x,b.y,3,1),d[y+2]=hs(e.baseRgb,e.width,e.height,b.x,b.y,3,2)}const f=e.masks.map(p=>{const x=new Float32Array(l*u);for(let y=0;y<u;y++)for(let m=0;m<l;m++){const g=xa(s,{x:m,y});x[y*l+m]=hs(p.alpha,p.width,p.height,g.x,g.y,1)}const b=(p.items||[]).map(y=>y.type==="brush"?{...y,points:y.points.map(m=>xa(o,m)).filter(m=>m.x>=0&&m.y>=0&&m.x<=l-1&&m.y<=u-1)}:G8(y,o)).filter(y=>y.type==="ellipse"?y.center.x>=-Math.max(y.radiusX,y.radiusY)&&y.center.y>=-Math.max(y.radiusX,y.radiusY)&&y.center.x<=l-1+Math.max(y.radiusX,y.radiusY)&&y.center.y<=u-1+Math.max(y.radiusX,y.radiusY):y.points.length>0);return{...p,width:l,height:u,alpha:x,version:p.version+1,featherPx:0,items:b}}),h=e.guides.map(p=>({...p,p1:xa(o,p.p1),p2:xa(o,p.p2)}));return{...e,width:l,height:u,baseRgb:d,masks:f,guides:h,selectedMaskItemId:f.some(p=>(p.items||[]).some(x=>x.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}},U8=(e,t,r,n,a,i)=>{let o=0,s=1;const l=t.x-e.x,u=t.y-e.y,d=(f,h)=>{if(Math.abs(f)<1e-12)return h>=0;const p=h/f;return f<0?p>s?!1:(p>o&&(o=p),!0):p<o?!1:(p<s&&(s=p),!0)};return!d(-l,e.x-r)||!d(l,a-e.x)||!d(-u,e.y-n)||!d(u,i-e.y)?null:{p1:{x:e.x+o*l,y:e.y+o*u},p2:{x:e.x+s*l,y:e.y+s*u}}};function T_(e,t){const r=Math.max(0,Math.min(e.width-1,Math.floor(t.x))),n=Math.max(0,Math.min(e.height-1,Math.floor(t.y))),a=Math.max(r+1,Math.min(e.width,Math.ceil(t.x+t.w))),i=Math.max(n+1,Math.min(e.height,Math.ceil(t.y+t.h))),o=a-r,s=i-n;if(o===e.width&&s===e.height&&r===0&&n===0)return e;const l=new Float32Array(o*s*3);for(let f=0;f<s;f++)for(let h=0;h<o;h++){const p=((f+n)*e.width+(h+r))*3,x=(f*o+h)*3;l[x]=e.baseRgb[p],l[x+1]=e.baseRgb[p+1],l[x+2]=e.baseRgb[p+2]}const u=e.masks.map(f=>{const h=new Float32Array(o*s);for(let x=0;x<s;x++)for(let b=0;b<o;b++)h[x*o+b]=f.alpha[(x+n)*f.width+(b+r)];const p=(f.items||[]).map(x=>x.type==="brush"?{...x,points:x.points.map(b=>({x:b.x-r,y:b.y-n})).filter(b=>b.x>=0&&b.y>=0&&b.x<=o-1&&b.y<=s-1)}:{...x,center:{x:x.center.x-r,y:x.center.y-n}}).filter(x=>x.type==="ellipse"?x.center.x>=-Math.max(x.radiusX,x.radiusY)&&x.center.y>=-Math.max(x.radiusX,x.radiusY)&&x.center.x<=o-1+Math.max(x.radiusX,x.radiusY)&&x.center.y<=s-1+Math.max(x.radiusX,x.radiusY):x.points.length>0);return{...f,width:o,height:s,alpha:h,version:f.version+1,featherPx:0,items:p}}),d=e.guides.map(f=>{const h=U8(f.p1,f.p2,r,n,a-1,i-1);return h?{...f,p1:{x:h.p1.x-r,y:h.p1.y-n},p2:{x:h.p2.x-r,y:h.p2.y-n}}:null}).filter(Boolean);return{...e,width:o,height:s,baseRgb:l,masks:u,guides:d,selectedGuideId:d.some(f=>f.id===e.selectedGuideId)?e.selectedGuideId:null,selectedMaskItemId:u.some(f=>(f.items||[]).some(h=>h.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}}function E_(e,t){const r=t*Math.PI/180,n=Math.cos(r),a=Math.sin(r),i=(e.width-1)*.5,o=(e.height-1)*.5,s=[1,0,-i,0,1,-o,0,0,1],l=[n,-a,0,a,n,0,0,0,1],d=Id([1,0,i,0,1,o,0,0,1],Id(l,s)),f=O_(e.width,e.height,d),h=Id([1,0,-f.minX,0,1,-f.minY,0,0,1],d),p=A_(e,d),x=p.masks.map(b=>{const y=e.masks.find(g=>g.id===b.id);if(!y)return b;const m=(y.items||[]).map(g=>g.type==="brush"?{...g,points:g.points.map(k=>xa(h,k)).filter(k=>k.x>=0&&k.y>=0&&k.x<=p.width-1&&k.y<=p.height-1)}:{...g,center:xa(h,g.center),rotationDeg:g.rotationDeg+t}).filter(g=>g.type==="ellipse"?!0:g.points.length>0);return{...b,items:m}});return{...p,masks:x,selectedMaskItemId:x.some(b=>(b.items||[]).some(y=>y.id===e.selectedMaskItemId))?e.selectedMaskItemId:null}}function I_(e){const t=e.width,r=e.height,n=new Float32Array(e.baseRgb.length);for(let i=0;i<r;i++)for(let o=0;o<t;o++){const s=t-1-o,l=(i*t+s)*3,u=(i*t+o)*3;n[u]=e.baseRgb[l],n[u+1]=e.baseRgb[l+1],n[u+2]=e.baseRgb[l+2]}const a=e.masks.map(i=>{const o=new Float32Array(i.alpha.length);for(let s=0;s<r;s++)for(let l=0;l<t;l++)o[s*t+l]=i.alpha[s*t+(t-1-l)];return{...i,alpha:o,version:i.version+1,items:(i.items||[]).map(s=>s.type==="brush"?{...s,points:s.points.map(l=>({x:t-1-l.x,y:l.y}))}:{...s,center:{x:t-1-s.center.x,y:s.center.y},rotationDeg:-s.rotationDeg})}});return{...e,baseRgb:n,masks:a,guides:e.guides.map(i=>({...i,p1:{x:t-1-i.p1.x,y:i.p1.y},p2:{x:t-1-i.p2.x,y:i.p2.y}}))}}function R_(e){const t=e.width,r=e.height,n=new Float32Array(e.baseRgb.length);for(let i=0;i<r;i++){const o=r-1-i;for(let s=0;s<t;s++){const l=(o*t+s)*3,u=(i*t+s)*3;n[u]=e.baseRgb[l],n[u+1]=e.baseRgb[l+1],n[u+2]=e.baseRgb[l+2]}}const a=e.masks.map(i=>{const o=new Float32Array(i.alpha.length);for(let s=0;s<r;s++){const l=r-1-s;for(let u=0;u<t;u++)o[s*t+u]=i.alpha[l*t+u]}return{...i,alpha:o,version:i.version+1,items:(i.items||[]).map(s=>s.type==="brush"?{...s,points:s.points.map(l=>({x:l.x,y:r-1-l.y}))}:{...s,center:{x:s.center.x,y:r-1-s.center.y},rotationDeg:-s.rotationDeg})}});return{...e,baseRgb:n,masks:a,guides:e.guides.map(i=>({...i,p1:{x:i.p1.x,y:r-1-i.p1.y},p2:{x:i.p2.x,y:r-1-i.p2.y}}))}}function D_(e,t){const r=e.width,n=e.height;if(r<=1||n<=1)return e;const a=(r-1)*.5,i=(n-1)*.5,o=Math.max(1e-6,Math.hypot(a,i)),s=t.model,l=Number.isFinite(Number(t.k1))?Number(t.k1):0,u=Number.isFinite(Number(t.k2))?Number(t.k2):0,d=Number.isFinite(Number(t.a))?Number(t.a):0,f=Number.isFinite(Number(t.b))?Number(t.b):0,h=Number.isFinite(Number(t.c))?Number(t.c):0,p=S=>{const w=Math.max(0,S);if(s==="poly3")return l*w*w*w+(1-l)*w;if(s==="poly5"){const P=w*w;return w*(1+l*P+u*P*P)}const v=w*w,M=v*w,_=M*w;return d*_+f*M+h*v+(1-d-f-h)*w},x=S=>{const w=Math.max(0,S);if(w<=1e-8)return 0;let v=w;for(let M=0;M<8;M++){const _=p(v)-w;if(Math.abs(_)<1e-7)break;const P=1e-4,A=p(v+P),R=p(Math.max(0,v-P)),D=(A-R)/(2*P);if(!Number.isFinite(D)||Math.abs(D)<1e-8)break;if(v-=_/D,!Number.isFinite(v))return w;v=Math.max(0,Math.min(4,v))}return v},b=S=>{const w=S.x-a,v=S.y-i,M=Math.hypot(w,v)/o;if(M<=1e-8)return{x:a,y:i};const P=x(M)/M;return{x:a+w*P,y:i+v*P}},y=S=>{const w=S.rotationDeg*Math.PI/180,v=Math.cos(w),M=Math.sin(w),_=-M,P=v,A=S.center,R={x:A.x+v*S.radiusX,y:A.y+M*S.radiusX},D={x:A.x+_*S.radiusY,y:A.y+P*S.radiusY},E=b(A),W=b(R),F=b(D),O=Math.max(1,Math.hypot(W.x-E.x,W.y-E.y)),$=Math.max(1,Math.hypot(F.x-E.x,F.y-E.y)),N=Math.atan2(W.y-E.y,W.x-E.x)*180/Math.PI;return{...S,center:E,radiusX:O,radiusY:$,rotationDeg:N}},m=new Float32Array(e.baseRgb.length);for(let S=0;S<n;S++)for(let w=0;w<r;w++){const v=w-a,M=S-i,_=Math.hypot(v,M)/o,P=p(_),A=_>1e-8?P/_:1,R=a+v*A,D=i+M*A,E=(S*r+w)*3;m[E]=hs(e.baseRgb,r,n,R,D,3,0),m[E+1]=hs(e.baseRgb,r,n,R,D,3,1),m[E+2]=hs(e.baseRgb,r,n,R,D,3,2)}const g=e.masks.map(S=>{const w=new Float32Array(S.alpha.length);for(let M=0;M<n;M++)for(let _=0;_<r;_++){const P=_-a,A=M-i,R=Math.hypot(P,A)/o,D=p(R),E=R>1e-8?D/R:1,W=a+P*E,F=i+A*E;w[M*r+_]=hs(S.alpha,r,n,W,F,1)}const v=(S.items||[]).map(M=>M.type==="brush"?{...M,points:M.points.map(b).filter(_=>_.x>=0&&_.y>=0&&_.x<=r-1&&_.y<=n-1)}:y(M)).filter(M=>M.type==="ellipse"?M.center.x>=-Math.max(M.radiusX,M.radiusY)&&M.center.y>=-Math.max(M.radiusX,M.radiusY)&&M.center.x<=r-1+Math.max(M.radiusX,M.radiusY)&&M.center.y<=n-1+Math.max(M.radiusX,M.radiusY):M.points.length>0);return{...S,alpha:w,version:S.version+1,items:v,featherPx:0}}),k=e.guides.map(S=>({...S,p1:b(S.p1),p2:b(S.p2)}));return{...e,baseRgb:m,masks:g,guides:k,selectedMaskItemId:g.some(S=>(S.items||[]).some(w=>w.id===e.selectedMaskItemId))?e.selectedMaskItemId:null,transform:{rotationDeg:0,crop:null}}}const mh=(e,t)=>[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]],R0=(e,t)=>mh([e.x,e.y,1],[t.x,t.y,1]),Vy=(e,t)=>{const r=Math.hypot(e,t);return r<1e-8?null:{x:e/r,y:t/r}},_k=e=>{if(e.length===0)return null;let t=0,r=0;for(const n of e)t*n.x+r*n.y<0?(t-=n.x,r-=n.y):(t+=n.x,r+=n.y);return Vy(t,r)};function $_(e){const t=e.guides.filter(_=>_.visible!==!1&&_.orientation==="horizontal").slice(0,2),r=e.guides.filter(_=>_.visible!==!1&&_.orientation==="vertical").slice(0,2);if(t.length<2||r.length<2)return e;const n=R0(t[0].p1,t[0].p2),a=R0(t[1].p1,t[1].p2),i=R0(r[0].p1,r[0].p2),o=R0(r[1].p1,r[1].p2),s=mh(n,a),l=mh(i,o),u=mh(s,l);if(Math.abs(u[2])<1e-12)return e;const d=u[0]/u[2],f=u[1]/u[2],h=[1,0,0,0,1,0,d,f,1],p=t.map(_=>{const P=xa(h,_.p1),A=xa(h,_.p2);return Vy(A.x-P.x,A.y-P.y)}).filter(Boolean),x=r.map(_=>{const P=xa(h,_.p1),A=xa(h,_.p2);return Vy(A.x-P.x,A.y-P.y)}).filter(Boolean),b=_k(p),y=_k(x);if(!b||!y)return e;const m=b.x*y.y-b.y*y.x;if(Math.abs(m)<1e-8)return e;const g=1/m,k=y.y*g,S=-y.x*g,w=-b.y*g,v=b.x*g;return A_(e,Id([k,S,0,w,v,0,0,0,1],h))}function z8(e,t,r){const n=Math.max(e,t,r),a=Math.min(e,t,r),i=(n+a)/2;if(n===a)return[0,0,i];const o=n-a,s=i>.5?o/(2-n-a):o/(n+a);let l=0;switch(n){case e:l=(t-r)/o+(t<r?6:0);break;case t:l=(r-e)/o+2;break;default:l=(e-t)/o+4;break}return l/=6,[l,s,i]}function tx(e,t,r){let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+(t-e)*6*n:n<1/2?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function W8(e,t,r){if(t===0)return[r,r,r];const n=r<.5?r*(1+t):r+t-r*t,a=2*r-n;return[tx(a,n,e+1/3),tx(a,n,e),tx(a,n,e-1/3)]}const V8=[0,30,60,120,180,240,285,320],L_=e=>{const t=[],r=[],n=[];let a=!1;for(const i of j8){const o=e[i];t.push(o.hue),r.push(o.saturation),n.push(o.luminance),(Math.abs(o.hue)>1e-6||Math.abs(o.saturation)>1e-6||Math.abs(o.luminance)>1e-6)&&(a=!0)}return{hue:t,saturation:r,luminance:n,hasAdjust:a}},Pk=(e,t,r)=>{if(Math.abs(t-e)<1e-9)return r<e?0:1;const n=yr((r-e)/(t-e));return n*n*(3-2*n)},sc=(e,t,r)=>{const n=Math.max(-1,Math.min(1,t)),a=yr(r);return n>=0?e+(1-e)*n*a:e+e*n*a};function B_(e,t,r,n,a,i){let o=e,s=t,l=r;if(n.exposure!==0){const m=Math.pow(2,n.exposure);o*=m,s*=m,l*=m}if(n.temperature!==0||n.tint!==0){const m=n.temperature/100,g=n.tint/100;o*=1+.18*m+.08*g,s*=1-.16*g,l*=1-.18*m+.08*g}if(n.contrast!==0){const m=1+n.contrast/100;o=(o-.5)*m+.5,s=(s-.5)*m+.5,l=(l-.5)*m+.5}if(n.highlights!==0||n.shadows!==0){const m=yr(o*.2126+s*.7152+l*.0722),g=Pk(.5,1,m),k=1-Pk(0,.5,m);if(n.highlights!==0){const S=n.highlights/100;o=sc(o,S,g),s=sc(s,S,g),l=sc(l,S,g)}if(n.shadows!==0){const S=n.shadows/100;o=sc(o,S,k),s=sc(s,S,k),l=sc(l,S,k)}}if(n.vibrance!==0||n.saturation!==0||a.hasAdjust){let[m,g,k]=z8(yr(o),yr(s),yr(l));if(n.vibrance!==0){const S=n.vibrance/100;g=S>=0?yr(g+S*(1-g)):yr(g+S*g)}if(n.saturation!==0&&(g=yr(g+n.saturation/100)),a.hasAdjust){const S=(m%1+1)%1*360;let w=0,v=0,M=0,_=0;for(let P=0;P<8;P++){const A=V8[P];let R=Math.abs(S-A);R>180&&(R=360-R);const D=yr(1-R/45);D<=0||(w+=D,v+=D*a.hue[P],M+=D*a.saturation[P],_+=D*a.luminance[P])}if(w>1e-6){const P=yr((g-.03)/.25),A=1/w,R=v*A/100*(45/360)*P;m=(m+R)%1,m<0&&(m+=1),g=yr(g+M*A/100*P),k=yr(k+_*A/100*P)}}[o,s,l]=W8(m,g,k)}const d=Math.max(0,o*.2126+s*.7152+l*.0722),f=Math.min(255,Math.max(0,Math.round(yr(d)*255))),h=i.master[f],p=d>1e-6?h/d:1,x=yr(o*p),b=yr(s*p),y=yr(l*p);return o=i.red[Math.min(255,Math.max(0,Math.round(x*255)))],s=i.green[Math.min(255,Math.max(0,Math.round(b*255)))],l=i.blue[Math.min(255,Math.max(0,Math.round(y*255)))],[o,s,l]}function Hy(e){const t=new Float32Array(e.baseRgb),r=new Map,n=new Map,a=e.width*e.height;for(const s of e.layers)s.enabled&&r.set(s.maskId,s);for(const s of e.masks){const l=r.get(s.id);if(!l||!l.enabled||!s.visible)continue;const u=Yc(l.basic),d=qc(l.mixer),f=L_(d),h=yg(l.curves),p=`${l.id}:${JSON.stringify(h)}`;let x=n.get(p);x||(x={master:ca(h.master),red:ca(h.red),green:ca(h.green),blue:ca(h.blue)},n.set(p,x));const b=s.alpha,y=yr(l.opacity);for(let m=0;m<a;m++){const g=yr(b[m]*y);if(g<=0)continue;const k=m*3,S=t[k],w=t[k+1],v=t[k+2],[M,_,P]=B_(S,w,v,u,f,x),A=l.blendMode==="subtract"?2*S-M:M,R=l.blendMode==="subtract"?2*w-_:_,D=l.blendMode==="subtract"?2*v-P:P;t[k]=S*(1-g)+A*g,t[k+1]=w*(1-g)+R*g,t[k+2]=v*(1-g)+D*g}}const i=new ImageData(e.width,e.height),o=i.data;for(let s=0,l=0;s<a;s++,l+=3){const u=s*4;o[u]=Math.round(Dc(t[l])*255),o[u+1]=Math.round(Dc(t[l+1])*255),o[u+2]=Math.round(Dc(t[l+2])*255),o[u+3]=255}return i}function H8(e,t,r){if(t.width!==e.width||t.height!==e.height)return Hy(e);const n=Math.max(0,Math.floor(r.x0)),a=Math.max(0,Math.floor(r.y0)),i=Math.min(e.width-1,Math.ceil(r.x1)),o=Math.min(e.height-1,Math.ceil(r.y1));if(i<n||o<a)return t;const s=new Uint8ClampedArray(t.data),l=new ImageData(s,e.width,e.height),u=l.data,d=new Map,f=new Map;for(const p of e.layers)p.enabled&&d.set(p.maskId,p);const h=[];for(const p of e.masks){const x=d.get(p.id);if(!x||!x.enabled||!p.visible)continue;const b=Yc(x.basic),y=qc(x.mixer),m=L_(y),g=yg(x.curves),k=`${x.id}:${JSON.stringify(g)}`;let S=f.get(k);S||(S={master:ca(g.master),red:ca(g.red),green:ca(g.green),blue:ca(g.blue)},f.set(k,S)),h.push({mask:p,layer:x,alpha:p.alpha,opacity:yr(x.opacity),basic:b,mixerArrays:m,lutPack:S})}for(let p=a;p<=o;p++){const x=p*e.width;for(let b=n;b<=i;b++){const y=x+b,m=y*3;let g=e.baseRgb[m],k=e.baseRgb[m+1],S=e.baseRgb[m+2];for(const v of h){const M=yr(v.alpha[y]*v.opacity);if(M<=0)continue;const[_,P,A]=B_(g,k,S,v.basic,v.mixerArrays,v.lutPack),R=v.layer.blendMode==="subtract"?2*g-_:_,D=v.layer.blendMode==="subtract"?2*k-P:P,E=v.layer.blendMode==="subtract"?2*S-A:A;g=g*(1-M)+R*M,k=k*(1-M)+D*M,S=S*(1-M)+E*M}const w=y*4;u[w]=Math.round(Dc(g)*255),u[w+1]=Math.round(Dc(k)*255),u[w+2]=Math.round(Dc(S)*255),u[w+3]=255}}return l}const Nk=[{id:"red",label:"Red",color:"#ef4444"},{id:"orange",label:"Orange",color:"#fb923c"},{id:"yellow",label:"Yellow",color:"#facc15"},{id:"green",label:"Green",color:"#22c55e"},{id:"aqua",label:"Aqua",color:"#14b8a6"},{id:"blue",label:"Blue",color:"#3b82f6"},{id:"purple",label:"Purple",color:"#8b5cf6"},{id:"magenta",label:"Magenta",color:"#d946ef"}],rx={exposure:0,temperature:0,tint:0,contrast:0,highlights:0,shadows:0,vibrance:0,saturation:0},nx={red:{hue:0,saturation:0,luminance:0},orange:{hue:0,saturation:0,luminance:0},yellow:{hue:0,saturation:0,luminance:0},green:{hue:0,saturation:0,luminance:0},aqua:{hue:0,saturation:0,luminance:0},blue:{hue:0,saturation:0,luminance:0},purple:{hue:0,saturation:0,luminance:0},magenta:{hue:0,saturation:0,luminance:0}},X8=e=>{const t=[...e].sort((l,u)=>l.x-u.x),r=t.length,n=t.map(l=>l.x),a=t.map(l=>l.y);if(r<2)return l=>r===1?a[0]:0;const i=new Array(r-1).fill(0);for(let l=0;l<r-1;l++){const u=n[l+1]-n[l],d=a[l+1]-a[l];i[l]=u!==0?d/u:0}const o=new Array(r).fill(0);o[0]=i[0],o[r-1]=i[r-2];for(let l=1;l<r-1;l++)i[l-1]*i[l]<=0?o[l]=0:o[l]=(i[l-1]+i[l])/2;for(let l=0;l<r-1;l++){if(i[l]===0){o[l]=0,o[l+1]=0;continue}const u=o[l]/i[l],d=o[l+1]/i[l],f=u*u+d*d;if(f>9){const h=3/Math.sqrt(f);o[l]=h*u*i[l],o[l+1]=h*d*i[l]}}const s=(l,u)=>{const d=n[l],f=n[l+1],h=a[l],p=a[l+1],x=f-d;if(x<=0)return h;const b=(u-d)/x,y=b*b,m=y*b,g=2*m-3*y+1,k=m-2*y+b,S=-2*m+3*y,w=m-y;return Math.max(0,Math.min(1,g*h+k*x*o[l]+S*p+w*x*o[l+1]))};return l=>{if(l<=n[0])return a[0];if(l>=n[r-1])return a[r-1];let u=0;for(;u<r-2&&l>n[u+1];)u++;return s(u,l)}},K8=({channel:e,points:t,onChange:r})=>{const n=j.useRef(null),[a,i]=j.useState(null),[o,s]=j.useState(()=>[...t].sort((b,y)=>b.x-y.x)),l=j.useRef(o),u=b=>{l.current=b,s(b)};j.useEffect(()=>{if(a!==null)return;const b=[...t].sort((y,m)=>y.x-m.x);u(b)},[t,a]);const d=j.useMemo(()=>[...o].sort((b,y)=>b.x-y.x),[o]),f=j.useMemo(()=>{if(d.length<2)return"";const b=X8(d);let y=`M ${d[0].x*256} ${256-d[0].y*256}`;for(let m=1;m<=120;m++){const g=m/120,k=b(g);y+=` L ${g*256} ${256-k*256}`}return y},[d]),h=b=>{if(!n.current)return{x:0,y:0};const y=n.current.getBoundingClientRect();return{x:Math.max(0,Math.min(1,(b.clientX-y.left)/y.width)),y:Math.max(0,Math.min(1,1-(b.clientY-y.top)/y.height))}},p=b=>{if(a!==null)return;const y=h(b);if(d.some(g=>Math.abs(g.x-y.x)<.04))return;const m=[...d,y].sort((g,k)=>g.x-k.x);u(m),r(m)};j.useEffect(()=>{const b=m=>{if(a===null)return;const g=h(m),k=[...l.current].sort((M,_)=>M.x-_.x);let S=0,w=1;a>0&&(S=k[a-1].x+.01),a<k.length-1&&(w=k[a+1].x-.01),a===0?g.x=0:a===k.length-1?g.x=1:g.x=Math.max(S,Math.min(w,g.x));const v=[...k];v[a]=g,u(v)},y=()=>{if(a!==null){const m=[...l.current].sort((g,k)=>g.x-k.x);r(m)}i(null)};return a!==null&&(window.addEventListener("mousemove",b),window.addEventListener("mouseup",y)),()=>{window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y)}},[a,r,d]);const x=e==="master"?"#94a3b8":e==="red"?"#ef4444":e==="green"?"#22c55e":"#3b82f6";return c.jsx("div",{className:"w-full aspect-square bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-700 rounded relative select-none",children:c.jsxs("svg",{ref:n,width:"100%",height:"100%",viewBox:"0 0 256 256",className:"cursor-crosshair",onMouseDown:p,children:[c.jsx("path",{d:"M64,0 v256 M128,0 v256 M192,0 v256",stroke:"rgba(128,128,128,0.2)",strokeDasharray:"4 4"}),c.jsx("path",{d:"M0,64 h256 M0,128 h256 M0,192 h256",stroke:"rgba(128,128,128,0.2)",strokeDasharray:"4 4"}),c.jsx("line",{x1:"0",y1:"256",x2:"256",y2:"0",stroke:"rgba(128,128,128,0.1)"}),c.jsx("path",{d:f,fill:"none",stroke:x,strokeWidth:"2"}),d.map((b,y)=>c.jsx("circle",{cx:b.x*256,cy:256-b.y*256,r:a===y?6:4,fill:x,stroke:"white",strokeWidth:"1.5",className:"cursor-pointer",onMouseDown:m=>{m.stopPropagation(),m.preventDefault(),i(y)},onDoubleClick:m=>{if(m.stopPropagation(),y===0||y===d.length-1)return;const g=d.filter((k,S)=>S!==y);u(g),r(g)}},y))]})})},ki=({value:e,min:t,max:r,step:n,className:a,onPreview:i,onCommit:o,resetValue:s=0})=>{const[l,u]=j.useState(e),d=j.useRef(!1),f=j.useRef(e);j.useEffect(()=>{d.current||(u(e),f.current=e)},[e]);const h=()=>{const x=Math.max(t,Math.min(r,l)),b=f.current;d.current=!1,Math.abs(x-b)>1e-9&&o(x),f.current=x},p=()=>{const x=Math.max(t,Math.min(r,s)),b=d.current?f.current:e;d.current=!1,u(x),i==null||i(x),Math.abs(x-b)>1e-9&&o(x),f.current=x};return c.jsx("input",{type:"range",min:t,max:r,step:n,value:l,onChange:x=>{const b=Number(x.target.value);u(b),i==null||i(b)},onPointerDown:()=>{d.current=!0,f.current=e},onPointerUp:h,onPointerCancel:h,onMouseUp:h,onTouchEnd:h,onBlur:h,onDoubleClick:p,className:a})},Y8=({inline:e=!1,doc:t,brushEnabled:r,brushSize:n,brushOpacity:a,brushFeather:i,ellipseFeather:o,brushMode:s,onAddMask:l,onAddEllipseMask:u,onCancelEllipseTool:d,onSelectLayer:f,onSelectMask:h,onBindLayerMask:p,onSetLayerBlendMode:x,onSetLayerOpacity:b,onSetLayerBasic:y,onSetLayerMixer:m,onPreviewLayerBasic:g,onPreviewLayerMixer:k,onSetLayerCurves:S,onSelectMaskItem:w,onUpdateEllipseItem:v,onSetMaskOverlayVisible:M,onBrushEnabledChange:_,onBrushSizeChange:P,onBrushOpacityChange:A,onBrushFeatherChange:R,onEllipseFeatherChange:D,onBrushModeChange:E})=>{var xe,Se,Ie;const[W,F]=j.useState("master"),[O,$]=j.useState("orange"),[N,C]=j.useState(null),[B,I]=j.useState(!1),[z,V]=j.useState(!1),K=e?"w-full p-2 bg-white dark:bg-black border border-gray-300 dark:border-slate-700 text-xs":"absolute top-3 right-3 z-40 w-80 max-h-[90%] overflow-y-auto p-3 bg-white/95 dark:bg-black/95 border-2 border-black dark:border-white shadow-[6px_6px_0px_rgba(0,0,0,0.6)] text-xs";if(!t)return c.jsx("div",{className:e?"w-full p-2 bg-white dark:bg-black border border-gray-300 dark:border-slate-700":"absolute top-3 right-3 z-40 w-80 p-3 bg-white/90 dark:bg-black/90 border-2 border-black dark:border-white",children:c.jsx("p",{className:"text-xs font-bold",children:"PS document not ready."})});const q=t.masks.find(te=>te.id===t.selectedMaskId)||null,G=q&&t.layers.find(te=>te.maskId===q.id)||null,pe=((xe=q==null?void 0:q.items)==null?void 0:xe.find(te=>te.id===t.selectedMaskItemId))||null,J=pe&&pe.type==="ellipse"?pe:null,Z=yg(G==null?void 0:G.curves),ae=(G==null?void 0:G.basic)||rx,ne=((G==null?void 0:G.mixer)||nx)[O]||{hue:0,saturation:0,luminance:0};j.useEffect(()=>{F("master"),$("orange")},[G==null?void 0:G.id]),j.useEffect(()=>{q&&C(q.id)},[q==null?void 0:q.id]);const le=(te,Oe,Fe)=>{y(te.id,{...te.basic||rx,[Oe]:Fe})},se=(te,Oe,Fe)=>{g==null||g(te.id,{...te.basic||rx,[Oe]:Fe})},he=(te,Oe,Fe,bt)=>{const Ct=te.mixer||nx;m(te.id,{...Ct,[Oe]:{...Ct[Oe]||{hue:0,saturation:0,luminance:0},[Fe]:bt}})},ue=(te,Oe,Fe,bt)=>{const Ct=te.mixer||nx;k==null||k(te.id,{...Ct,[Oe]:{...Ct[Oe]||{hue:0,saturation:0,luminance:0},[Fe]:bt}})},ie=te=>{G&&S(G.id,{...Z,[W]:te})};return c.jsxs("div",{className:K,children:[c.jsx("div",{className:"font-bold mb-2",children:"PS Masks"}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-3",children:[c.jsx("button",{onClick:l,className:"px-2 py-1 bg-cyan-600 text-white font-bold border border-black",children:"+ Mask"}),c.jsx("button",{onClick:()=>{const te=!B;I(te),_(te)},className:`px-2 py-1 font-bold border border-black ${B?"bg-white text-black":"bg-emerald-600 text-white"}`,children:"+ Brush"}),c.jsx("button",{onClick:()=>{const te=!z;V(te),te?u():d()},className:`px-2 py-1 font-bold border border-black ${z?"bg-white text-black":"bg-violet-600 text-white"}`,children:"+ Ellipse"})]}),z&&c.jsxs("label",{className:"block mb-3",children:[c.jsxs("span",{className:"block mb-1",children:["New Ellipse Feather ",Math.round(o)," px"]}),c.jsx("input",{type:"range",min:0,max:256,step:1,value:o,onChange:te=>D(Number(te.target.value)),className:"w-full"})]}),c.jsxs("div",{className:"mb-3",children:[c.jsx("div",{className:"font-semibold mb-1",children:"Masks"}),c.jsxs("div",{className:"space-y-1 max-h-52 overflow-auto border border-gray-300 dark:border-slate-700 p-1",children:[t.masks.map(te=>c.jsxs("div",{className:"border border-gray-300 dark:border-slate-700",children:[c.jsxs("div",{className:"flex",children:[c.jsx("button",{onClick:()=>C(N===te.id?null:te.id),className:"w-7 px-1 py-1 border-r border-gray-300 dark:border-slate-700 bg-gray-100 dark:bg-slate-800",title:N===te.id?"Collapse mask":"Expand mask",children:N===te.id?"v":">"}),c.jsx("button",{onClick:()=>h(te.id),className:`flex-1 text-left px-2 py-1 ${t.selectedMaskId===te.id?"bg-emerald-100 dark:bg-emerald-900/40":"bg-white dark:bg-slate-900"}`,children:te.name}),c.jsx("button",{onClick:()=>M(te.id,!(te.overlayVisible??!0)),className:`px-2 py-1 border-l border-gray-300 dark:border-slate-700 text-[11px] font-bold ${te.overlayVisible??!0?"bg-rose-100 dark:bg-rose-900/40 text-rose-700 dark:text-rose-300":"bg-gray-100 dark:bg-slate-800 text-gray-500 dark:text-slate-400"}`,title:"Toggle red mask overlay",children:"Eye"})]}),N===te.id&&c.jsxs("div",{className:"p-1 border-t border-gray-300 dark:border-slate-700 space-y-1 bg-gray-50 dark:bg-slate-900/40",children:[(te.items||[]).map(Oe=>c.jsxs("button",{onClick:()=>w(Oe.id),className:`w-full text-left px-2 py-1 border text-[11px] ${t.selectedMaskId===te.id&&t.selectedMaskItemId===Oe.id?"bg-violet-100 dark:bg-violet-900/40 border-violet-500":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-700"}`,children:[(Oe.type==="brush",Oe.name)," (",Oe.mode==="add"?"Add":"Subtract",")"]},Oe.id)),(te.items||[]).length===0&&c.jsx("div",{className:"px-2 py-1 text-[11px] text-gray-500",children:"No brush/ellipse items."})]})]},te.id)),t.masks.length===0&&c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No masks yet."})]})]}),B&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Brush"}),c.jsx("div",{className:"grid grid-cols-1 gap-2 mb-2",children:c.jsxs("select",{value:s,onChange:te=>E(te.target.value),className:"border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Paint Add"}),c.jsx("option",{value:"subtract",children:"Paint Subtract"})]})}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Size ",n,"px"]}),c.jsx("input",{type:"range",min:1,max:200,step:1,value:n,onChange:te=>P(Number(te.target.value)),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Opacity ",a.toFixed(2)]}),c.jsx("input",{type:"range",min:.01,max:1,step:.01,value:a,onChange:te=>A(Number(te.target.value)),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("span",{className:"block mb-1",children:["Feather ",Math.round(i*100),"%"]}),c.jsx("input",{type:"range",min:0,max:1,step:.01,value:i,onChange:te=>R(Number(te.target.value)),className:"w-full"})]})]}),J&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Selected Ellipse"}),c.jsxs("label",{className:"block mb-2",children:[c.jsx("span",{className:"block mb-1",children:"Mode"}),c.jsxs("select",{value:J.mode,onChange:te=>v(J.id,{mode:te.target.value}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Add"}),c.jsx("option",{value:"subtract",children:"Subtract"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Center X"}),c.jsx("input",{type:"number",step:1,value:J.center.x,onChange:te=>v(J.id,{center:{...J.center,x:Number(te.target.value)}}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Center Y"}),c.jsx("input",{type:"number",step:1,value:J.center.y,onChange:te=>v(J.id,{center:{...J.center,y:Number(te.target.value)}}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Radius X"}),c.jsx("input",{type:"number",min:1,step:1,value:J.radiusX,onChange:te=>v(J.id,{radiusX:Number(te.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[11px]",children:[c.jsx("span",{className:"block mb-1",children:"Radius Y"}),c.jsx("input",{type:"number",min:1,step:1,value:J.radiusY,onChange:te=>v(J.id,{radiusY:Number(te.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Rotation ",J.rotationDeg.toFixed(1)," deg"]}),c.jsx("input",{type:"range",min:-180,max:180,step:.1,value:J.rotationDeg,onChange:te=>v(J.id,{rotationDeg:Number(te.target.value)}),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("span",{className:"block mb-1",children:["Feather ",Math.round(J.featherPx)," px"]}),c.jsx("input",{type:"range",min:0,max:512,step:1,value:J.featherPx,onChange:te=>v(J.id,{featherPx:Number(te.target.value)}),className:"w-full"})]})]}),G&&c.jsxs("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Mask Adjustment"}),c.jsxs("label",{className:"block mb-2",children:[c.jsx("span",{className:"block mb-1",children:"Blend"}),c.jsxs("select",{value:G.blendMode,onChange:te=>x(G.id,te.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",children:[c.jsx("option",{value:"add",children:"Add"}),c.jsx("option",{value:"subtract",children:"Subtract"})]})]}),c.jsxs("div",{className:"mb-2 text-[11px] text-gray-500",children:["Bound Mask: ",c.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:((Se=t.masks.find(te=>te.id===G.maskId))==null?void 0:Se.name)||"None"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("span",{className:"block mb-1",children:["Opacity ",G.opacity.toFixed(2)]}),c.jsx("input",{type:"range",min:0,max:1,step:.01,value:G.opacity,onChange:te=>b(G.id,Number(te.target.value)),className:"w-full"})]}),c.jsxs("div",{className:"mt-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Basic"}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Exposure"}),c.jsx("span",{className:"text-[11px]",children:ae.exposure.toFixed(2)})]}),c.jsx(ki,{value:ae.exposure,min:-5,max:5,step:.01,onPreview:te=>se(G,"exposure",te),onCommit:te=>le(G,"exposure",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Temperature"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.temperature)})]}),c.jsx(ki,{value:ae.temperature,min:-100,max:100,step:1,onPreview:te=>se(G,"temperature",te),onCommit:te=>le(G,"temperature",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Tint (G/M)"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.tint)})]}),c.jsx(ki,{value:ae.tint,min:-100,max:100,step:1,onPreview:te=>se(G,"tint",te),onCommit:te=>le(G,"tint",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Contrast"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.contrast)})]}),c.jsx(ki,{value:ae.contrast,min:-100,max:100,step:1,onPreview:te=>se(G,"contrast",te),onCommit:te=>le(G,"contrast",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Highlights"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.highlights)})]}),c.jsx(ki,{value:ae.highlights,min:-100,max:100,step:1,onPreview:te=>se(G,"highlights",te),onCommit:te=>le(G,"highlights",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Shadows"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.shadows)})]}),c.jsx(ki,{value:ae.shadows,min:-100,max:100,step:1,onPreview:te=>se(G,"shadows",te),onCommit:te=>le(G,"shadows",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Vibrance"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.vibrance)})]}),c.jsx(ki,{value:ae.vibrance,min:-100,max:100,step:1,onPreview:te=>se(G,"vibrance",te),onCommit:te=>le(G,"vibrance",te),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Saturation"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ae.saturation)})]}),c.jsx(ki,{value:ae.saturation,min:-100,max:100,step:1,onPreview:te=>se(G,"saturation",te),onCommit:te=>le(G,"saturation",te),className:"w-full"})]})]}),c.jsxs("div",{className:"mt-3 border border-gray-300 dark:border-slate-700 p-2",children:[c.jsx("div",{className:"font-semibold mb-2",children:"Color Mixer"}),c.jsx("div",{className:"flex items-center gap-2 mb-2 flex-wrap",children:Nk.map(te=>c.jsx("button",{onClick:()=>$(te.id),className:`w-5 h-5 rounded-full border-2 ${O===te.id?"border-black dark:border-white scale-110":"border-gray-500 dark:border-slate-500"} transition-transform`,style:{backgroundColor:te.color},title:te.label},te.id))}),c.jsxs("div",{className:"text-[11px] text-gray-500 mb-2",children:["Band: ",(Ie=Nk.find(te=>te.id===O))==null?void 0:Ie.label]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Hue"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.hue)})]}),c.jsx(ki,{value:ne.hue,min:-100,max:100,step:1,onPreview:te=>ue(G,O,"hue",te),onCommit:te=>he(G,O,"hue",te),className:"w-full"})]}),c.jsxs("label",{className:"block mb-2",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Saturation"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.saturation)})]}),c.jsx(ki,{value:ne.saturation,min:-100,max:100,step:1,onPreview:te=>ue(G,O,"saturation",te),onCommit:te=>he(G,O,"saturation",te),className:"w-full"})]}),c.jsxs("label",{className:"block",children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("span",{children:"Luminance"}),c.jsx("span",{className:"text-[11px]",children:Math.round(ne.luminance)})]}),c.jsx(ki,{value:ne.luminance,min:-100,max:100,step:1,onPreview:te=>ue(G,O,"luminance",te),onCommit:te=>he(G,O,"luminance",te),className:"w-full"})]})]}),c.jsxs("div",{className:"mt-3",children:[c.jsx("div",{className:"font-semibold mb-1",children:"Layer Curves"}),c.jsx("div",{className:"flex gap-1 mb-2",children:["master","red","green","blue"].map(te=>c.jsx("button",{onClick:()=>F(te),className:`flex-1 py-1 text-[11px] font-bold uppercase rounded transition-colors ${W===te?"bg-slate-700 text-white":"bg-gray-200 dark:bg-slate-800 text-gray-600 dark:text-gray-400 hover:bg-gray-300 dark:hover:bg-slate-700"}`,children:te==="master"?"Luma":te},te))}),c.jsx(K8,{channel:W,points:Z[W],onChange:ie}),c.jsx("div",{className:"text-[10px] text-gray-400 mt-1 text-center",children:"Click add, drag move, double-click remove."})]})]}),!G&&q&&c.jsx("div",{className:"mb-3 border border-gray-300 dark:border-slate-700 p-2 text-[11px] text-gray-500",children:"No adjustment layer bound to this mask."})]})},Zc={"Canon EOS R5":"0.9766 -0.2953 -0.1254 -0.4276 1.2116 0.2433 -0.0437 0.1336 0.5131","Canon EOS 7D Mark II":"0.7268 -0.1082 -0.0969 -0.4186 1.1839 0.2663 -0.0825 0.2029 0.5839","Canon EOS R3":"0.9423 -0.2839 -0.1195 -0.4532 1.2377 0.2415 -0.0483 0.1374 0.5276","Canon EOS 5D Mark III":"0.6722 -0.0635 -0.0963 -0.4287 1.246 0.2028 -0.0908 0.2162 0.5668","Canon EOS 5DS R":"0.625 -0.0711 -0.0808 -0.5153 1.2794 0.2636 -0.1249 0.2198 0.561","Canon EOS R6":"0.8293 -0.1611 -0.1132 -0.4759 1.2711 0.2275 -0.1013 0.2415 0.5509","Samsung NX U":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Canon EOS R5 Mark II":"0.9396 -0.2598 -0.1207 -0.4408 1.2296 0.2369 -0.0505 0.1575 0.6077","Canon EOS 5DS":"0.625 -0.0711 -0.0808 -0.5153 1.2794 0.2636 -0.1249 0.2198 0.561","Canon EOS R":"0.8293 -0.1789 -0.1094 -0.5025 1.2925 0.2327 -0.1199 0.2769 0.6108","Canon EOS R6 Mark II":"0.9539 -0.2795 -0.1224 -0.4175 1.1998 0.2458 -0.0465 0.1755 0.6048","Canon EOS R7":"1.0424 -0.3138 -0.13 -0.4221 1.1938 0.2584 -0.0547 0.1658 0.6183","Canon EOS 5D Mark IV":"0.6446 -0.0366 -0.0864 -0.4436 1.2204 0.2513 -0.0952 0.2496 0.6348","Canon EOS-1D X Mark III":"0.8971 -0.2022 -0.1242 -0.5405 1.3249 0.238 -0.128 0.2483 0.6072","Sony ILCE-7M3":"0.7374 -0.2389 -0.0551 -0.5435 1.3162 0.2519 -0.1006 0.1795 0.6552","Hasselblad 50-15-Coated5":"0.5002 -0.0878 0.0111 -0.4856 1.1929 0.3338 -0.1183 0.2041 0.7022","Canon EOS-1D X":"0.6847 -0.0614 -0.1014 -0.4669 1.2737 0.2139 -0.1197 0.2488 0.6846","Fujifilm GFX 100":"1.6212 -0.8423 -0.1583 -0.4336 1.2583 0.1937 -0.0195 0.0726 0.6199","Phase One IQ180":"0.6294 0.0686 -0.0712 -0.5435 1.3417 0.2211 -0.1006 0.2435 0.5042","Phase One IQ3 100MP":"0.2423 0 0 0 0.9901 0 0 0 0.7989","Canon EOS-1D X Mark II":"0.7596 -0.0978 -0.0967 -0.4808 1.2571 0.2503 -0.1398 0.2567 0.5752","Canon PowerShot Pro70":"-0.5106 1.0695 0.1576 0.382 0.0053 0.4566 -0.6497 1.0736 0.6701 -0.3336 1.1887 0.1394","Sony ILCE-9":"0.6389 -0.1703 -0.0378 -0.4562 1.2265 0.2587 -0.067 0.1489 0.655","Sony ILCE-7CR":"0.82 -0.2976 -0.0719 -0.4296 1.2053 0.2532 -0.0429 0.1282 0.5774","Sony ILCE-7S":"0.5838 -0.143 -0.0246 -0.3497 1.1477 0.2297 -0.0748 0.1885 0.5778","Sony ILCE-7RM3":"0.664 -0.1847 -0.0503 -0.5238 1.301 0.2474 -0.0993 0.1673 0.6527","Sony DSC-RX1RM3":"0.9034 -0.349 -0.0777 -0.4004 1.1841 0.2448 -0.0484 0.1352 0.5552","Sony ILCE-6100":"0.7657 -0.2847 -0.0607 -0.4083 1.1966 0.2389 -0.0684 0.1418 0.5844","Sony ILCE-7RM2":"0.6629 -0.19 -0.0483 -0.4618 1.2349 0.255 -0.0622 0.1381 0.6514","Sony ILCE-5100":"0.5991 -0.1456 -0.0455 -0.4764 1.2135 0.298 -0.0707 0.1425 0.6701","Sony ILCE-7M2":"0.5271 -0.0712 -0.0347 -0.6153 1.3653 0.2763 -0.1601 0.2366 0.7242","Sony ILCE-7RM5":"0.82 -0.2976 -0.0719 -0.4296 1.2053 0.2532 -0.0429 0.1282 0.5774","Sony ILCA-77M2":"0.5991 -0.1732 -0.0443 -0.41 1.1989 0.2381 -0.0704 0.1467 0.5992","Sony ZV-1M2":"0.828 -0.2987 -0.0703 -0.3531 1.1645 0.2133 -0.055 0.1542 0.5312","Sony ILCE-7SM2":"0.5838 -0.143 -0.0246 -0.3497 1.1477 0.2297 -0.0748 0.1885 0.5778","Sony DSC-RX100M7":"1.0315 -0.439 -0.0937 -0.4859 1.2734 0.2365 -0.0734 0.1537 0.5997","Sony ILCE-6300":"0.5973 -0.1695 -0.0419 -0.3826 1.1797 0.2293 -0.0639 0.1398 0.5789","Sony ILCA-99M2":"0.666 -0.1918 -0.0471 -0.4613 1.2398 0.2485 -0.0649 0.1433 0.6447","Sony ILCE-9M3":"0.9811 -0.3908 -0.0752 -0.3704 1.1577 0.2417 -0.0073 0.095 0.598","Sony ILCE-9M2":"0.6389 -0.1703 -0.0378 -0.4562 1.2265 0.2587 -0.067 0.1489 0.655","Sony DSC-RX100M6":"0.7325 -0.2321 -0.0596 -0.3494 1.1674 0.2055 -0.0668 0.1562 0.5031","Sony ZV-E10M2":"0.6972 -0.2408 -0.06 -0.433 1.2101 0.2515 -0.0388 0.1277 0.5847","Sony DSC-RX100M4":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","Sony ILCE-7SM3":"0.6912 -0.2127 -0.0469 -0.447 1.2175 0.2587 -0.0398 0.1478 0.6492","Sony ILCE-7":"0.5271 -0.0712 -0.0347 -0.6153 1.3653 0.2763 -0.1601 0.2366 0.7242","Sony ILCE-6000":"0.5991 -0.1456 -0.0455 -0.4764 1.2135 0.298 -0.0707 0.1425 0.6701","Sony ILCE-1":"0.8161 -0.2947 -0.0739 -0.4811 1.2668 0.2389 -0.0437 0.1229 0.6524","Sony ILCE-7M4":"0.746 -0.2365 -0.0588 -0.5687 1.3442 0.2474 -0.0624 0.1156 0.6584","Sony ILCE-7R":"0.4913 -0.0541 -0.0202 -0.613 1.3513 0.2906 -0.1564 0.2151 0.7183","Fujifilm X100VI":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-H2":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-A3":"1.2407 -0.5222 -0.1086 -0.2971 1.1116 0.212 -0.0294 0.1029 0.5284","Fujifilm X-H2S":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-Pro3":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-T50":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-T2":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T5":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X-Pro2":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-A7":"1.5055 -0.7391 -0.1274 -0.4062 1.2071 0.2238 -0.061 0.1217 0.6147","Fujifilm X-H1":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-S20":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-S10":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-T30":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X30":"1.2328 -0.5256 -0.1144 -0.4469 1.2927 0.1675 -0.0087 0.1291 0.4351","Fujifilm GFX 50R":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X100V":"1.3717 -0.649 -0.1154 -0.4348 1.2266 0.2335 -0.069 0.1286 0.6134","Fujifilm X-A5":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm X100F":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T100":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm XQ1":"0.9252 -0.2704 -0.1064 -0.5893 1.4265 0.1717 -0.1101 0.2341 0.4349","Fujifilm X-T4":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-E3":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-T20":"1.1434 -0.4948 -0.121 -0.3746 1.2042 0.1903 -0.0666 0.1479 0.5235","Fujifilm X-A2":"1.0763 -0.456 -0.0917 -0.3346 1.1311 0.2322 -0.0475 0.1135 0.5843","Fujifilm GFX 50S":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X-A1":"1.1086 -0.4555 -0.0839 -0.3512 1.131 0.2517 -0.0815 0.1341 0.594","Fujifilm X70":"1.045 -0.4329 -0.0878 -0.3217 1.1105 0.2421 -0.0752 0.1758 0.6519","Fujifilm FinePix S1":"1.2297 -0.4882 -0.1202 -0.2106 1.0691 0.1623 -0.0088 0.1312 0.479","Fujifilm XQ2":"0.9252 -0.2704 -0.1064 -0.5893 1.4265 0.1717 -0.1101 0.2341 0.4349","Fujifilm X-E2":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm GFX 100RF":"1.2806 -0.5779 -0.111 -0.3546 1.1507 0.2318 -0.0177 0.0996 0.5715","Fujifilm X-T10":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm X-E5":"1.1809 -0.5358 -0.1141 -0.4248 1.2164 0.2343 -0.0514 0.1097 0.5848","Fujifilm X100T":"1.0592 -0.4262 -0.1008 -0.3514 1.1355 0.2465 -0.087 0.2025 0.6386","Fujifilm X100S":"1.0592 -0.4262 -0.1008 -0.3514 1.1355 0.2465 -0.087 0.2025 0.6386","Fujifilm X-T3":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598","Fujifilm X-M5":"1.2836 -0.5909 -0.1032 -0.3087 1.1132 0.2236 -0.0035 0.0872 0.533","Fujifilm X-M1":"1.0413 -0.3996 -0.0993 -0.3721 1.164 0.2361 -0.0733 0.154 0.6011","Fujifilm X-T1":"0.8458 -0.2451 -0.0855 -0.4597 1.2447 0.2407 -0.1475 0.2482 0.6526","Fujifilm X20":"1.1768 -0.4971 -0.1133 -0.4904 1.2927 0.2183 -0.048 0.1723 0.4605","Fujifilm GFX 50S II":"1.1756 -0.4754 -0.0874 -0.3056 1.1045 0.2305 -0.0381 0.1457 0.6006","Fujifilm X-Pro1":"1.0413 -0.3996 -0.0993 -0.3721 1.164 0.2361 -0.0733 0.154 0.6011","Fujifilm XF10":"1.1673 -0.476 -0.1041 -0.3988 1.2058 0.2166 -0.0771 0.1417 0.5569","Fujifilm X-E2S":"1.1562 -0.5118 -0.0961 -0.3022 1.1007 0.2311 -0.0525 0.1569 0.6097","Nikon Coolpix P330":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P1000":"1.4294 -0.6116 -0.1333 -0.1628 1.0219 0.1637 -0.0014 0.1158 0.5022","Nikon Coolpix P340":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P7800":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon Coolpix P7700":"1.0321 -0.392 -0.0931 -0.275 1.1146 0.1824 -0.0442 0.1545 0.5539","Nikon 1 S2":"0.6612 -0.1342 -0.0618 -0.3338 1.1055 0.2623 -0.0174 0.1792 0.5075","Nikon D3300":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D3200":"0.7013 -0.1408 -0.0635 -0.5268 1.2902 0.264 -0.147 0.2801 0.7379","Nikon Z 8":"1.1423 -0.4564 -0.1123 -0.4816 1.2895 0.2119 -0.021 0.1061 0.7282","Nikon D810A":"1.1973 -0.5685 -0.0888 -0.1965 1.0326 0.1901 -0.0115 0.1123 0.7169","Nikon D5500":"0.8821 -0.2938 -0.0785 -0.4178 1.2142 0.2287 -0.0824 0.1651 0.686","Nikon Z 6 3":"1.1206 -0.4286 -0.0941 -0.4879 1.2847 0.2251 -0.0745 0.1654 0.7374","Nikon D750":"0.902 -0.289 -0.0715 -0.4535 1.2436 0.2348 -0.0934 0.1919 0.7086","Nikon Z 6":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon D500":"0.8813 -0.321 -0.1036 -0.4703 1.2868 0.2021 -0.1054 0.194 0.6129","Nikon D3400":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D5300":"0.6988 -0.1384 -0.0714 -0.5631 1.341 0.2447 -0.1485 0.2204 0.7318","Nikon D5600":"0.8821 -0.2938 -0.0785 -0.4178 1.2142 0.2287 -0.0824 0.1651 0.686","Nikon D780":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon Z 6 2":"0.9943 -0.3269 -0.0839 -0.5323 1.3269 0.2259 -0.1198 0.2083 0.7557","Nikon D5":"0.92 -0.3522 -0.0992 -0.5755 1.3803 0.2117 -0.0753 0.1486 0.6338","Nikon 1 J4":"0.5958 -0.1559 -0.0571 -0.4021 1.1453 0.2939 -0.0634 0.1548 0.5087","Nikon D800":"0.7866 -0.2108 -0.0555 -0.4869 1.2483 0.2681 -0.1176 0.2069 0.7501","Nikon 1 S1":"0.8994 -0.2667 -0.0865 -0.4594 1.2324 0.2552 -0.0699 0.1786 0.626","Nikon D850":"1.0405 -0.3755 -0.127 -0.5461 1.3787 0.1793 -0.104 0.2015 0.6785","Nikon 1 J3":"0.6588 -0.1305 -0.0693 -0.3277 1.0987 0.2634 -0.0355 0.2016 0.5106","Nikon D7200":"0.8322 -0.3112 -0.1047 -0.6367 1.4342 0.2179 -0.0988 0.1638 0.6394","Nikon Z 5":"0.8695 -0.2558 -0.0648 -0.5015 1.2711 0.2575 -0.1279 0.2215 0.7514","Nikon Z 50":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon Z 7 2":"1.3705 -0.6004 -0.14 -0.5464 1.3568 0.2062 -0.094 0.1706 0.7618","Nikon 1 J5":"0.752 -0.2518 -0.0645 -0.3844 1.2102 0.1945 -0.0913 0.2249 0.6835","Nikon Z 5 2":"1.3133 -0.5542 -0.128 -0.4325 1.2543 0.1972 0.0034 0.0792 0.7662","Nikon Z fc":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon Z f":"1.1607 -0.4491 -0.0977 -0.4522 1.246 0.2304 -0.0458 0.1519 0.7616","Nikon D610":"0.8178 -0.2245 -0.0609 -0.4857 1.2394 0.2776 -0.1207 0.2086 0.7298","Nikon Z 7":"1.3705 -0.6004 -0.14 -0.5464 1.3568 0.2062 -0.094 0.1706 0.7618","Nikon Df":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","Nikon 1 V3":"0.5958 -0.1559 -0.0571 -0.4021 1.1453 0.2939 -0.0634 0.1548 0.5087","Nikon D7000":"0.8198 -0.2239 -0.0724 -0.4871 1.2389 0.2798 -0.1043 0.205 0.7181","Nikon Z 9":"1.3389 -0.6049 -0.1441 -0.4544 1.2757 0.1969 0.0229 0.0498 0.739","Nikon Z 50 2":"1.164 -0.4829 -0.1079 -0.5107 1.3006 0.2325 -0.0972 0.1711 0.738","Nikon D4S":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","Nikon D810":"0.9369 -0.3195 -0.0791 -0.4488 1.243 0.2301 -0.0893 0.1796 0.6872","Nikon D4":"0.8598 -0.2848 -0.0857 -0.5618 1.3606 0.2195 -0.1002 0.1773 0.7137","DXO ONE":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","DXO-ONE":"0.6596 -0.2079 -0.0562 -0.4782 1.3016 0.1933 -0.097 0.1581 0.5181","Nikon D800E":"0.7866 -0.2108 -0.0555 -0.4869 1.2483 0.2681 -0.1176 0.2069 0.7501","ZEISS ZX1":"1 -0.4766 -0.0938 -0.2969 1.1328 0.1875 -0.0313 0.1094 0.7422","PENTAX K-50":"0.8628 -0.2607 -0.1156 -0.3995 1.2301 0.1881 -0.099 0.1735 0.6595","PENTAX K-500":"0.8513 -0.2572 -0.114 -0.3995 1.2301 0.1881 -0.1003 0.1758 0.6683","PENTAX K-3 II":"0.8571 -0.259 -0.1148 -0.3995 1.2301 0.1881 -0.1052 0.1844 0.7013","PENTAX K-S2":"0.8009 -0.2517 -0.114 -0.3882 1.235 0.1689 -0.0844 0.1493 0.6312","PENTAX K-3":"0.8761 -0.2648 -0.1173 -0.3995 1.2301 0.1881 -0.0901 0.1579 0.6001","PENTAX KP":"0.7357 -0.2031 -0.132 -0.4842 1.3555 0.1349 -0.1538 0.2416 0.5736","PENTAX MX-1":"0.8804 -0.2523 -0.1238 -0.2423 1.1627 0.086 -0.0682 0.1774 0.4753","PENTAX K-70":"0.8117 -0.2078 -0.1275 -0.4359 1.2953 0.1515 -0.1096 0.1965 0.6073","PENTAX K-3 Mark III":"0.6842 -0.1581 -0.0867 -0.4614 1.2728 0.2065 -0.0639 0.1428 0.5682","PENTAX 645Z":"0.9829 -0.31 -0.1271 -0.3685 1.2133 0.1721 -0.1068 0.1977 0.6854","PENTAX K-1":"0.8566 -0.2746 -0.1201 -0.3612 1.2204 0.155 -0.0893 0.168 0.6264","PENTAX Q7":"1.2995 -0.5593 -0.1107 -0.1879 1.0139 0.2027 -0.0064 0.1233 0.4919","Canon PowerShot SX60 HS":"1.3161 -0.5451 -0.1344 -0.1989 1.0654 0.1531 -0.0047 0.1271 0.4955","Canon PowerShot G15":"0.7474 -0.2301 -0.0567 -0.4056 1.1456 0.2975 -0.0222 0.0716 0.4181","Canon PowerShot G5 X Mark II":"1.1629 -0.5713 -0.0914 -0.2706 1.109 0.1842 -0.0206 0.1225 0.5515","Canon PowerShot G16":"0.802 -0.2687 -0.0682 -0.3704 1.1879 0.2052 -0.0965 0.1921 0.5556","Canon PowerShot S120":"0.6961 -0.1685 -0.0695 -0.4625 1.2945 0.1836 -0.1114 0.2152 0.5518","Canon PowerShot G1 X":"0.7378 -0.1255 -0.1043 -0.4088 1.2251 0.2048 -0.0876 0.1946 0.5805","Canon EOS M5":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS M6":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon PowerShot G7 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G7 X Mark II":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G9 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G3 X":"0.9701 -0.3857 -0.0921 -0.3149 1.1537 0.1817 -0.0786 0.1817 0.5147","Canon EOS 6D Mark II":"0.6875 -0.097 -0.0932 -0.4691 1.2459 0.2501 -0.0874 0.1953 0.5809","Canon PowerShot G1 X Mark III":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon PowerShot G9 X Mark II":"1.0056 -0.4131 -0.0944 -0.2576 1.1143 0.1625 -0.0238 0.1294 0.5179","Canon EOS 200D":"0.7377 -0.0742 -0.0998 -0.4235 1.1981 0.2549 -0.0673 0.1918 0.5538","Canon EOS R10":"0.9269 -0.2012 -0.1107 -0.399 1.1762 0.2527 -0.0569 0.2093 0.4913","Canon PowerShot G5 X":"0.9602 -0.3823 -0.0937 -0.2984 1.1495 0.1675 -0.0407 0.1415 0.5049","Canon PowerShot G1 X Mark II":"0.7378 -0.1255 -0.1043 -0.4088 1.2251 0.2048 -0.0876 0.1946 0.5805","Canon EOS M100":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS RP":"0.8608 -0.2097 -0.1178 -0.5425 1.3265 0.2383 -0.1149 0.2238 0.568","Canon EOS 7D":"0.6844 -0.0996 -0.0856 -0.3876 1.1761 0.2396 -0.0593 0.1772 0.6198","Canon EOS 90D":"1.1498 -0.3759 -0.1516 -0.5073 1.2954 0.2349 -0.0892 0.1867 0.6118","Canon PowerShot V1":"1.26 -0.4747 -0.2027 -0.611 1.5868 -0.0029 0.011 0.0479 0.6011","Canon EOS M3":"0.6362 -0.0823 -0.0847 -0.4426 1.2109 0.2616 -0.0743 0.1857 0.5635","Canon PowerShot G7 X Mark III":"1.1629 -0.5713 -0.0914 -0.2706 1.109 0.1842 -0.0206 0.1225 0.5515","Canon EOS M50":"0.8532 -0.0701 -0.1167 -0.4095 1.1879 0.2508 -0.0797 0.2424 0.701","Canon EOS 80D":"0.7457 -0.0671 -0.0937 -0.4849 1.2495 0.2643 -0.1213 0.2354 0.5492","Canon EOS M200":"1.0463 -0.2173 -0.1437 -0.4856 1.2635 0.2482 -0.1216 0.2915 0.7237","Canon EOS R100":"0.823 -0.1515 -0.1032 -0.4179 1.2005 0.2454 -0.0649 0.2076 0.4711","Canon EOS 700D":"0.6602 -0.0841 -0.0939 -0.4472 1.2458 0.2247 -0.0975 0.2039 0.6148","Canon EOS 100D":"0.6602 -0.0841 -0.0939 -0.4472 1.2458 0.2247 -0.0975 0.2039 0.6148","Canon EOS M6 Mark II":"1.1498 -0.3759 -0.1516 -0.5073 1.2954 0.2349 -0.0892 0.1867 0.6118","Canon EOS 70D":"0.7034 -0.0804 -0.1014 -0.442 1.2564 0.2058 -0.0851 0.1994 0.5758","Canon EOS R8":"0.9539 -0.2795 -0.1224 -0.4175 1.1998 0.2458 -0.0465 0.1755 0.6048","Canon EOS 6D":"0.7034 -0.0804 -0.1014 -0.442 1.2564 0.2058 -0.0851 0.1994 0.5758","Canon EOS R50 V":"0.9089 -0.181 -0.1209 -0.4294 1.2116 0.2454 -0.0498 0.1862 0.4923","Canon EOS 77D":"0.7377 -0.0742 -0.0998 -0.4235 1.1981 0.2549 -0.0673 0.1918 0.5538","LEICA M10":"0.8249 -0.2849 -0.062 -0.5415 1.4756 0.0565 -0.0957 0.3074 0.6517","LEICA Q (Typ 116)":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA Q3 43":"1.1111 -0.3816 -0.1057 -0.375 1.2107 0.1829 -0.0947 0.1868 0.4645","LEICA Q2":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA SL (Typ 601)":"1.1865 -0.4523 -0.1441 -0.5423 1.4458 0.0935 -0.1587 0.2687 0.483","LEICA D-Lux 8":"0.8585 -0.3127 -0.0833 -0.4005 1.225 0.1953 -0.065 0.1494 0.4862","LEICA T (Typ 701)":"0.5463 -0.0988 -0.0364 -0.4634 1.2036 0.2946 -0.0766 0.1389 0.6522","LEICA X (Typ 113)":"0.7712 -0.2059 -0.0653 -0.3882 1.1494 0.2726 -0.071 0.1332 0.5958","PENTAX K-1 Mark II":"0.8935 -0.2864 -0.1253 -0.3612 1.2204 0.155 -0.0905 0.1702 0.6346","Panasonic DMC-ZS40":"0.8607 -0.2822 -0.0808 -0.3755 1.193 0.2049 -0.082 0.206 0.5224","Panasonic DMC-CM1":"0.877 -0.3194 -0.082 -0.2871 1.1281 0.1803 -0.0513 0.1552 0.4434","Panasonic DC-G9":"0.7685 -0.2375 -0.0634 -0.3687 1.17 0.2249 -0.0748 0.1546 0.5111","Panasonic DMC-ZS50":"0.8802 -0.3135 -0.0789 -0.3151 1.1468 0.1904 -0.055 0.1745 0.481","Panasonic DMC-GX85":"0.7771 -0.302 -0.0629 -0.4029 1.195 0.2345 -0.0821 0.1977 0.6119","Panasonic DMC-LX9":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Panasonic DC-FZ80":"1.1532 -0.4324 -0.1066 -0.2375 1.0847 0.1749 -0.0564 0.1699 0.4351","Panasonic DMC-FZ300":"0.8378 -0.2798 -0.0769 -0.3068 1.141 0.1877 -0.0538 0.1792 0.4623","Panasonic DMC-GX8":"0.7564 -0.2263 -0.0606 -0.3148 1.1239 0.2177 -0.054 0.1435 0.4853","Panasonic DC-S1RM2":"0.9941 -0.4056 -0.0871 -0.3745 1.1604 0.2433 -0.0254 0.1132 0.5526","Panasonic DC-GH6":"0.7949 -0.3491 -0.071 -0.3435 1.1681 0.1977 -0.0503 0.1622 0.5065","Panasonic DC-S1":"0.9744 -0.3905 -0.0779 -0.4899 1.2807 0.2324 -0.0798 0.163 0.5827","Olympus E-M5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Panasonic DMC-ZS100":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Olympus E-M5 Mark II":"0.9422 -0.3258 -0.0711 -0.2655 1.0898 0.2015 -0.0512 0.1354 0.5512","Panasonic DC-GF9":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-GF7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Olympus PEN-F":"0.9476 -0.3182 -0.0765 -0.2613 1.0958 0.1893 -0.0449 0.1315 0.5268","Panasonic DC-S1H":"0.9397 -0.3719 -0.0805 -0.5425 1.3326 0.2309 -0.0972 0.1715 0.6034","Panasonic DMC-LX100":"0.8844 -0.3538 -0.0768 -0.3709 1.1762 0.22 -0.0698 0.1792 0.522","Panasonic DMC-FZ2500":"0.7386 -0.2443 -0.0743 -0.3437 1.1864 0.1757 -0.0608 0.166 0.4766","Panasonic DC-G99":"0.9657 -0.3963 -0.0748 -0.3361 1.1378 0.2258 -0.0568 0.1415 0.5158","Panasonic DC-LX100M2":"0.8585 -0.3127 -0.0833 -0.4005 1.225 0.1953 -0.065 0.1494 0.4862","Panasonic DC-S1R":"1.1822 -0.5321 -0.1249 -0.5958 1.5114 0.0766 -0.0614 0.1264 0.7043","Panasonic DC-G9M2":"0.8325 -0.3456 -0.0623 -0.433 1.2089 0.2528 -0.086 0.2646 0.5984","Panasonic DC-S9":"0.9983 -0.389 -0.0841 -0.418 1.2164 0.2263 -0.0249 0.1139 0.5766","Panasonic DC-ZS200":"0.779 -0.2736 -0.0755 -0.3452 1.187 0.1769 -0.0628 0.1647 0.4898","Panasonic DC-GX9":"0.7564 -0.2263 -0.0606 -0.3148 1.1239 0.2177 -0.054 0.1435 0.4853","Panasonic DMC-G8":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-ZS60":"0.855 -0.2908 -0.0842 -0.3195 1.1529 0.1881 -0.0338 0.1603 0.4631","Panasonic DC-S1M2":"1.073 -0.4442 -0.0922 -0.4478 1.2504 0.2199 -0.038 0.1198 0.6039","Panasonic DC-GH5S":"0.6929 -0.2355 -0.0708 -0.4192 1.2534 0.1828 -0.1097 0.1989 0.5195","Panasonic DC-S5":"0.9744 -0.3905 -0.0779 -0.4899 1.2807 0.2324 -0.0798 0.163 0.5827","Panasonic DC-GH5M2":"0.93 -0.3659 -0.0755 -0.2981 1.0988 0.2287 -0.019 0.1077 0.5016","Panasonic DC-FZ1000M2":"0.9803 -0.4185 -0.0992 -0.4066 1.2578 0.1628 -0.0838 0.1824 0.5288","Panasonic DC-GH5":"0.7641 -0.2336 -0.0605 -0.3218 1.1299 0.2187 -0.0485 0.1338 0.5121","Panasonic DMC-GX7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Panasonic DMC-LX7":"1.0148 -0.3743 -0.0991 -0.2837 1.1366 0.1659 -0.0701 0.1893 0.4899","Panasonic DC-GH7":"0.8573 -0.3575 -0.0678 -0.4252 1.2079 0.2451 -0.0808 0.2524 0.5936","Panasonic DC-S5M2":"1.0308 -0.4206 -0.0783 -0.4088 1.2102 0.2229 -0.0125 0.1051 0.5912","Panasonic DMC-LF1":"0.9379 -0.3267 -0.0816 -0.3227 1.156 0.1881 -0.0926 0.1928 0.534","Panasonic DMC-G7":"0.761 -0.278 -0.0576 -0.4614 1.2195 0.2733 -0.1375 0.2393 0.649","Olympus E-M1X":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","OM Digital Solutions OM-1":"0.9488 -0.3984 -0.0714 -0.2887 1.0945 0.2229 -0.0137 0.096 0.5786","Olympus E-M10":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M1 Mark III":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus TG-4":"1.1426 -0.4159 -0.1126 -0.2066 1.0678 0.1593 -0.012 0.1327 0.4998","Olympus E-P5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M10 Mark II":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Olympus E-M1":"0.7687 -0.1984 -0.0606 -0.4327 1.1928 0.2721 -0.1381 0.2339 0.6452","Olympus E-PL5":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Panasonic DMC-GM1":"0.677 -0.1895 -0.0744 -0.5232 1.3145 0.2303 -0.1664 0.2691 0.5703","Panasonic DMC-GF6":"0.813 -0.2801 -0.0946 -0.352 1.1289 0.2552 -0.1314 0.2511 0.5791","Panasonic DMC-FZ1000":"0.783 -0.2696 -0.0763 -0.3325 1.1667 0.1866 -0.0641 0.1712 0.4824","Panasonic DMC-GH4":"0.7122 -0.2108 -0.0512 -0.3155 1.1201 0.2231 -0.0541 0.1423 0.5045","Panasonic DMC-GM5":"0.8238 -0.3244 -0.0679 -0.3921 1.1814 0.2384 -0.0836 0.2022 0.5852","OM Digital Solutions OM-5 Mark II":"1.2008 -0.523 -0.1123 -0.2265 1.0496 0.2046 0.0069 0.0734 0.4938",M1:"0.7712 -0.2059 -0.0653 -0.3882 1.1494 0.2726 -0.071 0.1332 0.5958","Olympus XZ-2":"0.9777 -0.3483 -0.0925 -0.2886 1.1297 0.18 -0.0602 0.1663 0.5134","Olympus E-M1 Mark II":"0.9383 -0.317 -0.0763 -0.2457 1.0702 0.202 -0.0384 0.1236 0.5552","Olympus E-PL7":"0.9197 -0.319 -0.0659 -0.2606 1.083 0.2039 -0.0458 0.125 0.5458","OM Digital Solutions OM-5":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus E-M5 Mark III":"1.1896 -0.511 -0.1076 -0.3181 1.1378 0.2048 -0.0519 0.1224 0.5166","Olympus STYLUS 1":"0.836 -0.242 -0.088 -0.3928 1.2353 0.1739 -0.1381 0.2416 0.5173","RICOH GR IV":"0.6428 -0.1485 -0.0814 -0.4614 1.2728 0.2065 -0.0667 0.1489 0.5924","RICOH GR III":"0.6093 -0.1407 -0.0772 -0.4614 1.2728 0.2065 -0.0663 0.1481 0.5892","GR II":"0.4717 -0.085 -0.0431 -0.4977 1.2805 0.2417 -0.0641 0.1474 0.6143","Olympus E-M10 Mark III":"0.838 -0.263 -0.0639 -0.2887 1.0725 0.2496 -0.0627 0.1427 0.5438","Samsung NX1":"1.0686 -0.4042 -0.1052 -0.3595 1.3238 0.0276 -0.0464 0.1259 0.5931","Samsung NX2000":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX500":"1.0686 -0.4042 -0.1052 -0.3595 1.3238 0.0276 -0.0464 0.1259 0.5931","Samsung NX300":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX30":"0.7557 -0.2522 -0.0739 -0.4679 1.2949 0.1894 -0.084 0.1777 0.5311","Samsung NX mini":"0.5222 -0.1196 -0.055 -0.654 1.4649 0.2009 -0.1666 0.2819 0.5657","SIGMA fp L":"1.079 -0.2673 -0.228 -0.6718 1.5773 0.0854 -0.1473 0.2047 0.4597","sd Quattro H":"1.2907 0.0532 -0.3603 0.2957 0.7904 -0.0911 0.0255 0.7093 0.3228","Phase One IQ4 150MP":"0.6644 -0.2257 -0.0804 -0.6459 1.4562 0.2019 -0.1221 0.1876 0.6411","Sony ILCE-7RM4":"0.7662 -0.2686 -0.066 -0.524 1.2965 0.253 -0.0796 0.1508 0.6167","Fujifilm X-E4":"1.3426 -0.6334 -0.1177 -0.4244 1.2136 0.2371 -0.058 0.1303 0.598"};function xh(e,t,r,n=[0,0,0,0],a=65535,i="RGGB",o=null){const l=e*t*2,u=8,d=u+l,f="Fake",h="StretchedNoiseCam",p="StretchedNoiseCam",x=F=>{const O=new Uint8Array(F.length+1);for(let $=0;$<F.length;$++)O[$]=F.charCodeAt($);return O[F.length]=0,O},b=x(f),y=x(h),m=x(p),g=F=>{const O=[0,0,0,0],$={R:0,G:1,B:2},N=F.toUpperCase();for(let C=0;C<4;C++)O[C]=$[N[C]]??1;return O},k=F=>{const O=[];return F.forEach($=>{O.push(Math.round($*1e4)),O.push(1e4)}),O},S=[{id:254,type:4,count:1,value:0},{id:256,type:4,count:1,value:e},{id:257,type:4,count:1,value:t},{id:258,type:3,count:1,value:16},{id:259,type:3,count:1,value:1},{id:262,type:3,count:1,value:32803},{id:271,type:2,count:b.length,value:b},{id:272,type:2,count:y.length,value:y},{id:273,type:4,count:1,value:u},{id:277,type:3,count:1,value:1},{id:278,type:4,count:1,value:t},{id:279,type:4,count:1,value:l},{id:33421,type:3,count:2,value:[2,2]},{id:33422,type:1,count:4,value:g(i)},{id:50706,type:1,count:4,value:[1,4,0,0]},{id:50714,type:3,count:4,value:n.map(F=>Math.round(F))},{id:50715,type:4,count:1,value:Math.round(a)},{id:50717,type:2,count:m.length,value:m}];o&&o.length===9&&(S.push({id:50721,type:10,count:9,value:k(o)}),S.push({id:50778,type:3,count:1,value:21})),S.sort((F,O)=>F.id-O.id);const w=2+S.length*12+4;let v=0;const M=S.map(F=>{let O=1;F.type===3&&(O=2),F.type===4&&(O=4),(F.type===5||F.type===10)&&(O=8);const $=F.count*O,N=$<=4;let C=0;return N||(C=v,v+=$,v%2!==0&&v++),{...F,fits:N,totalBytes:$,extraOffset:C,typeSize:O}}),_=d+w,P=_+v,A=new ArrayBuffer(P),R=new DataView(A),D=new Uint8Array(A);R.setUint16(0,18761,!0),R.setUint16(2,42,!0),R.setUint32(4,d,!0);const E=new Uint8Array(r.buffer,r.byteOffset,r.byteLength);D.set(E,u);let W=d;return R.setUint16(W,S.length,!0),W+=2,M.forEach(F=>{if(R.setUint16(W,F.id,!0),R.setUint16(W+2,F.type,!0),R.setUint32(W+4,F.count,!0),F.fits){const O=W+8;Array.isArray(F.value)?F.value.forEach(($,N)=>{F.type===1&&R.setUint8(O+N,$),F.type===3&&R.setUint16(O+N*2,$,!0)}):(F.type===3&&R.setUint16(O,F.value,!0),F.type===4&&R.setUint32(O,F.value,!0))}else{const O=_+F.extraOffset;R.setUint32(W+8,O,!0),F.value instanceof Uint8Array?D.set(F.value,O):Array.isArray(F.value)&&F.value.forEach(($,N)=>{F.type===1&&R.setUint8(O+N,$),F.type===2&&R.setUint8(O+N,$),F.type===3&&R.setUint16(O+N*2,$,!0),F.type===4&&R.setUint32(O+N*4,$,!0),(F.type===5||F.type===10)&&(F.type===10?R.setInt32(O+N*4,$,!0):R.setUint32(O+N*4,$,!0))})}W+=12}),R.setUint32(W,0,!0),A}var bg=typeof self<"u"?self:global;const sf=typeof navigator<"u",q8=sf&&typeof HTMLImageElement>"u",Vh=!(typeof global>"u"||typeof process>"u"||!process.versions||!process.versions.node),vg=bg.Buffer,D0=bg.BigInt,wg=!!vg,Z8=e=>e;function Hh(e,t=Z8){if(Vh)try{return typeof require=="function"?Promise.resolve(t(require(e))):import(e).then(t)}catch{console.warn(`Couldn't load ${e}`)}}let Tv=bg.fetch;const J8=e=>Tv=e;if(!bg.fetch){const e=Hh("http",n=>n),t=Hh("https",n=>n),r=(n,{headers:a}={})=>new Promise(async(i,o)=>{let{port:s,hostname:l,pathname:u,protocol:d,search:f}=new URL(n);const h={method:"GET",hostname:l,path:encodeURI(u)+f,headers:a};s!==""&&(h.port=Number(s));const p=(d==="https:"?await t:await e).request(h,x=>{if(x.statusCode===301||x.statusCode===302){let b=new URL(x.headers.location,n).toString();return r(b,{headers:a}).then(i).catch(o)}i({status:x.statusCode,arrayBuffer:()=>new Promise(b=>{let y=[];x.on("data",m=>y.push(m)),x.on("end",()=>b(Buffer.concat(y)))})})});p.on("error",o),p.end()});J8(r)}function Nt(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}const Xh=e=>F_(e)?void 0:e,Q8=e=>e!==void 0;function F_(e){return e===void 0||(e instanceof Map?e.size===0:Object.values(e).filter(Q8).length===0)}function Nn(e){let t=new Error(e);throw delete t.stack,t}function dl(e){return(e=function(t){for(;t.endsWith("\0");)t=t.slice(0,-1);return t}(e).trim())===""?void 0:e}function Xy(e){let t=function(r){let n=0;return r.ifd0.enabled&&(n+=1024),r.exif.enabled&&(n+=2048),r.makerNote&&(n+=2048),r.userComment&&(n+=1024),r.gps.enabled&&(n+=512),r.interop.enabled&&(n+=100),r.ifd1.enabled&&(n+=1024),n+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const Ky=e=>String.fromCharCode.apply(null,e),Ck=typeof TextDecoder<"u"?new TextDecoder("utf-8"):void 0;function G_(e){return Ck?Ck.decode(e):wg?Buffer.from(e).toString("utf8"):decodeURIComponent(escape(Ky(e)))}class Oa{static from(t,r){return t instanceof this&&t.le===r?t:new Oa(t,void 0,void 0,r)}constructor(t,r=0,n,a){if(typeof a=="boolean"&&(this.le=a),Array.isArray(t)&&(t=new Uint8Array(t)),t===0)this.byteOffset=0,this.byteLength=0;else if(t instanceof ArrayBuffer){n===void 0&&(n=t.byteLength-r);let i=new DataView(t,r,n);this._swapDataView(i)}else if(t instanceof Uint8Array||t instanceof DataView||t instanceof Oa){n===void 0&&(n=t.byteLength-r),(r+=t.byteOffset)+n>t.byteOffset+t.byteLength&&Nn("Creating view outside of available memory in ArrayBuffer");let i=new DataView(t.buffer,r,n);this._swapDataView(i)}else if(typeof t=="number"){let i=new DataView(new ArrayBuffer(t));this._swapDataView(i)}else Nn("Invalid input argument for BufferView: "+t)}_swapArrayBuffer(t){this._swapDataView(new DataView(t))}_swapBuffer(t){this._swapDataView(new DataView(t.buffer,t.byteOffset,t.byteLength))}_swapDataView(t){this.dataView=t,this.buffer=t.buffer,this.byteOffset=t.byteOffset,this.byteLength=t.byteLength}_lengthToEnd(t){return this.byteLength-t}set(t,r,n=Oa){return t instanceof DataView||t instanceof Oa?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer&&(t=new Uint8Array(t)),t instanceof Uint8Array||Nn("BufferView.set(): Invalid data argument."),this.toUint8().set(t,r),new n(this,r,t.byteLength)}subarray(t,r){return r=r||this._lengthToEnd(t),new Oa(this,t,r)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(t,r){return new Uint8Array(this.buffer,this.byteOffset+t,r)}getString(t=0,r=this.byteLength){return G_(this.getUint8Array(t,r))}getLatin1String(t=0,r=this.byteLength){let n=this.getUint8Array(t,r);return Ky(n)}getUnicodeString(t=0,r=this.byteLength){const n=[];for(let a=0;a<r&&t+a<this.byteLength;a+=2)n.push(this.getUint16(t+a));return Ky(n)}getInt8(t){return this.dataView.getInt8(t)}getUint8(t){return this.dataView.getUint8(t)}getInt16(t,r=this.le){return this.dataView.getInt16(t,r)}getInt32(t,r=this.le){return this.dataView.getInt32(t,r)}getUint16(t,r=this.le){return this.dataView.getUint16(t,r)}getUint32(t,r=this.le){return this.dataView.getUint32(t,r)}getFloat32(t,r=this.le){return this.dataView.getFloat32(t,r)}getFloat64(t,r=this.le){return this.dataView.getFloat64(t,r)}getFloat(t,r=this.le){return this.dataView.getFloat32(t,r)}getDouble(t,r=this.le){return this.dataView.getFloat64(t,r)}getUintBytes(t,r,n){switch(r){case 1:return this.getUint8(t,n);case 2:return this.getUint16(t,n);case 4:return this.getUint32(t,n);case 8:return this.getUint64&&this.getUint64(t,n)}}getUint(t,r,n){switch(r){case 8:return this.getUint8(t,n);case 16:return this.getUint16(t,n);case 32:return this.getUint32(t,n);case 64:return this.getUint64&&this.getUint64(t,n)}}toString(t){return this.dataView.toString(t,this.constructor.name)}ensureChunk(){}}function Yy(e,t){Nn(`${e} '${t}' was not loaded, try using full build of exifr.`)}let Ev=class extends Map{constructor(t){super(),this.kind=t}get(t,r){return this.has(t)||Yy(this.kind,t),r&&(t in r||function(n,a){Nn(`Unknown ${n} '${a}'.`)}(this.kind,t),r[t].enabled||Yy(this.kind,t)),super.get(t)}keyList(){return Array.from(this.keys())}};var no=new Ev("file parser"),Mn=new Ev("segment parser"),oo=new Ev("file reader");function eE(e,t){return typeof e=="string"?Ok(e,t):sf&&!q8&&e instanceof HTMLImageElement?Ok(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new Oa(e):sf&&e instanceof Blob?qy(e,t,"blob",Rl):void Nn("Invalid input argument")}function Ok(e,t){return(r=e).startsWith("data:")||r.length>1e4?Zy(e,t,"base64"):Vh&&e.includes("://")?qy(e,t,"url",Il):Vh?Zy(e,t,"fs"):sf?qy(e,t,"url",Il):void Nn("Invalid input argument");var r}async function qy(e,t,r,n){return oo.has(r)?Zy(e,t,r):n?async function(a,i){let o=await i(a);return new Oa(o)}(e,n):void Nn(`Parser ${r} is not loaded`)}async function Zy(e,t,r){let n=new(oo.get(r))(e,t);return await n.read(),n}const Il=e=>Tv(e).then(t=>t.arrayBuffer()),Rl=e=>new Promise((t,r)=>{let n=new FileReader;n.onloadend=()=>t(n.result||new ArrayBuffer),n.onerror=r,n.readAsArrayBuffer(e)});class tE extends Map{get tagKeys(){return this.allKeys||(this.allKeys=Array.from(this.keys())),this.allKeys}get tagValues(){return this.allValues||(this.allValues=Array.from(this.values())),this.allValues}}function bn(e,t,r){let n=new tE;for(let[a,i]of r)n.set(a,i);if(Array.isArray(t))for(let a of t)e.set(a,n);else e.set(t,n);return n}function Dl(e,t,r){let n,a=e.get(t);for(n of r)a.set(n[0],n[1])}const Vn=new Map,Li=new Map,Ts=new Map,ps=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],Nu=["jfif","xmp","icc","iptc","ihdr"],$l=["tiff",...Nu],fn=["ifd0","ifd1","exif","gps","interop"],gs=[...$l,...fn],ms=["makerNote","userComment"],Cu=["translateKeys","translateValues","reviveValues","multiSegment"],xs=[...Cu,"sanitize","mergeOutput","silentErrors"];class U_{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class sd extends U_{get needed(){return this.enabled||this.deps.size>0}constructor(t,r,n,a){if(super(),Nt(this,"enabled",!1),Nt(this,"skip",new Set),Nt(this,"pick",new Set),Nt(this,"deps",new Set),Nt(this,"translateKeys",!1),Nt(this,"translateValues",!1),Nt(this,"reviveValues",!1),this.key=t,this.enabled=r,this.parse=this.enabled,this.applyInheritables(a),this.canBeFiltered=fn.includes(t),this.canBeFiltered&&(this.dict=Vn.get(t)),n!==void 0)if(Array.isArray(n))this.parse=this.enabled=!0,this.canBeFiltered&&n.length>0&&this.translateTagSet(n,this.pick);else if(typeof n=="object"){if(this.enabled=!0,this.parse=n.parse!==!1,this.canBeFiltered){let{pick:i,skip:o}=n;i&&i.length>0&&this.translateTagSet(i,this.pick),o&&o.length>0&&this.translateTagSet(o,this.skip)}this.applyInheritables(n)}else n===!0||n===!1?this.parse=this.enabled=n:Nn(`Invalid options argument: ${n}`)}applyInheritables(t){let r,n;for(r of Cu)n=t[r],n!==void 0&&(this[r]=n)}translateTagSet(t,r){if(this.dict){let n,a,{tagKeys:i,tagValues:o}=this.dict;for(n of t)typeof n=="string"?(a=o.indexOf(n),a===-1&&(a=i.indexOf(Number(n))),a!==-1&&r.add(Number(i[a]))):r.add(n)}else for(let n of t)r.add(n)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,Kh(this.pick,this.deps)):this.enabled&&this.pick.size>0&&Kh(this.pick,this.deps)}}var pa={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},Ak=new Map;let Hl=class extends U_{static useCached(t){let r=Ak.get(t);return r!==void 0||(r=new this(t),Ak.set(t,r)),r}constructor(t){super(),t===!0?this.setupFromTrue():t===void 0?this.setupFromUndefined():Array.isArray(t)?this.setupFromArray(t):typeof t=="object"?this.setupFromObject(t):Nn(`Invalid options argument ${t}`),this.firstChunkSize===void 0&&(this.firstChunkSize=sf?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let t;for(t of ps)this[t]=pa[t];for(t of xs)this[t]=pa[t];for(t of ms)this[t]=pa[t];for(t of gs)this[t]=new sd(t,pa[t],void 0,this)}setupFromTrue(){let t;for(t of ps)this[t]=pa[t];for(t of xs)this[t]=pa[t];for(t of ms)this[t]=!0;for(t of gs)this[t]=new sd(t,!0,void 0,this)}setupFromArray(t){let r;for(r of ps)this[r]=pa[r];for(r of xs)this[r]=pa[r];for(r of ms)this[r]=pa[r];for(r of gs)this[r]=new sd(r,!1,void 0,this);this.setupGlobalFilters(t,void 0,fn)}setupFromObject(t){let r;for(r of(fn.ifd0=fn.ifd0||fn.image,fn.ifd1=fn.ifd1||fn.thumbnail,Object.assign(this,t),ps))this[r]=ax(t[r],pa[r]);for(r of xs)this[r]=ax(t[r],pa[r]);for(r of ms)this[r]=ax(t[r],pa[r]);for(r of $l)this[r]=new sd(r,pa[r],t[r],this);for(r of fn)this[r]=new sd(r,pa[r],t[r],this.tiff);this.setupGlobalFilters(t.pick,t.skip,fn,gs),t.tiff===!0?this.batchEnableWithBool(fn,!0):t.tiff===!1?this.batchEnableWithUserValue(fn,t):Array.isArray(t.tiff)?this.setupGlobalFilters(t.tiff,void 0,fn):typeof t.tiff=="object"&&this.setupGlobalFilters(t.tiff.pick,t.tiff.skip,fn)}batchEnableWithBool(t,r){for(let n of t)this[n].enabled=r}batchEnableWithUserValue(t,r){for(let n of t){let a=r[n];this[n].enabled=a!==!1&&a!==void 0}}setupGlobalFilters(t,r,n,a=n){if(t&&t.length){for(let o of a)this[o].enabled=!1;let i=Tk(t,n);for(let[o,s]of i)Kh(this[o].pick,s),this[o].enabled=!0}else if(r&&r.length){let i=Tk(r,n);for(let[o,s]of i)Kh(this[o].skip,s)}}filterNestedSegmentTags(){let{ifd0:t,exif:r,xmp:n,iptc:a,icc:i}=this;this.makerNote?r.deps.add(37500):r.skip.add(37500),this.userComment?r.deps.add(37510):r.skip.add(37510),n.enabled||t.skip.add(700),a.enabled||t.skip.add(33723),i.enabled||t.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:t,exif:r,gps:n,interop:a}=this;a.needed&&(r.deps.add(40965),t.deps.add(40965)),r.needed&&t.deps.add(34665),n.needed&&t.deps.add(34853),this.tiff.enabled=fn.some(i=>this[i].enabled===!0)||this.makerNote||this.userComment;for(let i of fn)this[i].finalizeFilters()}get onlyTiff(){return!Nu.map(t=>this[t].enabled).some(t=>t===!0)&&this.tiff.enabled}checkLoadedPlugins(){for(let t of $l)this[t].enabled&&!Mn.has(t)&&Yy("segment parser",t)}};function Tk(e,t){let r,n,a,i,o=[];for(a of t){for(i of(r=Vn.get(a),n=[],r))(e.includes(i[0])||e.includes(i[1]))&&n.push(i[0]);n.length&&o.push([a,n])}return o}function ax(e,t){return e!==void 0?e:t!==void 0?t:void 0}function Kh(e,t){for(let r of t)e.add(r)}Nt(Hl,"default",pa);class Fs{constructor(t){Nt(this,"parsers",{}),Nt(this,"output",{}),Nt(this,"errors",[]),Nt(this,"pushToErrors",r=>this.errors.push(r)),this.options=Hl.useCached(t)}async read(t){this.file=await eE(t,this.options)}setup(){if(this.fileParser)return;let{file:t}=this,r=t.getUint16(0);for(let[n,a]of no)if(a.canHandle(t,r))return this.fileParser=new a(this.options,this.file,this.parsers),t[n]=!0;this.file.close&&this.file.close(),Nn("Unknown file format")}async parse(){let{output:t,errors:r}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),r.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&r.length>0&&(t.errors=r),Xh(t)}async executeParsers(){let{output:t}=this;await this.fileParser.parse();let r=Object.values(this.parsers).map(async n=>{let a=await n.parse();n.assignToOutput(t,a)});this.options.silentErrors&&(r=r.map(n=>n.catch(this.pushToErrors))),await Promise.all(r)}async extractThumbnail(){this.setup();let{options:t,file:r}=this,n=Mn.get("tiff",t);var a;if(r.tiff?a={start:0,type:"tiff"}:r.jpeg&&(a=await this.fileParser.getOrFindSegment("tiff")),a===void 0)return;let i=await this.fileParser.ensureSegmentChunk(a),o=this.parsers.tiff=new n(i,t,r),s=await o.extractThumbnail();return r.close&&r.close(),s}}async function kg(e,t){let r=new Fs(t);return await r.read(e),r.parse()}var rE=Object.freeze({__proto__:null,parse:kg,Exifr:Fs,fileParsers:no,segmentParsers:Mn,fileReaders:oo,tagKeys:Vn,tagValues:Li,tagRevivers:Ts,createDictionary:bn,extendDictionary:Dl,fetchUrlAsArrayBuffer:Il,readBlobAsArrayBuffer:Rl,chunkedProps:ps,otherSegments:Nu,segments:$l,tiffBlocks:fn,segmentsAndBlocks:gs,tiffExtractables:ms,inheritables:Cu,allFormatters:xs,Options:Hl});class Sg{constructor(t,r,n){Nt(this,"errors",[]),Nt(this,"ensureSegmentChunk",async a=>{let i=a.start,o=a.size||65536;if(this.file.chunked)if(this.file.available(i,o))a.chunk=this.file.subarray(i,o);else try{a.chunk=await this.file.readChunk(i,o)}catch(s){Nn(`Couldn't read segment: ${JSON.stringify(a)}. ${s.message}`)}else this.file.byteLength>i+o?a.chunk=this.file.subarray(i,o):a.size===void 0?a.chunk=this.file.subarray(i):Nn("Segment unreachable: "+JSON.stringify(a));return a.chunk}),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=r,this.parsers=n}injectSegment(t,r){this.options[t].enabled&&this.createParser(t,r)}createParser(t,r){let n=new(Mn.get(t))(r,this.options,this.file);return this.parsers[t]=n}createParsers(t){for(let r of t){let{type:n,chunk:a}=r,i=this.options[n];if(i&&i.enabled){let o=this.parsers[n];o&&o.append||o||this.createParser(n,a)}}}async readSegments(t){let r=t.map(this.ensureSegmentChunk);await Promise.all(r)}}let Ai=class{static findPosition(t,r){let n=t.getUint16(r+2)+2,a=typeof this.headerLength=="function"?this.headerLength(t,r,n):this.headerLength,i=r+a,o=n-a;return{offset:r,length:n,headerLength:a,start:i,size:o,end:i+o}}static parse(t,r={}){return new this(t,new Hl({[this.type]:r}),t).parse()}normalizeInput(t){return t instanceof Oa?t:new Oa(t)}constructor(t,r={},n){Nt(this,"errors",[]),Nt(this,"raw",new Map),Nt(this,"handleError",a=>{if(!this.options.silentErrors)throw a;this.errors.push(a.message)}),this.chunk=this.normalizeInput(t),this.file=n,this.type=this.constructor.type,this.globalOptions=this.options=r,this.localOptions=r[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(t,r){let n=Ts.get(r),a=Li.get(r),i=Vn.get(r),o=this.options[r],s=o.reviveValues&&!!n,l=o.translateValues&&!!a,u=o.translateKeys&&!!i,d={};for(let[f,h]of t)s&&n.has(f)?h=n.get(f)(h):l&&a.has(f)&&(h=this.translateValue(h,a.get(f))),u&&i.has(f)&&(f=i.get(f)||f),d[f]=h;return d}translateValue(t,r){return r[t]||r.DEFAULT||t}assignToOutput(t,r){this.assignObjectToOutput(t,this.constructor.type,r)}assignObjectToOutput(t,r,n){if(this.globalOptions.mergeOutput)return Object.assign(t,n);t[r]?Object.assign(t[r],n):t[r]=n}};Nt(Ai,"headerLength",4),Nt(Ai,"type",void 0),Nt(Ai,"multiSegment",!1),Nt(Ai,"canHandle",()=>!1);function nE(e){return e===192||e===194||e===196||e===219||e===221||e===218||e===254}function aE(e){return e>=224&&e<=239}function iE(e,t,r){for(let[n,a]of Mn)if(a.canHandle(e,t,r))return n}class Ek extends Sg{constructor(...t){super(...t),Nt(this,"appSegments",[]),Nt(this,"jpegSegments",[]),Nt(this,"unknownSegments",[])}static canHandle(t,r){return r===65496}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(t){t===!0?(this.findAll=!0,this.wanted=new Set(Mn.keyList())):(t=t===void 0?Mn.keyList().filter(r=>this.options[r].enabled):t.filter(r=>this.options[r].enabled&&Mn.has(r)),this.findAll=!1,this.remaining=new Set(t),this.wanted=new Set(t)),this.unfinishedMultiSegment=!1}async findAppSegments(t=0,r){this.setupSegmentFinderArgs(r);let{file:n,findAll:a,wanted:i,remaining:o}=this;if(!a&&this.file.chunked&&(a=Array.from(i).some(s=>{let l=Mn.get(s),u=this.options[s];return l.multiSegment&&u.multiSegment}),a&&await this.file.readWhole()),t=this.findAppSegmentsInRange(t,n.byteLength),!this.options.onlyTiff&&n.chunked){let s=!1;for(;o.size>0&&!s&&(n.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:l}=n,u=this.appSegments.some(d=>!this.file.available(d.offset||d.start,d.length||d.size));if(s=t>l&&!u?!await n.readNextChunk(t):!await n.readNextChunk(l),(t=this.findAppSegmentsInRange(t,n.byteLength))===void 0)return}}}findAppSegmentsInRange(t,r){r-=2;let n,a,i,o,s,l,{file:u,findAll:d,wanted:f,remaining:h,options:p}=this;for(;t<r;t++)if(u.getUint8(t)===255){if(n=u.getUint8(t+1),aE(n)){if(a=u.getUint16(t+2),i=iE(u,t,a),i&&f.has(i)&&(o=Mn.get(i),s=o.findPosition(u,t),l=p[i],s.type=i,this.appSegments.push(s),!d&&(o.multiSegment&&l.multiSegment?(this.unfinishedMultiSegment=s.chunkNumber<s.chunkCount,this.unfinishedMultiSegment||h.delete(i)):h.delete(i),h.size===0)))break;p.recordUnknownSegments&&(s=Ai.findPosition(u,t),s.marker=n,this.unknownSegments.push(s)),t+=a+1}else if(nE(n)){if(a=u.getUint16(t+2),n===218&&p.stopAfterSos!==!1)return;p.recordJpegSegments&&this.jpegSegments.push({offset:t,length:a,marker:n}),t+=a+1}}return t}mergeMultiSegments(){if(!this.appSegments.some(r=>r.multiSegment))return;let t=function(r,n){let a,i,o,s=new Map;for(let l=0;l<r.length;l++)a=r[l],i=a[n],s.has(i)?o=s.get(i):s.set(i,o=[]),o.push(a);return Array.from(s)}(this.appSegments,"type");this.mergedAppSegments=t.map(([r,n])=>{let a=Mn.get(r,this.options);return a.handleMultiSegments?{type:r,chunk:a.handleMultiSegments(n)}:n[0]})}getSegment(t){return this.appSegments.find(r=>r.type===t)}async getOrFindSegment(t){let r=this.getSegment(t);return r===void 0&&(await this.findAppSegments(0,[t]),r=this.getSegment(t)),r}}Nt(Ek,"type","jpeg"),no.set("jpeg",Ek);const oE=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class sE extends Ai{parseHeader(){var t=this.chunk.getUint16();t===18761?this.le=!0:t===19789&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(t,r,n=new Map){let{pick:a,skip:i}=this.options[r];a=new Set(a);let o=a.size>0,s=i.size===0,l=this.chunk.getUint16(t);t+=2;for(let u=0;u<l;u++){let d=this.chunk.getUint16(t);if(o){if(a.has(d)&&(n.set(d,this.parseTag(t,d,r)),a.delete(d),a.size===0))break}else!s&&i.has(d)||n.set(d,this.parseTag(t,d,r));t+=12}return n}parseTag(t,r,n){let{chunk:a}=this,i=a.getUint16(t+2),o=a.getUint32(t+4),s=oE[i];if(s*o<=4?t+=8:t=a.getUint32(t+8),(i<1||i>13)&&Nn(`Invalid TIFF value type. block: ${n.toUpperCase()}, tag: ${r.toString(16)}, type: ${i}, offset ${t}`),t>a.byteLength&&Nn(`Invalid TIFF value offset. block: ${n.toUpperCase()}, tag: ${r.toString(16)}, type: ${i}, offset ${t} is outside of chunk size ${a.byteLength}`),i===1)return a.getUint8Array(t,o);if(i===2)return dl(a.getString(t,o));if(i===7)return a.getUint8Array(t,o);if(o===1)return this.parseTagValue(i,t);{let l=new(function(d){switch(d){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 10:return Array;case 11:return Float32Array;case 12:return Float64Array;default:return Array}}(i))(o),u=s;for(let d=0;d<o;d++)l[d]=this.parseTagValue(i,t),t+=u;return l}}parseTagValue(t,r){let{chunk:n}=this;switch(t){case 1:return n.getUint8(r);case 3:return n.getUint16(r);case 4:return n.getUint32(r);case 5:return n.getUint32(r)/n.getUint32(r+4);case 6:return n.getInt8(r);case 8:return n.getInt16(r);case 9:return n.getInt32(r);case 10:return n.getInt32(r)/n.getInt32(r+4);case 11:return n.getFloat(r);case 12:return n.getDouble(r);case 13:return n.getUint32(r);default:Nn(`Invalid tiff type ${t}`)}}}class ix extends sE{static canHandle(t,r){return t.getUint8(r+1)===225&&t.getUint32(r+4)===1165519206&&t.getUint16(r+8)===0}async parse(){this.parseHeader();let{options:t}=this;return t.ifd0.enabled&&await this.parseIfd0Block(),t.exif.enabled&&await this.safeParse("parseExifBlock"),t.gps.enabled&&await this.safeParse("parseGpsBlock"),t.interop.enabled&&await this.safeParse("parseInteropBlock"),t.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(t){let r=this[t]();return r.catch!==void 0&&(r=r.catch(this.handleError)),r}findIfd0Offset(){this.ifd0Offset===void 0&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(this.ifd1Offset===void 0){this.findIfd0Offset();let t=this.chunk.getUint16(this.ifd0Offset),r=this.ifd0Offset+2+12*t;this.ifd1Offset=this.chunk.getUint32(r)}}parseBlock(t,r){let n=new Map;return this[r]=n,this.parseTags(t,r,n),n}async parseIfd0Block(){if(this.ifd0)return;let{file:t}=this;this.findIfd0Offset(),this.ifd0Offset<8&&Nn("Malformed EXIF data"),!t.chunked&&this.ifd0Offset>t.byteLength&&Nn(`IFD0 offset points to outside of file.
this.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${t.byteLength}`),t.tiff&&await t.ensureChunk(this.ifd0Offset,Xy(this.options));let r=this.parseBlock(this.ifd0Offset,"ifd0");return r.size!==0?(this.exifOffset=r.get(34665),this.interopOffset=r.get(40965),this.gpsOffset=r.get(34853),this.xmp=r.get(700),this.iptc=r.get(33723),this.icc=r.get(34675),this.options.sanitize&&(r.delete(34665),r.delete(40965),r.delete(34853),r.delete(700),r.delete(33723),r.delete(34675)),r):void 0}async parseExifBlock(){if(this.exif||(this.ifd0||await this.parseIfd0Block(),this.exifOffset===void 0))return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,Xy(this.options));let t=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=t.get(40965)),this.makerNote=t.get(37500),this.userComment=t.get(37510),this.options.sanitize&&(t.delete(40965),t.delete(37500),t.delete(37510)),this.unpack(t,41728),this.unpack(t,41729),t}unpack(t,r){let n=t.get(r);n&&n.length===1&&t.set(r,n[0])}async parseGpsBlock(){if(this.gps||(this.ifd0||await this.parseIfd0Block(),this.gpsOffset===void 0))return;let t=this.parseBlock(this.gpsOffset,"gps");return t&&t.has(2)&&t.has(4)&&(t.set("latitude",Ik(...t.get(2),t.get(1))),t.set("longitude",Ik(...t.get(4),t.get(3)))),t}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),this.interopOffset!==void 0||this.exif||await this.parseExifBlock(),this.interopOffset!==void 0))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(t=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||t))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),this.ifd1===void 0)return;let t=this.ifd1.get(513),r=this.ifd1.get(514);return this.chunk.getUint8Array(t,r)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let t,r,n,a={};for(r of fn)if(t=this[r],!F_(t))if(n=this.canTranslate?this.translateBlock(t,r):Object.fromEntries(t),this.options.mergeOutput){if(r==="ifd1")continue;Object.assign(a,n)}else a[r]=n;return this.makerNote&&(a.makerNote=this.makerNote),this.userComment&&(a.userComment=this.userComment),a}assignToOutput(t,r){if(this.globalOptions.mergeOutput)Object.assign(t,r);else for(let[n,a]of Object.entries(r))this.assignObjectToOutput(t,n,a)}}function Ik(e,t,r,n){var a=e+t/60+r/3600;return n!=="S"&&n!=="W"||(a*=-1),a}Nt(ix,"type","tiff"),Nt(ix,"headerLength",10),Mn.set("tiff",ix);var lE=Object.freeze({__proto__:null,default:rE,Exifr:Fs,fileParsers:no,segmentParsers:Mn,fileReaders:oo,tagKeys:Vn,tagValues:Li,tagRevivers:Ts,createDictionary:bn,extendDictionary:Dl,fetchUrlAsArrayBuffer:Il,readBlobAsArrayBuffer:Rl,chunkedProps:ps,otherSegments:Nu,segments:$l,tiffBlocks:fn,segmentsAndBlocks:gs,tiffExtractables:ms,inheritables:Cu,allFormatters:xs,Options:Hl,parse:kg});const Iv={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1},Rv=Object.assign({},Iv,{firstChunkSize:4e4,gps:[1,2,3,4]});async function z_(e){let t=new Fs(Rv);await t.read(e);let r=await t.parse();if(r&&r.gps){let{latitude:n,longitude:a}=r.gps;return{latitude:n,longitude:a}}}const Dv=Object.assign({},Iv,{tiff:!1,ifd1:!0,mergeOutput:!1});async function W_(e){let t=new Fs(Dv);await t.read(e);let r=await t.extractThumbnail();return r&&wg?vg.from(r):r}async function V_(e){let t=await this.thumbnail(e);if(t!==void 0){let r=new Blob([t]);return URL.createObjectURL(r)}}const $v=Object.assign({},Iv,{firstChunkSize:4e4,ifd0:[274]});async function Lv(e){let t=new Fs($v);await t.read(e);let r=await t.parse();if(r&&r.ifd0)return r.ifd0[274]}const Bv=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let fl=!0,hl=!0;if(typeof navigator=="object"){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,r,n]=t;fl=Number(r)+.1*Number(n)<13.4,hl=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);fl=hl=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);fl=hl=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);fl=hl=Number(t)<77}}async function H_(e){let t=await Lv(e);return Object.assign({canvas:fl,css:hl},Bv[t])}class cE extends Oa{constructor(...t){super(...t),Nt(this,"ranges",new uE),this.byteLength!==0&&this.ranges.add(0,this.byteLength)}_tryExtend(t,r,n){if(t===0&&this.byteLength===0&&n){let a=new DataView(n.buffer||n,n.byteOffset,n.byteLength);this._swapDataView(a)}else{let a=t+r;if(a>this.byteLength){let{dataView:i}=this._extend(a);this._swapDataView(i)}}}_extend(t){let r;r=wg?vg.allocUnsafe(t):new Uint8Array(t);let n=new DataView(r.buffer,r.byteOffset,r.byteLength);return r.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:r,dataView:n}}subarray(t,r,n=!1){return r=r||this._lengthToEnd(t),n&&this._tryExtend(t,r),this.ranges.add(t,r),super.subarray(t,r)}set(t,r,n=!1){n&&this._tryExtend(r,t.byteLength,t);let a=super.set(t,r);return this.ranges.add(r,a.byteLength),a}async ensureChunk(t,r){this.chunked&&(this.ranges.available(t,r)||await this.readChunk(t,r))}available(t,r){return this.ranges.available(t,r)}}class uE{constructor(){Nt(this,"list",[])}get length(){return this.list.length}add(t,r,n=0){let a=t+r,i=this.list.filter(o=>Rk(t,o.offset,a)||Rk(t,o.end,a));if(i.length>0){t=Math.min(t,...i.map(s=>s.offset)),a=Math.max(a,...i.map(s=>s.end)),r=a-t;let o=i.shift();o.offset=t,o.length=r,o.end=a,this.list=this.list.filter(s=>!i.includes(s))}else this.list.push({offset:t,length:r,end:a})}available(t,r){let n=t+r;return this.list.some(a=>a.offset<=t&&n<=a.end)}}function Rk(e,t,r){return e<=t&&t<=r}class jg extends cE{constructor(t,r){super(0),Nt(this,"chunksRead",0),this.input=t,this.options=r}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(t=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let r=this.options.chunkSize,n=await this.readChunk(t,r);return!!n&&n.byteLength===r}async readChunk(t,r){if(this.chunksRead++,(r=this.safeWrapAddress(t,r))!==0)return this._readChunk(t,r)}safeWrapAddress(t,r){return this.size!==void 0&&t+r>this.size?Math.max(0,this.size-t):r}get nextChunkOffset(){if(this.ranges.list.length!==0)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return this.size!==void 0&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}oo.set("blob",class extends jg{async readWhole(){this.chunked=!1;let e=await Rl(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let r=t?e+t:void 0,n=this.input.slice(e,r),a=await Rl(n);return this.set(a,e,!0)}});var dE=Object.freeze({__proto__:null,default:lE,Exifr:Fs,fileParsers:no,segmentParsers:Mn,fileReaders:oo,tagKeys:Vn,tagValues:Li,tagRevivers:Ts,createDictionary:bn,extendDictionary:Dl,fetchUrlAsArrayBuffer:Il,readBlobAsArrayBuffer:Rl,chunkedProps:ps,otherSegments:Nu,segments:$l,tiffBlocks:fn,segmentsAndBlocks:gs,tiffExtractables:ms,inheritables:Cu,allFormatters:xs,Options:Hl,parse:kg,gpsOnlyOptions:Rv,gps:z_,thumbnailOnlyOptions:Dv,thumbnail:W_,thumbnailUrl:V_,orientationOnlyOptions:$v,orientation:Lv,rotations:Bv,get rotateCanvas(){return fl},get rotateCss(){return hl},rotation:H_});oo.set("url",class extends jg{async readWhole(){this.chunked=!1;let e=await Il(this.input);e instanceof ArrayBuffer?this._swapArrayBuffer(e):e instanceof Uint8Array&&this._swapBuffer(e)}async _readChunk(e,t){let r=t?e+t-1:void 0,n=this.options.httpHeaders||{};(e||r)&&(n.range=`bytes=${[e,r].join("-")}`);let a=await Tv(this.input,{headers:n}),i=await a.arrayBuffer(),o=i.byteLength;if(a.status!==416)return o!==t&&(this.size=e+o),this.set(i,e,!0)}});Oa.prototype.getUint64=function(e){let t=this.getUint32(e),r=this.getUint32(e+4);return t<1048575?t<<32|r:typeof D0!==void 0?(console.warn("Using BigInt because of type 64uint but JS can only handle 53b numbers."),D0(t)<<D0(32)|D0(r)):void Nn("Trying to read 64b value but JS can only handle 53b numbers.")};class fE extends Sg{parseBoxes(t=0){let r=[];for(;t<this.file.byteLength-4;){let n=this.parseBoxHead(t);if(r.push(n),n.length===0)break;t+=n.length}return r}parseSubBoxes(t){t.boxes=this.parseBoxes(t.start)}findBox(t,r){return t.boxes===void 0&&this.parseSubBoxes(t),t.boxes.find(n=>n.kind===r)}parseBoxHead(t){let r=this.file.getUint32(t),n=this.file.getString(t+4,4),a=t+8;return r===1&&(r=this.file.getUint64(t+8),a+=8),{offset:t,length:r,kind:n,start:a}}parseBoxFullHead(t){if(t.version!==void 0)return;let r=this.file.getUint32(t.start);t.version=r>>24,t.start+=4}}class X_ extends fE{static canHandle(t,r){if(r!==0)return!1;let n=t.getUint16(2);if(n>50)return!1;let a=16,i=[];for(;a<n;)i.push(t.getString(a,4)),a+=4;return i.includes(this.type)}async parse(){let t=this.file.getUint32(0),r=this.parseBoxHead(t);for(;r.kind!=="meta";)t+=r.length,await this.file.ensureChunk(t,16),r=this.parseBoxHead(t);await this.file.ensureChunk(r.offset,r.length),this.parseBoxFullHead(r),this.parseSubBoxes(r),this.options.icc.enabled&&await this.findIcc(r),this.options.tiff.enabled&&await this.findExif(r)}async registerSegment(t,r,n){await this.file.ensureChunk(r,n);let a=this.file.subarray(r,n);this.createParser(t,a)}async findIcc(t){let r=this.findBox(t,"iprp");if(r===void 0)return;let n=this.findBox(r,"ipco");if(n===void 0)return;let a=this.findBox(n,"colr");a!==void 0&&await this.registerSegment("icc",a.offset+12,a.length)}async findExif(t){let r=this.findBox(t,"iinf");if(r===void 0)return;let n=this.findBox(t,"iloc");if(n===void 0)return;let a=this.findExifLocIdInIinf(r),i=this.findExtentInIloc(n,a);if(i===void 0)return;let[o,s]=i;await this.file.ensureChunk(o,s);let l=4+this.file.getUint32(o);o+=l,s-=l,await this.registerSegment("tiff",o,s)}findExifLocIdInIinf(t){this.parseBoxFullHead(t);let r,n,a,i,o=t.start,s=this.file.getUint16(o);for(o+=2;s--;){if(r=this.parseBoxHead(o),this.parseBoxFullHead(r),n=r.start,r.version>=2&&(a=r.version===3?4:2,i=this.file.getString(n+a+2,4),i==="Exif"))return this.file.getUintBytes(n,a);o+=r.length}}get8bits(t){let r=this.file.getUint8(t);return[r>>4,15&r]}findExtentInIloc(t,r){this.parseBoxFullHead(t);let n=t.start,[a,i]=this.get8bits(n++),[o,s]=this.get8bits(n++),l=t.version===2?4:2,u=t.version===1||t.version===2?2:0,d=s+a+i,f=t.version===2?4:2,h=this.file.getUintBytes(n,f);for(n+=f;h--;){let p=this.file.getUintBytes(n,l);n+=l+u+2+o;let x=this.file.getUint16(n);if(n+=2,p===r)return x>1&&console.warn(`ILOC box has more than one extent but we're only processing one
Please create an issue at https://github.com/MikeKovarik/exifr with this file`),[this.file.getUintBytes(n+s,a),this.file.getUintBytes(n+s+a,i)];n+=x*d}}}class K_ extends X_{}Nt(K_,"type","heic");class Dk extends X_{}Nt(Dk,"type","avif"),no.set("heic",K_),no.set("avif",Dk),bn(Vn,["ifd0","ifd1"],[[256,"ImageWidth"],[257,"ImageHeight"],[258,"BitsPerSample"],[259,"Compression"],[262,"PhotometricInterpretation"],[270,"ImageDescription"],[271,"Make"],[272,"Model"],[273,"StripOffsets"],[274,"Orientation"],[277,"SamplesPerPixel"],[278,"RowsPerStrip"],[279,"StripByteCounts"],[282,"XResolution"],[283,"YResolution"],[284,"PlanarConfiguration"],[296,"ResolutionUnit"],[301,"TransferFunction"],[305,"Software"],[306,"ModifyDate"],[315,"Artist"],[316,"HostComputer"],[317,"Predictor"],[318,"WhitePoint"],[319,"PrimaryChromaticities"],[513,"ThumbnailOffset"],[514,"ThumbnailLength"],[529,"YCbCrCoefficients"],[530,"YCbCrSubSampling"],[531,"YCbCrPositioning"],[532,"ReferenceBlackWhite"],[700,"ApplicationNotes"],[33432,"Copyright"],[33723,"IPTC"],[34665,"ExifIFD"],[34675,"ICC"],[34853,"GpsIFD"],[330,"SubIFD"],[40965,"InteropIFD"],[40091,"XPTitle"],[40092,"XPComment"],[40093,"XPAuthor"],[40094,"XPKeywords"],[40095,"XPSubject"]]),bn(Vn,"exif",[[33434,"ExposureTime"],[33437,"FNumber"],[34850,"ExposureProgram"],[34852,"SpectralSensitivity"],[34855,"ISO"],[34858,"TimeZoneOffset"],[34859,"SelfTimerMode"],[34864,"SensitivityType"],[34865,"StandardOutputSensitivity"],[34866,"RecommendedExposureIndex"],[34867,"ISOSpeed"],[34868,"ISOSpeedLatitudeyyy"],[34869,"ISOSpeedLatitudezzz"],[36864,"ExifVersion"],[36867,"DateTimeOriginal"],[36868,"CreateDate"],[36873,"GooglePlusUploadCode"],[36880,"OffsetTime"],[36881,"OffsetTimeOriginal"],[36882,"OffsetTimeDigitized"],[37121,"ComponentsConfiguration"],[37122,"CompressedBitsPerPixel"],[37377,"ShutterSpeedValue"],[37378,"ApertureValue"],[37379,"BrightnessValue"],[37380,"ExposureCompensation"],[37381,"MaxApertureValue"],[37382,"SubjectDistance"],[37383,"MeteringMode"],[37384,"LightSource"],[37385,"Flash"],[37386,"FocalLength"],[37393,"ImageNumber"],[37394,"SecurityClassification"],[37395,"ImageHistory"],[37396,"SubjectArea"],[37500,"MakerNote"],[37510,"UserComment"],[37520,"SubSecTime"],[37521,"SubSecTimeOriginal"],[37522,"SubSecTimeDigitized"],[37888,"AmbientTemperature"],[37889,"Humidity"],[37890,"Pressure"],[37891,"WaterDepth"],[37892,"Acceleration"],[37893,"CameraElevationAngle"],[40960,"FlashpixVersion"],[40961,"ColorSpace"],[40962,"ExifImageWidth"],[40963,"ExifImageHeight"],[40964,"RelatedSoundFile"],[41483,"FlashEnergy"],[41486,"FocalPlaneXResolution"],[41487,"FocalPlaneYResolution"],[41488,"FocalPlaneResolutionUnit"],[41492,"SubjectLocation"],[41493,"ExposureIndex"],[41495,"SensingMethod"],[41728,"FileSource"],[41729,"SceneType"],[41730,"CFAPattern"],[41985,"CustomRendered"],[41986,"ExposureMode"],[41987,"WhiteBalance"],[41988,"DigitalZoomRatio"],[41989,"FocalLengthIn35mmFormat"],[41990,"SceneCaptureType"],[41991,"GainControl"],[41992,"Contrast"],[41993,"Saturation"],[41994,"Sharpness"],[41996,"SubjectDistanceRange"],[42016,"ImageUniqueID"],[42032,"OwnerName"],[42033,"SerialNumber"],[42034,"LensInfo"],[42035,"LensMake"],[42036,"LensModel"],[42037,"LensSerialNumber"],[42080,"CompositeImage"],[42081,"CompositeImageCount"],[42082,"CompositeImageExposureTimes"],[42240,"Gamma"],[59932,"Padding"],[59933,"OffsetSchema"],[65e3,"OwnerName"],[65001,"SerialNumber"],[65002,"Lens"],[65100,"RawFile"],[65101,"Converter"],[65102,"WhiteBalance"],[65105,"Exposure"],[65106,"Shadows"],[65107,"Brightness"],[65108,"Contrast"],[65109,"Saturation"],[65110,"Sharpness"],[65111,"Smoothness"],[65112,"MoireFilter"],[40965,"InteropIFD"]]),bn(Vn,"gps",[[0,"GPSVersionID"],[1,"GPSLatitudeRef"],[2,"GPSLatitude"],[3,"GPSLongitudeRef"],[4,"GPSLongitude"],[5,"GPSAltitudeRef"],[6,"GPSAltitude"],[7,"GPSTimeStamp"],[8,"GPSSatellites"],[9,"GPSStatus"],[10,"GPSMeasureMode"],[11,"GPSDOP"],[12,"GPSSpeedRef"],[13,"GPSSpeed"],[14,"GPSTrackRef"],[15,"GPSTrack"],[16,"GPSImgDirectionRef"],[17,"GPSImgDirection"],[18,"GPSMapDatum"],[19,"GPSDestLatitudeRef"],[20,"GPSDestLatitude"],[21,"GPSDestLongitudeRef"],[22,"GPSDestLongitude"],[23,"GPSDestBearingRef"],[24,"GPSDestBearing"],[25,"GPSDestDistanceRef"],[26,"GPSDestDistance"],[27,"GPSProcessingMethod"],[28,"GPSAreaInformation"],[29,"GPSDateStamp"],[30,"GPSDifferential"],[31,"GPSHPositioningError"]]),bn(Li,["ifd0","ifd1"],[[274,{1:"Horizontal (normal)",2:"Mirror horizontal",3:"Rotate 180",4:"Mirror vertical",5:"Mirror horizontal and rotate 270 CW",6:"Rotate 90 CW",7:"Mirror horizontal and rotate 90 CW",8:"Rotate 270 CW"}],[296,{1:"None",2:"inches",3:"cm"}]]);let Rd=bn(Li,"exif",[[34850,{0:"Not defined",1:"Manual",2:"Normal program",3:"Aperture priority",4:"Shutter priority",5:"Creative program",6:"Action program",7:"Portrait mode",8:"Landscape mode"}],[37121,{0:"-",1:"Y",2:"Cb",3:"Cr",4:"R",5:"G",6:"B"}],[37383,{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"}],[37384,{0:"Unknown",1:"Daylight",2:"Fluorescent",3:"Tungsten (incandescent light)",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 - 5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"}],[37385,{0:"Flash did not fire",1:"Flash fired",5:"Strobe return light not detected",7:"Strobe return light detected",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"}],[41495,{1:"Not defined",2:"One-chip color area sensor",3:"Two-chip color area sensor",4:"Three-chip color area sensor",5:"Color sequential area sensor",7:"Trilinear sensor",8:"Color sequential linear sensor"}],[41728,{1:"Film Scanner",2:"Reflection Print Scanner",3:"Digital Camera"}],[41729,{1:"Directly photographed"}],[41985,{0:"Normal",1:"Custom",2:"HDR (no original saved)",3:"HDR (original saved)",4:"Original (for HDR)",6:"Panorama",7:"Portrait HDR",8:"Portrait"}],[41986,{0:"Auto",1:"Manual",2:"Auto bracket"}],[41987,{0:"Auto",1:"Manual"}],[41990,{0:"Standard",1:"Landscape",2:"Portrait",3:"Night",4:"Other"}],[41991,{0:"None",1:"Low gain up",2:"High gain up",3:"Low gain down",4:"High gain down"}],[41996,{0:"Unknown",1:"Macro",2:"Close",3:"Distant"}],[42080,{0:"Unknown",1:"Not a Composite Image",2:"General Composite Image",3:"Composite Image Captured While Shooting"}]]);const $k={1:"No absolute unit of measurement",2:"Inch",3:"Centimeter"};Rd.set(37392,$k),Rd.set(41488,$k);const ox={0:"Normal",1:"Low",2:"High"};function Lk(e){return typeof e=="object"&&e.length!==void 0?e[0]:e}function Bk(e){let t=Array.from(e).slice(1);return t[1]>15&&(t=t.map(r=>String.fromCharCode(r))),t[2]!=="0"&&t[2]!==0||t.pop(),t.join(".")}function sx(e){if(typeof e=="string"){var[t,r,n,a,i,o]=e.trim().split(/[-: ]/g).map(Number),s=new Date(t,r-1,n);return Number.isNaN(a)||Number.isNaN(i)||Number.isNaN(o)||(s.setHours(a),s.setMinutes(i),s.setSeconds(o)),Number.isNaN(+s)?e:s}}function ld(e){if(typeof e=="string")return e;let t=[];if(e[1]===0&&e[e.length-1]===0)for(let r=0;r<e.length;r+=2)t.push(Fk(e[r+1],e[r]));else for(let r=0;r<e.length;r+=2)t.push(Fk(e[r],e[r+1]));return dl(String.fromCodePoint(...t))}function Fk(e,t){return e<<8|t}Rd.set(41992,ox),Rd.set(41993,ox),Rd.set(41994,ox),bn(Ts,["ifd0","ifd1"],[[50827,function(e){return typeof e!="string"?G_(e):e}],[306,sx],[40091,ld],[40092,ld],[40093,ld],[40094,ld],[40095,ld]]),bn(Ts,"exif",[[40960,Bk],[36864,Bk],[36867,sx],[36868,sx],[40962,Lk],[40963,Lk]]),bn(Ts,"gps",[[0,e=>Array.from(e).join(".")],[7,e=>Array.from(e).join(":")]]);class lx extends Ai{static canHandle(t,r){return t.getUint8(r+1)===225&&t.getUint32(r+4)===1752462448&&t.getString(r+4,20)==="http://ns.adobe.com/"}static headerLength(t,r){return t.getString(r+4,34)==="http://ns.adobe.com/xmp/extension/"?79:33}static findPosition(t,r){let n=super.findPosition(t,r);return n.multiSegment=n.extended=n.headerLength===79,n.multiSegment?(n.chunkCount=t.getUint8(r+72),n.chunkNumber=t.getUint8(r+76),t.getUint8(r+77)!==0&&n.chunkNumber++):(n.chunkCount=1/0,n.chunkNumber=-1),n}static handleMultiSegments(t){return t.map(r=>r.chunk.getString()).join("")}normalizeInput(t){return typeof t=="string"?t:Oa.from(t).getString()}parse(t=this.chunk){if(!this.localOptions.parse)return t;t=function(i){let o={},s={};for(let l of J_)o[l]=[],s[l]=0;return i.replace(mE,(l,u,d)=>{if(u==="<"){let f=++s[d];return o[d].push(f),`${l}#${f}`}return`${l}#${o[d].pop()}`})}(t);let r=$c.findAll(t,"rdf","Description");r.length===0&&r.push(new $c("rdf","Description",void 0,t));let n,a={};for(let i of r)for(let o of i.properties)n=gE(o.ns,a),Y_(o,n);return function(i){let o;for(let s in i)o=i[s]=Xh(i[s]),o===void 0&&delete i[s];return Xh(i)}(a)}assignToOutput(t,r){if(this.localOptions.parse)for(let[n,a]of Object.entries(r))switch(n){case"tiff":this.assignObjectToOutput(t,"ifd0",a);break;case"exif":this.assignObjectToOutput(t,"exif",a);break;case"xmlns":break;default:this.assignObjectToOutput(t,n,a)}else t.xmp=r}}Nt(lx,"type","xmp"),Nt(lx,"multiSegment",!0),Mn.set("xmp",lx);class Yh{static findAll(t){return q_(t,/([a-zA-Z0-9-]+):([a-zA-Z0-9-]+)=("[^"]*"|'[^']*')/gm).map(Yh.unpackMatch)}static unpackMatch(t){let r=t[1],n=t[2],a=t[3].slice(1,-1);return a=Z_(a),new Yh(r,n,a)}constructor(t,r,n){this.ns=t,this.name=r,this.value=n}serialize(){return this.value}}class $c{static findAll(t,r,n){if(r!==void 0||n!==void 0){r=r||"[\\w\\d-]+",n=n||"[\\w\\d-]+";var a=new RegExp(`<(${r}):(${n})(#\\d+)?((\\s+?[\\w\\d-:]+=("[^"]*"|'[^']*'))*\\s*)(\\/>|>([\\s\\S]*?)<\\/\\1:\\2\\3>)`,"gm")}else a=/<([\w\d-]+):([\w\d-]+)(#\d+)?((\s+?[\w\d-:]+=("[^"]*"|'[^']*'))*\s*)(\/>|>([\s\S]*?)<\/\1:\2\3>)/gm;return q_(t,a).map($c.unpackMatch)}static unpackMatch(t){let r=t[1],n=t[2],a=t[4],i=t[8];return new $c(r,n,a,i)}constructor(t,r,n,a){this.ns=t,this.name=r,this.attrString=n,this.innerXml=a,this.attrs=Yh.findAll(n),this.children=$c.findAll(a),this.value=this.children.length===0?Z_(a):void 0,this.properties=[...this.attrs,...this.children]}get isPrimitive(){return this.value!==void 0&&this.attrs.length===0&&this.children.length===0}get isListContainer(){return this.children.length===1&&this.children[0].isList}get isList(){let{ns:t,name:r}=this;return t==="rdf"&&(r==="Seq"||r==="Bag"||r==="Alt")}get isListItem(){return this.ns==="rdf"&&this.name==="li"}serialize(){if(this.properties.length===0&&this.value===void 0)return;if(this.isPrimitive)return this.value;if(this.isListContainer)return this.children[0].serialize();if(this.isList)return pE(this.children.map(hE));if(this.isListItem&&this.children.length===1&&this.attrs.length===0)return this.children[0].serialize();let t={};for(let r of this.properties)Y_(r,t);return this.value!==void 0&&(t.value=this.value),Xh(t)}}function Y_(e,t){let r=e.serialize();r!==void 0&&(t[e.name]=r)}var hE=e=>e.serialize(),pE=e=>e.length===1?e[0]:e,gE=(e,t)=>t[e]?t[e]:t[e]={};function q_(e,t){let r,n=[];if(!e)return n;for(;(r=t.exec(e))!==null;)n.push(r);return n}function Z_(e){if(function(n){return n==null||n==="null"||n==="undefined"||n===""||n.trim()===""}(e))return;let t=Number(e);if(!Number.isNaN(t))return t;let r=e.toLowerCase();return r==="true"||r!=="false"&&e.trim()}const J_=["rdf:li","rdf:Seq","rdf:Bag","rdf:Alt","rdf:Description"],mE=new RegExp(`(<|\\/)(${J_.join("|")})`,"g");var Q_=Object.freeze({__proto__:null,default:dE,Exifr:Fs,fileParsers:no,segmentParsers:Mn,fileReaders:oo,tagKeys:Vn,tagValues:Li,tagRevivers:Ts,createDictionary:bn,extendDictionary:Dl,fetchUrlAsArrayBuffer:Il,readBlobAsArrayBuffer:Rl,chunkedProps:ps,otherSegments:Nu,segments:$l,tiffBlocks:fn,segmentsAndBlocks:gs,tiffExtractables:ms,inheritables:Cu,allFormatters:xs,Options:Hl,parse:kg,gpsOnlyOptions:Rv,gps:z_,thumbnailOnlyOptions:Dv,thumbnail:W_,thumbnailUrl:V_,orientationOnlyOptions:$v,orientation:Lv,rotations:Bv,get rotateCanvas(){return fl},get rotateCss(){return hl},rotation:H_});let Gk=Hh("fs",e=>e.promises);oo.set("fs",class extends jg{async readWhole(){this.chunked=!1,this.fs=await Gk;let e=await this.fs.readFile(this.input);this._swapBuffer(e)}async readChunked(){this.chunked=!0,this.fs=await Gk,await this.open(),await this.readChunk(0,this.options.firstChunkSize)}async open(){this.fh===void 0&&(this.fh=await this.fs.open(this.input,"r"),this.size=(await this.fh.stat(this.input)).size)}async _readChunk(e,t){this.fh===void 0&&await this.open(),e+t>this.size&&(t=this.size-e);var r=this.subarray(e,t,!0);return await this.fh.read(r.dataView,0,t,e),r}async close(){if(this.fh){let e=this.fh;this.fh=void 0,await e.close()}}});oo.set("base64",class extends jg{constructor(...e){super(...e),this.input=this.input.replace(/^data:([^;]+);base64,/gim,""),this.size=this.input.length/4*3,this.input.endsWith("==")?this.size-=2:this.input.endsWith("=")&&(this.size-=1)}async _readChunk(e,t){let r,n,a=this.input;e===void 0?(e=0,r=0,n=0):(r=4*Math.floor(e/3),n=e-r/4*3),t===void 0&&(t=this.size);let i=e+t,o=r+4*Math.ceil(i/3);a=a.slice(r,o);let s=Math.min(t,this.size-e);if(wg){let l=vg.from(a,"base64").slice(n,n+s);return this.set(l,e,!0)}{let l=this.subarray(e,s,!0),u=atob(a),d=l.toUint8();for(let f=0;f<s;f++)d[f]=u.charCodeAt(n+f);return l}}});class Uk extends Sg{static canHandle(t,r){return r===18761||r===19789}extendOptions(t){let{ifd0:r,xmp:n,iptc:a,icc:i}=t;n.enabled&&r.deps.add(700),a.enabled&&r.deps.add(33723),i.enabled&&r.deps.add(34675),r.finalizeFilters()}async parse(){let{tiff:t,xmp:r,iptc:n,icc:a}=this.options;if(t.enabled||r.enabled||n.enabled||a.enabled){let i=Math.max(Xy(this.options),this.options.chunkSize);await this.file.ensureChunk(0,i),this.createParser("tiff",this.file),this.parsers.tiff.parseHeader(),await this.parsers.tiff.parseIfd0Block(),this.adaptTiffPropAsSegment("xmp"),this.adaptTiffPropAsSegment("iptc"),this.adaptTiffPropAsSegment("icc")}}adaptTiffPropAsSegment(t){if(this.parsers.tiff[t]){let r=this.parsers.tiff[t];this.injectSegment(t,r)}}}Nt(Uk,"type","tiff"),no.set("tiff",Uk);let xE=Hh("zlib");const yE=["ihdr","iccp","text","itxt","exif"];class zk extends Sg{constructor(...t){super(...t),Nt(this,"catchError",r=>this.errors.push(r)),Nt(this,"metaChunks",[]),Nt(this,"unknownChunks",[])}static canHandle(t,r){return r===35152&&t.getUint32(0)===2303741511&&t.getUint32(4)===218765834}async parse(){let{file:t}=this;await this.findPngChunksInRange(8,t.byteLength),await this.readSegments(this.metaChunks),this.findIhdr(),this.parseTextChunks(),await this.findExif().catch(this.catchError),await this.findXmp().catch(this.catchError),await this.findIcc().catch(this.catchError)}async findPngChunksInRange(t,r){let{file:n}=this;for(;t<r;){let a=n.getUint32(t),i=n.getUint32(t+4),o=n.getString(t+4,4).toLowerCase(),s=a+4+4+4,l={type:o,offset:t,length:s,start:t+4+4,size:a,marker:i};yE.includes(o)?this.metaChunks.push(l):this.unknownChunks.push(l),t+=s}}parseTextChunks(){let t=this.metaChunks.filter(r=>r.type==="text");for(let r of t){let[n,a]=this.file.getString(r.start,r.size).split("\0");this.injectKeyValToIhdr(n,a)}}injectKeyValToIhdr(t,r){let n=this.parsers.ihdr;n&&n.raw.set(t,r)}findIhdr(){let t=this.metaChunks.find(r=>r.type==="ihdr");t&&this.options.ihdr.enabled!==!1&&this.createParser("ihdr",t.chunk)}async findExif(){let t=this.metaChunks.find(r=>r.type==="exif");t&&this.injectSegment("tiff",t.chunk)}async findXmp(){let t=this.metaChunks.filter(r=>r.type==="itxt");for(let r of t)r.chunk.getString(0,17)==="XML:com.adobe.xmp"&&this.injectSegment("xmp",r.chunk)}async findIcc(){let t=this.metaChunks.find(s=>s.type==="iccp");if(!t)return;let{chunk:r}=t,n=r.getUint8Array(0,81),a=0;for(;a<80&&n[a]!==0;)a++;let i=a+2,o=r.getString(0,a);if(this.injectKeyValToIhdr("ProfileName",o),Vh){let s=await xE,l=r.getUint8Array(i);l=s.inflateSync(l),this.injectSegment("icc",l)}}}Nt(zk,"type","png"),no.set("png",zk),bn(Vn,"interop",[[1,"InteropIndex"],[2,"InteropVersion"],[4096,"RelatedImageFileFormat"],[4097,"RelatedImageWidth"],[4098,"RelatedImageHeight"]]),Dl(Vn,"ifd0",[[11,"ProcessingSoftware"],[254,"SubfileType"],[255,"OldSubfileType"],[263,"Thresholding"],[264,"CellWidth"],[265,"CellLength"],[266,"FillOrder"],[269,"DocumentName"],[280,"MinSampleValue"],[281,"MaxSampleValue"],[285,"PageName"],[286,"XPosition"],[287,"YPosition"],[290,"GrayResponseUnit"],[297,"PageNumber"],[321,"HalftoneHints"],[322,"TileWidth"],[323,"TileLength"],[332,"InkSet"],[337,"TargetPrinter"],[18246,"Rating"],[18249,"RatingPercent"],[33550,"PixelScale"],[34264,"ModelTransform"],[34377,"PhotoshopSettings"],[50706,"DNGVersion"],[50707,"DNGBackwardVersion"],[50708,"UniqueCameraModel"],[50709,"LocalizedCameraModel"],[50736,"DNGLensInfo"],[50739,"ShadowScale"],[50740,"DNGPrivateData"],[33920,"IntergraphMatrix"],[33922,"ModelTiePoint"],[34118,"SEMInfo"],[34735,"GeoTiffDirectory"],[34736,"GeoTiffDoubleParams"],[34737,"GeoTiffAsciiParams"],[50341,"PrintIM"],[50721,"ColorMatrix1"],[50722,"ColorMatrix2"],[50723,"CameraCalibration1"],[50724,"CameraCalibration2"],[50725,"ReductionMatrix1"],[50726,"ReductionMatrix2"],[50727,"AnalogBalance"],[50728,"AsShotNeutral"],[50729,"AsShotWhiteXY"],[50730,"BaselineExposure"],[50731,"BaselineNoise"],[50732,"BaselineSharpness"],[50734,"LinearResponseLimit"],[50735,"CameraSerialNumber"],[50741,"MakerNoteSafety"],[50778,"CalibrationIlluminant1"],[50779,"CalibrationIlluminant2"],[50781,"RawDataUniqueID"],[50827,"OriginalRawFileName"],[50828,"OriginalRawFileData"],[50831,"AsShotICCProfile"],[50832,"AsShotPreProfileMatrix"],[50833,"CurrentICCProfile"],[50834,"CurrentPreProfileMatrix"],[50879,"ColorimetricReference"],[50885,"SRawType"],[50898,"PanasonicTitle"],[50899,"PanasonicTitle2"],[50931,"CameraCalibrationSig"],[50932,"ProfileCalibrationSig"],[50933,"ProfileIFD"],[50934,"AsShotProfileName"],[50936,"ProfileName"],[50937,"ProfileHueSatMapDims"],[50938,"ProfileHueSatMapData1"],[50939,"ProfileHueSatMapData2"],[50940,"ProfileToneCurve"],[50941,"ProfileEmbedPolicy"],[50942,"ProfileCopyright"],[50964,"ForwardMatrix1"],[50965,"ForwardMatrix2"],[50966,"PreviewApplicationName"],[50967,"PreviewApplicationVersion"],[50968,"PreviewSettingsName"],[50969,"PreviewSettingsDigest"],[50970,"PreviewColorSpace"],[50971,"PreviewDateTime"],[50972,"RawImageDigest"],[50973,"OriginalRawFileDigest"],[50981,"ProfileLookTableDims"],[50982,"ProfileLookTableData"],[51043,"TimeCodes"],[51044,"FrameRate"],[51058,"TStop"],[51081,"ReelName"],[51089,"OriginalDefaultFinalSize"],[51090,"OriginalBestQualitySize"],[51091,"OriginalDefaultCropSize"],[51105,"CameraLabel"],[51107,"ProfileHueSatMapEncoding"],[51108,"ProfileLookTableEncoding"],[51109,"BaselineExposureOffset"],[51110,"DefaultBlackRender"],[51111,"NewRawImageDigest"],[51112,"RawToPreviewGain"]]);let Wk=[[273,"StripOffsets"],[279,"StripByteCounts"],[288,"FreeOffsets"],[289,"FreeByteCounts"],[291,"GrayResponseCurve"],[292,"T4Options"],[293,"T6Options"],[300,"ColorResponseUnit"],[320,"ColorMap"],[324,"TileOffsets"],[325,"TileByteCounts"],[326,"BadFaxLines"],[327,"CleanFaxData"],[328,"ConsecutiveBadFaxLines"],[330,"SubIFD"],[333,"InkNames"],[334,"NumberofInks"],[336,"DotRange"],[338,"ExtraSamples"],[339,"SampleFormat"],[340,"SMinSampleValue"],[341,"SMaxSampleValue"],[342,"TransferRange"],[343,"ClipPath"],[344,"XClipPathUnits"],[345,"YClipPathUnits"],[346,"Indexed"],[347,"JPEGTables"],[351,"OPIProxy"],[400,"GlobalParametersIFD"],[401,"ProfileType"],[402,"FaxProfile"],[403,"CodingMethods"],[404,"VersionYear"],[405,"ModeNumber"],[433,"Decode"],[434,"DefaultImageColor"],[435,"T82Options"],[437,"JPEGTables"],[512,"JPEGProc"],[515,"JPEGRestartInterval"],[517,"JPEGLosslessPredictors"],[518,"JPEGPointTransforms"],[519,"JPEGQTables"],[520,"JPEGDCTables"],[521,"JPEGACTables"],[559,"StripRowCounts"],[999,"USPTOMiscellaneous"],[18247,"XP_DIP_XML"],[18248,"StitchInfo"],[28672,"SonyRawFileType"],[28688,"SonyToneCurve"],[28721,"VignettingCorrection"],[28722,"VignettingCorrParams"],[28724,"ChromaticAberrationCorrection"],[28725,"ChromaticAberrationCorrParams"],[28726,"DistortionCorrection"],[28727,"DistortionCorrParams"],[29895,"SonyCropTopLeft"],[29896,"SonyCropSize"],[32781,"ImageID"],[32931,"WangTag1"],[32932,"WangAnnotation"],[32933,"WangTag3"],[32934,"WangTag4"],[32953,"ImageReferencePoints"],[32954,"RegionXformTackPoint"],[32955,"WarpQuadrilateral"],[32956,"AffineTransformMat"],[32995,"Matteing"],[32996,"DataType"],[32997,"ImageDepth"],[32998,"TileDepth"],[33300,"ImageFullWidth"],[33301,"ImageFullHeight"],[33302,"TextureFormat"],[33303,"WrapModes"],[33304,"FovCot"],[33305,"MatrixWorldToScreen"],[33306,"MatrixWorldToCamera"],[33405,"Model2"],[33421,"CFARepeatPatternDim"],[33422,"CFAPattern2"],[33423,"BatteryLevel"],[33424,"KodakIFD"],[33445,"MDFileTag"],[33446,"MDScalePixel"],[33447,"MDColorTable"],[33448,"MDLabName"],[33449,"MDSampleInfo"],[33450,"MDPrepDate"],[33451,"MDPrepTime"],[33452,"MDFileUnits"],[33589,"AdventScale"],[33590,"AdventRevision"],[33628,"UIC1Tag"],[33629,"UIC2Tag"],[33630,"UIC3Tag"],[33631,"UIC4Tag"],[33918,"IntergraphPacketData"],[33919,"IntergraphFlagRegisters"],[33921,"INGRReserved"],[34016,"Site"],[34017,"ColorSequence"],[34018,"IT8Header"],[34019,"RasterPadding"],[34020,"BitsPerRunLength"],[34021,"BitsPerExtendedRunLength"],[34022,"ColorTable"],[34023,"ImageColorIndicator"],[34024,"BackgroundColorIndicator"],[34025,"ImageColorValue"],[34026,"BackgroundColorValue"],[34027,"PixelIntensityRange"],[34028,"TransparencyIndicator"],[34029,"ColorCharacterization"],[34030,"HCUsage"],[34031,"TrapIndicator"],[34032,"CMYKEquivalent"],[34152,"AFCP_IPTC"],[34232,"PixelMagicJBIGOptions"],[34263,"JPLCartoIFD"],[34306,"WB_GRGBLevels"],[34310,"LeafData"],[34687,"TIFF_FXExtensions"],[34688,"MultiProfiles"],[34689,"SharedData"],[34690,"T88Options"],[34732,"ImageLayer"],[34750,"JBIGOptions"],[34856,"Opto-ElectricConvFactor"],[34857,"Interlace"],[34908,"FaxRecvParams"],[34909,"FaxSubAddress"],[34910,"FaxRecvTime"],[34929,"FedexEDR"],[34954,"LeafSubIFD"],[37387,"FlashEnergy"],[37388,"SpatialFrequencyResponse"],[37389,"Noise"],[37390,"FocalPlaneXResolution"],[37391,"FocalPlaneYResolution"],[37392,"FocalPlaneResolutionUnit"],[37397,"ExposureIndex"],[37398,"TIFF-EPStandardID"],[37399,"SensingMethod"],[37434,"CIP3DataFile"],[37435,"CIP3Sheet"],[37436,"CIP3Side"],[37439,"StoNits"],[37679,"MSDocumentText"],[37680,"MSPropertySetStorage"],[37681,"MSDocumentTextPosition"],[37724,"ImageSourceData"],[40965,"InteropIFD"],[40976,"SamsungRawPointersOffset"],[40977,"SamsungRawPointersLength"],[41217,"SamsungRawByteOrder"],[41218,"SamsungRawUnknown"],[41484,"SpatialFrequencyResponse"],[41485,"Noise"],[41489,"ImageNumber"],[41490,"SecurityClassification"],[41491,"ImageHistory"],[41494,"TIFF-EPStandardID"],[41995,"DeviceSettingDescription"],[42112,"GDALMetadata"],[42113,"GDALNoData"],[44992,"ExpandSoftware"],[44993,"ExpandLens"],[44994,"ExpandFilm"],[44995,"ExpandFilterLens"],[44996,"ExpandScanner"],[44997,"ExpandFlashLamp"],[46275,"HasselbladRawImage"],[48129,"PixelFormat"],[48130,"Transformation"],[48131,"Uncompressed"],[48132,"ImageType"],[48256,"ImageWidth"],[48257,"ImageHeight"],[48258,"WidthResolution"],[48259,"HeightResolution"],[48320,"ImageOffset"],[48321,"ImageByteCount"],[48322,"AlphaOffset"],[48323,"AlphaByteCount"],[48324,"ImageDataDiscard"],[48325,"AlphaDataDiscard"],[50215,"OceScanjobDesc"],[50216,"OceApplicationSelector"],[50217,"OceIDNumber"],[50218,"OceImageLogic"],[50255,"Annotations"],[50459,"HasselbladExif"],[50547,"OriginalFileName"],[50560,"USPTOOriginalContentType"],[50656,"CR2CFAPattern"],[50710,"CFAPlaneColor"],[50711,"CFALayout"],[50712,"LinearizationTable"],[50713,"BlackLevelRepeatDim"],[50714,"BlackLevel"],[50715,"BlackLevelDeltaH"],[50716,"BlackLevelDeltaV"],[50717,"WhiteLevel"],[50718,"DefaultScale"],[50719,"DefaultCropOrigin"],[50720,"DefaultCropSize"],[50733,"BayerGreenSplit"],[50737,"ChromaBlurRadius"],[50738,"AntiAliasStrength"],[50752,"RawImageSegmentation"],[50780,"BestQualityScale"],[50784,"AliasLayerMetadata"],[50829,"ActiveArea"],[50830,"MaskedAreas"],[50935,"NoiseReductionApplied"],[50974,"SubTileBlockSize"],[50975,"RowInterleaveFactor"],[51008,"OpcodeList1"],[51009,"OpcodeList2"],[51022,"OpcodeList3"],[51041,"NoiseProfile"],[51114,"CacheVersion"],[51125,"DefaultUserCrop"],[51157,"NikonNEFInfo"],[65024,"KdcIFD"]];Dl(Vn,"ifd0",Wk),Dl(Vn,"exif",Wk),bn(Li,"gps",[[23,{M:"Magnetic North",T:"True North"}],[25,{K:"Kilometers",M:"Miles",N:"Nautical Miles"}]]);class cx extends Ai{static canHandle(t,r){return t.getUint8(r+1)===224&&t.getUint32(r+4)===1246120262&&t.getUint8(r+8)===0}parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint16(0)],[2,this.chunk.getUint8(2)],[3,this.chunk.getUint16(3)],[5,this.chunk.getUint16(5)],[7,this.chunk.getUint8(7)],[8,this.chunk.getUint8(8)]])}}Nt(cx,"type","jfif"),Nt(cx,"headerLength",9),Mn.set("jfif",cx),bn(Vn,"jfif",[[0,"JFIFVersion"],[2,"ResolutionUnit"],[3,"XResolution"],[5,"YResolution"],[7,"ThumbnailWidth"],[8,"ThumbnailHeight"]]);class Vk extends Ai{parse(){return this.parseTags(),this.translate(),this.output}parseTags(){this.raw=new Map([[0,this.chunk.getUint32(0)],[4,this.chunk.getUint32(4)],[8,this.chunk.getUint8(8)],[9,this.chunk.getUint8(9)],[10,this.chunk.getUint8(10)],[11,this.chunk.getUint8(11)],[12,this.chunk.getUint8(12)],...Array.from(this.raw)])}}Nt(Vk,"type","ihdr"),Mn.set("ihdr",Vk),bn(Vn,"ihdr",[[0,"ImageWidth"],[4,"ImageHeight"],[8,"BitDepth"],[9,"ColorType"],[10,"Compression"],[11,"Filter"],[12,"Interlace"]]),bn(Li,"ihdr",[[9,{0:"Grayscale",2:"RGB",3:"Palette",4:"Grayscale with Alpha",6:"RGB with Alpha",DEFAULT:"Unknown"}],[10,{0:"Deflate/Inflate",DEFAULT:"Unknown"}],[11,{0:"Adaptive",DEFAULT:"Unknown"}],[12,{0:"Noninterlaced",1:"Adam7 Interlace",DEFAULT:"Unknown"}]]);class yh extends Ai{static canHandle(t,r){return t.getUint8(r+1)===226&&t.getUint32(r+4)===1229144927}static findPosition(t,r){let n=super.findPosition(t,r);return n.chunkNumber=t.getUint8(r+16),n.chunkCount=t.getUint8(r+17),n.multiSegment=n.chunkCount>1,n}static handleMultiSegments(t){return function(r){let n=function(a){let i=a[0].constructor,o=0;for(let u of a)o+=u.length;let s=new i(o),l=0;for(let u of a)s.set(u,l),l+=u.length;return s}(r.map(a=>a.chunk.toUint8()));return new Oa(n)}(t)}parse(){return this.raw=new Map,this.parseHeader(),this.parseTags(),this.translate(),this.output}parseHeader(){let{raw:t}=this;this.chunk.byteLength<84&&Nn("ICC header is too short");for(let[r,n]of Object.entries(bE)){r=parseInt(r,10);let a=n(this.chunk,r);a!=="\0\0\0\0"&&t.set(r,a)}}parseTags(){let t,r,n,a,i,{raw:o}=this,s=this.chunk.getUint32(128),l=132,u=this.chunk.byteLength;for(;s--;){if(t=this.chunk.getString(l,4),r=this.chunk.getUint32(l+4),n=this.chunk.getUint32(l+8),a=this.chunk.getString(r,4),r+n>u)return void console.warn("reached the end of the first ICC chunk. Enable options.tiff.multiSegment to read all ICC segments.");i=this.parseTag(a,r,n),i!==void 0&&i!=="\0\0\0\0"&&o.set(t,i),l+=12}}parseTag(t,r,n){switch(t){case"desc":return this.parseDesc(r);case"mluc":return this.parseMluc(r);case"text":return this.parseText(r,n);case"sig ":return this.parseSig(r)}if(!(r+n>this.chunk.byteLength))return this.chunk.getUint8Array(r,n)}parseDesc(t){let r=this.chunk.getUint32(t+8)-1;return dl(this.chunk.getString(t+12,r))}parseText(t,r){return dl(this.chunk.getString(t+8,r-8))}parseSig(t){return dl(this.chunk.getString(t+8,4))}parseMluc(t){let{chunk:r}=this,n=r.getUint32(t+8),a=r.getUint32(t+12),i=t+16,o=[];for(let s=0;s<n;s++){let l=r.getString(i+0,2),u=r.getString(i+2,2),d=r.getUint32(i+4),f=r.getUint32(i+8)+t,h=dl(r.getUnicodeString(f,d));o.push({lang:l,country:u,text:h}),i+=a}return n===1?o[0].text:o}translateValue(t,r){return typeof t=="string"?r[t]||r[t.toLowerCase()]||t:r[t]||t}}Nt(yh,"type","icc"),Nt(yh,"multiSegment",!0),Nt(yh,"headerLength",18);const bE={4:mo,8:function(e,t){return[e.getUint8(t),e.getUint8(t+1)>>4,e.getUint8(t+1)%16].map(r=>r.toString(10)).join(".")},12:mo,16:mo,20:mo,24:function(e,t){const r=e.getUint16(t),n=e.getUint16(t+2)-1,a=e.getUint16(t+4),i=e.getUint16(t+6),o=e.getUint16(t+8),s=e.getUint16(t+10);return new Date(Date.UTC(r,n,a,i,o,s))},36:mo,40:mo,48:mo,52:mo,64:(e,t)=>e.getUint32(t),80:mo};function mo(e,t){return dl(e.getString(t,4))}Mn.set("icc",yh),bn(Vn,"icc",[[4,"ProfileCMMType"],[8,"ProfileVersion"],[12,"ProfileClass"],[16,"ColorSpaceData"],[20,"ProfileConnectionSpace"],[24,"ProfileDateTime"],[36,"ProfileFileSignature"],[40,"PrimaryPlatform"],[44,"CMMFlags"],[48,"DeviceManufacturer"],[52,"DeviceModel"],[56,"DeviceAttributes"],[64,"RenderingIntent"],[68,"ConnectionSpaceIlluminant"],[80,"ProfileCreator"],[84,"ProfileID"],["Header","ProfileHeader"],["MS00","WCSProfiles"],["bTRC","BlueTRC"],["bXYZ","BlueMatrixColumn"],["bfd","UCRBG"],["bkpt","MediaBlackPoint"],["calt","CalibrationDateTime"],["chad","ChromaticAdaptation"],["chrm","Chromaticity"],["ciis","ColorimetricIntentImageState"],["clot","ColorantTableOut"],["clro","ColorantOrder"],["clrt","ColorantTable"],["cprt","ProfileCopyright"],["crdi","CRDInfo"],["desc","ProfileDescription"],["devs","DeviceSettings"],["dmdd","DeviceModelDesc"],["dmnd","DeviceMfgDesc"],["dscm","ProfileDescriptionML"],["fpce","FocalPlaneColorimetryEstimates"],["gTRC","GreenTRC"],["gXYZ","GreenMatrixColumn"],["gamt","Gamut"],["kTRC","GrayTRC"],["lumi","Luminance"],["meas","Measurement"],["meta","Metadata"],["mmod","MakeAndModel"],["ncl2","NamedColor2"],["ncol","NamedColor"],["ndin","NativeDisplayInfo"],["pre0","Preview0"],["pre1","Preview1"],["pre2","Preview2"],["ps2i","PS2RenderingIntent"],["ps2s","PostScript2CSA"],["psd0","PostScript2CRD0"],["psd1","PostScript2CRD1"],["psd2","PostScript2CRD2"],["psd3","PostScript2CRD3"],["pseq","ProfileSequenceDesc"],["psid","ProfileSequenceIdentifier"],["psvm","PS2CRDVMSize"],["rTRC","RedTRC"],["rXYZ","RedMatrixColumn"],["resp","OutputResponse"],["rhoc","ReflectionHardcopyOrigColorimetry"],["rig0","PerceptualRenderingIntentGamut"],["rig2","SaturationRenderingIntentGamut"],["rpoc","ReflectionPrintOutputColorimetry"],["sape","SceneAppearanceEstimates"],["scoe","SceneColorimetryEstimates"],["scrd","ScreeningDesc"],["scrn","Screening"],["targ","CharTarget"],["tech","Technology"],["vcgt","VideoCardGamma"],["view","ViewingConditions"],["vued","ViewingCondDesc"],["wtpt","MediaWhitePoint"]]);const $0={"4d2p":"Erdt Systems",AAMA:"Aamazing Technologies",ACER:"Acer",ACLT:"Acolyte Color Research",ACTI:"Actix Sytems",ADAR:"Adara Technology",ADBE:"Adobe",ADI:"ADI Systems",AGFA:"Agfa Graphics",ALMD:"Alps Electric",ALPS:"Alps Electric",ALWN:"Alwan Color Expertise",AMTI:"Amiable Technologies",AOC:"AOC International",APAG:"Apago",APPL:"Apple Computer",AST:"AST","AT&T":"AT&T",BAEL:"BARBIERI electronic",BRCO:"Barco NV",BRKP:"Breakpoint",BROT:"Brother",BULL:"Bull",BUS:"Bus Computer Systems","C-IT":"C-Itoh",CAMR:"Intel",CANO:"Canon",CARR:"Carroll Touch",CASI:"Casio",CBUS:"Colorbus PL",CEL:"Crossfield",CELx:"Crossfield",CGS:"CGS Publishing Technologies International",CHM:"Rochester Robotics",CIGL:"Colour Imaging Group, London",CITI:"Citizen",CL00:"Candela",CLIQ:"Color IQ",CMCO:"Chromaco",CMiX:"CHROMiX",COLO:"Colorgraphic Communications",COMP:"Compaq",COMp:"Compeq/Focus Technology",CONR:"Conrac Display Products",CORD:"Cordata Technologies",CPQ:"Compaq",CPRO:"ColorPro",CRN:"Cornerstone",CTX:"CTX International",CVIS:"ColorVision",CWC:"Fujitsu Laboratories",DARI:"Darius Technology",DATA:"Dataproducts",DCP:"Dry Creek Photo",DCRC:"Digital Contents Resource Center, Chung-Ang University",DELL:"Dell Computer",DIC:"Dainippon Ink and Chemicals",DICO:"Diconix",DIGI:"Digital","DL&C":"Digital Light & Color",DPLG:"Doppelganger",DS:"Dainippon Screen",DSOL:"DOOSOL",DUPN:"DuPont",EPSO:"Epson",ESKO:"Esko-Graphics",ETRI:"Electronics and Telecommunications Research Institute",EVER:"Everex Systems",EXAC:"ExactCODE",Eizo:"Eizo",FALC:"Falco Data Products",FF:"Fuji Photo Film",FFEI:"FujiFilm Electronic Imaging",FNRD:"Fnord Software",FORA:"Fora",FORE:"Forefront Technology",FP:"Fujitsu",FPA:"WayTech Development",FUJI:"Fujitsu",FX:"Fuji Xerox",GCC:"GCC Technologies",GGSL:"Global Graphics Software",GMB:"Gretagmacbeth",GMG:"GMG",GOLD:"GoldStar Technology",GOOG:"Google",GPRT:"Giantprint",GTMB:"Gretagmacbeth",GVC:"WayTech Development",GW2K:"Sony",HCI:"HCI",HDM:"Heidelberger Druckmaschinen",HERM:"Hermes",HITA:"Hitachi America",HP:"Hewlett-Packard",HTC:"Hitachi",HiTi:"HiTi Digital",IBM:"IBM",IDNT:"Scitex",IEC:"Hewlett-Packard",IIYA:"Iiyama North America",IKEG:"Ikegami Electronics",IMAG:"Image Systems",IMI:"Ingram Micro",INTC:"Intel",INTL:"N/A (INTL)",INTR:"Intra Electronics",IOCO:"Iocomm International Technology",IPS:"InfoPrint Solutions Company",IRIS:"Scitex",ISL:"Ichikawa Soft Laboratory",ITNL:"N/A (ITNL)",IVM:"IVM",IWAT:"Iwatsu Electric",Idnt:"Scitex",Inca:"Inca Digital Printers",Iris:"Scitex",JPEG:"Joint Photographic Experts Group",JSFT:"Jetsoft Development",JVC:"JVC Information Products",KART:"Scitex",KFC:"KFC Computek Components",KLH:"KLH Computers",KMHD:"Konica Minolta",KNCA:"Konica",KODA:"Kodak",KYOC:"Kyocera",Kart:"Scitex",LCAG:"Leica",LCCD:"Leeds Colour",LDAK:"Left Dakota",LEAD:"Leading Technology",LEXM:"Lexmark International",LINK:"Link Computer",LINO:"Linotronic",LITE:"Lite-On",Leaf:"Leaf",Lino:"Linotronic",MAGC:"Mag Computronic",MAGI:"MAG Innovision",MANN:"Mannesmann",MICN:"Micron Technology",MICR:"Microtek",MICV:"Microvitec",MINO:"Minolta",MITS:"Mitsubishi Electronics America",MITs:"Mitsuba",MNLT:"Minolta",MODG:"Modgraph",MONI:"Monitronix",MONS:"Monaco Systems",MORS:"Morse Technology",MOTI:"Motive Systems",MSFT:"Microsoft",MUTO:"MUTOH INDUSTRIES",Mits:"Mitsubishi Electric",NANA:"NANAO",NEC:"NEC",NEXP:"NexPress Solutions",NISS:"Nissei Sangyo America",NKON:"Nikon",NONE:"none",OCE:"Oce Technologies",OCEC:"OceColor",OKI:"Oki",OKID:"Okidata",OKIP:"Okidata",OLIV:"Olivetti",OLYM:"Olympus",ONYX:"Onyx Graphics",OPTI:"Optiquest",PACK:"Packard Bell",PANA:"Matsushita Electric Industrial",PANT:"Pantone",PBN:"Packard Bell",PFU:"PFU",PHIL:"Philips Consumer Electronics",PNTX:"HOYA",POne:"Phase One A/S",PREM:"Premier Computer Innovations",PRIN:"Princeton Graphic Systems",PRIP:"Princeton Publishing Labs",QLUX:"Hong Kong",QMS:"QMS",QPCD:"QPcard AB",QUAD:"QuadLaser",QUME:"Qume",RADI:"Radius",RDDx:"Integrated Color Solutions",RDG:"Roland DG",REDM:"REDMS Group",RELI:"Relisys",RGMS:"Rolf Gierling Multitools",RICO:"Ricoh",RNLD:"Edmund Ronald",ROYA:"Royal",RPC:"Ricoh Printing Systems",RTL:"Royal Information Electronics",SAMP:"Sampo",SAMS:"Samsung",SANT:"Jaime Santana Pomares",SCIT:"Scitex",SCRN:"Dainippon Screen",SDP:"Scitex",SEC:"Samsung",SEIK:"Seiko Instruments",SEIk:"Seikosha",SGUY:"ScanGuy.com",SHAR:"Sharp Laboratories",SICC:"International Color Consortium",SONY:"Sony",SPCL:"SpectraCal",STAR:"Star",STC:"Sampo Technology",Scit:"Scitex",Sdp:"Scitex",Sony:"Sony",TALO:"Talon Technology",TAND:"Tandy",TATU:"Tatung",TAXA:"TAXAN America",TDS:"Tokyo Denshi Sekei",TECO:"TECO Information Systems",TEGR:"Tegra",TEKT:"Tektronix",TI:"Texas Instruments",TMKR:"TypeMaker",TOSB:"Toshiba",TOSH:"Toshiba",TOTK:"TOTOKU ELECTRIC",TRIU:"Triumph",TSBT:"Toshiba",TTX:"TTX Computer Products",TVM:"TVM Professional Monitor",TW:"TW Casper",ULSX:"Ulead Systems",UNIS:"Unisys",UTZF:"Utz Fehlau & Sohn",VARI:"Varityper",VIEW:"Viewsonic",VISL:"Visual communication",VIVO:"Vivo Mobile Communication",WANG:"Wang",WLBR:"Wilbur Imaging",WTG2:"Ware To Go",WYSE:"WYSE Technology",XERX:"Xerox",XRIT:"X-Rite",ZRAN:"Zoran",Zebr:"Zebra Technologies",appl:"Apple Computer",bICC:"basICColor",berg:"bergdesign",ceyd:"Integrated Color Solutions",clsp:"MacDermid ColorSpan",ds:"Dainippon Screen",dupn:"DuPont",ffei:"FujiFilm Electronic Imaging",flux:"FluxData",iris:"Scitex",kart:"Scitex",lcms:"Little CMS",lino:"Linotronic",none:"none",ob4d:"Erdt Systems",obic:"Medigraph",quby:"Qubyx Sarl",scit:"Scitex",scrn:"Dainippon Screen",sdp:"Scitex",siwi:"SIWI GRAFIKA",yxym:"YxyMaster"},Hk={scnr:"Scanner",mntr:"Monitor",prtr:"Printer",link:"Device Link",abst:"Abstract",spac:"Color Space Conversion Profile",nmcl:"Named Color",cenc:"ColorEncodingSpace profile",mid:"MultiplexIdentification profile",mlnk:"MultiplexLink profile",mvis:"MultiplexVisualization profile",nkpf:"Nikon Input Device Profile (NON-STANDARD!)"};bn(Li,"icc",[[4,$0],[12,Hk],[40,Object.assign({},$0,Hk)],[48,$0],[80,$0],[64,{0:"Perceptual",1:"Relative Colorimetric",2:"Saturation",3:"Absolute Colorimetric"}],["tech",{amd:"Active Matrix Display",crt:"Cathode Ray Tube Display",kpcd:"Photo CD",pmd:"Passive Matrix Display",dcam:"Digital Camera",dcpj:"Digital Cinema Projector",dmpc:"Digital Motion Picture Camera",dsub:"Dye Sublimation Printer",epho:"Electrophotographic Printer",esta:"Electrostatic Printer",flex:"Flexography",fprn:"Film Writer",fscn:"Film Scanner",grav:"Gravure",ijet:"Ink Jet Printer",imgs:"Photo Image Setter",mpfr:"Motion Picture Film Recorder",mpfs:"Motion Picture Film Scanner",offs:"Offset Lithography",pjtv:"Projection Television",rpho:"Photographic Paper Printer",rscn:"Reflective Scanner",silk:"Silkscreen",twax:"Thermal Wax Printer",vidc:"Video Camera",vidm:"Video Monitor"}]]);class L0 extends Ai{static canHandle(t,r,n){return t.getUint8(r+1)===237&&t.getString(r+4,9)==="Photoshop"&&this.containsIptc8bim(t,r,n)!==void 0}static headerLength(t,r,n){let a,i=this.containsIptc8bim(t,r,n);if(i!==void 0)return a=t.getUint8(r+i+7),a%2!=0&&(a+=1),a===0&&(a=4),i+8+a}static containsIptc8bim(t,r,n){for(let a=0;a<n;a++)if(this.isIptcSegmentHead(t,r+a))return a}static isIptcSegmentHead(t,r){return t.getUint8(r)===56&&t.getUint32(r)===943868237&&t.getUint16(r+4)===1028}parse(){let{raw:t}=this,r=this.chunk.byteLength-1,n=!1;for(let a=0;a<r;a++)if(this.chunk.getUint8(a)===28&&this.chunk.getUint8(a+1)===2){n=!0;let i=this.chunk.getUint16(a+3),o=this.chunk.getUint8(a+2),s=this.chunk.getLatin1String(a+5,i);t.set(o,this.pluralizeValue(t.get(o),s)),a+=4+i}else if(n)break;return this.translate(),this.output}pluralizeValue(t,r){return t!==void 0?t instanceof Array?(t.push(r),t):[t,r]:r}}Nt(L0,"type","iptc"),Nt(L0,"translateValues",!1),Nt(L0,"reviveValues",!1),Mn.set("iptc",L0),bn(Vn,"iptc",[[0,"ApplicationRecordVersion"],[3,"ObjectTypeReference"],[4,"ObjectAttributeReference"],[5,"ObjectName"],[7,"EditStatus"],[8,"EditorialUpdate"],[10,"Urgency"],[12,"SubjectReference"],[15,"Category"],[20,"SupplementalCategories"],[22,"FixtureIdentifier"],[25,"Keywords"],[26,"ContentLocationCode"],[27,"ContentLocationName"],[30,"ReleaseDate"],[35,"ReleaseTime"],[37,"ExpirationDate"],[38,"ExpirationTime"],[40,"SpecialInstructions"],[42,"ActionAdvised"],[45,"ReferenceService"],[47,"ReferenceDate"],[50,"ReferenceNumber"],[55,"DateCreated"],[60,"TimeCreated"],[62,"DigitalCreationDate"],[63,"DigitalCreationTime"],[65,"OriginatingProgram"],[70,"ProgramVersion"],[75,"ObjectCycle"],[80,"Byline"],[85,"BylineTitle"],[90,"City"],[92,"Sublocation"],[95,"State"],[100,"CountryCode"],[101,"Country"],[103,"OriginalTransmissionReference"],[105,"Headline"],[110,"Credit"],[115,"Source"],[116,"CopyrightNotice"],[118,"Contact"],[120,"Caption"],[121,"LocalCaption"],[122,"Writer"],[125,"RasterizedCaption"],[130,"ImageType"],[131,"ImageOrientation"],[135,"LanguageIdentifier"],[150,"AudioType"],[151,"AudioSamplingRate"],[152,"AudioSamplingResolution"],[153,"AudioDuration"],[154,"AudioOutcue"],[184,"JobID"],[185,"MasterDocumentID"],[186,"ShortDocumentID"],[187,"UniqueDocumentID"],[188,"OwnerID"],[200,"ObjectPreviewFileFormat"],[201,"ObjectPreviewFileVersion"],[202,"ObjectPreviewData"],[221,"Prefs"],[225,"ClassifyState"],[228,"SimilarityIndex"],[230,"DocumentNotes"],[231,"DocumentHistory"],[232,"ExifCameraInfo"],[255,"CatalogSets"]]),bn(Li,"iptc",[[10,{0:"0 (reserved)",1:"1 (most urgent)",2:"2",3:"3",4:"4",5:"5 (normal urgency)",6:"6",7:"7",8:"8 (least urgent)",9:"9 (user-defined priority)"}],[75,{a:"Morning",b:"Both Morning and Evening",p:"Evening"}],[131,{L:"Landscape",P:"Portrait",S:"Square"}]]);let ux=null;async function Gs(){if(!ux)try{const n=(await ct(()=>import("./joraw-uMUQTOS9.js"),[])).default;if(typeof n!="function")throw new Error("JoRaw WASM import failed");const a=new URL("/assets/joraw-DraTMNgX.wasm",import.meta.url).href;ux=n({locateFile:(i,o)=>i.endsWith("joraw.wasm")?a:o+i})}catch(r){throw console.error("Failed to load joraw.js:",r),r}const e=await ux,t=e.LibRaw||e.JoRaw;if(!t)throw new Error("JoRaw class not found");return t}const Fv=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],Ji=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055;async function B0(e,t=0,r=0){const n=await Gs(),a=new n;try{await a.open(new Uint8Array(e));const i=a.getRawImage(),o=new Uint16Array(i.data),s=i.width,l=i.height,u=Math.floor((s-t)/6)*2,d=Math.floor((l-r)/6)*2;if(u<=0||d<=0)throw new Error("Image too small for X-Trans subsampling with current phase.");const f=new Uint16Array(u*d);for(let p=0;p<d/2;p++){const x=p*6+r;if(x+3>=l)break;const b=x*s,y=(x+3)*s,m=p*2,g=m*u,k=(m+1)*u;for(let S=0;S<u/2;S++){const w=S*6+t;if(w+1>=s)break;const v=S*2;f[g+v]=o[b+w+1],f[g+v+1]=o[b+w+0],f[k+v]=o[y+w+0],f[k+v+1]=o[y+w+1]}}return{dngBuffer:xh(u,d,f),width:u,height:d}}finally{a.delete?a.delete():a.close()}}function vE(e,t,r){const n=r.type===1?1:r.type===3?2:r.type===4?4:0;if(n===0)throw new Error(`Unsupported TIFF field type: ${r.type}`);const i=r.count*n<=4?r.valueFieldOffset:e.getUint32(r.valueFieldOffset,t),o=[];for(let s=0;s<r.count;s++){const l=i+s*n;if(l<0||l+n>e.byteLength)throw new Error("Invalid TIFF field offset");r.type===1?o.push(e.getUint8(l)):r.type===3?o.push(e.getUint16(l,t)):o.push(e.getUint32(l,t))}return o}function wE(e){const t=new DataView(e);if(t.byteLength<8)throw new Error("TIFF file too small");const r=t.getUint16(0,!1),n=r===18761;if(!n&&r!==19789)throw new Error("Invalid TIFF byte order");if(t.getUint16(2,n)!==42)throw new Error("Not a TIFF file");const i=t.getUint32(4,n);if(i<=0||i+2>t.byteLength)throw new Error("Invalid TIFF IFD offset");const o=t.getUint16(i,n),s=new Map;for(let N=0;N<o;N++){const C=i+2+N*12;if(C+12>t.byteLength)throw new Error("Corrupt TIFF IFD");const B=t.getUint16(C,n),I=t.getUint16(C+2,n),z=t.getUint32(C+4,n);s.set(B,{type:I,count:z,valueFieldOffset:C+8})}const l=(N,C=!1)=>{const B=s.get(N);if(!B){if(C)return[];throw new Error(`Missing TIFF tag ${N}`)}return vE(t,n,B)},u=l(256)[0]||0,d=l(257)[0]||0;if(u<=0||d<=0)throw new Error("Invalid TIFF dimensions");const f=l(258),h=l(277,!0)[0]||f.length||1,p=l(259,!0)[0]||1,x=l(262,!0)[0]||(h===1?1:2),b=l(273),y=l(279),m=l(278,!0)[0]||d,g=l(284,!0)[0]||1;if(p!==1)throw new Error(`Unsupported TIFF compression: ${p}`);if(g!==1)throw new Error("Only chunky TIFF (PlanarConfiguration=1) is supported");if(b.length!==y.length)throw new Error("Invalid TIFF strip metadata");const k=f.length===1?new Array(h).fill(f[0]):f;if(k.length<h)throw new Error("Invalid BitsPerSample count");const S=k[0];if(S!==8&&S!==16||k.some(N=>N!==S))throw new Error("Only 8-bit or 16-bit uniform TIFF samples are supported");const w=S/8,v=h*w,M=u*d*v;let _=new Uint8Array(M),P=0;for(let N=0;N<b.length;N++){const C=b[N],B=y[N];if(C<0||B<0||C+B>t.byteLength)throw new Error("Invalid TIFF strip bounds");const I=N*m;if(I>=d)break;const V=Math.min(m,d-I)*u*v,K=Math.min(B,V,M-P);if(_.set(new Uint8Array(e,C,K),P),P+=K,P>=M)break}if(P<M)throw new Error("TIFF pixel data is incomplete");const A=N=>w===1?_[N]:n?_[N]|_[N+1]<<8:_[N]<<8|_[N+1],R=N=>S===8?N&255:N>>>8&255,D=N=>S===8?N&255:N&65535,E=new Uint8ClampedArray(u*d*4),W=new Uint16Array(u*d*3);let F=0;const O=x===0;for(let N=0;N<d;N++)for(let C=0;C<u;C++){const B=N*u+C,I=B*4;let z=A(F),V=h>=2?A(F+w):z,K=h>=3?A(F+w*2):z;F+=v,O&&(S===8?(z=255-z,V=255-V,K=255-K):(z=65535-z,V=65535-V,K=65535-K)),E[I]=R(z),E[I+1]=R(V),E[I+2]=R(K),E[I+3]=255;const q=B*3;W[q]=D(z),W[q+1]=D(V),W[q+2]=D(K)}return{width:u,height:d,rgba:E,rgbData:W,whiteLevel:S===8?255:65535}}async function Jy(e){const t=e.name.toLowerCase(),r=/\.tiff?$/i.test(t)||e.type==="image/tiff"||e.type==="image/x-tiff"||e.type==="image/tif"||e.type==="application/tiff";let n=0,a=0,i=new Uint16Array(0),o=255;const s=document.createElement("canvas"),l=s.getContext("2d");if(!l)throw new Error("Failed to create canvas context");try{const f=await createImageBitmap(e);n=f.width,a=f.height,s.width=n,s.height=a,l.drawImage(f,0,0),f.close&&f.close();const p=l.getImageData(0,0,n,a).data,x=n*a;i=new Uint16Array(x*3);for(let b=0;b<a;b++)for(let y=0;y<n;y++){const m=(b*n+y)*4,g=(b*n+y)*3;i[g]=p[m],i[g+1]=p[m+1],i[g+2]=p[m+2]}}catch(f){if(!r)throw f;const h=wE(await e.arrayBuffer());n=h.width,a=h.height,i=new Uint16Array(h.rgbData),o=h.whiteLevel,s.width=n,s.height=a;const p=new ImageData(new Uint8ClampedArray(h.rgba),n,a);l.putImageData(p,0,0)}const u=await new Promise(f=>s.toBlob(f,"image/png"));let d={description:"Standard image (non-RAW)"};try{const f=await Q_.parse(e);f&&(d={...d,...f})}catch(f){console.warn("EXIF parsing failed for standard image",f)}return{previewBlob:u||e,analysisData:{data:i,width:n,height:a,bayerPattern:"RGGB",blackLevels:[0,0,0,0],whiteLevel:o,metadata:d,isThreePlane:!0}}}const kE=async e=>{const t=await Gs(),r=new t;try{await r.open(e,{useCameraWb:!0,outputBps:8,noAutoBright:!0,userQual:3,outputColor:1});const n=await r.imageData();return new Promise((a,i)=>{const o=document.createElement("canvas");o.width=n.width,o.height=n.height;const s=o.getContext("2d");if(!s){i(new Error("Could not create canvas context"));return}const l=s.createImageData(n.width,n.height),u=n.data,d=n.width*n.height;for(let f=0;f<d;f++){const h=f*3,p=f*4;l.data[p]=u[h],l.data[p+1]=u[h+1],l.data[p+2]=u[h+2],l.data[p+3]=255}s.putImageData(l,0,0),o.toBlob(f=>{f?a(f):i(new Error("Canvas to Blob failed"))},"image/jpeg",.85)})}finally{r.delete?r.delete():r.close()}},qh=async e=>{var n,a,i,o,s,l,u,d,f;const t=await Gs(),r=new t;try{if(await r.open(e,{}),typeof r.getRawImage!="function")throw new Error("WASM mismatch");const h=r.getRawImage();let p=new Uint16Array(h.data);const x=await r.metadata(!0);let b={...x};try{const v=await Q_.parse(e.buffer);v&&(b={...b,...v})}catch(v){console.warn("exifr parsing failed for RAW buffer",v)}const y=((n=x.idata)==null?void 0:n.filters)||0,m=((a=x.idata)==null?void 0:a.colors)||0,g=y===0&&m===3,k=y===9;let S=[0,0,0,0],w=!1;if(r.getBlackLevels)try{const v=r.getBlackLevels();v.dng_cblack&&v.dng_cblack.length===4&&Array.from(v.dng_cblack).some(M=>M>0)?(S=Array.from(v.dng_cblack).map(Number),w=!0):v.cblack&&v.cblack.length===4&&Array.from(v.cblack).some(M=>M>0)?(S=Array.from(v.cblack).map(Number),w=!0):typeof v.black=="number"&&v.black>0&&(S=[v.black,v.black,v.black,v.black],w=!0)}catch(v){console.warn("getBlackLevels binding failed",v)}if(!w){let v=[];if((i=x.color_data)!=null&&i.cblack_rawpy_style)v=x.color_data.cblack_rawpy_style;else if((s=(o=x.color_data)==null?void 0:o.dng_levels)!=null&&s.dng_cblack)v=x.color_data.dng_levels.dng_cblack;else if(((l=x.black_level_per_channel)==null?void 0:l.length)>=4)v=x.black_level_per_channel;else if(((u=x.cblack)==null?void 0:u.length)>=4)v=x.cblack;else if(((f=(d=x.color)==null?void 0:d.cblack)==null?void 0:f.length)>=4)v=x.color.cblack;else{const M=x.black_level||x.color_data&&x.color_data.black||0;v=[M,M,M,M]}S=[Number(v[0])||0,Number(v[1])||0,Number(v[2])||0,Number(v[3])||0]}return{data:p,width:h.width,height:h.height,bayerPattern:x.color_desc||"RGGB",blackLevels:S,whiteLevel:x.white_level||16383,metadata:b,isThreePlane:g,isXTrans:k}}finally{r.delete?r.delete():r.close()}};async function lc(e){const t=new Uint8Array(e.slice(0)),r=new Uint8Array(e.slice(0)),[n,a]=await Promise.all([kE(t),qh(r)]);return{previewBlob:n,analysisData:a}}async function Ds(e){const t=new Uint8Array(e);return qh(t)}const Xk=e=>(e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e);async function dx(e,t,r,n=!0){const a=await qh(new Uint8Array(e)),i=await qh(new Uint8Array(t));if(a.width!==i.width||a.height!==i.height)throw new Error("Dimension Mismatch");const o=a.width,s=a.height,l=r?Xk(o):o,u=r?Xk(s):s,d=l*u,f=new Uint16Array(d),h=32768,p=1.41421356;for(let x=0;x<s;x++){const b=x*o,y=x*l;for(let m=0;m<o;m++){const g=a.data[b+m],k=i.data[b+m];let S=g-k;n&&(S/=p);let w=S+h;w=Math.max(0,Math.min(65535,w)),f[y+m]=Math.round(w)}}return{rawData:f,width:l,height:u,metadata:a.metadata}}function tl(e,t,r,n,a,i,o){const s=Math.max(0,Math.floor(n)),l=Math.max(0,Math.floor(a)),u=Math.min(t,Math.ceil(n+i)),d=Math.min(r,Math.ceil(a+o)),f=[0,0,0,0],h=[0,0,0,0],p=[0,0,0,0];for(let y=l;y<d;y++){const m=y*t,g=y%2;for(let k=s;k<u;k++){const S=k%2,w=e[m+k],v=g*2+S;f[v]+=w,h[v]+=w*w,p[v]++}}const x=[0,0,0,0],b=[0,0,0,0];for(let y=0;y<4;y++)if(p[y]>0){const m=f[y]/p[y];x[y]=m;const k=h[y]/p[y]-m*m;b[y]=Math.sqrt(Math.max(0,k))}return{x:s,y:l,width:u-s,height:d-l,means:x,stdDevs:b,pixelCount:p.reduce((y,m)=>y+m,0)}}function SE(e,t,r,n,a,i=!1){const o=Math.floor(Math.max(0,r.x)),s=Math.floor(Math.max(0,r.y)),l=Math.ceil(Math.min(t,r.x+r.w)),u=e.length/t,d=Math.ceil(Math.min(u,r.y+r.h)),f=[0,0,0,0],h=[0,0,0,0];for(let F=s;F<d;F++){const O=F*t,$=F%2;for(let N=o;N<l;N++){const C=N%2,B=$*2+C,I=e[O+N],z=n[B]||0;f[B]+=Math.max(0,I-z),h[B]++}}let p=0,x=3;i&&(p=3,x=0);const b=h[p]>0?f[p]/h[p]:1,y=(f[1]+f[2])/(h[1]+h[2]||1),m=h[x]>0?f[x]/h[x]:1;if(b<1||y<1||m<1)return[1,1];const g=[[a[0],a[1],a[2]],[a[3],a[4],a[5]],[a[6],a[7],a[8]]],k=Ro(g);if(!k)return console.warn("Color Matrix is not invertible, falling back to standard WB"),[y/b,y/m];const S=Kc(Fv,k),w=Ro(S);let v=1,M=1,_=1;if(w)v=w[0][0]+w[0][1]+w[0][2],M=w[1][0]+w[1][1]+w[1][2],_=w[2][0]+w[2][1]+w[2][2],Math.abs(M)<1e-6&&(M=1);else return console.warn("Final Matrix is not invertible"),[y/b,y/m];const P=y/b,A=y/m,R=v/M,D=_/M,E=P*R,W=A*D;return[Math.max(0,E),Math.max(0,W)]}function Kk(e,t,r,n,a,i,o=0,s=0,l=!1){const u=Math.max(0,Math.floor(n.x)),d=Math.max(0,Math.floor(n.y)),f=Math.min(t,Math.ceil(n.x+n.w)),h=Math.min(r,Math.ceil(n.y+n.h));if(l&&e.length>=t*r*3){if(a<0||a>2||i<0||i>2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const A=(C,B,I)=>e[(C*t+B)*3+I];let R=0,D=0,E=0;for(let C=d;C<h;C++)for(let B=u;B<f;B++){const I=C+o,z=B+s;I<d||I>=h||z<u||z>=f||(R+=A(C,B,a),D+=A(I,z,i),E++)}if(E<2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const W=R/E,F=D/E;let O=0,$=0,N=0;for(let C=d;C<h;C++)for(let B=u;B<f;B++){const I=C+o,z=B+s;if(I<d||I>=h||z<u||z>=f)continue;const V=A(C,B,a),K=A(I,z,i),q=V-W,G=K-F;O+=q*G,$+=q*q,N+=G*G}return{sumCov:O,sumVar1:$,sumVar2:N,n:E}}const x=a>>1,b=a&1,y=(i>>1)+o,m=(i&1)+s;let g=0,k=0,S=0;for(let A=d;A<h-2;A+=2)for(let R=u;R<f-2;R+=2){const D=(A+x)*t+(R+b),E=(A+y)*t+(R+m);A+y>=r||R+m>=t||(g+=e[D],k+=e[E],S++)}if(S<2)return{sumCov:0,sumVar1:0,sumVar2:0,n:0};const w=g/S,v=k/S;let M=0,_=0,P=0;for(let A=d;A<h-2;A+=2)for(let R=u;R<f-2;R+=2){const D=(A+x)*t+(R+b),E=(A+y)*t+(R+m);if(A+y>=r||R+m>=t)continue;const W=e[D],F=e[E],O=W-w,$=F-v;M+=O*$,_+=O*O,P+=$*$}return{sumCov:M,sumVar1:_,sumVar2:P,n:S}}function jE(e){if(e.n<2)return 0;const t=Math.sqrt(e.sumVar1*e.sumVar2);return t===0?0:e.sumCov/t}function ME(e,t,r,n,a,i,o,s,l,u,d,f=!1){if(u<=l)return[];const h=Math.max(0,Math.floor(n)),p=Math.max(0,Math.floor(a)),x=Math.min(t,Math.ceil(n+i)),b=Math.min(r,Math.ceil(a+o)),y=u-l,m=d?Math.floor(y)+1:s,g=y/m,k=[new Uint32Array(m),new Uint32Array(m),new Uint32Array(m),new Uint32Array(m)];if(f&&e.length>=t*r*3)for(let v=p;v<b;v++){const M=v*t;for(let _=h;_<x;_++){const P=(M+_)*3;for(let A=0;A<3;A++){const R=e[P+A];if(R<l||R>u)continue;let D;d?D=Math.floor(R-l):D=Math.floor((R-l)/g),D<0&&(D=0),D>=m&&(D=m-1),k[A][D]++}}}else for(let v=p;v<b;v++){const M=v*t,_=v%2;for(let P=h;P<x;P++){const A=P%2,R=e[M+P];if(R<l||R>u)continue;const D=_*2+A;let E;d?E=Math.floor(R-l):E=Math.floor((R-l)/g),E<0&&(E=0),E>=m&&(E=m-1),k[D][E]++}}const w=[];for(let v=0;v<m;v++){const M=l+(d?v:v*g);w.push({binStart:M,c0:k[0][v],c1:k[1][v],c2:k[2][v],c3:k[3][v]})}return w}function _E(e,t,r,n,a,i=!1,o=!1,s={rows:!1,rowGroup:0,cols:!1,colGroup:0},l=!0,u=1,d=!1){const f=Math.max(0,Math.floor(n.x)),h=Math.max(0,Math.floor(n.y)),p=Math.min(t,Math.ceil(n.x+n.w)),x=Math.min(r,Math.ceil(n.y+n.h)),b=p-f,y=x-h;if(b<=1||y<=1)return null;const m=d&&e.length>=t*r*3;if(m){if(a<0||a>2)return null}else if(a<0||a>3)return null;let g=0,k=0;if(m)g=p-f,k=x-h;else{for(let E=f;E<p;E++)E%2===(a&1)&&g++;for(let E=h;E<x;E++)E%2===a>>1&&k++}if(g<4||k<4)return null;const S=Math.max(1,u),w=Math.floor(2*g/(S+1)),v=Math.floor(2*k/(S+1));if(w<4||v<4)return null;const M=new Tl(w),_=new Tl(v),P=new Float32Array(Math.floor(w/2)+1),A=new Float32Array(Math.floor(v/2)+1);let R=0,D=0;for(let E=h;E<x;E++){const W=E%2;if(!m&&a>>1!==W||s.rows&&(m?E&1:E>>1&1)!==s.rowGroup)continue;const F=E*t,O=new Float32Array(g);let $=0;for(let N=f;N<p;N++){if(!m&&N%2!==(a&1)||$>=g)continue;const C=m?e[(F+N)*3+a]:e[F+N],B=Number.isFinite(C)?C:0;O[$++]=B}for(let N=0;N<S;N++){const C=Math.floor(N*w/2);if(C+w>g)break;const B=O.slice(C,C+w);M.calculateSpectrum(B,P,o),R++}if(!l)break}for(let E=f;E<p;E++){const W=E%2;if(!m&&(a&1)!==W||s.cols&&(m?E&1:E>>1&1)!==s.colGroup)continue;const F=new Float32Array(k);let O=0;for(let $=h;$<x;$++){if(!m&&$%2!==a>>1||O>=k)continue;const N=m?e[($*t+E)*3+a]:e[$*t+E],C=Number.isFinite(N)?N:0;F[O++]=C}for(let $=0;$<S;$++){const N=Math.floor($*v/2);if(N+v>k)break;const C=F.slice(N,N+v);_.calculateSpectrum(C,A,o),D++}if(!l)break}if(R>0)for(let E=0;E<P.length;E++)P[E]/=R;if(D>0)for(let E=0;E<A.length;E++)A[E]/=D;return{avgHoriz:Array.from(P),avgVert:Array.from(A),sampleCount:{h:R,v:D}}}function PE(e,t,r,n,a,i=!1,o=!1){const s=Math.max(0,Math.floor(n.x)),l=Math.max(0,Math.floor(n.y)),u=Math.min(t,Math.ceil(n.x+n.w)),d=Math.min(r,Math.ceil(n.y+n.h));if(o&&e.length>=t*r*3){if(a<0||a>2)return null;const S=u-s,w=d-l;if(S<=0||w<=0)return null;const v=new Float32Array(S*w);let M=0;for(let A=l;A<d;A++)for(let R=s;R<u;R++)v[M++]=e[(A*t+R)*3+a];const _=kk(v,S,w,i),P=Sk(_,S,w);return{width:S,height:w,data:P}}let h=-1;for(let S=l;S<d;S++)if(S%2===a>>1){h=S;break}if(h===-1)return null;let p=-1;for(let S=s;S<u;S++)if(S%2===(a&1)){p=S;break}if(p===-1)return null;const x=[];for(let S=h;S<d;S+=2){const w=S*t,v=[];for(let M=p;M<u;M+=2)v.push(e[w+M]);x.push(v)}const b=x.length;if(b===0)return null;const y=x[0].length;if(y===0)return null;const m=new Float32Array(y*b);for(let S=0;S<b;S++){const w=x[S];for(let v=0;v<y;v++)m[S*y+v]=w[v]}const g=kk(m,y,b,i),k=Sk(g,y,b);return{width:y,height:b,data:k}}function NE(e,t,r,n,a,i,o,s=!1){const{x:l,y:u,w:d,h:f}=n,h=[],p=Math.max(0,Math.floor(l)),x=Math.max(0,Math.floor(u)),b=Math.min(t,Math.ceil(l+d)),y=Math.min(r,Math.ceil(u+f));if(s&&e.length>=t*r*3){if(a<0||a>2)return null;for(let v=x;v<y;v++){const M=v*t;for(let _=p;_<b;_++){const P=e[(M+_)*3+a];P>=i&&P<=o&&h.push(P-i)}}}else{if(a<0||a>3)return null;const v=a>>1,M=a&1;for(let _=x;_<y;_++){if(_%2!==v)continue;const P=_*t;for(let A=p;A<b;A++){if(A%2!==M)continue;const R=e[P+A];R>=i&&R<=o&&h.push(R-i)}}}if(h.length===0)return null;h.sort((v,M)=>v-M);const g=[h[0]];for(let v=1;v<h.length;v++)h[v]!==h[v-1]&&g.push(h[v]);const k=[],S=[],w={};for(let v=0;v<g.length-1;v++){const M=g[v],P=g[v+1]-M;k.push(P),S.push({x:M,y:P}),w[P]=(w[P]||0)+1}return{uniqueCount:g.length,diffCount:k.length,stepCounts:w,plotData:S}}function Gv(e,t,r){if(!r.advancedZeroDep)throw new Error("Unmixing settings not found in DisplaySettings.");const{bl:n,bg:a,fg:i}=r.advancedZeroDep,{data:o,width:s,whiteLevel:l}=e,u=a.map((k,S)=>Math.max(0,k-n[S])),d=i.map((k,S)=>Math.max(0,k-n[S])),f=(u[1]+u[3])/2,h=(d[1]+d[3])/2,p=Math.floor(t.x),x=Math.floor(t.y),b=Math.floor(t.w),y=Math.floor(t.h),m=Math.pow(2,r.exposure),g=new Uint16Array(b*y);for(let k=0;k<y;k++){const S=x+k;if(S<0||S>=e.height)continue;const w=S%2,v=S*s,M=k*b;for(let _=0;_<b;_++){const P=p+_;if(P<0||P>=s)continue;const A=P%2;let R=0;!w&&!A?R=0:!w&&A?R=1:w&&!A?R=3:R=2;const D=o[v+P],E=n[R],W=u[R],F=d[R],O=Math.max(D-E,0),$=F-W||1e-9,N=(O-W)/$;let C;N<0?C=O*(f/Math.max(W,1e-9)):N>1?C=O*(h/Math.max(F,1e-9)):C=(1-N)*f+N*h,C*=m,g[M+_]=Math.max(0,Math.min(65535,Math.round(C)))}}return{data:g,width:b,height:y}}async function CE(e,t){const r=await Gs(),n=new r;try{const a=new Uint8Array(e.slice(0));let i=!1,o=[];if(t.customMatrix&&t.customMatrix.length===9){const h=[[t.customMatrix[0],t.customMatrix[1],t.customMatrix[2]],[t.customMatrix[3],t.customMatrix[4],t.customMatrix[5]],[t.customMatrix[6],t.customMatrix[7],t.customMatrix[8]]],p=Ro(h);if(p){const x=t.wbGains?t.wbGains[0]:1,b=t.wbGains?t.wbGains[1]:1,m=Kc(p,[[x,0,0],[0,1,0],[0,0,b]]),g=Kc(Fv,m);o=[g[0][0],g[0][1],g[0][2],g[1][0],g[1][1],g[1][2],g[2][0],g[2][1],g[2][2]],i=!0}else throw new Error("Custom Matrix is not invertible.")}const s={outputBps:16,noAutoBright:!0,bright:i?1:Math.pow(2,t.exposure)};t.blackLevel&&t.blackLevel.length===4&&(s.userBlack=0,s.userCblack=t.blackLevel.map(h=>{const p=Math.round(h);return p===0?1:p})),t.demosaicMethod===-1?s.noInterpolation=!0:s.userQual=t.demosaicMethod,i?(s.outputColor=0,s.gamma=[1,1],s.userMul=[1,1,1,1],s.useCameraWb=!1):(s.outputColor=1,s.useCameraWb=!0),await n.open(a,s);const l=await n.imageData(),u=new ImageData(l.width,l.height),d=u.data,f=new Uint16Array(l.data.buffer,l.data.byteOffset,l.data.byteLength/2);if(i&&o.length===9){const h=o,x=Math.pow(2,t.exposure)*.25;for(let b=0;b<f.length;b+=3){const y=f[b]/65535,m=f[b+1]/65535,g=f[b+2]/65535;let k=h[0]*y+h[1]*m+h[2]*g,S=h[3]*y+h[4]*m+h[5]*g,w=h[6]*y+h[7]*m+h[8]*g;k*=x,S*=x,w*=x,k=Math.max(0,Math.min(1,k)),S=Math.max(0,Math.min(1,S)),w=Math.max(0,Math.min(1,w)),k=Ji(k),S=Ji(S),w=Ji(w);const v=b/3*4;d[v]=Math.round(k*255),d[v+1]=Math.round(S*255),d[v+2]=Math.round(w*255),d[v+3]=255}}else for(let h=0;h<f.length;h+=3){const p=h/3*4;d[p]=f[h]>>8,d[p+1]=f[h+1]>>8,d[p+2]=f[h+2]>>8,d[p+3]=255}return u}finally{n.delete?n.delete():n.close()}}async function fx(e,t){const r=await Gs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const b=await n.metadata(!0);b&&b.white_level&&(a=b.white_level)}catch(b){console.warn("Metadata error",b)}const i=n.getRawImage(),o=i.width,s=i.height,l=i.data,u=new ImageData(o,s),d=u.data,f=t.blackLevel||[0,0,0,0],h=a,p=t.wbGains?t.wbGains[0]:1,x=t.wbGains?t.wbGains[1]:1;for(let b=0;b<s;b++){const y=b%2;for(let m=0;m<o;m++){const g=m%2,k=y*2+g,S=l[b*o+m],w=f[k];let v=(S-w)/(h-w);v=Math.max(0,Math.min(1,v)),t.exposure!==0&&(v*=Math.pow(2,t.exposure),v=Math.min(1,v)),k===0?v*=p:k===3&&(v*=x);const M=Math.round(Ji(Math.min(1,v))*255),_=(b*o+m)*4;d[_]=M,d[_+1]=M,d[_+2]=M,d[_+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function OE(e,t){const r=await Gs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const N=await n.metadata(!0);N&&N.white_level&&(a=N.white_level)}catch{}const i=n.getRawImage(),{width:o,height:s,data:l}=i,u=new ImageData(o,s),d=u.data,f=t.blackLevel||[0,0,0,0],h=a,p=t.wbGains?t.wbGains[0]:1,x=t.wbGains?t.wbGains[1]:1,b=Math.pow(2,t.exposure),y=!!t.isBGGR,m=t.zeroDepColorDemosaic==="bilinear"?"bilinear":"amaze";let g=[[1,0,0],[0,1,0],[0,0,1]];if(t.customMatrix&&t.customMatrix.length===9){const N=[[t.customMatrix[0],t.customMatrix[1],t.customMatrix[2]],[t.customMatrix[3],t.customMatrix[4],t.customMatrix[5]],[t.customMatrix[6],t.customMatrix[7],t.customMatrix[8]]],C=Ro(N);C&&(g=Kc(Fv,C))}const k=g[0][0],S=g[0][1],w=g[0][2],v=g[1][0],M=g[1][1],_=g[1][2],P=g[2][0],A=g[2][1],R=g[2][2],D=new Float32Array(o*s);for(let N=0;N<o*s;N++){const C=Math.floor(N/o),B=N%o,I=C%2,z=B%2,V=I*2+z,K=l[N],q=f[V];let G=(K-q)/(h-q);G=Math.max(0,G),y?V===0?G*=x:V===3&&(G*=p):V===0?G*=p:V===3&&(G*=x),D[N]=G}const E=(N,C)=>{const B=Math.max(0,Math.min(o-1,N)),I=Math.max(0,Math.min(s-1,C));return D[I*o+B]},W=(N,C,B)=>{const I=2*C/(N+B+1e-6),z=C+.5*(N-B);return Math.abs(1-I)<.75?N*I:z},F=(N,C)=>{const B=E(N,C),I=W(B,E(N,C-1),E(N,C-2)),z=W(B,E(N,C+1),E(N,C+2)),V=W(B,E(N-1,C),E(N-2,C)),K=W(B,E(N+1,C),E(N+2,C)),q=1/(1e-6+Math.abs(E(N,C-2)-B)+Math.abs(E(N,C-1)-E(N,C+1))),G=1/(1e-6+Math.abs(E(N,C+2)-B)+Math.abs(E(N,C+1)-E(N,C-1))),pe=1/(1e-6+Math.abs(E(N-2,C)-B)+Math.abs(E(N-1,C)-E(N+1,C))),J=1/(1e-6+Math.abs(E(N+2,C)-B)+Math.abs(E(N+1,C)-E(N-1,C))),Z=(q*I+G*z)/(q+G),ae=(pe*V+J*K)/(pe+J),ce=Math.abs(E(N-1,C)-E(N+1,C))+Math.abs(E(N-2,C)-B)+Math.abs(B-E(N+2,C)),ne=Math.abs(E(N,C-1)-E(N,C+1))+Math.abs(E(N,C-2)-B)+Math.abs(B-E(N,C+2)),le=1/(1e-6+ce),se=1/(1e-6+ne);return(le*ae+se*Z)/(le+se)},O=(N,C)=>{const B=E(N,C),I=W(B,E(N+1,C-1),E(N+2,C-2)),z=W(B,E(N-1,C+1),E(N-2,C+2)),V=W(B,E(N-1,C-1),E(N-2,C-2)),K=W(B,E(N+1,C+1),E(N+2,C+2)),q=1/(1e-6+Math.abs(E(N+1,C-1)-E(N-1,C+1))+Math.abs(E(N+2,C-2)-E(N-2,C+2))),G=1/(1e-6+Math.abs(E(N-1,C-1)-E(N+1,C+1))+Math.abs(E(N-2,C-2)-E(N+2,C+2)));return(q*(I+z)+G*(V+K))/(2*(q+G))},$=(N,C,B)=>{const I=E(N,C);if(B){const G=W(I,E(N-1,C),E(N-2,C)),pe=W(I,E(N+1,C),E(N+2,C)),J=1/(1e-6+Math.abs(E(N-2,C)-I)+Math.abs(E(N-1,C)-E(N+1,C))),Z=1/(1e-6+Math.abs(E(N+2,C)-I)+Math.abs(E(N+1,C)-E(N-1,C)));return(J*G+Z*pe)/(J+Z)}const z=W(I,E(N,C-1),E(N,C-2)),V=W(I,E(N,C+1),E(N,C+2)),K=1/(1e-6+Math.abs(E(N,C-2)-I)+Math.abs(E(N,C-1)-E(N,C+1))),q=1/(1e-6+Math.abs(E(N,C+2)-I)+Math.abs(E(N,C+1)-E(N,C-1)));return(K*z+q*V)/(K+q)};for(let N=1;N<s-1;N++){const C=N%2,B=N*o;for(let I=1;I<o-1;I++){const z=I%2,V=B+I;let K=0,q=0,G=0,pe=!1,J=!1,Z=!1;if(!C&&!z?y?J=!0:pe=!0:C&&z?y?pe=!0:J=!0:Z=!0,pe)K=D[V],m==="amaze"?(q=F(I,N),G=O(I,N)):(q=(D[V-1]+D[V+1]+D[V-o]+D[V+o])*.25,G=(D[V-o-1]+D[V-o+1]+D[V+o-1]+D[V+o+1])*.25);else if(J)G=D[V],m==="amaze"?(q=F(I,N),K=O(I,N)):(q=(D[V-1]+D[V+1]+D[V-o]+D[V+o])*.25,K=(D[V-o-1]+D[V-o+1]+D[V+o-1]+D[V+o+1])*.25);else{q=D[V];const se=(D[V-1]+D[V+1])*.5,he=(D[V-o]+D[V+o])*.5;let ue=!1;!C&&z?y?ue=!1:ue=!0:y?ue=!0:ue=!1,m==="amaze"?ue?(K=$(I,N,!0),G=$(I,N,!1)):(G=$(I,N,!0),K=$(I,N,!1)):ue?(K=se,G=he):(G=se,K=he)}let ae=k*K+S*q+w*G,ce=v*K+M*q+_*G,ne=P*K+A*q+R*G;ae*=b,ce*=b,ne*=b,ae=Math.max(0,Math.min(1,ae)),ce=Math.max(0,Math.min(1,ce)),ne=Math.max(0,Math.min(1,ne)),ae=Ji(ae),ce=Ji(ce),ne=Ji(ne);const le=V*4;d[le]=Math.round(ae*255),d[le+1]=Math.round(ce*255),d[le+2]=Math.round(ne*255),d[le+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function AE(e,t){const r=await Gs(),n=new r;try{await n.open(new Uint8Array(e));let a=16383;try{const g=await n.metadata(!0);g&&g.white_level&&(a=g.white_level)}catch(g){console.warn("Metadata error",g)}const i=n.getRawImage(),{width:o,height:s,data:l}=i,u=new ImageData(o,s),d=u.data;if(!t.advancedZeroDep)throw new Error("Missing advanced settings");const{bl:f,bg:h,fg:p}=t.advancedZeroDep,x=h.map((g,k)=>Math.max(0,g-f[k])),b=p.map((g,k)=>Math.max(0,g-f[k])),y=(x[1]+x[3])/2,m=(b[1]+b[3])/2;for(let g=0;g<s;g++){const k=g%2;for(let S=0;S<o;S++){const w=S%2;let v=0;!k&&!w?v=0:!k&&w?v=1:k&&!w?v=3:v=2;const M=l[g*o+S],_=f[v],P=x[v],A=b[v],R=Math.max(M-_,0),D=A-P||1e-9,E=(R-P)/D;let W;E<0?W=R*(y/Math.max(P,1e-9)):E>1?W=R*(m/Math.max(A,1e-9)):W=(1-E)*y+E*m;let F=W/65535;F=Math.max(0,Math.min(1,F));const O=Math.round(Ji(F)*255),$=(g*o+S)*4;d[$]=O,d[$+1]=O,d[$+2]=O,d[$+3]=255}}return u}finally{n.delete?n.delete():n.close()}}async function eP(e,t,r=!1,n=!1){const a=await Gs(),i=new a;try{if(t.renderMode==="zero-dependency"||t.renderMode==="advanced-zero-dep"){await i.open(new Uint8Array(e));const o=await i.metadata(!0),s=(o==null?void 0:o.white_level)||16383,l=i.getRawImage(),{width:u,height:d,data:f}=l,h=new Uint16Array(u*d),p=Math.pow(2,t.exposure);if(t.renderMode==="advanced-zero-dep"&&t.advancedZeroDep){const{bl:x,bg:b,fg:y}=t.advancedZeroDep,m=b.map((w,v)=>Math.max(0,w-x[v])),g=y.map((w,v)=>Math.max(0,w-x[v])),k=(m[1]+m[3])/2,S=(g[1]+g[3])/2;for(let w=0;w<d;w++){const v=w%2;for(let M=0;M<u;M++){const _=M%2;let P=0;!v&&!_?P=0:!v&&_?P=1:v&&!_?P=3:P=2;const A=f[w*u+M],R=x[P],D=m[P],E=g[P],W=Math.max(A-R,0),F=E-D||1e-9,O=(W-D)/F;let $;O<0?$=W*(k/Math.max(D,1e-9)):O>1?$=W*(S/Math.max(E,1e-9)):$=(1-O)*k+O*S,$*=p;let N;if(n){const C=Math.max(0,Math.min(1,$/65535));N=Ji(C)*65535}else N=$;h[w*u+M]=Math.round(Math.max(0,Math.min(65535,N)))}}}else{const x=t.blackLevel||[0,0,0,0],b=t.wbGains?t.wbGains[0]:1,y=t.wbGains?t.wbGains[1]:1;for(let m=0;m<d;m++){const g=m%2;for(let k=0;k<u;k++){const S=k%2,w=g*2+S,v=f[m*u+k],M=x[w];let _=v-M;w===0?_*=b:w===3&&(_*=y),_*=p;const P=Math.max(0,Math.min(1,_/(r?s-M:s))),A=n?Ji(P):P;h[m*u+k]=Math.round(A*65535)}}}return{data:h,width:u,height:d,channels:1}}else{const o=new Uint8Array(e.slice(0)),s={outputBps:16,noAutoBright:!r,bright:1,outputColor:n?1:0,useCameraWb:!0};t.blackLevel&&t.blackLevel.length===4&&(s.userBlack=0,s.userCblack=t.blackLevel.map(f=>Math.max(1,Math.round(f)))),t.demosaicMethod===-1?s.noInterpolation=!0:s.userQual=t.demosaicMethod,await i.open(o,s);const l=await i.imageData(),u=new Uint16Array(l.data.buffer,l.data.byteOffset,l.data.byteLength/2),d=Math.pow(2,t.exposure);if(d!==1)for(let f=0;f<u.length;f++)u[f]=Math.max(0,Math.min(65535,Math.round(u[f]*d)));return{data:u,width:l.width,height:l.height,channels:3}}}finally{i.delete?i.delete():i.close()}}async function TE(e,t){const r={...t,renderMode:"standard",demosaicMethod:t.demosaicMethod===-1?3:t.demosaicMethod},n=await eP(e,r,!1,!1),a=n.width*n.height,i=new Float32Array(a*3);if(n.channels===3)for(let o=0;o<n.data.length;o++)i[o]=n.data[o]/65535;else for(let o=0;o<a;o++){const s=n.data[o]/65535,l=o*3;i[l]=s,i[l+1]=s,i[l+2]=s}return{data:i,width:n.width,height:n.height}}const EE=Object.assign({"../lensfun/6x6.xml":()=>ct(()=>import("./6x6-Dud9lWUd.js"),[]).then(e=>e.default),"../lensfun/actioncams.xml":()=>ct(()=>import("./actioncams-Cg5HQ60A.js"),[]).then(e=>e.default),"../lensfun/compact-canon.xml":()=>ct(()=>import("./compact-canon-BDgHCadq.js"),[]).then(e=>e.default),"../lensfun/compact-casio.xml":()=>ct(()=>import("./compact-casio-CDzufeyu.js"),[]).then(e=>e.default),"../lensfun/compact-fujifilm.xml":()=>ct(()=>import("./compact-fujifilm-BuFyPBlo.js"),[]).then(e=>e.default),"../lensfun/compact-kodak.xml":()=>ct(()=>import("./compact-kodak-DICTBwTD.js"),[]).then(e=>e.default),"../lensfun/compact-konica-minolta.xml":()=>ct(()=>import("./compact-konica-minolta-BKI4omr1.js"),[]).then(e=>e.default),"../lensfun/compact-leica.xml":()=>ct(()=>import("./compact-leica-B1Fqeeu3.js"),[]).then(e=>e.default),"../lensfun/compact-nikon.xml":()=>ct(()=>import("./compact-nikon-Q231DWRs.js"),[]).then(e=>e.default),"../lensfun/compact-olympus.xml":()=>ct(()=>import("./compact-olympus-BmAKd-oF.js"),[]).then(e=>e.default),"../lensfun/compact-panasonic.xml":()=>ct(()=>import("./compact-panasonic-DJuEnLOf.js"),[]).then(e=>e.default),"../lensfun/compact-pentax.xml":()=>ct(()=>import("./compact-pentax-CK-wShH4.js"),[]).then(e=>e.default),"../lensfun/compact-ricoh.xml":()=>ct(()=>import("./compact-ricoh-DbsLlRAS.js"),[]).then(e=>e.default),"../lensfun/compact-samsung.xml":()=>ct(()=>import("./compact-samsung-CBNQmwIs.js"),[]).then(e=>e.default),"../lensfun/compact-sigma.xml":()=>ct(()=>import("./compact-sigma-Ce4mbNmr.js"),[]).then(e=>e.default),"../lensfun/compact-sony.xml":()=>ct(()=>import("./compact-sony-aE387uCd.js"),[]).then(e=>e.default),"../lensfun/contax.xml":()=>ct(()=>import("./contax-lfgVw8XE.js"),[]).then(e=>e.default),"../lensfun/generic.xml":()=>ct(()=>import("./generic-CnlCoerb.js"),[]).then(e=>e.default),"../lensfun/mil-canon.xml":()=>ct(()=>import("./mil-canon-CsP2d6LD.js"),[]).then(e=>e.default),"../lensfun/mil-fujifilm.xml":()=>ct(()=>import("./mil-fujifilm-F3oKEIYZ.js"),[]).then(e=>e.default),"../lensfun/mil-hasselblad.xml":()=>ct(()=>import("./mil-hasselblad-DeXxLlTg.js"),[]).then(e=>e.default),"../lensfun/mil-leica.xml":()=>ct(()=>import("./mil-leica-Czic2o9o.js"),[]).then(e=>e.default),"../lensfun/mil-nikon.xml":()=>ct(()=>import("./mil-nikon-DkZbaqBH.js"),[]).then(e=>e.default),"../lensfun/mil-olympus.xml":()=>ct(()=>import("./mil-olympus-DWRA_NNZ.js"),[]).then(e=>e.default),"../lensfun/mil-panasonic.xml":()=>ct(()=>import("./mil-panasonic-CsQ7Qk1h.js"),[]).then(e=>e.default),"../lensfun/mil-pentax.xml":()=>ct(()=>import("./mil-pentax-ClXRigoa.js"),[]).then(e=>e.default),"../lensfun/mil-samsung.xml":()=>ct(()=>import("./mil-samsung-BbQ5TjXi.js"),[]).then(e=>e.default),"../lensfun/mil-samyang.xml":()=>ct(()=>import("./mil-samyang-CyxQtljS.js"),[]).then(e=>e.default),"../lensfun/mil-sigma.xml":()=>ct(()=>import("./mil-sigma-C4H9prlz.js"),[]).then(e=>e.default),"../lensfun/mil-sony.xml":()=>ct(()=>import("./mil-sony-D2U1LHts.js"),[]).then(e=>e.default),"../lensfun/mil-tamron.xml":()=>ct(()=>import("./mil-tamron-B5g4hRYO.js"),[]).then(e=>e.default),"../lensfun/mil-tokina.xml":()=>ct(()=>import("./mil-tokina-Cs1l9ZTO.js"),[]).then(e=>e.default),"../lensfun/mil-zeiss.xml":()=>ct(()=>import("./mil-zeiss-avF4V-6T.js"),[]).then(e=>e.default),"../lensfun/misc.xml":()=>ct(()=>import("./misc-DDds1gXl.js"),[]).then(e=>e.default),"../lensfun/om-system.xml":()=>ct(()=>import("./om-system-DiAB48fM.js"),[]).then(e=>e.default),"../lensfun/rf-leica.xml":()=>ct(()=>import("./rf-leica-B--SzUq2.js"),[]).then(e=>e.default),"../lensfun/slr-canon.xml":()=>ct(()=>import("./slr-canon-CgVCqXGM.js"),[]).then(e=>e.default),"../lensfun/slr-hasselblad.xml":()=>ct(()=>import("./slr-hasselblad-C1loeXzI.js"),[]).then(e=>e.default),"../lensfun/slr-konica-minolta.xml":()=>ct(()=>import("./slr-konica-minolta-D38k_LOC.js"),[]).then(e=>e.default),"../lensfun/slr-leica.xml":()=>ct(()=>import("./slr-leica-c2xbyark.js"),[]).then(e=>e.default),"../lensfun/slr-nikon.xml":()=>ct(()=>import("./slr-nikon-CRCAIYTn.js"),[]).then(e=>e.default),"../lensfun/slr-olympus.xml":()=>ct(()=>import("./slr-olympus-dFRFPB-U.js"),[]).then(e=>e.default),"../lensfun/slr-panasonic.xml":()=>ct(()=>import("./slr-panasonic-JG8UEfod.js"),[]).then(e=>e.default),"../lensfun/slr-pentax.xml":()=>ct(()=>import("./slr-pentax-CFNePcmx.js"),[]).then(e=>e.default),"../lensfun/slr-ricoh.xml":()=>ct(()=>import("./slr-ricoh-9U2ATHkn.js"),[]).then(e=>e.default),"../lensfun/slr-samsung.xml":()=>ct(()=>import("./slr-samsung-C2vmR_UF.js"),[]).then(e=>e.default),"../lensfun/slr-samyang.xml":()=>ct(()=>import("./slr-samyang-DNuAvYvk.js"),[]).then(e=>e.default),"../lensfun/slr-schneider.xml":()=>ct(()=>import("./slr-schneider-BFavwTAS.js"),[]).then(e=>e.default),"../lensfun/slr-sigma.xml":()=>ct(()=>import("./slr-sigma-CkwWa641.js"),[]).then(e=>e.default),"../lensfun/slr-soligor.xml":()=>ct(()=>import("./slr-soligor-CoIp1oZj.js"),[]).then(e=>e.default),"../lensfun/slr-sony.xml":()=>ct(()=>import("./slr-sony-BgsLb2KN.js"),[]).then(e=>e.default),"../lensfun/slr-tamron.xml":()=>ct(()=>import("./slr-tamron-DqtWr6vk.js"),[]).then(e=>e.default),"../lensfun/slr-tokina.xml":()=>ct(()=>import("./slr-tokina-DQ0zZu9T.js"),[]).then(e=>e.default),"../lensfun/slr-ussr.xml":()=>ct(()=>import("./slr-ussr-Bfn2DNi9.js"),[]).then(e=>e.default),"../lensfun/slr-vivitar.xml":()=>ct(()=>import("./slr-vivitar-CIhiFdqq.js"),[]).then(e=>e.default),"../lensfun/slr-zeiss.xml":()=>ct(()=>import("./slr-zeiss-DzcVUeAm.js"),[]).then(e=>e.default)}),Qo=({title:e,children:t})=>c.jsxs("div",{className:"border-b border-gray-200 dark:border-slate-700 transition-colors duration-300",children:[c.jsx("div",{className:"p-4 font-semibold text-gray-800 dark:text-slate-200 bg-gray-50 dark:bg-slate-800/30 border-b border-gray-200 dark:border-slate-800 select-none cursor-default transition-colors duration-300",children:c.jsx("span",{children:e})}),c.jsx("div",{className:"p-4 bg-white dark:bg-slate-900/50 transition-colors duration-300",children:t})]}),IE=[{value:-1,label:"Raw Bayer (Grayscale)"},{value:0,label:"Linear interpolation"},{value:1,label:"VNG (Variable Number of Gradients)"},{value:2,label:"PPG (Patterned Pixel Grouping)"},{value:3,label:"AHD (Adaptive Homogeneity-Directed)"},{value:4,label:"DCB (Demosaicing with Color Back-refinement)"},{value:11,label:"DHT (Modified AHD)"},{value:12,label:"AAHD (Adaptive AHD)"}],F0=({checked:e,onChange:t,label:r})=>c.jsxs("div",{className:"flex items-center justify-between py-2 cursor-pointer group",onClick:()=>t(!e),children:[c.jsx("span",{className:"text-sm font-medium text-gray-600 dark:text-slate-300 select-none group-hover:text-gray-900 dark:group-hover:text-slate-200 transition-colors",children:r}),c.jsx("div",{className:`relative w-11 h-6 rounded-full transition-colors duration-200 ease-in-out ${e?"bg-cyan-500 dark:bg-cyan-600":"bg-gray-300 dark:bg-slate-600 group-hover:bg-gray-400 dark:group-hover:bg-slate-500"}`,children:c.jsx("div",{className:`absolute left-1 top-1 bg-white w-4 h-4 rounded-full shadow-md transform transition-transform duration-200 ease-in-out ${e?"translate-x-5":"translate-x-0"}`})})]}),hx=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];return f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},px=e=>{if(typeof e=="number"&&Number.isFinite(e))return e;if(typeof e!="string")return null;const t=e.match(/-?\d+(\.\d+)?/);if(!t)return null;const r=Number(t[0]);return Number.isFinite(r)?r:null},Yk=(e,t)=>{var o,s,l,u;const n=new DOMParser().parseFromString(e,"application/xml");if(n.getElementsByTagName("parsererror").length>0)throw new Error(`Invalid XML in ${t}`);const a=Array.from(n.getElementsByTagName("lens")),i=[];for(const d of a){const f=((s=(o=d.getElementsByTagName("maker")[0])==null?void 0:o.textContent)==null?void 0:s.trim())||"",h=((u=(l=d.getElementsByTagName("model")[0])==null?void 0:l.textContent)==null?void 0:u.trim())||"",p=[],x=Array.from(d.getElementsByTagName("distortion"));for(const m of x){const g=(m.getAttribute("model")||"").toLowerCase(),k=Number(m.getAttribute("focal"));if(!Number.isFinite(k)||g!=="poly3"&&g!=="poly5"&&g!=="ptlens")continue;const S={model:g,focal:k,k1:Number(m.getAttribute("k1"))||0,k2:Number(m.getAttribute("k2"))||0,a:Number(m.getAttribute("a"))||0,b:Number(m.getAttribute("b"))||0,c:Number(m.getAttribute("c"))||0};p.push(S)}if(p.length===0)continue;p.sort((m,g)=>m.focal-g.focal);const y=([f,h].filter(Boolean).join(" ")||"Unnamed Lens").trim();i.push({id:`${t}:${y}:${i.length}`,label:y,distortions:p})}return i},qk=(e,t)=>{const r=new Map;for(const n of e)r.set(n.id,n);for(const n of t)r.set(n.id,n);return Array.from(r.values()).sort((n,a)=>n.label.localeCompare(a.label))},RE=(e,t,r)=>{if(e.model!==t.model||Math.abs(t.focal-e.focal)<1e-8)return{...e,focal:r};const n=Math.max(0,Math.min(1,(r-e.focal)/(t.focal-e.focal))),a=(i,o)=>(i||0)*(1-n)+(o||0)*n;return{model:e.model,focal:r,k1:a(e.k1,t.k1),k2:a(e.k2,t.k2),a:a(e.a,t.a),b:a(e.b,t.b),c:a(e.c,t.c)}},DE=(e,t)=>{if(!e.length||!Number.isFinite(t))return null;if(e.length===1)return{...e[0],focal:t};let r=e[0],n=e[e.length-1];for(let a=0;a<e.length;a++){const i=e[a];if(i.focal<=t&&(r=i),i.focal>=t){n=i;break}}return r.focal===n.focal?{...r,focal:t}:r.model!==n.model?{...Math.abs(r.focal-t)<=Math.abs(n.focal-t)?r:n,focal:t}:RE(r,n,t)},$E=e=>{var u0,d0,f0;const{rawImageData:t,displaySettings:r,onApplyDisplaySettings:n,onSetSelection:a,exifData:i,isBridgeConnected:o,isDrLabOpen:s,drMarkingStep:l,onStartMarking:u,onGenerateTestPic:d,drRoiSize:f,onDrRoiSizeChange:h,drGridRows:p,onDrGridRowsChange:x,drGridCols:b,onDrGridColsChange:y,onBatchDrLab:m,hasDrMarkers:g,isFftLabOpen:k,onProcessPair:S,onProcessBatchDiff:w,onProcessStackFft:v,onOpenCrossCalc:M,isThreePlane:_,onToggleXTrans:P,xtransPhase:A,onXTransPhaseChange:R,isXTransConverted:D,onCommand:E,isColorLabOpen:W,colorLabMarkingStep:F,onStartColorLabMarking:O,isSfrLabOpen:$,roiStats:N,isBGGR:C,onOpenDngExport:B,sfrRectCount:I,isBatchMarkingMode:z,onToggleBatchMarking:V,onClearBatchMarks:K,onBatchCompute:q,stdChartStep:G,onStartStandardCalibration:pe,onSaveBatchTemplate:J,onImportBatchTemplate:Z,onBatchTransform:ae,onOpenStackingTool:ce,isPsModeOpen:ne,psDocument:le,psBrushEnabled:se,psBrushSize:he,psBrushOpacity:ue,psBrushFeather:ie,psEllipseFeather:xe,psBrushMode:Se,onPsAddMask:Ie,onPsAddEllipseMask:te,onPsCancelEllipseTool:Oe,onPsFlipHorizontal:Fe,onPsFlipVertical:bt,onPsCropToRoi:Ct,onPsRotateCanvas:ut,onPsApplyUpright:dt,onPsApplyLensDistortion:ht,onPsSelectLayer:tt,onPsSelectMask:vt,onPsBindLayerMask:Sr,onPsSetLayerBlendMode:Ft,onPsSetLayerOpacity:rt,onPsSetLayerBasic:Kt,onPsSetLayerMixer:lr,onPsPreviewLayerBasic:Vt,onPsPreviewLayerMixer:gr,onPsSetLayerCurves:Zt,onPsSelectMaskItem:zt,onPsUpdateEllipseItem:rr,onPsSetMaskOverlayVisible:Ot,onPsAddGuide:_e,onPsSelectGuide:ee,onPsSetGuideEndpoints:ve,psGuidePickTarget:de,onPsStartGuidePointPick:De,onPsCancelGuidePointPick:Ye,onPsDeleteGuide:st,onPsUndo:_t,onPsJumpHistoryIndex:Xe,onPsExportWorkflowCsv:Ar,onPsImportWorkflowCsv:nr,onPsExportPng:Gt,onPsExportJpeg:mt,onPsBrushEnabledChange:Jt,onPsBrushSizeChange:Pr,onPsBrushOpacityChange:Zr,onPsBrushFeatherChange:jr,onPsEllipseFeatherChange:we,onPsBrushModeChange:Je}=e,Qe=!!t,Qt=!!(t!=null&&t.isXTrans),Ht=!!P,it=j.useMemo(()=>!le||!le.selectedGuideId?null:le.guides.find(H=>H.id===le.selectedGuideId)||null,[le]),cr=j.useMemo(()=>{var H;return(H=le==null?void 0:le.history)!=null&&H.length?le.history.map((be,at)=>({entry:be,index:at})).reverse():[]},[le]),[pr,It]=j.useState("0"),Tt=j.useCallback(()=>{const H=Number(pr);Number.isFinite(H)&&(ut==null||ut(H))},[pr,ut]),Ae=j.useRef(!1),Yt=j.useRef(null),L=()=>{Ae.current=!0},ke=()=>{Ae.current=!1},[Pe,jt]=j.useState(r.exposure.toString()),[Be,nt]=j.useState(""),[Ue,er]=j.useState("0 0 0 0"),[Tr,Rr]=j.useState("1.0"),[Ut,rn]=j.useState("1.0"),[ln,On]=j.useState(r.demosaicMethod),[ur,Wt]=j.useState(!!r.showKadc),[ar,We]=j.useState(!!r.subtractBlackLevelFromStats),[$t,Nr]=j.useState(!!r.highlightRecovery),[cn,ea]=j.useState(((u0=t==null?void 0:t.whiteLevel)==null?void 0:u0.toString())||((d0=r.customWhiteLevel)==null?void 0:d0.toString())||"16383"),[vn,ja]=j.useState("64"),[oe,me]=j.useState(!1),[je,Q]=j.useState(""),[$e,Ke]=j.useState(""),[ot,wt]=j.useState(""),[Rt,yt]=j.useState(!1),[ir,dr]=j.useState(!1),[Cr,Fr]=j.useState(!1),[Ne,Lt]=j.useState("amaze"),[et,Mr]=j.useState(!1),[vr,wn]=j.useState(!1),[mr,Jr]=j.useState("single"),[Gn,Fi]=j.useState(!1),[Gi,Wu]=j.useState(!0),[Ys,Vu]=j.useState(!0),[Jl,nn]=j.useState(!1),[La,lo]=j.useState(10),[Ba,co]=j.useState(1.05),Ui=j.useMemo(()=>Object.keys(Zc).sort(),[]),uo=j.useRef(null),qs=j.useRef(null),zi=j.useRef(null),zo=j.useRef(null),[ze,tr]=j.useState(null),[kt,qt]=j.useState(null),[un,da]=j.useState(!1),[gn,bi]=j.useState(!0),Xn=j.useRef(null),Ma=j.useRef(null),Gr=j.useRef(null),ta=j.useRef(null),fo=j.useRef(null),[Wo,Zs]=j.useState([]),[pt,Ql]=j.useState(""),[xt,Vo]=j.useState(""),[Ho,Js]=j.useState(!1),[Hu,_a]=j.useState("Built-in Lensfun database will load when PS Mode opens."),a0=j.useRef(!1);j.useEffect(()=>{if(!ne||a0.current)return;a0.current=!0;let H=!1;return(async()=>{_a("Loading built-in Lensfun database...");const at=Object.entries(EE);if(at.length===0){H||_a("No built-in Lensfun XML found in /lensfun. You can still load XML manually.");return}const Xt=[];let $r=0;for(const[wr,ra]of at){const po=wr.split("/").pop()||wr;try{const ti=await ra();Xt.push(...Yk(ti,po))}catch{$r++}}if(H)return;if(Xt.length===0){_a("Built-in Lensfun XML loaded, but no supported distortion profiles were found.");return}Zs(wr=>qk(wr,Xt)),Ql(wr=>wr||Xt[0].id);const An=$r>0?` (${$r} file(s) skipped)`:"";_a(`Built-in Lensfun ready: ${Xt.length} profile(s) from ${at.length} XML file(s)${An}.`)})(),()=>{H=!0}},[ne]),j.useEffect(()=>{if(xt.trim())return;const H=px(i==null?void 0:i.FocalLength)??px(i==null?void 0:i.FocalLength35efl)??px(i==null?void 0:i.FocalLengthIn35mmFormat);H&&H>0&&Vo(H.toFixed(1))},[i,xt]),j.useEffect(()=>{const H=t!==Yt.current;if(H&&(Yt.current=t,ke()),jt(r.exposure.toString()),r.customMatrix?nt(r.customMatrix.join(" ")):nt(""),r.blackLevel&&r.blackLevel.length===4)er(r.blackLevel.join(" "));else{const be=hx(t,i);be&&be.some(at=>at!==0)?er(be.join(" ")):er("")}Rr(r.wbGains?r.wbGains[0].toString():"1.0"),rn(r.wbGains?r.wbGains[1].toString():"1.0"),On(r.demosaicMethod),Wt(!!r.showKadc),We(!!r.subtractBlackLevelFromStats),H?(Nr(!1),t!=null&&t.whiteLevel?ea(t.whiteLevel.toString()):r.customWhiteLevel&&ea(r.customWhiteLevel.toString())):(Nr(!!r.highlightRecovery),r.customWhiteLevel?ea(r.customWhiteLevel.toString()):t!=null&&t.whiteLevel&&ea(t.whiteLevel.toString())),r.advancedZeroDep&&(Q(r.advancedZeroDep.bl.join(" ")),Ke(r.advancedZeroDep.bg.join(" ")),wt(r.advancedZeroDep.fg.join(" ")),H&&me(!0))},[r,t,i]);const Qs=j.useRef(!1),ho=j.useRef(null);j.useEffect(()=>{t!==ho.current&&(Qs.current=!1,ho.current=t)},[t]),j.useEffect(()=>{if(o&&t&&!Qs.current){Qs.current=!0;const H=hx(t,i),be=H&&H.some(at=>at>0);if(H&&be){console.log("[AutoApply] Detected Black Levels via Bridge:",H);const at={...r,blackLevel:H,showKadc:!1,subtractBlackLevelFromStats:!1,exposure:r.exposure,wbGains:r.wbGains||[1,1],demosaicMethod:-1,renderMode:"zero-dependency"};n(at)}}},[o,t,i,r,n]);const i0=H=>{L(),jt(H)},o0=H=>{L(),Rr(H)},pm=H=>{L(),rn(H)},Xu=H=>{L(),On(parseInt(H.target.value,10))},s0=H=>{L(),nt(H.target.value)},ei=()=>{ke(),jt("0"),On(3),Rr("1.0"),rn("1.0"),Wt(!0),We(!0),nt(""),Nr(!1),ea((t==null?void 0:t.whiteLevel.toString())||"16383"),me(!1);const H=hx(t,i);er(H&&H.some(be=>be!==0)?H.join(" "):"")},Fa=()=>{!t||!a||(a({x:0,y:0,w:t.width,h:t.height}),E==null||E("sel full"))},Ga=()=>{if(!t||!a)return;const H=parseInt(vn,10);if(isNaN(H)||H<=0)return;const be=Math.min(H,t.width),at=Math.min(H,t.height),Xt=Math.floor((t.width-be)/2),$r=Math.floor((t.height-at)/2);a({x:Xt,y:$r,w:be,h:at}),E==null||E(`sel center ${H}`)},ec=()=>{if(!t||!N){alert("Please select a region on the image first.");return}const H=Ku()||[0,0,0,0],be=Be.trim().replace(/[\s,\n]+/g," "),at=be?be.split(" ").map(Number):[1,0,0,0,1,0,0,0,1];if(at.length!==9){alert("Matrix must be 3x3 (9 values).");return}const[Xt,$r]=SE(t.data,t.width,{x:N.x,y:N.y,w:N.width,h:N.height},H,at,C);L(),Rr(Xt.toFixed(4)),rn($r.toFixed(4)),E==null||E(`wb ${Xt.toFixed(4)} ${$r.toFixed(4)} (Spot)`)},Ku=()=>{const be=Ue.split(/[\s,]+/).filter(at=>at.trim()!=="").map(Number);if(be.length===1&&!isNaN(be[0]))return[be[0],be[0],be[0],be[0]];if(be.length>=4&&!be.slice(0,4).some(isNaN))return[be[0],be[1],be[2],be[3]]},Yu=H=>{const be=H.trim().split(/[\s,]+/).map(Number);return be.length===4&&!be.some(isNaN)?be:be.length===1&&!isNaN(be[0])?[be[0],be[0],be[0],be[0]]:null},l0=()=>{ke(),E&&(Pe!=="0"&&E(`ev ${Pe}`),(Tr!=="1.0"||Ut!=="1.0")&&E(`wb ${Tr} ${Ut}`),Ue!=="0 0 0 0"&&Ue!==""&&E(`bl ${Ue}`),ln!==3&&E(`demo ${ln}`),Be.trim().length>0&&E(`matrix ${Be.replace(/\s+/g," ")}`),E("render"));const H={...r},be=parseFloat(Pe);isNaN(be)||(H.exposure=be);const at=parseFloat(Tr),Xt=parseFloat(Ut);!isNaN(at)&&!isNaN(Xt)&&(H.wbGains=[at,Xt]),H.demosaicMethod=ln,H.renderMode="standard";const $r=Ku();$r?H.blackLevel=$r:delete H.blackLevel;const An=Be.trim().replace(/[\s,\n]+/g," ");if(An){const wr=An.split(" ").map(Number);wr.length===9&&!wr.some(isNaN)?H.customMatrix=wr:alert("Invalid matrix format. Please ensure exactly 9 numeric values (3x3).")}else delete H.customMatrix;if(H.showKadc=ur,H.subtractBlackLevelFromStats=ar,H.highlightRecovery=$t,$t){const wr=parseFloat(cn);!isNaN(wr)&&wr>0&&(H.customWhiteLevel=wr)}else delete H.customWhiteLevel;n(H)},qu=()=>{Fr(C||!1),Lt("amaze"),dr(!0)},el=H=>{ke(),E&&(Pe!=="0"&&E(`ev ${Pe}`),(Tr!=="1.0"||Ut!=="1.0")&&E(`wb ${Tr} ${Ut}`),Ue!=="0 0 0 0"&&Ue!==""&&E(`bl ${Ue}`),E(H==="color"?"render zero color":"render zero"));const be={...r},at=Ku();at&&(be.blackLevel=at);const Xt=parseFloat(Tr),$r=parseFloat(Ut);!isNaN(Xt)&&!isNaN($r)&&(be.wbGains=[Xt,$r]);const An=parseFloat(Pe);if(isNaN(An)||(be.exposure=An),H==="color"){const wr=Be.trim().replace(/[\s,\n]+/g," ");if(wr){const ra=wr.split(" ").map(Number);ra.length===9&&!ra.some(isNaN)&&(be.customMatrix=ra)}be.isBGGR=Cr,be.zeroDepColorDemosaic=Ne}if(be.renderMode=H==="mosaic"?"zero-dependency":"zero-dep-color",be.showKadc=ur,be.subtractBlackLevelFromStats=ar,be.highlightRecovery=$t,$t){const wr=parseFloat(cn);!isNaN(wr)&&wr>0&&(be.customWhiteLevel=wr)}else delete be.customWhiteLevel;dr(!1),n(be)},tc=()=>{ke();const H=Yu(je),be=Yu($e),at=Yu(ot);if(!H||!be||!at){alert("Please enter valid 4-channel numbers for BL, BG, and FG.");return}E&&(Pe!=="0"&&E(`ev ${Pe}`),E(`render unmix ${H.join(" ")} ${be.join(" ")} ${at.join(" ")}`));const Xt={...r,renderMode:"advanced-zero-dep",advancedZeroDep:{bl:H,bg:be,fg:at}};if(Xt.showKadc=ur,Xt.subtractBlackLevelFromStats=ar,Xt.highlightRecovery=$t,$t){const $r=parseFloat(cn);!isNaN($r)&&$r>0&&(Xt.customWhiteLevel=$r)}n(Xt)},gm=()=>{if(N){const H=N.means,be=[H[0],H[1],H[3],H[2]].map(at=>at.toFixed(1));L(),Ke(be.join(" "))}else alert("Please select an ROI on the image first.")},lt=()=>{if(N){const H=N.means,be=[H[0],H[1],H[3],H[2]].map(at=>at.toFixed(1));L(),wt(be.join(" "))}else alert("Please select an ROI on the image first.")},mm=H=>{H.target.files&&H.target.files.length>0&&m&&(m(H.target.files,mr),E==null||E(`drlab batch ${mr}`)),H.target.value="",wn(!1)},xm=async H=>{var at;const be=(at=H.target.files)==null?void 0:at[0];if(!(!be||!Z)){try{const $r=(await be.text()).split(`
`),An=[];for(let wr of $r){if(wr=wr.trim(),!wr||wr.toLowerCase().startsWith("index"))continue;const ra=wr.split(",").map(Number);if(ra.length>=5){const po=ra[1],ti=ra[2],Yo=ra[3],go=ra[4],fa=ra[5];!isNaN(po)&&!isNaN(ti)&&!isNaN(Yo)&&!isNaN(go)&&An.push({x:po,y:ti,w:Yo,h:go,ori:isNaN(fa)?void 0:fa})}}Z(An),alert(`Imported ${An.length} ROIs successfully.`)}catch(Xt){console.error("Import failed",Xt),alert("Failed to import CSV: "+Xt.message)}H.target.value=""}},Xo=async H=>{var at;const be=(at=H.target.files)==null?void 0:at[0];if(be){try{const $r=(await be.text()).split(`
`),An=[];An.push("#BlackLevel: 0,0,0,0"),An.push("#ImageHeight: 0"),An.push("Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std");let wr=1;for(let Yo=0;Yo<$r.length;Yo++){const go=$r[Yo].trim();if(!go||go.includes("R_mean")||go.includes("R_std"))continue;const fa=go.split(/\s+/).map(Number);if(fa.length<8||fa.some(isNaN))continue;const _m=[wr,1,fa[0],fa[2],fa[6],fa[4],fa[1],fa[3],fa[7],fa[5]].join(",");An.push(_m),wr++}const ra=new Blob([An.join(`
`)],{type:"text/csv"}),po=URL.createObjectURL(ra),ti=document.createElement("a");ti.href=po,ti.download=be.name.replace(/\.[^/.]+$/,"")+"_converted.csv",document.body.appendChild(ti),ti.click(),document.body.removeChild(ti),URL.revokeObjectURL(po)}catch(Xt){console.error("Conversion failed",Xt),alert("Failed to convert file.")}H.target.value=""}},rc=H=>{H.target.files&&H.target.files[0]&&(tr(H.target.files[0]),E==null||E("fft load a"))},nc=H=>{H.target.files&&H.target.files[0]&&(qt(H.target.files[0]),E==null||E("fft load b"))},ym=()=>{ze&&kt&&S&&(S(ze,kt,un,gn),E==null||E("fft run"))},bm=H=>{H.target.files&&H.target.files.length>0&&w&&(w(H.target.files),E==null||E("fft batch")),H.target.value=""},vm=H=>{H.target.files&&H.target.files.length>0&&v&&(v(H.target.files),E==null||E("fft stack")),H.target.value=""},wm=()=>{q&&(q({useNR:Gi,useDeshading:Ys,greenOnly:Jl}),E==null||E("batch compute"))},Ko=(H,be,at)=>{ae&&ae(H,be,at)},km=H=>{var at;const be=(at=H.target.files)==null?void 0:at[0];be&&nr&&nr(be),H.target.value=""},Sm=async H=>{const be=H.target.files;if(!(!be||be.length===0))try{const at=[];for(const Xt of Array.from(be)){const $r=await Xt.text();at.push(...Yk($r,Xt.name))}if(at.length===0){_a("No supported distortion profiles found in selected XML.");return}Zs(Xt=>qk(Xt,at)),Ql(Xt=>Xt||at[0].id),_a(`Added ${at.length} lens profile(s) from ${be.length} file(s).`)}catch(at){_a(`Lensfun load failed: ${(at==null?void 0:at.message)||at}`)}finally{H.target.value=""}},c0=()=>{if(!Ho||!ht)return;const H=Number(xt);if(!Number.isFinite(H)||H<=0){_a("Set a valid focal length (mm) before applying correction.");return}const be=Wo.find(Xt=>Xt.id===pt);if(!be){_a("Select a lens profile first.");return}const at=DE(be.distortions,H);if(!at){_a("No usable distortion coefficients for this lens.");return}ht({...at,focal:H,lensLabel:be.label}),_a(`Applied ${be.label} correction at ${H.toFixed(1)}mm (${at.model}).`)},jm=je.trim()!==""&&$e.trim()!==""&&ot.trim()!=="",Mm=r.renderMode==="advanced-zero-dep";return c.jsxs("div",{className:"flex flex-col h-full bg-white dark:bg-black",children:[c.jsxs("div",{className:"flex-grow overflow-y-auto",children:[_&&c.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 p-3 border-b border-red-100 dark:border-red-800 text-center animate-pulse",children:[c.jsx("p",{className:"text-xs font-bold text-red-600 dark:text-red-400 uppercase tracking-wide",children:"[!] 3-Plane / Full Color"}),c.jsx("p",{className:"text-[10px] text-red-500/80 dark:text-red-300/70 mt-1",children:"Demosaic disabled. Stats analysis treated as pseudo-Bayer."})]}),Qt&&!D&&c.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/20 p-3 border-b border-amber-100 dark:border-amber-800 text-center",children:[c.jsx("p",{className:"text-xs font-bold text-amber-600 dark:text-amber-400 uppercase tracking-wide",children:"[!] X-Trans Native (Unsupported)"}),c.jsx("p",{className:"text-[10px] text-amber-600/80 dark:text-amber-300/70 mt-1 text-left leading-tight px-1",children:"Currently reading raw 6x6 pattern as Bayer. Stats will be incorrect. Please enable Pseudo-Bayer conversion below."})]}),D&&c.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 p-3 border-b border-emerald-100 dark:border-emerald-800 text-center",children:[c.jsx("p",{className:"text-xs font-bold text-emerald-600 dark:text-emerald-400 uppercase tracking-wide",children:"[OK] X-Trans Pseudo-Bayer"}),c.jsx("p",{className:"text-[10px] text-emerald-600/80 dark:text-emerald-300/70 mt-1 text-left leading-tight px-1",children:"Converted 6x6  2x2 RGGB (Subsampled). Demosaic & Analysis fully supported."})]}),ne&&c.jsxs(c.Fragment,{children:[c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/30",children:c.jsxs("div",{className:"space-y-2",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>_t==null?void 0:_t(),disabled:!le||(le.historyIndex??0)<=0,className:"px-2 py-1 bg-amber-600 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Undo"}),c.jsx("button",{onClick:()=>Ar==null?void 0:Ar(),disabled:!le,className:"px-2 py-1 bg-slate-800 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Export Flow JSON"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:()=>{var H;return(H=ta.current)==null?void 0:H.click()},disabled:!le,className:"px-2 py-1 bg-slate-700 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Import Flow File"}),c.jsx("button",{onClick:()=>Gt==null?void 0:Gt(),className:"px-2 py-1 bg-emerald-700 text-white font-bold border border-black text-xs",children:"Export PNG"})]}),c.jsx("button",{onClick:()=>mt==null?void 0:mt(),className:"w-full px-2 py-1 bg-emerald-800 text-white font-bold border border-black text-xs",children:"Export JPEG"}),c.jsx("input",{ref:ta,type:"file",accept:".json,.csv,application/json,text/csv",className:"hidden",onChange:km}),c.jsx("div",{className:"max-h-36 overflow-y-auto border border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-900",children:cr.length>0?cr.map(({entry:H,index:be})=>c.jsxs("button",{onClick:()=>Xe==null?void 0:Xe(be),className:`w-full text-left px-2 py-1 border-b border-gray-200 dark:border-slate-700 text-xs ${(le==null?void 0:le.historyIndex)===be?"bg-cyan-100 dark:bg-cyan-900/40":"bg-white dark:bg-slate-900"}`,children:[c.jsx("div",{className:"font-semibold truncate",children:H.label}),c.jsx("div",{className:"text-[10px] text-gray-500",children:new Date(H.timestamp).toLocaleTimeString()})]},H.id)):c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No history entries."})})]})}),c.jsx(Qo,{title:"PS Masks",children:c.jsx(Y8,{inline:!0,doc:le||null,brushEnabled:!!se,brushSize:he||32,brushOpacity:ue||.35,brushFeather:ie??.6,ellipseFeather:xe??24,brushMode:Se||"add",onAddMask:()=>Ie==null?void 0:Ie(),onAddEllipseMask:()=>te==null?void 0:te(),onCancelEllipseTool:()=>Oe==null?void 0:Oe(),onSelectLayer:H=>tt==null?void 0:tt(H),onSelectMask:H=>vt==null?void 0:vt(H),onBindLayerMask:(H,be)=>Sr==null?void 0:Sr(H,be),onSetLayerBlendMode:(H,be)=>Ft==null?void 0:Ft(H,be),onSetLayerOpacity:(H,be)=>rt==null?void 0:rt(H,be),onSetLayerBasic:(H,be)=>Kt==null?void 0:Kt(H,be),onSetLayerMixer:(H,be)=>lr==null?void 0:lr(H,be),onPreviewLayerBasic:(H,be)=>Vt==null?void 0:Vt(H,be),onPreviewLayerMixer:(H,be)=>gr==null?void 0:gr(H,be),onSetLayerCurves:(H,be)=>Zt==null?void 0:Zt(H,be),onSelectMaskItem:H=>zt==null?void 0:zt(H),onUpdateEllipseItem:(H,be)=>rr==null?void 0:rr(H,be),onSetMaskOverlayVisible:(H,be)=>Ot==null?void 0:Ot(H,be),onBrushEnabledChange:H=>Jt==null?void 0:Jt(H),onBrushSizeChange:H=>Pr==null?void 0:Pr(H),onBrushOpacityChange:H=>Zr==null?void 0:Zr(H),onBrushFeatherChange:H=>jr==null?void 0:jr(H),onEllipseFeatherChange:H=>we==null?void 0:we(H),onBrushModeChange:H=>Je==null?void 0:Je(H)})}),c.jsxs(Qo,{title:"PS Upright / Crop",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>Fe==null?void 0:Fe(),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Flip Left-Right"}),c.jsx("button",{onClick:()=>bt==null?void 0:bt(),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Flip Up-Down"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>ut==null?void 0:ut(90),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Rotate +90"}),c.jsx("button",{onClick:()=>ut==null?void 0:ut(-90),className:"px-2 py-1 bg-slate-700 text-white font-bold border border-black",children:"Rotate -90"})]}),c.jsxs("div",{className:"grid grid-cols-[1fr_auto] gap-2 mb-3",children:[c.jsx("input",{type:"number",step:.1,value:pr,onChange:H=>It(H.target.value),className:"border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1",placeholder:"Angle deg"}),c.jsx("button",{onClick:Tt,className:"px-2 py-1 bg-slate-800 text-white font-bold border border-black",children:"Rotate"})]}),c.jsx("button",{onClick:()=>Ct==null?void 0:Ct(),disabled:!N,className:"mb-3 w-full px-2 py-1 bg-amber-600 disabled:bg-gray-400 text-white font-bold border border-black",children:"Crop To ROI"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsx("button",{onClick:()=>_e==null?void 0:_e("horizontal"),className:"px-2 py-1 bg-sky-700 text-white font-bold border border-black",children:"+ H Guide"}),c.jsx("button",{onClick:()=>_e==null?void 0:_e("vertical"),className:"px-2 py-1 bg-sky-800 text-white font-bold border border-black",children:"+ V Guide"})]}),c.jsxs("div",{className:"space-y-1 max-h-24 overflow-auto border border-gray-300 dark:border-slate-700 p-1 mb-2",children:[((le==null?void 0:le.guides)||[]).map(H=>c.jsxs("button",{onClick:()=>ee==null?void 0:ee(H.id),className:`w-full text-left px-2 py-1 border ${(le==null?void 0:le.selectedGuideId)===H.id?"bg-sky-100 dark:bg-sky-900/40 border-sky-500":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-700"}`,children:[H.orientation==="horizontal"?"H":"V"," (",Math.round(H.p1.x),",",Math.round(H.p1.y),")-(",Math.round(H.p2.x),",",Math.round(H.p2.y),")"]},H.id)),(((f0=le==null?void 0:le.guides)==null?void 0:f0.length)||0)===0&&c.jsx("div",{className:"px-2 py-2 text-[11px] text-gray-500",children:"No guides."})]}),it&&c.jsxs("div",{children:[c.jsxs("div",{className:"text-[11px] mb-1 text-gray-500",children:["Selected: ",it.orientation==="horizontal"?"Horizontal":"Vertical"]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"x1"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((le==null?void 0:le.width)||1)-1),step:1,value:Math.round(it.p1.x),onChange:H=>ve==null?void 0:ve(it.id,{...it.p1,x:Number(H.target.value)},it.p2),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"y1"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((le==null?void 0:le.height)||1)-1),step:1,value:Math.round(it.p1.y),onChange:H=>ve==null?void 0:ve(it.id,{...it.p1,y:Number(H.target.value)},it.p2),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"x2"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((le==null?void 0:le.width)||1)-1),step:1,value:Math.round(it.p2.x),onChange:H=>ve==null?void 0:ve(it.id,it.p1,{...it.p2,x:Number(H.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]}),c.jsxs("label",{className:"text-[10px]",children:[c.jsx("span",{className:"block mb-0.5",children:"y2"}),c.jsx("input",{type:"number",min:0,max:Math.max(0,((le==null?void 0:le.height)||1)-1),step:1,value:Math.round(it.p2.y),onChange:H=>ve==null?void 0:ve(it.id,it.p1,{...it.p2,y:Number(H.target.value)}),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1"})]})]}),c.jsx("button",{onClick:()=>st==null?void 0:st(it.id),className:"w-full px-2 py-1 bg-rose-700 text-white font-bold border border-black",children:"Delete Selected Guide"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[c.jsx("button",{onClick:()=>De==null?void 0:De("p1"),className:`px-2 py-1 font-bold border border-black ${de==="p1"?"bg-amber-600 text-white":"bg-gray-200 dark:bg-slate-800 text-black dark:text-white"}`,children:"Pick P1"}),c.jsx("button",{onClick:()=>De==null?void 0:De("p2"),className:`px-2 py-1 font-bold border border-black ${de==="p2"?"bg-amber-600 text-white":"bg-gray-200 dark:bg-slate-800 text-black dark:text-white"}`,children:"Pick P2"})]}),de&&c.jsx("button",{onClick:()=>Ye==null?void 0:Ye(),className:"mt-2 w-full px-2 py-1 bg-gray-600 text-white font-bold border border-black",children:"Cancel Pick"})]}),c.jsx("button",{onClick:()=>dt==null?void 0:dt(),className:"mt-2 w-full px-2 py-1 bg-teal-700 text-white font-bold border border-black",children:"Apply Upright (4 Guides)"}),c.jsx("div",{className:"mt-2 text-[10px] text-gray-500",children:"Upright: set 4 guides for two horizontal and two vertical references."}),de&&c.jsxs("div",{className:"mt-1 text-[10px] text-amber-600 dark:text-amber-400",children:["Click once on canvas to set ",de.toUpperCase(),"."]}),c.jsxs("div",{className:"mt-3 border-t border-gray-300 dark:border-slate-700 pt-3",children:[c.jsx("div",{className:"text-xs font-bold text-gray-700 dark:text-slate-200 mb-2",children:"Lens Distortion Correction (Lensfun XML)"}),c.jsxs("label",{className:"flex items-center gap-2 text-[11px] mb-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Ho,onChange:H=>Js(H.target.checked)}),"Enable lens correction"]}),c.jsx("input",{ref:fo,type:"file",className:"hidden",accept:".xml,text/xml,application/xml",multiple:!0,onChange:Sm}),c.jsx("button",{onClick:()=>{var H;return(H=fo.current)==null?void 0:H.click()},className:"w-full px-2 py-1 bg-slate-700 text-white font-bold border border-black text-xs",children:"Load Extra Lensfun XML"}),c.jsx("div",{className:"mt-2 text-[10px] text-gray-500 dark:text-slate-400 break-words",children:Hu}),c.jsx("label",{className:"block text-[10px] mt-2 mb-1 text-gray-500 dark:text-slate-400",children:"Lens Profile"}),c.jsxs("select",{value:pt,onChange:H=>Ql(H.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1 text-xs",children:[Wo.length===0&&c.jsx("option",{value:"",children:"No profile loaded"}),Wo.map(H=>c.jsx("option",{value:H.id,children:H.label},H.id))]}),c.jsx("label",{className:"block text-[10px] mt-2 mb-1 text-gray-500 dark:text-slate-400",children:"Focal Length (mm)"}),c.jsx("input",{type:"number",min:.1,step:.1,value:xt,onChange:H=>Vo(H.target.value),className:"w-full border border-gray-400 dark:border-slate-600 bg-white dark:bg-slate-900 p-1 text-xs",placeholder:"e.g. 35.0"}),c.jsx("button",{onClick:c0,disabled:!Ho||!pt||!ht,className:"mt-2 w-full px-2 py-1 bg-emerald-700 disabled:bg-gray-400 text-white font-bold border border-black text-xs",children:"Apply Lens Correction"})]})]})]}),$&&c.jsx(Qo,{title:"SFR Lab Tools (Scalar Unmixing)",children:c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 p-3 rounded border border-orange-200 dark:border-orange-800",children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase mb-2",children:"Analyze ROI"}),c.jsx("p",{className:"text-[10px] text-gray-500 dark:text-slate-400 mb-2",children:"Select an edge on the main canvas and click analyze. Use the pop-up modal to view ESF/LSF/MTF."}),c.jsx("div",{className:"text-center text-xs font-bold text-orange-500",children:"(ROI Analysis Window is Active)"})]}),Mm&&c.jsxs("div",{className:"border-t border-orange-200 dark:border-orange-800 pt-3",children:[c.jsxs("div",{className:"flex justify-between items-center cursor-pointer",onClick:()=>Fi(!Gn),children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase",children:" (Batch Ops)"}),c.jsx("svg",{className:`w-4 h-4 text-orange-500 transition-transform ${Gn?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),Gn&&c.jsxs("div",{className:"mt-3 space-y-3 bg-white/50 dark:bg-black/20 p-2 rounded animate-in slide-in-from-top-1",children:[c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-600 dark:text-gray-300",children:" (Standard Chart)"}),c.jsx("button",{onClick:pe,disabled:!!G&&G>0,className:`w-full py-2 border font-bold text-xs rounded transition-all ${G&&G>0?"bg-emerald-600 text-white border-emerald-500 animate-pulse":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100"}`,children:G&&G>0?`Click ${G===1?"TL":G===2?"TR":G===3?"BL":"BR"}`:"Start Calibration (4-Pts)"}),!!G&&G>0&&c.jsx("p",{className:"text-[9px] text-emerald-600 dark:text-emerald-400 font-bold text-center",children:"Click corners: TopLeft  TopRight  BottomLeft  BottomRight"})]}),c.jsx("div",{className:"h-px bg-gray-300 dark:bg-slate-600 w-full"}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsx("span",{className:"text-[9px] font-bold text-gray-600 dark:text-gray-300",children:" (Manual Mark)"}),I!==void 0&&I>0&&c.jsxs("span",{className:"text-[9px] text-orange-500 font-bold",children:[I," Selected"]})]}),c.jsx("button",{onClick:V,className:`w-full py-2 font-bold text-xs rounded shadow transition-all ${z?"bg-orange-600 hover:bg-orange-500 text-white ring-2 ring-orange-300":"bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 text-gray-700 dark:text-gray-300 hover:bg-gray-100"}`,children:z?"Stop Marking (Active)":"Start Batch Marking"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("button",{onClick:J,disabled:!I,className:"flex-1 py-1.5 border border-indigo-300 dark:border-indigo-700 text-indigo-700 dark:text-indigo-400 font-bold text-[10px] rounded hover:bg-indigo-50 dark:hover:bg-indigo-900/30 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-1",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})})," (Save)"]}),c.jsx("input",{type:"file",ref:Gr,className:"hidden",accept:".csv",onChange:xm}),c.jsxs("button",{onClick:()=>{var H;return(H=Gr.current)==null?void 0:H.click()},className:"flex-1 py-1.5 border border-emerald-300 dark:border-emerald-700 text-emerald-700 dark:text-emerald-400 font-bold text-[10px] rounded hover:bg-emerald-50 dark:hover:bg-emerald-900/30 transition-colors flex items-center justify-center gap-1",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})," (Import)"]})]}),I!==void 0&&I>0&&c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800/50 p-2 rounded border border-gray-200 dark:border-slate-700 mt-1",children:[c.jsx("div",{className:"text-[9px] font-bold text-gray-500 text-center mb-1",children:"UNIFIED TRANSFORM"}),c.jsxs("div",{className:"flex gap-2 mb-2 justify-center",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400",children:"Step (px)"}),c.jsx("input",{type:"number",min:"1",value:La,onChange:H=>lo(Number(H.target.value)),className:"w-10 text-center text-[10px] bg-white dark:bg-slate-900 border rounded"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400",children:"Scale"}),c.jsx("input",{type:"number",step:"0.01",value:Ba,onChange:H=>co(Number(H.target.value)),className:"w-10 text-center text-[10px] bg-white dark:bg-slate-900 border rounded"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[c.jsx("button",{onClick:()=>Ko("scale",1/Ba,1/Ba),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600 font-bold",title:"Zoom Out (Shrink)",children:"-"}),c.jsx("button",{onClick:()=>Ko("move",0,-La),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:"^"}),c.jsx("button",{onClick:()=>Ko("scale",Ba,Ba),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600 font-bold",title:"Zoom In (Expand)",children:"+"}),c.jsx("button",{onClick:()=>Ko("move",-La,0),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:""}),c.jsx("div",{className:"text-center text-[8px] text-gray-400 flex items-center justify-center",children:"Move"}),c.jsx("button",{onClick:()=>Ko("move",La,0),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:">"}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Ko("move",0,La),className:"bg-white dark:bg-slate-700 hover:bg-gray-200 rounded text-[10px] border dark:border-slate-600",children:"v"}),c.jsx("div",{})]})]}),z&&c.jsx("p",{className:"text-[9px] text-gray-400 italic text-center mt-1",children:"Hold Shift + Drag on canvas to add multiple ROIs."}),c.jsxs("div",{className:"flex flex-col gap-1 text-[10px] mt-2 bg-gray-100 dark:bg-slate-800/50 p-2 rounded",children:[c.jsxs("div",{className:"flex justify-between items-center",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Gi,onChange:H=>Wu(H.target.checked),className:"rounded text-orange-500"}),"Jiang Official NR"]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:Ys,onChange:H=>Vu(H.target.checked),className:"rounded text-purple-500"}),"Deshading"]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 my-1"}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",title:"Only use Green channel points for projection (reduces color moire issues)",children:[c.jsx("input",{type:"checkbox",checked:Jl,onChange:H=>nn(H.target.checked),className:"rounded text-emerald-500"}),c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:"Green Channel Only (G Only)"})]})]}),c.jsxs("button",{onClick:wm,disabled:!I,className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold text-xs rounded shadow transition-transform active:scale-95",children:["Calculate & Copy (",I||0,")"]}),c.jsx("button",{onClick:K,disabled:!I,className:"w-full py-1.5 bg-gray-200 dark:bg-slate-700 hover:bg-red-100 hover:text-red-600 text-[10px] font-bold rounded transition-colors disabled:opacity-50",children:"Clear All Marks"})]})]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsx(F0,{checked:oe,onChange:me,label:" (Scalar Unmixing)"}),oe&&c.jsxs("div",{className:"space-y-4 pl-2 border-l-2 border-indigo-200 dark:border-indigo-900 animate-in slide-in-from-top-2 duration-200",children:[c.jsxs("div",{className:"grid grid-cols-5 gap-1 items-center text-[9px] uppercase font-bold text-gray-400 mb-[-8px]",children:[c.jsx("div",{className:"col-span-1",children:"Param"}),c.jsx("div",{className:"text-center",children:"Ch0(R)"}),c.jsx("div",{className:"text-center",children:"Ch1(G1)"}),c.jsx("div",{className:"text-center",children:"Ch2(B)"}),c.jsx("div",{className:"text-center",children:"Ch3(G2)"})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-red-500",children:"BL:"}),c.jsx("input",{type:"text",value:je,onChange:H=>{L(),Q(H.target.value)},placeholder:"0 0 0 0",className:"col-span-4 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500",children:"B ():"}),c.jsxs("div",{className:"col-span-4 flex gap-1",children:[c.jsx("input",{type:"text",value:$e,onChange:H=>{L(),Ke(H.target.value)},className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"}),c.jsx("button",{onClick:gm,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-[9px] rounded font-bold transition-colors",title:"Fill with current ROI mean stats (Raw DN)",children:"Pick"})]})]}),c.jsxs("div",{className:"grid grid-cols-5 gap-2 items-center",children:[c.jsx("span",{className:"text-[10px] font-bold text-emerald-500",children:"F ():"}),c.jsxs("div",{className:"col-span-4 flex gap-1",children:[c.jsx("input",{type:"text",value:ot,onChange:H=>{L(),wt(H.target.value)},className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-xs font-mono text-gray-900 dark:text-slate-100"}),c.jsx("button",{onClick:lt,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-[9px] rounded font-bold transition-colors",title:"Fill with current ROI mean stats (Raw DN)",children:"Pick"})]})]}),c.jsx("button",{onClick:tc,disabled:!Qe||!jm,className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 rounded text-[10px] shadow transition-transform active:scale-95 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed",children:"RUN UNMIXING (ADV ZERO-DEP)"}),c.jsx("p",{className:"text-[9px] text-gray-400 italic text-center",children:"Basic render + sRGB gamma are applied."})]})]})}),k&&c.jsx(Qo,{title:"FFT Lab (Noise Profile)",children:c.jsxs("div",{className:"space-y-6",children:[c.jsxs("div",{className:"space-y-3 bg-gray-50 dark:bg-slate-800/40 p-3 rounded-xl border border-gray-100 dark:border-slate-800",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-fuchsia-600 dark:text-fuchsia-400 uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-fuchsia-500"})," 1. Pair Difference (Sub)"]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:uo,className:"hidden",onChange:rc,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var H;return(H=uo.current)==null?void 0:H.click()},className:`w-full py-2 px-3 rounded-lg border text-[10px] font-bold text-left truncate transition-colors ${ze?"bg-fuchsia-55 dark:bg-fuchsia-900/20 border-fuchsia-300 dark:border-fuchsia-800 text-fuchsia-700 dark:text-fuchsia-300":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:ze?`A: ${ze.name}`:"Load Image A"}),c.jsx("input",{type:"file",ref:qs,className:"hidden",onChange:nc,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var H;return(H=qs.current)==null?void 0:H.click()},className:`w-full py-2 px-3 rounded-lg border text-[10px] font-bold text-left truncate transition-colors ${kt?"bg-fuchsia-55 dark:bg-fuchsia-900/20 border-fuchsia-300 dark:border-fuchsia-800 text-fuchsia-700 dark:text-fuchsia-300":"bg-white dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-500 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:kt?`B: ${kt.name}`:"Load Image B"})]}),c.jsx("div",{className:"flex flex-col gap-1.5 pt-1",children:c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:gn,onChange:H=>bi(H.target.checked),className:"w-3 h-3 text-fuchsia-600 border-gray-300 rounded focus:ring-0"}),c.jsx("span",{className:"text-[10px] text-gray-600 dark:text-slate-300",children:"Normalize (/sqrt(2), do not check if not clear about the side effects)"})]})}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[c.jsx("button",{onClick:ym,disabled:!ze||!kt,className:"w-full bg-fuchsia-600 hover:bg-fuchsia-500 disabled:opacity-30 text-white font-bold py-2 rounded shadow transition-all active:scale-95 text-[10px]",children:"Generate Diff & Load"}),c.jsx("input",{type:"file",ref:zi,className:"hidden",multiple:!0,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:bm}),c.jsx("button",{onClick:()=>{var H;return(H=zi.current)==null?void 0:H.click()},className:"w-full bg-slate-700 hover:bg-slate-600 text-white font-bold py-2 rounded shadow transition-all active:scale-95 text-[10px] flex items-center justify-center gap-1",children:"Batch Diffs (Auto Download)"})]})]}),c.jsxs("div",{className:"space-y-3 bg-gray-50 dark:bg-slate-800/40 p-3 rounded-xl border border-gray-100 dark:border-slate-800",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-400 uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-cyan-500"})," 2. Stack FFT (Avg PSD)"]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:zo,className:"hidden",multiple:!0,onChange:vm,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var H;return(H=zo.current)==null?void 0:H.click()},className:"w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"Select Sequence Files"})]})]}),c.jsxs("div",{className:"flex flex-col gap-2 pt-2 border-t border-gray-100 dark:border-slate-800",children:[c.jsx("button",{onClick:()=>{M==null||M(),E==null||E("crosscalc")},className:"w-full bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"Cross-Compensation Calc"}),c.jsx("button",{onClick:()=>{ce==null||ce(),E==null||E("stack tool")},className:"w-full bg-emerald-600 hover:bg-emerald-500 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-all active:scale-95 text-[10px] flex items-center justify-center gap-2",children:"General Stack"})]})]})}),s&&c.jsx(Qo,{title:"DR Lab Tools",children:c.jsxs("div",{className:"space-y-4",children:[c.jsx("button",{onClick:()=>{d==null||d(),E==null||E("gen test")},className:"w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors text-sm",children:"Generate Test Pic"}),c.jsxs("div",{className:"border-t border-gray-200 dark:border-slate-700 pt-3",children:[c.jsx("h4",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-2",children:"Grid Analysis"}),h&&f!==void 0&&c.jsx("div",{className:"flex items-center justify-between mb-3",children:c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Box Size:"}),c.jsx("input",{type:"number",min:"8",max:"512",step:"2",value:f,onChange:H=>h(parseInt(H.target.value)||64),className:"w-12 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 text-center"}),c.jsx("span",{className:"text-xs text-gray-400",children:"px"})]})}),x&&y&&p!==void 0&&b!==void 0&&c.jsxs("div",{className:"flex items-center justify-between mb-3",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-400",children:"Layout:"}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("input",{type:"number",min:"1",max:"50",value:p,onChange:H=>x(Math.max(1,parseInt(H.target.value)||1)),className:"w-10 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md outline-none text-sm text-center",title:"Rows"}),c.jsx("span",{className:"text-xs text-gray-400",children:"x"}),c.jsx("input",{type:"number",min:"1",max:"50",value:b,onChange:H=>y(Math.max(1,parseInt(H.target.value)||1)),className:"w-10 px-1 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md outline-none text-sm text-center",title:"Columns"})]})]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("button",{onClick:()=>{u==null||u(),E==null||E("mark")},disabled:!Qe||l!==void 0&&l>0,className:`w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm ${Qe?l&&l>0?"bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300 border-2 border-indigo-500":"bg-indigo-600 hover:bg-indigo-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:l&&l>0?"Marking Active...":"Mark Corners"}),m&&c.jsxs(c.Fragment,{children:[c.jsx("input",{type:"file",ref:Xn,className:"hidden",multiple:!0,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:mm}),c.jsxs("div",{className:"relative",children:[c.jsx("button",{onClick:()=>wn(!vr),disabled:!g,className:"w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm bg-emerald-600 hover:bg-emerald-700 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed text-white flex items-center justify-center gap-2",children:"Reuse Last & Batch"}),vr&&c.jsxs("div",{className:"absolute bottom-full left-0 w-full mb-1 bg-white dark:bg-slate-800 rounded-lg shadow-xl border border-gray-200 dark:border-slate-700 overflow-hidden z-20 flex flex-col animate-in fade-in zoom-in-95 duration-100",children:[c.jsx("button",{className:"px-4 py-2 text-left text-xs hover:bg-gray-100 dark:hover:bg-slate-700 text-gray-700 dark:text-slate-200 border-b border-gray-100 dark:border-slate-700",onClick:()=>{var H;Jr("single"),(H=Xn.current)==null||H.click()},children:"1. Independent Frames"}),c.jsx("button",{className:"px-4 py-2 text-left text-xs hover:bg-gray-100 dark:hover:bg-slate-700 text-indigo-600 dark:text-indigo-400 font-bold",onClick:()=>{var H;Jr("pair"),(H=Xn.current)==null||H.click()},children:"2. Pair Difference (A-B)"})]})]})]}),c.jsxs("div",{className:"pt-2 mt-2 border-t border-gray-100 dark:border-slate-800",children:[c.jsx("input",{type:"file",ref:Ma,className:"hidden",accept:".txt",onChange:Xo}),c.jsx("button",{onClick:()=>{var H;return(H=Ma.current)==null?void 0:H.click()},className:"w-full font-bold py-2 px-4 rounded-lg shadow-sm transition-all text-xs bg-slate-100 hover:bg-slate-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 flex items-center justify-center gap-2 border border-gray-300 dark:border-slate-600",children:"Convert Format (.txt  .csv)"})]})]}),l!==void 0&&l>0&&c.jsx("div",{className:"mt-2 text-center",children:c.jsxs("p",{className:"text-xs text-indigo-600 dark:text-indigo-400 font-bold animate-pulse",children:[l===1&&"Click Top-Left Center",l===2&&"Click Top-Right Center",l===3&&"Click Bottom-Left Center",l===4&&"Click Bottom-Right Center"]})})]})]})}),W&&c.jsx(Qo,{title:"Color Lab Tools",children:c.jsxs("div",{className:"space-y-4",children:[c.jsx("div",{className:"text-sm text-gray-600 dark:text-slate-300 mb-2",children:"Calibrate colors using a standard ColorChecker 24 chart."}),c.jsx("button",{onClick:()=>{O==null||O(),E==null||E("cl mark")},disabled:!Qe||F!==void 0&&F>0,className:`w-full font-bold py-2 px-4 rounded-lg shadow-md transition-all text-sm ${Qe?F&&F>0?"bg-yellow-100 dark:bg-yellow-900 text-yellow-700 dark:text-yellow-300 border-2 border-yellow-500":"bg-yellow-600 hover:bg-yellow-700 text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:F&&F>0?"Marking Active...":"Mark 24-Patch Chart"}),F!==void 0&&F>0&&c.jsx("div",{className:"mt-2 text-center",children:c.jsxs("p",{className:"text-xs text-yellow-600 dark:text-yellow-400 font-bold animate-pulse",children:[F===1&&"Click Top-Left (Brown)",F===2&&"Click Top-Right (Cyanish)",F===3&&"Click Bottom-Left (White)",F===4&&"Click Bottom-Right (Black)"]})})]})}),!ne&&c.jsx(Qo,{title:"Selection Tools",children:c.jsx("div",{className:"space-y-3",children:c.jsxs("div",{children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Quick Select (or Shift+drag)"}),c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("span",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Size (px):"}),c.jsx("input",{type:"number",min:"1",value:vn,onChange:H=>ja(H.target.value),disabled:!Qe,className:"flex-1 px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsx("button",{onClick:Ga,disabled:!Qe,className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-slate-200 text-xs font-semibold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Center Rect"}),c.jsx("button",{onClick:Fa,disabled:!Qe,className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-slate-200 text-xs font-semibold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Full Image"})]})]})})}),!ne&&c.jsx(Qo,{title:"Display Controls",children:c.jsxs("div",{className:"space-y-5",children:[c.jsxs("p",{className:"text-gray-500 dark:text-slate-400 text-center text-sm",children:["Adjust parameters and click ",c.jsx("b",{children:"Apply"}),"."]}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"exposure",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Exposure (EV)"}),c.jsx("div",{className:"flex items-center gap-2 mb-2",children:c.jsx("input",{type:"range",min:"-5",max:"5",step:"0.1",disabled:!Qe,value:parseFloat(Pe)||0,onChange:H=>i0(H.target.value),className:"w-full h-2 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500 disabled:opacity-50"})}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("input",{id:"exposure",type:"number",step:"0.1",value:Pe,onChange:H=>i0(H.target.value),disabled:!Qe,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})})]}),c.jsxs("div",{children:[c.jsx(F0,{checked:$t,onChange:H=>{L(),Nr(H)},label:"Highlight Recovery"}),$t&&c.jsxs("div",{className:"mt-2 pl-2 border-l-2 border-orange-200 dark:border-orange-900 animate-in slide-in-from-top-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"White Level (Clip Point)"}),c.jsx("input",{type:"number",value:cn,onChange:H=>{L(),ea(H.target.value)},className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-orange-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors"})]})]}),Ht&&c.jsxs("div",{className:"border-t border-gray-100 dark:border-slate-800 pt-2",children:[c.jsx(F0,{checked:!!D,onChange:H=>{L(),P&&P(H),E==null||E(`xtrans ${H?"on":"off"}`)},label:"Force X-Trans (6x6 -> 2x2)"}),D&&A&&R&&c.jsxs("div",{className:"mt-2 pl-2 border-l-2 border-emerald-500/50 bg-emerald-50/20 dark:bg-emerald-900/10 p-2 rounded",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Phase Offset (Fine Tune)"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-[9px] text-gray-400",children:"X (0-5)"}),c.jsx("input",{type:"number",min:"0",max:"5",value:A.x,onChange:H=>{L();const be=Math.min(5,Math.max(0,parseInt(H.target.value)||0));R({x:be}),E==null||E(`xtrans phase ${be} ${A.y}`)},className:"w-full text-xs px-1 py-0.5 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-center outline-none focus:border-cyan-500"})]}),c.jsxs("div",{className:"flex flex-col",children:[c.jsx("span",{className:"text-[9px] text-gray-400",children:"Y (0-5)"}),c.jsx("input",{type:"number",min:"0",max:"5",value:A.y,onChange:H=>{L();const be=Math.min(5,Math.max(0,parseInt(H.target.value)||0));R({y:be}),E==null||E(`xtrans phase ${A.x} ${be}`)},className:"w-full text-xs px-1 py-0.5 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded text-center outline-none focus:border-cyan-500"})]})]})]})]}),c.jsxs("div",{className:"space-y-5 pt-2 animate-in slide-in-from-top-2 duration-200 border-t border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{children:[c.jsx(F0,{checked:ur,onChange:H=>{L(),Wt(H)},label:"Show k"}),c.jsx("p",{className:"text-[10px] text-gray-400 dark:text-slate-500 mt-1"})]}),c.jsxs("div",{children:[c.jsxs("button",{onClick:ec,disabled:!Qe||!N,className:"w-full mb-3 px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white text-xs font-bold rounded shadow-sm transition-all active:scale-95 disabled:bg-gray-300 dark:disabled:bg-slate-700 disabled:text-gray-500 dark:disabled:text-gray-500 disabled:cursor-not-allowed disabled:shadow-none flex items-center justify-center gap-2",title:"Calculate Gains to make the selected area neutral gray, accounting for Color Matrix",children:[c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Spot WB (Matrix-Aware)"]}),c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"White Balance Gains"}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-red-500 dark:text-red-400 block mb-1",children:"Red"}),c.jsx("input",{type:"number",step:"0.01",value:Tr,onChange:H=>o0(H.target.value),disabled:!Qe,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-red-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})]}),c.jsxs("div",{children:[c.jsx("span",{className:"text-xs text-blue-500 dark:text-blue-400 block mb-1",children:"Blue"}),c.jsx("input",{type:"number",step:"0.01",value:Ut,onChange:H=>pm(H.target.value),disabled:!Qe,className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-blue-500 outline-none text-sm text-gray-900 dark:text-slate-100 transition-colors duration-300"})]})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-end mb-2",children:[c.jsxs("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-0 flex items-center",children:["Black Level (4-Ch)",c.jsx("span",{className:"ml-1 text-[10px] text-gray-400 dark:text-slate-500 font-normal normal-case",children:"Native"}),c.jsx("button",{onClick:()=>yt(!0),className:"ml-2 text-[10px] text-cyan-600 dark:text-cyan-400 hover:text-cyan-700 dark:hover:text-cyan-300 hover:underline cursor-pointer transition-colors",title:"About Black Level Settings",children:"[about]"})]}),c.jsxs("div",{className:"flex items-center gap-1.5",title:"Subtract Black Level from ROI Mean stats (for display)",children:[c.jsx("span",{className:"text-[9px] font-mono text-gray-400 dark:text-slate-500 uppercase tracking-wide",children:"Sub. BL"}),c.jsx("div",{className:`relative w-8 h-4 rounded-full cursor-pointer transition-colors duration-200 ease-in-out ${ar?"bg-cyan-500":"bg-gray-300 dark:bg-slate-700"}`,onClick:()=>{L(),We(!ar)},children:c.jsx("div",{className:`absolute top-0.5 left-0.5 bg-white w-3 h-3 rounded-full shadow-sm transform transition-transform duration-200 ${ar?"translate-x-4":"translate-x-0"}`})})]})]}),c.jsx("input",{type:"text",value:Ue,onChange:H=>{L(),er(H.target.value)},disabled:!Qe,placeholder:"0 0 0 0",className:"w-full px-2 py-1 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none text-xs font-mono text-gray-900 dark:text-slate-100 transition-colors duration-300",title:"Enter 4 values separated by space or comma"}),c.jsx("p",{className:"text-[10px] text-gray-400 dark:text-slate-500 mt-1",children:"Order: (0,0) (0,1) (1,0) (1,1). Spatial: TL, TR, BL, BR."})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-end mb-2",children:[c.jsxs("label",{htmlFor:"customMatrix",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block flex flex-col gap-1",children:[c.jsx("span",{children:"Custom Color Matrix"}),c.jsx("span",{className:"text-[9px] text-gray-400 dark:text-slate-500 font-normal normal-case",children:"XYZ to Camera RGB (3x3, 9 nums)"})]}),c.jsxs("select",{className:"text-[10px] bg-gray-100 dark:bg-gray-800 border border-black dark:border-gray-500 rounded-none px-1 py-0.5 max-w-[120px] cursor-pointer outline-none text-gray-700 dark:text-gray-300",onChange:H=>{L();const be=Zc[H.target.value];be&&nt(be),H.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Camera..."}),Ui.map(H=>c.jsx("option",{value:H,children:H},H))]})]}),c.jsx("textarea",{id:"customMatrix",value:Be,onChange:s0,disabled:!Qe,placeholder:"0.66 -0.19 -0.04  -0.46 1.23 0.25  -0.06 0.13 0.65",className:"w-full h-24 px-2 py-2 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none transition-colors disabled:bg-gray-100 dark:disabled:bg-slate-800/50 disabled:cursor-not-allowed text-xs font-mono leading-relaxed text-gray-900 dark:text-slate-100"})]})]}),c.jsxs("div",{className:"pt-4 flex flex-col gap-2",children:[c.jsx("button",{onClick:qu,disabled:!Qe,className:"w-full text-sm font-bold bg-slate-700 hover:bg-slate-600 text-white disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 transition-all py-4 rounded-xl flex items-center justify-center border-2 border-slate-500 shadow-lg",title:"Diagnostic Mode. Direct RAW-to-Grayscale mapping using manual Black Level & WB Gains (R/B calibration).",children:c.jsxs("span",{className:"text-center leading-tight",children:["Apply Settings / Render",c.jsx("br",{}),c.jsx("span",{className:"text-xs font-normal opacity-90",children:"Float-safe render path, avoids ROI drift and CM color artifacts"})]})}),c.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[c.jsxs("button",{onClick:()=>Mr(!0),disabled:!Qe,className:"w-full text-xs font-bold bg-black text-gray-400 hover:bg-gray-800 hover:text-gray-300 dark:bg-black dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed py-3 px-2 rounded-lg transition-all active:scale-95 border border-gray-700",children:["Try Official Render",c.jsx("br",{}),c.jsx("span",{className:"text-[10px] font-normal opacity-75",children:"(Not for analysis)"})]}),c.jsx("button",{onClick:()=>B==null?void 0:B(),disabled:!Qe,className:"w-full text-xs font-bold bg-black text-gray-400 hover:bg-gray-800 hover:text-gray-300 dark:bg-black dark:text-gray-400 dark:hover:bg-gray-800 dark:hover:text-gray-300 disabled:bg-gray-300 dark:disabled:bg-slate-800 disabled:text-gray-500 disabled:cursor-not-allowed transition-all py-3 rounded-lg flex items-center justify-center border border-gray-700 active:scale-95",title:"Manual Lab Workstation: 16-bit Bit Shift and Manual DNG Container Packaging",children:"Generate 16bit DNG"})]}),c.jsx("div",{className:"text-center pt-1",children:c.jsx("button",{onClick:ei,disabled:!Qe,className:"text-xs text-gray-400 hover:text-gray-600 dark:text-slate-400 dark:hover:text-slate-200 disabled:text-gray-300 dark:disabled:text-slate-600 transition-colors underline decoration-gray-300 hover:decoration-gray-600 underline-offset-2",children:"Reset Defaults (Local)"})})]})]})})]}),c.jsx(As,{isOpen:Rt,onClose:()=>yt(!1),onConfirm:()=>{window.open("https://y-g-jiang.github.io/CBLD.html","_blank"),yt(!1)},title:"Black Level Info / ",confirmText:"Visit Database (CBLD)",cancelText:"Close",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left text-sm text-gray-600 dark:text-slate-300",children:[c.jsx("p",{className:"leading-relaxed",children:"JiangBridge  CBLD "}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsx("p",{className:"leading-relaxed",children:"For best accuracy, capture a dark frame with the same ISO/shutter and measure the center ROI in this app."})]})}),c.jsx(As,{isOpen:ir,onClose:()=>dr(!1),onConfirm:()=>{},title:"Select Zero-Dependency Mode",confirmText:"",cancelText:"",message:c.jsxs("div",{className:"flex flex-col gap-4",children:[c.jsx("div",{className:"text-gray-600 dark:text-slate-300 text-left text-sm leading-relaxed mb-2",children:"Select how you want to visualize the raw data without full JOraw processing."}),c.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Bayer Pattern"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>Fr(!1),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Cr?"text-gray-500 dark:text-slate-400":"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm"}`,children:"RGGB"}),c.jsx("button",{onClick:()=>Fr(!0),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Cr?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"BGGR"})]})]}),c.jsxs("div",{className:"flex justify-between items-center mb-2 px-1",children:[c.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Color Demosaic"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>Lt("bilinear"),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Ne==="bilinear"?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"Bilinear"}),c.jsx("button",{onClick:()=>Lt("amaze"),className:`px-3 py-1 text-[10px] font-bold rounded transition-all ${Ne==="amaze"||Ne==="edge-aware"?"bg-white dark:bg-slate-600 text-cyan-600 dark:text-cyan-400 shadow-sm":"text-gray-500 dark:text-slate-400"}`,children:"AMaZE (Default)"})]})]}),c.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[c.jsxs("button",{onClick:()=>el("mosaic"),className:"flex flex-col items-center justify-center p-4 bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 border-2 border-transparent hover:border-gray-400 dark:hover:border-slate-500 rounded-xl transition-all group",children:[c.jsx("div",{className:"w-12 h-12 bg-gray-300 dark:bg-slate-600 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:c.jsx("svg",{className:"w-6 h-6 text-gray-600 dark:text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})}),c.jsx("span",{className:"font-bold text-gray-800 dark:text-slate-200",children:"Raw Mosaic"}),c.jsx("span",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:"Grayscale checkerboard"})]}),c.jsxs("button",{onClick:()=>el("color"),className:"flex flex-col items-center justify-center p-4 bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 border-2 border-transparent hover:border-cyan-400 dark:hover:border-cyan-500 rounded-xl transition-all group",children:[c.jsx("div",{className:"w-12 h-12 bg-cyan-100 dark:bg-cyan-900/30 rounded-full flex items-center justify-center mb-3 group-hover:scale-110 transition-transform",children:c.jsx("svg",{className:"w-6 h-6 text-cyan-600 dark:text-cyan-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"})})}),c.jsx("span",{className:"font-bold text-cyan-700 dark:text-cyan-400",children:"Basic Color"}),c.jsx("span",{className:"text-xs text-gray-500 dark:text-slate-400 mt-1",children:Ne==="amaze"||Ne==="edge-aware"?"AMaZE Demosaic + WB + Matrix":"Bilinear Demosaic + WB + Matrix"})]})]})]})}),c.jsx(As,{isOpen:et,onClose:()=>Mr(!1),onConfirm:()=>{l0(),Mr(!1)},title:"Official Render Options",confirmText:"Render",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsx("p",{className:"text-sm text-gray-600 dark:text-slate-300",children:"Select a demosaicing algorithm for the standard render pipeline."}),c.jsxs("div",{children:[c.jsx("label",{htmlFor:"demosaic-modal",className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase tracking-wide block mb-2",children:"Demosaic Method"}),c.jsx("select",{id:"demosaic-modal",value:ln,onChange:Xu,disabled:!Qe||_||(t==null?void 0:t.isXTrans),className:"w-full px-2 py-2 bg-white dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-md focus:ring-2 focus:ring-cyan-500 outline-none transition-colors disabled:bg-gray-100 dark:disabled:bg-slate-800/50 disabled:cursor-not-allowed text-sm text-gray-900 dark:text-slate-100",children:IE.map(H=>c.jsx("option",{value:H.value,children:H.label},H.value))}),_&&c.jsx("p",{className:"text-[9px] text-gray-400 mt-1",children:"Full color data detected. Demosaicing skipped."}),(t==null?void 0:t.isXTrans)&&c.jsx("p",{className:"text-[9px] text-amber-500 mt-1",children:"X-Trans detected. Please enable Pseudo-Bayer conversion first."})]})]})})]})},LE=j.forwardRef((e,t)=>{const{rawImageData:r,displaySettings:n,onApplyDisplaySettings:a,onSetSelection:i,onStartMarking:o,onGenerateTestPic:s,onBatchDrLab:l,onProcessPair:u,onProcessBatchDiff:d,onProcessStackFft:f,onOpenCrossCalc:h,onToggleXTrans:p,onXTransPhaseChange:x}=e,[b,y]=j.useState([{id:"init",type:"info",text:'Jiangtherapee CLI v1.0. Type "help" for commands.'}]),[m,g]=j.useState(""),[k,S]=j.useState([]),[w,v]=j.useState(-1),M=j.useRef(null),_=j.useRef(null),P=j.useRef(null),A=j.useRef(null),R=j.useRef(null),D=j.useRef(null),E=j.useRef(null),W=j.useRef(null);j.useRef(null);const F=j.useRef({...n});j.useEffect(()=>{F.current={...n}},[n.exposure,n.demosaicMethod]);const O=j.useRef({fileA:null,fileB:null});j.useLayoutEffect(()=>{M.current&&(M.current.scrollTop=M.current.scrollHeight)},[b]);const $=(V,K="out")=>{y(q=>[...q,{id:Date.now().toString()+Math.random(),type:K,text:V}])};j.useImperativeHandle(t,()=>({log:(V,K="in")=>{const q=K;let G=V;K==="in"&&!V.startsWith(">")&&(G=`> ${V}`),$(G,q)}}));const N=j.useRef(null);j.useEffect(()=>{if(e.roiStats&&e.roiStats!==N.current){const V=e.roiStats,K=Math.round(V.x),q=Math.round(V.y),G=Math.round(V.width),pe=Math.round(V.height);$(`> sel ${K} ${q} ${G} ${pe}`,"in");const J=e.isBGGR?[{name:"B",idx:0},{name:"G1",idx:1},{name:"G2",idx:2},{name:"R",idx:3}]:[{name:"R",idx:0},{name:"G1",idx:1},{name:"G2",idx:2},{name:"B",idx:3}],Z=c.jsxs("div",{className:"font-mono text-xs mt-1 mb-2",children:[c.jsxs("div",{className:"text-gray-400 mb-1",children:["Region Stats [",K,", ",q,", ",G,"x",pe,"]:"]}),c.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr] gap-x-2 border-b border-gray-700 pb-1 mb-1 text-gray-500 font-bold",children:[c.jsx("div",{children:"Ch"}),c.jsx("div",{className:"text-right",children:"Mean"}),c.jsx("div",{className:"text-right",children:"StdDev"})]}),J.map(ae=>c.jsxs("div",{className:"grid grid-cols-[30px_1fr_1fr] gap-x-2 hover:bg-gray-900",children:[c.jsx("div",{className:ae.name==="R"?"text-red-500":ae.name==="B"?"text-blue-500":"text-green-500",children:ae.name}),c.jsx("div",{className:"text-right text-gray-300",children:V.means[ae.idx].toFixed(2)}),c.jsx("div",{className:"text-right text-gray-400",children:V.stdDevs[ae.idx].toFixed(2)})]},ae.name))]});$(Z,"out"),N.current=V}},[e.roiStats,e.isBGGR]);const C=V=>{var pe,J,Z,ae,ce,ne,le;const K=V.trim().split(/\s+/),q=K[0].toLowerCase(),G=K.slice(1);switch(q){case"help":$("Available Commands:","info"),$("  ev <val>          Set Exposure (e.g. ev 1.5)","info"),$("  wb <r> <b>        Set WB Gains","info"),$("  bl <r> <g>...     Set Black Level (1 or 4 vals)","info"),$("  demo <id>         Demosaic (0=Lin, 3=AHD, -1=Raw)","info"),$("  matrix <n1..n9>   Set Custom Color Matrix","info"),$("  xtrans <on|off>   Force X-Trans Mode","info"),$("  xtrans phase <x> <y>  Set X-Trans Phase","info"),$("  render            Apply settings & Render","info"),$("  render zero       Zero-Dependency Render","info"),$("  render unmix      Advanced Unmixing Render","info"),$("  sel <full|center> Select ROI","info"),$("  sel <x> <y> <w> <h> Select ROI manually","info"),$("  mark              Start DR Lab Corner Marking","info"),$("  gen test          Generate Test Pattern","info"),$("  fft load <a>      Load FFT Pair Image A","info"),$("  fft load <b>      Load FFT Pair Image B","info"),$("  fft run           Run FFT Pair Diff","info"),$("  cls               Clear Screen","info");break;case"cls":case"clear":y([]);break;case"ev":case"exposure":if(G.length<1){$(`Current EV: ${F.current.exposure}`,"info");return}const se=parseFloat(G[0]);if(isNaN(se)){$("Invalid EV value","err");return}F.current.exposure=se,$(`EV set to ${se} (run 'render' to apply)`);break;case"wb":if(G.length<2){$("Usage: wb <red_gain> <blue_gain>","err");return}const he=parseFloat(G[0]),ue=parseFloat(G[1]);if(isNaN(he)||isNaN(ue)){$("Invalid gains","err");return}F.current.wbGains=[he,ue],$(`WB set to R:${he} B:${ue}`);break;case"bl":case"black":if(G.length===0){$(`Current BL: ${((pe=F.current.blackLevel)==null?void 0:pe.join(" "))||"Auto"}`,"info");return}let ie=G.map(Number);if(ie.some(isNaN)){$("Invalid numbers","err");return}if(ie.length===1&&(ie=[ie[0],ie[0],ie[0],ie[0]]),ie.length<4){$("Need 1 or 4 values","err");return}F.current.blackLevel=[ie[0],ie[1],ie[2],ie[3]],F.current.subtractBlackLevelFromStats=!0,F.current.showKadc=!0,$(`Black Level set: ${ie.slice(0,4).join(" ")}`);break;case"demo":case"demosaic":if(G.length===0){$("Usage: demo <id> (0=Lin, 1=VNG, 2=PPG, 3=AHD, 4=DCB, 11=DHT, 12=AAHD, -1=Raw)","info");return}const xe=parseInt(G[0]);if(isNaN(xe)){$("Invalid method ID","err");return}F.current.demosaicMethod=xe,$(`Demosaic set to ID ${xe}`);break;case"matrix":if(G.length!==9){$("Usage: matrix m1 m2 m3 m4 m5 m6 m7 m8 m9 (3x3)","err");return}const Se=G.map(Number);if(Se.some(isNaN)){$("Invalid matrix values","err");return}F.current.customMatrix=Se,$("Custom Color Matrix set.");break;case"xtrans":if(G[0]==="on"||G[0]==="true")p?(p(!0),$("X-Trans conversion ON")):$("Feature not available","err");else if(G[0]==="off"||G[0]==="false")p?(p(!1),$("X-Trans conversion OFF")):$("Feature not available","err");else if(G[0]==="phase"){if(G.length<3){$("Usage: xtrans phase <x> <y>","err");return}const Ie=parseInt(G[1]),te=parseInt(G[2]);x&&(x({x:Ie,y:te}),$(`X-Trans Phase set to (${Ie}, ${te})`))}else $("Usage: xtrans <on|off> OR xtrans phase <x> <y>","err");break;case"render":case"apply":if(G[0]==="zero"){const Ie=G[1]==="color"?"zero-dep-color":"zero-dependency";F.current.renderMode=Ie,$(`Rendering Zero-Dependency (${Ie})...`)}else if(G[0]==="unmix"){if(G.length<13){$("Usage: render unmix <4xBL> <4xBG> <4xFG>","err");return}const Ie=G.slice(1).map(Number);if(Ie.some(isNaN)){$("Invalid params","err");return}F.current.renderMode="advanced-zero-dep",F.current.advancedZeroDep={bl:[Ie[0],Ie[1],Ie[2],Ie[3]],bg:[Ie[4],Ie[5],Ie[6],Ie[7]],fg:[Ie[8],Ie[9],Ie[10],Ie[11]]},$("Rendering Advanced Unmix...")}else F.current.renderMode="standard",$("Rendering Standard Pipeline...");a({...F.current});break;case"sel":case"select":if(!r||!i){$("No image loaded","err");return}if(G[0]==="full")i({x:0,y:0,w:r.width,h:r.height});else if(G[0]==="center"){const Ie=parseInt(G[1])||64,te=Math.floor((r.width-Ie)/2),Oe=Math.floor((r.height-Ie)/2);i({x:te,y:Oe,w:Ie,h:Ie})}else if(G.length===4){const[Ie,te,Oe,Fe]=G.map(Number);if([Ie,te,Oe,Fe].some(isNaN)){$("Invalid coordinates","err");return}i({x:Ie,y:te,w:Oe,h:Fe})}else $("Usage: sel full | sel center <size> | sel <x> <y> <w> <h>","err");break;case"mark":o&&(o(),$("Interactive marking started. Click 4 corners on canvas."));break;case"gen":(G[0]==="test"||G[0]==="pattern")&&s&&(s(),$("Generated Test Pattern"));break;case"drlab":if(G[0]==="config"){const[Ie,te,Oe]=G.slice(1).map(Number);e.onDrRoiSizeChange&&e.onDrRoiSizeChange(Ie||64),e.onDrGridRowsChange&&e.onDrGridRowsChange(te||10),e.onDrGridColsChange&&e.onDrGridColsChange(Oe||10),$(`DR Grid Configured: Size=${Ie}, Grid=${te}x${Oe}`)}else G[0]==="batch"&&(G[1]==="pair"?($("Select file pairs for DR Lab..."),(J=A.current)==null||J.click()):($("Select single files for DR Lab..."),(Z=P.current)==null||Z.click()));break;case"fft":G[0]==="load"?G[1]==="a"?(ae=R.current)==null||ae.click():G[1]==="b"?(ce=D.current)==null||ce.click():$("Usage: fft load <a|b>","err"):G[0]==="run"?O.current.fileA&&O.current.fileB&&u?($(`Processing Pair: ${O.current.fileA.name} - ${O.current.fileB.name}`),u(O.current.fileA,O.current.fileB,!1,!0)):$("Load both A and B first","err"):G[0]==="stack"?($("Select files for Stack FFT..."),(ne=E.current)==null||ne.click()):G[0]==="batch"&&($("Select files for Batch Diff...","info"),(le=W.current)==null||le.click());break;case"crosscalc":h&&(h(),$("Opened Cross-Calculator"));break;default:$(`Unknown command: ${q}`,"err")}},B=V=>{if(V.key==="Enter"){const K=m.trim();if(!K)return;$(`> ${K}`,"in"),K.split(";").forEach(G=>{G.trim()&&C(G.trim())}),S(G=>[...G,K]),v(-1),g("")}else if(V.key==="ArrowUp"){if(V.preventDefault(),k.length>0){const K=w===-1?k.length-1:Math.max(0,w-1);v(K),g(k[K])}}else if(V.key==="ArrowDown")if(V.preventDefault(),w!==-1){const K=Math.min(k.length-1,w+1);v(K),g(k[K])}else g("")},I=(V,K)=>{V.target.files&&V.target.files.length>0&&l&&($(`Batch processing ${V.target.files.length} files in ${K} mode...`),l(V.target.files,K)),V.target.value=""},z=(V,K)=>{var G;const q=(G=V.target.files)==null?void 0:G[0];q&&(K==="A"?O.current.fileA=q:O.current.fileB=q,$(`Loaded ${K}: ${q.name}`)),V.target.value=""};return c.jsxs("div",{className:"flex flex-col h-full bg-black text-green-500 font-mono text-sm border-l-4 border-gray-700 p-2 shadow-2xl",children:[c.jsxs("div",{className:"border-b border-green-800 pb-2 mb-2 flex justify-between items-end select-none",children:[c.jsx("h2",{className:"text-xl font-bold tracking-widest",children:"TERMINAL"}),c.jsx("div",{className:"text-[10px] text-green-700",children:"JIANGTHERAPEE_CLI_V1"})]}),c.jsx("div",{ref:M,className:"flex-grow overflow-y-auto overflow-x-hidden break-words mb-2 pr-1 scrollbar-thin scrollbar-thumb-green-900 scrollbar-track-black",children:b.map(V=>c.jsxs("div",{className:`mb-1 ${V.type==="in"?"opacity-50":""} ${V.type==="err"?"text-red-500":""} ${V.type==="info"?"text-cyan-400":""}`,children:[V.type!=="in"&&typeof V.text=="string"&&!V.text.startsWith(">")&&c.jsx("span",{className:"mr-2 opacity-50",children:">"}),V.text]},V.id))}),c.jsxs("div",{className:"relative flex items-center border-t border-green-800 pt-2",children:[c.jsx("span",{className:"text-green-500 mr-2 animate-pulse font-bold",children:">"}),c.jsx("input",{ref:_,type:"text",value:m,onChange:V=>g(V.target.value),onKeyDown:B,autoFocus:!0,className:"w-full bg-transparent border-none outline-none text-green-400 placeholder-green-900",placeholder:"Enter command (e.g. 'help')",spellCheck:!1,autoComplete:"off"})]}),c.jsx("input",{type:"file",ref:P,className:"hidden",multiple:!0,onChange:V=>I(V,"single")}),c.jsx("input",{type:"file",ref:A,className:"hidden",multiple:!0,onChange:V=>I(V,"pair")}),c.jsx("input",{type:"file",ref:R,className:"hidden",onChange:V=>z(V,"A")}),c.jsx("input",{type:"file",ref:D,className:"hidden",onChange:V=>z(V,"B")}),c.jsx("input",{type:"file",ref:E,className:"hidden",multiple:!0,onChange:V=>{e.onProcessStackFft&&V.target.files&&($(`Loading ${V.target.files.length} frames for Stack FFT...`),e.onProcessStackFft(V.target.files)),V.target.value=""}}),c.jsx("input",{type:"file",ref:W,className:"hidden",multiple:!0,onChange:V=>{e.onProcessBatchDiff&&V.target.files&&($("Starting Batch Diff..."),e.onProcessBatchDiff(V.target.files)),V.target.value=""}})]})}),BE=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];if(f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),n("B").forEach(h=>f[h]=d),f.some(h=>h>0))return f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN)&&l.some(u=>u>0))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},FE=e=>{const[t,r]=j.useState("gui"),{rawImageData:n,exifData:a,isBridgeConnected:i,displaySettings:o,onApplyDisplaySettings:s}=e,l=j.useRef(null),u=j.useRef(o);j.useEffect(()=>{u.current=o},[o]);const d=j.useRef(!1),f=j.useRef(null);j.useEffect(()=>{n!==f.current&&(d.current=!1,f.current=n)},[n]),j.useEffect(()=>{var k;if(!i||!n||d.current)return;const p=BE(n,a);if(!(!!p&&p.some(S=>S>0))||!p)return;const b=u.current,y=b.blackLevel;if(!!y&&y.some(S=>S>0)){d.current=!0;return}d.current=!0,console.log("[AutoApply] Detected Black Levels via Bridge:",p),(k=l.current)==null||k.log(`Auto-detected BL: ${p.join(" ")}`,"info");const g={...b,blackLevel:p};s(g)},[i,n,a,s]);const h=j.useCallback(p=>{var x;(x=l.current)==null||x.log(p,"in")},[]);return c.jsxs("div",{className:"flex flex-col h-full",children:[c.jsxs("div",{className:"flex bg-gray-200 dark:bg-gray-800 p-1 border-b border-gray-300 dark:border-gray-700 flex-shrink-0",children:[c.jsx("button",{onClick:()=>r("gui"),className:`flex-1 py-1 text-xs font-bold uppercase tracking-wider transition-colors border-r border-gray-300 dark:border-gray-700 ${t==="gui"?"bg-white dark:bg-black shadow-inner text-cyan-600 dark:text-cyan-400":"bg-gray-200 dark:bg-gray-900 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"GUI"}),c.jsx("button",{onClick:()=>r("terminal"),className:`flex-1 py-1 text-xs font-bold uppercase tracking-wider transition-colors ${t==="terminal"?"bg-black text-green-500 shadow-inner":"bg-gray-200 dark:bg-gray-900 text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"}`,children:"Terminal"})]}),c.jsxs("div",{className:"flex-grow overflow-hidden relative",children:[c.jsx("div",{className:`h-full w-full ${t==="gui"?"block":"hidden"}`,children:c.jsx($E,{...e,onCommand:h})}),c.jsx("div",{className:`h-full w-full ${t==="terminal"?"block":"hidden"}`,children:c.jsx(LE,{...e,ref:l})})]})]})},GE=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M20 12H4"})}),UE=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4v16m8-8H4"})}),zE=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 4v5h5M4 12a8 8 0 0114.24-5.12M20 20v-5h-5M20 12a8 8 0 01-14.24 5.12"})}),WE=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})}),VE=()=>c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 4l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),Qy=.1,e1=16,HE=Math.log(Qy),XE=Math.log(e1),KE=({zoom:e,onZoomChange:t,onResetView:r,touchAction:n,onToggleTouchAction:a})=>{const i=u=>{const d=parseFloat(u.target.value),f=Math.exp(d);t(Math.max(Qy,Math.min(e1,f)))},o=()=>{t(Math.min(e1,e*1.25))},s=()=>{t(Math.max(Qy,e/1.25))},l=Math.log(e);return c.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",onClick:u=>u.stopPropagation(),children:[c.jsx("div",{className:"bg-white/90 dark:bg-slate-800/70 backdrop-blur-sm p-2 rounded-lg border border-gray-200 dark:border-slate-700 flex items-center shadow-lg transition-colors duration-300",children:c.jsx("button",{onClick:a,className:`p-1.5 rounded-md transition-colors flex items-center justify-center ${n==="select"?"bg-cyan-100 text-cyan-600 dark:bg-cyan-900/50 dark:text-cyan-400 ring-2 ring-cyan-500/50":"text-gray-500 dark:text-slate-400 hover:bg-gray-100 dark:hover:bg-slate-700"}`,title:n==="select"?"Mode: Selection (Drag to Select)":"Mode: Pan (Drag to Move)",children:n==="select"?c.jsx(VE,{}):c.jsx(WE,{})})}),c.jsxs("div",{className:"bg-white/90 dark:bg-slate-800/70 backdrop-blur-sm p-2 rounded-lg border border-gray-200 dark:border-slate-700 flex items-center gap-2 text-gray-700 dark:text-slate-300 shadow-lg transition-colors duration-300",children:[c.jsx("button",{onClick:s,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Zoom Out","aria-label":"Zoom Out",children:c.jsx(GE,{})}),c.jsx("input",{type:"range",min:HE,max:XE,step:"0.01",value:l,onChange:i,className:"w-24 sm:w-32 h-2 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500","aria-label":"Zoom slider"}),c.jsx("button",{onClick:o,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Zoom In","aria-label":"Zoom In",children:c.jsx(UE,{})}),c.jsxs("span",{className:"w-16 text-center font-mono text-sm","aria-live":"polite",children:[(e*100).toFixed(0),"%"]}),c.jsx("button",{onClick:r,className:"p-1 rounded-md hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors",title:"Reset View","aria-label":"Reset View",children:c.jsx(zE,{})})]})]})},YE=({theme:e,setTheme:t})=>{const r=()=>{t(e==="light"?"dark":"light")};return c.jsx("button",{onClick:r,className:"fixed bottom-6 right-6 z-50 p-3 rounded-full bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 shadow-lg text-gray-800 dark:text-yellow-400 hover:bg-gray-100 dark:hover:bg-slate-700 transition-all duration-300",title:`Switch to ${e==="light"?"dark":"light"} mode`,children:e==="light"?c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-slate-700",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})}):c.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"})})})};function tP(e){var t,r,n="";if(typeof e=="string"||typeof e=="number")n+=e;else if(typeof e=="object")if(Array.isArray(e)){var a=e.length;for(t=0;t<a;t++)e[t]&&(r=tP(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function hr(){for(var e,t,r=0,n="",a=arguments.length;r<a;r++)(e=arguments[r])&&(t=tP(e))&&(n&&(n+=" "),n+=t);return n}var qE=Array.isArray,$a=qE,ZE=typeof g0=="object"&&g0&&g0.Object===Object&&g0,rP=ZE,JE=rP,QE=typeof self=="object"&&self&&self.Object===Object&&self,eI=JE||QE||Function("return this")(),so=eI,tI=so,rI=tI.Symbol,Yf=rI,Zk=Yf,nP=Object.prototype,nI=nP.hasOwnProperty,aI=nP.toString,cd=Zk?Zk.toStringTag:void 0;function iI(e){var t=nI.call(e,cd),r=e[cd];try{e[cd]=void 0;var n=!0}catch{}var a=aI.call(e);return n&&(t?e[cd]=r:delete e[cd]),a}var oI=iI,sI=Object.prototype,lI=sI.toString;function cI(e){return lI.call(e)}var uI=cI,Jk=Yf,dI=oI,fI=uI,hI="[object Null]",pI="[object Undefined]",Qk=Jk?Jk.toStringTag:void 0;function gI(e){return e==null?e===void 0?pI:hI:Qk&&Qk in Object(e)?dI(e):fI(e)}var Fo=gI;function mI(e){return e!=null&&typeof e=="object"}var Go=mI,xI=Fo,yI=Go,bI="[object Symbol]";function vI(e){return typeof e=="symbol"||yI(e)&&xI(e)==bI}var Ou=vI,wI=$a,kI=Ou,SI=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,jI=/^\w*$/;function MI(e,t){if(wI(e))return!1;var r=typeof e;return r=="number"||r=="symbol"||r=="boolean"||e==null||kI(e)?!0:jI.test(e)||!SI.test(e)||t!=null&&e in Object(t)}var Uv=MI;function _I(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}var Us=_I;const Au=Br(Us);var PI=Fo,NI=Us,CI="[object AsyncFunction]",OI="[object Function]",AI="[object GeneratorFunction]",TI="[object Proxy]";function EI(e){if(!NI(e))return!1;var t=PI(e);return t==OI||t==AI||t==CI||t==TI}var zv=EI;const Bt=Br(zv);var II=so,RI=II["__core-js_shared__"],DI=RI,gx=DI,e3=function(){var e=/[^.]+$/.exec(gx&&gx.keys&&gx.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}();function $I(e){return!!e3&&e3 in e}var LI=$I,BI=Function.prototype,FI=BI.toString;function GI(e){if(e!=null){try{return FI.call(e)}catch{}try{return e+""}catch{}}return""}var aP=GI,UI=zv,zI=LI,WI=Us,VI=aP,HI=/[\\^$.*+?()[\]{}|]/g,XI=/^\[object .+?Constructor\]$/,KI=Function.prototype,YI=Object.prototype,qI=KI.toString,ZI=YI.hasOwnProperty,JI=RegExp("^"+qI.call(ZI).replace(HI,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function QI(e){if(!WI(e)||zI(e))return!1;var t=UI(e)?JI:XI;return t.test(VI(e))}var eR=QI;function tR(e,t){return e==null?void 0:e[t]}var rR=tR,nR=eR,aR=rR;function iR(e,t){var r=aR(e,t);return nR(r)?r:void 0}var Xl=iR,oR=Xl,sR=oR(Object,"create"),Mg=sR,t3=Mg;function lR(){this.__data__=t3?t3(null):{},this.size=0}var cR=lR;function uR(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}var dR=uR,fR=Mg,hR="__lodash_hash_undefined__",pR=Object.prototype,gR=pR.hasOwnProperty;function mR(e){var t=this.__data__;if(fR){var r=t[e];return r===hR?void 0:r}return gR.call(t,e)?t[e]:void 0}var xR=mR,yR=Mg,bR=Object.prototype,vR=bR.hasOwnProperty;function wR(e){var t=this.__data__;return yR?t[e]!==void 0:vR.call(t,e)}var kR=wR,SR=Mg,jR="__lodash_hash_undefined__";function MR(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=SR&&t===void 0?jR:t,this}var _R=MR,PR=cR,NR=dR,CR=xR,OR=kR,AR=_R;function Tu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Tu.prototype.clear=PR;Tu.prototype.delete=NR;Tu.prototype.get=CR;Tu.prototype.has=OR;Tu.prototype.set=AR;var TR=Tu;function ER(){this.__data__=[],this.size=0}var IR=ER;function RR(e,t){return e===t||e!==e&&t!==t}var Wv=RR,DR=Wv;function $R(e,t){for(var r=e.length;r--;)if(DR(e[r][0],t))return r;return-1}var _g=$R,LR=_g,BR=Array.prototype,FR=BR.splice;function GR(e){var t=this.__data__,r=LR(t,e);if(r<0)return!1;var n=t.length-1;return r==n?t.pop():FR.call(t,r,1),--this.size,!0}var UR=GR,zR=_g;function WR(e){var t=this.__data__,r=zR(t,e);return r<0?void 0:t[r][1]}var VR=WR,HR=_g;function XR(e){return HR(this.__data__,e)>-1}var KR=XR,YR=_g;function qR(e,t){var r=this.__data__,n=YR(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this}var ZR=qR,JR=IR,QR=UR,eD=VR,tD=KR,rD=ZR;function Eu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Eu.prototype.clear=JR;Eu.prototype.delete=QR;Eu.prototype.get=eD;Eu.prototype.has=tD;Eu.prototype.set=rD;var Pg=Eu,nD=Xl,aD=so,iD=nD(aD,"Map"),Vv=iD,r3=TR,oD=Pg,sD=Vv;function lD(){this.size=0,this.__data__={hash:new r3,map:new(sD||oD),string:new r3}}var cD=lD;function uD(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}var dD=uD,fD=dD;function hD(e,t){var r=e.__data__;return fD(t)?r[typeof t=="string"?"string":"hash"]:r.map}var Ng=hD,pD=Ng;function gD(e){var t=pD(this,e).delete(e);return this.size-=t?1:0,t}var mD=gD,xD=Ng;function yD(e){return xD(this,e).get(e)}var bD=yD,vD=Ng;function wD(e){return vD(this,e).has(e)}var kD=wD,SD=Ng;function jD(e,t){var r=SD(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this}var MD=jD,_D=cD,PD=mD,ND=bD,CD=kD,OD=MD;function Iu(e){var t=-1,r=e==null?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}Iu.prototype.clear=_D;Iu.prototype.delete=PD;Iu.prototype.get=ND;Iu.prototype.has=CD;Iu.prototype.set=OD;var Hv=Iu,iP=Hv,AD="Expected a function";function Xv(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new TypeError(AD);var r=function(){var n=arguments,a=t?t.apply(this,n):n[0],i=r.cache;if(i.has(a))return i.get(a);var o=e.apply(this,n);return r.cache=i.set(a,o)||i,o};return r.cache=new(Xv.Cache||iP),r}Xv.Cache=iP;var oP=Xv;const TD=Br(oP);var ED=oP,ID=500;function RD(e){var t=ED(e,function(n){return r.size===ID&&r.clear(),n}),r=t.cache;return t}var DD=RD,$D=DD,LD=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,BD=/\\(\\)?/g,FD=$D(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(LD,function(r,n,a,i){t.push(a?i.replace(BD,"$1"):n||r)}),t}),GD=FD;function UD(e,t){for(var r=-1,n=e==null?0:e.length,a=Array(n);++r<n;)a[r]=t(e[r],r,e);return a}var Kv=UD,n3=Yf,zD=Kv,WD=$a,VD=Ou,a3=n3?n3.prototype:void 0,i3=a3?a3.toString:void 0;function sP(e){if(typeof e=="string")return e;if(WD(e))return zD(e,sP)+"";if(VD(e))return i3?i3.call(e):"";var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var HD=sP,XD=HD;function KD(e){return e==null?"":XD(e)}var lP=KD,YD=$a,qD=Uv,ZD=GD,JD=lP;function QD(e,t){return YD(e)?e:qD(e,t)?[e]:ZD(JD(e))}var cP=QD,e$=Ou;function t$(e){if(typeof e=="string"||e$(e))return e;var t=e+"";return t=="0"&&1/e==-1/0?"-0":t}var Cg=t$,r$=cP,n$=Cg;function a$(e,t){t=r$(t,e);for(var r=0,n=t.length;e!=null&&r<n;)e=e[n$(t[r++])];return r&&r==n?e:void 0}var Yv=a$,i$=Yv;function o$(e,t,r){var n=e==null?void 0:i$(e,t);return n===void 0?r:n}var uP=o$;const hi=Br(uP);function s$(e){return e==null}var l$=s$;const Et=Br(l$);var c$=Fo,u$=$a,d$=Go,f$="[object String]";function h$(e){return typeof e=="string"||!u$(e)&&d$(e)&&c$(e)==f$}var p$=h$;const Ll=Br(p$);var dP={exports:{}},Ir={};/**
 * @license React
 * react-is.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var qv=Symbol.for("react.element"),Zv=Symbol.for("react.portal"),Og=Symbol.for("react.fragment"),Ag=Symbol.for("react.strict_mode"),Tg=Symbol.for("react.profiler"),Eg=Symbol.for("react.provider"),Ig=Symbol.for("react.context"),g$=Symbol.for("react.server_context"),Rg=Symbol.for("react.forward_ref"),Dg=Symbol.for("react.suspense"),$g=Symbol.for("react.suspense_list"),Lg=Symbol.for("react.memo"),Bg=Symbol.for("react.lazy"),m$=Symbol.for("react.offscreen"),fP;fP=Symbol.for("react.module.reference");function xi(e){if(typeof e=="object"&&e!==null){var t=e.$$typeof;switch(t){case qv:switch(e=e.type,e){case Og:case Tg:case Ag:case Dg:case $g:return e;default:switch(e=e&&e.$$typeof,e){case g$:case Ig:case Rg:case Bg:case Lg:case Eg:return e;default:return t}}case Zv:return t}}}Ir.ContextConsumer=Ig;Ir.ContextProvider=Eg;Ir.Element=qv;Ir.ForwardRef=Rg;Ir.Fragment=Og;Ir.Lazy=Bg;Ir.Memo=Lg;Ir.Portal=Zv;Ir.Profiler=Tg;Ir.StrictMode=Ag;Ir.Suspense=Dg;Ir.SuspenseList=$g;Ir.isAsyncMode=function(){return!1};Ir.isConcurrentMode=function(){return!1};Ir.isContextConsumer=function(e){return xi(e)===Ig};Ir.isContextProvider=function(e){return xi(e)===Eg};Ir.isElement=function(e){return typeof e=="object"&&e!==null&&e.$$typeof===qv};Ir.isForwardRef=function(e){return xi(e)===Rg};Ir.isFragment=function(e){return xi(e)===Og};Ir.isLazy=function(e){return xi(e)===Bg};Ir.isMemo=function(e){return xi(e)===Lg};Ir.isPortal=function(e){return xi(e)===Zv};Ir.isProfiler=function(e){return xi(e)===Tg};Ir.isStrictMode=function(e){return xi(e)===Ag};Ir.isSuspense=function(e){return xi(e)===Dg};Ir.isSuspenseList=function(e){return xi(e)===$g};Ir.isValidElementType=function(e){return typeof e=="string"||typeof e=="function"||e===Og||e===Tg||e===Ag||e===Dg||e===$g||e===m$||typeof e=="object"&&e!==null&&(e.$$typeof===Bg||e.$$typeof===Lg||e.$$typeof===Eg||e.$$typeof===Ig||e.$$typeof===Rg||e.$$typeof===fP||e.getModuleId!==void 0)};Ir.typeOf=xi;dP.exports=Ir;var x$=dP.exports,y$=Fo,b$=Go,v$="[object Number]";function w$(e){return typeof e=="number"||b$(e)&&y$(e)==v$}var hP=w$;const k$=Br(hP);var S$=hP;function j$(e){return S$(e)&&e!=+e}var M$=j$;const Ru=Br(M$);var Ti=function(t){return t===0?0:t>0?1:-1},pl=function(t){return Ll(t)&&t.indexOf("%")===t.length-1},Re=function(t){return k$(t)&&!Ru(t)},_$=function(t){return Et(t)},Ln=function(t){return Re(t)||Ll(t)},P$=0,Kl=function(t){var r=++P$;return"".concat(t||"").concat(r)},Bl=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!Re(t)&&!Ll(t))return n;var i;if(pl(t)){var o=t.indexOf("%");i=r*parseFloat(t.slice(0,o))/100}else i=+t;return Ru(i)&&(i=n),a&&i>r&&(i=r),i},us=function(t){if(!t)return null;var r=Object.keys(t);return r&&r.length?t[r[0]]:null},N$=function(t){if(!Array.isArray(t))return!1;for(var r=t.length,n={},a=0;a<r;a++)if(!n[t[a]])n[t[a]]=!0;else return!0;return!1},xn=function(t,r){return Re(t)&&Re(r)?function(n){return t+n*(r-t)}:function(){return r}};function Zh(e,t,r){return!e||!e.length?null:e.find(function(n){return n&&(typeof t=="function"?t(n):hi(n,t))===r})}var C$=function(t){if(!t||!t.length)return null;for(var r=t.length,n=0,a=0,i=0,o=0,s=1/0,l=-1/0,u=0,d=0,f=0;f<r;f++)u=t[f].cx||0,d=t[f].cy||0,n+=u,a+=d,i+=u*d,o+=u*u,s=Math.min(s,u),l=Math.max(l,u);var h=r*o!==n*n?(r*i-n*a)/(r*o-n*n):0;return{xmin:s,xmax:l,a:h,b:(a-h*n)/r}},O$=function(t,r){return Re(t)&&Re(r)?t-r:Ll(t)&&Ll(r)?t.localeCompare(r):t instanceof Date&&r instanceof Date?t.getTime()-r.getTime():String(t).localeCompare(String(r))};function Lc(e,t){for(var r in e)if({}.hasOwnProperty.call(e,r)&&(!{}.hasOwnProperty.call(t,r)||e[r]!==t[r]))return!1;for(var n in t)if({}.hasOwnProperty.call(t,n)&&!{}.hasOwnProperty.call(e,n))return!1;return!0}function t1(e){"@babel/helpers - typeof";return t1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t1(e)}var A$=["viewBox","children"],T$=["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"],o3=["points","pathLength"],mx={svg:A$,polygon:o3,polyline:o3},Jv=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"],Jh=function(t,r){if(!t||typeof t=="function"||typeof t=="boolean")return null;var n=t;if(j.isValidElement(t)&&(n=t.props),!Au(n))return null;var a={};return Object.keys(n).forEach(function(i){Jv.includes(i)&&(a[i]=r||function(o){return n[i](n,o)})}),a},E$=function(t,r,n){return function(a){return t(r,n,a),null}},lf=function(t,r,n){if(!Au(t)||t1(t)!=="object")return null;var a=null;return Object.keys(t).forEach(function(i){var o=t[i];Jv.includes(i)&&typeof o=="function"&&(a||(a={}),a[i]=E$(o,r,n))}),a},I$=["children"],R$=["children"];function s3(e,t){if(e==null)return{};var r=D$(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function D$(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function r1(e){"@babel/helpers - typeof";return r1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r1(e)}var l3={click:"onClick",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart",contextmenu:"onContextMenu",dblclick:"onDoubleClick"},No=function(t){return typeof t=="string"?t:t?t.displayName||t.name||"Component":""},c3=null,xx=null,Qv=function e(t){if(t===c3&&Array.isArray(xx))return xx;var r=[];return j.Children.forEach(t,function(n){Et(n)||(x$.isFragment(n)?r=r.concat(e(n.props.children)):r.push(n))}),xx=r,c3=t,r};function Da(e,t){var r=[],n=[];return Array.isArray(t)?n=t.map(function(a){return No(a)}):n=[No(t)],Qv(e).forEach(function(a){var i=hi(a,"type.displayName")||hi(a,"type.name");n.indexOf(i)!==-1&&r.push(a)}),r}function Va(e,t){var r=Da(e,t);return r&&r[0]}var u3=function(t){if(!t||!t.props)return!1;var r=t.props,n=r.width,a=r.height;return!(!Re(n)||n<=0||!Re(a)||a<=0)},$$=["a","altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColormatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-url","foreignObject","g","glyph","glyphRef","hkern","image","line","lineGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","script","set","stop","style","svg","switch","symbol","text","textPath","title","tref","tspan","use","view","vkern"],L$=function(t){return t&&t.type&&Ll(t.type)&&$$.indexOf(t.type)>=0},pP=function(t){return t&&r1(t)==="object"&&"clipDot"in t},B$=function(t,r,n,a){var i,o=(i=mx==null?void 0:mx[a])!==null&&i!==void 0?i:[];return r.startsWith("data-")||!Bt(t)&&(a&&o.includes(r)||T$.includes(r))||n&&Jv.includes(r)},Dt=function(t,r,n){if(!t||typeof t=="function"||typeof t=="boolean")return null;var a=t;if(j.isValidElement(t)&&(a=t.props),!Au(a))return null;var i={};return Object.keys(a).forEach(function(o){var s;B$((s=a)===null||s===void 0?void 0:s[o],o,r,n)&&(i[o]=a[o])}),i},n1=function e(t,r){if(t===r)return!0;var n=j.Children.count(t);if(n!==j.Children.count(r))return!1;if(n===0)return!0;if(n===1)return d3(Array.isArray(t)?t[0]:t,Array.isArray(r)?r[0]:r);for(var a=0;a<n;a++){var i=t[a],o=r[a];if(Array.isArray(i)||Array.isArray(o)){if(!e(i,o))return!1}else if(!d3(i,o))return!1}return!0},d3=function(t,r){if(Et(t)&&Et(r))return!0;if(!Et(t)&&!Et(r)){var n=t.props||{},a=n.children,i=s3(n,I$),o=r.props||{},s=o.children,l=s3(o,R$);return a&&s?Lc(i,l)&&n1(a,s):!a&&!s?Lc(i,l):!1}return!1},f3=function(t,r){var n=[],a={};return Qv(t).forEach(function(i,o){if(L$(i))n.push(i);else if(i){var s=No(i.type),l=r[s]||{},u=l.handler,d=l.once;if(u&&(!d||!a[s])){var f=u(i,s,o);n.push(f),a[s]=!0}}}),n},F$=function(t){var r=t&&t.type;return r&&l3[r]?l3[r]:null},G$=function(t,r){return Qv(r).indexOf(t)},U$=["children","width","height","viewBox","className","style","title","desc"];function a1(){return a1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a1.apply(this,arguments)}function z$(e,t){if(e==null)return{};var r=W$(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function W$(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function i1(e){var t=e.children,r=e.width,n=e.height,a=e.viewBox,i=e.className,o=e.style,s=e.title,l=e.desc,u=z$(e,U$),d=a||{width:r,height:n,x:0,y:0},f=hr("recharts-surface",i);return re.createElement("svg",a1({},Dt(u,!0,"svg"),{className:f,width:r,height:n,style:o,viewBox:"".concat(d.x," ").concat(d.y," ").concat(d.width," ").concat(d.height)}),re.createElement("title",null,s),re.createElement("desc",null,l),t)}var V$=["children","className"];function o1(){return o1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},o1.apply(this,arguments)}function H$(e,t){if(e==null)return{};var r=X$(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function X$(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var _r=re.forwardRef(function(e,t){var r=e.children,n=e.className,a=H$(e,V$),i=hr("recharts-layer",n);return re.createElement("g",o1({className:i},Dt(a,!0),{ref:t}),r)}),Co=function(t,r){for(var n=arguments.length,a=new Array(n>2?n-2:0),i=2;i<n;i++)a[i-2]=arguments[i]};function K$(e,t,r){var n=-1,a=e.length;t<0&&(t=-t>a?0:a+t),r=r>a?a:r,r<0&&(r+=a),a=t>r?0:r-t>>>0,t>>>=0;for(var i=Array(a);++n<a;)i[n]=e[n+t];return i}var Y$=K$,q$=Y$;function Z$(e,t,r){var n=e.length;return r=r===void 0?n:r,!t&&r>=n?e:q$(e,t,r)}var J$=Z$,Q$="\\ud800-\\udfff",e7="\\u0300-\\u036f",t7="\\ufe20-\\ufe2f",r7="\\u20d0-\\u20ff",n7=e7+t7+r7,a7="\\ufe0e\\ufe0f",i7="\\u200d",o7=RegExp("["+i7+Q$+n7+a7+"]");function s7(e){return o7.test(e)}var gP=s7;function l7(e){return e.split("")}var c7=l7,mP="\\ud800-\\udfff",u7="\\u0300-\\u036f",d7="\\ufe20-\\ufe2f",f7="\\u20d0-\\u20ff",h7=u7+d7+f7,p7="\\ufe0e\\ufe0f",g7="["+mP+"]",s1="["+h7+"]",l1="\\ud83c[\\udffb-\\udfff]",m7="(?:"+s1+"|"+l1+")",xP="[^"+mP+"]",yP="(?:\\ud83c[\\udde6-\\uddff]){2}",bP="[\\ud800-\\udbff][\\udc00-\\udfff]",x7="\\u200d",vP=m7+"?",wP="["+p7+"]?",y7="(?:"+x7+"(?:"+[xP,yP,bP].join("|")+")"+wP+vP+")*",b7=wP+vP+y7,v7="(?:"+[xP+s1+"?",s1,yP,bP,g7].join("|")+")",w7=RegExp(l1+"(?="+l1+")|"+v7+b7,"g");function k7(e){return e.match(w7)||[]}var S7=k7,j7=c7,M7=gP,_7=S7;function P7(e){return M7(e)?_7(e):j7(e)}var N7=P7,C7=J$,O7=gP,A7=N7,T7=lP;function E7(e){return function(t){t=T7(t);var r=O7(t)?A7(t):void 0,n=r?r[0]:t.charAt(0),a=r?C7(r,1).join(""):t.slice(1);return n[e]()+a}}var I7=E7,R7=I7,D7=R7("toUpperCase"),$7=D7;const Fg=Br($7);function Vr(e){return function(){return e}}const kP=Math.cos,Qh=Math.sin,Bi=Math.sqrt,ep=Math.PI,Gg=2*ep,c1=Math.PI,u1=2*c1,il=1e-6,L7=u1-il;function SP(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}function B7(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return SP;const r=10**t;return function(n){this._+=n[0];for(let a=1,i=n.length;a<i;++a)this._+=Math.round(arguments[a]*r)/r+n[a]}}class F7{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?SP:B7(t)}moveTo(t,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,r){this._append`L${this._x1=+t},${this._y1=+r}`}quadraticCurveTo(t,r,n,a){this._append`Q${+t},${+r},${this._x1=+n},${this._y1=+a}`}bezierCurveTo(t,r,n,a,i,o){this._append`C${+t},${+r},${+n},${+a},${this._x1=+i},${this._y1=+o}`}arcTo(t,r,n,a,i){if(t=+t,r=+r,n=+n,a=+a,i=+i,i<0)throw new Error(`negative radius: ${i}`);let o=this._x1,s=this._y1,l=n-t,u=a-r,d=o-t,f=s-r,h=d*d+f*f;if(this._x1===null)this._append`M${this._x1=t},${this._y1=r}`;else if(h>il)if(!(Math.abs(f*l-u*d)>il)||!i)this._append`L${this._x1=t},${this._y1=r}`;else{let p=n-o,x=a-s,b=l*l+u*u,y=p*p+x*x,m=Math.sqrt(b),g=Math.sqrt(h),k=i*Math.tan((c1-Math.acos((b+h-y)/(2*m*g)))/2),S=k/g,w=k/m;Math.abs(S-1)>il&&this._append`L${t+S*d},${r+S*f}`,this._append`A${i},${i},0,0,${+(f*p>d*x)},${this._x1=t+w*l},${this._y1=r+w*u}`}}arc(t,r,n,a,i,o){if(t=+t,r=+r,n=+n,o=!!o,n<0)throw new Error(`negative radius: ${n}`);let s=n*Math.cos(a),l=n*Math.sin(a),u=t+s,d=r+l,f=1^o,h=o?a-i:i-a;this._x1===null?this._append`M${u},${d}`:(Math.abs(this._x1-u)>il||Math.abs(this._y1-d)>il)&&this._append`L${u},${d}`,n&&(h<0&&(h=h%u1+u1),h>L7?this._append`A${n},${n},0,1,${f},${t-s},${r-l}A${n},${n},0,1,${f},${this._x1=u},${this._y1=d}`:h>il&&this._append`A${n},${n},0,${+(h>=c1)},${f},${this._x1=t+n*Math.cos(i)},${this._y1=r+n*Math.sin(i)}`)}rect(t,r,n,a){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+r}h${n=+n}v${+a}h${-n}Z`}toString(){return this._}}function e2(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(r==null)t=null;else{const n=Math.floor(r);if(!(n>=0))throw new RangeError(`invalid digits: ${r}`);t=n}return e},()=>new F7(t)}function t2(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function jP(e){this._context=e}jP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t);break}}};function Ug(e){return new jP(e)}function MP(e){return e[0]}function _P(e){return e[1]}function PP(e,t){var r=Vr(!0),n=null,a=Ug,i=null,o=e2(s);e=typeof e=="function"?e:e===void 0?MP:Vr(e),t=typeof t=="function"?t:t===void 0?_P:Vr(t);function s(l){var u,d=(l=t2(l)).length,f,h=!1,p;for(n==null&&(i=a(p=o())),u=0;u<=d;++u)!(u<d&&r(f=l[u],u,l))===h&&((h=!h)?i.lineStart():i.lineEnd()),h&&i.point(+e(f,u,l),+t(f,u,l));if(p)return i=null,p+""||null}return s.x=function(l){return arguments.length?(e=typeof l=="function"?l:Vr(+l),s):e},s.y=function(l){return arguments.length?(t=typeof l=="function"?l:Vr(+l),s):t},s.defined=function(l){return arguments.length?(r=typeof l=="function"?l:Vr(!!l),s):r},s.curve=function(l){return arguments.length?(a=l,n!=null&&(i=a(n)),s):a},s.context=function(l){return arguments.length?(l==null?n=i=null:i=a(n=l),s):n},s}function G0(e,t,r){var n=null,a=Vr(!0),i=null,o=Ug,s=null,l=e2(u);e=typeof e=="function"?e:e===void 0?MP:Vr(+e),t=typeof t=="function"?t:Vr(t===void 0?0:+t),r=typeof r=="function"?r:r===void 0?_P:Vr(+r);function u(f){var h,p,x,b=(f=t2(f)).length,y,m=!1,g,k=new Array(b),S=new Array(b);for(i==null&&(s=o(g=l())),h=0;h<=b;++h){if(!(h<b&&a(y=f[h],h,f))===m)if(m=!m)p=h,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),x=h-1;x>=p;--x)s.point(k[x],S[x]);s.lineEnd(),s.areaEnd()}m&&(k[h]=+e(y,h,f),S[h]=+t(y,h,f),s.point(n?+n(y,h,f):k[h],r?+r(y,h,f):S[h]))}if(g)return s=null,g+""||null}function d(){return PP().defined(a).curve(o).context(i)}return u.x=function(f){return arguments.length?(e=typeof f=="function"?f:Vr(+f),n=null,u):e},u.x0=function(f){return arguments.length?(e=typeof f=="function"?f:Vr(+f),u):e},u.x1=function(f){return arguments.length?(n=f==null?null:typeof f=="function"?f:Vr(+f),u):n},u.y=function(f){return arguments.length?(t=typeof f=="function"?f:Vr(+f),r=null,u):t},u.y0=function(f){return arguments.length?(t=typeof f=="function"?f:Vr(+f),u):t},u.y1=function(f){return arguments.length?(r=f==null?null:typeof f=="function"?f:Vr(+f),u):r},u.lineX0=u.lineY0=function(){return d().x(e).y(t)},u.lineY1=function(){return d().x(e).y(r)},u.lineX1=function(){return d().x(n).y(t)},u.defined=function(f){return arguments.length?(a=typeof f=="function"?f:Vr(!!f),u):a},u.curve=function(f){return arguments.length?(o=f,i!=null&&(s=o(i)),u):o},u.context=function(f){return arguments.length?(f==null?i=s=null:s=o(i=f),u):i},u}class NP{constructor(t,r){this._context=t,this._x=r}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(t,r){switch(t=+t,r=+r,this._point){case 0:{this._point=1,this._line?this._context.lineTo(t,r):this._context.moveTo(t,r);break}case 1:this._point=2;default:{this._x?this._context.bezierCurveTo(this._x0=(this._x0+t)/2,this._y0,this._x0,r,t,r):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+r)/2,t,this._y0,t,r);break}}this._x0=t,this._y0=r}}function G7(e){return new NP(e,!0)}function U7(e){return new NP(e,!1)}const r2={draw(e,t){const r=Bi(t/ep);e.moveTo(r,0),e.arc(0,0,r,0,Gg)}},z7={draw(e,t){const r=Bi(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},CP=Bi(1/3),W7=CP*2,V7={draw(e,t){const r=Bi(t/W7),n=r*CP;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},H7={draw(e,t){const r=Bi(t),n=-r/2;e.rect(n,n,r,r)}},X7=.8908130915292852,OP=Qh(ep/10)/Qh(7*ep/10),K7=Qh(Gg/10)*OP,Y7=-kP(Gg/10)*OP,q7={draw(e,t){const r=Bi(t*X7),n=K7*r,a=Y7*r;e.moveTo(0,-r),e.lineTo(n,a);for(let i=1;i<5;++i){const o=Gg*i/5,s=kP(o),l=Qh(o);e.lineTo(l*r,-s*r),e.lineTo(s*n-l*a,l*n+s*a)}e.closePath()}},yx=Bi(3),Z7={draw(e,t){const r=-Bi(t/(yx*3));e.moveTo(0,r*2),e.lineTo(-yx*r,-r),e.lineTo(yx*r,-r),e.closePath()}},ni=-.5,ai=Bi(3)/2,d1=1/Bi(12),J7=(d1/2+1)*3,Q7={draw(e,t){const r=Bi(t/J7),n=r/2,a=r*d1,i=n,o=r*d1+r,s=-i,l=o;e.moveTo(n,a),e.lineTo(i,o),e.lineTo(s,l),e.lineTo(ni*n-ai*a,ai*n+ni*a),e.lineTo(ni*i-ai*o,ai*i+ni*o),e.lineTo(ni*s-ai*l,ai*s+ni*l),e.lineTo(ni*n+ai*a,ni*a-ai*n),e.lineTo(ni*i+ai*o,ni*o-ai*i),e.lineTo(ni*s+ai*l,ni*l-ai*s),e.closePath()}};function e9(e,t){let r=null,n=e2(a);e=typeof e=="function"?e:Vr(e||r2),t=typeof t=="function"?t:Vr(t===void 0?64:+t);function a(){let i;if(r||(r=i=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),i)return r=null,i+""||null}return a.type=function(i){return arguments.length?(e=typeof i=="function"?i:Vr(i),a):e},a.size=function(i){return arguments.length?(t=typeof i=="function"?i:Vr(+i),a):t},a.context=function(i){return arguments.length?(r=i??null,a):r},a}function tp(){}function rp(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function AP(e){this._context=e}AP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:rp(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1);break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:rp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function t9(e){return new AP(e)}function TP(e){this._context=e}TP.prototype={areaStart:tp,areaEnd:tp,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:{this._context.moveTo(this._x2,this._y2),this._context.closePath();break}case 2:{this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break}case 3:{this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4);break}}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:rp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function r9(e){return new TP(e)}function EP(e){this._context=e}EP.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===3)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:rp(this,e,t);break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};function n9(e){return new EP(e)}function IP(e){this._context=e}IP.prototype={areaStart:tp,areaEnd:tp,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}};function a9(e){return new IP(e)}function h3(e){return e<0?-1:1}function p3(e,t,r){var n=e._x1-e._x0,a=t-e._x1,i=(e._y1-e._y0)/(n||a<0&&-0),o=(r-e._y1)/(a||n<0&&-0),s=(i*a+o*n)/(n+a);return(h3(i)+h3(o))*Math.min(Math.abs(i),Math.abs(o),.5*Math.abs(s))||0}function g3(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function bx(e,t,r){var n=e._x0,a=e._y0,i=e._x1,o=e._y1,s=(i-n)/3;e._context.bezierCurveTo(n+s,a+s*t,i-s,o-s*r,i,o)}function np(e){this._context=e}np.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:bx(this,this._t0,g3(this,this._t0));break}(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(e=+e,t=+t,!(e===this._x1&&t===this._y1)){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,bx(this,g3(this,r=p3(this,e,t)),r);break;default:bx(this,this._t0,r=p3(this,e,t));break}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}};function RP(e){this._context=new DP(e)}(RP.prototype=Object.create(np.prototype)).point=function(e,t){np.prototype.point.call(this,t,e)};function DP(e){this._context=e}DP.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,a,i){this._context.bezierCurveTo(t,e,n,r,i,a)}};function i9(e){return new np(e)}function o9(e){return new RP(e)}function $P(e){this._context=e}$P.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),r===2)this._context.lineTo(e[1],t[1]);else for(var n=m3(e),a=m3(t),i=0,o=1;o<r;++i,++o)this._context.bezierCurveTo(n[0][i],a[0][i],n[1][i],a[1][i],e[o],t[o]);(this._line||this._line!==0&&r===1)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}};function m3(e){var t,r=e.length-1,n,a=new Array(r),i=new Array(r),o=new Array(r);for(a[0]=0,i[0]=2,o[0]=e[0]+2*e[1],t=1;t<r-1;++t)a[t]=1,i[t]=4,o[t]=4*e[t]+2*e[t+1];for(a[r-1]=2,i[r-1]=7,o[r-1]=8*e[r-1]+e[r],t=1;t<r;++t)n=a[t]/i[t-1],i[t]-=n,o[t]-=n*o[t-1];for(a[r-1]=o[r-1]/i[r-1],t=r-2;t>=0;--t)a[t]=(o[t]-a[t+1])/i[t];for(i[r-1]=(e[r]+a[r-1])/2,t=0;t<r-1;++t)i[t]=2*e[t+1]-a[t+1];return[a,i]}function s9(e){return new $P(e)}function zg(e,t){this._context=e,this._t=t}zg.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&this._point===2&&this._context.lineTo(this._x,this._y),(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:{if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}break}}this._x=e,this._y=t}};function l9(e){return new zg(e,.5)}function c9(e){return new zg(e,0)}function u9(e){return new zg(e,1)}function Jc(e,t){if((o=e.length)>1)for(var r=1,n,a,i=e[t[0]],o,s=i.length;r<o;++r)for(a=i,i=e[t[r]],n=0;n<s;++n)i[n][1]+=i[n][0]=isNaN(a[n][1])?a[n][0]:a[n][1]}function f1(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function d9(e,t){return e[t]}function f9(e){const t=[];return t.key=e,t}function h9(){var e=Vr([]),t=f1,r=Jc,n=d9;function a(i){var o=Array.from(e.apply(this,arguments),f9),s,l=o.length,u=-1,d;for(const f of i)for(s=0,++u;s<l;++s)(o[s][u]=[0,+n(f,o[s].key,u,i)]).data=f;for(s=0,d=t2(t(o));s<l;++s)o[d[s]].index=s;return r(o,d),o}return a.keys=function(i){return arguments.length?(e=typeof i=="function"?i:Vr(Array.from(i)),a):e},a.value=function(i){return arguments.length?(n=typeof i=="function"?i:Vr(+i),a):n},a.order=function(i){return arguments.length?(t=i==null?f1:typeof i=="function"?i:Vr(Array.from(i)),a):t},a.offset=function(i){return arguments.length?(r=i??Jc,a):r},a}function p9(e,t){if((n=e.length)>0){for(var r,n,a=0,i=e[0].length,o;a<i;++a){for(o=r=0;r<n;++r)o+=e[r][a][1]||0;if(o)for(r=0;r<n;++r)e[r][a][1]/=o}Jc(e,t)}}function g9(e,t){if((a=e.length)>0){for(var r=0,n=e[t[0]],a,i=n.length;r<i;++r){for(var o=0,s=0;o<a;++o)s+=e[o][r][1]||0;n[r][1]+=n[r][0]=-s/2}Jc(e,t)}}function m9(e,t){if(!(!((o=e.length)>0)||!((i=(a=e[t[0]]).length)>0))){for(var r=0,n=1,a,i,o;n<i;++n){for(var s=0,l=0,u=0;s<o;++s){for(var d=e[t[s]],f=d[n][1]||0,h=d[n-1][1]||0,p=(f-h)/2,x=0;x<s;++x){var b=e[t[x]],y=b[n][1]||0,m=b[n-1][1]||0;p+=y-m}l+=f,u+=p*f}a[n-1][1]+=a[n-1][0]=r,l&&(r-=u/l)}a[n-1][1]+=a[n-1][0]=r,Jc(e,t)}}function cf(e){"@babel/helpers - typeof";return cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cf(e)}var x9=["type","size","sizeType"];function h1(){return h1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},h1.apply(this,arguments)}function x3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y3(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x3(Object(r),!0).forEach(function(n){y9(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function y9(e,t,r){return t=b9(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function b9(e){var t=v9(e,"string");return cf(t)=="symbol"?t:t+""}function v9(e,t){if(cf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function w9(e,t){if(e==null)return{};var r=k9(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function k9(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var LP={symbolCircle:r2,symbolCross:z7,symbolDiamond:V7,symbolSquare:H7,symbolStar:q7,symbolTriangle:Z7,symbolWye:Q7},S9=Math.PI/180,j9=function(t){var r="symbol".concat(Fg(t));return LP[r]||r2},M9=function(t,r,n){if(r==="area")return t;switch(n){case"cross":return 5*t*t/9;case"diamond":return .5*t*t/Math.sqrt(3);case"square":return t*t;case"star":{var a=18*S9;return 1.25*t*t*(Math.tan(a)-Math.tan(a*2)*Math.pow(Math.tan(a),2))}case"triangle":return Math.sqrt(3)*t*t/4;case"wye":return(21-10*Math.sqrt(3))*t*t/8;default:return Math.PI*t*t/4}},_9=function(t,r){LP["symbol".concat(Fg(t))]=r},Wg=function(t){var r=t.type,n=r===void 0?"circle":r,a=t.size,i=a===void 0?64:a,o=t.sizeType,s=o===void 0?"area":o,l=w9(t,x9),u=y3(y3({},l),{},{type:n,size:i,sizeType:s}),d=function(){var y=j9(n),m=e9().type(y).size(M9(i,s,n));return m()},f=u.className,h=u.cx,p=u.cy,x=Dt(u,!0);return h===+h&&p===+p&&i===+i?re.createElement("path",h1({},x,{className:hr("recharts-symbols",f),transform:"translate(".concat(h,", ").concat(p,")"),d:d()})):null};Wg.registerSymbol=_9;function Qc(e){"@babel/helpers - typeof";return Qc=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qc(e)}function p1(){return p1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p1.apply(this,arguments)}function b3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P9(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?b3(Object(r),!0).forEach(function(n){uf(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):b3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function N9(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C9(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FP(n.key),n)}}function O9(e,t,r){return t&&C9(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function A9(e,t,r){return t=ap(t),T9(e,BP()?Reflect.construct(t,r||[],ap(e).constructor):t.apply(e,r))}function T9(e,t){if(t&&(Qc(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return E9(e)}function E9(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BP(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BP=function(){return!!e})()}function ap(e){return ap=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},ap(e)}function I9(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&g1(e,t)}function g1(e,t){return g1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},g1(e,t)}function uf(e,t,r){return t=FP(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FP(e){var t=R9(e,"string");return Qc(t)=="symbol"?t:t+""}function R9(e,t){if(Qc(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Qc(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ii=32,n2=function(e){function t(){return N9(this,t),A9(this,t,arguments)}return I9(t,e),O9(t,[{key:"renderIcon",value:function(n){var a=this.props.inactiveColor,i=ii/2,o=ii/6,s=ii/3,l=n.inactive?a:n.color;if(n.type==="plainline")return re.createElement("line",{strokeWidth:4,fill:"none",stroke:l,strokeDasharray:n.payload.strokeDasharray,x1:0,y1:i,x2:ii,y2:i,className:"recharts-legend-icon"});if(n.type==="line")return re.createElement("path",{strokeWidth:4,fill:"none",stroke:l,d:"M0,".concat(i,"h").concat(s,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(2*s,",").concat(i,`
            H`).concat(ii,"M").concat(2*s,",").concat(i,`
            A`).concat(o,",").concat(o,",0,1,1,").concat(s,",").concat(i),className:"recharts-legend-icon"});if(n.type==="rect")return re.createElement("path",{stroke:"none",fill:l,d:"M0,".concat(ii/8,"h").concat(ii,"v").concat(ii*3/4,"h").concat(-ii,"z"),className:"recharts-legend-icon"});if(re.isValidElement(n.legendIcon)){var u=P9({},n);return delete u.legendIcon,re.cloneElement(n.legendIcon,u)}return re.createElement(Wg,{fill:l,cx:i,cy:i,size:ii,sizeType:"diameter",type:n.type})}},{key:"renderItems",value:function(){var n=this,a=this.props,i=a.payload,o=a.iconSize,s=a.layout,l=a.formatter,u=a.inactiveColor,d={x:0,y:0,width:ii,height:ii},f={display:s==="horizontal"?"inline-block":"block",marginRight:10},h={display:"inline-block",verticalAlign:"middle",marginRight:4};return i.map(function(p,x){var b=p.formatter||l,y=hr(uf(uf({"recharts-legend-item":!0},"legend-item-".concat(x),!0),"inactive",p.inactive));if(p.type==="none")return null;var m=Bt(p.value)?null:p.value;Co(!Bt(p.value),`The name property is also required when using a function for the dataKey of a chart's cartesian components. Ex: <Bar name="Name of my Data"/>`);var g=p.inactive?u:p.color;return re.createElement("li",p1({className:y,style:f,key:"legend-item-".concat(x)},lf(n.props,p,x)),re.createElement(i1,{width:o,height:o,viewBox:d,style:h},n.renderIcon(p)),re.createElement("span",{className:"recharts-legend-item-text",style:{color:g}},b?b(m,p,x):m))})}},{key:"render",value:function(){var n=this.props,a=n.payload,i=n.layout,o=n.align;if(!a||!a.length)return null;var s={padding:0,margin:0,textAlign:i==="horizontal"?o:"left"};return re.createElement("ul",{className:"recharts-default-legend",style:s},this.renderItems())}}])}(j.PureComponent);uf(n2,"displayName","Legend");uf(n2,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"middle",inactiveColor:"#ccc"});var D9=Pg;function $9(){this.__data__=new D9,this.size=0}var L9=$9;function B9(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r}var F9=B9;function G9(e){return this.__data__.get(e)}var U9=G9;function z9(e){return this.__data__.has(e)}var W9=z9,V9=Pg,H9=Vv,X9=Hv,K9=200;function Y9(e,t){var r=this.__data__;if(r instanceof V9){var n=r.__data__;if(!H9||n.length<K9-1)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new X9(n)}return r.set(e,t),this.size=r.size,this}var q9=Y9,Z9=Pg,J9=L9,Q9=F9,eL=U9,tL=W9,rL=q9;function Du(e){var t=this.__data__=new Z9(e);this.size=t.size}Du.prototype.clear=J9;Du.prototype.delete=Q9;Du.prototype.get=eL;Du.prototype.has=tL;Du.prototype.set=rL;var GP=Du,nL="__lodash_hash_undefined__";function aL(e){return this.__data__.set(e,nL),this}var iL=aL;function oL(e){return this.__data__.has(e)}var sL=oL,lL=Hv,cL=iL,uL=sL;function ip(e){var t=-1,r=e==null?0:e.length;for(this.__data__=new lL;++t<r;)this.add(e[t])}ip.prototype.add=ip.prototype.push=cL;ip.prototype.has=uL;var UP=ip;function dL(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(t(e[r],r,e))return!0;return!1}var zP=dL;function fL(e,t){return e.has(t)}var WP=fL,hL=UP,pL=zP,gL=WP,mL=1,xL=2;function yL(e,t,r,n,a,i){var o=r&mL,s=e.length,l=t.length;if(s!=l&&!(o&&l>s))return!1;var u=i.get(e),d=i.get(t);if(u&&d)return u==t&&d==e;var f=-1,h=!0,p=r&xL?new hL:void 0;for(i.set(e,t),i.set(t,e);++f<s;){var x=e[f],b=t[f];if(n)var y=o?n(b,x,f,t,e,i):n(x,b,f,e,t,i);if(y!==void 0){if(y)continue;h=!1;break}if(p){if(!pL(t,function(m,g){if(!gL(p,g)&&(x===m||a(x,m,r,n,i)))return p.push(g)})){h=!1;break}}else if(!(x===b||a(x,b,r,n,i))){h=!1;break}}return i.delete(e),i.delete(t),h}var VP=yL,bL=so,vL=bL.Uint8Array,wL=vL;function kL(e){var t=-1,r=Array(e.size);return e.forEach(function(n,a){r[++t]=[a,n]}),r}var SL=kL;function jL(e){var t=-1,r=Array(e.size);return e.forEach(function(n){r[++t]=n}),r}var a2=jL,v3=Yf,w3=wL,ML=Wv,_L=VP,PL=SL,NL=a2,CL=1,OL=2,AL="[object Boolean]",TL="[object Date]",EL="[object Error]",IL="[object Map]",RL="[object Number]",DL="[object RegExp]",$L="[object Set]",LL="[object String]",BL="[object Symbol]",FL="[object ArrayBuffer]",GL="[object DataView]",k3=v3?v3.prototype:void 0,vx=k3?k3.valueOf:void 0;function UL(e,t,r,n,a,i,o){switch(r){case GL:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case FL:return!(e.byteLength!=t.byteLength||!i(new w3(e),new w3(t)));case AL:case TL:case RL:return ML(+e,+t);case EL:return e.name==t.name&&e.message==t.message;case DL:case LL:return e==t+"";case IL:var s=PL;case $L:var l=n&CL;if(s||(s=NL),e.size!=t.size&&!l)return!1;var u=o.get(e);if(u)return u==t;n|=OL,o.set(e,t);var d=_L(s(e),s(t),n,a,i,o);return o.delete(e),d;case BL:if(vx)return vx.call(e)==vx.call(t)}return!1}var zL=UL;function WL(e,t){for(var r=-1,n=t.length,a=e.length;++r<n;)e[a+r]=t[r];return e}var HP=WL,VL=HP,HL=$a;function XL(e,t,r){var n=t(e);return HL(e)?n:VL(n,r(e))}var KL=XL;function YL(e,t){for(var r=-1,n=e==null?0:e.length,a=0,i=[];++r<n;){var o=e[r];t(o,r,e)&&(i[a++]=o)}return i}var qL=YL;function ZL(){return[]}var JL=ZL,QL=qL,eB=JL,tB=Object.prototype,rB=tB.propertyIsEnumerable,S3=Object.getOwnPropertySymbols,nB=S3?function(e){return e==null?[]:(e=Object(e),QL(S3(e),function(t){return rB.call(e,t)}))}:eB,aB=nB;function iB(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}var oB=iB,sB=Fo,lB=Go,cB="[object Arguments]";function uB(e){return lB(e)&&sB(e)==cB}var dB=uB,j3=dB,fB=Go,XP=Object.prototype,hB=XP.hasOwnProperty,pB=XP.propertyIsEnumerable,gB=j3(function(){return arguments}())?j3:function(e){return fB(e)&&hB.call(e,"callee")&&!pB.call(e,"callee")},i2=gB,op={exports:{}};function mB(){return!1}var xB=mB;op.exports;(function(e,t){var r=so,n=xB,a=t&&!t.nodeType&&t,i=a&&!0&&e&&!e.nodeType&&e,o=i&&i.exports===a,s=o?r.Buffer:void 0,l=s?s.isBuffer:void 0,u=l||n;e.exports=u})(op,op.exports);var KP=op.exports,yB=9007199254740991,bB=/^(?:0|[1-9]\d*)$/;function vB(e,t){var r=typeof e;return t=t??yB,!!t&&(r=="number"||r!="symbol"&&bB.test(e))&&e>-1&&e%1==0&&e<t}var o2=vB,wB=9007199254740991;function kB(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=wB}var s2=kB,SB=Fo,jB=s2,MB=Go,_B="[object Arguments]",PB="[object Array]",NB="[object Boolean]",CB="[object Date]",OB="[object Error]",AB="[object Function]",TB="[object Map]",EB="[object Number]",IB="[object Object]",RB="[object RegExp]",DB="[object Set]",$B="[object String]",LB="[object WeakMap]",BB="[object ArrayBuffer]",FB="[object DataView]",GB="[object Float32Array]",UB="[object Float64Array]",zB="[object Int8Array]",WB="[object Int16Array]",VB="[object Int32Array]",HB="[object Uint8Array]",XB="[object Uint8ClampedArray]",KB="[object Uint16Array]",YB="[object Uint32Array]",Kr={};Kr[GB]=Kr[UB]=Kr[zB]=Kr[WB]=Kr[VB]=Kr[HB]=Kr[XB]=Kr[KB]=Kr[YB]=!0;Kr[_B]=Kr[PB]=Kr[BB]=Kr[NB]=Kr[FB]=Kr[CB]=Kr[OB]=Kr[AB]=Kr[TB]=Kr[EB]=Kr[IB]=Kr[RB]=Kr[DB]=Kr[$B]=Kr[LB]=!1;function qB(e){return MB(e)&&jB(e.length)&&!!Kr[SB(e)]}var ZB=qB;function JB(e){return function(t){return e(t)}}var YP=JB,sp={exports:{}};sp.exports;(function(e,t){var r=rP,n=t&&!t.nodeType&&t,a=n&&!0&&e&&!e.nodeType&&e,i=a&&a.exports===n,o=i&&r.process,s=function(){try{var l=a&&a.require&&a.require("util").types;return l||o&&o.binding&&o.binding("util")}catch{}}();e.exports=s})(sp,sp.exports);var QB=sp.exports,eF=ZB,tF=YP,M3=QB,_3=M3&&M3.isTypedArray,rF=_3?tF(_3):eF,qP=rF,nF=oB,aF=i2,iF=$a,oF=KP,sF=o2,lF=qP,cF=Object.prototype,uF=cF.hasOwnProperty;function dF(e,t){var r=iF(e),n=!r&&aF(e),a=!r&&!n&&oF(e),i=!r&&!n&&!a&&lF(e),o=r||n||a||i,s=o?nF(e.length,String):[],l=s.length;for(var u in e)(t||uF.call(e,u))&&!(o&&(u=="length"||a&&(u=="offset"||u=="parent")||i&&(u=="buffer"||u=="byteLength"||u=="byteOffset")||sF(u,l)))&&s.push(u);return s}var fF=dF,hF=Object.prototype;function pF(e){var t=e&&e.constructor,r=typeof t=="function"&&t.prototype||hF;return e===r}var gF=pF;function mF(e,t){return function(r){return e(t(r))}}var ZP=mF,xF=ZP,yF=xF(Object.keys,Object),bF=yF,vF=gF,wF=bF,kF=Object.prototype,SF=kF.hasOwnProperty;function jF(e){if(!vF(e))return wF(e);var t=[];for(var r in Object(e))SF.call(e,r)&&r!="constructor"&&t.push(r);return t}var MF=jF,_F=zv,PF=s2;function NF(e){return e!=null&&PF(e.length)&&!_F(e)}var qf=NF,CF=fF,OF=MF,AF=qf;function TF(e){return AF(e)?CF(e):OF(e)}var Vg=TF,EF=KL,IF=aB,RF=Vg;function DF(e){return EF(e,RF,IF)}var $F=DF,P3=$F,LF=1,BF=Object.prototype,FF=BF.hasOwnProperty;function GF(e,t,r,n,a,i){var o=r&LF,s=P3(e),l=s.length,u=P3(t),d=u.length;if(l!=d&&!o)return!1;for(var f=l;f--;){var h=s[f];if(!(o?h in t:FF.call(t,h)))return!1}var p=i.get(e),x=i.get(t);if(p&&x)return p==t&&x==e;var b=!0;i.set(e,t),i.set(t,e);for(var y=o;++f<l;){h=s[f];var m=e[h],g=t[h];if(n)var k=o?n(g,m,h,t,e,i):n(m,g,h,e,t,i);if(!(k===void 0?m===g||a(m,g,r,n,i):k)){b=!1;break}y||(y=h=="constructor")}if(b&&!y){var S=e.constructor,w=t.constructor;S!=w&&"constructor"in e&&"constructor"in t&&!(typeof S=="function"&&S instanceof S&&typeof w=="function"&&w instanceof w)&&(b=!1)}return i.delete(e),i.delete(t),b}var UF=GF,zF=Xl,WF=so,VF=zF(WF,"DataView"),HF=VF,XF=Xl,KF=so,YF=XF(KF,"Promise"),qF=YF,ZF=Xl,JF=so,QF=ZF(JF,"Set"),JP=QF,eG=Xl,tG=so,rG=eG(tG,"WeakMap"),nG=rG,m1=HF,x1=Vv,y1=qF,b1=JP,v1=nG,QP=Fo,$u=aP,N3="[object Map]",aG="[object Object]",C3="[object Promise]",O3="[object Set]",A3="[object WeakMap]",T3="[object DataView]",iG=$u(m1),oG=$u(x1),sG=$u(y1),lG=$u(b1),cG=$u(v1),ol=QP;(m1&&ol(new m1(new ArrayBuffer(1)))!=T3||x1&&ol(new x1)!=N3||y1&&ol(y1.resolve())!=C3||b1&&ol(new b1)!=O3||v1&&ol(new v1)!=A3)&&(ol=function(e){var t=QP(e),r=t==aG?e.constructor:void 0,n=r?$u(r):"";if(n)switch(n){case iG:return T3;case oG:return N3;case sG:return C3;case lG:return O3;case cG:return A3}return t});var uG=ol,wx=GP,dG=VP,fG=zL,hG=UF,E3=uG,I3=$a,R3=KP,pG=qP,gG=1,D3="[object Arguments]",$3="[object Array]",U0="[object Object]",mG=Object.prototype,L3=mG.hasOwnProperty;function xG(e,t,r,n,a,i){var o=I3(e),s=I3(t),l=o?$3:E3(e),u=s?$3:E3(t);l=l==D3?U0:l,u=u==D3?U0:u;var d=l==U0,f=u==U0,h=l==u;if(h&&R3(e)){if(!R3(t))return!1;o=!0,d=!1}if(h&&!d)return i||(i=new wx),o||pG(e)?dG(e,t,r,n,a,i):fG(e,t,l,r,n,a,i);if(!(r&gG)){var p=d&&L3.call(e,"__wrapped__"),x=f&&L3.call(t,"__wrapped__");if(p||x){var b=p?e.value():e,y=x?t.value():t;return i||(i=new wx),a(b,y,r,n,i)}}return h?(i||(i=new wx),hG(e,t,r,n,a,i)):!1}var yG=xG,bG=yG,B3=Go;function eN(e,t,r,n,a){return e===t?!0:e==null||t==null||!B3(e)&&!B3(t)?e!==e&&t!==t:bG(e,t,r,n,eN,a)}var l2=eN,vG=GP,wG=l2,kG=1,SG=2;function jG(e,t,r,n){var a=r.length,i=a,o=!n;if(e==null)return!i;for(e=Object(e);a--;){var s=r[a];if(o&&s[2]?s[1]!==e[s[0]]:!(s[0]in e))return!1}for(;++a<i;){s=r[a];var l=s[0],u=e[l],d=s[1];if(o&&s[2]){if(u===void 0&&!(l in e))return!1}else{var f=new vG;if(n)var h=n(u,d,l,e,t,f);if(!(h===void 0?wG(d,u,kG|SG,n,f):h))return!1}}return!0}var MG=jG,_G=Us;function PG(e){return e===e&&!_G(e)}var tN=PG,NG=tN,CG=Vg;function OG(e){for(var t=CG(e),r=t.length;r--;){var n=t[r],a=e[n];t[r]=[n,a,NG(a)]}return t}var AG=OG;function TG(e,t){return function(r){return r==null?!1:r[e]===t&&(t!==void 0||e in Object(r))}}var rN=TG,EG=MG,IG=AG,RG=rN;function DG(e){var t=IG(e);return t.length==1&&t[0][2]?RG(t[0][0],t[0][1]):function(r){return r===e||EG(r,e,t)}}var $G=DG;function LG(e,t){return e!=null&&t in Object(e)}var BG=LG,FG=cP,GG=i2,UG=$a,zG=o2,WG=s2,VG=Cg;function HG(e,t,r){t=FG(t,e);for(var n=-1,a=t.length,i=!1;++n<a;){var o=VG(t[n]);if(!(i=e!=null&&r(e,o)))break;e=e[o]}return i||++n!=a?i:(a=e==null?0:e.length,!!a&&WG(a)&&zG(o,a)&&(UG(e)||GG(e)))}var XG=HG,KG=BG,YG=XG;function qG(e,t){return e!=null&&YG(e,t,KG)}var ZG=qG,JG=l2,QG=uP,eU=ZG,tU=Uv,rU=tN,nU=rN,aU=Cg,iU=1,oU=2;function sU(e,t){return tU(e)&&rU(t)?nU(aU(e),t):function(r){var n=QG(r,e);return n===void 0&&n===t?eU(r,e):JG(t,n,iU|oU)}}var lU=sU;function cU(e){return e}var Lu=cU;function uU(e){return function(t){return t==null?void 0:t[e]}}var dU=uU,fU=Yv;function hU(e){return function(t){return fU(t,e)}}var pU=hU,gU=dU,mU=pU,xU=Uv,yU=Cg;function bU(e){return xU(e)?gU(yU(e)):mU(e)}var vU=bU,wU=$G,kU=lU,SU=Lu,jU=$a,MU=vU;function _U(e){return typeof e=="function"?e:e==null?SU:typeof e=="object"?jU(e)?kU(e[0],e[1]):wU(e):MU(e)}var zs=_U;function PU(e,t,r,n){for(var a=e.length,i=r+(n?1:-1);n?i--:++i<a;)if(t(e[i],i,e))return i;return-1}var nN=PU;function NU(e){return e!==e}var CU=NU;function OU(e,t,r){for(var n=r-1,a=e.length;++n<a;)if(e[n]===t)return n;return-1}var AU=OU,TU=nN,EU=CU,IU=AU;function RU(e,t,r){return t===t?IU(e,t,r):TU(e,EU,r)}var DU=RU,$U=DU;function LU(e,t){var r=e==null?0:e.length;return!!r&&$U(e,t,0)>-1}var BU=LU;function FU(e,t,r){for(var n=-1,a=e==null?0:e.length;++n<a;)if(r(t,e[n]))return!0;return!1}var GU=FU;function UU(){}var zU=UU,kx=JP,WU=zU,VU=a2,HU=1/0,XU=kx&&1/VU(new kx([,-0]))[1]==HU?function(e){return new kx(e)}:WU,KU=XU,YU=UP,qU=BU,ZU=GU,JU=WP,QU=KU,ez=a2,tz=200;function rz(e,t,r){var n=-1,a=qU,i=e.length,o=!0,s=[],l=s;if(r)o=!1,a=ZU;else if(i>=tz){var u=t?null:QU(e);if(u)return ez(u);o=!1,a=JU,l=new YU}else l=t?[]:s;e:for(;++n<i;){var d=e[n],f=t?t(d):d;if(d=r||d!==0?d:0,o&&f===f){for(var h=l.length;h--;)if(l[h]===f)continue e;t&&l.push(f),s.push(d)}else a(l,f,r)||(l!==s&&l.push(f),s.push(d))}return s}var nz=rz,az=zs,iz=nz;function oz(e,t){return e&&e.length?iz(e,az(t)):[]}var sz=oz;const F3=Br(sz);function aN(e,t,r){return t===!0?F3(e,r):Bt(t)?F3(e,t):e}function eu(e){"@babel/helpers - typeof";return eu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},eu(e)}var lz=["ref"];function G3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function xo(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?G3(Object(r),!0).forEach(function(n){Hg(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):G3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function cz(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function U3(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oN(n.key),n)}}function uz(e,t,r){return t&&U3(e.prototype,t),r&&U3(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function dz(e,t,r){return t=lp(t),fz(e,iN()?Reflect.construct(t,r||[],lp(e).constructor):t.apply(e,r))}function fz(e,t){if(t&&(eu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hz(e)}function hz(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iN=function(){return!!e})()}function lp(e){return lp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},lp(e)}function pz(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w1(e,t)}function w1(e,t){return w1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},w1(e,t)}function Hg(e,t,r){return t=oN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oN(e){var t=gz(e,"string");return eu(t)=="symbol"?t:t+""}function gz(e,t){if(eu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(eu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function mz(e,t){if(e==null)return{};var r=xz(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function xz(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function yz(e){return e.value}function bz(e,t){if(re.isValidElement(e))return re.cloneElement(e,t);if(typeof e=="function")return re.createElement(e,t);t.ref;var r=mz(t,lz);return re.createElement(n2,r)}var z3=1,Qi=function(e){function t(){var r;cz(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=dz(this,t,[].concat(a)),Hg(r,"lastBoundingBox",{width:-1,height:-1}),r}return pz(t,e),uz(t,[{key:"componentDidMount",value:function(){this.updateBBox()}},{key:"componentDidUpdate",value:function(){this.updateBBox()}},{key:"getBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();return n.height=this.wrapperNode.offsetHeight,n.width=this.wrapperNode.offsetWidth,n}return null}},{key:"updateBBox",value:function(){var n=this.props.onBBoxUpdate,a=this.getBBox();a?(Math.abs(a.width-this.lastBoundingBox.width)>z3||Math.abs(a.height-this.lastBoundingBox.height)>z3)&&(this.lastBoundingBox.width=a.width,this.lastBoundingBox.height=a.height,n&&n(a)):(this.lastBoundingBox.width!==-1||this.lastBoundingBox.height!==-1)&&(this.lastBoundingBox.width=-1,this.lastBoundingBox.height=-1,n&&n(null))}},{key:"getBBoxSnapshot",value:function(){return this.lastBoundingBox.width>=0&&this.lastBoundingBox.height>=0?xo({},this.lastBoundingBox):{width:0,height:0}}},{key:"getDefaultPosition",value:function(n){var a=this.props,i=a.layout,o=a.align,s=a.verticalAlign,l=a.margin,u=a.chartWidth,d=a.chartHeight,f,h;if(!n||(n.left===void 0||n.left===null)&&(n.right===void 0||n.right===null))if(o==="center"&&i==="vertical"){var p=this.getBBoxSnapshot();f={left:((u||0)-p.width)/2}}else f=o==="right"?{right:l&&l.right||0}:{left:l&&l.left||0};if(!n||(n.top===void 0||n.top===null)&&(n.bottom===void 0||n.bottom===null))if(s==="middle"){var x=this.getBBoxSnapshot();h={top:((d||0)-x.height)/2}}else h=s==="bottom"?{bottom:l&&l.bottom||0}:{top:l&&l.top||0};return xo(xo({},f),h)}},{key:"render",value:function(){var n=this,a=this.props,i=a.content,o=a.width,s=a.height,l=a.wrapperStyle,u=a.payloadUniqBy,d=a.payload,f=xo(xo({position:"absolute",width:o||"auto",height:s||"auto"},this.getDefaultPosition(l)),l);return re.createElement("div",{className:"recharts-legend-wrapper",style:f,ref:function(p){n.wrapperNode=p}},bz(i,xo(xo({},this.props),{},{payload:aN(d,u,yz)})))}}],[{key:"getWithHeight",value:function(n,a){var i=xo(xo({},this.defaultProps),n.props),o=i.layout;return o==="vertical"&&Re(n.props.height)?{height:n.props.height}:o==="horizontal"?{width:n.props.width||a}:null}}])}(j.PureComponent);Hg(Qi,"displayName","Legend");Hg(Qi,"defaultProps",{iconSize:14,layout:"horizontal",align:"center",verticalAlign:"bottom"});var W3=Yf,vz=i2,wz=$a,V3=W3?W3.isConcatSpreadable:void 0;function kz(e){return wz(e)||vz(e)||!!(V3&&e&&e[V3])}var Sz=kz,jz=HP,Mz=Sz;function sN(e,t,r,n,a){var i=-1,o=e.length;for(r||(r=Mz),a||(a=[]);++i<o;){var s=e[i];t>0&&r(s)?t>1?sN(s,t-1,r,n,a):jz(a,s):n||(a[a.length]=s)}return a}var lN=sN;function _z(e){return function(t,r,n){for(var a=-1,i=Object(t),o=n(t),s=o.length;s--;){var l=o[e?s:++a];if(r(i[l],l,i)===!1)break}return t}}var Pz=_z,Nz=Pz,Cz=Nz(),Oz=Cz,Az=Oz,Tz=Vg;function Ez(e,t){return e&&Az(e,t,Tz)}var cN=Ez,Iz=qf;function Rz(e,t){return function(r,n){if(r==null)return r;if(!Iz(r))return e(r,n);for(var a=r.length,i=t?a:-1,o=Object(r);(t?i--:++i<a)&&n(o[i],i,o)!==!1;);return r}}var Dz=Rz,$z=cN,Lz=Dz,Bz=Lz($z),c2=Bz,Fz=c2,Gz=qf;function Uz(e,t){var r=-1,n=Gz(e)?Array(e.length):[];return Fz(e,function(a,i,o){n[++r]=t(a,i,o)}),n}var uN=Uz;function zz(e,t){var r=e.length;for(e.sort(t);r--;)e[r]=e[r].value;return e}var Wz=zz,H3=Ou;function Vz(e,t){if(e!==t){var r=e!==void 0,n=e===null,a=e===e,i=H3(e),o=t!==void 0,s=t===null,l=t===t,u=H3(t);if(!s&&!u&&!i&&e>t||i&&o&&l&&!s&&!u||n&&o&&l||!r&&l||!a)return 1;if(!n&&!i&&!u&&e<t||u&&r&&a&&!n&&!i||s&&r&&a||!o&&a||!l)return-1}return 0}var Hz=Vz,Xz=Hz;function Kz(e,t,r){for(var n=-1,a=e.criteria,i=t.criteria,o=a.length,s=r.length;++n<o;){var l=Xz(a[n],i[n]);if(l){if(n>=s)return l;var u=r[n];return l*(u=="desc"?-1:1)}}return e.index-t.index}var Yz=Kz,Sx=Kv,qz=Yv,Zz=zs,Jz=uN,Qz=Wz,eW=YP,tW=Yz,rW=Lu,nW=$a;function aW(e,t,r){t.length?t=Sx(t,function(i){return nW(i)?function(o){return qz(o,i.length===1?i[0]:i)}:i}):t=[rW];var n=-1;t=Sx(t,eW(Zz));var a=Jz(e,function(i,o,s){var l=Sx(t,function(u){return u(i)});return{criteria:l,index:++n,value:i}});return Qz(a,function(i,o){return tW(i,o,r)})}var iW=aW;function oW(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}var sW=oW,lW=sW,X3=Math.max;function cW(e,t,r){return t=X3(t===void 0?e.length-1:t,0),function(){for(var n=arguments,a=-1,i=X3(n.length-t,0),o=Array(i);++a<i;)o[a]=n[t+a];a=-1;for(var s=Array(t+1);++a<t;)s[a]=n[a];return s[t]=r(o),lW(e,this,s)}}var uW=cW;function dW(e){return function(){return e}}var fW=dW,hW=Xl,pW=function(){try{var e=hW(Object,"defineProperty");return e({},"",{}),e}catch{}}(),dN=pW,gW=fW,K3=dN,mW=Lu,xW=K3?function(e,t){return K3(e,"toString",{configurable:!0,enumerable:!1,value:gW(t),writable:!0})}:mW,yW=xW,bW=800,vW=16,wW=Date.now;function kW(e){var t=0,r=0;return function(){var n=wW(),a=vW-(n-r);if(r=n,a>0){if(++t>=bW)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}var SW=kW,jW=yW,MW=SW,_W=MW(jW),PW=_W,NW=Lu,CW=uW,OW=PW;function AW(e,t){return OW(CW(e,t,NW),e+"")}var TW=AW,EW=Wv,IW=qf,RW=o2,DW=Us;function $W(e,t,r){if(!DW(r))return!1;var n=typeof t;return(n=="number"?IW(r)&&RW(t,r.length):n=="string"&&t in r)?EW(r[t],e):!1}var Xg=$W,LW=lN,BW=iW,FW=TW,Y3=Xg,GW=FW(function(e,t){if(e==null)return[];var r=t.length;return r>1&&Y3(e,t[0],t[1])?t=[]:r>2&&Y3(t[0],t[1],t[2])&&(t=[t[0]]),BW(e,LW(t,1),[])}),UW=GW;const u2=Br(UW);function df(e){"@babel/helpers - typeof";return df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},df(e)}function k1(){return k1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},k1.apply(this,arguments)}function zW(e,t){return XW(e)||HW(e,t)||VW(e,t)||WW()}function WW(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VW(e,t){if(e){if(typeof e=="string")return q3(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q3(e,t)}}function q3(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function HW(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function XW(e){if(Array.isArray(e))return e}function Z3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Z3(Object(r),!0).forEach(function(n){KW(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Z3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function KW(e,t,r){return t=YW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function YW(e){var t=qW(e,"string");return df(t)=="symbol"?t:t+""}function qW(e,t){if(df(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(df(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function ZW(e){return Array.isArray(e)&&Ln(e[0])&&Ln(e[1])?e.join(" ~ "):e}var JW=function(t){var r=t.separator,n=r===void 0?" : ":r,a=t.contentStyle,i=a===void 0?{}:a,o=t.itemStyle,s=o===void 0?{}:o,l=t.labelStyle,u=l===void 0?{}:l,d=t.payload,f=t.formatter,h=t.itemSorter,p=t.wrapperClassName,x=t.labelClassName,b=t.label,y=t.labelFormatter,m=t.accessibilityLayer,g=m===void 0?!1:m,k=function(){if(d&&d.length){var D={padding:0,margin:0},E=(h?u2(d,h):d).map(function(W,F){if(W.type==="none")return null;var O=jx({display:"block",paddingTop:4,paddingBottom:4,color:W.color||"#000"},s),$=W.formatter||f||ZW,N=W.value,C=W.name,B=N,I=C;if($&&B!=null&&I!=null){var z=$(N,C,W,F,d);if(Array.isArray(z)){var V=zW(z,2);B=V[0],I=V[1]}else B=z}return re.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(F),style:O},Ln(I)?re.createElement("span",{className:"recharts-tooltip-item-name"},I):null,Ln(I)?re.createElement("span",{className:"recharts-tooltip-item-separator"},n):null,re.createElement("span",{className:"recharts-tooltip-item-value"},B),re.createElement("span",{className:"recharts-tooltip-item-unit"},W.unit||""))});return re.createElement("ul",{className:"recharts-tooltip-item-list",style:D},E)}return null},S=jx({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},i),w=jx({margin:0},u),v=!Et(b),M=v?b:"",_=hr("recharts-default-tooltip",p),P=hr("recharts-tooltip-label",x);v&&y&&d!==void 0&&d!==null&&(M=y(b,d));var A=g?{role:"status","aria-live":"assertive"}:{};return re.createElement("div",k1({className:_,style:S},A),re.createElement("p",{className:P,style:w},re.isValidElement(M)?M:"".concat(M)),k())};function ff(e){"@babel/helpers - typeof";return ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ff(e)}function z0(e,t,r){return t=QW(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function QW(e){var t=eV(e,"string");return ff(t)=="symbol"?t:t+""}function eV(e,t){if(ff(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ff(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var ud="recharts-tooltip-wrapper",tV={visibility:"hidden"};function rV(e){var t=e.coordinate,r=e.translateX,n=e.translateY;return hr(ud,z0(z0(z0(z0({},"".concat(ud,"-right"),Re(r)&&t&&Re(t.x)&&r>=t.x),"".concat(ud,"-left"),Re(r)&&t&&Re(t.x)&&r<t.x),"".concat(ud,"-bottom"),Re(n)&&t&&Re(t.y)&&n>=t.y),"".concat(ud,"-top"),Re(n)&&t&&Re(t.y)&&n<t.y))}function J3(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.key,a=e.offsetTopLeft,i=e.position,o=e.reverseDirection,s=e.tooltipDimension,l=e.viewBox,u=e.viewBoxDimension;if(i&&Re(i[n]))return i[n];var d=r[n]-s-a,f=r[n]+a;if(t[n])return o[n]?d:f;if(o[n]){var h=d,p=l[n];return h<p?Math.max(f,l[n]):Math.max(d,l[n])}var x=f+s,b=l[n]+u;return x>b?Math.max(d,l[n]):Math.max(f,l[n])}function nV(e){var t=e.translateX,r=e.translateY,n=e.useTranslate3d;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}function aV(e){var t=e.allowEscapeViewBox,r=e.coordinate,n=e.offsetTopLeft,a=e.position,i=e.reverseDirection,o=e.tooltipBox,s=e.useTranslate3d,l=e.viewBox,u,d,f;return o.height>0&&o.width>0&&r?(d=J3({allowEscapeViewBox:t,coordinate:r,key:"x",offsetTopLeft:n,position:a,reverseDirection:i,tooltipDimension:o.width,viewBox:l,viewBoxDimension:l.width}),f=J3({allowEscapeViewBox:t,coordinate:r,key:"y",offsetTopLeft:n,position:a,reverseDirection:i,tooltipDimension:o.height,viewBox:l,viewBoxDimension:l.height}),u=nV({translateX:d,translateY:f,useTranslate3d:s})):u=tV,{cssProperties:u,cssClasses:rV({translateX:d,translateY:f,coordinate:r})}}function tu(e){"@babel/helpers - typeof";return tu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tu(e)}function Q3(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function eS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q3(Object(r),!0).forEach(function(n){j1(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q3(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function iV(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function oV(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,hN(n.key),n)}}function sV(e,t,r){return t&&oV(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function lV(e,t,r){return t=cp(t),cV(e,fN()?Reflect.construct(t,r||[],cp(e).constructor):t.apply(e,r))}function cV(e,t){if(t&&(tu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return uV(e)}function uV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(fN=function(){return!!e})()}function cp(e){return cp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},cp(e)}function dV(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&S1(e,t)}function S1(e,t){return S1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},S1(e,t)}function j1(e,t,r){return t=hN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function hN(e){var t=fV(e,"string");return tu(t)=="symbol"?t:t+""}function fV(e,t){if(tu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(tu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var tS=1,hV=function(e){function t(){var r;iV(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=lV(this,t,[].concat(a)),j1(r,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0},lastBoundingBox:{width:-1,height:-1}}),j1(r,"handleKeyDown",function(o){if(o.key==="Escape"){var s,l,u,d;r.setState({dismissed:!0,dismissedAtCoordinate:{x:(s=(l=r.props.coordinate)===null||l===void 0?void 0:l.x)!==null&&s!==void 0?s:0,y:(u=(d=r.props.coordinate)===null||d===void 0?void 0:d.y)!==null&&u!==void 0?u:0}})}}),r}return dV(t,e),sV(t,[{key:"updateBBox",value:function(){if(this.wrapperNode&&this.wrapperNode.getBoundingClientRect){var n=this.wrapperNode.getBoundingClientRect();(Math.abs(n.width-this.state.lastBoundingBox.width)>tS||Math.abs(n.height-this.state.lastBoundingBox.height)>tS)&&this.setState({lastBoundingBox:{width:n.width,height:n.height}})}else(this.state.lastBoundingBox.width!==-1||this.state.lastBoundingBox.height!==-1)&&this.setState({lastBoundingBox:{width:-1,height:-1}})}},{key:"componentDidMount",value:function(){document.addEventListener("keydown",this.handleKeyDown),this.updateBBox()}},{key:"componentWillUnmount",value:function(){document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){var n,a;this.props.active&&this.updateBBox(),this.state.dismissed&&(((n=this.props.coordinate)===null||n===void 0?void 0:n.x)!==this.state.dismissedAtCoordinate.x||((a=this.props.coordinate)===null||a===void 0?void 0:a.y)!==this.state.dismissedAtCoordinate.y)&&(this.state.dismissed=!1)}},{key:"render",value:function(){var n=this,a=this.props,i=a.active,o=a.allowEscapeViewBox,s=a.animationDuration,l=a.animationEasing,u=a.children,d=a.coordinate,f=a.hasPayload,h=a.isAnimationActive,p=a.offset,x=a.position,b=a.reverseDirection,y=a.useTranslate3d,m=a.viewBox,g=a.wrapperStyle,k=aV({allowEscapeViewBox:o,coordinate:d,offsetTopLeft:p,position:x,reverseDirection:b,tooltipBox:this.state.lastBoundingBox,useTranslate3d:y,viewBox:m}),S=k.cssClasses,w=k.cssProperties,v=eS(eS({transition:h&&i?"transform ".concat(s,"ms ").concat(l):void 0},w),{},{pointerEvents:"none",visibility:!this.state.dismissed&&i&&f?"visible":"hidden",position:"absolute",top:0,left:0},g);return re.createElement("div",{tabIndex:-1,className:S,style:v,ref:function(_){n.wrapperNode=_}},u)}}])}(j.PureComponent),pV=function(){return!(typeof window<"u"&&window.document&&window.document.createElement&&window.setTimeout)},Ws={isSsr:pV()};function ru(e){"@babel/helpers - typeof";return ru=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ru(e)}function rS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function nS(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?rS(Object(r),!0).forEach(function(n){d2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function gV(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function mV(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gN(n.key),n)}}function xV(e,t,r){return t&&mV(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function yV(e,t,r){return t=up(t),bV(e,pN()?Reflect.construct(t,r||[],up(e).constructor):t.apply(e,r))}function bV(e,t){if(t&&(ru(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vV(e)}function vV(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function pN(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(pN=function(){return!!e})()}function up(e){return up=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},up(e)}function wV(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&M1(e,t)}function M1(e,t){return M1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},M1(e,t)}function d2(e,t,r){return t=gN(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gN(e){var t=kV(e,"string");return ru(t)=="symbol"?t:t+""}function kV(e,t){if(ru(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ru(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function SV(e){return e.dataKey}function jV(e,t){return re.isValidElement(e)?re.cloneElement(e,t):typeof e=="function"?re.createElement(e,t):re.createElement(JW,t)}var Rn=function(e){function t(){return gV(this,t),yV(this,t,arguments)}return wV(t,e),xV(t,[{key:"render",value:function(){var n=this,a=this.props,i=a.active,o=a.allowEscapeViewBox,s=a.animationDuration,l=a.animationEasing,u=a.content,d=a.coordinate,f=a.filterNull,h=a.isAnimationActive,p=a.offset,x=a.payload,b=a.payloadUniqBy,y=a.position,m=a.reverseDirection,g=a.useTranslate3d,k=a.viewBox,S=a.wrapperStyle,w=x??[];f&&w.length&&(w=aN(x.filter(function(M){return M.value!=null&&(M.hide!==!0||n.props.includeHidden)}),b,SV));var v=w.length>0;return re.createElement(hV,{allowEscapeViewBox:o,animationDuration:s,animationEasing:l,isAnimationActive:h,active:i,coordinate:d,hasPayload:v,offset:p,position:y,reverseDirection:m,useTranslate3d:g,viewBox:k,wrapperStyle:S},jV(u,nS(nS({},this.props),{},{payload:w})))}}])}(j.PureComponent);d2(Rn,"displayName","Tooltip");d2(Rn,"defaultProps",{accessibilityLayer:!1,allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",contentStyle:{},coordinate:{x:0,y:0},cursor:!0,cursorStyle:{},filterNull:!0,isAnimationActive:!Ws.isSsr,itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,viewBox:{x:0,y:0,height:0,width:0},wrapperStyle:{}});var MV=so,_V=function(){return MV.Date.now()},PV=_V,NV=/\s/;function CV(e){for(var t=e.length;t--&&NV.test(e.charAt(t)););return t}var OV=CV,AV=OV,TV=/^\s+/;function EV(e){return e&&e.slice(0,AV(e)+1).replace(TV,"")}var IV=EV,RV=IV,aS=Us,DV=Ou,iS=NaN,$V=/^[-+]0x[0-9a-f]+$/i,LV=/^0b[01]+$/i,BV=/^0o[0-7]+$/i,FV=parseInt;function GV(e){if(typeof e=="number")return e;if(DV(e))return iS;if(aS(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=aS(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=RV(e);var r=LV.test(e);return r||BV.test(e)?FV(e.slice(2),r?2:8):$V.test(e)?iS:+e}var mN=GV,UV=Us,Mx=PV,oS=mN,zV="Expected a function",WV=Math.max,VV=Math.min;function HV(e,t,r){var n,a,i,o,s,l,u=0,d=!1,f=!1,h=!0;if(typeof e!="function")throw new TypeError(zV);t=oS(t)||0,UV(r)&&(d=!!r.leading,f="maxWait"in r,i=f?WV(oS(r.maxWait)||0,t):i,h="trailing"in r?!!r.trailing:h);function p(v){var M=n,_=a;return n=a=void 0,u=v,o=e.apply(_,M),o}function x(v){return u=v,s=setTimeout(m,t),d?p(v):o}function b(v){var M=v-l,_=v-u,P=t-M;return f?VV(P,i-_):P}function y(v){var M=v-l,_=v-u;return l===void 0||M>=t||M<0||f&&_>=i}function m(){var v=Mx();if(y(v))return g(v);s=setTimeout(m,b(v))}function g(v){return s=void 0,h&&n?p(v):(n=a=void 0,o)}function k(){s!==void 0&&clearTimeout(s),u=0,n=l=a=s=void 0}function S(){return s===void 0?o:g(Mx())}function w(){var v=Mx(),M=y(v);if(n=arguments,a=this,l=v,M){if(s===void 0)return x(l);if(f)return clearTimeout(s),s=setTimeout(m,t),p(l)}return s===void 0&&(s=setTimeout(m,t)),o}return w.cancel=k,w.flush=S,w}var XV=HV,KV=XV,YV=Us,qV="Expected a function";function ZV(e,t,r){var n=!0,a=!0;if(typeof e!="function")throw new TypeError(qV);return YV(r)&&(n="leading"in r?!!r.leading:n,a="trailing"in r?!!r.trailing:a),KV(e,t,{leading:n,maxWait:t,trailing:a})}var JV=ZV;const xN=Br(JV);function hf(e){"@babel/helpers - typeof";return hf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hf(e)}function sS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function W0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?sS(Object(r),!0).forEach(function(n){QV(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):sS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function QV(e,t,r){return t=eH(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eH(e){var t=tH(e,"string");return hf(t)=="symbol"?t:t+""}function tH(e,t){if(hf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function rH(e,t){return oH(e)||iH(e,t)||aH(e,t)||nH()}function nH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function aH(e,t){if(e){if(typeof e=="string")return lS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return lS(e,t)}}function lS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function iH(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function oH(e){if(Array.isArray(e))return e}var Xi=j.forwardRef(function(e,t){var r=e.aspect,n=e.initialDimension,a=n===void 0?{width:-1,height:-1}:n,i=e.width,o=i===void 0?"100%":i,s=e.height,l=s===void 0?"100%":s,u=e.minWidth,d=u===void 0?0:u,f=e.minHeight,h=e.maxHeight,p=e.children,x=e.debounce,b=x===void 0?0:x,y=e.id,m=e.className,g=e.onResize,k=e.style,S=k===void 0?{}:k,w=j.useRef(null),v=j.useRef();v.current=g,j.useImperativeHandle(t,function(){return Object.defineProperty(w.current,"current",{get:function(){return console.warn("The usage of ref.current.current is deprecated and will no longer be supported."),w.current},configurable:!0})});var M=j.useState({containerWidth:a.width,containerHeight:a.height}),_=rH(M,2),P=_[0],A=_[1],R=j.useCallback(function(E,W){A(function(F){var O=Math.round(E),$=Math.round(W);return F.containerWidth===O&&F.containerHeight===$?F:{containerWidth:O,containerHeight:$}})},[]);j.useEffect(function(){var E=function(C){var B,I=C[0].contentRect,z=I.width,V=I.height;R(z,V),(B=v.current)===null||B===void 0||B.call(v,z,V)};b>0&&(E=xN(E,b,{trailing:!0,leading:!1}));var W=new ResizeObserver(E),F=w.current.getBoundingClientRect(),O=F.width,$=F.height;return R(O,$),W.observe(w.current),function(){W.disconnect()}},[R,b]);var D=j.useMemo(function(){var E=P.containerWidth,W=P.containerHeight;if(E<0||W<0)return null;Co(pl(o)||pl(l),`The width(%s) and height(%s) are both fixed numbers,
       maybe you don't need to use a ResponsiveContainer.`,o,l),Co(!r||r>0,"The aspect(%s) must be greater than zero.",r);var F=pl(o)?E:o,O=pl(l)?W:l;r&&r>0&&(F?O=F/r:O&&(F=O*r),h&&O>h&&(O=h)),Co(F>0||O>0,`The width(%s) and height(%s) of chart should be greater than 0,
       please check the style of container, or the props width(%s) and height(%s),
       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the
       height and width.`,F,O,o,l,d,f,r);var $=!Array.isArray(p)&&No(p.type).endsWith("Chart");return re.Children.map(p,function(N){return re.isValidElement(N)?j.cloneElement(N,W0({width:F,height:O},$?{style:W0({height:"100%",width:"100%",maxHeight:O,maxWidth:F},N.props.style)}:{})):N})},[r,p,l,h,f,d,P,o]);return re.createElement("div",{id:y?"".concat(y):void 0,className:hr("recharts-responsive-container",m),style:W0(W0({},S),{},{width:o,height:l,minWidth:d,minHeight:f,maxHeight:h}),ref:w},D)}),f2=function(t){return null};f2.displayName="Cell";function pf(e){"@babel/helpers - typeof";return pf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pf(e)}function cS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function _1(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?cS(Object(r),!0).forEach(function(n){sH(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cS(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function sH(e,t,r){return t=lH(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lH(e){var t=cH(e,"string");return pf(t)=="symbol"?t:t+""}function cH(e,t){if(pf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var cc={widthCache:{},cacheCount:0},uH=2e3,dH={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},uS="recharts_measurement_span";function fH(e){var t=_1({},e);return Object.keys(t).forEach(function(r){t[r]||delete t[r]}),t}var Dd=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(t==null||Ws.isSsr)return{width:0,height:0};var n=fH(r),a=JSON.stringify({text:t,copyStyle:n});if(cc.widthCache[a])return cc.widthCache[a];try{var i=document.getElementById(uS);i||(i=document.createElement("span"),i.setAttribute("id",uS),i.setAttribute("aria-hidden","true"),document.body.appendChild(i));var o=_1(_1({},dH),n);Object.assign(i.style,o),i.textContent="".concat(t);var s=i.getBoundingClientRect(),l={width:s.width,height:s.height};return cc.widthCache[a]=l,++cc.cacheCount>uH&&(cc.cacheCount=0,cc.widthCache={}),l}catch{return{width:0,height:0}}},hH=function(t){return{top:t.top+window.scrollY-document.documentElement.clientTop,left:t.left+window.scrollX-document.documentElement.clientLeft}};function gf(e){"@babel/helpers - typeof";return gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gf(e)}function dp(e,t){return xH(e)||mH(e,t)||gH(e,t)||pH()}function pH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function gH(e,t){if(e){if(typeof e=="string")return dS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return dS(e,t)}}function dS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function mH(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function xH(e){if(Array.isArray(e))return e}function yH(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fS(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,vH(n.key),n)}}function bH(e,t,r){return t&&fS(e.prototype,t),r&&fS(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function vH(e){var t=wH(e,"string");return gf(t)=="symbol"?t:t+""}function wH(e,t){if(gf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var hS=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,pS=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,kH=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,SH=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,yN={cm:96/2.54,mm:96/25.4,pt:96/72,pc:96/6,in:96,Q:96/(2.54*40),px:1},jH=Object.keys(yN),Mc="NaN";function MH(e,t){return e*yN[t]}var V0=function(){function e(t,r){yH(this,e),this.num=t,this.unit=r,this.num=t,this.unit=r,Number.isNaN(t)&&(this.unit=""),r!==""&&!kH.test(r)&&(this.num=NaN,this.unit=""),jH.includes(r)&&(this.num=MH(t,r),this.unit="px")}return bH(e,[{key:"add",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num+r.num,this.unit)}},{key:"subtract",value:function(r){return this.unit!==r.unit?new e(NaN,""):new e(this.num-r.num,this.unit)}},{key:"multiply",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num*r.num,this.unit||r.unit)}},{key:"divide",value:function(r){return this.unit!==""&&r.unit!==""&&this.unit!==r.unit?new e(NaN,""):new e(this.num/r.num,this.unit||r.unit)}},{key:"toString",value:function(){return"".concat(this.num).concat(this.unit)}},{key:"isNaN",value:function(){return Number.isNaN(this.num)}}],[{key:"parse",value:function(r){var n,a=(n=SH.exec(r))!==null&&n!==void 0?n:[],i=dp(a,3),o=i[1],s=i[2];return new e(parseFloat(o),s??"")}}])}();function bN(e){if(e.includes(Mc))return Mc;for(var t=e;t.includes("*")||t.includes("/");){var r,n=(r=hS.exec(t))!==null&&r!==void 0?r:[],a=dp(n,4),i=a[1],o=a[2],s=a[3],l=V0.parse(i??""),u=V0.parse(s??""),d=o==="*"?l.multiply(u):l.divide(u);if(d.isNaN())return Mc;t=t.replace(hS,d.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var f,h=(f=pS.exec(t))!==null&&f!==void 0?f:[],p=dp(h,4),x=p[1],b=p[2],y=p[3],m=V0.parse(x??""),g=V0.parse(y??""),k=b==="+"?m.add(g):m.subtract(g);if(k.isNaN())return Mc;t=t.replace(pS,k.toString())}return t}var gS=/\(([^()]*)\)/;function _H(e){for(var t=e;t.includes("(");){var r=gS.exec(t),n=dp(r,2),a=n[1];t=t.replace(gS,bN(a))}return t}function PH(e){var t=e.replace(/\s+/g,"");return t=_H(t),t=bN(t),t}function NH(e){try{return PH(e)}catch{return Mc}}function _x(e){var t=NH(e.slice(5,-1));return t===Mc?"":t}var CH=["x","y","lineHeight","capHeight","scaleToFit","textAnchor","verticalAnchor","fill"],OH=["dx","dy","angle","className","breakAll"];function P1(){return P1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},P1.apply(this,arguments)}function mS(e,t){if(e==null)return{};var r=AH(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function AH(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function xS(e,t){return RH(e)||IH(e,t)||EH(e,t)||TH()}function TH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EH(e,t){if(e){if(typeof e=="string")return yS(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return yS(e,t)}}function yS(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function IH(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t===0){if(Object(r)!==r)return;l=!1}else for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function RH(e){if(Array.isArray(e))return e}var vN=/[ \f\n\r\t\v\u2028\u2029]+/,wN=function(t){var r=t.children,n=t.breakAll,a=t.style;try{var i=[];Et(r)||(n?i=r.toString().split(""):i=r.toString().split(vN));var o=i.map(function(l){return{word:l,width:Dd(l,a).width}}),s=n?0:Dd("",a).width;return{wordsWithComputedWidth:o,spaceWidth:s}}catch{return null}},DH=function(t,r,n,a,i){var o=t.maxLines,s=t.children,l=t.style,u=t.breakAll,d=Re(o),f=s,h=function(){var F=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];return F.reduce(function(O,$){var N=$.word,C=$.width,B=O[O.length-1];if(B&&(a==null||i||B.width+C+n<Number(a)))B.words.push(N),B.width+=C+n;else{var I={words:[N],width:C};O.push(I)}return O},[])},p=h(r),x=function(F){return F.reduce(function(O,$){return O.width>$.width?O:$})};if(!d)return p;for(var b="",y=function(F){var O=f.slice(0,F),$=wN({breakAll:u,style:l,children:O+b}).wordsWithComputedWidth,N=h($),C=N.length>o||x(N).width>Number(a);return[C,N]},m=0,g=f.length-1,k=0,S;m<=g&&k<=f.length-1;){var w=Math.floor((m+g)/2),v=w-1,M=y(v),_=xS(M,2),P=_[0],A=_[1],R=y(w),D=xS(R,1),E=D[0];if(!P&&!E&&(m=w+1),P&&E&&(g=w-1),!P&&E){S=A;break}k++}return S||p},bS=function(t){var r=Et(t)?[]:t.toString().split(vN);return[{words:r}]},$H=function(t){var r=t.width,n=t.scaleToFit,a=t.children,i=t.style,o=t.breakAll,s=t.maxLines;if((r||n)&&!Ws.isSsr){var l,u,d=wN({breakAll:o,children:a,style:i});if(d){var f=d.wordsWithComputedWidth,h=d.spaceWidth;l=f,u=h}else return bS(a);return DH({breakAll:o,children:a,maxLines:s,style:i},l,u,r,n)}return bS(a)},vS="#808080",fp=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,i=a===void 0?0:a,o=t.lineHeight,s=o===void 0?"1em":o,l=t.capHeight,u=l===void 0?"0.71em":l,d=t.scaleToFit,f=d===void 0?!1:d,h=t.textAnchor,p=h===void 0?"start":h,x=t.verticalAnchor,b=x===void 0?"end":x,y=t.fill,m=y===void 0?vS:y,g=mS(t,CH),k=j.useMemo(function(){return $H({breakAll:g.breakAll,children:g.children,maxLines:g.maxLines,scaleToFit:f,style:g.style,width:g.width})},[g.breakAll,g.children,g.maxLines,f,g.style,g.width]),S=g.dx,w=g.dy,v=g.angle,M=g.className,_=g.breakAll,P=mS(g,OH);if(!Ln(n)||!Ln(i))return null;var A=n+(Re(S)?S:0),R=i+(Re(w)?w:0),D;switch(b){case"start":D=_x("calc(".concat(u,")"));break;case"middle":D=_x("calc(".concat((k.length-1)/2," * -").concat(s," + (").concat(u," / 2))"));break;default:D=_x("calc(".concat(k.length-1," * -").concat(s,")"));break}var E=[];if(f){var W=k[0].width,F=g.width;E.push("scale(".concat((Re(F)?F/W:1)/W,")"))}return v&&E.push("rotate(".concat(v,", ").concat(A,", ").concat(R,")")),E.length&&(P.transform=E.join(" ")),re.createElement("text",P1({},Dt(P,!0),{x:A,y:R,className:hr("recharts-text",M),textAnchor:p,fill:m.includes("url")?vS:m}),k.map(function(O,$){var N=O.words.join(_?"":" ");return re.createElement("tspan",{x:A,dy:$===0?D:s,key:"".concat(N,"-").concat($)},N)}))};function Es(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function LH(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function h2(e){let t,r,n;e.length!==2?(t=Es,r=(s,l)=>Es(e(s),l),n=(s,l)=>e(s)-l):(t=e===Es||e===LH?e:BH,r=e,n=e);function a(s,l,u=0,d=s.length){if(u<d){if(t(l,l)!==0)return d;do{const f=u+d>>>1;r(s[f],l)<0?u=f+1:d=f}while(u<d)}return u}function i(s,l,u=0,d=s.length){if(u<d){if(t(l,l)!==0)return d;do{const f=u+d>>>1;r(s[f],l)<=0?u=f+1:d=f}while(u<d)}return u}function o(s,l,u=0,d=s.length){const f=a(s,l,u,d-1);return f>u&&n(s[f-1],l)>-n(s[f],l)?f-1:f}return{left:a,center:o,right:i}}function BH(){return 0}function kN(e){return e===null?NaN:+e}function*FH(e,t){for(let r of e)r!=null&&(r=+r)>=r&&(yield r)}const GH=h2(Es),Zf=GH.right;h2(kN).center;class wS extends Map{constructor(t,r=WH){if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:r}}),t!=null)for(const[n,a]of t)this.set(n,a)}get(t){return super.get(kS(this,t))}has(t){return super.has(kS(this,t))}set(t,r){return super.set(UH(this,t),r)}delete(t){return super.delete(zH(this,t))}}function kS({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):r}function UH({_intern:e,_key:t},r){const n=t(r);return e.has(n)?e.get(n):(e.set(n,r),r)}function zH({_intern:e,_key:t},r){const n=t(r);return e.has(n)&&(r=e.get(n),e.delete(n)),r}function WH(e){return e!==null&&typeof e=="object"?e.valueOf():e}function VH(e=Es){if(e===Es)return SN;if(typeof e!="function")throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||n===0?n:(e(r,r)===0)-(e(t,t)===0)}}function SN(e,t){return(e==null||!(e>=e))-(t==null||!(t>=t))||(e<t?-1:e>t?1:0)}const HH=Math.sqrt(50),XH=Math.sqrt(10),KH=Math.sqrt(2);function hp(e,t,r){const n=(t-e)/Math.max(0,r),a=Math.floor(Math.log10(n)),i=n/Math.pow(10,a),o=i>=HH?10:i>=XH?5:i>=KH?2:1;let s,l,u;return a<0?(u=Math.pow(10,-a)/o,s=Math.round(e*u),l=Math.round(t*u),s/u<e&&++s,l/u>t&&--l,u=-u):(u=Math.pow(10,a)*o,s=Math.round(e/u),l=Math.round(t/u),s*u<e&&++s,l*u>t&&--l),l<s&&.5<=r&&r<2?hp(e,t,r*2):[s,l,u]}function N1(e,t,r){if(t=+t,e=+e,r=+r,!(r>0))return[];if(e===t)return[e];const n=t<e,[a,i,o]=n?hp(t,e,r):hp(e,t,r);if(!(i>=a))return[];const s=i-a+1,l=new Array(s);if(n)if(o<0)for(let u=0;u<s;++u)l[u]=(i-u)/-o;else for(let u=0;u<s;++u)l[u]=(i-u)*o;else if(o<0)for(let u=0;u<s;++u)l[u]=(a+u)/-o;else for(let u=0;u<s;++u)l[u]=(a+u)*o;return l}function C1(e,t,r){return t=+t,e=+e,r=+r,hp(e,t,r)[2]}function O1(e,t,r){t=+t,e=+e,r=+r;const n=t<e,a=n?C1(t,e,r):C1(e,t,r);return(n?-1:1)*(a<0?1/-a:a)}function SS(e,t){let r;for(const n of e)n!=null&&(r<n||r===void 0&&n>=n)&&(r=n);return r}function jS(e,t){let r;for(const n of e)n!=null&&(r>n||r===void 0&&n>=n)&&(r=n);return r}function jN(e,t,r=0,n=1/0,a){if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(a=a===void 0?SN:VH(a);n>r;){if(n-r>600){const l=n-r+1,u=t-r+1,d=Math.log(l),f=.5*Math.exp(2*d/3),h=.5*Math.sqrt(d*f*(l-f)/l)*(u-l/2<0?-1:1),p=Math.max(r,Math.floor(t-u*f/l+h)),x=Math.min(n,Math.floor(t+(l-u)*f/l+h));jN(e,t,p,x,a)}const i=e[t];let o=r,s=n;for(dd(e,r,t),a(e[n],i)>0&&dd(e,r,n);o<s;){for(dd(e,o,s),++o,--s;a(e[o],i)<0;)++o;for(;a(e[s],i)>0;)--s}a(e[r],i)===0?dd(e,r,s):(++s,dd(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function dd(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function YH(e,t,r){if(e=Float64Array.from(FH(e)),!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return jS(e);if(t>=1)return SS(e);var n,a=(n-1)*t,i=Math.floor(a),o=SS(jN(e,i).subarray(0,i+1)),s=jS(e.subarray(i+1));return o+(s-o)*(a-i)}}function qH(e,t,r=kN){if(!(!(n=e.length)||isNaN(t=+t))){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,a=(n-1)*t,i=Math.floor(a),o=+r(e[i],i,e),s=+r(e[i+1],i+1,e);return o+(s-o)*(a-i)}}function ZH(e,t,r){e=+e,t=+t,r=(a=arguments.length)<2?(t=e,e=0,1):a<3?1:+r;for(var n=-1,a=Math.max(0,Math.ceil((t-e)/r))|0,i=new Array(a);++n<a;)i[n]=e+n*r;return i}function yi(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Uo(e,t){switch(arguments.length){case 0:break;case 1:{typeof e=="function"?this.interpolator(e):this.range(e);break}default:{this.domain(e),typeof t=="function"?this.interpolator(t):this.range(t);break}}return this}const A1=Symbol("implicit");function p2(){var e=new wS,t=[],r=[],n=A1;function a(i){let o=e.get(i);if(o===void 0){if(n!==A1)return n;e.set(i,o=t.push(i)-1)}return r[o%r.length]}return a.domain=function(i){if(!arguments.length)return t.slice();t=[],e=new wS;for(const o of i)e.has(o)||e.set(o,t.push(o)-1);return a},a.range=function(i){return arguments.length?(r=Array.from(i),a):r.slice()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return p2(t,r).unknown(n)},yi.apply(a,arguments),a}function mf(){var e=p2().unknown(void 0),t=e.domain,r=e.range,n=0,a=1,i,o,s=!1,l=0,u=0,d=.5;delete e.unknown;function f(){var h=t().length,p=a<n,x=p?a:n,b=p?n:a;i=(b-x)/Math.max(1,h-l+u*2),s&&(i=Math.floor(i)),x+=(b-x-i*(h-l))*d,o=i*(1-l),s&&(x=Math.round(x),o=Math.round(o));var y=ZH(h).map(function(m){return x+i*m});return r(p?y.reverse():y)}return e.domain=function(h){return arguments.length?(t(h),f()):t()},e.range=function(h){return arguments.length?([n,a]=h,n=+n,a=+a,f()):[n,a]},e.rangeRound=function(h){return[n,a]=h,n=+n,a=+a,s=!0,f()},e.bandwidth=function(){return o},e.step=function(){return i},e.round=function(h){return arguments.length?(s=!!h,f()):s},e.padding=function(h){return arguments.length?(l=Math.min(1,u=+h),f()):l},e.paddingInner=function(h){return arguments.length?(l=Math.min(1,h),f()):l},e.paddingOuter=function(h){return arguments.length?(u=+h,f()):u},e.align=function(h){return arguments.length?(d=Math.max(0,Math.min(1,h)),f()):d},e.copy=function(){return mf(t(),[n,a]).round(s).paddingInner(l).paddingOuter(u).align(d)},yi.apply(f(),arguments)}function MN(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return MN(t())},e}function $d(){return MN(mf.apply(null,arguments).paddingInner(1))}function g2(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function _N(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function Jf(){}var xf=.7,pp=1/xf,Bc="\\s*([+-]?\\d+)\\s*",yf="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",eo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",JH=/^#([0-9a-f]{3,8})$/,QH=new RegExp(`^rgb\\(${Bc},${Bc},${Bc}\\)$`),eX=new RegExp(`^rgb\\(${eo},${eo},${eo}\\)$`),tX=new RegExp(`^rgba\\(${Bc},${Bc},${Bc},${yf}\\)$`),rX=new RegExp(`^rgba\\(${eo},${eo},${eo},${yf}\\)$`),nX=new RegExp(`^hsl\\(${yf},${eo},${eo}\\)$`),aX=new RegExp(`^hsla\\(${yf},${eo},${eo},${yf}\\)$`),MS={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};g2(Jf,bf,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:_S,formatHex:_S,formatHex8:iX,formatHsl:oX,formatRgb:PS,toString:PS});function _S(){return this.rgb().formatHex()}function iX(){return this.rgb().formatHex8()}function oX(){return PN(this).formatHsl()}function PS(){return this.rgb().formatRgb()}function bf(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=JH.exec(e))?(r=t[1].length,t=parseInt(t[1],16),r===6?NS(t):r===3?new Ta(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):r===8?H0(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):r===4?H0(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=QH.exec(e))?new Ta(t[1],t[2],t[3],1):(t=eX.exec(e))?new Ta(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=tX.exec(e))?H0(t[1],t[2],t[3],t[4]):(t=rX.exec(e))?H0(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=nX.exec(e))?AS(t[1],t[2]/100,t[3]/100,1):(t=aX.exec(e))?AS(t[1],t[2]/100,t[3]/100,t[4]):MS.hasOwnProperty(e)?NS(MS[e]):e==="transparent"?new Ta(NaN,NaN,NaN,0):null}function NS(e){return new Ta(e>>16&255,e>>8&255,e&255,1)}function H0(e,t,r,n){return n<=0&&(e=t=r=NaN),new Ta(e,t,r,n)}function sX(e){return e instanceof Jf||(e=bf(e)),e?(e=e.rgb(),new Ta(e.r,e.g,e.b,e.opacity)):new Ta}function T1(e,t,r,n){return arguments.length===1?sX(e):new Ta(e,t,r,n??1)}function Ta(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}g2(Ta,T1,_N(Jf,{brighter(e){return e=e==null?pp:Math.pow(pp,e),new Ta(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?xf:Math.pow(xf,e),new Ta(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new Ta(Sl(this.r),Sl(this.g),Sl(this.b),gp(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:CS,formatHex:CS,formatHex8:lX,formatRgb:OS,toString:OS}));function CS(){return`#${gl(this.r)}${gl(this.g)}${gl(this.b)}`}function lX(){return`#${gl(this.r)}${gl(this.g)}${gl(this.b)}${gl((isNaN(this.opacity)?1:this.opacity)*255)}`}function OS(){const e=gp(this.opacity);return`${e===1?"rgb(":"rgba("}${Sl(this.r)}, ${Sl(this.g)}, ${Sl(this.b)}${e===1?")":`, ${e})`}`}function gp(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function Sl(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function gl(e){return e=Sl(e),(e<16?"0":"")+e.toString(16)}function AS(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new Oi(e,t,r,n)}function PN(e){if(e instanceof Oi)return new Oi(e.h,e.s,e.l,e.opacity);if(e instanceof Jf||(e=bf(e)),!e)return new Oi;if(e instanceof Oi)return e;e=e.rgb();var t=e.r/255,r=e.g/255,n=e.b/255,a=Math.min(t,r,n),i=Math.max(t,r,n),o=NaN,s=i-a,l=(i+a)/2;return s?(t===i?o=(r-n)/s+(r<n)*6:r===i?o=(n-t)/s+2:o=(t-r)/s+4,s/=l<.5?i+a:2-i-a,o*=60):s=l>0&&l<1?0:o,new Oi(o,s,l,e.opacity)}function cX(e,t,r,n){return arguments.length===1?PN(e):new Oi(e,t,r,n??1)}function Oi(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}g2(Oi,cX,_N(Jf,{brighter(e){return e=e==null?pp:Math.pow(pp,e),new Oi(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?xf:Math.pow(xf,e),new Oi(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,a=2*r-n;return new Ta(Px(e>=240?e-240:e+120,a,n),Px(e,a,n),Px(e<120?e+240:e-120,a,n),this.opacity)},clamp(){return new Oi(TS(this.h),X0(this.s),X0(this.l),gp(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=gp(this.opacity);return`${e===1?"hsl(":"hsla("}${TS(this.h)}, ${X0(this.s)*100}%, ${X0(this.l)*100}%${e===1?")":`, ${e})`}`}}));function TS(e){return e=(e||0)%360,e<0?e+360:e}function X0(e){return Math.max(0,Math.min(1,e||0))}function Px(e,t,r){return(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)*255}const m2=e=>()=>e;function uX(e,t){return function(r){return e+r*t}}function dX(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}function fX(e){return(e=+e)==1?NN:function(t,r){return r-t?dX(t,r,e):m2(isNaN(t)?r:t)}}function NN(e,t){var r=t-e;return r?uX(e,r):m2(isNaN(e)?t:e)}const ES=function e(t){var r=fX(t);function n(a,i){var o=r((a=T1(a)).r,(i=T1(i)).r),s=r(a.g,i.g),l=r(a.b,i.b),u=NN(a.opacity,i.opacity);return function(d){return a.r=o(d),a.g=s(d),a.b=l(d),a.opacity=u(d),a+""}}return n.gamma=e,n}(1);function hX(e,t){t||(t=[]);var r=e?Math.min(t.length,e.length):0,n=t.slice(),a;return function(i){for(a=0;a<r;++a)n[a]=e[a]*(1-i)+t[a]*i;return n}}function pX(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function gX(e,t){var r=t?t.length:0,n=e?Math.min(r,e.length):0,a=new Array(n),i=new Array(r),o;for(o=0;o<n;++o)a[o]=Bu(e[o],t[o]);for(;o<r;++o)i[o]=t[o];return function(s){for(o=0;o<n;++o)i[o]=a[o](s);return i}}function mX(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function mp(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function xX(e,t){var r={},n={},a;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(a in t)a in e?r[a]=Bu(e[a],t[a]):n[a]=t[a];return function(i){for(a in r)n[a]=r[a](i);return n}}var E1=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Nx=new RegExp(E1.source,"g");function yX(e){return function(){return e}}function bX(e){return function(t){return e(t)+""}}function vX(e,t){var r=E1.lastIndex=Nx.lastIndex=0,n,a,i,o=-1,s=[],l=[];for(e=e+"",t=t+"";(n=E1.exec(e))&&(a=Nx.exec(t));)(i=a.index)>r&&(i=t.slice(r,i),s[o]?s[o]+=i:s[++o]=i),(n=n[0])===(a=a[0])?s[o]?s[o]+=a:s[++o]=a:(s[++o]=null,l.push({i:o,x:mp(n,a)})),r=Nx.lastIndex;return r<t.length&&(i=t.slice(r),s[o]?s[o]+=i:s[++o]=i),s.length<2?l[0]?bX(l[0].x):yX(t):(t=l.length,function(u){for(var d=0,f;d<t;++d)s[(f=l[d]).i]=f.x(u);return s.join("")})}function Bu(e,t){var r=typeof t,n;return t==null||r==="boolean"?m2(t):(r==="number"?mp:r==="string"?(n=bf(t))?(t=n,ES):vX:t instanceof bf?ES:t instanceof Date?mX:pX(t)?hX:Array.isArray(t)?gX:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?xX:mp)(e,t)}function x2(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function wX(e,t){t===void 0&&(t=e,e=Bu);for(var r=0,n=t.length-1,a=t[0],i=new Array(n<0?0:n);r<n;)i[r]=e(a,a=t[++r]);return function(o){var s=Math.max(0,Math.min(n-1,Math.floor(o*=n)));return i[s](o-s)}}function kX(e){return function(){return e}}function xp(e){return+e}var IS=[0,1];function ya(e){return e}function I1(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:kX(isNaN(t)?NaN:.5)}function SX(e,t){var r;return e>t&&(r=e,e=t,t=r),function(n){return Math.max(e,Math.min(t,n))}}function jX(e,t,r){var n=e[0],a=e[1],i=t[0],o=t[1];return a<n?(n=I1(a,n),i=r(o,i)):(n=I1(n,a),i=r(i,o)),function(s){return i(n(s))}}function MX(e,t,r){var n=Math.min(e.length,t.length)-1,a=new Array(n),i=new Array(n),o=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<n;)a[o]=I1(e[o],e[o+1]),i[o]=r(t[o],t[o+1]);return function(s){var l=Zf(e,s,1,n)-1;return i[l](a[l](s))}}function Qf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Kg(){var e=IS,t=IS,r=Bu,n,a,i,o=ya,s,l,u;function d(){var h=Math.min(e.length,t.length);return o!==ya&&(o=SX(e[0],e[h-1])),s=h>2?MX:jX,l=u=null,f}function f(h){return h==null||isNaN(h=+h)?i:(l||(l=s(e.map(n),t,r)))(n(o(h)))}return f.invert=function(h){return o(a((u||(u=s(t,e.map(n),mp)))(h)))},f.domain=function(h){return arguments.length?(e=Array.from(h,xp),d()):e.slice()},f.range=function(h){return arguments.length?(t=Array.from(h),d()):t.slice()},f.rangeRound=function(h){return t=Array.from(h),r=x2,d()},f.clamp=function(h){return arguments.length?(o=h?!0:ya,d()):o!==ya},f.interpolate=function(h){return arguments.length?(r=h,d()):r},f.unknown=function(h){return arguments.length?(i=h,f):i},function(h,p){return n=h,a=p,d()}}function y2(){return Kg()(ya,ya)}function _X(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function yp(e,t){if(!isFinite(e)||e===0)return null;var r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function nu(e){return e=yp(Math.abs(e)),e?e[1]:NaN}function PX(e,t){return function(r,n){for(var a=r.length,i=[],o=0,s=e[0],l=0;a>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),i.push(r.substring(a-=s,a+s)),!((l+=s+1)>n));)s=e[o=(o+1)%e.length];return i.reverse().join(t)}}function NX(e){return function(t){return t.replace(/[0-9]/g,function(r){return e[+r]})}}var CX=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function vf(e){if(!(t=CX.exec(e)))throw new Error("invalid format: "+e);var t;return new b2({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}vf.prototype=b2.prototype;function b2(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}b2.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function OX(e){e:for(var t=e.length,r=1,n=-1,a;r<t;++r)switch(e[r]){case".":n=a=r;break;case"0":n===0&&(n=r),a=r;break;default:if(!+e[r])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(a+1):e}var bp;function AX(e,t){var r=yp(e,t);if(!r)return bp=void 0,e.toPrecision(t);var n=r[0],a=r[1],i=a-(bp=Math.max(-8,Math.min(8,Math.floor(a/3)))*3)+1,o=n.length;return i===o?n:i>o?n+new Array(i-o+1).join("0"):i>0?n.slice(0,i)+"."+n.slice(i):"0."+new Array(1-i).join("0")+yp(e,Math.max(0,t+i-1))[0]}function RS(e,t){var r=yp(e,t);if(!r)return e+"";var n=r[0],a=r[1];return a<0?"0."+new Array(-a).join("0")+n:n.length>a+1?n.slice(0,a+1)+"."+n.slice(a+1):n+new Array(a-n.length+2).join("0")}const DS={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:_X,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>RS(e*100,t),r:RS,s:AX,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function $S(e){return e}var LS=Array.prototype.map,BS=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function TX(e){var t=e.grouping===void 0||e.thousands===void 0?$S:PX(LS.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",a=e.decimal===void 0?".":e.decimal+"",i=e.numerals===void 0?$S:NX(LS.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",s=e.minus===void 0?"":e.minus+"",l=e.nan===void 0?"NaN":e.nan+"";function u(f,h){f=vf(f);var p=f.fill,x=f.align,b=f.sign,y=f.symbol,m=f.zero,g=f.width,k=f.comma,S=f.precision,w=f.trim,v=f.type;v==="n"?(k=!0,v="g"):DS[v]||(S===void 0&&(S=12),w=!0,v="g"),(m||p==="0"&&x==="=")&&(m=!0,p="0",x="=");var M=(h&&h.prefix!==void 0?h.prefix:"")+(y==="$"?r:y==="#"&&/[boxX]/.test(v)?"0"+v.toLowerCase():""),_=(y==="$"?n:/[%p]/.test(v)?o:"")+(h&&h.suffix!==void 0?h.suffix:""),P=DS[v],A=/[defgprs%]/.test(v);S=S===void 0?6:/[gprs]/.test(v)?Math.max(1,Math.min(21,S)):Math.max(0,Math.min(20,S));function R(D){var E=M,W=_,F,O,$;if(v==="c")W=P(D)+W,D="";else{D=+D;var N=D<0||1/D<0;if(D=isNaN(D)?l:P(Math.abs(D),S),w&&(D=OX(D)),N&&+D==0&&b!=="+"&&(N=!1),E=(N?b==="("?b:s:b==="-"||b==="("?"":b)+E,W=(v==="s"&&!isNaN(D)&&bp!==void 0?BS[8+bp/3]:"")+W+(N&&b==="("?")":""),A){for(F=-1,O=D.length;++F<O;)if($=D.charCodeAt(F),48>$||$>57){W=($===46?a+D.slice(F+1):D.slice(F))+W,D=D.slice(0,F);break}}}k&&!m&&(D=t(D,1/0));var C=E.length+D.length+W.length,B=C<g?new Array(g-C+1).join(p):"";switch(k&&m&&(D=t(B+D,B.length?g-W.length:1/0),B=""),x){case"<":D=E+D+W+B;break;case"=":D=E+B+D+W;break;case"^":D=B.slice(0,C=B.length>>1)+E+D+W+B.slice(C);break;default:D=B+E+D+W;break}return i(D)}return R.toString=function(){return f+""},R}function d(f,h){var p=Math.max(-8,Math.min(8,Math.floor(nu(h)/3)))*3,x=Math.pow(10,-p),b=u((f=vf(f),f.type="f",f),{suffix:BS[8+p/3]});return function(y){return b(x*y)}}return{format:u,formatPrefix:d}}var K0,v2,CN;EX({thousands:",",grouping:[3],currency:["$",""]});function EX(e){return K0=TX(e),v2=K0.format,CN=K0.formatPrefix,K0}function IX(e){return Math.max(0,-nu(Math.abs(e)))}function RX(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(nu(t)/3)))*3-nu(Math.abs(e)))}function DX(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,nu(t)-nu(e))+1}function ON(e,t,r,n){var a=O1(e,t,r),i;switch(n=vf(n??",f"),n.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return n.precision==null&&!isNaN(i=RX(a,o))&&(n.precision=i),CN(n,o)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(i=DX(a,Math.max(Math.abs(e),Math.abs(t))))&&(n.precision=i-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(i=IX(a))&&(n.precision=i-(n.type==="%")*2);break}}return v2(n)}function Vs(e){var t=e.domain;return e.ticks=function(r){var n=t();return N1(n[0],n[n.length-1],r??10)},e.tickFormat=function(r,n){var a=t();return ON(a[0],a[a.length-1],r??10,n)},e.nice=function(r){r==null&&(r=10);var n=t(),a=0,i=n.length-1,o=n[a],s=n[i],l,u,d=10;for(s<o&&(u=o,o=s,s=u,u=a,a=i,i=u);d-- >0;){if(u=C1(o,s,r),u===l)return n[a]=o,n[i]=s,t(n);if(u>0)o=Math.floor(o/u)*u,s=Math.ceil(s/u)*u;else if(u<0)o=Math.ceil(o*u)/u,s=Math.floor(s*u)/u;else break;l=u}return e},e}function vp(){var e=y2();return e.copy=function(){return Qf(e,vp())},yi.apply(e,arguments),Vs(e)}function AN(e){var t;function r(n){return n==null||isNaN(n=+n)?t:n}return r.invert=r,r.domain=r.range=function(n){return arguments.length?(e=Array.from(n,xp),r):e.slice()},r.unknown=function(n){return arguments.length?(t=n,r):t},r.copy=function(){return AN(e).unknown(t)},e=arguments.length?Array.from(e,xp):[0,1],Vs(r)}function TN(e,t){e=e.slice();var r=0,n=e.length-1,a=e[r],i=e[n],o;return i<a&&(o=r,r=n,n=o,o=a,a=i,i=o),e[r]=t.floor(a),e[n]=t.ceil(i),e}function FS(e){return Math.log(e)}function GS(e){return Math.exp(e)}function $X(e){return-Math.log(-e)}function LX(e){return-Math.exp(-e)}function BX(e){return isFinite(e)?+("1e"+e):e<0?0:e}function FX(e){return e===10?BX:e===Math.E?Math.exp:t=>Math.pow(e,t)}function GX(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}function US(e){return(t,r)=>-e(-t,r)}function w2(e){const t=e(FS,GS),r=t.domain;let n=10,a,i;function o(){return a=GX(n),i=FX(n),r()[0]<0?(a=US(a),i=US(i),e($X,LX)):e(FS,GS),t}return t.base=function(s){return arguments.length?(n=+s,o()):n},t.domain=function(s){return arguments.length?(r(s),o()):r()},t.ticks=s=>{const l=r();let u=l[0],d=l[l.length-1];const f=d<u;f&&([u,d]=[d,u]);let h=a(u),p=a(d),x,b;const y=s==null?10:+s;let m=[];if(!(n%1)&&p-h<y){if(h=Math.floor(h),p=Math.ceil(p),u>0){for(;h<=p;++h)for(x=1;x<n;++x)if(b=h<0?x/i(-h):x*i(h),!(b<u)){if(b>d)break;m.push(b)}}else for(;h<=p;++h)for(x=n-1;x>=1;--x)if(b=h>0?x/i(-h):x*i(h),!(b<u)){if(b>d)break;m.push(b)}m.length*2<y&&(m=N1(u,d,y))}else m=N1(h,p,Math.min(p-h,y)).map(i);return f?m.reverse():m},t.tickFormat=(s,l)=>{if(s==null&&(s=10),l==null&&(l=n===10?"s":","),typeof l!="function"&&(!(n%1)&&(l=vf(l)).precision==null&&(l.trim=!0),l=v2(l)),s===1/0)return l;const u=Math.max(1,n*s/t.ticks().length);return d=>{let f=d/i(Math.round(a(d)));return f*n<n-.5&&(f*=n),f<=u?l(d):""}},t.nice=()=>r(TN(r(),{floor:s=>i(Math.floor(a(s))),ceil:s=>i(Math.ceil(a(s)))})),t}function EN(){const e=w2(Kg()).domain([1,10]);return e.copy=()=>Qf(e,EN()).base(e.base()),yi.apply(e,arguments),e}function zS(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function WS(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function k2(e){var t=1,r=e(zS(t),WS(t));return r.constant=function(n){return arguments.length?e(zS(t=+n),WS(t)):t},Vs(r)}function IN(){var e=k2(Kg());return e.copy=function(){return Qf(e,IN()).constant(e.constant())},yi.apply(e,arguments)}function VS(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function UX(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function zX(e){return e<0?-e*e:e*e}function S2(e){var t=e(ya,ya),r=1;function n(){return r===1?e(ya,ya):r===.5?e(UX,zX):e(VS(r),VS(1/r))}return t.exponent=function(a){return arguments.length?(r=+a,n()):r},Vs(t)}function j2(){var e=S2(Kg());return e.copy=function(){return Qf(e,j2()).exponent(e.exponent())},yi.apply(e,arguments),e}function WX(){return j2.apply(null,arguments).exponent(.5)}function HS(e){return Math.sign(e)*e*e}function VX(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}function RN(){var e=y2(),t=[0,1],r=!1,n;function a(i){var o=VX(e(i));return isNaN(o)?n:r?Math.round(o):o}return a.invert=function(i){return e.invert(HS(i))},a.domain=function(i){return arguments.length?(e.domain(i),a):e.domain()},a.range=function(i){return arguments.length?(e.range((t=Array.from(i,xp)).map(HS)),a):t.slice()},a.rangeRound=function(i){return a.range(i).round(!0)},a.round=function(i){return arguments.length?(r=!!i,a):r},a.clamp=function(i){return arguments.length?(e.clamp(i),a):e.clamp()},a.unknown=function(i){return arguments.length?(n=i,a):n},a.copy=function(){return RN(e.domain(),t).round(r).clamp(e.clamp()).unknown(n)},yi.apply(a,arguments),Vs(a)}function DN(){var e=[],t=[],r=[],n;function a(){var o=0,s=Math.max(1,t.length);for(r=new Array(s-1);++o<s;)r[o-1]=qH(e,o/s);return i}function i(o){return o==null||isNaN(o=+o)?n:t[Zf(r,o)]}return i.invertExtent=function(o){var s=t.indexOf(o);return s<0?[NaN,NaN]:[s>0?r[s-1]:e[0],s<r.length?r[s]:e[e.length-1]]},i.domain=function(o){if(!arguments.length)return e.slice();e=[];for(let s of o)s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(Es),a()},i.range=function(o){return arguments.length?(t=Array.from(o),a()):t.slice()},i.unknown=function(o){return arguments.length?(n=o,i):n},i.quantiles=function(){return r.slice()},i.copy=function(){return DN().domain(e).range(t).unknown(n)},yi.apply(i,arguments)}function $N(){var e=0,t=1,r=1,n=[.5],a=[0,1],i;function o(l){return l!=null&&l<=l?a[Zf(n,l,0,r)]:i}function s(){var l=-1;for(n=new Array(r);++l<r;)n[l]=((l+1)*t-(l-r)*e)/(r+1);return o}return o.domain=function(l){return arguments.length?([e,t]=l,e=+e,t=+t,s()):[e,t]},o.range=function(l){return arguments.length?(r=(a=Array.from(l)).length-1,s()):a.slice()},o.invertExtent=function(l){var u=a.indexOf(l);return u<0?[NaN,NaN]:u<1?[e,n[0]]:u>=r?[n[r-1],t]:[n[u-1],n[u]]},o.unknown=function(l){return arguments.length&&(i=l),o},o.thresholds=function(){return n.slice()},o.copy=function(){return $N().domain([e,t]).range(a).unknown(i)},yi.apply(Vs(o),arguments)}function LN(){var e=[.5],t=[0,1],r,n=1;function a(i){return i!=null&&i<=i?t[Zf(e,i,0,n)]:r}return a.domain=function(i){return arguments.length?(e=Array.from(i),n=Math.min(e.length,t.length-1),a):e.slice()},a.range=function(i){return arguments.length?(t=Array.from(i),n=Math.min(e.length,t.length-1),a):t.slice()},a.invertExtent=function(i){var o=t.indexOf(i);return[e[o-1],e[o]]},a.unknown=function(i){return arguments.length?(r=i,a):r},a.copy=function(){return LN().domain(e).range(t).unknown(r)},yi.apply(a,arguments)}const Cx=new Date,Ox=new Date;function Fn(e,t,r,n){function a(i){return e(i=arguments.length===0?new Date:new Date(+i)),i}return a.floor=i=>(e(i=new Date(+i)),i),a.ceil=i=>(e(i=new Date(i-1)),t(i,1),e(i),i),a.round=i=>{const o=a(i),s=a.ceil(i);return i-o<s-i?o:s},a.offset=(i,o)=>(t(i=new Date(+i),o==null?1:Math.floor(o)),i),a.range=(i,o,s)=>{const l=[];if(i=a.ceil(i),s=s==null?1:Math.floor(s),!(i<o)||!(s>0))return l;let u;do l.push(u=new Date(+i)),t(i,s),e(i);while(u<i&&i<o);return l},a.filter=i=>Fn(o=>{if(o>=o)for(;e(o),!i(o);)o.setTime(o-1)},(o,s)=>{if(o>=o)if(s<0)for(;++s<=0;)for(;t(o,-1),!i(o););else for(;--s>=0;)for(;t(o,1),!i(o););}),r&&(a.count=(i,o)=>(Cx.setTime(+i),Ox.setTime(+o),e(Cx),e(Ox),Math.floor(r(Cx,Ox))),a.every=i=>(i=Math.floor(i),!isFinite(i)||!(i>0)?null:i>1?a.filter(n?o=>n(o)%i===0:o=>a.count(0,o)%i===0):a)),a}const wp=Fn(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);wp.every=e=>(e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Fn(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):wp);wp.range;const jo=1e3,ui=jo*60,Mo=ui*60,Do=Mo*24,M2=Do*7,XS=Do*30,Ax=Do*365,ml=Fn(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*jo)},(e,t)=>(t-e)/jo,e=>e.getUTCSeconds());ml.range;const _2=Fn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jo)},(e,t)=>{e.setTime(+e+t*ui)},(e,t)=>(t-e)/ui,e=>e.getMinutes());_2.range;const P2=Fn(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*ui)},(e,t)=>(t-e)/ui,e=>e.getUTCMinutes());P2.range;const N2=Fn(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*jo-e.getMinutes()*ui)},(e,t)=>{e.setTime(+e+t*Mo)},(e,t)=>(t-e)/Mo,e=>e.getHours());N2.range;const C2=Fn(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*Mo)},(e,t)=>(t-e)/Mo,e=>e.getUTCHours());C2.range;const e0=Fn(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*ui)/Do,e=>e.getDate()-1);e0.range;const Yg=Fn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Do,e=>e.getUTCDate()-1);Yg.range;const BN=Fn(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/Do,e=>Math.floor(e/Do));BN.range;function Yl(e){return Fn(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(t,r)=>{t.setDate(t.getDate()+r*7)},(t,r)=>(r-t-(r.getTimezoneOffset()-t.getTimezoneOffset())*ui)/M2)}const qg=Yl(0),kp=Yl(1),HX=Yl(2),XX=Yl(3),au=Yl(4),KX=Yl(5),YX=Yl(6);qg.range;kp.range;HX.range;XX.range;au.range;KX.range;YX.range;function ql(e){return Fn(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCDate(t.getUTCDate()+r*7)},(t,r)=>(r-t)/M2)}const Zg=ql(0),Sp=ql(1),qX=ql(2),ZX=ql(3),iu=ql(4),JX=ql(5),QX=ql(6);Zg.range;Sp.range;qX.range;ZX.range;iu.range;JX.range;QX.range;const O2=Fn(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+(t.getFullYear()-e.getFullYear())*12,e=>e.getMonth());O2.range;const A2=Fn(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+(t.getUTCFullYear()-e.getUTCFullYear())*12,e=>e.getUTCMonth());A2.range;const $o=Fn(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear());$o.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Fn(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)});$o.range;const Lo=Fn(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Lo.every=e=>!isFinite(e=Math.floor(e))||!(e>0)?null:Fn(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)});Lo.range;function FN(e,t,r,n,a,i){const o=[[ml,1,jo],[ml,5,5*jo],[ml,15,15*jo],[ml,30,30*jo],[i,1,ui],[i,5,5*ui],[i,15,15*ui],[i,30,30*ui],[a,1,Mo],[a,3,3*Mo],[a,6,6*Mo],[a,12,12*Mo],[n,1,Do],[n,2,2*Do],[r,1,M2],[t,1,XS],[t,3,3*XS],[e,1,Ax]];function s(u,d,f){const h=d<u;h&&([u,d]=[d,u]);const p=f&&typeof f.range=="function"?f:l(u,d,f),x=p?p.range(u,+d+1):[];return h?x.reverse():x}function l(u,d,f){const h=Math.abs(d-u)/f,p=h2(([,,y])=>y).right(o,h);if(p===o.length)return e.every(O1(u/Ax,d/Ax,f));if(p===0)return wp.every(Math.max(O1(u,d,f),1));const[x,b]=o[h/o[p-1][2]<o[p][2]/h?p-1:p];return x.every(b)}return[s,l]}const[eK,tK]=FN(Lo,A2,Zg,BN,C2,P2),[rK,nK]=FN($o,O2,qg,e0,N2,_2);function Tx(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function Ex(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function fd(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}function aK(e){var t=e.dateTime,r=e.date,n=e.time,a=e.periods,i=e.days,o=e.shortDays,s=e.months,l=e.shortMonths,u=hd(a),d=pd(a),f=hd(i),h=pd(i),p=hd(o),x=pd(o),b=hd(s),y=pd(s),m=hd(l),g=pd(l),k={a:$,A:N,b:C,B,c:null,d:QS,e:QS,f:PK,g:$K,G:BK,H:jK,I:MK,j:_K,L:GN,m:NK,M:CK,p:I,q:z,Q:r5,s:n5,S:OK,u:AK,U:TK,V:EK,w:IK,W:RK,x:null,X:null,y:DK,Y:LK,Z:FK,"%":t5},S={a:V,A:K,b:q,B:G,c:null,d:e5,e:e5,f:WK,g:eY,G:rY,H:GK,I:UK,j:zK,L:zN,m:VK,M:HK,p:pe,q:J,Q:r5,s:n5,S:XK,u:KK,U:YK,V:qK,w:ZK,W:JK,x:null,X:null,y:QK,Y:tY,Z:nY,"%":t5},w={a:A,A:R,b:D,B:E,c:W,d:ZS,e:ZS,f:vK,g:qS,G:YS,H:JS,I:JS,j:mK,L:bK,m:gK,M:xK,p:P,q:pK,Q:kK,s:SK,S:yK,u:cK,U:uK,V:dK,w:lK,W:fK,x:F,X:O,y:qS,Y:YS,Z:hK,"%":wK};k.x=v(r,k),k.X=v(n,k),k.c=v(t,k),S.x=v(r,S),S.X=v(n,S),S.c=v(t,S);function v(Z,ae){return function(ce){var ne=[],le=-1,se=0,he=Z.length,ue,ie,xe;for(ce instanceof Date||(ce=new Date(+ce));++le<he;)Z.charCodeAt(le)===37&&(ne.push(Z.slice(se,le)),(ie=KS[ue=Z.charAt(++le)])!=null?ue=Z.charAt(++le):ie=ue==="e"?" ":"0",(xe=ae[ue])&&(ue=xe(ce,ie)),ne.push(ue),se=le+1);return ne.push(Z.slice(se,le)),ne.join("")}}function M(Z,ae){return function(ce){var ne=fd(1900,void 0,1),le=_(ne,Z,ce+="",0),se,he;if(le!=ce.length)return null;if("Q"in ne)return new Date(ne.Q);if("s"in ne)return new Date(ne.s*1e3+("L"in ne?ne.L:0));if(ae&&!("Z"in ne)&&(ne.Z=0),"p"in ne&&(ne.H=ne.H%12+ne.p*12),ne.m===void 0&&(ne.m="q"in ne?ne.q:0),"V"in ne){if(ne.V<1||ne.V>53)return null;"w"in ne||(ne.w=1),"Z"in ne?(se=Ex(fd(ne.y,0,1)),he=se.getUTCDay(),se=he>4||he===0?Sp.ceil(se):Sp(se),se=Yg.offset(se,(ne.V-1)*7),ne.y=se.getUTCFullYear(),ne.m=se.getUTCMonth(),ne.d=se.getUTCDate()+(ne.w+6)%7):(se=Tx(fd(ne.y,0,1)),he=se.getDay(),se=he>4||he===0?kp.ceil(se):kp(se),se=e0.offset(se,(ne.V-1)*7),ne.y=se.getFullYear(),ne.m=se.getMonth(),ne.d=se.getDate()+(ne.w+6)%7)}else("W"in ne||"U"in ne)&&("w"in ne||(ne.w="u"in ne?ne.u%7:"W"in ne?1:0),he="Z"in ne?Ex(fd(ne.y,0,1)).getUTCDay():Tx(fd(ne.y,0,1)).getDay(),ne.m=0,ne.d="W"in ne?(ne.w+6)%7+ne.W*7-(he+5)%7:ne.w+ne.U*7-(he+6)%7);return"Z"in ne?(ne.H+=ne.Z/100|0,ne.M+=ne.Z%100,Ex(ne)):Tx(ne)}}function _(Z,ae,ce,ne){for(var le=0,se=ae.length,he=ce.length,ue,ie;le<se;){if(ne>=he)return-1;if(ue=ae.charCodeAt(le++),ue===37){if(ue=ae.charAt(le++),ie=w[ue in KS?ae.charAt(le++):ue],!ie||(ne=ie(Z,ce,ne))<0)return-1}else if(ue!=ce.charCodeAt(ne++))return-1}return ne}function P(Z,ae,ce){var ne=u.exec(ae.slice(ce));return ne?(Z.p=d.get(ne[0].toLowerCase()),ce+ne[0].length):-1}function A(Z,ae,ce){var ne=p.exec(ae.slice(ce));return ne?(Z.w=x.get(ne[0].toLowerCase()),ce+ne[0].length):-1}function R(Z,ae,ce){var ne=f.exec(ae.slice(ce));return ne?(Z.w=h.get(ne[0].toLowerCase()),ce+ne[0].length):-1}function D(Z,ae,ce){var ne=m.exec(ae.slice(ce));return ne?(Z.m=g.get(ne[0].toLowerCase()),ce+ne[0].length):-1}function E(Z,ae,ce){var ne=b.exec(ae.slice(ce));return ne?(Z.m=y.get(ne[0].toLowerCase()),ce+ne[0].length):-1}function W(Z,ae,ce){return _(Z,t,ae,ce)}function F(Z,ae,ce){return _(Z,r,ae,ce)}function O(Z,ae,ce){return _(Z,n,ae,ce)}function $(Z){return o[Z.getDay()]}function N(Z){return i[Z.getDay()]}function C(Z){return l[Z.getMonth()]}function B(Z){return s[Z.getMonth()]}function I(Z){return a[+(Z.getHours()>=12)]}function z(Z){return 1+~~(Z.getMonth()/3)}function V(Z){return o[Z.getUTCDay()]}function K(Z){return i[Z.getUTCDay()]}function q(Z){return l[Z.getUTCMonth()]}function G(Z){return s[Z.getUTCMonth()]}function pe(Z){return a[+(Z.getUTCHours()>=12)]}function J(Z){return 1+~~(Z.getUTCMonth()/3)}return{format:function(Z){var ae=v(Z+="",k);return ae.toString=function(){return Z},ae},parse:function(Z){var ae=M(Z+="",!1);return ae.toString=function(){return Z},ae},utcFormat:function(Z){var ae=v(Z+="",S);return ae.toString=function(){return Z},ae},utcParse:function(Z){var ae=M(Z+="",!0);return ae.toString=function(){return Z},ae}}}var KS={"-":"",_:" ",0:"0"},Hn=/^\s*\d+/,iK=/^%/,oK=/[\\^$*+?|[\]().{}]/g;function kr(e,t,r){var n=e<0?"-":"",a=(n?-e:e)+"",i=a.length;return n+(i<r?new Array(r-i+1).join(t)+a:a)}function sK(e){return e.replace(oK,"\\$&")}function hd(e){return new RegExp("^(?:"+e.map(sK).join("|")+")","i")}function pd(e){return new Map(e.map((t,r)=>[t.toLowerCase(),r]))}function lK(e,t,r){var n=Hn.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function cK(e,t,r){var n=Hn.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function uK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function dK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function fK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function YS(e,t,r){var n=Hn.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function qS(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function hK(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function pK(e,t,r){var n=Hn.exec(t.slice(r,r+1));return n?(e.q=n[0]*3-3,r+n[0].length):-1}function gK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function ZS(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function mK(e,t,r){var n=Hn.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function JS(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function xK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function yK(e,t,r){var n=Hn.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function bK(e,t,r){var n=Hn.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function vK(e,t,r){var n=Hn.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function wK(e,t,r){var n=iK.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function kK(e,t,r){var n=Hn.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function SK(e,t,r){var n=Hn.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function QS(e,t){return kr(e.getDate(),t,2)}function jK(e,t){return kr(e.getHours(),t,2)}function MK(e,t){return kr(e.getHours()%12||12,t,2)}function _K(e,t){return kr(1+e0.count($o(e),e),t,3)}function GN(e,t){return kr(e.getMilliseconds(),t,3)}function PK(e,t){return GN(e,t)+"000"}function NK(e,t){return kr(e.getMonth()+1,t,2)}function CK(e,t){return kr(e.getMinutes(),t,2)}function OK(e,t){return kr(e.getSeconds(),t,2)}function AK(e){var t=e.getDay();return t===0?7:t}function TK(e,t){return kr(qg.count($o(e)-1,e),t,2)}function UN(e){var t=e.getDay();return t>=4||t===0?au(e):au.ceil(e)}function EK(e,t){return e=UN(e),kr(au.count($o(e),e)+($o(e).getDay()===4),t,2)}function IK(e){return e.getDay()}function RK(e,t){return kr(kp.count($o(e)-1,e),t,2)}function DK(e,t){return kr(e.getFullYear()%100,t,2)}function $K(e,t){return e=UN(e),kr(e.getFullYear()%100,t,2)}function LK(e,t){return kr(e.getFullYear()%1e4,t,4)}function BK(e,t){var r=e.getDay();return e=r>=4||r===0?au(e):au.ceil(e),kr(e.getFullYear()%1e4,t,4)}function FK(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+kr(t/60|0,"0",2)+kr(t%60,"0",2)}function e5(e,t){return kr(e.getUTCDate(),t,2)}function GK(e,t){return kr(e.getUTCHours(),t,2)}function UK(e,t){return kr(e.getUTCHours()%12||12,t,2)}function zK(e,t){return kr(1+Yg.count(Lo(e),e),t,3)}function zN(e,t){return kr(e.getUTCMilliseconds(),t,3)}function WK(e,t){return zN(e,t)+"000"}function VK(e,t){return kr(e.getUTCMonth()+1,t,2)}function HK(e,t){return kr(e.getUTCMinutes(),t,2)}function XK(e,t){return kr(e.getUTCSeconds(),t,2)}function KK(e){var t=e.getUTCDay();return t===0?7:t}function YK(e,t){return kr(Zg.count(Lo(e)-1,e),t,2)}function WN(e){var t=e.getUTCDay();return t>=4||t===0?iu(e):iu.ceil(e)}function qK(e,t){return e=WN(e),kr(iu.count(Lo(e),e)+(Lo(e).getUTCDay()===4),t,2)}function ZK(e){return e.getUTCDay()}function JK(e,t){return kr(Sp.count(Lo(e)-1,e),t,2)}function QK(e,t){return kr(e.getUTCFullYear()%100,t,2)}function eY(e,t){return e=WN(e),kr(e.getUTCFullYear()%100,t,2)}function tY(e,t){return kr(e.getUTCFullYear()%1e4,t,4)}function rY(e,t){var r=e.getUTCDay();return e=r>=4||r===0?iu(e):iu.ceil(e),kr(e.getUTCFullYear()%1e4,t,4)}function nY(){return"+0000"}function t5(){return"%"}function r5(e){return+e}function n5(e){return Math.floor(+e/1e3)}var uc,VN,HN;aY({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function aY(e){return uc=aK(e),VN=uc.format,uc.parse,HN=uc.utcFormat,uc.utcParse,uc}function iY(e){return new Date(e)}function oY(e){return e instanceof Date?+e:+new Date(+e)}function T2(e,t,r,n,a,i,o,s,l,u){var d=y2(),f=d.invert,h=d.domain,p=u(".%L"),x=u(":%S"),b=u("%I:%M"),y=u("%I %p"),m=u("%a %d"),g=u("%b %d"),k=u("%B"),S=u("%Y");function w(v){return(l(v)<v?p:s(v)<v?x:o(v)<v?b:i(v)<v?y:n(v)<v?a(v)<v?m:g:r(v)<v?k:S)(v)}return d.invert=function(v){return new Date(f(v))},d.domain=function(v){return arguments.length?h(Array.from(v,oY)):h().map(iY)},d.ticks=function(v){var M=h();return e(M[0],M[M.length-1],v??10)},d.tickFormat=function(v,M){return M==null?w:u(M)},d.nice=function(v){var M=h();return(!v||typeof v.range!="function")&&(v=t(M[0],M[M.length-1],v??10)),v?h(TN(M,v)):d},d.copy=function(){return Qf(d,T2(e,t,r,n,a,i,o,s,l,u))},d}function sY(){return yi.apply(T2(rK,nK,$o,O2,qg,e0,N2,_2,ml,VN).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function lY(){return yi.apply(T2(eK,tK,Lo,A2,Zg,Yg,C2,P2,ml,HN).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Jg(){var e=0,t=1,r,n,a,i,o=ya,s=!1,l;function u(f){return f==null||isNaN(f=+f)?l:o(a===0?.5:(f=(i(f)-r)*a,s?Math.max(0,Math.min(1,f)):f))}u.domain=function(f){return arguments.length?([e,t]=f,r=i(e=+e),n=i(t=+t),a=r===n?0:1/(n-r),u):[e,t]},u.clamp=function(f){return arguments.length?(s=!!f,u):s},u.interpolator=function(f){return arguments.length?(o=f,u):o};function d(f){return function(h){var p,x;return arguments.length?([p,x]=h,o=f(p,x),u):[o(0),o(1)]}}return u.range=d(Bu),u.rangeRound=d(x2),u.unknown=function(f){return arguments.length?(l=f,u):l},function(f){return i=f,r=f(e),n=f(t),a=r===n?0:1/(n-r),u}}function Hs(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function XN(){var e=Vs(Jg()(ya));return e.copy=function(){return Hs(e,XN())},Uo.apply(e,arguments)}function KN(){var e=w2(Jg()).domain([1,10]);return e.copy=function(){return Hs(e,KN()).base(e.base())},Uo.apply(e,arguments)}function YN(){var e=k2(Jg());return e.copy=function(){return Hs(e,YN()).constant(e.constant())},Uo.apply(e,arguments)}function E2(){var e=S2(Jg());return e.copy=function(){return Hs(e,E2()).exponent(e.exponent())},Uo.apply(e,arguments)}function cY(){return E2.apply(null,arguments).exponent(.5)}function qN(){var e=[],t=ya;function r(n){if(n!=null&&!isNaN(n=+n))return t((Zf(e,n,1)-1)/(e.length-1))}return r.domain=function(n){if(!arguments.length)return e.slice();e=[];for(let a of n)a!=null&&!isNaN(a=+a)&&e.push(a);return e.sort(Es),r},r.interpolator=function(n){return arguments.length?(t=n,r):t},r.range=function(){return e.map((n,a)=>t(a/(e.length-1)))},r.quantiles=function(n){return Array.from({length:n+1},(a,i)=>YH(e,i/n))},r.copy=function(){return qN(t).domain(e)},Uo.apply(r,arguments)}function Qg(){var e=0,t=.5,r=1,n=1,a,i,o,s,l,u=ya,d,f=!1,h;function p(b){return isNaN(b=+b)?h:(b=.5+((b=+d(b))-i)*(n*b<n*i?s:l),u(f?Math.max(0,Math.min(1,b)):b))}p.domain=function(b){return arguments.length?([e,t,r]=b,a=d(e=+e),i=d(t=+t),o=d(r=+r),s=a===i?0:.5/(i-a),l=i===o?0:.5/(o-i),n=i<a?-1:1,p):[e,t,r]},p.clamp=function(b){return arguments.length?(f=!!b,p):f},p.interpolator=function(b){return arguments.length?(u=b,p):u};function x(b){return function(y){var m,g,k;return arguments.length?([m,g,k]=y,u=wX(b,[m,g,k]),p):[u(0),u(.5),u(1)]}}return p.range=x(Bu),p.rangeRound=x(x2),p.unknown=function(b){return arguments.length?(h=b,p):h},function(b){return d=b,a=b(e),i=b(t),o=b(r),s=a===i?0:.5/(i-a),l=i===o?0:.5/(o-i),n=i<a?-1:1,p}}function ZN(){var e=Vs(Qg()(ya));return e.copy=function(){return Hs(e,ZN())},Uo.apply(e,arguments)}function JN(){var e=w2(Qg()).domain([.1,1,10]);return e.copy=function(){return Hs(e,JN()).base(e.base())},Uo.apply(e,arguments)}function QN(){var e=k2(Qg());return e.copy=function(){return Hs(e,QN()).constant(e.constant())},Uo.apply(e,arguments)}function I2(){var e=S2(Qg());return e.copy=function(){return Hs(e,I2()).exponent(e.exponent())},Uo.apply(e,arguments)}function uY(){return I2.apply(null,arguments).exponent(.5)}const a5=Object.freeze(Object.defineProperty({__proto__:null,scaleBand:mf,scaleDiverging:ZN,scaleDivergingLog:JN,scaleDivergingPow:I2,scaleDivergingSqrt:uY,scaleDivergingSymlog:QN,scaleIdentity:AN,scaleImplicit:A1,scaleLinear:vp,scaleLog:EN,scaleOrdinal:p2,scalePoint:$d,scalePow:j2,scaleQuantile:DN,scaleQuantize:$N,scaleRadial:RN,scaleSequential:XN,scaleSequentialLog:KN,scaleSequentialPow:E2,scaleSequentialQuantile:qN,scaleSequentialSqrt:cY,scaleSequentialSymlog:YN,scaleSqrt:WX,scaleSymlog:IN,scaleThreshold:LN,scaleTime:sY,scaleUtc:lY,tickFormat:ON},Symbol.toStringTag,{value:"Module"}));var dY=Ou;function fY(e,t,r){for(var n=-1,a=e.length;++n<a;){var i=e[n],o=t(i);if(o!=null&&(s===void 0?o===o&&!dY(o):r(o,s)))var s=o,l=i}return l}var eC=fY;function hY(e,t){return e>t}var pY=hY,gY=eC,mY=pY,xY=Lu;function yY(e){return e&&e.length?gY(e,xY,mY):void 0}var bY=yY;const ys=Br(bY);function vY(e,t){return e<t}var wY=vY,kY=eC,SY=wY,jY=Lu;function MY(e){return e&&e.length?kY(e,jY,SY):void 0}var _Y=MY;const em=Br(_Y);var PY=Kv,NY=zs,CY=uN,OY=$a;function AY(e,t){var r=OY(e)?PY:CY;return r(e,NY(t))}var TY=AY,EY=lN,IY=TY;function RY(e,t){return EY(IY(e,t),1)}var DY=RY;const $Y=Br(DY);var LY=l2;function BY(e,t){return LY(e,t)}var FY=BY;const Fl=Br(FY);var Fu=1e9,GY={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},D2,tn=!0,mi="[DecimalError] ",jl=mi+"Invalid argument: ",R2=mi+"Exponent out of range: ",Gu=Math.floor,sl=Math.pow,UY=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ka,Un=1e7,Yr=7,tC=9007199254740991,jp=Gu(tC/Yr),Ze={};Ze.absoluteValue=Ze.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e};Ze.comparedTo=Ze.cmp=function(e){var t,r,n,a,i=this;if(e=new i.constructor(e),i.s!==e.s)return i.s||-e.s;if(i.e!==e.e)return i.e>e.e^i.s<0?1:-1;for(n=i.d.length,a=e.d.length,t=0,r=n<a?n:a;t<r;++t)if(i.d[t]!==e.d[t])return i.d[t]>e.d[t]^i.s<0?1:-1;return n===a?0:n>a^i.s<0?1:-1};Ze.decimalPlaces=Ze.dp=function(){var e=this,t=e.d.length-1,r=(t-e.e)*Yr;if(t=e.d[t],t)for(;t%10==0;t/=10)r--;return r<0?0:r};Ze.dividedBy=Ze.div=function(e){return Oo(this,new this.constructor(e))};Ze.dividedToIntegerBy=Ze.idiv=function(e){var t=this,r=t.constructor;return Lr(Oo(t,new r(e),0,1),r.precision)};Ze.equals=Ze.eq=function(e){return!this.cmp(e)};Ze.exponent=function(){return Cn(this)};Ze.greaterThan=Ze.gt=function(e){return this.cmp(e)>0};Ze.greaterThanOrEqualTo=Ze.gte=function(e){return this.cmp(e)>=0};Ze.isInteger=Ze.isint=function(){return this.e>this.d.length-2};Ze.isNegative=Ze.isneg=function(){return this.s<0};Ze.isPositive=Ze.ispos=function(){return this.s>0};Ze.isZero=function(){return this.s===0};Ze.lessThan=Ze.lt=function(e){return this.cmp(e)<0};Ze.lessThanOrEqualTo=Ze.lte=function(e){return this.cmp(e)<1};Ze.logarithm=Ze.log=function(e){var t,r=this,n=r.constructor,a=n.precision,i=a+5;if(e===void 0)e=new n(10);else if(e=new n(e),e.s<1||e.eq(Ka))throw Error(mi+"NaN");if(r.s<1)throw Error(mi+(r.s?"NaN":"-Infinity"));return r.eq(Ka)?new n(0):(tn=!1,t=Oo(wf(r,i),wf(e,i),i),tn=!0,Lr(t,a))};Ze.minus=Ze.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?aC(t,e):rC(t,(e.s=-e.s,e))};Ze.modulo=Ze.mod=function(e){var t,r=this,n=r.constructor,a=n.precision;if(e=new n(e),!e.s)throw Error(mi+"NaN");return r.s?(tn=!1,t=Oo(r,e,0,1).times(e),tn=!0,r.minus(t)):Lr(new n(r),a)};Ze.naturalExponential=Ze.exp=function(){return nC(this)};Ze.naturalLogarithm=Ze.ln=function(){return wf(this)};Ze.negated=Ze.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e};Ze.plus=Ze.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?rC(t,e):aC(t,(e.s=-e.s,e))};Ze.precision=Ze.sd=function(e){var t,r,n,a=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(jl+e);if(t=Cn(a)+1,n=a.d.length-1,r=n*Yr+1,n=a.d[n],n){for(;n%10==0;n/=10)r--;for(n=a.d[0];n>=10;n/=10)r++}return e&&t>r?t:r};Ze.squareRoot=Ze.sqrt=function(){var e,t,r,n,a,i,o,s=this,l=s.constructor;if(s.s<1){if(!s.s)return new l(0);throw Error(mi+"NaN")}for(e=Cn(s),tn=!1,a=Math.sqrt(+s),a==0||a==1/0?(t=Ki(s.d),(t.length+e)%2==0&&(t+="0"),a=Math.sqrt(t),e=Gu((e+1)/2)-(e<0||e%2),a==1/0?t="5e"+e:(t=a.toExponential(),t=t.slice(0,t.indexOf("e")+1)+e),n=new l(t)):n=new l(a.toString()),r=l.precision,a=o=r+3;;)if(i=n,n=i.plus(Oo(s,i,o+2)).times(.5),Ki(i.d).slice(0,o)===(t=Ki(n.d)).slice(0,o)){if(t=t.slice(o-3,o+1),a==o&&t=="4999"){if(Lr(i,r+1,0),i.times(i).eq(s)){n=i;break}}else if(t!="9999")break;o+=4}return tn=!0,Lr(n,r)};Ze.times=Ze.mul=function(e){var t,r,n,a,i,o,s,l,u,d=this,f=d.constructor,h=d.d,p=(e=new f(e)).d;if(!d.s||!e.s)return new f(0);for(e.s*=d.s,r=d.e+e.e,l=h.length,u=p.length,l<u&&(i=h,h=p,p=i,o=l,l=u,u=o),i=[],o=l+u,n=o;n--;)i.push(0);for(n=u;--n>=0;){for(t=0,a=l+n;a>n;)s=i[a]+p[n]*h[a-n-1]+t,i[a--]=s%Un|0,t=s/Un|0;i[a]=(i[a]+t)%Un|0}for(;!i[--o];)i.pop();return t?++r:i.shift(),e.d=i,e.e=r,tn?Lr(e,f.precision):e};Ze.toDecimalPlaces=Ze.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),e===void 0?r:(ao(e,0,Fu),t===void 0?t=n.rounding:ao(t,0,8),Lr(r,e+Cn(r)+1,t))};Ze.toExponential=function(e,t){var r,n=this,a=n.constructor;return e===void 0?r=Gl(n,!0):(ao(e,0,Fu),t===void 0?t=a.rounding:ao(t,0,8),n=Lr(new a(n),e+1,t),r=Gl(n,!0,e+1)),r};Ze.toFixed=function(e,t){var r,n,a=this,i=a.constructor;return e===void 0?Gl(a):(ao(e,0,Fu),t===void 0?t=i.rounding:ao(t,0,8),n=Lr(new i(a),e+Cn(a)+1,t),r=Gl(n.abs(),!1,e+Cn(n)+1),a.isneg()&&!a.isZero()?"-"+r:r)};Ze.toInteger=Ze.toint=function(){var e=this,t=e.constructor;return Lr(new t(e),Cn(e)+1,t.rounding)};Ze.toNumber=function(){return+this};Ze.toPower=Ze.pow=function(e){var t,r,n,a,i,o,s=this,l=s.constructor,u=12,d=+(e=new l(e));if(!e.s)return new l(Ka);if(s=new l(s),!s.s){if(e.s<1)throw Error(mi+"Infinity");return s}if(s.eq(Ka))return s;if(n=l.precision,e.eq(Ka))return Lr(s,n);if(t=e.e,r=e.d.length-1,o=t>=r,i=s.s,o){if((r=d<0?-d:d)<=tC){for(a=new l(Ka),t=Math.ceil(n/Yr+4),tn=!1;r%2&&(a=a.times(s),o5(a.d,t)),r=Gu(r/2),r!==0;)s=s.times(s),o5(s.d,t);return tn=!0,e.s<0?new l(Ka).div(a):Lr(a,n)}}else if(i<0)throw Error(mi+"NaN");return i=i<0&&e.d[Math.max(t,r)]&1?-1:1,s.s=1,tn=!1,a=e.times(wf(s,n+u)),tn=!0,a=nC(a),a.s=i,a};Ze.toPrecision=function(e,t){var r,n,a=this,i=a.constructor;return e===void 0?(r=Cn(a),n=Gl(a,r<=i.toExpNeg||r>=i.toExpPos)):(ao(e,1,Fu),t===void 0?t=i.rounding:ao(t,0,8),a=Lr(new i(a),e,t),r=Cn(a),n=Gl(a,e<=r||r<=i.toExpNeg,e)),n};Ze.toSignificantDigits=Ze.tosd=function(e,t){var r=this,n=r.constructor;return e===void 0?(e=n.precision,t=n.rounding):(ao(e,1,Fu),t===void 0?t=n.rounding:ao(t,0,8)),Lr(new n(r),e,t)};Ze.toString=Ze.valueOf=Ze.val=Ze.toJSON=Ze[Symbol.for("nodejs.util.inspect.custom")]=function(){var e=this,t=Cn(e),r=e.constructor;return Gl(e,t<=r.toExpNeg||t>=r.toExpPos)};function rC(e,t){var r,n,a,i,o,s,l,u,d=e.constructor,f=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),tn?Lr(t,f):t;if(l=e.d,u=t.d,o=e.e,a=t.e,l=l.slice(),i=o-a,i){for(i<0?(n=l,i=-i,s=u.length):(n=u,a=o,s=l.length),o=Math.ceil(f/Yr),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=l.length,i=u.length,s-i<0&&(i=s,n=u,u=l,l=n),r=0;i;)r=(l[--i]=l[i]+u[i]+r)/Un|0,l[i]%=Un;for(r&&(l.unshift(r),++a),s=l.length;l[--s]==0;)l.pop();return t.d=l,t.e=a,tn?Lr(t,f):t}function ao(e,t,r){if(e!==~~e||e<t||e>r)throw Error(jl+e)}function Ki(e){var t,r,n,a=e.length-1,i="",o=e[0];if(a>0){for(i+=o,t=1;t<a;t++)n=e[t]+"",r=Yr-n.length,r&&(i+=os(r)),i+=n;o=e[t],n=o+"",r=Yr-n.length,r&&(i+=os(r))}else if(o===0)return"0";for(;o%10===0;)o/=10;return i+o}var Oo=function(){function e(n,a){var i,o=0,s=n.length;for(n=n.slice();s--;)i=n[s]*a+o,n[s]=i%Un|0,o=i/Un|0;return o&&n.unshift(o),n}function t(n,a,i,o){var s,l;if(i!=o)l=i>o?1:-1;else for(s=l=0;s<i;s++)if(n[s]!=a[s]){l=n[s]>a[s]?1:-1;break}return l}function r(n,a,i){for(var o=0;i--;)n[i]-=o,o=n[i]<a[i]?1:0,n[i]=o*Un+n[i]-a[i];for(;!n[0]&&n.length>1;)n.shift()}return function(n,a,i,o){var s,l,u,d,f,h,p,x,b,y,m,g,k,S,w,v,M,_,P=n.constructor,A=n.s==a.s?1:-1,R=n.d,D=a.d;if(!n.s)return new P(n);if(!a.s)throw Error(mi+"Division by zero");for(l=n.e-a.e,M=D.length,w=R.length,p=new P(A),x=p.d=[],u=0;D[u]==(R[u]||0);)++u;if(D[u]>(R[u]||0)&&--l,i==null?g=i=P.precision:o?g=i+(Cn(n)-Cn(a))+1:g=i,g<0)return new P(0);if(g=g/Yr+2|0,u=0,M==1)for(d=0,D=D[0],g++;(u<w||d)&&g--;u++)k=d*Un+(R[u]||0),x[u]=k/D|0,d=k%D|0;else{for(d=Un/(D[0]+1)|0,d>1&&(D=e(D,d),R=e(R,d),M=D.length,w=R.length),S=M,b=R.slice(0,M),y=b.length;y<M;)b[y++]=0;_=D.slice(),_.unshift(0),v=D[0],D[1]>=Un/2&&++v;do d=0,s=t(D,b,M,y),s<0?(m=b[0],M!=y&&(m=m*Un+(b[1]||0)),d=m/v|0,d>1?(d>=Un&&(d=Un-1),f=e(D,d),h=f.length,y=b.length,s=t(f,b,h,y),s==1&&(d--,r(f,M<h?_:D,h))):(d==0&&(s=d=1),f=D.slice()),h=f.length,h<y&&f.unshift(0),r(b,f,y),s==-1&&(y=b.length,s=t(D,b,M,y),s<1&&(d++,r(b,M<y?_:D,y))),y=b.length):s===0&&(d++,b=[0]),x[u++]=d,s&&b[0]?b[y++]=R[S]||0:(b=[R[S]],y=1);while((S++<w||b[0]!==void 0)&&g--)}return x[0]||x.shift(),p.e=l,Lr(p,o?i+Cn(p)+1:i)}}();function nC(e,t){var r,n,a,i,o,s,l=0,u=0,d=e.constructor,f=d.precision;if(Cn(e)>16)throw Error(R2+Cn(e));if(!e.s)return new d(Ka);for(tn=!1,s=f,o=new d(.03125);e.abs().gte(.1);)e=e.times(o),u+=5;for(n=Math.log(sl(2,u))/Math.LN10*2+5|0,s+=n,r=a=i=new d(Ka),d.precision=s;;){if(a=Lr(a.times(e),s),r=r.times(++l),o=i.plus(Oo(a,r,s)),Ki(o.d).slice(0,s)===Ki(i.d).slice(0,s)){for(;u--;)i=Lr(i.times(i),s);return d.precision=f,t==null?(tn=!0,Lr(i,f)):i}i=o}}function Cn(e){for(var t=e.e*Yr,r=e.d[0];r>=10;r/=10)t++;return t}function Ix(e,t,r){if(t>e.LN10.sd())throw tn=!0,r&&(e.precision=r),Error(mi+"LN10 precision limit exceeded");return Lr(new e(e.LN10),t)}function os(e){for(var t="";e--;)t+="0";return t}function wf(e,t){var r,n,a,i,o,s,l,u,d,f=1,h=10,p=e,x=p.d,b=p.constructor,y=b.precision;if(p.s<1)throw Error(mi+(p.s?"NaN":"-Infinity"));if(p.eq(Ka))return new b(0);if(t==null?(tn=!1,u=y):u=t,p.eq(10))return t==null&&(tn=!0),Ix(b,u);if(u+=h,b.precision=u,r=Ki(x),n=r.charAt(0),i=Cn(p),Math.abs(i)<15e14){for(;n<7&&n!=1||n==1&&r.charAt(1)>3;)p=p.times(e),r=Ki(p.d),n=r.charAt(0),f++;i=Cn(p),n>1?(p=new b("0."+r),i++):p=new b(n+"."+r.slice(1))}else return l=Ix(b,u+2,y).times(i+""),p=wf(new b(n+"."+r.slice(1)),u-h).plus(l),b.precision=y,t==null?(tn=!0,Lr(p,y)):p;for(s=o=p=Oo(p.minus(Ka),p.plus(Ka),u),d=Lr(p.times(p),u),a=3;;){if(o=Lr(o.times(d),u),l=s.plus(Oo(o,new b(a),u)),Ki(l.d).slice(0,u)===Ki(s.d).slice(0,u))return s=s.times(2),i!==0&&(s=s.plus(Ix(b,u+2,y).times(i+""))),s=Oo(s,new b(f),u),b.precision=y,t==null?(tn=!0,Lr(s,y)):s;s=l,a+=2}}function i5(e,t){var r,n,a;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;t.charCodeAt(n)===48;)++n;for(a=t.length;t.charCodeAt(a-1)===48;)--a;if(t=t.slice(n,a),t){if(a-=n,r=r-n-1,e.e=Gu(r/Yr),e.d=[],n=(r+1)%Yr,r<0&&(n+=Yr),n<a){for(n&&e.d.push(+t.slice(0,n)),a-=Yr;n<a;)e.d.push(+t.slice(n,n+=Yr));t=t.slice(n),n=Yr-t.length}else n-=a;for(;n--;)t+="0";if(e.d.push(+t),tn&&(e.e>jp||e.e<-jp))throw Error(R2+r)}else e.s=0,e.e=0,e.d=[0];return e}function Lr(e,t,r){var n,a,i,o,s,l,u,d,f=e.d;for(o=1,i=f[0];i>=10;i/=10)o++;if(n=t-o,n<0)n+=Yr,a=t,u=f[d=0];else{if(d=Math.ceil((n+1)/Yr),i=f.length,d>=i)return e;for(u=i=f[d],o=1;i>=10;i/=10)o++;n%=Yr,a=n-Yr+o}if(r!==void 0&&(i=sl(10,o-a-1),s=u/i%10|0,l=t<0||f[d+1]!==void 0||u%i,l=r<4?(s||l)&&(r==0||r==(e.s<0?3:2)):s>5||s==5&&(r==4||l||r==6&&(n>0?a>0?u/sl(10,o-a):0:f[d-1])%10&1||r==(e.s<0?8:7))),t<1||!f[0])return l?(i=Cn(e),f.length=1,t=t-i-1,f[0]=sl(10,(Yr-t%Yr)%Yr),e.e=Gu(-t/Yr)||0):(f.length=1,f[0]=e.e=e.s=0),e;if(n==0?(f.length=d,i=1,d--):(f.length=d+1,i=sl(10,Yr-n),f[d]=a>0?(u/sl(10,o-a)%sl(10,a)|0)*i:0),l)for(;;)if(d==0){(f[0]+=i)==Un&&(f[0]=1,++e.e);break}else{if(f[d]+=i,f[d]!=Un)break;f[d--]=0,i=1}for(n=f.length;f[--n]===0;)f.pop();if(tn&&(e.e>jp||e.e<-jp))throw Error(R2+Cn(e));return e}function aC(e,t){var r,n,a,i,o,s,l,u,d,f,h=e.constructor,p=h.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new h(e),tn?Lr(t,p):t;if(l=e.d,f=t.d,n=t.e,u=e.e,l=l.slice(),o=u-n,o){for(d=o<0,d?(r=l,o=-o,s=f.length):(r=f,n=u,s=l.length),a=Math.max(Math.ceil(p/Yr),s)+2,o>a&&(o=a,r.length=1),r.reverse(),a=o;a--;)r.push(0);r.reverse()}else{for(a=l.length,s=f.length,d=a<s,d&&(s=a),a=0;a<s;a++)if(l[a]!=f[a]){d=l[a]<f[a];break}o=0}for(d&&(r=l,l=f,f=r,t.s=-t.s),s=l.length,a=f.length-s;a>0;--a)l[s++]=0;for(a=f.length;a>o;){if(l[--a]<f[a]){for(i=a;i&&l[--i]===0;)l[i]=Un-1;--l[i],l[a]+=Un}l[a]-=f[a]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--n;return l[0]?(t.d=l,t.e=n,tn?Lr(t,p):t):new h(0)}function Gl(e,t,r){var n,a=Cn(e),i=Ki(e.d),o=i.length;return t?(r&&(n=r-o)>0?i=i.charAt(0)+"."+i.slice(1)+os(n):o>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(a<0?"e":"e+")+a):a<0?(i="0."+os(-a-1)+i,r&&(n=r-o)>0&&(i+=os(n))):a>=o?(i+=os(a+1-o),r&&(n=r-a-1)>0&&(i=i+"."+os(n))):((n=a+1)<o&&(i=i.slice(0,n)+"."+i.slice(n)),r&&(n=r-o)>0&&(a+1===o&&(i+="."),i+=os(n))),e.s<0?"-"+i:i}function o5(e,t){if(e.length>t)return e.length=t,!0}function iC(e){var t,r,n;function a(i){var o=this;if(!(o instanceof a))return new a(i);if(o.constructor=a,i instanceof a){o.s=i.s,o.e=i.e,o.d=(i=i.d)?i.slice():i;return}if(typeof i=="number"){if(i*0!==0)throw Error(jl+i);if(i>0)o.s=1;else if(i<0)i=-i,o.s=-1;else{o.s=0,o.e=0,o.d=[0];return}if(i===~~i&&i<1e7){o.e=0,o.d=[i];return}return i5(o,i.toString())}else if(typeof i!="string")throw Error(jl+i);if(i.charCodeAt(0)===45?(i=i.slice(1),o.s=-1):o.s=1,UY.test(i))i5(o,i);else throw Error(jl+i)}if(a.prototype=Ze,a.ROUND_UP=0,a.ROUND_DOWN=1,a.ROUND_CEIL=2,a.ROUND_FLOOR=3,a.ROUND_HALF_UP=4,a.ROUND_HALF_DOWN=5,a.ROUND_HALF_EVEN=6,a.ROUND_HALF_CEIL=7,a.ROUND_HALF_FLOOR=8,a.clone=iC,a.config=a.set=zY,e===void 0&&(e={}),e)for(n=["precision","rounding","toExpNeg","toExpPos","LN10"],t=0;t<n.length;)e.hasOwnProperty(r=n[t++])||(e[r]=this[r]);return a.config(e),a}function zY(e){if(!e||typeof e!="object")throw Error(mi+"Object expected");var t,r,n,a=["precision",1,Fu,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<a.length;t+=3)if((n=e[r=a[t]])!==void 0)if(Gu(n)===n&&n>=a[t+1]&&n<=a[t+2])this[r]=n;else throw Error(jl+r+": "+n);if((n=e[r="LN10"])!==void 0)if(n==Math.LN10)this[r]=new this(n);else throw Error(jl+r+": "+n);return this}var D2=iC(GY);Ka=new D2(1);const Dr=D2;function WY(e){return KY(e)||XY(e)||HY(e)||VY()}function VY(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function HY(e,t){if(e){if(typeof e=="string")return R1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R1(e,t)}}function XY(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function KY(e){if(Array.isArray(e))return R1(e)}function R1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var YY=function(t){return t},oC={},sC=function(t){return t===oC},s5=function(t){return function r(){return arguments.length===0||arguments.length===1&&sC(arguments.length<=0?void 0:arguments[0])?r:t.apply(void 0,arguments)}},qY=function e(t,r){return t===1?r:s5(function(){for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];var o=a.filter(function(s){return s!==oC}).length;return o>=t?r.apply(void 0,a):e(t-o,s5(function(){for(var s=arguments.length,l=new Array(s),u=0;u<s;u++)l[u]=arguments[u];var d=a.map(function(f){return sC(f)?l.shift():f});return r.apply(void 0,WY(d).concat(l))}))})},tm=function(t){return qY(t.length,t)},D1=function(t,r){for(var n=[],a=t;a<r;++a)n[a-t]=a;return n},ZY=tm(function(e,t){return Array.isArray(t)?t.map(e):Object.keys(t).map(function(r){return t[r]}).map(e)}),JY=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(!r.length)return YY;var a=r.reverse(),i=a[0],o=a.slice(1);return function(){return o.reduce(function(s,l){return l(s)},i.apply(void 0,arguments))}},$1=function(t){return Array.isArray(t)?t.reverse():t.split("").reverse.join("")},lC=function(t){var r=null,n=null;return function(){for(var a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];return r&&i.every(function(s,l){return s===r[l]})||(r=i,n=t.apply(void 0,i)),n}};function QY(e){var t;return e===0?t=1:t=Math.floor(new Dr(e).abs().log(10).toNumber())+1,t}function eq(e,t,r){for(var n=new Dr(e),a=0,i=[];n.lt(t)&&a<1e5;)i.push(n.toNumber()),n=n.add(r),a++;return i}var tq=tm(function(e,t,r){var n=+e,a=+t;return n+r*(a-n)}),rq=tm(function(e,t,r){var n=t-+e;return n=n||1/0,(r-e)/n}),nq=tm(function(e,t,r){var n=t-+e;return n=n||1/0,Math.max(0,Math.min(1,(r-e)/n))});const rm={rangeStep:eq,getDigitCount:QY,interpolateNumber:tq,uninterpolateNumber:rq,uninterpolateTruncation:nq};function L1(e){return oq(e)||iq(e)||cC(e)||aq()}function aq(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function iq(e){if(typeof Symbol<"u"&&Symbol.iterator in Object(e))return Array.from(e)}function oq(e){if(Array.isArray(e))return B1(e)}function kf(e,t){return cq(e)||lq(e,t)||cC(e,t)||sq()}function sq(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cC(e,t){if(e){if(typeof e=="string")return B1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return B1(e,t)}}function B1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function lq(e,t){if(!(typeof Symbol>"u"||!(Symbol.iterator in Object(e)))){var r=[],n=!0,a=!1,i=void 0;try{for(var o=e[Symbol.iterator](),s;!(n=(s=o.next()).done)&&(r.push(s.value),!(t&&r.length===t));n=!0);}catch(l){a=!0,i=l}finally{try{!n&&o.return!=null&&o.return()}finally{if(a)throw i}}return r}}function cq(e){if(Array.isArray(e))return e}function uC(e){var t=kf(e,2),r=t[0],n=t[1],a=r,i=n;return r>n&&(a=n,i=r),[a,i]}function dC(e,t,r){if(e.lte(0))return new Dr(0);var n=rm.getDigitCount(e.toNumber()),a=new Dr(10).pow(n),i=e.div(a),o=n!==1?.05:.1,s=new Dr(Math.ceil(i.div(o).toNumber())).add(r).mul(o),l=s.mul(a);return t?l:new Dr(Math.ceil(l))}function uq(e,t,r){var n=1,a=new Dr(e);if(!a.isint()&&r){var i=Math.abs(e);i<1?(n=new Dr(10).pow(rm.getDigitCount(e)-1),a=new Dr(Math.floor(a.div(n).toNumber())).mul(n)):i>1&&(a=new Dr(Math.floor(e)))}else e===0?a=new Dr(Math.floor((t-1)/2)):r||(a=new Dr(Math.floor(e)));var o=Math.floor((t-1)/2),s=JY(ZY(function(l){return a.add(new Dr(l-o).mul(n)).toNumber()}),D1);return s(0,t)}function fC(e,t,r,n){var a=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new Dr(0),tickMin:new Dr(0),tickMax:new Dr(0)};var i=dC(new Dr(t).sub(e).div(r-1),n,a),o;e<=0&&t>=0?o=new Dr(0):(o=new Dr(e).add(t).div(2),o=o.sub(new Dr(o).mod(i)));var s=Math.ceil(o.sub(e).div(i).toNumber()),l=Math.ceil(new Dr(t).sub(o).div(i).toNumber()),u=s+l+1;return u>r?fC(e,t,r,n,a+1):(u<r&&(l=t>0?l+(r-u):l,s=t>0?s:s+(r-u)),{step:i,tickMin:o.sub(new Dr(s).mul(i)),tickMax:o.add(new Dr(l).mul(i))})}function dq(e){var t=kf(e,2),r=t[0],n=t[1],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=Math.max(a,2),s=uC([r,n]),l=kf(s,2),u=l[0],d=l[1];if(u===-1/0||d===1/0){var f=d===1/0?[u].concat(L1(D1(0,a-1).map(function(){return 1/0}))):[].concat(L1(D1(0,a-1).map(function(){return-1/0})),[d]);return r>n?$1(f):f}if(u===d)return uq(u,a,i);var h=fC(u,d,o,i),p=h.step,x=h.tickMin,b=h.tickMax,y=rm.rangeStep(x,b.add(new Dr(.1).mul(p)),p);return r>n?$1(y):y}function fq(e,t){var r=kf(e,2),n=r[0],a=r[1],i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,o=uC([n,a]),s=kf(o,2),l=s[0],u=s[1];if(l===-1/0||u===1/0)return[n,a];if(l===u)return[l];var d=Math.max(t,2),f=dC(new Dr(u).sub(l).div(d-1),i,0),h=[].concat(L1(rm.rangeStep(new Dr(l),new Dr(u).sub(new Dr(.99).mul(f)),f)),[u]);return n>a?$1(h):h}var hq=lC(dq),pq=lC(fq),gq="Invariant failed";function Ul(e,t){throw new Error(gq)}var mq=["offset","layout","width","dataKey","data","dataPointFormatter","xAxis","yAxis"];function ou(e){"@babel/helpers - typeof";return ou=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ou(e)}function Mp(){return Mp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Mp.apply(this,arguments)}function xq(e,t){return wq(e)||vq(e,t)||bq(e,t)||yq()}function yq(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function bq(e,t){if(e){if(typeof e=="string")return l5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return l5(e,t)}}function l5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vq(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function wq(e){if(Array.isArray(e))return e}function kq(e,t){if(e==null)return{};var r=Sq(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Sq(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function jq(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Mq(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gC(n.key),n)}}function _q(e,t,r){return t&&Mq(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Pq(e,t,r){return t=_p(t),Nq(e,hC()?Reflect.construct(t,r||[],_p(e).constructor):t.apply(e,r))}function Nq(e,t){if(t&&(ou(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Cq(e)}function Cq(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function hC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(hC=function(){return!!e})()}function _p(e){return _p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},_p(e)}function Oq(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F1(e,t)}function F1(e,t){return F1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},F1(e,t)}function pC(e,t,r){return t=gC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function gC(e){var t=Aq(e,"string");return ou(t)=="symbol"?t:t+""}function Aq(e,t){if(ou(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ou(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Uu=function(e){function t(){return jq(this,t),Pq(this,t,arguments)}return Oq(t,e),_q(t,[{key:"render",value:function(){var n=this.props,a=n.offset,i=n.layout,o=n.width,s=n.dataKey,l=n.data,u=n.dataPointFormatter,d=n.xAxis,f=n.yAxis,h=kq(n,mq),p=Dt(h,!1);this.props.direction==="x"&&d.type!=="number"&&Ul();var x=l.map(function(b){var y=u(b,s),m=y.x,g=y.y,k=y.value,S=y.errorVal;if(!S)return null;var w=[],v,M;if(Array.isArray(S)){var _=xq(S,2);v=_[0],M=_[1]}else v=M=S;if(i==="vertical"){var P=d.scale,A=g+a,R=A+o,D=A-o,E=P(k-v),W=P(k+M);w.push({x1:W,y1:R,x2:W,y2:D}),w.push({x1:E,y1:A,x2:W,y2:A}),w.push({x1:E,y1:R,x2:E,y2:D})}else if(i==="horizontal"){var F=f.scale,O=m+a,$=O-o,N=O+o,C=F(k-v),B=F(k+M);w.push({x1:$,y1:B,x2:N,y2:B}),w.push({x1:O,y1:C,x2:O,y2:B}),w.push({x1:$,y1:C,x2:N,y2:C})}return re.createElement(_r,Mp({className:"recharts-errorBar",key:"bar-".concat(w.map(function(I){return"".concat(I.x1,"-").concat(I.x2,"-").concat(I.y1,"-").concat(I.y2)}))},p),w.map(function(I){return re.createElement("line",Mp({},I,{key:"line-".concat(I.x1,"-").concat(I.x2,"-").concat(I.y1,"-").concat(I.y2)}))}))});return re.createElement(_r,{className:"recharts-errorBars"},x)}}])}(re.Component);pC(Uu,"defaultProps",{stroke:"black",strokeWidth:1.5,width:5,offset:0,layout:"horizontal"});pC(Uu,"displayName","ErrorBar");function Sf(e){"@babel/helpers - typeof";return Sf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sf(e)}function c5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function rl(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?c5(Object(r),!0).forEach(function(n){Tq(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Tq(e,t,r){return t=Eq(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Eq(e){var t=Iq(e,"string");return Sf(t)=="symbol"?t:t+""}function Iq(e,t){if(Sf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Sf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var mC=function(t){var r=t.children,n=t.formattedGraphicalItems,a=t.legendWidth,i=t.legendContent,o=Va(r,Qi);if(!o)return null;var s=Qi.defaultProps,l=s!==void 0?rl(rl({},s),o.props):{},u;return o.props&&o.props.payload?u=o.props&&o.props.payload:i==="children"?u=(n||[]).reduce(function(d,f){var h=f.item,p=f.props,x=p.sectors||p.data||[];return d.concat(x.map(function(b){return{type:o.props.iconType||h.props.legendType,value:b.name,color:b.fill,payload:b}}))},[]):u=(n||[]).map(function(d){var f=d.item,h=f.type.defaultProps,p=h!==void 0?rl(rl({},h),f.props):{},x=p.dataKey,b=p.name,y=p.legendType,m=p.hide;return{inactive:m,dataKey:x,type:l.iconType||y||"square",color:$2(f),value:b||x,payload:p}}),rl(rl(rl({},l),Qi.getWithHeight(o,a)),{},{payload:u,item:o})};function jf(e){"@babel/helpers - typeof";return jf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jf(e)}function u5(e){return Lq(e)||$q(e)||Dq(e)||Rq()}function Rq(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Dq(e,t){if(e){if(typeof e=="string")return G1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return G1(e,t)}}function $q(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Lq(e){if(Array.isArray(e))return G1(e)}function G1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function d5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function pn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?d5(Object(r),!0).forEach(function(n){Fc(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):d5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fc(e,t,r){return t=Bq(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bq(e){var t=Fq(e,"string");return jf(t)=="symbol"?t:t+""}function Fq(e,t){if(jf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(jf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Bn(e,t,r){return Et(e)||Et(t)?r:Ln(t)?hi(e,t,r):Bt(t)?t(e):r}function Ld(e,t,r,n){var a=$Y(e,function(s){return Bn(s,t)});if(r==="number"){var i=a.filter(function(s){return Re(s)||parseFloat(s)});return i.length?[em(i),ys(i)]:[1/0,-1/0]}var o=n?a.filter(function(s){return!Et(s)}):a;return o.map(function(s){return Ln(s)||s instanceof Date?s:""})}var Gq=function(t){var r,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0,o=-1,s=(r=n==null?void 0:n.length)!==null&&r!==void 0?r:0;if(s<=1)return 0;if(i&&i.axisType==="angleAxis"&&Math.abs(Math.abs(i.range[1]-i.range[0])-360)<=1e-6)for(var l=i.range,u=0;u<s;u++){var d=u>0?a[u-1].coordinate:a[s-1].coordinate,f=a[u].coordinate,h=u>=s-1?a[0].coordinate:a[u+1].coordinate,p=void 0;if(Ti(f-d)!==Ti(h-f)){var x=[];if(Ti(h-f)===Ti(l[1]-l[0])){p=h;var b=f+l[1]-l[0];x[0]=Math.min(b,(b+d)/2),x[1]=Math.max(b,(b+d)/2)}else{p=d;var y=h+l[1]-l[0];x[0]=Math.min(f,(y+f)/2),x[1]=Math.max(f,(y+f)/2)}var m=[Math.min(f,(p+f)/2),Math.max(f,(p+f)/2)];if(t>m[0]&&t<=m[1]||t>=x[0]&&t<=x[1]){o=a[u].index;break}}else{var g=Math.min(d,h),k=Math.max(d,h);if(t>(g+f)/2&&t<=(k+f)/2){o=a[u].index;break}}}else for(var S=0;S<s;S++)if(S===0&&t<=(n[S].coordinate+n[S+1].coordinate)/2||S>0&&S<s-1&&t>(n[S].coordinate+n[S-1].coordinate)/2&&t<=(n[S].coordinate+n[S+1].coordinate)/2||S===s-1&&t>(n[S].coordinate+n[S-1].coordinate)/2){o=n[S].index;break}return o},$2=function(t){var r,n=t,a=n.type.displayName,i=(r=t.type)!==null&&r!==void 0&&r.defaultProps?pn(pn({},t.type.defaultProps),t.props):t.props,o=i.stroke,s=i.fill,l;switch(a){case"Line":l=o;break;case"Area":case"Radar":l=o&&o!=="none"?o:s;break;default:l=s;break}return l},Uq=function(t){var r=t.barSize,n=t.totalSize,a=t.stackGroups,i=a===void 0?{}:a;if(!i)return{};for(var o={},s=Object.keys(i),l=0,u=s.length;l<u;l++)for(var d=i[s[l]].stackGroups,f=Object.keys(d),h=0,p=f.length;h<p;h++){var x=d[f[h]],b=x.items,y=x.cateAxisId,m=b.filter(function(M){return No(M.type).indexOf("Bar")>=0});if(m&&m.length){var g=m[0].type.defaultProps,k=g!==void 0?pn(pn({},g),m[0].props):m[0].props,S=k.barSize,w=k[y];o[w]||(o[w]=[]);var v=Et(S)?r:S;o[w].push({item:m[0],stackList:m.slice(1),barSize:Et(v)?void 0:Bl(v,n,0)})}}return o},zq=function(t){var r=t.barGap,n=t.barCategoryGap,a=t.bandSize,i=t.sizeList,o=i===void 0?[]:i,s=t.maxBarSize,l=o.length;if(l<1)return null;var u=Bl(r,a,0,!0),d,f=[];if(o[0].barSize===+o[0].barSize){var h=!1,p=a/l,x=o.reduce(function(S,w){return S+w.barSize||0},0);x+=(l-1)*u,x>=a&&(x-=(l-1)*u,u=0),x>=a&&p>0&&(h=!0,p*=.9,x=l*p);var b=(a-x)/2>>0,y={offset:b-u,size:0};d=o.reduce(function(S,w){var v={item:w.item,position:{offset:y.offset+y.size+u,size:h?p:w.barSize}},M=[].concat(u5(S),[v]);return y=M[M.length-1].position,w.stackList&&w.stackList.length&&w.stackList.forEach(function(_){M.push({item:_,position:y})}),M},f)}else{var m=Bl(n,a,0,!0);a-2*m-(l-1)*u<=0&&(u=0);var g=(a-2*m-(l-1)*u)/l;g>1&&(g>>=0);var k=s===+s?Math.min(g,s):g;d=o.reduce(function(S,w,v){var M=[].concat(u5(S),[{item:w.item,position:{offset:m+(g+u)*v+(g-k)/2,size:k}}]);return w.stackList&&w.stackList.length&&w.stackList.forEach(function(_){M.push({item:_,position:M[M.length-1].position})}),M},f)}return d},Wq=function(t,r,n,a){var i=n.children,o=n.width,s=n.margin,l=o-(s.left||0)-(s.right||0),u=mC({children:i,legendWidth:l});if(u){var d=a||{},f=d.width,h=d.height,p=u.align,x=u.verticalAlign,b=u.layout;if((b==="vertical"||b==="horizontal"&&x==="middle")&&p!=="center"&&Re(t[p]))return pn(pn({},t),{},Fc({},p,t[p]+(f||0)));if((b==="horizontal"||b==="vertical"&&p==="center")&&x!=="middle"&&Re(t[x]))return pn(pn({},t),{},Fc({},x,t[x]+(h||0)))}return t},Vq=function(t,r,n){return Et(r)?!0:t==="horizontal"?r==="yAxis":t==="vertical"||n==="x"?r==="xAxis":n==="y"?r==="yAxis":!0},xC=function(t,r,n,a,i){var o=r.props.children,s=Da(o,Uu).filter(function(u){return Vq(a,i,u.props.direction)});if(s&&s.length){var l=s.map(function(u){return u.props.dataKey});return t.reduce(function(u,d){var f=Bn(d,n);if(Et(f))return u;var h=Array.isArray(f)?[em(f),ys(f)]:[f,f],p=l.reduce(function(x,b){var y=Bn(d,b,0),m=h[0]-Math.abs(Array.isArray(y)?y[0]:y),g=h[1]+Math.abs(Array.isArray(y)?y[1]:y);return[Math.min(m,x[0]),Math.max(g,x[1])]},[1/0,-1/0]);return[Math.min(p[0],u[0]),Math.max(p[1],u[1])]},[1/0,-1/0])}return null},Hq=function(t,r,n,a,i){var o=r.map(function(s){return xC(t,s,n,i,a)}).filter(function(s){return!Et(s)});return o&&o.length?o.reduce(function(s,l){return[Math.min(s[0],l[0]),Math.max(s[1],l[1])]},[1/0,-1/0]):null},yC=function(t,r,n,a,i){var o=r.map(function(l){var u=l.props.dataKey;return n==="number"&&u&&xC(t,l,u,a)||Ld(t,u,n,i)});if(n==="number")return o.reduce(function(l,u){return[Math.min(l[0],u[0]),Math.max(l[1],u[1])]},[1/0,-1/0]);var s={};return o.reduce(function(l,u){for(var d=0,f=u.length;d<f;d++)s[u[d]]||(s[u[d]]=!0,l.push(u[d]));return l},[])},bC=function(t,r){return t==="horizontal"&&r==="xAxis"||t==="vertical"&&r==="yAxis"||t==="centric"&&r==="angleAxis"||t==="radial"&&r==="radiusAxis"},vC=function(t,r,n,a){if(a)return t.map(function(l){return l.coordinate});var i,o,s=t.map(function(l){return l.coordinate===r&&(i=!0),l.coordinate===n&&(o=!0),l.coordinate});return i||s.push(r),o||s.push(n),s},_o=function(t,r,n){if(!t)return null;var a=t.scale,i=t.duplicateDomain,o=t.type,s=t.range,l=t.realScaleType==="scaleBand"?a.bandwidth()/2:2,u=(r||n)&&o==="category"&&a.bandwidth?a.bandwidth()/l:0;if(u=t.axisType==="angleAxis"&&(s==null?void 0:s.length)>=2?Ti(s[0]-s[1])*2*u:u,r&&(t.ticks||t.niceTicks)){var d=(t.ticks||t.niceTicks).map(function(f){var h=i?i.indexOf(f):f;return{coordinate:a(h)+u,value:f,offset:u}});return d.filter(function(f){return!Ru(f.coordinate)})}return t.isCategorical&&t.categoricalDomain?t.categoricalDomain.map(function(f,h){return{coordinate:a(f)+u,value:f,index:h,offset:u}}):a.ticks&&!n?a.ticks(t.tickCount).map(function(f){return{coordinate:a(f)+u,value:f,offset:u}}):a.domain().map(function(f,h){return{coordinate:a(f)+u,value:i?i[f]:f,index:h,offset:u}})},Rx=new WeakMap,Y0=function(t,r){if(typeof r!="function")return t;Rx.has(t)||Rx.set(t,new WeakMap);var n=Rx.get(t);if(n.has(r))return n.get(r);var a=function(){t.apply(void 0,arguments),r.apply(void 0,arguments)};return n.set(r,a),a},Xq=function(t,r,n){var a=t.scale,i=t.type,o=t.layout,s=t.axisType;if(a==="auto")return o==="radial"&&s==="radiusAxis"?{scale:mf(),realScaleType:"band"}:o==="radial"&&s==="angleAxis"?{scale:vp(),realScaleType:"linear"}:i==="category"&&r&&(r.indexOf("LineChart")>=0||r.indexOf("AreaChart")>=0||r.indexOf("ComposedChart")>=0&&!n)?{scale:$d(),realScaleType:"point"}:i==="category"?{scale:mf(),realScaleType:"band"}:{scale:vp(),realScaleType:"linear"};if(Ll(a)){var l="scale".concat(Fg(a));return{scale:(a5[l]||$d)(),realScaleType:a5[l]?l:"point"}}return Bt(a)?{scale:a}:{scale:$d(),realScaleType:"point"}},f5=1e-4,Kq=function(t){var r=t.domain();if(!(!r||r.length<=2)){var n=r.length,a=t.range(),i=Math.min(a[0],a[1])-f5,o=Math.max(a[0],a[1])+f5,s=t(r[0]),l=t(r[n-1]);(s<i||s>o||l<i||l>o)&&t.domain([r[0],r[n-1]])}},Yq=function(t,r){if(!t)return null;for(var n=0,a=t.length;n<a;n++)if(t[n].item===r)return t[n].position;return null},qq=function(t,r){if(!r||r.length!==2||!Re(r[0])||!Re(r[1]))return t;var n=Math.min(r[0],r[1]),a=Math.max(r[0],r[1]),i=[t[0],t[1]];return(!Re(t[0])||t[0]<n)&&(i[0]=n),(!Re(t[1])||t[1]>a)&&(i[1]=a),i[0]>a&&(i[0]=a),i[1]<n&&(i[1]=n),i},Zq=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var i=0,o=0,s=0;s<r;++s){var l=Ru(t[s][n][1])?t[s][n][0]:t[s][n][1];l>=0?(t[s][n][0]=i,t[s][n][1]=i+l,i=t[s][n][1]):(t[s][n][0]=o,t[s][n][1]=o+l,o=t[s][n][1])}},Jq=function(t){var r=t.length;if(!(r<=0))for(var n=0,a=t[0].length;n<a;++n)for(var i=0,o=0;o<r;++o){var s=Ru(t[o][n][1])?t[o][n][0]:t[o][n][1];s>=0?(t[o][n][0]=i,t[o][n][1]=i+s,i=t[o][n][1]):(t[o][n][0]=0,t[o][n][1]=0)}},Qq={sign:Zq,expand:p9,none:Jc,silhouette:g9,wiggle:m9,positive:Jq},eZ=function(t,r,n){var a=r.map(function(s){return s.props.dataKey}),i=Qq[n],o=h9().keys(a).value(function(s,l){return+Bn(s,l,0)}).order(f1).offset(i);return o(t)},tZ=function(t,r,n,a,i,o){if(!t)return null;var s=o?r.reverse():r,l={},u=s.reduce(function(f,h){var p,x=(p=h.type)!==null&&p!==void 0&&p.defaultProps?pn(pn({},h.type.defaultProps),h.props):h.props,b=x.stackId,y=x.hide;if(y)return f;var m=x[n],g=f[m]||{hasStack:!1,stackGroups:{}};if(Ln(b)){var k=g.stackGroups[b]||{numericAxisId:n,cateAxisId:a,items:[]};k.items.push(h),g.hasStack=!0,g.stackGroups[b]=k}else g.stackGroups[Kl("_stackId_")]={numericAxisId:n,cateAxisId:a,items:[h]};return pn(pn({},f),{},Fc({},m,g))},l),d={};return Object.keys(u).reduce(function(f,h){var p=u[h];if(p.hasStack){var x={};p.stackGroups=Object.keys(p.stackGroups).reduce(function(b,y){var m=p.stackGroups[y];return pn(pn({},b),{},Fc({},y,{numericAxisId:n,cateAxisId:a,items:m.items,stackedData:eZ(t,m.items,i)}))},x)}return pn(pn({},f),{},Fc({},h,p))},d)},rZ=function(t,r){var n=r.realScaleType,a=r.type,i=r.tickCount,o=r.originalDomain,s=r.allowDecimals,l=n||r.scale;if(l!=="auto"&&l!=="linear")return null;if(i&&a==="number"&&o&&(o[0]==="auto"||o[1]==="auto")){var u=t.domain();if(!u.length)return null;var d=hq(u,i,s);return t.domain([em(d),ys(d)]),{niceTicks:d}}if(i&&a==="number"){var f=t.domain(),h=pq(f,i,s);return{niceTicks:h}}return null};function su(e){var t=e.axis,r=e.ticks,n=e.bandSize,a=e.entry,i=e.index,o=e.dataKey;if(t.type==="category"){if(!t.allowDuplicatedCategory&&t.dataKey&&!Et(a[t.dataKey])){var s=Zh(r,"value",a[t.dataKey]);if(s)return s.coordinate+n/2}return r[i]?r[i].coordinate+n/2:null}var l=Bn(a,Et(o)?t.dataKey:o);return Et(l)?null:t.scale(l)}var h5=function(t){var r=t.axis,n=t.ticks,a=t.offset,i=t.bandSize,o=t.entry,s=t.index;if(r.type==="category")return n[s]?n[s].coordinate+a:null;var l=Bn(o,r.dataKey,r.domain[s]);return Et(l)?null:r.scale(l)-i/2+a},nZ=function(t){var r=t.numericAxis,n=r.scale.domain();if(r.type==="number"){var a=Math.min(n[0],n[1]),i=Math.max(n[0],n[1]);return a<=0&&i>=0?0:i<0?i:a}return n[0]},aZ=function(t,r){var n,a=(n=t.type)!==null&&n!==void 0&&n.defaultProps?pn(pn({},t.type.defaultProps),t.props):t.props,i=a.stackId;if(Ln(i)){var o=r[i];if(o){var s=o.items.indexOf(t);return s>=0?o.stackedData[s]:null}}return null},iZ=function(t){return t.reduce(function(r,n){return[em(n.concat([r[0]]).filter(Re)),ys(n.concat([r[1]]).filter(Re))]},[1/0,-1/0])},wC=function(t,r,n){return Object.keys(t).reduce(function(a,i){var o=t[i],s=o.stackedData,l=s.reduce(function(u,d){var f=iZ(d.slice(r,n+1));return[Math.min(u[0],f[0]),Math.max(u[1],f[1])]},[1/0,-1/0]);return[Math.min(l[0],a[0]),Math.max(l[1],a[1])]},[1/0,-1/0]).map(function(a){return a===1/0||a===-1/0?0:a})},p5=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,g5=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,U1=function(t,r,n){if(Bt(t))return t(r,n);if(!Array.isArray(t))return r;var a=[];if(Re(t[0]))a[0]=n?t[0]:Math.min(t[0],r[0]);else if(p5.test(t[0])){var i=+p5.exec(t[0])[1];a[0]=r[0]-i}else Bt(t[0])?a[0]=t[0](r[0]):a[0]=r[0];if(Re(t[1]))a[1]=n?t[1]:Math.max(t[1],r[1]);else if(g5.test(t[1])){var o=+g5.exec(t[1])[1];a[1]=r[1]+o}else Bt(t[1])?a[1]=t[1](r[1]):a[1]=r[1];return a},Pp=function(t,r,n){if(t&&t.scale&&t.scale.bandwidth){var a=t.scale.bandwidth();if(!n||a>0)return a}if(t&&r&&r.length>=2){for(var i=u2(r,function(f){return f.coordinate}),o=1/0,s=1,l=i.length;s<l;s++){var u=i[s],d=i[s-1];o=Math.min((u.coordinate||0)-(d.coordinate||0),o)}return o===1/0?0:o}return n?void 0:0},m5=function(t,r,n){return!t||!t.length||Fl(t,hi(n,"type.defaultProps.domain"))?r:t},kC=function(t,r){var n=t.type.defaultProps?pn(pn({},t.type.defaultProps),t.props):t.props,a=n.dataKey,i=n.name,o=n.unit,s=n.formatter,l=n.tooltipType,u=n.chartType,d=n.hide;return pn(pn({},Dt(t,!1)),{},{dataKey:a,unit:o,formatter:s,name:i||a,color:$2(t),value:Bn(r,a),type:l,payload:r,chartType:u,hide:d})};function Mf(e){"@babel/helpers - typeof";return Mf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Mf(e)}function x5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function y5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?x5(Object(r),!0).forEach(function(n){oZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):x5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function oZ(e,t,r){return t=sZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sZ(e){var t=lZ(e,"string");return Mf(t)=="symbol"?t:t+""}function lZ(e,t){if(Mf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Mf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var Np=Math.PI/180,cZ=function(t){return t*180/Math.PI},Zn=function(t,r,n,a){return{x:t+Math.cos(-Np*a)*n,y:r+Math.sin(-Np*a)*n}},uZ=function(t,r){var n=t.x,a=t.y,i=r.x,o=r.y;return Math.sqrt(Math.pow(n-i,2)+Math.pow(a-o,2))},dZ=function(t,r){var n=t.x,a=t.y,i=r.cx,o=r.cy,s=uZ({x:n,y:a},{x:i,y:o});if(s<=0)return{radius:s};var l=(n-i)/s,u=Math.acos(l);return a>o&&(u=2*Math.PI-u),{radius:s,angle:cZ(u),angleInRadian:u}},fZ=function(t){var r=t.startAngle,n=t.endAngle,a=Math.floor(r/360),i=Math.floor(n/360),o=Math.min(a,i);return{startAngle:r-o*360,endAngle:n-o*360}},hZ=function(t,r){var n=r.startAngle,a=r.endAngle,i=Math.floor(n/360),o=Math.floor(a/360),s=Math.min(i,o);return t+s*360},b5=function(t,r){var n=t.x,a=t.y,i=dZ({x:n,y:a},r),o=i.radius,s=i.angle,l=r.innerRadius,u=r.outerRadius;if(o<l||o>u)return!1;if(o===0)return!0;var d=fZ(r),f=d.startAngle,h=d.endAngle,p=s,x;if(f<=h){for(;p>h;)p-=360;for(;p<f;)p+=360;x=p>=f&&p<=h}else{for(;p>f;)p-=360;for(;p<h;)p+=360;x=p>=h&&p<=f}return x?y5(y5({},r),{},{radius:o,angle:hZ(p,r)}):null};function _f(e){"@babel/helpers - typeof";return _f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_f(e)}var pZ=["offset"];function gZ(e){return bZ(e)||yZ(e)||xZ(e)||mZ()}function mZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xZ(e,t){if(e){if(typeof e=="string")return z1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return z1(e,t)}}function yZ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bZ(e){if(Array.isArray(e))return z1(e)}function z1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vZ(e,t){if(e==null)return{};var r=wZ(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function wZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function v5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function En(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v5(Object(r),!0).forEach(function(n){kZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function kZ(e,t,r){return t=SZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SZ(e){var t=jZ(e,"string");return _f(t)=="symbol"?t:t+""}function jZ(e,t){if(_f(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(_f(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Pf(){return Pf=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pf.apply(this,arguments)}var MZ=function(t){var r=t.value,n=t.formatter,a=Et(t.children)?r:t.children;return Bt(n)?n(a):a},_Z=function(t,r){var n=Ti(r-t),a=Math.min(Math.abs(r-t),360);return n*a},PZ=function(t,r,n){var a=t.position,i=t.viewBox,o=t.offset,s=t.className,l=i,u=l.cx,d=l.cy,f=l.innerRadius,h=l.outerRadius,p=l.startAngle,x=l.endAngle,b=l.clockWise,y=(f+h)/2,m=_Z(p,x),g=m>=0?1:-1,k,S;a==="insideStart"?(k=p+g*o,S=b):a==="insideEnd"?(k=x-g*o,S=!b):a==="end"&&(k=x+g*o,S=b),S=m<=0?S:!S;var w=Zn(u,d,y,k),v=Zn(u,d,y,k+(S?1:-1)*359),M="M".concat(w.x,",").concat(w.y,`
    A`).concat(y,",").concat(y,",0,1,").concat(S?0:1,`,
    `).concat(v.x,",").concat(v.y),_=Et(t.id)?Kl("recharts-radial-line-"):t.id;return re.createElement("text",Pf({},n,{dominantBaseline:"central",className:hr("recharts-radial-bar-label",s)}),re.createElement("defs",null,re.createElement("path",{id:_,d:M})),re.createElement("textPath",{xlinkHref:"#".concat(_)},r))},NZ=function(t){var r=t.viewBox,n=t.offset,a=t.position,i=r,o=i.cx,s=i.cy,l=i.innerRadius,u=i.outerRadius,d=i.startAngle,f=i.endAngle,h=(d+f)/2;if(a==="outside"){var p=Zn(o,s,u+n,h),x=p.x,b=p.y;return{x,y:b,textAnchor:x>=o?"start":"end",verticalAnchor:"middle"}}if(a==="center")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"middle"};if(a==="centerTop")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"start"};if(a==="centerBottom")return{x:o,y:s,textAnchor:"middle",verticalAnchor:"end"};var y=(l+u)/2,m=Zn(o,s,y,h),g=m.x,k=m.y;return{x:g,y:k,textAnchor:"middle",verticalAnchor:"middle"}},CZ=function(t){var r=t.viewBox,n=t.parentViewBox,a=t.offset,i=t.position,o=r,s=o.x,l=o.y,u=o.width,d=o.height,f=d>=0?1:-1,h=f*a,p=f>0?"end":"start",x=f>0?"start":"end",b=u>=0?1:-1,y=b*a,m=b>0?"end":"start",g=b>0?"start":"end";if(i==="top"){var k={x:s+u/2,y:l-f*a,textAnchor:"middle",verticalAnchor:p};return En(En({},k),n?{height:Math.max(l-n.y,0),width:u}:{})}if(i==="bottom"){var S={x:s+u/2,y:l+d+h,textAnchor:"middle",verticalAnchor:x};return En(En({},S),n?{height:Math.max(n.y+n.height-(l+d),0),width:u}:{})}if(i==="left"){var w={x:s-y,y:l+d/2,textAnchor:m,verticalAnchor:"middle"};return En(En({},w),n?{width:Math.max(w.x-n.x,0),height:d}:{})}if(i==="right"){var v={x:s+u+y,y:l+d/2,textAnchor:g,verticalAnchor:"middle"};return En(En({},v),n?{width:Math.max(n.x+n.width-v.x,0),height:d}:{})}var M=n?{width:u,height:d}:{};return i==="insideLeft"?En({x:s+y,y:l+d/2,textAnchor:g,verticalAnchor:"middle"},M):i==="insideRight"?En({x:s+u-y,y:l+d/2,textAnchor:m,verticalAnchor:"middle"},M):i==="insideTop"?En({x:s+u/2,y:l+h,textAnchor:"middle",verticalAnchor:x},M):i==="insideBottom"?En({x:s+u/2,y:l+d-h,textAnchor:"middle",verticalAnchor:p},M):i==="insideTopLeft"?En({x:s+y,y:l+h,textAnchor:g,verticalAnchor:x},M):i==="insideTopRight"?En({x:s+u-y,y:l+h,textAnchor:m,verticalAnchor:x},M):i==="insideBottomLeft"?En({x:s+y,y:l+d-h,textAnchor:g,verticalAnchor:p},M):i==="insideBottomRight"?En({x:s+u-y,y:l+d-h,textAnchor:m,verticalAnchor:p},M):Au(i)&&(Re(i.x)||pl(i.x))&&(Re(i.y)||pl(i.y))?En({x:s+Bl(i.x,u),y:l+Bl(i.y,d),textAnchor:"end",verticalAnchor:"end"},M):En({x:s+u/2,y:l+d/2,textAnchor:"middle",verticalAnchor:"middle"},M)},OZ=function(t){return"cx"in t&&Re(t.cx)};function qn(e){var t=e.offset,r=t===void 0?5:t,n=vZ(e,pZ),a=En({offset:r},n),i=a.viewBox,o=a.position,s=a.value,l=a.children,u=a.content,d=a.className,f=d===void 0?"":d,h=a.textBreakAll;if(!i||Et(s)&&Et(l)&&!j.isValidElement(u)&&!Bt(u))return null;if(j.isValidElement(u))return j.cloneElement(u,a);var p;if(Bt(u)){if(p=j.createElement(u,a),j.isValidElement(p))return p}else p=MZ(a);var x=OZ(i),b=Dt(a,!0);if(x&&(o==="insideStart"||o==="insideEnd"||o==="end"))return PZ(a,p,b);var y=x?NZ(a):CZ(a);return re.createElement(fp,Pf({className:hr("recharts-label",f)},b,y,{breakAll:h}),p)}qn.displayName="Label";var SC=function(t){var r=t.cx,n=t.cy,a=t.angle,i=t.startAngle,o=t.endAngle,s=t.r,l=t.radius,u=t.innerRadius,d=t.outerRadius,f=t.x,h=t.y,p=t.top,x=t.left,b=t.width,y=t.height,m=t.clockWise,g=t.labelViewBox;if(g)return g;if(Re(b)&&Re(y)){if(Re(f)&&Re(h))return{x:f,y:h,width:b,height:y};if(Re(p)&&Re(x))return{x:p,y:x,width:b,height:y}}return Re(f)&&Re(h)?{x:f,y:h,width:0,height:0}:Re(r)&&Re(n)?{cx:r,cy:n,startAngle:i||a||0,endAngle:o||a||0,innerRadius:u||0,outerRadius:d||l||s||0,clockWise:m}:t.viewBox?t.viewBox:{}},AZ=function(t,r){return t?t===!0?re.createElement(qn,{key:"label-implicit",viewBox:r}):Ln(t)?re.createElement(qn,{key:"label-implicit",viewBox:r,value:t}):j.isValidElement(t)?t.type===qn?j.cloneElement(t,{key:"label-implicit",viewBox:r}):re.createElement(qn,{key:"label-implicit",content:t,viewBox:r}):Bt(t)?re.createElement(qn,{key:"label-implicit",content:t,viewBox:r}):Au(t)?re.createElement(qn,Pf({viewBox:r},t,{key:"label-implicit"})):null:null},TZ=function(t,r){var n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!t||!t.children&&n&&!t.label)return null;var a=t.children,i=SC(t),o=Da(a,qn).map(function(l,u){return j.cloneElement(l,{viewBox:r||i,key:"label-".concat(u)})});if(!n)return o;var s=AZ(t.label,r||i);return[s].concat(gZ(o))};qn.parseViewBox=SC;qn.renderCallByParent=TZ;function EZ(e){var t=e==null?0:e.length;return t?e[t-1]:void 0}var IZ=EZ;const RZ=Br(IZ);function Nf(e){"@babel/helpers - typeof";return Nf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Nf(e)}var DZ=["valueAccessor"],$Z=["data","dataKey","clockWise","id","textBreakAll"];function LZ(e){return UZ(e)||GZ(e)||FZ(e)||BZ()}function BZ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function FZ(e,t){if(e){if(typeof e=="string")return W1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W1(e,t)}}function GZ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function UZ(e){if(Array.isArray(e))return W1(e)}function W1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Cp(){return Cp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Cp.apply(this,arguments)}function w5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function k5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?w5(Object(r),!0).forEach(function(n){zZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zZ(e,t,r){return t=WZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WZ(e){var t=VZ(e,"string");return Nf(t)=="symbol"?t:t+""}function VZ(e,t){if(Nf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Nf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function S5(e,t){if(e==null)return{};var r=HZ(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function HZ(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var XZ=function(t){return Array.isArray(t.value)?RZ(t.value):t.value};function to(e){var t=e.valueAccessor,r=t===void 0?XZ:t,n=S5(e,DZ),a=n.data,i=n.dataKey,o=n.clockWise,s=n.id,l=n.textBreakAll,u=S5(n,$Z);return!a||!a.length?null:re.createElement(_r,{className:"recharts-label-list"},a.map(function(d,f){var h=Et(i)?r(d,f):Bn(d&&d.payload,i),p=Et(s)?{}:{id:"".concat(s,"-").concat(f)};return re.createElement(qn,Cp({},Dt(d,!0),u,p,{parentViewBox:d.parentViewBox,value:h,textBreakAll:l,viewBox:qn.parseViewBox(Et(o)?d:k5(k5({},d),{},{clockWise:o})),key:"label-".concat(f),index:f}))}))}to.displayName="LabelList";function KZ(e,t){return e?e===!0?re.createElement(to,{key:"labelList-implicit",data:t}):re.isValidElement(e)||Bt(e)?re.createElement(to,{key:"labelList-implicit",data:t,content:e}):Au(e)?re.createElement(to,Cp({data:t},e,{key:"labelList-implicit"})):null:null}function YZ(e,t){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0;if(!e||!e.children&&r&&!e.label)return null;var n=e.children,a=Da(n,to).map(function(o,s){return j.cloneElement(o,{data:t,key:"labelList-".concat(s)})});if(!r)return a;var i=KZ(e.label,t);return[i].concat(LZ(a))}to.renderCallByParent=YZ;function Cf(e){"@babel/helpers - typeof";return Cf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cf(e)}function V1(){return V1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},V1.apply(this,arguments)}function j5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function M5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?j5(Object(r),!0).forEach(function(n){qZ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):j5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qZ(e,t,r){return t=ZZ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZZ(e){var t=JZ(e,"string");return Cf(t)=="symbol"?t:t+""}function JZ(e,t){if(Cf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Cf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var QZ=function(t,r){var n=Ti(r-t),a=Math.min(Math.abs(r-t),359.999);return n*a},q0=function(t){var r=t.cx,n=t.cy,a=t.radius,i=t.angle,o=t.sign,s=t.isExternal,l=t.cornerRadius,u=t.cornerIsExternal,d=l*(s?1:-1)+a,f=Math.asin(l/d)/Np,h=u?i:i+o*f,p=Zn(r,n,d,h),x=Zn(r,n,a,h),b=u?i-o*f:i,y=Zn(r,n,d*Math.cos(f*Np),b);return{center:p,circleTangency:x,lineTangency:y,theta:f}},jC=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,i=t.outerRadius,o=t.startAngle,s=t.endAngle,l=QZ(o,s),u=o+l,d=Zn(r,n,i,o),f=Zn(r,n,i,u),h="M ".concat(d.x,",").concat(d.y,`
    A `).concat(i,",").concat(i,`,0,
    `).concat(+(Math.abs(l)>180),",").concat(+(o>u),`,
    `).concat(f.x,",").concat(f.y,`
  `);if(a>0){var p=Zn(r,n,a,o),x=Zn(r,n,a,u);h+="L ".concat(x.x,",").concat(x.y,`
            A `).concat(a,",").concat(a,`,0,
            `).concat(+(Math.abs(l)>180),",").concat(+(o<=u),`,
            `).concat(p.x,",").concat(p.y," Z")}else h+="L ".concat(r,",").concat(n," Z");return h},eJ=function(t){var r=t.cx,n=t.cy,a=t.innerRadius,i=t.outerRadius,o=t.cornerRadius,s=t.forceCornerRadius,l=t.cornerIsExternal,u=t.startAngle,d=t.endAngle,f=Ti(d-u),h=q0({cx:r,cy:n,radius:i,angle:u,sign:f,cornerRadius:o,cornerIsExternal:l}),p=h.circleTangency,x=h.lineTangency,b=h.theta,y=q0({cx:r,cy:n,radius:i,angle:d,sign:-f,cornerRadius:o,cornerIsExternal:l}),m=y.circleTangency,g=y.lineTangency,k=y.theta,S=l?Math.abs(u-d):Math.abs(u-d)-b-k;if(S<0)return s?"M ".concat(x.x,",").concat(x.y,`
        a`).concat(o,",").concat(o,",0,0,1,").concat(o*2,`,0
        a`).concat(o,",").concat(o,",0,0,1,").concat(-o*2,`,0
      `):jC({cx:r,cy:n,innerRadius:a,outerRadius:i,startAngle:u,endAngle:d});var w="M ".concat(x.x,",").concat(x.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(p.x,",").concat(p.y,`
    A`).concat(i,",").concat(i,",0,").concat(+(S>180),",").concat(+(f<0),",").concat(m.x,",").concat(m.y,`
    A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(g.x,",").concat(g.y,`
  `);if(a>0){var v=q0({cx:r,cy:n,radius:a,angle:u,sign:f,isExternal:!0,cornerRadius:o,cornerIsExternal:l}),M=v.circleTangency,_=v.lineTangency,P=v.theta,A=q0({cx:r,cy:n,radius:a,angle:d,sign:-f,isExternal:!0,cornerRadius:o,cornerIsExternal:l}),R=A.circleTangency,D=A.lineTangency,E=A.theta,W=l?Math.abs(u-d):Math.abs(u-d)-P-E;if(W<0&&o===0)return"".concat(w,"L").concat(r,",").concat(n,"Z");w+="L".concat(D.x,",").concat(D.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(R.x,",").concat(R.y,`
      A`).concat(a,",").concat(a,",0,").concat(+(W>180),",").concat(+(f>0),",").concat(M.x,",").concat(M.y,`
      A`).concat(o,",").concat(o,",0,0,").concat(+(f<0),",").concat(_.x,",").concat(_.y,"Z")}else w+="L".concat(r,",").concat(n,"Z");return w},tJ={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},MC=function(t){var r=M5(M5({},tJ),t),n=r.cx,a=r.cy,i=r.innerRadius,o=r.outerRadius,s=r.cornerRadius,l=r.forceCornerRadius,u=r.cornerIsExternal,d=r.startAngle,f=r.endAngle,h=r.className;if(o<i||d===f)return null;var p=hr("recharts-sector",h),x=o-i,b=Bl(s,x,0,!0),y;return b>0&&Math.abs(d-f)<360?y=eJ({cx:n,cy:a,innerRadius:i,outerRadius:o,cornerRadius:Math.min(b,x/2),forceCornerRadius:l,cornerIsExternal:u,startAngle:d,endAngle:f}):y=jC({cx:n,cy:a,innerRadius:i,outerRadius:o,startAngle:d,endAngle:f}),re.createElement("path",V1({},Dt(r,!0),{className:p,d:y,role:"img"}))};function Of(e){"@babel/helpers - typeof";return Of=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Of(e)}function H1(){return H1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},H1.apply(this,arguments)}function _5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function P5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?_5(Object(r),!0).forEach(function(n){rJ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rJ(e,t,r){return t=nJ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nJ(e){var t=aJ(e,"string");return Of(t)=="symbol"?t:t+""}function aJ(e,t){if(Of(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Of(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var N5={curveBasisClosed:r9,curveBasisOpen:n9,curveBasis:t9,curveBumpX:G7,curveBumpY:U7,curveLinearClosed:a9,curveLinear:Ug,curveMonotoneX:i9,curveMonotoneY:o9,curveNatural:s9,curveStep:l9,curveStepAfter:u9,curveStepBefore:c9},Z0=function(t){return t.x===+t.x&&t.y===+t.y},gd=function(t){return t.x},md=function(t){return t.y},iJ=function(t,r){if(Bt(t))return t;var n="curve".concat(Fg(t));return(n==="curveMonotone"||n==="curveBump")&&r?N5["".concat(n).concat(r==="vertical"?"Y":"X")]:N5[n]||Ug},oJ=function(t){var r=t.type,n=r===void 0?"linear":r,a=t.points,i=a===void 0?[]:a,o=t.baseLine,s=t.layout,l=t.connectNulls,u=l===void 0?!1:l,d=iJ(n,s),f=u?i.filter(function(b){return Z0(b)}):i,h;if(Array.isArray(o)){var p=u?o.filter(function(b){return Z0(b)}):o,x=f.map(function(b,y){return P5(P5({},b),{},{base:p[y]})});return s==="vertical"?h=G0().y(md).x1(gd).x0(function(b){return b.base.x}):h=G0().x(gd).y1(md).y0(function(b){return b.base.y}),h.defined(Z0).curve(d),h(x)}return s==="vertical"&&Re(o)?h=G0().y(md).x1(gd).x0(o):Re(o)?h=G0().x(gd).y1(md).y0(o):h=PP().x(gd).y(md),h.defined(Z0).curve(d),h(f)},Ml=function(t){var r=t.className,n=t.points,a=t.path,i=t.pathRef;if((!n||!n.length)&&!a)return null;var o=n&&n.length?oJ(t):a;return j.createElement("path",H1({},Dt(t,!1),Jh(t),{className:hr("recharts-curve",r),d:o,ref:i}))},_C={exports:{}},sJ="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",lJ=sJ,cJ=lJ;function PC(){}function NC(){}NC.resetWarningCache=PC;var uJ=function(){function e(n,a,i,o,s,l){if(l!==cJ){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function t(){return e}var r={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:NC,resetWarningCache:PC};return r.PropTypes=r,r};_C.exports=uJ();var dJ=_C.exports;const Or=Br(dJ),{getOwnPropertyNames:fJ,getOwnPropertySymbols:hJ}=Object,{hasOwnProperty:pJ}=Object.prototype;function Dx(e,t){return function(n,a,i){return e(n,a,i)&&t(n,a,i)}}function J0(e){return function(r,n,a){if(!r||!n||typeof r!="object"||typeof n!="object")return e(r,n,a);const{cache:i}=a,o=i.get(r),s=i.get(n);if(o&&s)return o===n&&s===r;i.set(r,n),i.set(n,r);const l=e(r,n,a);return i.delete(r),i.delete(n),l}}function gJ(e){return e!=null?e[Symbol.toStringTag]:void 0}function C5(e){return fJ(e).concat(hJ(e))}const mJ=Object.hasOwn||((e,t)=>pJ.call(e,t));function Zl(e,t){return e===t||!e&&!t&&e!==e&&t!==t}const xJ="__v",yJ="__o",bJ="_owner",{getOwnPropertyDescriptor:O5,keys:A5}=Object;function vJ(e,t){return e.byteLength===t.byteLength&&Op(new Uint8Array(e),new Uint8Array(t))}function wJ(e,t,r){let n=e.length;if(t.length!==n)return!1;for(;n-- >0;)if(!r.equals(e[n],t[n],n,n,e,t,r))return!1;return!0}function kJ(e,t){return e.byteLength===t.byteLength&&Op(new Uint8Array(e.buffer,e.byteOffset,e.byteLength),new Uint8Array(t.buffer,t.byteOffset,t.byteLength))}function SJ(e,t){return Zl(e.getTime(),t.getTime())}function jJ(e,t){return e.name===t.name&&e.message===t.message&&e.cause===t.cause&&e.stack===t.stack}function MJ(e,t){return e===t}function T5(e,t,r){const n=e.size;if(n!==t.size)return!1;if(!n)return!0;const a=new Array(n),i=e.entries();let o,s,l=0;for(;(o=i.next())&&!o.done;){const u=t.entries();let d=!1,f=0;for(;(s=u.next())&&!s.done;){if(a[f]){f++;continue}const h=o.value,p=s.value;if(r.equals(h[0],p[0],l,f,e,t,r)&&r.equals(h[1],p[1],h[0],p[0],e,t,r)){d=a[f]=!0;break}f++}if(!d)return!1;l++}return!0}const _J=Zl;function PJ(e,t,r){const n=A5(e);let a=n.length;if(A5(t).length!==a)return!1;for(;a-- >0;)if(!CC(e,t,r,n[a]))return!1;return!0}function xd(e,t,r){const n=C5(e);let a=n.length;if(C5(t).length!==a)return!1;let i,o,s;for(;a-- >0;)if(i=n[a],!CC(e,t,r,i)||(o=O5(e,i),s=O5(t,i),(o||s)&&(!o||!s||o.configurable!==s.configurable||o.enumerable!==s.enumerable||o.writable!==s.writable)))return!1;return!0}function NJ(e,t){return Zl(e.valueOf(),t.valueOf())}function CJ(e,t){return e.source===t.source&&e.flags===t.flags}function E5(e,t,r){const n=e.size;if(n!==t.size)return!1;if(!n)return!0;const a=new Array(n),i=e.values();let o,s;for(;(o=i.next())&&!o.done;){const l=t.values();let u=!1,d=0;for(;(s=l.next())&&!s.done;){if(!a[d]&&r.equals(o.value,s.value,o.value,s.value,e,t,r)){u=a[d]=!0;break}d++}if(!u)return!1}return!0}function Op(e,t){let r=e.byteLength;if(t.byteLength!==r||e.byteOffset!==t.byteOffset)return!1;for(;r-- >0;)if(e[r]!==t[r])return!1;return!0}function OJ(e,t){return e.hostname===t.hostname&&e.pathname===t.pathname&&e.protocol===t.protocol&&e.port===t.port&&e.hash===t.hash&&e.username===t.username&&e.password===t.password}function CC(e,t,r,n){return(n===bJ||n===yJ||n===xJ)&&(e.$$typeof||t.$$typeof)?!0:mJ(t,n)&&r.equals(e[n],t[n],n,n,e,t,r)}const AJ="[object ArrayBuffer]",TJ="[object Arguments]",EJ="[object Boolean]",IJ="[object DataView]",RJ="[object Date]",DJ="[object Error]",$J="[object Map]",LJ="[object Number]",BJ="[object Object]",FJ="[object RegExp]",GJ="[object Set]",UJ="[object String]",zJ={"[object Int8Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Int16Array]":!0,"[object Uint16Array]":!0,"[object Int32Array]":!0,"[object Uint32Array]":!0,"[object Float16Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0,"[object BigInt64Array]":!0,"[object BigUint64Array]":!0},WJ="[object URL]",VJ=Object.prototype.toString;function HJ({areArrayBuffersEqual:e,areArraysEqual:t,areDataViewsEqual:r,areDatesEqual:n,areErrorsEqual:a,areFunctionsEqual:i,areMapsEqual:o,areNumbersEqual:s,areObjectsEqual:l,arePrimitiveWrappersEqual:u,areRegExpsEqual:d,areSetsEqual:f,areTypedArraysEqual:h,areUrlsEqual:p,unknownTagComparators:x}){return function(y,m,g){if(y===m)return!0;if(y==null||m==null)return!1;const k=typeof y;if(k!==typeof m)return!1;if(k!=="object")return k==="number"?s(y,m,g):k==="function"?i(y,m,g):!1;const S=y.constructor;if(S!==m.constructor)return!1;if(S===Object)return l(y,m,g);if(Array.isArray(y))return t(y,m,g);if(S===Date)return n(y,m,g);if(S===RegExp)return d(y,m,g);if(S===Map)return o(y,m,g);if(S===Set)return f(y,m,g);const w=VJ.call(y);if(w===RJ)return n(y,m,g);if(w===FJ)return d(y,m,g);if(w===$J)return o(y,m,g);if(w===GJ)return f(y,m,g);if(w===BJ)return typeof y.then!="function"&&typeof m.then!="function"&&l(y,m,g);if(w===WJ)return p(y,m,g);if(w===DJ)return a(y,m,g);if(w===TJ)return l(y,m,g);if(zJ[w])return h(y,m,g);if(w===AJ)return e(y,m,g);if(w===IJ)return r(y,m,g);if(w===EJ||w===LJ||w===UJ)return u(y,m,g);if(x){let v=x[w];if(!v){const M=gJ(y);M&&(v=x[M])}if(v)return v(y,m,g)}return!1}}function XJ({circular:e,createCustomConfig:t,strict:r}){let n={areArrayBuffersEqual:vJ,areArraysEqual:r?xd:wJ,areDataViewsEqual:kJ,areDatesEqual:SJ,areErrorsEqual:jJ,areFunctionsEqual:MJ,areMapsEqual:r?Dx(T5,xd):T5,areNumbersEqual:_J,areObjectsEqual:r?xd:PJ,arePrimitiveWrappersEqual:NJ,areRegExpsEqual:CJ,areSetsEqual:r?Dx(E5,xd):E5,areTypedArraysEqual:r?Dx(Op,xd):Op,areUrlsEqual:OJ,unknownTagComparators:void 0};if(t&&(n=Object.assign({},n,t(n))),e){const a=J0(n.areArraysEqual),i=J0(n.areMapsEqual),o=J0(n.areObjectsEqual),s=J0(n.areSetsEqual);n=Object.assign({},n,{areArraysEqual:a,areMapsEqual:i,areObjectsEqual:o,areSetsEqual:s})}return n}function KJ(e){return function(t,r,n,a,i,o,s){return e(t,r,s)}}function YJ({circular:e,comparator:t,createState:r,equals:n,strict:a}){if(r)return function(s,l){const{cache:u=e?new WeakMap:void 0,meta:d}=r();return t(s,l,{cache:u,equals:n,meta:d,strict:a})};if(e)return function(s,l){return t(s,l,{cache:new WeakMap,equals:n,meta:void 0,strict:a})};const i={cache:void 0,equals:n,meta:void 0,strict:a};return function(s,l){return t(s,l,i)}}const qJ=Xs();Xs({strict:!0});Xs({circular:!0});Xs({circular:!0,strict:!0});Xs({createInternalComparator:()=>Zl});Xs({strict:!0,createInternalComparator:()=>Zl});Xs({circular:!0,createInternalComparator:()=>Zl});Xs({circular:!0,createInternalComparator:()=>Zl,strict:!0});function Xs(e={}){const{circular:t=!1,createInternalComparator:r,createState:n,strict:a=!1}=e,i=XJ(e),o=HJ(i),s=r?r(o):KJ(o);return YJ({circular:t,comparator:o,createState:n,equals:s,strict:a})}function ZJ(e){typeof requestAnimationFrame<"u"&&requestAnimationFrame(e)}function I5(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=-1,n=function a(i){r<0&&(r=i),i-r>t?(e(i),r=-1):ZJ(a)};requestAnimationFrame(n)}function X1(e){"@babel/helpers - typeof";return X1=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},X1(e)}function JJ(e){return rQ(e)||tQ(e)||eQ(e)||QJ()}function QJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eQ(e,t){if(e){if(typeof e=="string")return R5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return R5(e,t)}}function R5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function tQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function rQ(e){if(Array.isArray(e))return e}function nQ(){var e={},t=function(){return null},r=!1,n=function a(i){if(!r){if(Array.isArray(i)){if(!i.length)return;var o=i,s=JJ(o),l=s[0],u=s.slice(1);if(typeof l=="number"){I5(a.bind(null,u),l);return}a(l),I5(a.bind(null,u));return}X1(i)==="object"&&(e=i,t(e)),typeof i=="function"&&i()}};return{stop:function(){r=!0},start:function(i){r=!1,n(i)},subscribe:function(i){return t=i,function(){t=function(){return null}}}}}function Af(e){"@babel/helpers - typeof";return Af=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Af(e)}function D5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function $5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?D5(Object(r),!0).forEach(function(n){OC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):D5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function OC(e,t,r){return t=aQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aQ(e){var t=iQ(e,"string");return Af(t)==="symbol"?t:String(t)}function iQ(e,t){if(Af(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Af(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var oQ=function(t,r){return[Object.keys(t),Object.keys(r)].reduce(function(n,a){return n.filter(function(i){return a.includes(i)})})},sQ=function(t){return t},lQ=function(t){return t.replace(/([A-Z])/g,function(r){return"-".concat(r.toLowerCase())})},Bd=function(t,r){return Object.keys(r).reduce(function(n,a){return $5($5({},n),{},OC({},a,t(a,r[a])))},{})},L5=function(t,r,n){return t.map(function(a){return"".concat(lQ(a)," ").concat(r,"ms ").concat(n)}).join(",")};function cQ(e,t){return fQ(e)||dQ(e,t)||AC(e,t)||uQ()}function uQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function fQ(e){if(Array.isArray(e))return e}function hQ(e){return mQ(e)||gQ(e)||AC(e)||pQ()}function pQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function AC(e,t){if(e){if(typeof e=="string")return K1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return K1(e,t)}}function gQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function mQ(e){if(Array.isArray(e))return K1(e)}function K1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Ap=1e-4,TC=function(t,r){return[0,3*t,3*r-6*t,3*t-3*r+1]},EC=function(t,r){return t.map(function(n,a){return n*Math.pow(r,a)}).reduce(function(n,a){return n+a})},B5=function(t,r){return function(n){var a=TC(t,r);return EC(a,n)}},xQ=function(t,r){return function(n){var a=TC(t,r),i=[].concat(hQ(a.map(function(o,s){return o*s}).slice(1)),[0]);return EC(i,n)}},F5=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0],i=r[1],o=r[2],s=r[3];if(r.length===1)switch(r[0]){case"linear":a=0,i=0,o=1,s=1;break;case"ease":a=.25,i=.1,o=.25,s=1;break;case"ease-in":a=.42,i=0,o=1,s=1;break;case"ease-out":a=.42,i=0,o=.58,s=1;break;case"ease-in-out":a=0,i=0,o=.58,s=1;break;default:{var l=r[0].split("(");if(l[0]==="cubic-bezier"&&l[1].split(")")[0].split(",").length===4){var u=l[1].split(")")[0].split(",").map(function(y){return parseFloat(y)}),d=cQ(u,4);a=d[0],i=d[1],o=d[2],s=d[3]}}}var f=B5(a,o),h=B5(i,s),p=xQ(a,o),x=function(m){return m>1?1:m<0?0:m},b=function(m){for(var g=m>1?1:m,k=g,S=0;S<8;++S){var w=f(k)-g,v=p(k);if(Math.abs(w-g)<Ap||v<Ap)return h(k);k=x(k-w/v)}return h(k)};return b.isStepper=!1,b},yQ=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=t.stiff,n=r===void 0?100:r,a=t.damping,i=a===void 0?8:a,o=t.dt,s=o===void 0?17:o,l=function(d,f,h){var p=-(d-f)*n,x=h*i,b=h+(p-x)*s/1e3,y=h*s/1e3+d;return Math.abs(y-f)<Ap&&Math.abs(b)<Ap?[f,0]:[y,b]};return l.isStepper=!0,l.dt=s,l},bQ=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var a=r[0];if(typeof a=="string")switch(a){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return F5(a);case"spring":return yQ();default:if(a.split("(")[0]==="cubic-bezier")return F5(a)}return typeof a=="function"?a:null};function Tf(e){"@babel/helpers - typeof";return Tf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Tf(e)}function G5(e){return kQ(e)||wQ(e)||IC(e)||vQ()}function vQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function kQ(e){if(Array.isArray(e))return q1(e)}function U5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Kn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?U5(Object(r),!0).forEach(function(n){Y1(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Y1(e,t,r){return t=SQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SQ(e){var t=jQ(e,"string");return Tf(t)==="symbol"?t:String(t)}function jQ(e,t){if(Tf(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Tf(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function MQ(e,t){return NQ(e)||PQ(e,t)||IC(e,t)||_Q()}function _Q(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function IC(e,t){if(e){if(typeof e=="string")return q1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return q1(e,t)}}function q1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function PQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function NQ(e){if(Array.isArray(e))return e}var Tp=function(t,r,n){return t+(r-t)*n},Z1=function(t){var r=t.from,n=t.to;return r!==n},CQ=function e(t,r,n){var a=Bd(function(i,o){if(Z1(o)){var s=t(o.from,o.to,o.velocity),l=MQ(s,2),u=l[0],d=l[1];return Kn(Kn({},o),{},{from:u,velocity:d})}return o},r);return n<1?Bd(function(i,o){return Z1(o)?Kn(Kn({},o),{},{velocity:Tp(o.velocity,a[i].velocity,n),from:Tp(o.from,a[i].from,n)}):o},r):e(t,a,n-1)};const OQ=function(e,t,r,n,a){var i=oQ(e,t),o=i.reduce(function(y,m){return Kn(Kn({},y),{},Y1({},m,[e[m],t[m]]))},{}),s=i.reduce(function(y,m){return Kn(Kn({},y),{},Y1({},m,{from:e[m],velocity:0,to:t[m]}))},{}),l=-1,u,d,f=function(){return null},h=function(){return Bd(function(m,g){return g.from},s)},p=function(){return!Object.values(s).filter(Z1).length},x=function(m){u||(u=m);var g=m-u,k=g/r.dt;s=CQ(r,s,k),a(Kn(Kn(Kn({},e),t),h())),u=m,p()||(l=requestAnimationFrame(f))},b=function(m){d||(d=m);var g=(m-d)/n,k=Bd(function(w,v){return Tp.apply(void 0,G5(v).concat([r(g)]))},o);if(a(Kn(Kn(Kn({},e),t),k)),g<1)l=requestAnimationFrame(f);else{var S=Bd(function(w,v){return Tp.apply(void 0,G5(v).concat([r(1)]))},o);a(Kn(Kn(Kn({},e),t),S))}};return f=r.isStepper?x:b,function(){return requestAnimationFrame(f),function(){cancelAnimationFrame(l)}}};function lu(e){"@babel/helpers - typeof";return lu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lu(e)}var AQ=["children","begin","duration","attributeName","easing","isActive","steps","from","to","canBegin","onAnimationEnd","shouldReAnimate","onAnimationReStart"];function TQ(e,t){if(e==null)return{};var r=EQ(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function EQ(e,t){if(e==null)return{};var r={},n=Object.keys(e),a,i;for(i=0;i<n.length;i++)a=n[i],!(t.indexOf(a)>=0)&&(r[a]=e[a]);return r}function $x(e){return $Q(e)||DQ(e)||RQ(e)||IQ()}function IQ(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function RQ(e,t){if(e){if(typeof e=="string")return J1(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return J1(e,t)}}function DQ(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function $Q(e){if(Array.isArray(e))return J1(e)}function J1(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function z5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Si(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?z5(Object(r),!0).forEach(function(n){jd(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):z5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function jd(e,t,r){return t=RC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function LQ(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function BQ(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,RC(n.key),n)}}function FQ(e,t,r){return t&&BQ(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function RC(e){var t=GQ(e,"string");return lu(t)==="symbol"?t:String(t)}function GQ(e,t){if(lu(e)!=="object"||e===null)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(lu(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function UQ(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q1(e,t)}function Q1(e,t){return Q1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},Q1(e,t)}function zQ(e){var t=WQ();return function(){var n=Ep(e),a;if(t){var i=Ep(this).constructor;a=Reflect.construct(n,arguments,i)}else a=n.apply(this,arguments);return eb(this,a)}}function eb(e,t){if(t&&(lu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return tb(e)}function tb(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function WQ(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Ep(e){return Ep=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Ep(e)}var $i=function(e){UQ(r,e);var t=zQ(r);function r(n,a){var i;LQ(this,r),i=t.call(this,n,a);var o=i.props,s=o.isActive,l=o.attributeName,u=o.from,d=o.to,f=o.steps,h=o.children,p=o.duration;if(i.handleStyleChange=i.handleStyleChange.bind(tb(i)),i.changeStyle=i.changeStyle.bind(tb(i)),!s||p<=0)return i.state={style:{}},typeof h=="function"&&(i.state={style:d}),eb(i);if(f&&f.length)i.state={style:f[0].style};else if(u){if(typeof h=="function")return i.state={style:u},eb(i);i.state={style:l?jd({},l,u):u}}else i.state={style:{}};return i}return FQ(r,[{key:"componentDidMount",value:function(){var a=this.props,i=a.isActive,o=a.canBegin;this.mounted=!0,!(!i||!o)&&this.runAnimation(this.props)}},{key:"componentDidUpdate",value:function(a){var i=this.props,o=i.isActive,s=i.canBegin,l=i.attributeName,u=i.shouldReAnimate,d=i.to,f=i.from,h=this.state.style;if(s){if(!o){var p={style:l?jd({},l,d):d};this.state&&h&&(l&&h[l]!==d||!l&&h!==d)&&this.setState(p);return}if(!(qJ(a.to,d)&&a.canBegin&&a.isActive)){var x=!a.canBegin||!a.isActive;this.manager&&this.manager.stop(),this.stopJSAnimation&&this.stopJSAnimation();var b=x||u?f:a.to;if(this.state&&h){var y={style:l?jd({},l,b):b};(l&&h[l]!==b||!l&&h!==b)&&this.setState(y)}this.runAnimation(Si(Si({},this.props),{},{from:b,begin:0}))}}}},{key:"componentWillUnmount",value:function(){this.mounted=!1;var a=this.props.onAnimationEnd;this.unSubscribe&&this.unSubscribe(),this.manager&&(this.manager.stop(),this.manager=null),this.stopJSAnimation&&this.stopJSAnimation(),a&&a()}},{key:"handleStyleChange",value:function(a){this.changeStyle(a)}},{key:"changeStyle",value:function(a){this.mounted&&this.setState({style:a})}},{key:"runJSAnimation",value:function(a){var i=this,o=a.from,s=a.to,l=a.duration,u=a.easing,d=a.begin,f=a.onAnimationEnd,h=a.onAnimationStart,p=OQ(o,s,bQ(u),l,this.changeStyle),x=function(){i.stopJSAnimation=p()};this.manager.start([h,d,x,l,f])}},{key:"runStepAnimation",value:function(a){var i=this,o=a.steps,s=a.begin,l=a.onAnimationStart,u=o[0],d=u.style,f=u.duration,h=f===void 0?0:f,p=function(b,y,m){if(m===0)return b;var g=y.duration,k=y.easing,S=k===void 0?"ease":k,w=y.style,v=y.properties,M=y.onAnimationEnd,_=m>0?o[m-1]:y,P=v||Object.keys(w);if(typeof S=="function"||S==="spring")return[].concat($x(b),[i.runJSAnimation.bind(i,{from:_.style,to:w,duration:g,easing:S}),g]);var A=L5(P,g,S),R=Si(Si(Si({},_.style),w),{},{transition:A});return[].concat($x(b),[R,g,M]).filter(sQ)};return this.manager.start([l].concat($x(o.reduce(p,[d,Math.max(h,s)])),[a.onAnimationEnd]))}},{key:"runAnimation",value:function(a){this.manager||(this.manager=nQ());var i=a.begin,o=a.duration,s=a.attributeName,l=a.to,u=a.easing,d=a.onAnimationStart,f=a.onAnimationEnd,h=a.steps,p=a.children,x=this.manager;if(this.unSubscribe=x.subscribe(this.handleStyleChange),typeof u=="function"||typeof p=="function"||u==="spring"){this.runJSAnimation(a);return}if(h.length>1){this.runStepAnimation(a);return}var b=s?jd({},s,l):l,y=L5(Object.keys(b),o,u);x.start([d,i,Si(Si({},b),{},{transition:y}),o,f])}},{key:"render",value:function(){var a=this.props,i=a.children;a.begin;var o=a.duration;a.attributeName,a.easing;var s=a.isActive;a.steps,a.from,a.to,a.canBegin,a.onAnimationEnd,a.shouldReAnimate,a.onAnimationReStart;var l=TQ(a,AQ),u=j.Children.count(i),d=this.state.style;if(typeof i=="function")return i(d);if(!s||u===0||o<=0)return i;var f=function(p){var x=p.props,b=x.style,y=b===void 0?{}:b,m=x.className,g=j.cloneElement(p,Si(Si({},l),{},{style:Si(Si({},y),d),className:m}));return g};return u===1?f(j.Children.only(i)):re.createElement("div",null,j.Children.map(i,function(h){return f(h)}))}}]),r}(j.PureComponent);$i.displayName="Animate";$i.defaultProps={begin:0,duration:1e3,from:"",to:"",attributeName:"",easing:"ease",isActive:!0,canBegin:!0,steps:[],onAnimationEnd:function(){},onAnimationStart:function(){}};$i.propTypes={from:Or.oneOfType([Or.object,Or.string]),to:Or.oneOfType([Or.object,Or.string]),attributeName:Or.string,duration:Or.number,begin:Or.number,easing:Or.oneOfType([Or.string,Or.func]),steps:Or.arrayOf(Or.shape({duration:Or.number.isRequired,style:Or.object.isRequired,easing:Or.oneOfType([Or.oneOf(["ease","ease-in","ease-out","ease-in-out","linear"]),Or.func]),properties:Or.arrayOf("string"),onAnimationEnd:Or.func})),children:Or.oneOfType([Or.node,Or.func]),isActive:Or.bool,canBegin:Or.bool,onAnimationEnd:Or.func,shouldReAnimate:Or.bool,onAnimationStart:Or.func,onAnimationReStart:Or.func};function Ef(e){"@babel/helpers - typeof";return Ef=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ef(e)}function Ip(){return Ip=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ip.apply(this,arguments)}function VQ(e,t){return YQ(e)||KQ(e,t)||XQ(e,t)||HQ()}function HQ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function XQ(e,t){if(e){if(typeof e=="string")return W5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return W5(e,t)}}function W5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function KQ(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function YQ(e){if(Array.isArray(e))return e}function V5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function H5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?V5(Object(r),!0).forEach(function(n){qQ(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):V5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function qQ(e,t,r){return t=ZQ(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ZQ(e){var t=JQ(e,"string");return Ef(t)=="symbol"?t:t+""}function JQ(e,t){if(Ef(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ef(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var X5=function(t,r,n,a,i){var o=Math.min(Math.abs(n)/2,Math.abs(a)/2),s=a>=0?1:-1,l=n>=0?1:-1,u=a>=0&&n>=0||a<0&&n<0?1:0,d;if(o>0&&i instanceof Array){for(var f=[0,0,0,0],h=0,p=4;h<p;h++)f[h]=i[h]>o?o:i[h];d="M".concat(t,",").concat(r+s*f[0]),f[0]>0&&(d+="A ".concat(f[0],",").concat(f[0],",0,0,").concat(u,",").concat(t+l*f[0],",").concat(r)),d+="L ".concat(t+n-l*f[1],",").concat(r),f[1]>0&&(d+="A ".concat(f[1],",").concat(f[1],",0,0,").concat(u,`,
        `).concat(t+n,",").concat(r+s*f[1])),d+="L ".concat(t+n,",").concat(r+a-s*f[2]),f[2]>0&&(d+="A ".concat(f[2],",").concat(f[2],",0,0,").concat(u,`,
        `).concat(t+n-l*f[2],",").concat(r+a)),d+="L ".concat(t+l*f[3],",").concat(r+a),f[3]>0&&(d+="A ".concat(f[3],",").concat(f[3],",0,0,").concat(u,`,
        `).concat(t,",").concat(r+a-s*f[3])),d+="Z"}else if(o>0&&i===+i&&i>0){var x=Math.min(o,i);d="M ".concat(t,",").concat(r+s*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+l*x,",").concat(r,`
            L `).concat(t+n-l*x,",").concat(r,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+n,",").concat(r+s*x,`
            L `).concat(t+n,",").concat(r+a-s*x,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t+n-l*x,",").concat(r+a,`
            L `).concat(t+l*x,",").concat(r+a,`
            A `).concat(x,",").concat(x,",0,0,").concat(u,",").concat(t,",").concat(r+a-s*x," Z")}else d="M ".concat(t,",").concat(r," h ").concat(n," v ").concat(a," h ").concat(-n," Z");return d},QQ=function(t,r){if(!t||!r)return!1;var n=t.x,a=t.y,i=r.x,o=r.y,s=r.width,l=r.height;if(Math.abs(s)>0&&Math.abs(l)>0){var u=Math.min(i,i+s),d=Math.max(i,i+s),f=Math.min(o,o+l),h=Math.max(o,o+l);return n>=u&&n<=d&&a>=f&&a<=h}return!1},eee={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},L2=function(t){var r=H5(H5({},eee),t),n=j.useRef(),a=j.useState(-1),i=VQ(a,2),o=i[0],s=i[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var S=n.current.getTotalLength();S&&s(S)}catch{}},[]);var l=r.x,u=r.y,d=r.width,f=r.height,h=r.radius,p=r.className,x=r.animationEasing,b=r.animationDuration,y=r.animationBegin,m=r.isAnimationActive,g=r.isUpdateAnimationActive;if(l!==+l||u!==+u||d!==+d||f!==+f||d===0||f===0)return null;var k=hr("recharts-rectangle",p);return g?re.createElement($i,{canBegin:o>0,from:{width:d,height:f,x:l,y:u},to:{width:d,height:f,x:l,y:u},duration:b,animationEasing:x,isActive:g},function(S){var w=S.width,v=S.height,M=S.x,_=S.y;return re.createElement($i,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:b,isActive:m,easing:x},re.createElement("path",Ip({},Dt(r,!0),{className:k,d:X5(M,_,w,v,h),ref:n})))}):re.createElement("path",Ip({},Dt(r,!0),{className:k,d:X5(l,u,d,f,h)}))};function rb(){return rb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},rb.apply(this,arguments)}var nm=function(t){var r=t.cx,n=t.cy,a=t.r,i=t.className,o=hr("recharts-dot",i);return r===+r&&n===+n&&a===+a?j.createElement("circle",rb({},Dt(t,!1),Jh(t),{className:o,cx:r,cy:n,r:a})):null};function If(e){"@babel/helpers - typeof";return If=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},If(e)}var tee=["x","y","top","left","width","height","className"];function nb(){return nb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nb.apply(this,arguments)}function K5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ree(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?K5(Object(r),!0).forEach(function(n){nee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):K5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function nee(e,t,r){return t=aee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aee(e){var t=iee(e,"string");return If(t)=="symbol"?t:t+""}function iee(e,t){if(If(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(If(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function oee(e,t){if(e==null)return{};var r=see(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function see(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var lee=function(t,r,n,a,i,o){return"M".concat(t,",").concat(i,"v").concat(a,"M").concat(o,",").concat(r,"h").concat(n)},cee=function(t){var r=t.x,n=r===void 0?0:r,a=t.y,i=a===void 0?0:a,o=t.top,s=o===void 0?0:o,l=t.left,u=l===void 0?0:l,d=t.width,f=d===void 0?0:d,h=t.height,p=h===void 0?0:h,x=t.className,b=oee(t,tee),y=ree({x:n,y:i,top:s,left:u,width:f,height:p},b);return!Re(n)||!Re(i)||!Re(f)||!Re(p)||!Re(s)||!Re(u)?null:re.createElement("path",nb({},Dt(y,!0),{className:hr("recharts-cross",x),d:lee(n,i,f,p,s,u)}))},uee=ZP,dee=uee(Object.getPrototypeOf,Object),fee=dee,hee=Fo,pee=fee,gee=Go,mee="[object Object]",xee=Function.prototype,yee=Object.prototype,DC=xee.toString,bee=yee.hasOwnProperty,vee=DC.call(Object);function wee(e){if(!gee(e)||hee(e)!=mee)return!1;var t=pee(e);if(t===null)return!0;var r=bee.call(t,"constructor")&&t.constructor;return typeof r=="function"&&r instanceof r&&DC.call(r)==vee}var kee=wee;const See=Br(kee);var jee=Fo,Mee=Go,_ee="[object Boolean]";function Pee(e){return e===!0||e===!1||Mee(e)&&jee(e)==_ee}var Nee=Pee;const Cee=Br(Nee);function Rf(e){"@babel/helpers - typeof";return Rf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Rf(e)}function Rp(){return Rp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Rp.apply(this,arguments)}function Oee(e,t){return Iee(e)||Eee(e,t)||Tee(e,t)||Aee()}function Aee(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Tee(e,t){if(e){if(typeof e=="string")return Y5(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Y5(e,t)}}function Y5(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Eee(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function Iee(e){if(Array.isArray(e))return e}function q5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Z5(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?q5(Object(r),!0).forEach(function(n){Ree(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Ree(e,t,r){return t=Dee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Dee(e){var t=$ee(e,"string");return Rf(t)=="symbol"?t:t+""}function $ee(e,t){if(Rf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Rf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var J5=function(t,r,n,a,i){var o=n-a,s;return s="M ".concat(t,",").concat(r),s+="L ".concat(t+n,",").concat(r),s+="L ".concat(t+n-o/2,",").concat(r+i),s+="L ".concat(t+n-o/2-a,",").concat(r+i),s+="L ".concat(t,",").concat(r," Z"),s},Lee={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},Bee=function(t){var r=Z5(Z5({},Lee),t),n=j.useRef(),a=j.useState(-1),i=Oee(a,2),o=i[0],s=i[1];j.useEffect(function(){if(n.current&&n.current.getTotalLength)try{var k=n.current.getTotalLength();k&&s(k)}catch{}},[]);var l=r.x,u=r.y,d=r.upperWidth,f=r.lowerWidth,h=r.height,p=r.className,x=r.animationEasing,b=r.animationDuration,y=r.animationBegin,m=r.isUpdateAnimationActive;if(l!==+l||u!==+u||d!==+d||f!==+f||h!==+h||d===0&&f===0||h===0)return null;var g=hr("recharts-trapezoid",p);return m?re.createElement($i,{canBegin:o>0,from:{upperWidth:0,lowerWidth:0,height:h,x:l,y:u},to:{upperWidth:d,lowerWidth:f,height:h,x:l,y:u},duration:b,animationEasing:x,isActive:m},function(k){var S=k.upperWidth,w=k.lowerWidth,v=k.height,M=k.x,_=k.y;return re.createElement($i,{canBegin:o>0,from:"0px ".concat(o===-1?1:o,"px"),to:"".concat(o,"px 0px"),attributeName:"strokeDasharray",begin:y,duration:b,easing:x},re.createElement("path",Rp({},Dt(r,!0),{className:g,d:J5(M,_,S,w,v),ref:n})))}):re.createElement("g",null,re.createElement("path",Rp({},Dt(r,!0),{className:g,d:J5(l,u,d,f,h)})))},Fee=["option","shapeType","propTransformer","activeClassName","isActive"];function Df(e){"@babel/helpers - typeof";return Df=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Df(e)}function Gee(e,t){if(e==null)return{};var r=Uee(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Uee(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Q5(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Dp(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?Q5(Object(r),!0).forEach(function(n){zee(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q5(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function zee(e,t,r){return t=Wee(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Wee(e){var t=Vee(e,"string");return Df(t)=="symbol"?t:t+""}function Vee(e,t){if(Df(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Df(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Hee(e,t){return Dp(Dp({},t),e)}function Xee(e,t){return e==="symbols"}function e4(e){var t=e.shapeType,r=e.elementProps;switch(t){case"rectangle":return re.createElement(L2,r);case"trapezoid":return re.createElement(Bee,r);case"sector":return re.createElement(MC,r);case"symbols":if(Xee(t))return re.createElement(Wg,r);break;default:return null}}function Kee(e){return j.isValidElement(e)?e.props:e}function ab(e){var t=e.option,r=e.shapeType,n=e.propTransformer,a=n===void 0?Hee:n,i=e.activeClassName,o=i===void 0?"recharts-active-shape":i,s=e.isActive,l=Gee(e,Fee),u;if(j.isValidElement(t))u=j.cloneElement(t,Dp(Dp({},l),Kee(t)));else if(Bt(t))u=t(l);else if(See(t)&&!Cee(t)){var d=a(t,l);u=re.createElement(e4,{shapeType:r,elementProps:d})}else{var f=l;u=re.createElement(e4,{shapeType:r,elementProps:f})}return s?re.createElement(_r,{className:o},u):u}function am(e,t){return t!=null&&"trapezoids"in e.props}function im(e,t){return t!=null&&"sectors"in e.props}function $f(e,t){return t!=null&&"points"in e.props}function Yee(e,t){var r,n,a=e.x===(t==null||(r=t.labelViewBox)===null||r===void 0?void 0:r.x)||e.x===t.x,i=e.y===(t==null||(n=t.labelViewBox)===null||n===void 0?void 0:n.y)||e.y===t.y;return a&&i}function qee(e,t){var r=e.endAngle===t.endAngle,n=e.startAngle===t.startAngle;return r&&n}function Zee(e,t){var r=e.x===t.x,n=e.y===t.y,a=e.z===t.z;return r&&n&&a}function Jee(e,t){var r;return am(e,t)?r=Yee:im(e,t)?r=qee:$f(e,t)&&(r=Zee),r}function Qee(e,t){var r;return am(e,t)?r="trapezoids":im(e,t)?r="sectors":$f(e,t)&&(r="points"),r}function ete(e,t){if(am(e,t)){var r;return(r=t.tooltipPayload)===null||r===void 0||(r=r[0])===null||r===void 0||(r=r.payload)===null||r===void 0?void 0:r.payload}if(im(e,t)){var n;return(n=t.tooltipPayload)===null||n===void 0||(n=n[0])===null||n===void 0||(n=n.payload)===null||n===void 0?void 0:n.payload}return $f(e,t)?t.payload:{}}function tte(e){var t=e.activeTooltipItem,r=e.graphicalItem,n=e.itemData,a=Qee(r,t),i=ete(r,t),o=n.filter(function(l,u){var d=Fl(i,l),f=r.props[a].filter(function(x){var b=Jee(r,t);return b(x,t)}),h=r.props[a].indexOf(f[f.length-1]),p=u===h;return d&&p}),s=n.indexOf(o[o.length-1]);return s}var rte=Math.ceil,nte=Math.max;function ate(e,t,r,n){for(var a=-1,i=nte(rte((t-e)/(r||1)),0),o=Array(i);i--;)o[n?i:++a]=e,e+=r;return o}var ite=ate,ote=mN,t4=1/0,ste=17976931348623157e292;function lte(e){if(!e)return e===0?e:0;if(e=ote(e),e===t4||e===-t4){var t=e<0?-1:1;return t*ste}return e===e?e:0}var $C=lte,cte=ite,ute=Xg,Lx=$C;function dte(e){return function(t,r,n){return n&&typeof n!="number"&&ute(t,r,n)&&(r=n=void 0),t=Lx(t),r===void 0?(r=t,t=0):r=Lx(r),n=n===void 0?t<r?1:-1:Lx(n),cte(t,r,n,e)}}var fte=dte,hte=fte,pte=hte(),gte=pte;const $p=Br(gte);function Lf(e){"@babel/helpers - typeof";return Lf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Lf(e)}function r4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function n4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?r4(Object(r),!0).forEach(function(n){LC(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):r4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function LC(e,t,r){return t=mte(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mte(e){var t=xte(e,"string");return Lf(t)=="symbol"?t:t+""}function xte(e,t){if(Lf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Lf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var yte=["Webkit","Moz","O","ms"],bte=function(t,r){var n=t.replace(/(\w)/,function(i){return i.toUpperCase()}),a=yte.reduce(function(i,o){return n4(n4({},i),{},LC({},o+n,r))},{});return a[t]=r,a};function cu(e){"@babel/helpers - typeof";return cu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},cu(e)}function Lp(){return Lp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Lp.apply(this,arguments)}function a4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Bx(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?a4(Object(r),!0).forEach(function(n){za(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function vte(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,FC(n.key),n)}}function wte(e,t,r){return t&&i4(e.prototype,t),r&&i4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kte(e,t,r){return t=Bp(t),Ste(e,BC()?Reflect.construct(t,r||[],Bp(e).constructor):t.apply(e,r))}function Ste(e,t){if(t&&(cu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jte(e)}function jte(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function BC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(BC=function(){return!!e})()}function Bp(e){return Bp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Bp(e)}function Mte(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ib(e,t)}function ib(e,t){return ib=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},ib(e,t)}function za(e,t,r){return t=FC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function FC(e){var t=_te(e,"string");return cu(t)=="symbol"?t:t+""}function _te(e,t){if(cu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(cu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Pte=function(t){var r=t.data,n=t.startIndex,a=t.endIndex,i=t.x,o=t.width,s=t.travellerWidth;if(!r||!r.length)return{};var l=r.length,u=$d().domain($p(0,l)).range([i,i+o-s]),d=u.domain().map(function(f){return u(f)});return{isTextActive:!1,isSlideMoving:!1,isTravellerMoving:!1,isTravellerFocused:!1,startX:u(n),endX:u(a),scale:u,scaleValues:d}},o4=function(t){return t.changedTouches&&!!t.changedTouches.length},uu=function(e){function t(r){var n;return vte(this,t),n=kte(this,t,[r]),za(n,"handleDrag",function(a){n.leaveTimer&&(clearTimeout(n.leaveTimer),n.leaveTimer=null),n.state.isTravellerMoving?n.handleTravellerMove(a):n.state.isSlideMoving&&n.handleSlideDrag(a)}),za(n,"handleTouchMove",function(a){a.changedTouches!=null&&a.changedTouches.length>0&&n.handleDrag(a.changedTouches[0])}),za(n,"handleDragEnd",function(){n.setState({isTravellerMoving:!1,isSlideMoving:!1},function(){var a=n.props,i=a.endIndex,o=a.onDragEnd,s=a.startIndex;o==null||o({endIndex:i,startIndex:s})}),n.detachDragEndListener()}),za(n,"handleLeaveWrapper",function(){(n.state.isTravellerMoving||n.state.isSlideMoving)&&(n.leaveTimer=window.setTimeout(n.handleDragEnd,n.props.leaveTimeOut))}),za(n,"handleEnterSlideOrTraveller",function(){n.setState({isTextActive:!0})}),za(n,"handleLeaveSlideOrTraveller",function(){n.setState({isTextActive:!1})}),za(n,"handleSlideDragStart",function(a){var i=o4(a)?a.changedTouches[0]:a;n.setState({isTravellerMoving:!1,isSlideMoving:!0,slideMoveStartX:i.pageX}),n.attachDragEndListener()}),n.travellerDragStartHandlers={startX:n.handleTravellerDragStart.bind(n,"startX"),endX:n.handleTravellerDragStart.bind(n,"endX")},n.state={},n}return Mte(t,e),wte(t,[{key:"componentWillUnmount",value:function(){this.leaveTimer&&(clearTimeout(this.leaveTimer),this.leaveTimer=null),this.detachDragEndListener()}},{key:"getIndex",value:function(n){var a=n.startX,i=n.endX,o=this.state.scaleValues,s=this.props,l=s.gap,u=s.data,d=u.length-1,f=Math.min(a,i),h=Math.max(a,i),p=t.getIndexInRange(o,f),x=t.getIndexInRange(o,h);return{startIndex:p-p%l,endIndex:x===d?d:x-x%l}}},{key:"getTextOfTick",value:function(n){var a=this.props,i=a.data,o=a.tickFormatter,s=a.dataKey,l=Bn(i[n],s,n);return Bt(o)?o(l,n):l}},{key:"attachDragEndListener",value:function(){window.addEventListener("mouseup",this.handleDragEnd,!0),window.addEventListener("touchend",this.handleDragEnd,!0),window.addEventListener("mousemove",this.handleDrag,!0)}},{key:"detachDragEndListener",value:function(){window.removeEventListener("mouseup",this.handleDragEnd,!0),window.removeEventListener("touchend",this.handleDragEnd,!0),window.removeEventListener("mousemove",this.handleDrag,!0)}},{key:"handleSlideDrag",value:function(n){var a=this.state,i=a.slideMoveStartX,o=a.startX,s=a.endX,l=this.props,u=l.x,d=l.width,f=l.travellerWidth,h=l.startIndex,p=l.endIndex,x=l.onChange,b=n.pageX-i;b>0?b=Math.min(b,u+d-f-s,u+d-f-o):b<0&&(b=Math.max(b,u-o,u-s));var y=this.getIndex({startX:o+b,endX:s+b});(y.startIndex!==h||y.endIndex!==p)&&x&&x(y),this.setState({startX:o+b,endX:s+b,slideMoveStartX:n.pageX})}},{key:"handleTravellerDragStart",value:function(n,a){var i=o4(a)?a.changedTouches[0]:a;this.setState({isSlideMoving:!1,isTravellerMoving:!0,movingTravellerId:n,brushMoveStartX:i.pageX}),this.attachDragEndListener()}},{key:"handleTravellerMove",value:function(n){var a=this.state,i=a.brushMoveStartX,o=a.movingTravellerId,s=a.endX,l=a.startX,u=this.state[o],d=this.props,f=d.x,h=d.width,p=d.travellerWidth,x=d.onChange,b=d.gap,y=d.data,m={startX:this.state.startX,endX:this.state.endX},g=n.pageX-i;g>0?g=Math.min(g,f+h-p-u):g<0&&(g=Math.max(g,f-u)),m[o]=u+g;var k=this.getIndex(m),S=k.startIndex,w=k.endIndex,v=function(){var _=y.length-1;return o==="startX"&&(s>l?S%b===0:w%b===0)||s<l&&w===_||o==="endX"&&(s>l?w%b===0:S%b===0)||s>l&&w===_};this.setState(za(za({},o,u+g),"brushMoveStartX",n.pageX),function(){x&&v()&&x(k)})}},{key:"handleTravellerMoveKeyboard",value:function(n,a){var i=this,o=this.state,s=o.scaleValues,l=o.startX,u=o.endX,d=this.state[a],f=s.indexOf(d);if(f!==-1){var h=f+n;if(!(h===-1||h>=s.length)){var p=s[h];a==="startX"&&p>=u||a==="endX"&&p<=l||this.setState(za({},a,p),function(){i.props.onChange(i.getIndex({startX:i.state.startX,endX:i.state.endX}))})}}}},{key:"renderBackground",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.fill,u=n.stroke;return re.createElement("rect",{stroke:u,fill:l,x:a,y:i,width:o,height:s})}},{key:"renderPanorama",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.data,u=n.children,d=n.padding,f=j.Children.only(u);return f?re.cloneElement(f,{x:a,y:i,width:o,height:s,margin:d,compact:!0,data:l}):null}},{key:"renderTravellerLayer",value:function(n,a){var i,o,s=this,l=this.props,u=l.y,d=l.travellerWidth,f=l.height,h=l.traveller,p=l.ariaLabel,x=l.data,b=l.startIndex,y=l.endIndex,m=Math.max(n,this.props.x),g=Bx(Bx({},Dt(this.props,!1)),{},{x:m,y:u,width:d,height:f}),k=p||"Min value: ".concat((i=x[b])===null||i===void 0?void 0:i.name,", Max value: ").concat((o=x[y])===null||o===void 0?void 0:o.name);return re.createElement(_r,{tabIndex:0,role:"slider","aria-label":k,"aria-valuenow":n,className:"recharts-brush-traveller",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.travellerDragStartHandlers[a],onTouchStart:this.travellerDragStartHandlers[a],onKeyDown:function(w){["ArrowLeft","ArrowRight"].includes(w.key)&&(w.preventDefault(),w.stopPropagation(),s.handleTravellerMoveKeyboard(w.key==="ArrowRight"?1:-1,a))},onFocus:function(){s.setState({isTravellerFocused:!0})},onBlur:function(){s.setState({isTravellerFocused:!1})},style:{cursor:"col-resize"}},t.renderTraveller(h,g))}},{key:"renderSlide",value:function(n,a){var i=this.props,o=i.y,s=i.height,l=i.stroke,u=i.travellerWidth,d=Math.min(n,a)+u,f=Math.max(Math.abs(a-n)-u,0);return re.createElement("rect",{className:"recharts-brush-slide",onMouseEnter:this.handleEnterSlideOrTraveller,onMouseLeave:this.handleLeaveSlideOrTraveller,onMouseDown:this.handleSlideDragStart,onTouchStart:this.handleSlideDragStart,style:{cursor:"move"},stroke:"none",fill:l,fillOpacity:.2,x:d,y:o,width:f,height:s})}},{key:"renderText",value:function(){var n=this.props,a=n.startIndex,i=n.endIndex,o=n.y,s=n.height,l=n.travellerWidth,u=n.stroke,d=this.state,f=d.startX,h=d.endX,p=5,x={pointerEvents:"none",fill:u};return re.createElement(_r,{className:"recharts-brush-texts"},re.createElement(fp,Lp({textAnchor:"end",verticalAnchor:"middle",x:Math.min(f,h)-p,y:o+s/2},x),this.getTextOfTick(a)),re.createElement(fp,Lp({textAnchor:"start",verticalAnchor:"middle",x:Math.max(f,h)+l+p,y:o+s/2},x),this.getTextOfTick(i)))}},{key:"render",value:function(){var n=this.props,a=n.data,i=n.className,o=n.children,s=n.x,l=n.y,u=n.width,d=n.height,f=n.alwaysShowText,h=this.state,p=h.startX,x=h.endX,b=h.isTextActive,y=h.isSlideMoving,m=h.isTravellerMoving,g=h.isTravellerFocused;if(!a||!a.length||!Re(s)||!Re(l)||!Re(u)||!Re(d)||u<=0||d<=0)return null;var k=hr("recharts-brush",i),S=re.Children.count(o)===1,w=bte("userSelect","none");return re.createElement(_r,{className:k,onMouseLeave:this.handleLeaveWrapper,onTouchMove:this.handleTouchMove,style:w},this.renderBackground(),S&&this.renderPanorama(),this.renderSlide(p,x),this.renderTravellerLayer(p,"startX"),this.renderTravellerLayer(x,"endX"),(b||y||m||g||f)&&this.renderText())}}],[{key:"renderDefaultTraveller",value:function(n){var a=n.x,i=n.y,o=n.width,s=n.height,l=n.stroke,u=Math.floor(i+s/2)-1;return re.createElement(re.Fragment,null,re.createElement("rect",{x:a,y:i,width:o,height:s,fill:l,stroke:"none"}),re.createElement("line",{x1:a+1,y1:u,x2:a+o-1,y2:u,fill:"none",stroke:"#fff"}),re.createElement("line",{x1:a+1,y1:u+2,x2:a+o-1,y2:u+2,fill:"none",stroke:"#fff"}))}},{key:"renderTraveller",value:function(n,a){var i;return re.isValidElement(n)?i=re.cloneElement(n,a):Bt(n)?i=n(a):i=t.renderDefaultTraveller(a),i}},{key:"getDerivedStateFromProps",value:function(n,a){var i=n.data,o=n.width,s=n.x,l=n.travellerWidth,u=n.updateId,d=n.startIndex,f=n.endIndex;if(i!==a.prevData||u!==a.prevUpdateId)return Bx({prevData:i,prevTravellerWidth:l,prevUpdateId:u,prevX:s,prevWidth:o},i&&i.length?Pte({data:i,width:o,x:s,travellerWidth:l,startIndex:d,endIndex:f}):{scale:null,scaleValues:null});if(a.scale&&(o!==a.prevWidth||s!==a.prevX||l!==a.prevTravellerWidth)){a.scale.range([s,s+o-l]);var h=a.scale.domain().map(function(p){return a.scale(p)});return{prevData:i,prevTravellerWidth:l,prevUpdateId:u,prevX:s,prevWidth:o,startX:a.scale(n.startIndex),endX:a.scale(n.endIndex),scaleValues:h}}return null}},{key:"getIndexInRange",value:function(n,a){for(var i=n.length,o=0,s=i-1;s-o>1;){var l=Math.floor((o+s)/2);n[l]>a?s=l:o=l}return a>=n[s]?s:o}}])}(j.PureComponent);za(uu,"displayName","Brush");za(uu,"defaultProps",{height:40,travellerWidth:5,gap:1,fill:"#fff",stroke:"#666",padding:{top:1,right:1,bottom:1,left:1},leaveTimeOut:1e3,alwaysShowText:!1});var Nte=c2;function Cte(e,t){var r;return Nte(e,function(n,a,i){return r=t(n,a,i),!r}),!!r}var Ote=Cte,Ate=zP,Tte=zs,Ete=Ote,Ite=$a,Rte=Xg;function Dte(e,t,r){var n=Ite(e)?Ate:Ete;return r&&Rte(e,t,r)&&(t=void 0),n(e,Tte(t))}var $te=Dte;const Lte=Br($te);var ro=function(t,r){var n=t.alwaysShow,a=t.ifOverflow;return n&&(a="extendDomain"),a===r},s4=dN;function Bte(e,t,r){t=="__proto__"&&s4?s4(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}var Fte=Bte,Gte=Fte,Ute=cN,zte=zs;function Wte(e,t){var r={};return t=zte(t),Ute(e,function(n,a,i){Gte(r,a,t(n,a,i))}),r}var Vte=Wte;const Hte=Br(Vte);function Xte(e,t){for(var r=-1,n=e==null?0:e.length;++r<n;)if(!t(e[r],r,e))return!1;return!0}var Kte=Xte,Yte=c2;function qte(e,t){var r=!0;return Yte(e,function(n,a,i){return r=!!t(n,a,i),r}),r}var Zte=qte,Jte=Kte,Qte=Zte,ere=zs,tre=$a,rre=Xg;function nre(e,t,r){var n=tre(e)?Jte:Qte;return r&&rre(e,t,r)&&(t=void 0),n(e,ere(t))}var are=nre;const GC=Br(are);var ire=["x","y"];function Bf(e){"@babel/helpers - typeof";return Bf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bf(e)}function ob(){return ob=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ob.apply(this,arguments)}function l4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function yd(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?l4(Object(r),!0).forEach(function(n){ore(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function ore(e,t,r){return t=sre(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function sre(e){var t=lre(e,"string");return Bf(t)=="symbol"?t:t+""}function lre(e,t){if(Bf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Bf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function cre(e,t){if(e==null)return{};var r=ure(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function ure(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function dre(e,t){var r=e.x,n=e.y,a=cre(e,ire),i="".concat(r),o=parseInt(i,10),s="".concat(n),l=parseInt(s,10),u="".concat(t.height||a.height),d=parseInt(u,10),f="".concat(t.width||a.width),h=parseInt(f,10);return yd(yd(yd(yd(yd({},t),a),o?{x:o}:{}),l?{y:l}:{}),{},{height:d,width:h,name:t.name,radius:t.radius})}function c4(e){return re.createElement(ab,ob({shapeType:"rectangle",propTransformer:dre,activeClassName:"recharts-active-bar"},e))}var fre=function(t){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;return function(n,a){if(typeof t=="number")return t;var i=Re(n)||_$(n);return i?t(n,a):(i||Ul(),r)}},hre=["value","background"],UC;function du(e){"@babel/helpers - typeof";return du=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},du(e)}function pre(e,t){if(e==null)return{};var r=gre(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gre(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Fp(){return Fp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fp.apply(this,arguments)}function u4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function jn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?u4(Object(r),!0).forEach(function(n){bs(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,WC(n.key),n)}}function xre(e,t,r){return t&&d4(e.prototype,t),r&&d4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function yre(e,t,r){return t=Gp(t),bre(e,zC()?Reflect.construct(t,r||[],Gp(e).constructor):t.apply(e,r))}function bre(e,t){if(t&&(du(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return vre(e)}function vre(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function zC(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(zC=function(){return!!e})()}function Gp(e){return Gp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Gp(e)}function wre(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&sb(e,t)}function sb(e,t){return sb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},sb(e,t)}function bs(e,t,r){return t=WC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function WC(e){var t=kre(e,"string");return du(t)=="symbol"?t:t+""}function kre(e,t){if(du(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(du(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var t0=function(e){function t(){var r;mre(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=yre(this,t,[].concat(a)),bs(r,"state",{isAnimationFinished:!1}),bs(r,"id",Kl("recharts-bar-")),bs(r,"handleAnimationEnd",function(){var o=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),o&&o()}),bs(r,"handleAnimationStart",function(){var o=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),o&&o()}),r}return wre(t,e),xre(t,[{key:"renderRectanglesStatically",value:function(n){var a=this,i=this.props,o=i.shape,s=i.dataKey,l=i.activeIndex,u=i.activeBar,d=Dt(this.props,!1);return n&&n.map(function(f,h){var p=h===l,x=p?u:o,b=jn(jn(jn({},d),f),{},{isActive:p,option:x,index:h,dataKey:s,onAnimationStart:a.handleAnimationStart,onAnimationEnd:a.handleAnimationEnd});return re.createElement(_r,Fp({className:"recharts-bar-rectangle"},lf(a.props,f,h),{key:"rectangle-".concat(f==null?void 0:f.x,"-").concat(f==null?void 0:f.y,"-").concat(f==null?void 0:f.value,"-").concat(h)}),re.createElement(c4,b))})}},{key:"renderRectanglesWithAnimation",value:function(){var n=this,a=this.props,i=a.data,o=a.layout,s=a.isAnimationActive,l=a.animationBegin,u=a.animationDuration,d=a.animationEasing,f=a.animationId,h=this.state.prevData;return re.createElement($i,{begin:l,duration:u,isActive:s,easing:d,from:{t:0},to:{t:1},key:"bar-".concat(f),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(p){var x=p.t,b=i.map(function(y,m){var g=h&&h[m];if(g){var k=xn(g.x,y.x),S=xn(g.y,y.y),w=xn(g.width,y.width),v=xn(g.height,y.height);return jn(jn({},y),{},{x:k(x),y:S(x),width:w(x),height:v(x)})}if(o==="horizontal"){var M=xn(0,y.height),_=M(x);return jn(jn({},y),{},{y:y.y+y.height-_,height:_})}var P=xn(0,y.width),A=P(x);return jn(jn({},y),{},{width:A})});return re.createElement(_r,null,n.renderRectanglesStatically(b))})}},{key:"renderRectangles",value:function(){var n=this.props,a=n.data,i=n.isAnimationActive,o=this.state.prevData;return i&&a&&a.length&&(!o||!Fl(o,a))?this.renderRectanglesWithAnimation():this.renderRectanglesStatically(a)}},{key:"renderBackground",value:function(){var n=this,a=this.props,i=a.data,o=a.dataKey,s=a.activeIndex,l=Dt(this.props.background,!1);return i.map(function(u,d){u.value;var f=u.background,h=pre(u,hre);if(!f)return null;var p=jn(jn(jn(jn(jn({},h),{},{fill:"#eee"},f),l),lf(n.props,u,d)),{},{onAnimationStart:n.handleAnimationStart,onAnimationEnd:n.handleAnimationEnd,dataKey:o,index:d,className:"recharts-bar-background-rectangle"});return re.createElement(c4,Fp({key:"background-bar-".concat(d),option:n.props.background,isActive:d===s},p))})}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.data,s=i.xAxis,l=i.yAxis,u=i.layout,d=i.children,f=Da(d,Uu);if(!f)return null;var h=u==="vertical"?o[0].height/2:o[0].width/2,p=function(y,m){var g=Array.isArray(y.value)?y.value[1]:y.value;return{x:y.x,y:y.y,value:g,errorVal:Bn(y,m)}},x={clipPath:n?"url(#clipPath-".concat(a,")"):null};return re.createElement(_r,x,f.map(function(b){return re.cloneElement(b,{key:"error-bar-".concat(a,"-").concat(b.props.dataKey),data:o,xAxis:s,yAxis:l,layout:u,offset:h,dataPointFormatter:p})}))}},{key:"render",value:function(){var n=this.props,a=n.hide,i=n.data,o=n.className,s=n.xAxis,l=n.yAxis,u=n.left,d=n.top,f=n.width,h=n.height,p=n.isAnimationActive,x=n.background,b=n.id;if(a||!i||!i.length)return null;var y=this.state.isAnimationFinished,m=hr("recharts-bar",o),g=s&&s.allowDataOverflow,k=l&&l.allowDataOverflow,S=g||k,w=Et(b)?this.id:b;return re.createElement(_r,{className:m},g||k?re.createElement("defs",null,re.createElement("clipPath",{id:"clipPath-".concat(w)},re.createElement("rect",{x:g?u:u-f/2,y:k?d:d-h/2,width:g?f:f*2,height:k?h:h*2}))):null,re.createElement(_r,{className:"recharts-bar-rectangles",clipPath:S?"url(#clipPath-".concat(w,")"):null},x?this.renderBackground():null,this.renderRectangles()),this.renderErrorBar(S,w),(!p||y)&&to.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curData:n.data,prevData:a.curData}:n.data!==a.curData?{curData:n.data}:null}}])}(j.PureComponent);UC=t0;bs(t0,"displayName","Bar");bs(t0,"defaultProps",{xAxisId:0,yAxisId:0,legendType:"rect",minPointSize:0,hide:!1,data:[],layout:"vertical",activeBar:!1,isAnimationActive:!Ws.isSsr,animationBegin:0,animationDuration:400,animationEasing:"ease"});bs(t0,"getComposedData",function(e){var t=e.props,r=e.item,n=e.barPosition,a=e.bandSize,i=e.xAxis,o=e.yAxis,s=e.xAxisTicks,l=e.yAxisTicks,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=Yq(n,r);if(!p)return null;var x=t.layout,b=r.type.defaultProps,y=b!==void 0?jn(jn({},b),r.props):r.props,m=y.dataKey,g=y.children,k=y.minPointSize,S=x==="horizontal"?o:i,w=u?S.scale.domain():null,v=nZ({numericAxis:S}),M=Da(g,f2),_=f.map(function(P,A){var R,D,E,W,F,O;u?R=qq(u[d+A],w):(R=Bn(P,m),Array.isArray(R)||(R=[v,R]));var $=fre(k,UC.defaultProps.minPointSize)(R[1],A);if(x==="horizontal"){var N,C=[o.scale(R[0]),o.scale(R[1])],B=C[0],I=C[1];D=h5({axis:i,ticks:s,bandSize:a,offset:p.offset,entry:P,index:A}),E=(N=I??B)!==null&&N!==void 0?N:void 0,W=p.size;var z=B-I;if(F=Number.isNaN(z)?0:z,O={x:D,y:o.y,width:W,height:o.height},Math.abs($)>0&&Math.abs(F)<Math.abs($)){var V=Ti(F||$)*(Math.abs($)-Math.abs(F));E-=V,F+=V}}else{var K=[i.scale(R[0]),i.scale(R[1])],q=K[0],G=K[1];if(D=q,E=h5({axis:o,ticks:l,bandSize:a,offset:p.offset,entry:P,index:A}),W=G-q,F=p.size,O={x:i.x,y:E,width:i.width,height:F},Math.abs($)>0&&Math.abs(W)<Math.abs($)){var pe=Ti(W||$)*(Math.abs($)-Math.abs(W));W+=pe}}return jn(jn(jn({},P),{},{x:D,y:E,width:W,height:F,value:u?R:R[1],payload:P,background:O},M&&M[A]&&M[A].props),{},{tooltipPayload:[kC(r,P)],tooltipPosition:{x:D+W/2,y:E+F/2}})});return jn({data:_,layout:x},h)});function Ff(e){"@babel/helpers - typeof";return Ff=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ff(e)}function Sre(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,VC(n.key),n)}}function jre(e,t,r){return t&&f4(e.prototype,t),r&&f4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function h4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Pi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?h4(Object(r),!0).forEach(function(n){om(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function om(e,t,r){return t=VC(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function VC(e){var t=Mre(e,"string");return Ff(t)=="symbol"?t:t+""}function Mre(e,t){if(Ff(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Ff(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var B2=function(t,r,n,a,i){var o=t.width,s=t.height,l=t.layout,u=t.children,d=Object.keys(r),f={left:n.left,leftMirror:n.left,right:o-n.right,rightMirror:o-n.right,top:n.top,topMirror:n.top,bottom:s-n.bottom,bottomMirror:s-n.bottom},h=!!Va(u,t0);return d.reduce(function(p,x){var b=r[x],y=b.orientation,m=b.domain,g=b.padding,k=g===void 0?{}:g,S=b.mirror,w=b.reversed,v="".concat(y).concat(S?"Mirror":""),M,_,P,A,R;if(b.type==="number"&&(b.padding==="gap"||b.padding==="no-gap")){var D=m[1]-m[0],E=1/0,W=b.categoricalDomain.sort(O$);if(W.forEach(function(K,q){q>0&&(E=Math.min((K||0)-(W[q-1]||0),E))}),Number.isFinite(E)){var F=E/D,O=b.layout==="vertical"?n.height:n.width;if(b.padding==="gap"&&(M=F*O/2),b.padding==="no-gap"){var $=Bl(t.barCategoryGap,F*O),N=F*O/2;M=N-$-(N-$)/O*$}}}a==="xAxis"?_=[n.left+(k.left||0)+(M||0),n.left+n.width-(k.right||0)-(M||0)]:a==="yAxis"?_=l==="horizontal"?[n.top+n.height-(k.bottom||0),n.top+(k.top||0)]:[n.top+(k.top||0)+(M||0),n.top+n.height-(k.bottom||0)-(M||0)]:_=b.range,w&&(_=[_[1],_[0]]);var C=Xq(b,i,h),B=C.scale,I=C.realScaleType;B.domain(m).range(_),Kq(B);var z=rZ(B,Pi(Pi({},b),{},{realScaleType:I}));a==="xAxis"?(R=y==="top"&&!S||y==="bottom"&&S,P=n.left,A=f[v]-R*b.height):a==="yAxis"&&(R=y==="left"&&!S||y==="right"&&S,P=f[v]-R*b.width,A=n.top);var V=Pi(Pi(Pi({},b),z),{},{realScaleType:I,x:P,y:A,scale:B,width:a==="xAxis"?n.width:b.width,height:a==="yAxis"?n.height:b.height});return V.bandSize=Pp(V,z),!b.hide&&a==="xAxis"?f[v]+=(R?-1:1)*V.height:b.hide||(f[v]+=(R?-1:1)*V.width),Pi(Pi({},p),{},om({},x,V))},{})},HC=function(t,r){var n=t.x,a=t.y,i=r.x,o=r.y;return{x:Math.min(n,i),y:Math.min(a,o),width:Math.abs(i-n),height:Math.abs(o-a)}},_re=function(t){var r=t.x1,n=t.y1,a=t.x2,i=t.y2;return HC({x:r,y:n},{x:a,y:i})},XC=function(){function e(t){Sre(this,e),this.scale=t}return jre(e,[{key:"domain",get:function(){return this.scale.domain}},{key:"range",get:function(){return this.scale.range}},{key:"rangeMin",get:function(){return this.range()[0]}},{key:"rangeMax",get:function(){return this.range()[1]}},{key:"bandwidth",get:function(){return this.scale.bandwidth}},{key:"apply",value:function(r){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=n.bandAware,i=n.position;if(r!==void 0){if(i)switch(i){case"start":return this.scale(r);case"middle":{var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+o}case"end":{var s=this.bandwidth?this.bandwidth():0;return this.scale(r)+s}default:return this.scale(r)}if(a){var l=this.bandwidth?this.bandwidth()/2:0;return this.scale(r)+l}return this.scale(r)}}},{key:"isInRange",value:function(r){var n=this.range(),a=n[0],i=n[n.length-1];return a<=i?r>=a&&r<=i:r>=i&&r<=a}}],[{key:"create",value:function(r){return new e(r)}}])}();om(XC,"EPS",1e-4);var F2=function(t){var r=Object.keys(t).reduce(function(n,a){return Pi(Pi({},n),{},om({},a,XC.create(t[a])))},{});return Pi(Pi({},r),{},{apply:function(a){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.bandAware,s=i.position;return Hte(a,function(l,u){return r[u].apply(l,{bandAware:o,position:s})})},isInRange:function(a){return GC(a,function(i,o){return r[o].isInRange(i)})}})};function Pre(e){return(e%180+180)%180}var Nre=function(t){var r=t.width,n=t.height,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=Pre(a),o=i*Math.PI/180,s=Math.atan(n/r),l=o>s&&o<Math.PI-s?n/Math.sin(o):r/Math.cos(o);return Math.abs(l)},Cre=zs,Ore=qf,Are=Vg;function Tre(e){return function(t,r,n){var a=Object(t);if(!Ore(t)){var i=Cre(r);t=Are(t),r=function(s){return i(a[s],s,a)}}var o=e(t,r,n);return o>-1?a[i?t[o]:o]:void 0}}var Ere=Tre,Ire=$C;function Rre(e){var t=Ire(e),r=t%1;return t===t?r?t-r:t:0}var Dre=Rre,$re=nN,Lre=zs,Bre=Dre,Fre=Math.max;function Gre(e,t,r){var n=e==null?0:e.length;if(!n)return-1;var a=r==null?0:Bre(r);return a<0&&(a=Fre(n+a,0)),$re(e,Lre(t),a)}var Ure=Gre,zre=Ere,Wre=Ure,Vre=zre(Wre),Hre=Vre;const Xre=Br(Hre);var Kre=TD(function(e){return{x:e.left,y:e.top,width:e.width,height:e.height}},function(e){return["l",e.left,"t",e.top,"w",e.width,"h",e.height].join("")}),G2=j.createContext(void 0),U2=j.createContext(void 0),KC=j.createContext(void 0),YC=j.createContext({}),qC=j.createContext(void 0),ZC=j.createContext(0),JC=j.createContext(0),p4=function(t){var r=t.state,n=r.xAxisMap,a=r.yAxisMap,i=r.offset,o=t.clipPathId,s=t.children,l=t.width,u=t.height,d=Kre(i);return re.createElement(G2.Provider,{value:n},re.createElement(U2.Provider,{value:a},re.createElement(YC.Provider,{value:i},re.createElement(KC.Provider,{value:d},re.createElement(qC.Provider,{value:o},re.createElement(ZC.Provider,{value:u},re.createElement(JC.Provider,{value:l},s)))))))},Yre=function(){return j.useContext(qC)},QC=function(t){var r=j.useContext(G2);r==null&&Ul();var n=r[t];return n==null&&Ul(),n},qre=function(){var t=j.useContext(G2);return us(t)},Zre=function(){var t=j.useContext(U2),r=Xre(t,function(n){return GC(n.domain,Number.isFinite)});return r||us(t)},eO=function(t){var r=j.useContext(U2);r==null&&Ul();var n=r[t];return n==null&&Ul(),n},Jre=function(){var t=j.useContext(KC);return t},Qre=function(){return j.useContext(YC)},z2=function(){return j.useContext(JC)},W2=function(){return j.useContext(ZC)};function fu(e){"@babel/helpers - typeof";return fu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},fu(e)}function ene(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function tne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,rO(n.key),n)}}function rne(e,t,r){return t&&tne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function nne(e,t,r){return t=Up(t),ane(e,tO()?Reflect.construct(t,r||[],Up(e).constructor):t.apply(e,r))}function ane(e,t){if(t&&(fu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return ine(e)}function ine(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(tO=function(){return!!e})()}function Up(e){return Up=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Up(e)}function one(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&lb(e,t)}function lb(e,t){return lb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},lb(e,t)}function g4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function m4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?g4(Object(r),!0).forEach(function(n){V2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function V2(e,t,r){return t=rO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function rO(e){var t=sne(e,"string");return fu(t)=="symbol"?t:t+""}function sne(e,t){if(fu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(fu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function lne(e,t){return fne(e)||dne(e,t)||une(e,t)||cne()}function cne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function une(e,t){if(e){if(typeof e=="string")return x4(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x4(e,t)}}function x4(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function dne(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function fne(e){if(Array.isArray(e))return e}function cb(){return cb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},cb.apply(this,arguments)}var hne=function(t,r){var n;return re.isValidElement(t)?n=re.cloneElement(t,r):Bt(t)?n=t(r):n=re.createElement("line",cb({},r,{className:"recharts-reference-line-line"})),n},pne=function(t,r,n,a,i,o,s,l,u){var d=i.x,f=i.y,h=i.width,p=i.height;if(n){var x=u.y,b=t.y.apply(x,{position:o});if(ro(u,"discard")&&!t.y.isInRange(b))return null;var y=[{x:d+h,y:b},{x:d,y:b}];return l==="left"?y.reverse():y}if(r){var m=u.x,g=t.x.apply(m,{position:o});if(ro(u,"discard")&&!t.x.isInRange(g))return null;var k=[{x:g,y:f+p},{x:g,y:f}];return s==="top"?k.reverse():k}if(a){var S=u.segment,w=S.map(function(v){return t.apply(v,{position:o})});return ro(u,"discard")&&Lte(w,function(v){return!t.isInRange(v)})?null:w}return null};function gne(e){var t=e.x,r=e.y,n=e.segment,a=e.xAxisId,i=e.yAxisId,o=e.shape,s=e.className,l=e.alwaysShow,u=Yre(),d=QC(a),f=eO(i),h=Jre();if(!u||!h)return null;Co(l===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var p=F2({x:d.scale,y:f.scale}),x=Ln(t),b=Ln(r),y=n&&n.length===2,m=pne(p,x,b,y,h,e.position,d.orientation,f.orientation,e);if(!m)return null;var g=lne(m,2),k=g[0],S=k.x,w=k.y,v=g[1],M=v.x,_=v.y,P=ro(e,"hidden")?"url(#".concat(u,")"):void 0,A=m4(m4({clipPath:P},Dt(e,!0)),{},{x1:S,y1:w,x2:M,y2:_});return re.createElement(_r,{className:hr("recharts-reference-line",s)},hne(o,A),qn.renderCallByParent(e,_re({x1:S,y1:w,x2:M,y2:_})))}var vs=function(e){function t(){return ene(this,t),nne(this,t,arguments)}return one(t,e),rne(t,[{key:"render",value:function(){return re.createElement(gne,this.props)}}])}(re.Component);V2(vs,"displayName","ReferenceLine");V2(vs,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function ub(){return ub=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ub.apply(this,arguments)}function hu(e){"@babel/helpers - typeof";return hu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},hu(e)}function y4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function b4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?y4(Object(r),!0).forEach(function(n){sm(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function mne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function xne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,aO(n.key),n)}}function yne(e,t,r){return t&&xne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function bne(e,t,r){return t=zp(t),vne(e,nO()?Reflect.construct(t,r||[],zp(e).constructor):t.apply(e,r))}function vne(e,t){if(t&&(hu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wne(e)}function wne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function nO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(nO=function(){return!!e})()}function zp(e){return zp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},zp(e)}function kne(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&db(e,t)}function db(e,t){return db=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},db(e,t)}function sm(e,t,r){return t=aO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function aO(e){var t=Sne(e,"string");return hu(t)=="symbol"?t:t+""}function Sne(e,t){if(hu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(hu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var jne=function(t){var r=t.x,n=t.y,a=t.xAxis,i=t.yAxis,o=F2({x:a.scale,y:i.scale}),s=o.apply({x:r,y:n},{bandAware:!0});return ro(t,"discard")&&!o.isInRange(s)?null:s},r0=function(e){function t(){return mne(this,t),bne(this,t,arguments)}return kne(t,e),yne(t,[{key:"render",value:function(){var n=this.props,a=n.x,i=n.y,o=n.r,s=n.alwaysShow,l=n.clipPathId,u=Ln(a),d=Ln(i);if(Co(s===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.'),!u||!d)return null;var f=jne(this.props);if(!f)return null;var h=f.x,p=f.y,x=this.props,b=x.shape,y=x.className,m=ro(this.props,"hidden")?"url(#".concat(l,")"):void 0,g=b4(b4({clipPath:m},Dt(this.props,!0)),{},{cx:h,cy:p});return re.createElement(_r,{className:hr("recharts-reference-dot",y)},t.renderDot(b,g),qn.renderCallByParent(this.props,{x:h-o,y:p-o,width:2*o,height:2*o}))}}])}(re.Component);sm(r0,"displayName","ReferenceDot");sm(r0,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#fff",stroke:"#ccc",fillOpacity:1,strokeWidth:1});sm(r0,"renderDot",function(e,t){var r;return re.isValidElement(e)?r=re.cloneElement(e,t):Bt(e)?r=e(t):r=re.createElement(nm,ub({},t,{cx:t.cx,cy:t.cy,className:"recharts-reference-dot-dot"})),r});function fb(){return fb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},fb.apply(this,arguments)}function pu(e){"@babel/helpers - typeof";return pu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},pu(e)}function v4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function w4(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?v4(Object(r),!0).forEach(function(n){lm(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Mne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,oO(n.key),n)}}function Pne(e,t,r){return t&&_ne(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Nne(e,t,r){return t=Wp(t),Cne(e,iO()?Reflect.construct(t,r||[],Wp(e).constructor):t.apply(e,r))}function Cne(e,t){if(t&&(pu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return One(e)}function One(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function iO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(iO=function(){return!!e})()}function Wp(e){return Wp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Wp(e)}function Ane(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&hb(e,t)}function hb(e,t){return hb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},hb(e,t)}function lm(e,t,r){return t=oO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oO(e){var t=Tne(e,"string");return pu(t)=="symbol"?t:t+""}function Tne(e,t){if(pu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(pu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Ene=function(t,r,n,a,i){var o=i.x1,s=i.x2,l=i.y1,u=i.y2,d=i.xAxis,f=i.yAxis;if(!d||!f)return null;var h=F2({x:d.scale,y:f.scale}),p={x:t?h.x.apply(o,{position:"start"}):h.x.rangeMin,y:n?h.y.apply(l,{position:"start"}):h.y.rangeMin},x={x:r?h.x.apply(s,{position:"end"}):h.x.rangeMax,y:a?h.y.apply(u,{position:"end"}):h.y.rangeMax};return ro(i,"discard")&&(!h.isInRange(p)||!h.isInRange(x))?null:HC(p,x)},n0=function(e){function t(){return Mne(this,t),Nne(this,t,arguments)}return Ane(t,e),Pne(t,[{key:"render",value:function(){var n=this.props,a=n.x1,i=n.x2,o=n.y1,s=n.y2,l=n.className,u=n.alwaysShow,d=n.clipPathId;Co(u===void 0,'The alwaysShow prop is deprecated. Please use ifOverflow="extendDomain" instead.');var f=Ln(a),h=Ln(i),p=Ln(o),x=Ln(s),b=this.props.shape;if(!f&&!h&&!p&&!x&&!b)return null;var y=Ene(f,h,p,x,this.props);if(!y&&!b)return null;var m=ro(this.props,"hidden")?"url(#".concat(d,")"):void 0;return re.createElement(_r,{className:hr("recharts-reference-area",l)},t.renderRect(b,w4(w4({clipPath:m},Dt(this.props,!0)),y)),qn.renderCallByParent(this.props,y))}}])}(re.Component);lm(n0,"displayName","ReferenceArea");lm(n0,"defaultProps",{isFront:!1,ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});lm(n0,"renderRect",function(e,t){var r;return re.isValidElement(e)?r=re.cloneElement(e,t):Bt(e)?r=e(t):r=re.createElement(L2,fb({},t,{className:"recharts-reference-area-rect"})),r});function sO(e,t,r){if(t<1)return[];if(t===1&&r===void 0)return e;for(var n=[],a=0;a<e.length;a+=t)n.push(e[a]);return n}function Ine(e,t,r){var n={width:e.width+t.width,height:e.height+t.height};return Nre(n,r)}function Rne(e,t,r){var n=r==="width",a=e.x,i=e.y,o=e.width,s=e.height;return t===1?{start:n?a:i,end:n?a+o:i+s}:{start:n?a+o:i+s,end:n?a:i}}function Vp(e,t,r,n,a){if(e*t<e*n||e*t>e*a)return!1;var i=r();return e*(t-e*i/2-n)>=0&&e*(t+e*i/2-a)<=0}function Dne(e,t){return sO(e,t+1)}function $ne(e,t,r,n,a){for(var i=(n||[]).slice(),o=t.start,s=t.end,l=0,u=1,d=o,f=function(){var x=n==null?void 0:n[l];if(x===void 0)return{v:sO(n,u)};var b=l,y,m=function(){return y===void 0&&(y=r(x,b)),y},g=x.coordinate,k=l===0||Vp(e,g,m,d,s);k||(l=0,d=o,u+=1),k&&(d=g+e*(m()/2+a),l+=u)},h;u<=i.length;)if(h=f(),h)return h.v;return[]}function Gf(e){"@babel/helpers - typeof";return Gf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Gf(e)}function k4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function oa(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?k4(Object(r),!0).forEach(function(n){Lne(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):k4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Lne(e,t,r){return t=Bne(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Bne(e){var t=Fne(e,"string");return Gf(t)=="symbol"?t:t+""}function Fne(e,t){if(Gf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Gf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function Gne(e,t,r,n,a){for(var i=(n||[]).slice(),o=i.length,s=t.start,l=t.end,u=function(h){var p=i[h],x,b=function(){return x===void 0&&(x=r(p,h)),x};if(h===o-1){var y=e*(p.coordinate+e*b()/2-l);i[h]=p=oa(oa({},p),{},{tickCoord:y>0?p.coordinate-y*e:p.coordinate})}else i[h]=p=oa(oa({},p),{},{tickCoord:p.coordinate});var m=Vp(e,p.tickCoord,b,s,l);m&&(l=p.tickCoord-e*(b()/2+a),i[h]=oa(oa({},p),{},{isShow:!0}))},d=o-1;d>=0;d--)u(d);return i}function Une(e,t,r,n,a,i){var o=(n||[]).slice(),s=o.length,l=t.start,u=t.end;if(i){var d=n[s-1],f=r(d,s-1),h=e*(d.coordinate+e*f/2-u);o[s-1]=d=oa(oa({},d),{},{tickCoord:h>0?d.coordinate-h*e:d.coordinate});var p=Vp(e,d.tickCoord,function(){return f},l,u);p&&(u=d.tickCoord-e*(f/2+a),o[s-1]=oa(oa({},d),{},{isShow:!0}))}for(var x=i?s-1:s,b=function(g){var k=o[g],S,w=function(){return S===void 0&&(S=r(k,g)),S};if(g===0){var v=e*(k.coordinate-e*w()/2-l);o[g]=k=oa(oa({},k),{},{tickCoord:v<0?k.coordinate-v*e:k.coordinate})}else o[g]=k=oa(oa({},k),{},{tickCoord:k.coordinate});var M=Vp(e,k.tickCoord,w,l,u);M&&(l=k.tickCoord+e*(w()/2+a),o[g]=oa(oa({},k),{},{isShow:!0}))},y=0;y<x;y++)b(y);return o}function H2(e,t,r){var n=e.tick,a=e.ticks,i=e.viewBox,o=e.minTickGap,s=e.orientation,l=e.interval,u=e.tickFormatter,d=e.unit,f=e.angle;if(!a||!a.length||!n)return[];if(Re(l)||Ws.isSsr)return Dne(a,typeof l=="number"&&Re(l)?l:0);var h=[],p=s==="top"||s==="bottom"?"width":"height",x=d&&p==="width"?Dd(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},b=function(k,S){var w=Bt(u)?u(k.value,S):k.value;return p==="width"?Ine(Dd(w,{fontSize:t,letterSpacing:r}),x,f):Dd(w,{fontSize:t,letterSpacing:r})[p]},y=a.length>=2?Ti(a[1].coordinate-a[0].coordinate):1,m=Rne(i,y,p);return l==="equidistantPreserveStart"?$ne(y,m,b,a,o):(l==="preserveStart"||l==="preserveStartEnd"?h=Une(y,m,b,a,o,l==="preserveStartEnd"):h=Gne(y,m,b,a,o),h.filter(function(g){return g.isShow}))}var zne=["viewBox"],Wne=["viewBox"],Vne=["ticks"];function gu(e){"@babel/helpers - typeof";return gu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gu(e)}function _c(){return _c=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},_c.apply(this,arguments)}function S4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Tn(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?S4(Object(r),!0).forEach(function(n){X2(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):S4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Fx(e,t){if(e==null)return{};var r=Hne(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Hne(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Xne(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function j4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,cO(n.key),n)}}function Kne(e,t,r){return t&&j4(e.prototype,t),r&&j4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Yne(e,t,r){return t=Hp(t),qne(e,lO()?Reflect.construct(t,r||[],Hp(e).constructor):t.apply(e,r))}function qne(e,t){if(t&&(gu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zne(e)}function Zne(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function lO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(lO=function(){return!!e})()}function Hp(e){return Hp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Hp(e)}function Jne(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&pb(e,t)}function pb(e,t){return pb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},pb(e,t)}function X2(e,t,r){return t=cO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function cO(e){var t=Qne(e,"string");return gu(t)=="symbol"?t:t+""}function Qne(e,t){if(gu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(gu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var zu=function(e){function t(r){var n;return Xne(this,t),n=Yne(this,t,[r]),n.state={fontSize:"",letterSpacing:""},n}return Jne(t,e),Kne(t,[{key:"shouldComponentUpdate",value:function(n,a){var i=n.viewBox,o=Fx(n,zne),s=this.props,l=s.viewBox,u=Fx(s,Wne);return!Lc(i,l)||!Lc(o,u)||!Lc(a,this.state)}},{key:"componentDidMount",value:function(){var n=this.layerReference;if(n){var a=n.getElementsByClassName("recharts-cartesian-axis-tick-value")[0];a&&this.setState({fontSize:window.getComputedStyle(a).fontSize,letterSpacing:window.getComputedStyle(a).letterSpacing})}}},{key:"getTickLineCoord",value:function(n){var a=this.props,i=a.x,o=a.y,s=a.width,l=a.height,u=a.orientation,d=a.tickSize,f=a.mirror,h=a.tickMargin,p,x,b,y,m,g,k=f?-1:1,S=n.tickSize||d,w=Re(n.tickCoord)?n.tickCoord:n.coordinate;switch(u){case"top":p=x=n.coordinate,y=o+ +!f*l,b=y-k*S,g=b-k*h,m=w;break;case"left":b=y=n.coordinate,x=i+ +!f*s,p=x-k*S,m=p-k*h,g=w;break;case"right":b=y=n.coordinate,x=i+ +f*s,p=x+k*S,m=p+k*h,g=w;break;default:p=x=n.coordinate,y=o+ +f*l,b=y+k*S,g=b+k*h,m=w;break}return{line:{x1:p,y1:b,x2:x,y2:y},tick:{x:m,y:g}}}},{key:"getTickTextAnchor",value:function(){var n=this.props,a=n.orientation,i=n.mirror,o;switch(a){case"left":o=i?"start":"end";break;case"right":o=i?"end":"start";break;default:o="middle";break}return o}},{key:"getTickVerticalAnchor",value:function(){var n=this.props,a=n.orientation,i=n.mirror,o="end";switch(a){case"left":case"right":o="middle";break;case"top":o=i?"start":"end";break;default:o=i?"end":"start";break}return o}},{key:"renderAxisLine",value:function(){var n=this.props,a=n.x,i=n.y,o=n.width,s=n.height,l=n.orientation,u=n.mirror,d=n.axisLine,f=Tn(Tn(Tn({},Dt(this.props,!1)),Dt(d,!1)),{},{fill:"none"});if(l==="top"||l==="bottom"){var h=+(l==="top"&&!u||l==="bottom"&&u);f=Tn(Tn({},f),{},{x1:a,y1:i+h*s,x2:a+o,y2:i+h*s})}else{var p=+(l==="left"&&!u||l==="right"&&u);f=Tn(Tn({},f),{},{x1:a+p*o,y1:i,x2:a+p*o,y2:i+s})}return re.createElement("line",_c({},f,{className:hr("recharts-cartesian-axis-line",hi(d,"className"))}))}},{key:"renderTicks",value:function(n,a,i){var o=this,s=this.props,l=s.tickLine,u=s.stroke,d=s.tick,f=s.tickFormatter,h=s.unit,p=H2(Tn(Tn({},this.props),{},{ticks:n}),a,i),x=this.getTickTextAnchor(),b=this.getTickVerticalAnchor(),y=Dt(this.props,!1),m=Dt(d,!1),g=Tn(Tn({},y),{},{fill:"none"},Dt(l,!1)),k=p.map(function(S,w){var v=o.getTickLineCoord(S),M=v.line,_=v.tick,P=Tn(Tn(Tn(Tn({textAnchor:x,verticalAnchor:b},y),{},{stroke:"none",fill:u},m),_),{},{index:w,payload:S,visibleTicksCount:p.length,tickFormatter:f});return re.createElement(_r,_c({className:"recharts-cartesian-axis-tick",key:"tick-".concat(S.value,"-").concat(S.coordinate,"-").concat(S.tickCoord)},lf(o.props,S,w)),l&&re.createElement("line",_c({},g,M,{className:hr("recharts-cartesian-axis-tick-line",hi(l,"className"))})),d&&t.renderTickItem(d,P,"".concat(Bt(f)?f(S.value,w):S.value).concat(h||"")))});return re.createElement("g",{className:"recharts-cartesian-axis-ticks"},k)}},{key:"render",value:function(){var n=this,a=this.props,i=a.axisLine,o=a.width,s=a.height,l=a.ticksGenerator,u=a.className,d=a.hide;if(d)return null;var f=this.props,h=f.ticks,p=Fx(f,Vne),x=h;return Bt(l)&&(x=h&&h.length>0?l(this.props):l(p)),o<=0||s<=0||!x||!x.length?null:re.createElement(_r,{className:hr("recharts-cartesian-axis",u),ref:function(y){n.layerReference=y}},i&&this.renderAxisLine(),this.renderTicks(x,this.state.fontSize,this.state.letterSpacing),qn.renderCallByParent(this.props))}}],[{key:"renderTickItem",value:function(n,a,i){var o,s=hr(a.className,"recharts-cartesian-axis-tick-value");return re.isValidElement(n)?o=re.cloneElement(n,Tn(Tn({},a),{},{className:s})):Bt(n)?o=n(Tn(Tn({},a),{},{className:s})):o=re.createElement(fp,_c({},a,{className:"recharts-cartesian-axis-tick-value"}),i),o}}])}(j.Component);X2(zu,"displayName","CartesianAxis");X2(zu,"defaultProps",{x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd"});var eae=["x1","y1","x2","y2","key"],tae=["offset"];function zl(e){"@babel/helpers - typeof";return zl=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zl(e)}function M4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function la(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?M4(Object(r),!0).forEach(function(n){rae(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):M4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function rae(e,t,r){return t=nae(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nae(e){var t=aae(e,"string");return zl(t)=="symbol"?t:t+""}function aae(e,t){if(zl(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(zl(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function xl(){return xl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xl.apply(this,arguments)}function _4(e,t){if(e==null)return{};var r=iae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function iae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}var oae=function(t){var r=t.fill;if(!r||r==="none")return null;var n=t.fillOpacity,a=t.x,i=t.y,o=t.width,s=t.height,l=t.ry;return re.createElement("rect",{x:a,y:i,ry:l,width:o,height:s,stroke:"none",fill:r,fillOpacity:n,className:"recharts-cartesian-grid-bg"})};function uO(e,t){var r;if(re.isValidElement(e))r=re.cloneElement(e,t);else if(Bt(e))r=e(t);else{var n=t.x1,a=t.y1,i=t.x2,o=t.y2,s=t.key,l=_4(t,eae),u=Dt(l,!1);u.offset;var d=_4(u,tae);r=re.createElement("line",xl({},d,{x1:n,y1:a,x2:i,y2:o,fill:"none",key:s}))}return r}function sae(e){var t=e.x,r=e.width,n=e.horizontal,a=n===void 0?!0:n,i=e.horizontalPoints;if(!a||!i||!i.length)return null;var o=i.map(function(s,l){var u=la(la({},e),{},{x1:t,y1:s,x2:t+r,y2:s,key:"line-".concat(l),index:l});return uO(a,u)});return re.createElement("g",{className:"recharts-cartesian-grid-horizontal"},o)}function lae(e){var t=e.y,r=e.height,n=e.vertical,a=n===void 0?!0:n,i=e.verticalPoints;if(!a||!i||!i.length)return null;var o=i.map(function(s,l){var u=la(la({},e),{},{x1:s,y1:t,x2:s,y2:t+r,key:"line-".concat(l),index:l});return uO(a,u)});return re.createElement("g",{className:"recharts-cartesian-grid-vertical"},o)}function cae(e){var t=e.horizontalFill,r=e.fillOpacity,n=e.x,a=e.y,i=e.width,o=e.height,s=e.horizontalPoints,l=e.horizontal,u=l===void 0?!0:l;if(!u||!t||!t.length)return null;var d=s.map(function(h){return Math.round(h+a-a)}).sort(function(h,p){return h-p});a!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var x=!d[p+1],b=x?a+o-h:d[p+1]-h;if(b<=0)return null;var y=p%t.length;return re.createElement("rect",{key:"react-".concat(p),y:h,x:n,height:b,width:i,stroke:"none",fill:t[y],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return re.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},f)}function uae(e){var t=e.vertical,r=t===void 0?!0:t,n=e.verticalFill,a=e.fillOpacity,i=e.x,o=e.y,s=e.width,l=e.height,u=e.verticalPoints;if(!r||!n||!n.length)return null;var d=u.map(function(h){return Math.round(h+i-i)}).sort(function(h,p){return h-p});i!==d[0]&&d.unshift(0);var f=d.map(function(h,p){var x=!d[p+1],b=x?i+s-h:d[p+1]-h;if(b<=0)return null;var y=p%n.length;return re.createElement("rect",{key:"react-".concat(p),x:h,y:o,width:b,height:l,stroke:"none",fill:n[y],fillOpacity:a,className:"recharts-cartesian-grid-bg"})});return re.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},f)}var dae=function(t,r){var n=t.xAxis,a=t.width,i=t.height,o=t.offset;return vC(H2(la(la(la({},zu.defaultProps),n),{},{ticks:_o(n,!0),viewBox:{x:0,y:0,width:a,height:i}})),o.left,o.left+o.width,r)},fae=function(t,r){var n=t.yAxis,a=t.width,i=t.height,o=t.offset;return vC(H2(la(la(la({},zu.defaultProps),n),{},{ticks:_o(n,!0),viewBox:{x:0,y:0,width:a,height:i}})),o.top,o.top+o.height,r)},dc={horizontal:!0,vertical:!0,stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[]};function Ei(e){var t,r,n,a,i,o,s=z2(),l=W2(),u=Qre(),d=la(la({},e),{},{stroke:(t=e.stroke)!==null&&t!==void 0?t:dc.stroke,fill:(r=e.fill)!==null&&r!==void 0?r:dc.fill,horizontal:(n=e.horizontal)!==null&&n!==void 0?n:dc.horizontal,horizontalFill:(a=e.horizontalFill)!==null&&a!==void 0?a:dc.horizontalFill,vertical:(i=e.vertical)!==null&&i!==void 0?i:dc.vertical,verticalFill:(o=e.verticalFill)!==null&&o!==void 0?o:dc.verticalFill,x:Re(e.x)?e.x:u.left,y:Re(e.y)?e.y:u.top,width:Re(e.width)?e.width:u.width,height:Re(e.height)?e.height:u.height}),f=d.x,h=d.y,p=d.width,x=d.height,b=d.syncWithTicks,y=d.horizontalValues,m=d.verticalValues,g=qre(),k=Zre();if(!Re(p)||p<=0||!Re(x)||x<=0||!Re(f)||f!==+f||!Re(h)||h!==+h)return null;var S=d.verticalCoordinatesGenerator||dae,w=d.horizontalCoordinatesGenerator||fae,v=d.horizontalPoints,M=d.verticalPoints;if((!v||!v.length)&&Bt(w)){var _=y&&y.length,P=w({yAxis:k?la(la({},k),{},{ticks:_?y:k.ticks}):void 0,width:s,height:l,offset:u},_?!0:b);Co(Array.isArray(P),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(zl(P),"]")),Array.isArray(P)&&(v=P)}if((!M||!M.length)&&Bt(S)){var A=m&&m.length,R=S({xAxis:g?la(la({},g),{},{ticks:A?m:g.ticks}):void 0,width:s,height:l,offset:u},A?!0:b);Co(Array.isArray(R),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(zl(R),"]")),Array.isArray(R)&&(M=R)}return re.createElement("g",{className:"recharts-cartesian-grid"},re.createElement(oae,{fill:d.fill,fillOpacity:d.fillOpacity,x:d.x,y:d.y,width:d.width,height:d.height,ry:d.ry}),re.createElement(sae,xl({},d,{offset:u,horizontalPoints:v,xAxis:g,yAxis:k})),re.createElement(lae,xl({},d,{offset:u,verticalPoints:M,xAxis:g,yAxis:k})),re.createElement(cae,xl({},d,{horizontalPoints:v})),re.createElement(uae,xl({},d,{verticalPoints:M})))}Ei.displayName="CartesianGrid";var hae=["type","layout","connectNulls","ref"],pae=["key"];function mu(e){"@babel/helpers - typeof";return mu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mu(e)}function P4(e,t){if(e==null)return{};var r=gae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function gae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Fd(){return Fd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Fd.apply(this,arguments)}function N4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Ua(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?N4(Object(r),!0).forEach(function(n){Ni(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):N4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function fc(e){return bae(e)||yae(e)||xae(e)||mae()}function mae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xae(e,t){if(e){if(typeof e=="string")return gb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gb(e,t)}}function yae(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function bae(e){if(Array.isArray(e))return gb(e)}function gb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function vae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,fO(n.key),n)}}function wae(e,t,r){return t&&C4(e.prototype,t),r&&C4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function kae(e,t,r){return t=Xp(t),Sae(e,dO()?Reflect.construct(t,r||[],Xp(e).constructor):t.apply(e,r))}function Sae(e,t){if(t&&(mu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return jae(e)}function jae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(dO=function(){return!!e})()}function Xp(e){return Xp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Xp(e)}function Mae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&mb(e,t)}function mb(e,t){return mb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},mb(e,t)}function Ni(e,t,r){return t=fO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function fO(e){var t=_ae(e,"string");return mu(t)=="symbol"?t:t+""}function _ae(e,t){if(mu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(mu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Dn=function(e){function t(){var r;vae(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=kae(this,t,[].concat(a)),Ni(r,"state",{isAnimationFinished:!0,totalLength:0}),Ni(r,"generateSimpleStrokeDasharray",function(o,s){return"".concat(s,"px ").concat(o-s,"px")}),Ni(r,"getStrokeDasharray",function(o,s,l){var u=l.reduce(function(m,g){return m+g});if(!u)return r.generateSimpleStrokeDasharray(s,o);for(var d=Math.floor(o/u),f=o%u,h=s-o,p=[],x=0,b=0;x<l.length;b+=l[x],++x)if(b+l[x]>f){p=[].concat(fc(l.slice(0,x)),[f-b]);break}var y=p.length%2===0?[0,h]:[h];return[].concat(fc(t.repeat(l,d)),fc(p),y).map(function(m){return"".concat(m,"px")}).join(", ")}),Ni(r,"id",Kl("recharts-line-")),Ni(r,"pathRef",function(o){r.mainCurve=o}),Ni(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0}),r.props.onAnimationEnd&&r.props.onAnimationEnd()}),Ni(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1}),r.props.onAnimationStart&&r.props.onAnimationStart()}),r}return Mae(t,e),wae(t,[{key:"componentDidMount",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();this.setState({totalLength:n})}}},{key:"componentDidUpdate",value:function(){if(this.props.isAnimationActive){var n=this.getTotalLength();n!==this.state.totalLength&&this.setState({totalLength:n})}}},{key:"getTotalLength",value:function(){var n=this.mainCurve;try{return n&&n.getTotalLength&&n.getTotalLength()||0}catch{return 0}}},{key:"renderErrorBar",value:function(n,a){if(this.props.isAnimationActive&&!this.state.isAnimationFinished)return null;var i=this.props,o=i.points,s=i.xAxis,l=i.yAxis,u=i.layout,d=i.children,f=Da(d,Uu);if(!f)return null;var h=function(b,y){return{x:b.x,y:b.y,value:b.value,errorVal:Bn(b.payload,y)}},p={clipPath:n?"url(#clipPath-".concat(a,")"):null};return re.createElement(_r,p,f.map(function(x){return re.cloneElement(x,{key:"bar-".concat(x.props.dataKey),data:o,xAxis:s,yAxis:l,layout:u,dataPointFormatter:h})}))}},{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive;if(o&&!this.state.isAnimationFinished)return null;var s=this.props,l=s.dot,u=s.points,d=s.dataKey,f=Dt(this.props,!1),h=Dt(l,!0),p=u.map(function(b,y){var m=Ua(Ua(Ua({key:"dot-".concat(y),r:3},f),h),{},{index:y,cx:b.x,cy:b.y,value:b.value,dataKey:d,payload:b.payload,points:u});return t.renderDotItem(l,m)}),x={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return re.createElement(_r,Fd({className:"recharts-line-dots",key:"dots"},x),p)}},{key:"renderCurveStatically",value:function(n,a,i,o){var s=this.props,l=s.type,u=s.layout,d=s.connectNulls;s.ref;var f=P4(s,hae),h=Ua(Ua(Ua({},Dt(f,!0)),{},{fill:"none",className:"recharts-line-curve",clipPath:a?"url(#clipPath-".concat(i,")"):null,points:n},o),{},{type:l,layout:u,connectNulls:d});return re.createElement(Ml,Fd({},h,{pathRef:this.pathRef}))}},{key:"renderCurveWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,l=o.strokeDasharray,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,p=o.animationId,x=o.animateNewValues,b=o.width,y=o.height,m=this.state,g=m.prevPoints,k=m.totalLength;return re.createElement($i,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"line-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(S){var w=S.t;if(g){var v=g.length/s.length,M=s.map(function(D,E){var W=Math.floor(E*v);if(g[W]){var F=g[W],O=xn(F.x,D.x),$=xn(F.y,D.y);return Ua(Ua({},D),{},{x:O(w),y:$(w)})}if(x){var N=xn(b*2,D.x),C=xn(y/2,D.y);return Ua(Ua({},D),{},{x:N(w),y:C(w)})}return Ua(Ua({},D),{},{x:D.x,y:D.y})});return i.renderCurveStatically(M,n,a)}var _=xn(0,k),P=_(w),A;if(l){var R="".concat(l).split(/[,\s]+/gim).map(function(D){return parseFloat(D)});A=i.getStrokeDasharray(P,k,R)}else A=i.generateSimpleStrokeDasharray(k,P);return i.renderCurveStatically(s,n,a,{strokeDasharray:A})})}},{key:"renderCurve",value:function(n,a){var i=this.props,o=i.points,s=i.isAnimationActive,l=this.state,u=l.prevPoints,d=l.totalLength;return s&&o&&o.length&&(!u&&d>0||!Fl(u,o))?this.renderCurveWithAnimation(n,a):this.renderCurveStatically(o,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,l=a.className,u=a.xAxis,d=a.yAxis,f=a.top,h=a.left,p=a.width,x=a.height,b=a.isAnimationActive,y=a.id;if(i||!s||!s.length)return null;var m=this.state.isAnimationFinished,g=s.length===1,k=hr("recharts-line",l),S=u&&u.allowDataOverflow,w=d&&d.allowDataOverflow,v=S||w,M=Et(y)?this.id:y,_=(n=Dt(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=_.r,A=P===void 0?3:P,R=_.strokeWidth,D=R===void 0?2:R,E=pP(o)?o:{},W=E.clipDot,F=W===void 0?!0:W,O=A*2+D;return re.createElement(_r,{className:k},S||w?re.createElement("defs",null,re.createElement("clipPath",{id:"clipPath-".concat(M)},re.createElement("rect",{x:S?h:h-p/2,y:w?f:f-x/2,width:S?p:p*2,height:w?x:x*2})),!F&&re.createElement("clipPath",{id:"clipPath-dots-".concat(M)},re.createElement("rect",{x:h-O/2,y:f-O/2,width:p+O,height:x+O}))):null,!g&&this.renderCurve(v,M),this.renderErrorBar(v,M),(g||o)&&this.renderDots(v,F,M),(!b||m)&&to.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}},{key:"repeat",value:function(n,a){for(var i=n.length%2!==0?[].concat(fc(n),[0]):n,o=[],s=0;s<a;++s)o=[].concat(fc(o),fc(i));return o}},{key:"renderDotItem",value:function(n,a){var i;if(re.isValidElement(n))i=re.cloneElement(n,a);else if(Bt(n))i=n(a);else{var o=a.key,s=P4(a,pae),l=hr("recharts-line-dot",typeof n!="boolean"?n.className:"");i=re.createElement(nm,Fd({key:o},s,{className:l}))}return i}}])}(j.PureComponent);Ni(Dn,"displayName","Line");Ni(Dn,"defaultProps",{xAxisId:0,yAxisId:0,connectNulls:!1,activeDot:!0,dot:!0,legendType:"line",stroke:"#3182bd",strokeWidth:1,fill:"#fff",points:[],isAnimationActive:!Ws.isSsr,animateNewValues:!0,animationBegin:0,animationDuration:1500,animationEasing:"ease",hide:!1,label:!1});Ni(Dn,"getComposedData",function(e){var t=e.props,r=e.xAxis,n=e.yAxis,a=e.xAxisTicks,i=e.yAxisTicks,o=e.dataKey,s=e.bandSize,l=e.displayedData,u=e.offset,d=t.layout,f=l.map(function(h,p){var x=Bn(h,o);return d==="horizontal"?{x:su({axis:r,ticks:a,bandSize:s,entry:h,index:p}),y:Et(x)?null:n.scale(x),value:x,payload:h}:{x:Et(x)?null:r.scale(x),y:su({axis:n,ticks:i,bandSize:s,entry:h,index:p}),value:x,payload:h}});return Ua({points:f,layout:d},u)});var Pae=["layout","type","stroke","connectNulls","isRange","ref"],Nae=["key"],hO;function xu(e){"@babel/helpers - typeof";return xu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},xu(e)}function pO(e,t){if(e==null)return{};var r=Cae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Cae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function yl(){return yl=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yl.apply(this,arguments)}function O4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ns(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?O4(Object(r),!0).forEach(function(n){Yi(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):O4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Oae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function A4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,mO(n.key),n)}}function Aae(e,t,r){return t&&A4(e.prototype,t),r&&A4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Tae(e,t,r){return t=Kp(t),Eae(e,gO()?Reflect.construct(t,r||[],Kp(e).constructor):t.apply(e,r))}function Eae(e,t){if(t&&(xu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Iae(e)}function Iae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gO=function(){return!!e})()}function Kp(e){return Kp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Kp(e)}function Rae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xb(e,t)}function xb(e,t){return xb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},xb(e,t)}function Yi(e,t,r){return t=mO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function mO(e){var t=Dae(e,"string");return xu(t)=="symbol"?t:t+""}function Dae(e,t){if(xu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(xu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var di=function(e){function t(){var r;Oae(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Tae(this,t,[].concat(a)),Yi(r,"state",{isAnimationFinished:!0}),Yi(r,"id",Kl("recharts-area-")),Yi(r,"handleAnimationEnd",function(){var o=r.props.onAnimationEnd;r.setState({isAnimationFinished:!0}),Bt(o)&&o()}),Yi(r,"handleAnimationStart",function(){var o=r.props.onAnimationStart;r.setState({isAnimationFinished:!1}),Bt(o)&&o()}),r}return Rae(t,e),Aae(t,[{key:"renderDots",value:function(n,a,i){var o=this.props.isAnimationActive,s=this.state.isAnimationFinished;if(o&&!s)return null;var l=this.props,u=l.dot,d=l.points,f=l.dataKey,h=Dt(this.props,!1),p=Dt(u,!0),x=d.map(function(y,m){var g=ns(ns(ns({key:"dot-".concat(m),r:3},h),p),{},{index:m,cx:y.x,cy:y.y,dataKey:f,value:y.value,payload:y.payload,points:d});return t.renderDotItem(u,g)}),b={clipPath:n?"url(#clipPath-".concat(a?"":"dots-").concat(i,")"):null};return re.createElement(_r,yl({className:"recharts-area-dots"},b),x)}},{key:"renderHorizontalRect",value:function(n){var a=this.props,i=a.baseLine,o=a.points,s=a.strokeWidth,l=o[0].x,u=o[o.length-1].x,d=n*Math.abs(l-u),f=ys(o.map(function(h){return h.y||0}));return Re(i)&&typeof i=="number"?f=Math.max(i,f):i&&Array.isArray(i)&&i.length&&(f=Math.max(ys(i.map(function(h){return h.y||0})),f)),Re(f)?re.createElement("rect",{x:l<u?l:l-d,y:0,width:d,height:Math.floor(f+(s?parseInt("".concat(s),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var a=this.props,i=a.baseLine,o=a.points,s=a.strokeWidth,l=o[0].y,u=o[o.length-1].y,d=n*Math.abs(l-u),f=ys(o.map(function(h){return h.x||0}));return Re(i)&&typeof i=="number"?f=Math.max(i,f):i&&Array.isArray(i)&&i.length&&(f=Math.max(ys(i.map(function(h){return h.x||0})),f)),Re(f)?re.createElement("rect",{x:0,y:l<u?l:l-d,width:f+(s?parseInt("".concat(s),10):1),height:Math.floor(d)}):null}},{key:"renderClipRect",value:function(n){var a=this.props.layout;return a==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,a,i,o){var s=this.props,l=s.layout,u=s.type,d=s.stroke,f=s.connectNulls,h=s.isRange;s.ref;var p=pO(s,Pae);return re.createElement(_r,{clipPath:i?"url(#clipPath-".concat(o,")"):null},re.createElement(Ml,yl({},Dt(p,!0),{points:n,connectNulls:f,type:u,baseLine:a,layout:l,stroke:"none",className:"recharts-area-area"})),d!=="none"&&re.createElement(Ml,yl({},Dt(this.props,!1),{className:"recharts-area-curve",layout:l,type:u,connectNulls:f,fill:"none",points:n})),d!=="none"&&h&&re.createElement(Ml,yl({},Dt(this.props,!1),{className:"recharts-area-curve",layout:l,type:u,connectNulls:f,fill:"none",points:a})))}},{key:"renderAreaWithAnimation",value:function(n,a){var i=this,o=this.props,s=o.points,l=o.baseLine,u=o.isAnimationActive,d=o.animationBegin,f=o.animationDuration,h=o.animationEasing,p=o.animationId,x=this.state,b=x.prevPoints,y=x.prevBaseLine;return re.createElement($i,{begin:d,duration:f,isActive:u,easing:h,from:{t:0},to:{t:1},key:"area-".concat(p),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(m){var g=m.t;if(b){var k=b.length/s.length,S=s.map(function(_,P){var A=Math.floor(P*k);if(b[A]){var R=b[A],D=xn(R.x,_.x),E=xn(R.y,_.y);return ns(ns({},_),{},{x:D(g),y:E(g)})}return _}),w;if(Re(l)&&typeof l=="number"){var v=xn(y,l);w=v(g)}else if(Et(l)||Ru(l)){var M=xn(y,0);w=M(g)}else w=l.map(function(_,P){var A=Math.floor(P*k);if(y[A]){var R=y[A],D=xn(R.x,_.x),E=xn(R.y,_.y);return ns(ns({},_),{},{x:D(g),y:E(g)})}return _});return i.renderAreaStatically(S,w,n,a)}return re.createElement(_r,null,re.createElement("defs",null,re.createElement("clipPath",{id:"animationClipPath-".concat(a)},i.renderClipRect(g))),re.createElement(_r,{clipPath:"url(#animationClipPath-".concat(a,")")},i.renderAreaStatically(s,l,n,a)))})}},{key:"renderArea",value:function(n,a){var i=this.props,o=i.points,s=i.baseLine,l=i.isAnimationActive,u=this.state,d=u.prevPoints,f=u.prevBaseLine,h=u.totalLength;return l&&o&&o.length&&(!d&&h>0||!Fl(d,o)||!Fl(f,s))?this.renderAreaWithAnimation(n,a):this.renderAreaStatically(o,s,n,a)}},{key:"render",value:function(){var n,a=this.props,i=a.hide,o=a.dot,s=a.points,l=a.className,u=a.top,d=a.left,f=a.xAxis,h=a.yAxis,p=a.width,x=a.height,b=a.isAnimationActive,y=a.id;if(i||!s||!s.length)return null;var m=this.state.isAnimationFinished,g=s.length===1,k=hr("recharts-area",l),S=f&&f.allowDataOverflow,w=h&&h.allowDataOverflow,v=S||w,M=Et(y)?this.id:y,_=(n=Dt(o,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},P=_.r,A=P===void 0?3:P,R=_.strokeWidth,D=R===void 0?2:R,E=pP(o)?o:{},W=E.clipDot,F=W===void 0?!0:W,O=A*2+D;return re.createElement(_r,{className:k},S||w?re.createElement("defs",null,re.createElement("clipPath",{id:"clipPath-".concat(M)},re.createElement("rect",{x:S?d:d-p/2,y:w?u:u-x/2,width:S?p:p*2,height:w?x:x*2})),!F&&re.createElement("clipPath",{id:"clipPath-dots-".concat(M)},re.createElement("rect",{x:d-O/2,y:u-O/2,width:p+O,height:x+O}))):null,g?null:this.renderArea(v,M),(o||g)&&this.renderDots(v,F,M),(!b||m)&&to.renderCallByParent(this.props,s))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:a.curPoints,prevBaseLine:a.curBaseLine}:n.points!==a.curPoints||n.baseLine!==a.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(j.PureComponent);hO=di;Yi(di,"displayName","Area");Yi(di,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!Ws.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});Yi(di,"getBaseValue",function(e,t,r,n){var a=e.layout,i=e.baseValue,o=t.props.baseValue,s=o??i;if(Re(s)&&typeof s=="number")return s;var l=a==="horizontal"?n:r,u=l.scale.domain();if(l.type==="number"){var d=Math.max(u[0],u[1]),f=Math.min(u[0],u[1]);return s==="dataMin"?f:s==="dataMax"||d<0?d:Math.max(Math.min(u[0],u[1]),0)}return s==="dataMin"?u[0]:s==="dataMax"?u[1]:u[0]});Yi(di,"getComposedData",function(e){var t=e.props,r=e.item,n=e.xAxis,a=e.yAxis,i=e.xAxisTicks,o=e.yAxisTicks,s=e.bandSize,l=e.dataKey,u=e.stackedData,d=e.dataStartIndex,f=e.displayedData,h=e.offset,p=t.layout,x=u&&u.length,b=hO.getBaseValue(t,r,n,a),y=p==="horizontal",m=!1,g=f.map(function(S,w){var v;x?v=u[d+w]:(v=Bn(S,l),Array.isArray(v)?m=!0:v=[b,v]);var M=v[1]==null||x&&Bn(S,l)==null;return y?{x:su({axis:n,ticks:i,bandSize:s,entry:S,index:w}),y:M?null:a.scale(v[1]),value:v,payload:S}:{x:M?null:n.scale(v[1]),y:su({axis:a,ticks:o,bandSize:s,entry:S,index:w}),value:v,payload:S}}),k;return x||m?k=g.map(function(S){var w=Array.isArray(S.value)?S.value[0]:null;return y?{x:S.x,y:w!=null&&S.y!=null?a.scale(w):null}:{x:w!=null?n.scale(w):null,y:S.y}}):k=y?a.scale(b):n.scale(b),ns({points:g,baseLine:k,layout:p,isRange:m},h)});Yi(di,"renderDotItem",function(e,t){var r;if(re.isValidElement(e))r=re.cloneElement(e,t);else if(Bt(e))r=e(t);else{var n=hr("recharts-area-dot",typeof e!="boolean"?e.className:""),a=t.key,i=pO(t,Nae);r=re.createElement(nm,yl({},i,{key:a,className:n}))}return r});function yu(e){"@babel/helpers - typeof";return yu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},yu(e)}function $ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lae(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,bO(n.key),n)}}function Bae(e,t,r){return t&&Lae(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Fae(e,t,r){return t=Yp(t),Gae(e,xO()?Reflect.construct(t,r||[],Yp(e).constructor):t.apply(e,r))}function Gae(e,t){if(t&&(yu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Uae(e)}function Uae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(xO=function(){return!!e})()}function Yp(e){return Yp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Yp(e)}function zae(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&yb(e,t)}function yb(e,t){return yb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},yb(e,t)}function yO(e,t,r){return t=bO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function bO(e){var t=Wae(e,"string");return yu(t)=="symbol"?t:t+""}function Wae(e,t){if(yu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(yu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var cm=function(e){function t(){return $ae(this,t),Fae(this,t,arguments)}return zae(t,e),Bae(t,[{key:"render",value:function(){return null}}])}(j.Component);yO(cm,"displayName","ZAxis");yO(cm,"defaultProps",{zAxisId:0,range:[64,64],scale:"auto",type:"number"});var Vae=["option","isActive"];function Gd(){return Gd=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Gd.apply(this,arguments)}function Hae(e,t){if(e==null)return{};var r=Xae(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Xae(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Kae(e){var t=e.option,r=e.isActive,n=Hae(e,Vae);return typeof t=="string"?j.createElement(ab,Gd({option:j.createElement(Wg,Gd({type:t},n)),isActive:r,shapeType:"symbols"},n)):j.createElement(ab,Gd({option:t,isActive:r,shapeType:"symbols"},n))}function bu(e){"@babel/helpers - typeof";return bu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},bu(e)}function Ud(){return Ud=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Ud.apply(this,arguments)}function T4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function oi(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T4(Object(r),!0).forEach(function(n){ws(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Yae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E4(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,wO(n.key),n)}}function qae(e,t,r){return t&&E4(e.prototype,t),r&&E4(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Zae(e,t,r){return t=qp(t),Jae(e,vO()?Reflect.construct(t,r||[],qp(e).constructor):t.apply(e,r))}function Jae(e,t){if(t&&(bu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Qae(e)}function Qae(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function vO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(vO=function(){return!!e})()}function qp(e){return qp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},qp(e)}function eie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bb(e,t)}function bb(e,t){return bb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},bb(e,t)}function ws(e,t,r){return t=wO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wO(e){var t=tie(e,"string");return bu(t)=="symbol"?t:t+""}function tie(e,t){if(bu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(bu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var ga=function(e){function t(){var r;Yae(this,t);for(var n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return r=Zae(this,t,[].concat(a)),ws(r,"state",{isAnimationFinished:!1}),ws(r,"handleAnimationEnd",function(){r.setState({isAnimationFinished:!0})}),ws(r,"handleAnimationStart",function(){r.setState({isAnimationFinished:!1})}),ws(r,"id",Kl("recharts-scatter-")),r}return eie(t,e),qae(t,[{key:"renderSymbolsStatically",value:function(n){var a=this,i=this.props,o=i.shape,s=i.activeShape,l=i.activeIndex,u=Dt(this.props,!1);return n.map(function(d,f){var h=l===f,p=h?s:o,x=oi(oi({},u),d);return re.createElement(_r,Ud({className:"recharts-scatter-symbol",key:"symbol-".concat(d==null?void 0:d.cx,"-").concat(d==null?void 0:d.cy,"-").concat(d==null?void 0:d.size,"-").concat(f)},lf(a.props,d,f),{role:"img"}),re.createElement(Kae,Ud({option:p,isActive:h,key:"symbol-".concat(f)},x)))})}},{key:"renderSymbolsWithAnimation",value:function(){var n=this,a=this.props,i=a.points,o=a.isAnimationActive,s=a.animationBegin,l=a.animationDuration,u=a.animationEasing,d=a.animationId,f=this.state.prevPoints;return re.createElement($i,{begin:s,duration:l,isActive:o,easing:u,from:{t:0},to:{t:1},key:"pie-".concat(d),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(h){var p=h.t,x=i.map(function(b,y){var m=f&&f[y];if(m){var g=xn(m.cx,b.cx),k=xn(m.cy,b.cy),S=xn(m.size,b.size);return oi(oi({},b),{},{cx:g(p),cy:k(p),size:S(p)})}var w=xn(0,b.size);return oi(oi({},b),{},{size:w(p)})});return re.createElement(_r,null,n.renderSymbolsStatically(x))})}},{key:"renderSymbols",value:function(){var n=this.props,a=n.points,i=n.isAnimationActive,o=this.state.prevPoints;return i&&a&&a.length&&(!o||!Fl(o,a))?this.renderSymbolsWithAnimation():this.renderSymbolsStatically(a)}},{key:"renderErrorBar",value:function(){var n=this.props.isAnimationActive;if(n&&!this.state.isAnimationFinished)return null;var a=this.props,i=a.points,o=a.xAxis,s=a.yAxis,l=a.children,u=Da(l,Uu);return u?u.map(function(d,f){var h=d.props,p=h.direction,x=h.dataKey;return re.cloneElement(d,{key:"".concat(p,"-").concat(x,"-").concat(i[f]),data:i,xAxis:o,yAxis:s,layout:p==="x"?"vertical":"horizontal",dataPointFormatter:function(y,m){return{x:y.cx,y:y.cy,value:p==="x"?+y.node.x:+y.node.y,errorVal:Bn(y,m)}}})}):null}},{key:"renderLine",value:function(){var n=this.props,a=n.points,i=n.line,o=n.lineType,s=n.lineJointType,l=Dt(this.props,!1),u=Dt(i,!1),d,f;if(o==="joint")d=a.map(function(k){return{x:k.cx,y:k.cy}});else if(o==="fitting"){var h=C$(a),p=h.xmin,x=h.xmax,b=h.a,y=h.b,m=function(S){return b*S+y};d=[{x:p,y:m(p)},{x,y:m(x)}]}var g=oi(oi(oi({},l),{},{fill:"none",stroke:l&&l.fill},u),{},{points:d});return re.isValidElement(i)?f=re.cloneElement(i,g):Bt(i)?f=i(g):f=re.createElement(Ml,Ud({},g,{type:s})),re.createElement(_r,{className:"recharts-scatter-line",key:"recharts-scatter-line"},f)}},{key:"render",value:function(){var n=this.props,a=n.hide,i=n.points,o=n.line,s=n.className,l=n.xAxis,u=n.yAxis,d=n.left,f=n.top,h=n.width,p=n.height,x=n.id,b=n.isAnimationActive;if(a||!i||!i.length)return null;var y=this.state.isAnimationFinished,m=hr("recharts-scatter",s),g=l&&l.allowDataOverflow,k=u&&u.allowDataOverflow,S=g||k,w=Et(x)?this.id:x;return re.createElement(_r,{className:m,clipPath:S?"url(#clipPath-".concat(w,")"):null},g||k?re.createElement("defs",null,re.createElement("clipPath",{id:"clipPath-".concat(w)},re.createElement("rect",{x:g?d:d-h/2,y:k?f:f-p/2,width:g?h:h*2,height:k?p:p*2}))):null,o&&this.renderLine(),this.renderErrorBar(),re.createElement(_r,{key:"recharts-scatter-symbols"},this.renderSymbols()),(!b||y)&&to.renderCallByParent(this.props,i))}}],[{key:"getDerivedStateFromProps",value:function(n,a){return n.animationId!==a.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,prevPoints:a.curPoints}:n.points!==a.curPoints?{curPoints:n.points}:null}}])}(j.PureComponent);ws(ga,"displayName","Scatter");ws(ga,"defaultProps",{xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!Ws.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"});ws(ga,"getComposedData",function(e){var t=e.xAxis,r=e.yAxis,n=e.zAxis,a=e.item,i=e.displayedData,o=e.xAxisTicks,s=e.yAxisTicks,l=e.offset,u=a.props.tooltipType,d=Da(a.props.children,f2),f=Et(t.dataKey)?a.props.dataKey:t.dataKey,h=Et(r.dataKey)?a.props.dataKey:r.dataKey,p=n&&n.dataKey,x=n?n.range:cm.defaultProps.range,b=x&&x[0],y=t.scale.bandwidth?t.scale.bandwidth():0,m=r.scale.bandwidth?r.scale.bandwidth():0,g=i.map(function(k,S){var w=Bn(k,f),v=Bn(k,h),M=!Et(p)&&Bn(k,p)||"-",_=[{name:Et(t.dataKey)?a.props.name:t.name||t.dataKey,unit:t.unit||"",value:w,payload:k,dataKey:f,type:u},{name:Et(r.dataKey)?a.props.name:r.name||r.dataKey,unit:r.unit||"",value:v,payload:k,dataKey:h,type:u}];M!=="-"&&_.push({name:n.name||n.dataKey,unit:n.unit||"",value:M,payload:k,dataKey:p,type:u});var P=su({axis:t,ticks:o,bandSize:y,entry:k,index:S,dataKey:f}),A=su({axis:r,ticks:s,bandSize:m,entry:k,index:S,dataKey:h}),R=M!=="-"?n.scale(M):b,D=Math.sqrt(Math.max(R,0)/Math.PI);return oi(oi({},k),{},{cx:P,cy:A,x:P-D,y:A-D,xAxis:t,yAxis:r,zAxis:n,width:2*D,height:2*D,size:R,node:{x:w,y:v,z:M},tooltipPayload:_,tooltipPosition:{x:P,y:A},payload:k},d&&d[S]&&d[S].props)});return oi({points:g},l)});function vu(e){"@babel/helpers - typeof";return vu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vu(e)}function rie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function nie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,jO(n.key),n)}}function aie(e,t,r){return t&&nie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function iie(e,t,r){return t=Zp(t),oie(e,kO()?Reflect.construct(t,r||[],Zp(e).constructor):t.apply(e,r))}function oie(e,t){if(t&&(vu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return sie(e)}function sie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function kO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(kO=function(){return!!e})()}function Zp(e){return Zp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Zp(e)}function lie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vb(e,t)}function vb(e,t){return vb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},vb(e,t)}function SO(e,t,r){return t=jO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function jO(e){var t=cie(e,"string");return vu(t)=="symbol"?t:t+""}function cie(e,t){if(vu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(vu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function wb(){return wb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},wb.apply(this,arguments)}function uie(e){var t=e.xAxisId,r=z2(),n=W2(),a=QC(t);return a==null?null:j.createElement(zu,wb({},a,{className:hr("recharts-".concat(a.axisType," ").concat(a.axisType),a.className),viewBox:{x:0,y:0,width:r,height:n},ticksGenerator:function(o){return _o(o,!0)}}))}var ba=function(e){function t(){return rie(this,t),iie(this,t,arguments)}return lie(t,e),aie(t,[{key:"render",value:function(){return j.createElement(uie,this.props)}}])}(j.Component);SO(ba,"displayName","XAxis");SO(ba,"defaultProps",{allowDecimals:!0,hide:!1,orientation:"bottom",width:0,height:30,mirror:!1,xAxisId:0,tickCount:5,type:"category",padding:{left:0,right:0},allowDataOverflow:!1,scale:"auto",reversed:!1,allowDuplicatedCategory:!0});function wu(e){"@babel/helpers - typeof";return wu=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},wu(e)}function die(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function fie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,PO(n.key),n)}}function hie(e,t,r){return t&&fie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function pie(e,t,r){return t=Jp(t),gie(e,MO()?Reflect.construct(t,r||[],Jp(e).constructor):t.apply(e,r))}function gie(e,t){if(t&&(wu(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return mie(e)}function mie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function MO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(MO=function(){return!!e})()}function Jp(e){return Jp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Jp(e)}function xie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&kb(e,t)}function kb(e,t){return kb=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},kb(e,t)}function _O(e,t,r){return t=PO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function PO(e){var t=yie(e,"string");return wu(t)=="symbol"?t:t+""}function yie(e,t){if(wu(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(wu(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}function Sb(){return Sb=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Sb.apply(this,arguments)}var bie=function(t){var r=t.yAxisId,n=z2(),a=W2(),i=eO(r);return i==null?null:j.createElement(zu,Sb({},i,{className:hr("recharts-".concat(i.axisType," ").concat(i.axisType),i.className),viewBox:{x:0,y:0,width:n,height:a},ticksGenerator:function(s){return _o(s,!0)}}))},va=function(e){function t(){return die(this,t),pie(this,t,arguments)}return xie(t,e),hie(t,[{key:"render",value:function(){return j.createElement(bie,this.props)}}])}(j.Component);_O(va,"displayName","YAxis");_O(va,"defaultProps",{allowDuplicatedCategory:!0,allowDecimals:!0,hide:!1,orientation:"left",width:60,height:0,mirror:!1,yAxisId:0,tickCount:5,type:"number",padding:{top:0,bottom:0},allowDataOverflow:!1,scale:"auto",reversed:!1});function I4(e){return Sie(e)||kie(e)||wie(e)||vie()}function vie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wie(e,t){if(e){if(typeof e=="string")return jb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return jb(e,t)}}function kie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Sie(e){if(Array.isArray(e))return jb(e)}function jb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var Mb=function(t,r,n,a,i){var o=Da(t,vs),s=Da(t,r0),l=[].concat(I4(o),I4(s)),u=Da(t,n0),d="".concat(a,"Id"),f=a[0],h=r;if(l.length&&(h=l.reduce(function(b,y){if(y.props[d]===n&&ro(y.props,"extendDomain")&&Re(y.props[f])){var m=y.props[f];return[Math.min(b[0],m),Math.max(b[1],m)]}return b},h)),u.length){var p="".concat(f,"1"),x="".concat(f,"2");h=u.reduce(function(b,y){if(y.props[d]===n&&ro(y.props,"extendDomain")&&Re(y.props[p])&&Re(y.props[x])){var m=y.props[p],g=y.props[x];return[Math.min(b[0],m,g),Math.max(b[1],m,g)]}return b},h)}return i&&i.length&&(h=i.reduce(function(b,y){return Re(y)?[Math.min(b[0],y),Math.max(b[1],y)]:b},h)),h},NO={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,r="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(r=!1));function a(l,u,d){this.fn=l,this.context=u,this.once=d||!1}function i(l,u,d,f,h){if(typeof d!="function")throw new TypeError("The listener must be a function");var p=new a(d,f||l,h),x=r?r+u:u;return l._events[x]?l._events[x].fn?l._events[x]=[l._events[x],p]:l._events[x].push(p):(l._events[x]=p,l._eventsCount++),l}function o(l,u){--l._eventsCount===0?l._events=new n:delete l._events[u]}function s(){this._events=new n,this._eventsCount=0}s.prototype.eventNames=function(){var u=[],d,f;if(this._eventsCount===0)return u;for(f in d=this._events)t.call(d,f)&&u.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(d)):u},s.prototype.listeners=function(u){var d=r?r+u:u,f=this._events[d];if(!f)return[];if(f.fn)return[f.fn];for(var h=0,p=f.length,x=new Array(p);h<p;h++)x[h]=f[h].fn;return x},s.prototype.listenerCount=function(u){var d=r?r+u:u,f=this._events[d];return f?f.fn?1:f.length:0},s.prototype.emit=function(u,d,f,h,p,x){var b=r?r+u:u;if(!this._events[b])return!1;var y=this._events[b],m=arguments.length,g,k;if(y.fn){switch(y.once&&this.removeListener(u,y.fn,void 0,!0),m){case 1:return y.fn.call(y.context),!0;case 2:return y.fn.call(y.context,d),!0;case 3:return y.fn.call(y.context,d,f),!0;case 4:return y.fn.call(y.context,d,f,h),!0;case 5:return y.fn.call(y.context,d,f,h,p),!0;case 6:return y.fn.call(y.context,d,f,h,p,x),!0}for(k=1,g=new Array(m-1);k<m;k++)g[k-1]=arguments[k];y.fn.apply(y.context,g)}else{var S=y.length,w;for(k=0;k<S;k++)switch(y[k].once&&this.removeListener(u,y[k].fn,void 0,!0),m){case 1:y[k].fn.call(y[k].context);break;case 2:y[k].fn.call(y[k].context,d);break;case 3:y[k].fn.call(y[k].context,d,f);break;case 4:y[k].fn.call(y[k].context,d,f,h);break;default:if(!g)for(w=1,g=new Array(m-1);w<m;w++)g[w-1]=arguments[w];y[k].fn.apply(y[k].context,g)}}return!0},s.prototype.on=function(u,d,f){return i(this,u,d,f,!1)},s.prototype.once=function(u,d,f){return i(this,u,d,f,!0)},s.prototype.removeListener=function(u,d,f,h){var p=r?r+u:u;if(!this._events[p])return this;if(!d)return o(this,p),this;var x=this._events[p];if(x.fn)x.fn===d&&(!h||x.once)&&(!f||x.context===f)&&o(this,p);else{for(var b=0,y=[],m=x.length;b<m;b++)(x[b].fn!==d||h&&!x[b].once||f&&x[b].context!==f)&&y.push(x[b]);y.length?this._events[p]=y.length===1?y[0]:y:o(this,p)}return this},s.prototype.removeAllListeners=function(u){var d;return u?(d=r?r+u:u,this._events[d]&&o(this,d)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s})(NO);var jie=NO.exports;const Mie=Br(jie);var Gx=new Mie,Ux="recharts.syncMouseEvents";function Uf(e){"@babel/helpers - typeof";return Uf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Uf(e)}function _ie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,CO(n.key),n)}}function Nie(e,t,r){return t&&Pie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function zx(e,t,r){return t=CO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CO(e){var t=Cie(e,"string");return Uf(t)=="symbol"?t:t+""}function Cie(e,t){if(Uf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(Uf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}var Oie=function(){function e(){_ie(this,e),zx(this,"activeIndex",0),zx(this,"coordinateList",[]),zx(this,"layout","horizontal")}return Nie(e,[{key:"setDetails",value:function(r){var n,a=r.coordinateList,i=a===void 0?null:a,o=r.container,s=o===void 0?null:o,l=r.layout,u=l===void 0?null:l,d=r.offset,f=d===void 0?null:d,h=r.mouseHandlerCallback,p=h===void 0?null:h;this.coordinateList=(n=i??this.coordinateList)!==null&&n!==void 0?n:[],this.container=s??this.container,this.layout=u??this.layout,this.offset=f??this.offset,this.mouseHandlerCallback=p??this.mouseHandlerCallback,this.activeIndex=Math.min(Math.max(this.activeIndex,0),this.coordinateList.length-1)}},{key:"focus",value:function(){this.spoofMouse()}},{key:"keyboardEvent",value:function(r){if(this.coordinateList.length!==0)switch(r.key){case"ArrowRight":{if(this.layout!=="horizontal")return;this.activeIndex=Math.min(this.activeIndex+1,this.coordinateList.length-1),this.spoofMouse();break}case"ArrowLeft":{if(this.layout!=="horizontal")return;this.activeIndex=Math.max(this.activeIndex-1,0),this.spoofMouse();break}}}},{key:"setIndex",value:function(r){this.activeIndex=r}},{key:"spoofMouse",value:function(){var r,n;if(this.layout==="horizontal"&&this.coordinateList.length!==0){var a=this.container.getBoundingClientRect(),i=a.x,o=a.y,s=a.height,l=this.coordinateList[this.activeIndex].coordinate,u=((r=window)===null||r===void 0?void 0:r.scrollX)||0,d=((n=window)===null||n===void 0?void 0:n.scrollY)||0,f=i+l+u,h=o+this.offset.top+s/2+d;this.mouseHandlerCallback({pageX:f,pageY:h})}}}])}();function Aie(e,t,r){if(r==="number"&&t===!0&&Array.isArray(e)){var n=e==null?void 0:e[0],a=e==null?void 0:e[1];if(n&&a&&Re(n)&&Re(a))return!0}return!1}function Tie(e,t,r,n){var a=n/2;return{stroke:"none",fill:"#ccc",x:e==="horizontal"?t.x-a:r.left+.5,y:e==="horizontal"?r.top+.5:t.y-a,width:e==="horizontal"?n:r.width-1,height:e==="horizontal"?r.height-1:n}}function OO(e){var t=e.cx,r=e.cy,n=e.radius,a=e.startAngle,i=e.endAngle,o=Zn(t,r,n,a),s=Zn(t,r,n,i);return{points:[o,s],cx:t,cy:r,radius:n,startAngle:a,endAngle:i}}function Eie(e,t,r){var n,a,i,o;if(e==="horizontal")n=t.x,i=n,a=r.top,o=r.top+r.height;else if(e==="vertical")a=t.y,o=a,n=r.left,i=r.left+r.width;else if(t.cx!=null&&t.cy!=null)if(e==="centric"){var s=t.cx,l=t.cy,u=t.innerRadius,d=t.outerRadius,f=t.angle,h=Zn(s,l,u,f),p=Zn(s,l,d,f);n=h.x,a=h.y,i=p.x,o=p.y}else return OO(t);return[{x:n,y:a},{x:i,y:o}]}function zf(e){"@babel/helpers - typeof";return zf=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zf(e)}function R4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function Q0(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?R4(Object(r),!0).forEach(function(n){Iie(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function Iie(e,t,r){return t=Rie(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Rie(e){var t=Die(e,"string");return zf(t)=="symbol"?t:t+""}function Die(e,t){if(zf(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(zf(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $ie(e){var t,r,n=e.element,a=e.tooltipEventType,i=e.isActive,o=e.activeCoordinate,s=e.activePayload,l=e.offset,u=e.activeTooltipIndex,d=e.tooltipAxisBandSize,f=e.layout,h=e.chartName,p=(t=n.props.cursor)!==null&&t!==void 0?t:(r=n.type.defaultProps)===null||r===void 0?void 0:r.cursor;if(!n||!p||!i||!o||h!=="ScatterChart"&&a!=="axis")return null;var x,b=Ml;if(h==="ScatterChart")x=o,b=cee;else if(h==="BarChart")x=Tie(f,o,l,d),b=L2;else if(f==="radial"){var y=OO(o),m=y.cx,g=y.cy,k=y.radius,S=y.startAngle,w=y.endAngle;x={cx:m,cy:g,startAngle:S,endAngle:w,innerRadius:k,outerRadius:k},b=MC}else x={points:Eie(f,o,l)},b=Ml;var v=Q0(Q0(Q0(Q0({stroke:"#ccc",pointerEvents:"none"},l),x),Dt(p,!1)),{},{payload:s,payloadIndex:u,className:hr("recharts-tooltip-cursor",p.className)});return j.isValidElement(p)?j.cloneElement(p,v):j.createElement(b,v)}var Lie=["item"],Bie=["children","className","width","height","style","compact","title","desc"];function ku(e){"@babel/helpers - typeof";return ku=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ku(e)}function Pc(){return Pc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Pc.apply(this,arguments)}function D4(e,t){return Uie(e)||Gie(e,t)||TO(e,t)||Fie()}function Fie(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Gie(e,t){var r=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var n,a,i,o,s=[],l=!0,u=!1;try{if(i=(r=r.call(e)).next,t!==0)for(;!(l=(n=i.call(r)).done)&&(s.push(n.value),s.length!==t);l=!0);}catch(d){u=!0,a=d}finally{try{if(!l&&r.return!=null&&(o=r.return(),Object(o)!==o))return}finally{if(u)throw a}}return s}}function Uie(e){if(Array.isArray(e))return e}function $4(e,t){if(e==null)return{};var r=zie(e,t),n,a;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function zie(e,t){if(e==null)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}function Wie(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Vie(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,EO(n.key),n)}}function Hie(e,t,r){return t&&Vie(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function Xie(e,t,r){return t=Qp(t),Kie(e,AO()?Reflect.construct(t,r||[],Qp(e).constructor):t.apply(e,r))}function Kie(e,t){if(t&&(ku(t)==="object"||typeof t=="function"))return t;if(t!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yie(e)}function Yie(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function AO(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(AO=function(){return!!e})()}function Qp(e){return Qp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},Qp(e)}function qie(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_b(e,t)}function _b(e,t){return _b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,a){return n.__proto__=a,n},_b(e,t)}function Su(e){return Qie(e)||Jie(e)||TO(e)||Zie()}function Zie(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function TO(e,t){if(e){if(typeof e=="string")return Pb(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Pb(e,t)}}function Jie(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Qie(e){if(Array.isArray(e))return Pb(e)}function Pb(e,t){(t==null||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function L4(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),r.push.apply(r,n)}return r}function ye(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?L4(Object(r),!0).forEach(function(n){St(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):L4(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function St(e,t,r){return t=EO(t),t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function EO(e){var t=eoe(e,"string");return ku(t)=="symbol"?t:t+""}function eoe(e,t){if(ku(e)!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var n=r.call(e,t);if(ku(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var toe={xAxis:["bottom","top"],yAxis:["left","right"]},roe={width:"100%",height:"100%"},IO={x:0,y:0};function eh(e){return e}var noe=function(t,r){return r==="horizontal"?t.x:r==="vertical"?t.y:r==="centric"?t.angle:t.radius},aoe=function(t,r,n,a){var i=r.find(function(d){return d&&d.index===n});if(i){if(t==="horizontal")return{x:i.coordinate,y:a.y};if(t==="vertical")return{x:a.x,y:i.coordinate};if(t==="centric"){var o=i.coordinate,s=a.radius;return ye(ye(ye({},a),Zn(a.cx,a.cy,s,o)),{},{angle:o,radius:s})}var l=i.coordinate,u=a.angle;return ye(ye(ye({},a),Zn(a.cx,a.cy,l,u)),{},{angle:u,radius:l})}return IO},um=function(t,r){var n=r.graphicalItems,a=r.dataStartIndex,i=r.dataEndIndex,o=(n??[]).reduce(function(s,l){var u=l.props.data;return u&&u.length?[].concat(Su(s),Su(u)):s},[]);return o.length>0?o:t&&t.length&&Re(a)&&Re(i)?t.slice(a,i+1):[]};function RO(e){return e==="number"?[0,"auto"]:void 0}var Nb=function(t,r,n,a){var i=t.graphicalItems,o=t.tooltipAxis,s=um(r,t);return n<0||!i||!i.length||n>=s.length?null:i.reduce(function(l,u){var d,f=(d=u.props.data)!==null&&d!==void 0?d:r;f&&t.dataStartIndex+t.dataEndIndex!==0&&t.dataEndIndex-t.dataStartIndex>=n&&(f=f.slice(t.dataStartIndex,t.dataEndIndex+1));var h;if(o.dataKey&&!o.allowDuplicatedCategory){var p=f===void 0?s:f;h=Zh(p,o.dataKey,a)}else h=f&&f[n]||s[n];return h?[].concat(Su(l),[kC(u,h)]):l},[])},B4=function(t,r,n,a){var i=a||{x:t.chartX,y:t.chartY},o=noe(i,n),s=t.orderedTooltipTicks,l=t.tooltipAxis,u=t.tooltipTicks,d=Gq(o,s,u,l);if(d>=0&&u){var f=u[d]&&u[d].value,h=Nb(t,r,d,f),p=aoe(n,s,d,i);return{activeTooltipIndex:d,activeLabel:f,activePayload:h,activeCoordinate:p}}return null},ioe=function(t,r){var n=r.axes,a=r.graphicalItems,i=r.axisType,o=r.axisIdKey,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=t.stackOffset,p=bC(d,i);return n.reduce(function(x,b){var y,m=b.type.defaultProps!==void 0?ye(ye({},b.type.defaultProps),b.props):b.props,g=m.type,k=m.dataKey,S=m.allowDataOverflow,w=m.allowDuplicatedCategory,v=m.scale,M=m.ticks,_=m.includeHidden,P=m[o];if(x[P])return x;var A=um(t.data,{graphicalItems:a.filter(function(z){var V,K=o in z.props?z.props[o]:(V=z.type.defaultProps)===null||V===void 0?void 0:V[o];return K===P}),dataStartIndex:l,dataEndIndex:u}),R=A.length,D,E,W;Aie(m.domain,S,g)&&(D=U1(m.domain,null,S),p&&(g==="number"||v!=="auto")&&(W=Ld(A,k,"category")));var F=RO(g);if(!D||D.length===0){var O,$=(O=m.domain)!==null&&O!==void 0?O:F;if(k){if(D=Ld(A,k,g),g==="category"&&p){var N=N$(D);w&&N?(E=D,D=$p(0,R)):w||(D=m5($,D,b).reduce(function(z,V){return z.indexOf(V)>=0?z:[].concat(Su(z),[V])},[]))}else if(g==="category")w?D=D.filter(function(z){return z!==""&&!Et(z)}):D=m5($,D,b).reduce(function(z,V){return z.indexOf(V)>=0||V===""||Et(V)?z:[].concat(Su(z),[V])},[]);else if(g==="number"){var C=Hq(A,a.filter(function(z){var V,K,q=o in z.props?z.props[o]:(V=z.type.defaultProps)===null||V===void 0?void 0:V[o],G="hide"in z.props?z.props.hide:(K=z.type.defaultProps)===null||K===void 0?void 0:K.hide;return q===P&&(_||!G)}),k,i,d);C&&(D=C)}p&&(g==="number"||v!=="auto")&&(W=Ld(A,k,"category"))}else p?D=$p(0,R):s&&s[P]&&s[P].hasStack&&g==="number"?D=h==="expand"?[0,1]:wC(s[P].stackGroups,l,u):D=yC(A,a.filter(function(z){var V=o in z.props?z.props[o]:z.type.defaultProps[o],K="hide"in z.props?z.props.hide:z.type.defaultProps.hide;return V===P&&(_||!K)}),g,d,!0);if(g==="number")D=Mb(f,D,P,i,M),$&&(D=U1($,D,S));else if(g==="category"&&$){var B=$,I=D.every(function(z){return B.indexOf(z)>=0});I&&(D=B)}}return ye(ye({},x),{},St({},P,ye(ye({},m),{},{axisType:i,domain:D,categoricalDomain:W,duplicateDomain:E,originalDomain:(y=m.domain)!==null&&y!==void 0?y:F,isCategorical:p,layout:d})))},{})},ooe=function(t,r){var n=r.graphicalItems,a=r.Axis,i=r.axisType,o=r.axisIdKey,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.layout,f=t.children,h=um(t.data,{graphicalItems:n,dataStartIndex:l,dataEndIndex:u}),p=h.length,x=bC(d,i),b=-1;return n.reduce(function(y,m){var g=m.type.defaultProps!==void 0?ye(ye({},m.type.defaultProps),m.props):m.props,k=g[o],S=RO("number");if(!y[k]){b++;var w;return x?w=$p(0,p):s&&s[k]&&s[k].hasStack?(w=wC(s[k].stackGroups,l,u),w=Mb(f,w,k,i)):(w=U1(S,yC(h,n.filter(function(v){var M,_,P=o in v.props?v.props[o]:(M=v.type.defaultProps)===null||M===void 0?void 0:M[o],A="hide"in v.props?v.props.hide:(_=v.type.defaultProps)===null||_===void 0?void 0:_.hide;return P===k&&!A}),"number",d),a.defaultProps.allowDataOverflow),w=Mb(f,w,k,i)),ye(ye({},y),{},St({},k,ye(ye({axisType:i},a.defaultProps),{},{hide:!0,orientation:hi(toe,"".concat(i,".").concat(b%2),null),domain:w,originalDomain:S,isCategorical:x,layout:d})))}return y},{})},soe=function(t,r){var n=r.axisType,a=n===void 0?"xAxis":n,i=r.AxisComp,o=r.graphicalItems,s=r.stackGroups,l=r.dataStartIndex,u=r.dataEndIndex,d=t.children,f="".concat(a,"Id"),h=Da(d,i),p={};return h&&h.length?p=ioe(t,{axes:h,graphicalItems:o,axisType:a,axisIdKey:f,stackGroups:s,dataStartIndex:l,dataEndIndex:u}):o&&o.length&&(p=ooe(t,{Axis:i,graphicalItems:o,axisType:a,axisIdKey:f,stackGroups:s,dataStartIndex:l,dataEndIndex:u})),p},loe=function(t){var r=us(t),n=_o(r,!1,!0);return{tooltipTicks:n,orderedTooltipTicks:u2(n,function(a){return a.coordinate}),tooltipAxis:r,tooltipAxisBandSize:Pp(r,n)}},F4=function(t){var r=t.children,n=t.defaultShowTooltip,a=Va(r,uu),i=0,o=0;return t.data&&t.data.length!==0&&(o=t.data.length-1),a&&a.props&&(a.props.startIndex>=0&&(i=a.props.startIndex),a.props.endIndex>=0&&(o=a.props.endIndex)),{chartX:0,chartY:0,dataStartIndex:i,dataEndIndex:o,activeTooltipIndex:-1,isTooltipActive:!!n}},coe=function(t){return!t||!t.length?!1:t.some(function(r){var n=No(r&&r.type);return n&&n.indexOf("Bar")>=0})},G4=function(t){return t==="horizontal"?{numericAxisName:"yAxis",cateAxisName:"xAxis"}:t==="vertical"?{numericAxisName:"xAxis",cateAxisName:"yAxis"}:t==="centric"?{numericAxisName:"radiusAxis",cateAxisName:"angleAxis"}:{numericAxisName:"angleAxis",cateAxisName:"radiusAxis"}},uoe=function(t,r){var n=t.props,a=t.graphicalItems,i=t.xAxisMap,o=i===void 0?{}:i,s=t.yAxisMap,l=s===void 0?{}:s,u=n.width,d=n.height,f=n.children,h=n.margin||{},p=Va(f,uu),x=Va(f,Qi),b=Object.keys(l).reduce(function(w,v){var M=l[v],_=M.orientation;return!M.mirror&&!M.hide?ye(ye({},w),{},St({},_,w[_]+M.width)):w},{left:h.left||0,right:h.right||0}),y=Object.keys(o).reduce(function(w,v){var M=o[v],_=M.orientation;return!M.mirror&&!M.hide?ye(ye({},w),{},St({},_,hi(w,"".concat(_))+M.height)):w},{top:h.top||0,bottom:h.bottom||0}),m=ye(ye({},y),b),g=m.bottom;p&&(m.bottom+=p.props.height||uu.defaultProps.height),x&&r&&(m=Wq(m,a,n,r));var k=u-m.left-m.right,S=d-m.top-m.bottom;return ye(ye({brushBottom:g},m),{},{width:Math.max(k,0),height:Math.max(S,0)})},doe=function(t,r){if(r==="xAxis")return t[r].width;if(r==="yAxis")return t[r].height},K2=function(t){var r=t.chartName,n=t.GraphicalChild,a=t.defaultTooltipEventType,i=a===void 0?"axis":a,o=t.validateTooltipEventTypes,s=o===void 0?["axis"]:o,l=t.axisComponents,u=t.legendContent,d=t.formatAxisMap,f=t.defaultProps,h=function(m,g){var k=g.graphicalItems,S=g.stackGroups,w=g.offset,v=g.updateId,M=g.dataStartIndex,_=g.dataEndIndex,P=m.barSize,A=m.layout,R=m.barGap,D=m.barCategoryGap,E=m.maxBarSize,W=G4(A),F=W.numericAxisName,O=W.cateAxisName,$=coe(k),N=[];return k.forEach(function(C,B){var I=um(m.data,{graphicalItems:[C],dataStartIndex:M,dataEndIndex:_}),z=C.type.defaultProps!==void 0?ye(ye({},C.type.defaultProps),C.props):C.props,V=z.dataKey,K=z.maxBarSize,q=z["".concat(F,"Id")],G=z["".concat(O,"Id")],pe={},J=l.reduce(function(te,Oe){var Fe=g["".concat(Oe.axisType,"Map")],bt=z["".concat(Oe.axisType,"Id")];Fe&&Fe[bt]||Oe.axisType==="zAxis"||Ul();var Ct=Fe[bt];return ye(ye({},te),{},St(St({},Oe.axisType,Ct),"".concat(Oe.axisType,"Ticks"),_o(Ct)))},pe),Z=J[O],ae=J["".concat(O,"Ticks")],ce=S&&S[q]&&S[q].hasStack&&aZ(C,S[q].stackGroups),ne=No(C.type).indexOf("Bar")>=0,le=Pp(Z,ae),se=[],he=$&&Uq({barSize:P,stackGroups:S,totalSize:doe(J,O)});if(ne){var ue,ie,xe=Et(K)?E:K,Se=(ue=(ie=Pp(Z,ae,!0))!==null&&ie!==void 0?ie:xe)!==null&&ue!==void 0?ue:0;se=zq({barGap:R,barCategoryGap:D,bandSize:Se!==le?Se:le,sizeList:he[G],maxBarSize:xe}),Se!==le&&(se=se.map(function(te){return ye(ye({},te),{},{position:ye(ye({},te.position),{},{offset:te.position.offset-Se/2})})}))}var Ie=C&&C.type&&C.type.getComposedData;Ie&&N.push({props:ye(ye({},Ie(ye(ye({},J),{},{displayedData:I,props:m,dataKey:V,item:C,bandSize:le,barPosition:se,offset:w,stackedData:ce,layout:A,dataStartIndex:M,dataEndIndex:_}))),{},St(St(St({key:C.key||"item-".concat(B)},F,J[F]),O,J[O]),"animationId",v)),childIndex:G$(C,m.children),item:C})}),N},p=function(m,g){var k=m.props,S=m.dataStartIndex,w=m.dataEndIndex,v=m.updateId;if(!u3({props:k}))return null;var M=k.children,_=k.layout,P=k.stackOffset,A=k.data,R=k.reverseStackOrder,D=G4(_),E=D.numericAxisName,W=D.cateAxisName,F=Da(M,n),O=tZ(A,F,"".concat(E,"Id"),"".concat(W,"Id"),P,R),$=l.reduce(function(z,V){var K="".concat(V.axisType,"Map");return ye(ye({},z),{},St({},K,soe(k,ye(ye({},V),{},{graphicalItems:F,stackGroups:V.axisType===E&&O,dataStartIndex:S,dataEndIndex:w}))))},{}),N=uoe(ye(ye({},$),{},{props:k,graphicalItems:F}),g==null?void 0:g.legendBBox);Object.keys($).forEach(function(z){$[z]=d(k,$[z],N,z.replace("Map",""),r)});var C=$["".concat(W,"Map")],B=loe(C),I=h(k,ye(ye({},$),{},{dataStartIndex:S,dataEndIndex:w,updateId:v,graphicalItems:F,stackGroups:O,offset:N}));return ye(ye({formattedGraphicalItems:I,graphicalItems:F,offset:N,stackGroups:O},B),$)},x=function(y){function m(g){var k,S,w;return Wie(this,m),w=Xie(this,m,[g]),St(w,"eventEmitterSymbol",Symbol("rechartsEventEmitter")),St(w,"accessibilityManager",new Oie),St(w,"handleLegendBBoxUpdate",function(v){if(v){var M=w.state,_=M.dataStartIndex,P=M.dataEndIndex,A=M.updateId;w.setState(ye({legendBBox:v},p({props:w.props,dataStartIndex:_,dataEndIndex:P,updateId:A},ye(ye({},w.state),{},{legendBBox:v}))))}}),St(w,"handleReceiveSyncEvent",function(v,M,_){if(w.props.syncId===v){if(_===w.eventEmitterSymbol&&typeof w.props.syncMethod!="function")return;w.applySyncEvent(M)}}),St(w,"handleBrushChange",function(v){var M=v.startIndex,_=v.endIndex;if(M!==w.state.dataStartIndex||_!==w.state.dataEndIndex){var P=w.state.updateId;w.setState(function(){return ye({dataStartIndex:M,dataEndIndex:_},p({props:w.props,dataStartIndex:M,dataEndIndex:_,updateId:P},w.state))}),w.triggerSyncEvent({dataStartIndex:M,dataEndIndex:_})}}),St(w,"handleMouseEnter",function(v){var M=w.getMouseInfo(v);if(M){var _=ye(ye({},M),{},{isTooltipActive:!0});w.setState(_),w.triggerSyncEvent(_);var P=w.props.onMouseEnter;Bt(P)&&P(_,v)}}),St(w,"triggeredAfterMouseMove",function(v){var M=w.getMouseInfo(v),_=M?ye(ye({},M),{},{isTooltipActive:!0}):{isTooltipActive:!1};w.setState(_),w.triggerSyncEvent(_);var P=w.props.onMouseMove;Bt(P)&&P(_,v)}),St(w,"handleItemMouseEnter",function(v){w.setState(function(){return{isTooltipActive:!0,activeItem:v,activePayload:v.tooltipPayload,activeCoordinate:v.tooltipPosition||{x:v.cx,y:v.cy}}})}),St(w,"handleItemMouseLeave",function(){w.setState(function(){return{isTooltipActive:!1}})}),St(w,"handleMouseMove",function(v){v.persist(),w.throttleTriggeredAfterMouseMove(v)}),St(w,"handleMouseLeave",function(v){w.throttleTriggeredAfterMouseMove.cancel();var M={isTooltipActive:!1};w.setState(M),w.triggerSyncEvent(M);var _=w.props.onMouseLeave;Bt(_)&&_(M,v)}),St(w,"handleOuterEvent",function(v){var M=F$(v),_=hi(w.props,"".concat(M));if(M&&Bt(_)){var P,A;/.*touch.*/i.test(M)?A=w.getMouseInfo(v.changedTouches[0]):A=w.getMouseInfo(v),_((P=A)!==null&&P!==void 0?P:{},v)}}),St(w,"handleClick",function(v){var M=w.getMouseInfo(v);if(M){var _=ye(ye({},M),{},{isTooltipActive:!0});w.setState(_),w.triggerSyncEvent(_);var P=w.props.onClick;Bt(P)&&P(_,v)}}),St(w,"handleMouseDown",function(v){var M=w.props.onMouseDown;if(Bt(M)){var _=w.getMouseInfo(v);M(_,v)}}),St(w,"handleMouseUp",function(v){var M=w.props.onMouseUp;if(Bt(M)){var _=w.getMouseInfo(v);M(_,v)}}),St(w,"handleTouchMove",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.throttleTriggeredAfterMouseMove(v.changedTouches[0])}),St(w,"handleTouchStart",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.handleMouseDown(v.changedTouches[0])}),St(w,"handleTouchEnd",function(v){v.changedTouches!=null&&v.changedTouches.length>0&&w.handleMouseUp(v.changedTouches[0])}),St(w,"handleDoubleClick",function(v){var M=w.props.onDoubleClick;if(Bt(M)){var _=w.getMouseInfo(v);M(_,v)}}),St(w,"handleContextMenu",function(v){var M=w.props.onContextMenu;if(Bt(M)){var _=w.getMouseInfo(v);M(_,v)}}),St(w,"triggerSyncEvent",function(v){w.props.syncId!==void 0&&Gx.emit(Ux,w.props.syncId,v,w.eventEmitterSymbol)}),St(w,"applySyncEvent",function(v){var M=w.props,_=M.layout,P=M.syncMethod,A=w.state.updateId,R=v.dataStartIndex,D=v.dataEndIndex;if(v.dataStartIndex!==void 0||v.dataEndIndex!==void 0)w.setState(ye({dataStartIndex:R,dataEndIndex:D},p({props:w.props,dataStartIndex:R,dataEndIndex:D,updateId:A},w.state)));else if(v.activeTooltipIndex!==void 0){var E=v.chartX,W=v.chartY,F=v.activeTooltipIndex,O=w.state,$=O.offset,N=O.tooltipTicks;if(!$)return;if(typeof P=="function")F=P(N,v);else if(P==="value"){F=-1;for(var C=0;C<N.length;C++)if(N[C].value===v.activeLabel){F=C;break}}var B=ye(ye({},$),{},{x:$.left,y:$.top}),I=Math.min(E,B.x+B.width),z=Math.min(W,B.y+B.height),V=N[F]&&N[F].value,K=Nb(w.state,w.props.data,F),q=N[F]?{x:_==="horizontal"?N[F].coordinate:I,y:_==="horizontal"?z:N[F].coordinate}:IO;w.setState(ye(ye({},v),{},{activeLabel:V,activeCoordinate:q,activePayload:K,activeTooltipIndex:F}))}else w.setState(v)}),St(w,"renderCursor",function(v){var M,_=w.state,P=_.isTooltipActive,A=_.activeCoordinate,R=_.activePayload,D=_.offset,E=_.activeTooltipIndex,W=_.tooltipAxisBandSize,F=w.getTooltipEventType(),O=(M=v.props.active)!==null&&M!==void 0?M:P,$=w.props.layout,N=v.key||"_recharts-cursor";return re.createElement($ie,{key:N,activeCoordinate:A,activePayload:R,activeTooltipIndex:E,chartName:r,element:v,isActive:O,layout:$,offset:D,tooltipAxisBandSize:W,tooltipEventType:F})}),St(w,"renderPolarAxis",function(v,M,_){var P=hi(v,"type.axisType"),A=hi(w.state,"".concat(P,"Map")),R=v.type.defaultProps,D=R!==void 0?ye(ye({},R),v.props):v.props,E=A&&A[D["".concat(P,"Id")]];return j.cloneElement(v,ye(ye({},E),{},{className:hr(P,E.className),key:v.key||"".concat(M,"-").concat(_),ticks:_o(E,!0)}))}),St(w,"renderPolarGrid",function(v){var M=v.props,_=M.radialLines,P=M.polarAngles,A=M.polarRadius,R=w.state,D=R.radiusAxisMap,E=R.angleAxisMap,W=us(D),F=us(E),O=F.cx,$=F.cy,N=F.innerRadius,C=F.outerRadius;return j.cloneElement(v,{polarAngles:Array.isArray(P)?P:_o(F,!0).map(function(B){return B.coordinate}),polarRadius:Array.isArray(A)?A:_o(W,!0).map(function(B){return B.coordinate}),cx:O,cy:$,innerRadius:N,outerRadius:C,key:v.key||"polar-grid",radialLines:_})}),St(w,"renderLegend",function(){var v=w.state.formattedGraphicalItems,M=w.props,_=M.children,P=M.width,A=M.height,R=w.props.margin||{},D=P-(R.left||0)-(R.right||0),E=mC({children:_,formattedGraphicalItems:v,legendWidth:D,legendContent:u});if(!E)return null;var W=E.item,F=$4(E,Lie);return j.cloneElement(W,ye(ye({},F),{},{chartWidth:P,chartHeight:A,margin:R,onBBoxUpdate:w.handleLegendBBoxUpdate}))}),St(w,"renderTooltip",function(){var v,M=w.props,_=M.children,P=M.accessibilityLayer,A=Va(_,Rn);if(!A)return null;var R=w.state,D=R.isTooltipActive,E=R.activeCoordinate,W=R.activePayload,F=R.activeLabel,O=R.offset,$=(v=A.props.active)!==null&&v!==void 0?v:D;return j.cloneElement(A,{viewBox:ye(ye({},O),{},{x:O.left,y:O.top}),active:$,label:F,payload:$?W:[],coordinate:E,accessibilityLayer:P})}),St(w,"renderBrush",function(v){var M=w.props,_=M.margin,P=M.data,A=w.state,R=A.offset,D=A.dataStartIndex,E=A.dataEndIndex,W=A.updateId;return j.cloneElement(v,{key:v.key||"_recharts-brush",onChange:Y0(w.handleBrushChange,v.props.onChange),data:P,x:Re(v.props.x)?v.props.x:R.left,y:Re(v.props.y)?v.props.y:R.top+R.height+R.brushBottom-(_.bottom||0),width:Re(v.props.width)?v.props.width:R.width,startIndex:D,endIndex:E,updateId:"brush-".concat(W)})}),St(w,"renderReferenceElement",function(v,M,_){if(!v)return null;var P=w,A=P.clipPathId,R=w.state,D=R.xAxisMap,E=R.yAxisMap,W=R.offset,F=v.type.defaultProps||{},O=v.props,$=O.xAxisId,N=$===void 0?F.xAxisId:$,C=O.yAxisId,B=C===void 0?F.yAxisId:C;return j.cloneElement(v,{key:v.key||"".concat(M,"-").concat(_),xAxis:D[N],yAxis:E[B],viewBox:{x:W.left,y:W.top,width:W.width,height:W.height},clipPathId:A})}),St(w,"renderActivePoints",function(v){var M=v.item,_=v.activePoint,P=v.basePoint,A=v.childIndex,R=v.isRange,D=[],E=M.props.key,W=M.item.type.defaultProps!==void 0?ye(ye({},M.item.type.defaultProps),M.item.props):M.item.props,F=W.activeDot,O=W.dataKey,$=ye(ye({index:A,dataKey:O,cx:_.x,cy:_.y,r:4,fill:$2(M.item),strokeWidth:2,stroke:"#fff",payload:_.payload,value:_.value},Dt(F,!1)),Jh(F));return D.push(m.renderActiveDot(F,$,"".concat(E,"-activePoint-").concat(A))),P?D.push(m.renderActiveDot(F,ye(ye({},$),{},{cx:P.x,cy:P.y}),"".concat(E,"-basePoint-").concat(A))):R&&D.push(null),D}),St(w,"renderGraphicChild",function(v,M,_){var P=w.filterFormatItem(v,M,_);if(!P)return null;var A=w.getTooltipEventType(),R=w.state,D=R.isTooltipActive,E=R.tooltipAxis,W=R.activeTooltipIndex,F=R.activeLabel,O=w.props.children,$=Va(O,Rn),N=P.props,C=N.points,B=N.isRange,I=N.baseLine,z=P.item.type.defaultProps!==void 0?ye(ye({},P.item.type.defaultProps),P.item.props):P.item.props,V=z.activeDot,K=z.hide,q=z.activeBar,G=z.activeShape,pe=!!(!K&&D&&$&&(V||q||G)),J={};A!=="axis"&&$&&$.props.trigger==="click"?J={onClick:Y0(w.handleItemMouseEnter,v.props.onClick)}:A!=="axis"&&(J={onMouseLeave:Y0(w.handleItemMouseLeave,v.props.onMouseLeave),onMouseEnter:Y0(w.handleItemMouseEnter,v.props.onMouseEnter)});var Z=j.cloneElement(v,ye(ye({},P.props),J));function ae(Oe){return typeof E.dataKey=="function"?E.dataKey(Oe.payload):null}if(pe)if(W>=0){var ce,ne;if(E.dataKey&&!E.allowDuplicatedCategory){var le=typeof E.dataKey=="function"?ae:"payload.".concat(E.dataKey.toString());ce=Zh(C,le,F),ne=B&&I&&Zh(I,le,F)}else ce=C==null?void 0:C[W],ne=B&&I&&I[W];if(G||q){var se=v.props.activeIndex!==void 0?v.props.activeIndex:W;return[j.cloneElement(v,ye(ye(ye({},P.props),J),{},{activeIndex:se})),null,null]}if(!Et(ce))return[Z].concat(Su(w.renderActivePoints({item:P,activePoint:ce,basePoint:ne,childIndex:W,isRange:B})))}else{var he,ue=(he=w.getItemByXY(w.state.activeCoordinate))!==null&&he!==void 0?he:{graphicalItem:Z},ie=ue.graphicalItem,xe=ie.item,Se=xe===void 0?v:xe,Ie=ie.childIndex,te=ye(ye(ye({},P.props),J),{},{activeIndex:Ie});return[j.cloneElement(Se,te),null,null]}return B?[Z,null,null]:[Z,null]}),St(w,"renderCustomized",function(v,M,_){return j.cloneElement(v,ye(ye({key:"recharts-customized-".concat(_)},w.props),w.state))}),St(w,"renderMap",{CartesianGrid:{handler:eh,once:!0},ReferenceArea:{handler:w.renderReferenceElement},ReferenceLine:{handler:eh},ReferenceDot:{handler:w.renderReferenceElement},XAxis:{handler:eh},YAxis:{handler:eh},Brush:{handler:w.renderBrush,once:!0},Bar:{handler:w.renderGraphicChild},Line:{handler:w.renderGraphicChild},Area:{handler:w.renderGraphicChild},Radar:{handler:w.renderGraphicChild},RadialBar:{handler:w.renderGraphicChild},Scatter:{handler:w.renderGraphicChild},Pie:{handler:w.renderGraphicChild},Funnel:{handler:w.renderGraphicChild},Tooltip:{handler:w.renderCursor,once:!0},PolarGrid:{handler:w.renderPolarGrid,once:!0},PolarAngleAxis:{handler:w.renderPolarAxis},PolarRadiusAxis:{handler:w.renderPolarAxis},Customized:{handler:w.renderCustomized}}),w.clipPathId="".concat((k=g.id)!==null&&k!==void 0?k:Kl("recharts"),"-clip"),w.throttleTriggeredAfterMouseMove=xN(w.triggeredAfterMouseMove,(S=g.throttleDelay)!==null&&S!==void 0?S:1e3/60),w.state={},w}return qie(m,y),Hie(m,[{key:"componentDidMount",value:function(){var k,S;this.addListener(),this.accessibilityManager.setDetails({container:this.container,offset:{left:(k=this.props.margin.left)!==null&&k!==void 0?k:0,top:(S=this.props.margin.top)!==null&&S!==void 0?S:0},coordinateList:this.state.tooltipTicks,mouseHandlerCallback:this.triggeredAfterMouseMove,layout:this.props.layout}),this.displayDefaultTooltip()}},{key:"displayDefaultTooltip",value:function(){var k=this.props,S=k.children,w=k.data,v=k.height,M=k.layout,_=Va(S,Rn);if(_){var P=_.props.defaultIndex;if(!(typeof P!="number"||P<0||P>this.state.tooltipTicks.length-1)){var A=this.state.tooltipTicks[P]&&this.state.tooltipTicks[P].value,R=Nb(this.state,w,P,A),D=this.state.tooltipTicks[P].coordinate,E=(this.state.offset.top+v)/2,W=M==="horizontal",F=W?{x:D,y:E}:{y:D,x:E},O=this.state.formattedGraphicalItems.find(function(N){var C=N.item;return C.type.name==="Scatter"});O&&(F=ye(ye({},F),O.props.points[P].tooltipPosition),R=O.props.points[P].tooltipPayload);var $={activeTooltipIndex:P,isTooltipActive:!0,activeLabel:A,activePayload:R,activeCoordinate:F};this.setState($),this.renderCursor(_),this.accessibilityManager.setIndex(P)}}}},{key:"getSnapshotBeforeUpdate",value:function(k,S){if(!this.props.accessibilityLayer)return null;if(this.state.tooltipTicks!==S.tooltipTicks&&this.accessibilityManager.setDetails({coordinateList:this.state.tooltipTicks}),this.props.layout!==k.layout&&this.accessibilityManager.setDetails({layout:this.props.layout}),this.props.margin!==k.margin){var w,v;this.accessibilityManager.setDetails({offset:{left:(w=this.props.margin.left)!==null&&w!==void 0?w:0,top:(v=this.props.margin.top)!==null&&v!==void 0?v:0}})}return null}},{key:"componentDidUpdate",value:function(k){n1([Va(k.children,Rn)],[Va(this.props.children,Rn)])||this.displayDefaultTooltip()}},{key:"componentWillUnmount",value:function(){this.removeListener(),this.throttleTriggeredAfterMouseMove.cancel()}},{key:"getTooltipEventType",value:function(){var k=Va(this.props.children,Rn);if(k&&typeof k.props.shared=="boolean"){var S=k.props.shared?"axis":"item";return s.indexOf(S)>=0?S:i}return i}},{key:"getMouseInfo",value:function(k){if(!this.container)return null;var S=this.container,w=S.getBoundingClientRect(),v=hH(w),M={chartX:Math.round(k.pageX-v.left),chartY:Math.round(k.pageY-v.top)},_=w.width/S.offsetWidth||1,P=this.inRange(M.chartX,M.chartY,_);if(!P)return null;var A=this.state,R=A.xAxisMap,D=A.yAxisMap,E=this.getTooltipEventType(),W=B4(this.state,this.props.data,this.props.layout,P);if(E!=="axis"&&R&&D){var F=us(R).scale,O=us(D).scale,$=F&&F.invert?F.invert(M.chartX):null,N=O&&O.invert?O.invert(M.chartY):null;return ye(ye({},M),{},{xValue:$,yValue:N},W)}return W?ye(ye({},M),W):null}},{key:"inRange",value:function(k,S){var w=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,v=this.props.layout,M=k/w,_=S/w;if(v==="horizontal"||v==="vertical"){var P=this.state.offset,A=M>=P.left&&M<=P.left+P.width&&_>=P.top&&_<=P.top+P.height;return A?{x:M,y:_}:null}var R=this.state,D=R.angleAxisMap,E=R.radiusAxisMap;if(D&&E){var W=us(D);return b5({x:M,y:_},W)}return null}},{key:"parseEventsOfWrapper",value:function(){var k=this.props.children,S=this.getTooltipEventType(),w=Va(k,Rn),v={};w&&S==="axis"&&(w.props.trigger==="click"?v={onClick:this.handleClick}:v={onMouseEnter:this.handleMouseEnter,onDoubleClick:this.handleDoubleClick,onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,onTouchMove:this.handleTouchMove,onTouchStart:this.handleTouchStart,onTouchEnd:this.handleTouchEnd,onContextMenu:this.handleContextMenu});var M=Jh(this.props,this.handleOuterEvent);return ye(ye({},M),v)}},{key:"addListener",value:function(){Gx.on(Ux,this.handleReceiveSyncEvent)}},{key:"removeListener",value:function(){Gx.removeListener(Ux,this.handleReceiveSyncEvent)}},{key:"filterFormatItem",value:function(k,S,w){for(var v=this.state.formattedGraphicalItems,M=0,_=v.length;M<_;M++){var P=v[M];if(P.item===k||P.props.key===k.key||S===No(P.item.type)&&w===P.childIndex)return P}return null}},{key:"renderClipPath",value:function(){var k=this.clipPathId,S=this.state.offset,w=S.left,v=S.top,M=S.height,_=S.width;return re.createElement("defs",null,re.createElement("clipPath",{id:k},re.createElement("rect",{x:w,y:v,height:M,width:_})))}},{key:"getXScales",value:function(){var k=this.state.xAxisMap;return k?Object.entries(k).reduce(function(S,w){var v=D4(w,2),M=v[0],_=v[1];return ye(ye({},S),{},St({},M,_.scale))},{}):null}},{key:"getYScales",value:function(){var k=this.state.yAxisMap;return k?Object.entries(k).reduce(function(S,w){var v=D4(w,2),M=v[0],_=v[1];return ye(ye({},S),{},St({},M,_.scale))},{}):null}},{key:"getXScaleByAxisId",value:function(k){var S;return(S=this.state.xAxisMap)===null||S===void 0||(S=S[k])===null||S===void 0?void 0:S.scale}},{key:"getYScaleByAxisId",value:function(k){var S;return(S=this.state.yAxisMap)===null||S===void 0||(S=S[k])===null||S===void 0?void 0:S.scale}},{key:"getItemByXY",value:function(k){var S=this.state,w=S.formattedGraphicalItems,v=S.activeItem;if(w&&w.length)for(var M=0,_=w.length;M<_;M++){var P=w[M],A=P.props,R=P.item,D=R.type.defaultProps!==void 0?ye(ye({},R.type.defaultProps),R.props):R.props,E=No(R.type);if(E==="Bar"){var W=(A.data||[]).find(function(N){return QQ(k,N)});if(W)return{graphicalItem:P,payload:W}}else if(E==="RadialBar"){var F=(A.data||[]).find(function(N){return b5(k,N)});if(F)return{graphicalItem:P,payload:F}}else if(am(P,v)||im(P,v)||$f(P,v)){var O=tte({graphicalItem:P,activeTooltipItem:v,itemData:D.data}),$=D.activeIndex===void 0?O:D.activeIndex;return{graphicalItem:ye(ye({},P),{},{childIndex:$}),payload:$f(P,v)?D.data[O]:P.props.data[O]}}}return null}},{key:"render",value:function(){var k=this;if(!u3(this))return null;var S=this.props,w=S.children,v=S.className,M=S.width,_=S.height,P=S.style,A=S.compact,R=S.title,D=S.desc,E=$4(S,Bie),W=Dt(E,!1);if(A)return re.createElement(p4,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},re.createElement(i1,Pc({},W,{width:M,height:_,title:R,desc:D}),this.renderClipPath(),f3(w,this.renderMap)));if(this.props.accessibilityLayer){var F,O;W.tabIndex=(F=this.props.tabIndex)!==null&&F!==void 0?F:0,W.role=(O=this.props.role)!==null&&O!==void 0?O:"application",W.onKeyDown=function(N){k.accessibilityManager.keyboardEvent(N)},W.onFocus=function(){k.accessibilityManager.focus()}}var $=this.parseEventsOfWrapper();return re.createElement(p4,{state:this.state,width:this.props.width,height:this.props.height,clipPathId:this.clipPathId},re.createElement("div",Pc({className:hr("recharts-wrapper",v),style:ye({position:"relative",cursor:"default",width:M,height:_},P)},$,{ref:function(C){k.container=C}}),re.createElement(i1,Pc({},W,{width:M,height:_,title:R,desc:D,style:roe}),this.renderClipPath(),f3(w,this.renderMap)),this.renderLegend(),this.renderTooltip()))}}])}(j.Component);St(x,"displayName",r),St(x,"defaultProps",ye({layout:"horizontal",stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index"},f)),St(x,"getDerivedStateFromProps",function(y,m){var g=y.dataKey,k=y.data,S=y.children,w=y.width,v=y.height,M=y.layout,_=y.stackOffset,P=y.margin,A=m.dataStartIndex,R=m.dataEndIndex;if(m.updateId===void 0){var D=F4(y);return ye(ye(ye({},D),{},{updateId:0},p(ye(ye({props:y},D),{},{updateId:0}),m)),{},{prevDataKey:g,prevData:k,prevWidth:w,prevHeight:v,prevLayout:M,prevStackOffset:_,prevMargin:P,prevChildren:S})}if(g!==m.prevDataKey||k!==m.prevData||w!==m.prevWidth||v!==m.prevHeight||M!==m.prevLayout||_!==m.prevStackOffset||!Lc(P,m.prevMargin)){var E=F4(y),W={chartX:m.chartX,chartY:m.chartY,isTooltipActive:m.isTooltipActive},F=ye(ye({},B4(m,k,M)),{},{updateId:m.updateId+1}),O=ye(ye(ye({},E),W),F);return ye(ye(ye({},O),p(ye({props:y},O),m)),{},{prevDataKey:g,prevData:k,prevWidth:w,prevHeight:v,prevLayout:M,prevStackOffset:_,prevMargin:P,prevChildren:S})}if(!n1(S,m.prevChildren)){var $,N,C,B,I=Va(S,uu),z=I&&($=(N=I.props)===null||N===void 0?void 0:N.startIndex)!==null&&$!==void 0?$:A,V=I&&(C=(B=I.props)===null||B===void 0?void 0:B.endIndex)!==null&&C!==void 0?C:R,K=z!==A||V!==R,q=!Et(k),G=q&&!K?m.updateId:m.updateId+1;return ye(ye({updateId:G},p(ye(ye({props:y},m),{},{updateId:G,dataStartIndex:z,dataEndIndex:V}),m)),{},{prevChildren:S,dataStartIndex:z,dataEndIndex:V})}return null}),St(x,"renderActiveDot",function(y,m,g){var k;return j.isValidElement(y)?k=j.cloneElement(y,m):Bt(y)?k=y(m):k=re.createElement(nm,m),re.createElement(_r,{className:"recharts-active-dot",key:g},k)});var b=j.forwardRef(function(m,g){return re.createElement(x,Pc({},m,{ref:g}))});return b.displayName=x.displayName,b},bl=K2({chartName:"LineChart",GraphicalChild:Dn,axisComponents:[{axisType:"xAxis",AxisComp:ba},{axisType:"yAxis",AxisComp:va}],formatAxisMap:B2}),foe=K2({chartName:"ScatterChart",GraphicalChild:ga,defaultTooltipEventType:"item",validateTooltipEventTypes:["item"],axisComponents:[{axisType:"xAxis",AxisComp:ba},{axisType:"yAxis",AxisComp:va},{axisType:"zAxis",AxisComp:cm}],formatAxisMap:B2}),DO=K2({chartName:"AreaChart",GraphicalChild:di,axisComponents:[{axisType:"xAxis",AxisComp:ba},{axisType:"yAxis",AxisComp:va}],formatAxisMap:B2});const hoe={keys:["R","G","B"],keyToIndex:{R:0,G:1,B:2},availableIndices:[0,1,2],indexLabels:{0:"Red",1:"Green",2:"Blue",3:"Unused"},histogramLabels:{c0:"Red",c1:"Green",c2:"Blue",c3:"Unused"},colors:{c0:"#ef4444",c1:"#22c55e",c2:"#3b82f6",c3:"#64748b"},selfAdjacentStep:1,defaultPrimaryKey:"G",defaultSecondaryKey:"B"},poe={keys:["R","G1","G2","B"],keyToIndex:{R:0,G1:1,G2:2,B:3},availableIndices:[0,1,2,3],indexLabels:{0:"Red",1:"Green 1",2:"Green 2",3:"Blue"},histogramLabels:{c0:"Red",c1:"Green 1",c2:"Green 2",c3:"Blue"},colors:{c0:"#ef4444",c1:"#22c55e",c2:"#4ade80",c3:"#3b82f6"},selfAdjacentStep:2,defaultPrimaryKey:"G1",defaultSecondaryKey:"B"},goe={keys:["B","G1","G2","R"],keyToIndex:{B:0,G1:1,G2:2,R:3},availableIndices:[0,1,2,3],indexLabels:{0:"Blue",1:"Green 1",2:"Green 2",3:"Red"},histogramLabels:{c0:"Blue",c1:"Green 1",c2:"Green 2",c3:"Red"},colors:{c0:"#3b82f6",c1:"#22c55e",c2:"#4ade80",c3:"#ef4444"},selfAdjacentStep:2,defaultPrimaryKey:"G1",defaultSecondaryKey:"R"},dm=(e,t)=>e?hoe:t?goe:poe,yo=(e,t)=>{const r=localStorage.getItem(e);return r===null?t:typeof t=="boolean"?r==="true":typeof t=="number"?Number(r):r},moe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,zIndex:o,onFocus:s,initialPosition:l,initialInternalState:u,onUpdateState:d,stackFiles:f})=>{const h=!!(n!=null&&n.isThreePlane),p=j.useMemo(()=>dm(h,i),[h,i]),[x,b]=j.useState(()=>(u==null?void 0:u.channelMode)??yo("hist_mode","All")),[y,m]=j.useState(()=>(u==null?void 0:u.minVal)??yo("hist_min",0)),[g,k]=j.useState(()=>(u==null?void 0:u.maxVal)??yo("hist_max",16383)),[S,w]=j.useState(()=>(u==null?void 0:u.binCount)??yo("hist_bins",100)),[v,M]=j.useState(()=>(u==null?void 0:u.pointToPoint)??yo("hist_ptp",!1)),[_,P]=j.useState(()=>(u==null?void 0:u.showTheo)??yo("hist_show_theo",!1)),[A,R]=j.useState(()=>(u==null?void 0:u.theoMean)??yo("hist_theo_mean","512")),[D,E]=j.useState(()=>(u==null?void 0:u.theoSigma)??yo("hist_theo_sigma","10")),[W,F]=j.useState(()=>(u==null?void 0:u.theoAmp)??yo("hist_theo_amp","1000")),[O,$]=j.useState(!1),[N,C]=j.useState(0),[B,I]=j.useState([]),[z,V]=j.useState(null),[K,q]=j.useState(l||{x:100,y:100}),[G,pe]=j.useState(!1),J=j.useRef({x:0,y:0});j.useEffect(()=>{x!=="All"&&!p.availableIndices.includes(Number(x))&&b("All")},[x,p]),j.useEffect(()=>{localStorage.setItem("hist_mode",x),localStorage.setItem("hist_min",String(y)),localStorage.setItem("hist_max",String(g)),localStorage.setItem("hist_bins",String(S)),localStorage.setItem("hist_ptp",String(v)),localStorage.setItem("hist_show_theo",String(_)),localStorage.setItem("hist_theo_mean",A),localStorage.setItem("hist_theo_sigma",D),localStorage.setItem("hist_theo_amp",W),d&&d({channelMode:x,minVal:y,maxVal:g,binCount:S,pointToPoint:v,showTheo:_,theoMean:A,theoSigma:D,theoAmp:W})},[x,y,g,S,v,_,A,D,W]),j.useEffect(()=>{if(!e||!a||!n&&(!f||f.length===0))return;if(g<=y){V("Invalid range: Max must be greater than Min");return}V(null),$(!0),C(0);const ie=new AbortController,xe=[],Ie=setTimeout(async()=>{try{let te=[];if(f&&f.length>1){const Oe=Math.min(f.length,navigator.hardwareConcurrency||4);for(let dt=0;dt<Oe;dt++){const ht=new Worker(new URL("/assets/histogramWorker-dnUrfHr1.js",import.meta.url),{type:"module"});xe.push(ht)}let Fe=0,bt=0;const Ct=[],ut=async dt=>{for(;Fe<f.length;){if(ie.signal.aborted)return;const ht=Fe++,tt=f[ht];try{const vt=await tt.arrayBuffer();await new Promise((Sr,Ft)=>{dt.onmessage=rt=>{const{success:Kt,hist:lr,error:Vt}=rt.data;Kt?(Ct.push(lr),bt++,C(bt),Sr()):(console.error(`Error processing ${tt.name}:`,Vt),Sr())},dt.onerror=rt=>{console.error("Worker Error",rt),Sr()},dt.postMessage({buffer:vt,roi:a,binCount:S,minVal:y,maxVal:g,pointToPoint:v},[vt])})}catch(vt){console.error("File Read Error",vt)}}};if(await Promise.all(xe.map(dt=>ut(dt))),xe.forEach(dt=>dt.terminate()),xe.length=0,Ct.length>0){te=Ct[0];for(let dt=1;dt<Ct.length;dt++){const ht=Ct[dt];for(let tt=0;tt<ht.length;tt++)te[tt]&&(te[tt].c0+=ht[tt].c0,te[tt].c1+=ht[tt].c1,te[tt].c2+=ht[tt].c2,te[tt].c3+=ht[tt].c3)}}}else n&&(te=ME(n.data,n.width,n.height,a.x,a.y,a.w,a.h,S,y,g,v,!!n.isThreePlane));ie.signal.aborted||I(te)}catch(te){console.error("Histogram calc error:",te),V("Error calculating histogram")}finally{ie.signal.aborted||$(!1)}},50);return()=>{clearTimeout(Ie),ie.abort(),xe.length>0&&(console.log(`Terminating ${xe.length} active histogram workers...`),xe.forEach(te=>te.terminate()))}},[e,n,a==null?void 0:a.x,a==null?void 0:a.y,a==null?void 0:a.w,a==null?void 0:a.h,S,y,g,v,f]);const Z=j.useMemo(()=>{if(!_)return B;const ie=parseFloat(A),xe=parseFloat(D),Se=parseFloat(W);return isNaN(ie)||isNaN(xe)||isNaN(Se)||xe<=0?B:B.map(Ie=>{const te=Ie.binStart,Oe=-Math.pow(te-ie,2)/(2*Math.pow(xe,2)),Fe=Se*Math.exp(Oe);return{...Ie,theory:Fe}})},[B,_,A,D,W]),ae=()=>{if(B.length===0)return;let ie=0,xe=0;if(B.forEach(Se=>{const Ie=p.availableIndices.reduce((te,Oe)=>{const Fe=Se[`c${Oe}`]||0;return Math.max(te,Fe)},0);Ie>ie&&(ie=Ie,xe=Se.binStart)}),R(xe.toFixed(2)),F(ie.toString()),parseFloat(D)===0||isNaN(parseFloat(D))){const Se=g-y;E((Se/20).toFixed(2))}},ce=(ie,xe,Se)=>{s&&s(),!(Se.closest("button")||Se.closest("input")||Se.closest("select"))&&(pe(!0),J.current={x:ie-K.x,y:xe-K.y})},ne=ie=>{ce(ie.clientX,ie.clientY,ie.target)},le=ie=>{const xe=ie.touches[0];ce(xe.clientX,xe.clientY,ie.target)};if(j.useEffect(()=>{const ie=Se=>{if(G){const Ie="touches"in Se?Se.touches[0].clientX:Se.clientX,te="touches"in Se?Se.touches[0].clientY:Se.clientY;q({x:Ie-J.current.x,y:te-J.current.y})}},xe=()=>pe(!1);return G&&(window.addEventListener("mousemove",ie),window.addEventListener("mouseup",xe),window.addEventListener("touchmove",ie,{passive:!1}),window.addEventListener("touchend",xe)),()=>{window.removeEventListener("mousemove",ie),window.removeEventListener("mouseup",xe),window.removeEventListener("touchmove",ie),window.removeEventListener("touchend",xe)}},[G]),!e)return null;const se=p.histogramLabels,he=p.colors,ue="step";return c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl resize-both overflow-hidden min-w-[500px] min-h-[400px] w-[900px] h-[650px]",style:{left:K.x,top:K.y,zIndex:o??100},onMouseDownCapture:s,children:[c.jsxs("div",{className:`flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 flex-shrink-0 bg-white dark:bg-slate-900 select-none touch-none ${G?"cursor-grabbing":"cursor-grab"}`,onMouseDown:ne,onTouchStart:le,children:[c.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 pointer-events-none flex items-center gap-2",children:["ROI Histogram",f&&f.length>1&&c.jsxs("span",{className:"text-[10px] font-normal bg-purple-100 dark:bg-purple-900/30 text-purple-700 dark:text-purple-300 px-2 py-0.5 rounded border border-purple-200 dark:border-purple-800 shadow-sm",children:["Stack Count: ",f.length]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-slate-800/50 flex flex-wrap gap-x-6 gap-y-3 items-center border-b border-gray-200 dark:border-slate-700 text-xs flex-shrink-0 relative z-10",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold uppercase tracking-tight",children:"Channel:"}),c.jsxs("select",{value:x,onChange:ie=>b(ie.target.value),className:"bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-cyan-500",children:[c.jsx("option",{value:"All",children:"All Colors"}),p.availableIndices.map(ie=>{const xe=`c${ie}`;return c.jsx("option",{value:String(ie),children:se[xe]},ie)})]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold uppercase tracking-tight",children:"Range:"}),c.jsx("input",{type:"number",value:y,onChange:ie=>m(Number(ie.target.value)),className:"w-16 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",value:g,onChange:ie=>k(Number(ie.target.value)),className:"w-16 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"})]}),c.jsxs("div",{className:"flex items-center gap-4",children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer",children:[c.jsx("input",{type:"checkbox",checked:v,onChange:ie=>M(ie.target.checked),className:"w-3.5 h-3.5 text-cyan-600 rounded border-gray-300 focus:ring-cyan-500"}),c.jsx("span",{className:"text-gray-700 dark:text-slate-300 select-none font-semibold",children:"PTP"})]}),!v&&c.jsxs("div",{className:"flex items-center gap-1.5",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"Bins:"}),c.jsx("input",{type:"number",value:S,onChange:ie=>w(Math.max(1,Number(ie.target.value))),className:"w-12 px-1.5 py-1 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-gray-900 dark:text-slate-100 text-right font-mono"})]})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700"}),c.jsxs("div",{className:`flex items-center gap-3 p-1.5 rounded-lg border transition-all ${_?"bg-amber-50/30 dark:bg-amber-900/10 border-amber-200/50 dark:border-amber-800/50":"bg-transparent border-transparent"}`,children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:_,onChange:ie=>P(ie.target.checked),className:"w-3.5 h-3.5 text-amber-500 rounded border-gray-300 focus:ring-amber-500 bg-white dark:bg-slate-700"}),c.jsx("span",{className:`font-bold uppercase tracking-tight ${_?"text-amber-600 dark:text-amber-400":"text-gray-400"}`,children:"Theoretical Bell"})]}),_&&c.jsxs("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-left-2 duration-200",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Mean()"}),c.jsx("input",{type:"text",value:A,onChange:ie=>R(ie.target.value),className:"w-14 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Sigma()"}),c.jsx("input",{type:"text",value:D,onChange:ie=>E(ie.target.value),className:"w-12 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("span",{className:"text-[8px] text-gray-400 uppercase font-bold",children:"Scale(A)"}),c.jsx("input",{type:"text",value:W,onChange:ie=>F(ie.target.value),className:"w-16 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center text-[10px] py-0.5 outline-none focus:border-amber-500"})]}),c.jsx("button",{onClick:ae,className:"mt-3 px-2 py-0.5 bg-amber-600 hover:bg-amber-500 text-white text-[9px] font-bold rounded shadow-sm active:scale-95 transition-all",title:"Set Mean and Amplitude based on current peak",children:"AUTO FIT"})]})]})]}),c.jsxs("div",{className:"flex-1 p-4 relative bg-white dark:bg-slate-900 overflow-hidden min-h-0",children:[c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 pointer-events-none select-none opacity-10 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),O&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-20 bg-white/50 dark:bg-slate-900/50 backdrop-blur-[1px]",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mb-2"}),c.jsx("span",{className:"text-sm text-cyan-600 dark:text-cyan-400 font-semibold",children:f&&f.length>1?`Stacking Histogram... ${N}/${f.length}`:"Calculating Histogram..."})]}),z?c.jsx("div",{className:"flex items-center justify-center h-full text-red-500 relative z-10",children:z}):c.jsx("div",{className:"relative z-10 w-full h-full",children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:Z,children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),c.jsx(ba,{dataKey:"binStart",type:"number",domain:[y,g],tickFormatter:ie=>Math.floor(ie).toString(),tick:{fill:"#9ca3af",fontSize:12},allowDataOverflow:!0,label:{value:"DN Value",position:"insideBottom",offset:-5,fill:"#9ca3af",fontSize:12}}),c.jsx(va,{tick:{fill:"#9ca3af",fontSize:12},label:{value:"Count",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12}}),c.jsx(Rn,{contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6"},itemStyle:{fontSize:"12px"},labelFormatter:ie=>`DN: ${Math.round(Number(ie))}`,formatter:(ie,xe)=>[Math.round(ie),xe]}),c.jsx(Qi,{wrapperStyle:{paddingTop:"10px"}}),_&&c.jsx(Dn,{type:"monotone",dataKey:"theory",name:"Ideal Bell (Gaussian)",stroke:"#f59e0b",strokeWidth:2.5,strokeDasharray:"5 5",dot:!1,isAnimationActive:!1}),p.availableIndices.map(ie=>{if(x!=="All"&&x!==String(ie))return null;const xe=`c${ie}`;return c.jsx(Dn,{type:ue,dataKey:xe,name:se[xe],stroke:he[xe],dot:!1,strokeWidth:1.5,activeDot:{r:4},isAnimationActive:!1},xe)})]})})})]})]})},Ks=({initialPosition:e={x:20,y:80},children:t,className:r="",onClose:n,zIndex:a,onFocus:i})=>{const[o,s]=j.useState(e),[l,u]=j.useState(!1),[d,f]=j.useState({x:0,y:0}),h=j.useRef(null),p=(y,m,g)=>{i&&i(),!(g.closest("button")||g.closest("input"))&&(u(!0),f({x:y-o.x,y:m-o.y}))},x=y=>{p(y.clientX,y.clientY,y.target)},b=y=>{const m=y.touches[0];p(m.clientX,m.clientY,y.target)};return j.useEffect(()=>{const y=g=>{var k,S;if(l){g.cancelable&&g.preventDefault();const w="touches"in g?g.touches[0].clientX:g.clientX,v="touches"in g?g.touches[0].clientY:g.clientY,M=w-d.x,_=v-d.y,P=window.innerWidth-(((k=h.current)==null?void 0:k.offsetWidth)||100),A=window.innerHeight-(((S=h.current)==null?void 0:S.offsetHeight)||100);s({x:Math.max(0,Math.min(M,P)),y:Math.max(0,Math.min(_,A))})}},m=()=>{u(!1)};return l&&(window.addEventListener("mousemove",y),window.addEventListener("mouseup",m),window.addEventListener("touchmove",y,{passive:!1}),window.addEventListener("touchend",m)),()=>{window.removeEventListener("mousemove",y),window.removeEventListener("mouseup",m),window.removeEventListener("touchmove",y),window.removeEventListener("touchend",m)}},[l,d]),c.jsxs("div",{ref:h,style:{left:o.x,top:o.y,zIndex:a??90},onMouseDownCapture:i,className:`fixed border-2 border-black dark:border-gray-500 bg-white dark:bg-black shadow-[8px_8px_0px_rgba(0,0,0,0.5)] dark:shadow-[8px_8px_0px_rgba(255,255,255,0.2)] transition-shadow duration-200 ${l?"cursor-grabbing shadow-[4px_4px_0px_rgba(0,0,0,0.5)]":""} ${r}`,children:[c.jsx("div",{onMouseDown:x,onTouchStart:b,className:"absolute inset-0 w-full h-8 cursor-grab active:cursor-grabbing z-0 touch-none bg-gray-200 dark:bg-gray-800 border-b-2 border-black dark:border-gray-500",title:"Drag to move"}),c.jsx("div",{className:"relative z-10 pointer-events-none",children:c.jsx("div",{className:"pointer-events-auto",children:t})})]})},xoe=({isOpen:e,onClose:t,rawImageData:r,roi:n,selectedChannel:a,channelName:i,zIndex:o,onFocus:s,initialPosition:l})=>{const u=j.useRef(null),[d,f]=j.useState(!1),[h,p]=j.useState(null),[x,b]=j.useState(null),[y,m]=j.useState(!0),[g,k]=j.useState(!0),[S,w]=j.useState("-1"),[v,M]=j.useState("8"),[_,P]=j.useState(64),[A,R]=j.useState(45),[D,E]=j.useState(60),W=j.useRef(!1),F=j.useRef({x:0,y:0});j.useEffect(()=>{!e||!r||!n||(f(!0),b(null),setTimeout(()=>{try{const C=PE(r.data,r.width,r.height,n,a,g,!!r.isThreePlane);C?p(C):b("Could not extract valid data from ROI.")}catch(C){console.error("2D FFT Error",C),b("Calculation Error: "+C.message)}finally{f(!1)}},50))},[e,r,n,a,g]),j.useEffect(()=>{if(!h||!u.current)return;const C=u.current,B=C.getContext("2d");if(!B)return;const I=C.width,z=C.height;B.clearRect(0,0,I,z),B.fillStyle="#0f172a",B.fillRect(0,0,I,z);const V=h.width,K=h.height,q=h.data,G=Math.pow(10,parseFloat(S)||-1),pe=Math.pow(10,parseFloat(v)||8);let J=G,Z=pe;y&&(J=Math.log10(Math.max(1e-10,G)),Z=Math.log10(Math.max(1e-10,pe)));const ae=Z-J||1,ce=I/2,ne=z/2+50,le=Math.min(I,z)*.4,se=.6,he=A*Math.PI/180,ue=D*Math.PI/180,ie=Math.cos(he),xe=Math.sin(he),Se=Math.cos(ue),Ie=Math.sin(ue),te=(rt,Kt,lr)=>{const Vt=rt*ie-Kt*xe,gr=rt*xe+Kt*ie,Zt=gr*Se-lr*Ie,zt=gr*Ie+lr*Se;return{x:ce+Vt*le,y:ne-Zt*le,depth:zt}},Oe=Math.max(16,_),Fe=Math.max(1,Math.floor(V/Oe)),bt=Math.max(1,Math.floor(K/Oe)),Ct=(rt,Kt)=>{let lr=q[Kt*V+rt];return y&&(lr=Math.log10(Math.max(1e-10,lr))),lr=Math.max(J,Math.min(Z,lr)),(lr-J)/ae},ut=rt=>`hsl(${(1-rt)*240}, 80%, 50%)`,dt=[];for(let rt=0;rt<K-bt;rt+=bt)for(let Kt=0;Kt<V-Fe;Kt+=Fe){const lr=Kt,Vt=rt,gr=Kt+Fe,Zt=rt,zt=Kt+Fe,rr=rt+bt,Ot=Kt,_e=rt+bt,ee=Ct(lr,Vt),ve=Ct(gr,Zt),de=Ct(zt,rr),De=Ct(Ot,_e),Ye=(ee+ve+de+De)/4,st=te(lr/(V-1)-.5,Vt/(K-1)-.5,ee*se),_t=te(gr/(V-1)-.5,Zt/(K-1)-.5,ve*se),Xe=te(zt/(V-1)-.5,rr/(K-1)-.5,de*se),Ar=te(Ot/(V-1)-.5,_e/(K-1)-.5,De*se),nr=(st.depth+_t.depth+Xe.depth+Ar.depth)/4;dt.push({pts:[{x:st.x,y:st.y},{x:_t.x,y:_t.y},{x:Xe.x,y:Xe.y},{x:Ar.x,y:Ar.y}],avgDepth:nr,avgZ:Ye})}dt.sort((rt,Kt)=>rt.avgDepth-Kt.avgDepth),B.lineWidth=.5,dt.forEach(rt=>{B.fillStyle=ut(rt.avgZ),B.beginPath(),B.moveTo(rt.pts[0].x,rt.pts[0].y),B.lineTo(rt.pts[1].x,rt.pts[1].y),B.lineTo(rt.pts[2].x,rt.pts[2].y),B.lineTo(rt.pts[3].x,rt.pts[3].y),B.closePath(),B.fill()}),B.fillStyle="#aaa",B.font="10px monospace";const ht=te(-.5,-.5,0),tt=te(.5,-.5,0),vt=te(-.5,.5,0),Sr=te(.5,.5,0);B.strokeStyle="#666",B.beginPath(),B.moveTo(ht.x,ht.y),B.lineTo(tt.x,tt.y),B.lineTo(Sr.x,Sr.y),B.lineTo(vt.x,vt.y),B.closePath(),B.stroke(),B.fillText("0",ht.x-10,ht.y+10),B.fillText("Fx",tt.x+5,tt.y),B.fillText("Fy",vt.x-15,vt.y);const Ft=te(-.5,-.5,se);B.strokeStyle="#fff",B.beginPath(),B.moveTo(ht.x,ht.y),B.lineTo(Ft.x,Ft.y),B.stroke(),B.fillText(`10^${v}`,Ft.x-25,Ft.y),B.fillText(`10^${S}`,ht.x-25,ht.y)},[h,y,A,D,S,v,_]);const O=C=>{W.current=!0,F.current={x:C.clientX,y:C.clientY}},$=C=>{if(!W.current)return;const B=C.clientX-F.current.x,I=C.clientY-F.current.y;R(z=>z-B*.5),E(z=>Math.max(0,Math.min(90,z+I*.5))),F.current={x:C.clientX,y:C.clientY}},N=()=>{W.current=!1};return e?c.jsxs(Ks,{initialPosition:l||{x:100,y:100},onClose:t,zIndex:o,onFocus:s,className:"w-[700px] h-[600px] bg-slate-900 border border-slate-700 flex flex-col overflow-hidden shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b border-slate-700 bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-slate-200 flex items-center gap-2",children:["2D FFT Power Spectrum - ",i,h&&c.jsxs("span",{className:"text-[10px] font-normal text-slate-400 bg-slate-700 px-2 py-0.5 rounded",children:[h.width,"x",h.height," (Chirp-Z)"]})]}),c.jsx("div",{className:"flex items-center gap-2",children:c.jsx("button",{onClick:t,className:"text-slate-400 hover:text-red-400 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})})]}),c.jsxs("div",{className:"p-3 bg-slate-800/80 flex flex-wrap gap-4 text-xs items-center border-b border-slate-700",children:[c.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 px-2 py-1 rounded border border-slate-600",children:[c.jsx("span",{className:"text-slate-400 font-bold",children:"Range (10^x):"}),c.jsx("input",{type:"number",value:S,onChange:C=>w(C.target.value),className:"w-10 bg-transparent text-slate-200 text-center border-b border-slate-600 focus:border-cyan-500 outline-none"}),c.jsx("span",{className:"text-slate-500",children:"to"}),c.jsx("input",{type:"number",value:v,onChange:C=>M(C.target.value),className:"w-10 bg-transparent text-slate-200 text-center border-b border-slate-600 focus:border-cyan-500 outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-2 bg-slate-900 px-2 py-1 rounded border border-slate-600",children:[c.jsx("span",{className:"text-slate-400 font-bold",children:"Density:"}),c.jsx("input",{type:"range",min:"16",max:"128",step:"16",value:_,onChange:C=>P(Number(C.target.value)),className:"w-20 h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),c.jsx("span",{className:"text-slate-300 w-6 text-right",children:_})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none text-slate-300 hover:text-white",children:[c.jsx("input",{type:"checkbox",checked:y,onChange:C=>m(C.target.checked),className:"rounded bg-slate-700 border-slate-600 accent-cyan-500"}),"Log Z"]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none text-slate-300 hover:text-white",children:[c.jsx("input",{type:"checkbox",checked:g,onChange:C=>k(C.target.checked),className:"rounded bg-slate-700 border-slate-600 accent-fuchsia-500"}),"Hanning"]})]}),c.jsxs("div",{className:"flex-1 relative bg-slate-900 cursor-move",children:[d&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80 z-20 backdrop-blur-sm",children:c.jsxs("div",{className:"flex flex-col items-center gap-2",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin"}),c.jsx("span",{className:"text-cyan-400 font-bold animate-pulse text-sm",children:"Computing full-size 2D FFT..."})]})}),x&&c.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-slate-900/80 z-20 text-red-400 p-4 text-center",children:x}),c.jsx("canvas",{ref:u,width:700,height:500,className:"w-full h-full block",onMouseDown:O,onMouseMove:$,onMouseUp:N,onMouseLeave:N}),c.jsx("div",{className:"absolute bottom-2 right-2 text-[9px] text-slate-600 pointer-events-none",children:"Drag to Rotate"})]})]}):null},yoe=.5,Cb=1e-10,U4=(e,t)=>{const r=e.length-1;if(r<0)return Cb;const n=t/yoe*r,a=Math.round(n),i=e[Math.min(Math.max(0,a),r)]||0;return Math.max(i,Cb)},boe=(e,t)=>{if(t<=0)return[1];const r=new Array(e);let n=0;for(let a=0;a<e;a++){const i=a-(e-1)/2,o=Math.exp(-(i*i)/(2*t*t));r[a]=o,n+=o}for(let a=0;a<e;a++)r[a]/=n;return r},voe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,onUpdateROI:o,zIndex:s,onFocus:l,initialPosition:u,initialInternalState:d,onUpdateState:f,stackFiles:h})=>{const[p,x]=j.useState((d==null?void 0:d.selectedChannel)??0),[b,y]=j.useState(()=>(d==null?void 0:d.yMinExp)||localStorage.getItem("fft_y_min")||"1.73"),[m,g]=j.useState(()=>(d==null?void 0:d.yMaxExp)||localStorage.getItem("fft_y_max")||"8.00"),[k,S]=j.useState((d==null?void 0:d.useHanning)??!0),[w,v]=j.useState((d==null?void 0:d.doAverage)??!0),[M,_]=j.useState((d==null?void 0:d.welchSegments)??1),[P,A]=j.useState((d==null?void 0:d.showH)??!0),[R,D]=j.useState((d==null?void 0:d.showV)??!0),[E,W]=j.useState((d==null?void 0:d.interlaceRows)??!1),[F,O]=j.useState((d==null?void 0:d.rowGroup)??0),[$,N]=j.useState((d==null?void 0:d.interlaceCols)??!1),[C,B]=j.useState((d==null?void 0:d.colGroup)??0),[I,z]=j.useState(()=>(d==null?void 0:d.theoSigma)||localStorage.getItem("fft_theo_sigma")||"0.00"),[V,K]=j.useState(()=>(d==null?void 0:d.theoKernelSize)||localStorage.getItem("fft_theo_ksize")||"3"),[q,G]=j.useState(()=>(d==null?void 0:d.theoNoiseStd)||localStorage.getItem("fft_theo_noise")||"7.5"),[pe,J]=j.useState(()=>(d==null?void 0:d.theoScale)||localStorage.getItem("fft_theo_scale")||"1.0"),[Z,ae]=j.useState((d==null?void 0:d.intStart)||"0"),[ce,ne]=j.useState((d==null?void 0:d.intEnd)||"0.5"),[le,se]=j.useState(!1),[he,ue]=j.useState([]),[ie,xe]=j.useState(!1),[Se,Ie]=j.useState(0),[te,Oe]=j.useState(null),[Fe,bt]=j.useState(!1),[Ct,ut]=j.useState(!1),[dt,ht]=j.useState(null),[tt,vt]=j.useState(!1),[Sr,Ft]=j.useState(null),[rt,Kt]=j.useState(u||{x:50,y:50}),[lr,Vt]=j.useState(!1),[gr,Zt]=j.useState(null),[zt,rr]=j.useState({}),Ot=j.useRef({x:0,y:0}),_e=!!(n!=null&&n.isThreePlane),ee=j.useMemo(()=>dm(_e,i),[_e,i]),ve=ee.availableIndices,de=ee.colors,De=ee.indexLabels;j.useEffect(()=>{p!==-1&&!ve.includes(p)&&x(ve[0])},[p,ve]),j.useEffect(()=>{localStorage.setItem("fft_y_min",b),localStorage.setItem("fft_y_max",m),localStorage.setItem("fft_theo_sigma",I),localStorage.setItem("fft_theo_ksize",V),localStorage.setItem("fft_theo_noise",q),localStorage.setItem("fft_theo_scale",pe)},[b,m,I,V,q,pe]),j.useEffect(()=>{if(!e||!n||!a)return;xe(!0),Oe(null),Ie(0);const we=setTimeout(async()=>{try{const Je=p===-1?ve:[p],Qe=h&&h.length>1?h:[null],Qt=Qe.length,Ht={};let it={h:0,v:0};for(let It=0;It<Qt;It++){Ie(It+1);let Tt;if(Qe[It]){const Ae=await Qe[It].arrayBuffer();Tt=await Ds(Ae)}else Tt=n;for(const Ae of Je){const Yt=_E(Tt.data,Tt.width,Tt.height,a,Ae,!1,k,{rows:E,rowGroup:F,cols:$,colGroup:C},w,M,!!Tt.isThreePlane);Yt&&(Ht[Ae]||(Ht[Ae]={h:new Array(Yt.avgHoriz.length).fill(0),v:new Array(Yt.avgVert.length).fill(0)}),Yt.avgHoriz.forEach((L,ke)=>Ht[Ae].h[ke]+=L/Qt),Yt.avgVert.forEach((L,ke)=>Ht[Ae].v[ke]+=L/Qt),it=Yt.sampleCount)}}if(Object.keys(Ht).length===0)throw new Error("ROI too small or no data found.");const cr=1024,pr=[];for(let It=0;It<cr;It++){const Tt=It/(cr-1)*.5,Ae={freq:parseFloat(Tt.toFixed(6))};for(const Yt of Je)Ht[Yt]&&(Ae[`c${Yt}_h`]=U4(Ht[Yt].h,Tt),Ae[`c${Yt}_v`]=U4(Ht[Yt].v,Tt));pr.push(Ae)}Zt(it),ue(pr)}catch(Je){console.error("FFT Loop Failed:",Je),Oe(Je.message||"Unknown error during FFT processing")}finally{xe(!1)}},100);return()=>clearTimeout(we)},[e,n,a==null?void 0:a.x,a==null?void 0:a.y,a==null?void 0:a.w,a==null?void 0:a.h,p,k,w,M,E,F,$,C,h,ve]);const Ye=()=>{const we=parseFloat(Z),Je=parseFloat(ce);if(isNaN(we)||isNaN(Je))return;const Qe={},Qt=p===-1?ve:[p],Ht=he.filter(it=>it.freq>=we&&it.freq<=Je);if(Ht.length===0){rr({});return}Qt.forEach(it=>{let cr=0,pr=0;Ht.forEach(It=>{const Tt=It[`c${it}_h`],Ae=It[`c${it}_v`];typeof Tt=="number"&&(cr+=Tt),typeof Ae=="number"&&(pr+=Ae)}),Qe[it]={h:cr/Ht.length,v:pr/Ht.length,count:Ht.length}}),rr(Qe)},st=j.useMemo(()=>{const we=parseFloat(I),Je=parseInt(V),Qe=parseFloat(q),Qt=parseFloat(pe);if(isNaN(we)||isNaN(Je)||isNaN(Qe)||isNaN(Qt)||he.length===0)return he;const Ht=boe(Je,we),it=Ht.reduce((It,Tt)=>It+Tt*Tt,0),cr=(Je-1)/2,pr=Qe*Qe*Qt;return he.map(It=>{const Tt=It.freq,Ae=2*Math.PI*Tt;let Yt=0,L=0;for(let Pe=0;Pe<Je;Pe++){const jt=Pe-cr,Be=Ht[Pe],nt=-Ae*jt;Yt+=Be*Math.cos(nt),L+=Be*Math.sin(nt)}const ke=Yt*Yt+L*L;return{...It,theory:Math.max(Cb,pr*it*ke)}})},[he,I,V,q,pe]),_t=we=>{we&&we.activeLabel!==void 0&&(vt(!0),Ft(Number(we.activeLabel)),ht(null))},Xe=we=>{if(tt&&Sr!==null&&we&&we.activeLabel!==void 0){const Je=Number(we.activeLabel);ht([Math.min(Sr,Je),Math.max(Sr,Je)])}},Ar=()=>vt(!1),nr=(we,Je,Qe)=>{l&&l(),!(Qe.closest("button")||Qe.closest("input"))&&(Vt(!0),Ot.current={x:we-rt.x,y:Je-rt.y})},Gt=we=>{nr(we.clientX,we.clientY,we.target)},mt=we=>{const Je=we.touches[0];nr(Je.clientX,Je.clientY,we.target)};j.useEffect(()=>{const we=Qe=>{if(lr){const Qt="touches"in Qe?Qe.touches[0].clientX:Qe.clientX,Ht="touches"in Qe?Qe.touches[0].clientY:Qe.clientY;Kt({x:Qt-Ot.current.x,y:Ht-Ot.current.y})}},Je=()=>Vt(!1);return lr&&(window.addEventListener("mousemove",we),window.addEventListener("mouseup",Je),window.addEventListener("touchmove",we,{passive:!1}),window.addEventListener("touchend",Je)),()=>{window.removeEventListener("mousemove",we),window.removeEventListener("mouseup",Je),window.removeEventListener("touchmove",we),window.removeEventListener("touchend",Je)}},[lr]);const Jt=j.useMemo(()=>{if(!dt||he.length===0)return null;const[we,Je]=dt,Qe=he.filter(it=>it.freq>=we&&it.freq<=Je);if(Qe.length===0)return null;const Qt=p===-1?ve:[p],Ht={};return Qt.forEach(it=>{["h","v"].forEach(cr=>{const pr=`c${it}_${cr}`;let It=0,Tt=0;for(const Ae of Qe){const Yt=Ae[pr];typeof Yt=="number"&&(It+=Yt,Tt++)}Tt>0&&(Ht[`${pr}_sigma`]=Math.sqrt(It/Tt))})}),{count:Qe.length,stats:Ht}},[dt,he,p,ve]),Pr=()=>{if(he.length===0)return;let we=1/0,Je=-1/0;if(he.forEach(cr=>{cr.freq<.01||cr.freq>.49||Object.keys(cr).forEach(pr=>{if(pr==="freq"||pr==="theory")return;const It=cr[pr];typeof It=="number"&&It>0&&(It<we&&(we=It),It>Je&&(Je=It))})}),we===1/0)return;const Qe=Math.log10(we),Qt=Math.log10(Je),Ht=Qt-Qe,it=(Ht===0?1:Ht)*.1;y((Qe-it).toFixed(2)),g((Qt+it).toFixed(2))},Zr=(we,Je)=>{a&&o&&o({...a,x:a.x+we,y:a.y+Je})},jr=(we,Je)=>{a&&o&&o({...a,w:Math.max(2,a.w+we),h:Math.max(2,a.h+Je)})};return e?c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl overflow-hidden resize-both min-w-[750px] min-h-[500px]",style:{left:rt.x,top:rt.y,width:"1000px",height:"850px",zIndex:s??100},onMouseDownCapture:l,children:[c.jsxs("div",{className:`flex justify-between items-center p-3 border-b border-gray-200 dark:border-slate-700 flex-shrink-0 bg-gray-50 dark:bg-slate-800 z-50 relative select-none touch-none ${lr?"cursor-grabbing":"cursor-grab"}`,onMouseDown:Gt,onTouchStart:mt,children:[c.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2 pointer-events-none",children:["Power Spectrum Analysis",c.jsx("span",{className:"text-[10px] font-normal bg-white dark:bg-slate-700 px-2 py-1 rounded text-gray-500 border border-gray-200 dark:border-slate-600 shadow-sm",children:h&&h.length>1?`Stack Avg (${h.length} frames)`:"Single Mode"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"flex flex-col bg-gray-50 dark:bg-slate-900/80 border-b border-gray-200 dark:border-slate-800 flex-shrink-0 z-40 relative px-4 py-3 gap-3 overflow-x-auto",children:[c.jsxs("div",{className:"flex items-center gap-6",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase tracking-widest",children:"Channel"}),c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 rounded-lg p-0.5 border border-gray-200 dark:border-slate-700 shadow-inner",children:[c.jsx("button",{onClick:()=>x(-1),className:`px-3 py-1 rounded text-[10px] font-bold transition-all ${p===-1?"bg-slate-700 text-white shadow-md":"text-gray-500 dark:text-slate-500 hover:bg-white dark:hover:bg-slate-700"}`,children:"All"}),ve.map(we=>c.jsx("button",{onClick:()=>x(we),className:`px-3 py-1 rounded text-[10px] font-bold transition-all ${p===we?"bg-cyan-600 text-white shadow-md":"text-gray-500 dark:text-slate-500 hover:bg-white dark:hover:bg-slate-700"}`,children:De[we]},we))]})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700 mx-2"}),c.jsxs("button",{onClick:()=>se(!0),className:"flex items-center gap-1.5 px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-[10px] font-bold rounded-lg shadow-lg shadow-indigo-500/30 transition-all active:scale-95 group border border-indigo-400/30",children:[c.jsx("svg",{className:"w-3.5 h-3.5 group-hover:animate-pulse",fill:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"2D Diagonal"]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700 mx-2"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-400 uppercase tracking-widest",children:"Model"}),c.jsx("div",{className:"flex gap-2",children:[{label:"KSize",val:V,set:K,w:"w-10"},{label:"Sigma",val:I,set:z,w:"w-12"},{label:"Noise()",val:q,set:G,w:"w-12"},{label:"Scale",val:pe,set:J,w:"w-12"}].map(we=>c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[8px] text-gray-400 dark:text-slate-500 uppercase font-bold mb-0.5",children:we.label}),c.jsx("input",{type:"text",value:we.val,onChange:Je=>we.set(Je.target.value),className:`${we.w} text-[11px] bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-1.5 py-0.5 text-center text-gray-900 dark:text-slate-100 outline-none focus:border-indigo-500 shadow-sm`})]},we.label))})]})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-wrap",children:[c.jsxs("div",{className:"flex items-center gap-3 mr-2",children:[c.jsx("span",{className:"text-[10px] font-bold text-fuchsia-600 dark:text-fuchsia-500 uppercase tracking-widest",children:"Welch"}),c.jsx("input",{type:"range",min:"1",max:"16",step:"1",value:M,onChange:we=>_(parseInt(we.target.value)),className:"w-24 h-1.5 bg-gray-300 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-fuchsia-500"}),c.jsx("span",{className:"text-[10px] font-mono text-fuchsia-600 dark:text-fuchsia-400 w-4 font-bold",children:M})]}),c.jsx("div",{className:"h-6 w-px bg-gray-200 dark:bg-slate-700"}),c.jsxs("div",{className:"flex flex-col gap-1 px-2",children:[c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-[10px] text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-slate-200 select-none",children:[c.jsx("input",{type:"checkbox",checked:E,onChange:we=>W(we.target.checked),className:"w-3 h-3 rounded text-cyan-600 border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-800"})," Row Int."]}),c.jsxs("label",{className:"flex items-center gap-1.5 cursor-pointer text-[10px] text-gray-500 dark:text-slate-400 hover:text-gray-900 dark:hover:text-slate-200 select-none",children:[c.jsx("input",{type:"checkbox",checked:$,onChange:we=>N(we.target.checked),className:"w-3 h-3 rounded text-cyan-600 border-gray-300 dark:border-slate-700 bg-white dark:bg-slate-800"})," Col Int."]})]}),c.jsxs("div",{className:"flex flex-col gap-1.5 bg-gray-100 dark:bg-slate-800/60 p-1.5 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("div",{className:`w-3.5 h-3.5 rounded-md border flex items-center justify-center transition-colors ${k?"bg-fuchsia-600 border-fuchsia-600":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-600"}`,children:k&&c.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:4,children:c.jsx("path",{d:"M5 13l4 4L19 7"})})}),c.jsx("input",{type:"checkbox",checked:k,onChange:we=>S(we.target.checked),className:"hidden"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-700 dark:text-slate-300",children:"Hanning"})]}),c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[c.jsx("div",{className:`w-3.5 h-3.5 rounded-md border flex items-center justify-center transition-colors ${w?"bg-cyan-600 border-cyan-600":"bg-white dark:bg-slate-900 border-gray-300 dark:border-slate-600"}`,children:w&&c.jsx("svg",{className:"w-2.5 h-2.5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:4,children:c.jsx("path",{d:"M5 13l4 4L19 7"})})}),c.jsx("input",{type:"checkbox",checked:w,onChange:we=>v(we.target.checked),className:"hidden"}),c.jsx("span",{className:"text-[10px] font-bold text-gray-700 dark:text-slate-300",children:"Average"})]})]}),c.jsxs("div",{className:"flex gap-2 bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("button",{onClick:()=>A(!P),className:`px-2.5 py-1 rounded-md border text-[11px] font-bold transition-all flex items-center gap-1.5 ${P?"bg-cyan-900/40 text-cyan-400 border-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.3)]":"bg-white dark:bg-slate-900 text-gray-400 border-gray-300 dark:border-slate-700"}`,children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${P?"bg-cyan-400":"bg-gray-400"}`})," H"]}),c.jsxs("button",{onClick:()=>D(!R),className:`px-2.5 py-1 rounded-md border text-[11px] font-bold transition-all flex items-center gap-1.5 ${R?"bg-cyan-900/40 text-cyan-400 border-cyan-500 shadow-[0_0_8px_rgba(6,182,212,0.3)]":"bg-white dark:bg-slate-900 text-gray-400 border-gray-300 dark:border-slate-700"}`,children:[c.jsx("div",{className:`w-2 h-2 rounded-full ${P?"bg-cyan-400":"bg-gray-400"}`})," V"]})]}),c.jsxs("div",{className:"ml-auto flex gap-2",children:[c.jsx("button",{onClick:()=>ut(!Ct),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${Ct?"bg-emerald-600 text-white border-emerald-600 shadow-md":"bg-white dark:bg-slate-900 text-emerald-600 dark:text-emerald-400 border-emerald-200 dark:border-emerald-800 hover:bg-emerald-50"}`,children:""}),c.jsx("button",{onClick:()=>bt(!Fe),className:`px-3 py-1.5 rounded-lg text-[10px] font-bold transition-all border ${Fe?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-white dark:bg-slate-900 text-indigo-600 dark:text-indigo-400 border-indigo-200 dark:border-indigo-800 hover:bg-indigo-50"}`,children:"ROI"})]})]}),c.jsxs("div",{className:"flex items-center gap-4 justify-end border-t border-gray-200 dark:border-slate-800/50 pt-2.5",children:[c.jsx("button",{onClick:Pr,className:"px-4 py-1 text-[10px] font-bold bg-cyan-600/10 text-cyan-600 dark:text-cyan-400 hover:bg-cyan-600/20 rounded-md border border-cyan-500/30 transition-all uppercase tracking-widest shadow-sm",children:"Auto"}),c.jsxs("div",{className:"flex items-center gap-2 text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:["Y-AXIS (LOG)",c.jsxs("div",{className:"flex items-center bg-white dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded-md overflow-hidden shadow-sm",children:[c.jsx("input",{type:"text",value:b,onChange:we=>y(we.target.value),className:"w-14 px-2 py-1 bg-transparent text-center outline-none text-gray-900 dark:text-slate-100 border-r border-gray-200 dark:border-slate-700"}),c.jsx("span",{className:"px-2 text-gray-400",children:"to"}),c.jsx("input",{type:"text",value:m,onChange:we=>g(we.target.value),className:"w-14 px-2 py-1 bg-transparent text-center outline-none text-gray-900 dark:text-slate-100"})]})]})]})]}),c.jsxs("div",{className:"flex-1 p-4 overflow-hidden flex flex-col gap-2 relative bg-gray-50/30 dark:bg-slate-900/30",children:[c.jsx("div",{className:"absolute inset-0 flex items-center justify-center pointer-events-none z-[50] select-none opacity-10",children:c.jsx("svg",{viewBox:"0 0 500 100",className:"w-3/4 h-auto drop-shadow-lg",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"24",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),ie&&c.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center z-[55] bg-white/90 dark:bg-slate-900/90 backdrop-blur-[2px]",children:[c.jsx("div",{className:"w-10 h-10 border-4 border-cyan-500 border-t-transparent rounded-full animate-spin mb-4"}),c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:"Computing FFT Stack..."}),h&&h.length>1&&c.jsxs("span",{className:"text-xs text-gray-500 mt-2 font-mono",children:["Processing frame ",Se," / ",h.length]})]}),te?c.jsx("div",{className:"flex items-center justify-center h-full text-red-500 font-semibold",children:te}):c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-950 border border-gray-200 dark:border-slate-800 rounded-xl p-2 flex flex-col relative z-20 shadow-xl overflow-hidden",children:[c.jsx("div",{className:"flex-1 relative z-10",onMouseDown:_t,onMouseMove:Xe,onMouseUp:Ar,style:{cursor:tt?"col-resize":"crosshair"},children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:st,margin:{top:10,right:10,bottom:20,left:0},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.08}),c.jsx(ba,{dataKey:"freq",type:"number",domain:[0,.5],tickCount:6,tick:{fill:"#6b7280",fontSize:10},label:{value:"Frequency (cy/px)",position:"insideBottom",offset:-10,fill:"#6b7280",fontSize:11}}),c.jsx(va,{scale:"log",domain:[Math.pow(10,parseFloat(b)),Math.pow(10,parseFloat(m))],allowDataOverflow:!0,tick:{fill:"#6b7280",fontSize:10},tickFormatter:we=>Number(we).toExponential(0),width:45}),c.jsx(Rn,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.95)",border:"1px solid #334155",color:"#f3f4f6",fontSize:"11px",borderRadius:"8px"},formatter:we=>[Number(we).toExponential(3),""],labelFormatter:we=>`Freq: ${Number(we).toFixed(4)}`}),c.jsx(Qi,{wrapperStyle:{fontSize:"10px"}}),c.jsx(Dn,{type:"monotone",dataKey:"theory",name:"Theory Model",stroke:"#6366f1",strokeWidth:2,dot:!1,isAnimationActive:!1}),ve.flatMap(we=>{if(p!==-1&&p!==we)return[];const Je=`c${we}_h`,Qe=`c${we}_v`,Qt=de[`c${we}`],Ht=[];return P&&Ht.push(c.jsx(Dn,{type:"linear",dataKey:Je,name:`${De[we]} (H)`,stroke:Qt,strokeWidth:1,dot:!1,isAnimationActive:!1},`${we}_h`)),R&&Ht.push(c.jsx(Dn,{type:"linear",dataKey:Qe,name:`${De[we]} (V)`,stroke:Qt,strokeWidth:1,strokeDasharray:"3 3",dot:!1,isAnimationActive:!1},`${we}_v`)),Ht}),dt&&c.jsx(n0,{x1:dt[0],x2:dt[1],fill:"#8884d8",fillOpacity:.15})]})})}),Jt&&dt&&c.jsxs("div",{className:"absolute bottom-12 left-12 bg-slate-900/90 backdrop-blur-md p-3 rounded-lg border border-indigo-500/50 shadow-2xl z-30 text-[10px] font-mono text-slate-100",children:[c.jsxs("div",{className:"text-indigo-400 font-bold mb-1 border-b border-indigo-500/30 pb-1",children:["Range: ",dt[0].toFixed(3),"-",dt[1].toFixed(3)]}),Object.entries(Jt.stats).map(([we,Je])=>c.jsxs("div",{className:"flex justify-between gap-4",children:[c.jsxs("span",{className:"text-slate-400",children:[we,":"]}),c.jsx("span",{className:"font-bold text-cyan-400",children:Je.toFixed(5)})]},we))]})]})]}),Ct&&c.jsxs("div",{className:"absolute top-48 right-8 z-[55] w-72 bg-white dark:bg-slate-900 rounded-xl shadow-2xl border border-gray-200 dark:border-slate-700 p-4 animate-in slide-in-from-top-2",children:[c.jsx("h4",{className:"text-[10px] uppercase font-bold text-emerald-600 dark:text-emerald-400 mb-2 border-b border-gray-100 dark:border-slate-800 pb-1",children:"Range Averaging"}),c.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[c.jsx("input",{type:"number",step:"0.01",value:Z,onChange:we=>ae(we.target.value),className:"w-16 px-1 py-0.5 text-xs border rounded bg-transparent dark:border-slate-600 dark:text-white"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",step:"0.01",value:ce,onChange:we=>ne(we.target.value),className:"w-16 px-1 py-0.5 text-xs border rounded bg-transparent dark:border-slate-600 dark:text-white"}),c.jsx("button",{onClick:Ye,className:"flex-1 bg-emerald-600 text-white text-[10px] font-bold py-1 rounded",children:"Avg"})]}),c.jsx("div",{className:"flex flex-col gap-2 max-h-48 overflow-y-auto",children:ve.map(we=>{const Je=zt[we];if(!Je)return null;const Qe=de[`c${we}`];return c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-2 rounded text-[10px] border border-gray-100 dark:border-slate-800",children:[c.jsxs("div",{className:"flex items-center gap-2 font-bold mb-1",style:{color:Qe},children:[De[we]," ",c.jsxs("span",{className:"text-gray-400 font-normal",children:["(",Je.count," pts)"]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-x-2 text-gray-700 dark:text-slate-300 font-mono",children:[c.jsxs("div",{children:["H: ",Je.h.toExponential(3)]}),c.jsxs("div",{children:["V: ",Je.v.toExponential(3)]})]})]},we)})})]}),Fe&&c.jsx("div",{className:"absolute top-48 right-8 z-[55] w-56 bg-white dark:bg-slate-900 rounded-xl shadow-2xl border border-gray-200 dark:border-slate-700 p-4 animate-in slide-in-from-top-2",children:c.jsxs("div",{className:"flex flex-col gap-3",children:[c.jsxs("div",{children:[c.jsx("h4",{className:"text-[9px] uppercase font-bold text-gray-400 mb-1",children:"Move"}),c.jsxs("div",{className:"grid grid-cols-3 gap-1",children:[c.jsx("div",{}),c.jsx("button",{onClick:()=>Zr(0,-1),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Zr(-1,0),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Zr(1,0),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{}),c.jsx("button",{onClick:()=>Zr(0,1),className:"p-1.5 bg-gray-100 dark:bg-slate-800 rounded",children:""}),c.jsx("div",{})]})]}),c.jsxs("div",{children:[c.jsx("h4",{className:"text-[9px] uppercase font-bold text-gray-400 mb-1",children:"Size"}),c.jsxs("div",{className:"grid grid-cols-2 gap-1",children:[c.jsx("button",{onClick:()=>jr(2,0),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"W+"}),c.jsx("button",{onClick:()=>jr(-2,0),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"W-"}),c.jsx("button",{onClick:()=>jr(0,2),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"H+"}),c.jsx("button",{onClick:()=>jr(0,-2),className:"p-1 bg-gray-100 dark:bg-slate-800 rounded",children:"H-"})]})]})]})}),c.jsx(xoe,{isOpen:le,onClose:()=>se(!1),rawImageData:n,roi:a,selectedChannel:p===-1?ve[0]:p,channelName:p===-1?`${De[ve[0]]} (Default)`:De[p],zIndex:s?s+2:102,onFocus:l})]}):null},woe=({isOpen:e,onClose:t,onMinimize:r,rawImageData:n,roi:a,isBGGR:i,zIndex:o,onFocus:s,initialPosition:l,initialInternalState:u,onUpdateState:d})=>{const f=!!(n!=null&&n.isThreePlane),h=j.useMemo(()=>dm(f,i),[f,i]),p=h.keys,x=h.keyToIndex,[b,y]=j.useState((u==null?void 0:u.selectedChannelKey)||h.defaultPrimaryKey),[m,g]=j.useState((u==null?void 0:u.blackLevel)??0),[k,S]=j.useState((u==null?void 0:u.whiteLevel)??16383),[w,v]=j.useState(null),[M,_]=j.useState(!1),[P,A]=j.useState(null),[R,D]=j.useState(l||{x:150,y:150}),[E,W]=j.useState(!1),F=j.useRef({x:0,y:0});j.useEffect(()=>{d&&d({selectedChannelKey:b,blackLevel:m,whiteLevel:k})},[b,m,k]),j.useEffect(()=>{p.includes(b)||y(h.defaultPrimaryKey)},[p,b,h]),j.useEffect(()=>{if(e&&n&&!u){const B=n.blackLevels?Math.floor(n.blackLevels[1]):0;g(B),S(n.whiteLevel||16383),v(null)}},[e,n]);const O=()=>{if(!n||!a)return;A(null),_(!0);const B=x[b];if(B===void 0){A("Invalid channel selection."),_(!1);return}setTimeout(()=>{try{const I=NE(n.data,n.width,n.height,a,B,m,k,!!n.isThreePlane);I?v(I):(A("No data found in selection with current filters."),v(null))}catch(I){console.error("Analysis failed:",I),A(I.message||"Analysis error")}finally{_(!1)}},50)},$=(B,I,z)=>{s&&s(),!(z.closest("button")||z.closest("input")||z.closest("select"))&&(W(!0),F.current={x:B-R.x,y:I-R.y})},N=B=>{$(B.clientX,B.clientY,B.target)},C=B=>{const I=B.touches[0];$(I.clientX,I.clientY,B.target)};return j.useEffect(()=>{const B=z=>{if(E){const V="touches"in z?z.touches[0].clientX:z.clientX,K="touches"in z?z.touches[0].clientY:z.clientY;D({x:V-F.current.x,y:K-F.current.y})}},I=()=>W(!1);return E&&(window.addEventListener("mousemove",B),window.addEventListener("mouseup",I),window.addEventListener("touchmove",B,{passive:!1}),window.addEventListener("touchend",I)),()=>{window.removeEventListener("mousemove",B),window.removeEventListener("mouseup",I),window.removeEventListener("touchmove",B),window.removeEventListener("touchend",I)}},[E]),e?c.jsxs("div",{className:"fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl rounded-xl resize-both overflow-hidden min-w-[500px] min-h-[400px] w-[900px] h-[700px]",style:{left:R.x,top:R.y,zIndex:o??100},onMouseDownCapture:s,children:[c.jsxs("div",{className:`flex justify-between items-center p-4 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 select-none touch-none ${E?"cursor-grabbing":"cursor-grab"}`,onMouseDown:N,onTouchStart:C,children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2 pointer-events-none",children:"Quantization Step Analysis"}),c.jsxs("div",{className:"flex items-center gap-1",children:[r&&c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-slate-800 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 p-2",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-slate-800/50 border-b border-gray-200 dark:border-slate-700 flex flex-wrap gap-4 items-end flex-shrink-0",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Channel"}),c.jsx("select",{value:b,onChange:B=>y(B.target.value),className:"bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded px-3 py-1.5 text-sm text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-cyan-500 min-w-[80px]",children:p.map(B=>c.jsx("option",{value:B,children:B},B))})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Black Level"}),c.jsx("input",{type:"number",value:m,onChange:B=>g(Number(B.target.value)),className:"w-24 px-3 py-1.5 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-sm text-gray-900 dark:text-slate-100"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"White Level"}),c.jsx("input",{type:"number",value:k,onChange:B=>S(Number(B.target.value)),className:"w-24 px-3 py-1.5 bg-white dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded outline-none text-sm text-gray-900 dark:text-slate-100"})]}),c.jsx("button",{onClick:O,disabled:M,className:"mb-0.5 px-5 py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded shadow-sm hover:shadow transition-colors disabled:opacity-50 text-sm",children:M?"Analyzing...":"Run Analysis"})]}),c.jsxs("div",{className:"flex-1 overflow-y-auto p-4 flex flex-col gap-4 bg-white dark:bg-slate-900 min-h-0",children:[P&&c.jsx("div",{className:"p-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300 rounded text-sm text-center flex-shrink-0",children:P}),!w&&!M&&!P&&c.jsx("div",{className:"flex-1 flex flex-col items-center justify-center text-gray-400 dark:text-slate-500 h-full",children:c.jsx("p",{children:"Configure parameters and click Run Analysis"})}),w&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 flex-shrink-0",children:[c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700 text-center",children:[c.jsx("div",{className:"text-xs text-gray-500 dark:text-slate-400 uppercase mb-1",children:"Unique Codes"}),c.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:w.uniqueCount})]}),c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700 text-center",children:[c.jsx("div",{className:"text-xs text-gray-500 dark:text-slate-400 uppercase mb-1",children:"Total Diffs"}),c.jsx("div",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:w.diffCount})]})]}),c.jsxs("div",{className:"bg-white dark:bg-slate-800/50 rounded-xl border border-gray-200 dark:border-slate-700 overflow-hidden flex-shrink-0",children:[c.jsx("div",{className:"px-4 py-2 bg-gray-50 dark:bg-slate-800 border-b border-gray-200 dark:border-slate-700 text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Step Distribution"}),c.jsx("div",{className:"p-4 flex flex-wrap gap-x-8 gap-y-2 text-sm font-mono max-h-32 overflow-y-auto",children:Object.entries(w.stepCounts).sort((B,I)=>parseFloat(B[0])-parseFloat(I[0])).map(([B,I])=>c.jsxs("div",{className:"flex gap-2",children:[c.jsxs("span",{className:"text-gray-500 dark:text-slate-400",children:["Step ",B,":"]}),c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:String(I)})]},B))})]}),c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 rounded-xl p-2 relative overflow-hidden min-h-[300px]",children:[c.jsx("div",{className:"absolute top-2 left-4 text-xs font-bold text-gray-400 dark:text-slate-500 pointer-events-none z-20 bg-white/80 dark:bg-slate-900/80 px-2 rounded",children:"Step Size vs Code Value"}),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 z-0 pointer-events-none select-none opacity-10 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),c.jsx("div",{className:"relative z-10 w-full h-full",children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:w.plotData,margin:{top:20,right:20,bottom:20,left:10},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(ba,{dataKey:"x",type:"number",domain:["auto","auto"],tick:{fill:"#9ca3af",fontSize:10},label:{value:"Code Value (Shifted)",position:"insideBottom",offset:-10,fill:"#9ca3af",fontSize:11}}),c.jsx(va,{tick:{fill:"#9ca3af",fontSize:10},domain:[0,"auto"],allowDataOverflow:!1,label:{value:"Step Size (Delta)",angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:11}}),c.jsx(Rn,{contentStyle:{backgroundColor:"rgba(17, 24, 39, 0.95)",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6",fontSize:"12px"},labelFormatter:B=>`Val: ${B}`,formatter:B=>[B,"Step Size"]}),c.jsx(Dn,{type:"stepAfter",dataKey:"y",stroke:"#0891b2",strokeWidth:1.5,dot:{r:1.5,fill:"#0891b2",strokeWidth:0},activeDot:{r:4},isAnimationActive:!1})]})})})]})]})]})]}):null},koe=({isOpen:e,onClose:t,rawImageData:r,roi:n,isBGGR:a,zIndex:i,onFocus:o,initialPosition:s,stackFiles:l})=>{const u=!!(r!=null&&r.isThreePlane),d=j.useMemo(()=>dm(u,a),[u,a]),f=d.keyToIndex,h=d.keys,[p,x]=j.useState("cross"),[b,y]=j.useState(d.defaultPrimaryKey),[m,g]=j.useState(d.defaultSecondaryKey),[k,S]=j.useState("H"),[w,v]=j.useState(null),[M,_]=j.useState(!1),[P,A]=j.useState(0),[R,D]=j.useState(0),[E,W]=j.useState("single");j.useEffect(()=>{h.includes(b)||y(d.defaultPrimaryKey),h.includes(m)||g(d.defaultSecondaryKey)},[h,b,m,d]);const F=async O=>{if(!r||!n)return;_(!0),W(O),A(0),v(null);const $=f[b],N=p==="cross"?f[m]:$;if($===void 0||N===void 0){_(!1);return}let C=0,B=0;if(p==="self"){const I=d.selfAdjacentStep;k==="H"?B=I:C=I}setTimeout(async()=>{try{let I={sumCov:0,sumVar1:0,sumVar2:0,n:0};if(O==="single")I=Kk(r.data,r.width,r.height,n,$,N,C,B,!!r.isThreePlane);else if(l&&l.length>0)for(let z=0;z<l.length;z++){A(z+1);const V=await l[z].arrayBuffer(),K=await Ds(V),q=Kk(K.data,K.width,K.height,n,$,N,C,B,!!K.isThreePlane);I.sumCov+=q.sumCov,I.sumVar1+=q.sumVar1,I.sumVar2+=q.sumVar2,I.n+=q.n}D(I.n),v(jE(I))}catch(I){console.error("Pearson calculation failed",I),alert("Calculation error: "+I.message)}finally{_(!1)}},50)};return e?c.jsxs(Ks,{initialPosition:s||{x:200,y:200},onClose:t,zIndex:i,onFocus:o,className:"w-80 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl overflow-hidden",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-gray-700 dark:text-slate-200 flex items-center gap-2",children:["Pearson Correlation",c.jsx("span",{className:"text-[10px] font-normal bg-white dark:bg-slate-700 px-1.5 py-0.5 rounded border border-gray-200 dark:border-slate-600",children:"r"})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>x("cross"),className:`flex-1 py-1 text-[10px] font-bold rounded transition-all ${p==="cross"?"bg-indigo-600 text-white shadow":"text-gray-500 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:"Cross-Channel"}),c.jsx("button",{onClick:()=>x("self"),className:`flex-1 py-1 text-[10px] font-bold rounded transition-all ${p==="self"?"bg-indigo-600 text-white shadow":"text-gray-500 dark:text-slate-400 hover:bg-gray-200 dark:hover:bg-slate-700"}`,children:"Self-Adjacent"})]}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] uppercase font-bold text-gray-400",children:p==="cross"?"Channel 1":"Channel"}),c.jsx("select",{value:b,onChange:O=>y(O.target.value),className:"bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-2 py-1.5 text-xs text-gray-700 dark:text-slate-200 outline-none focus:ring-1 focus:ring-indigo-500",children:h.map(O=>c.jsx("option",{value:O,children:O},O))})]}),c.jsx("div",{className:"text-gray-300 dark:text-slate-600 mt-4 font-mono",children:p==="cross"?"x":"->"}),c.jsxs("div",{className:"flex-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] uppercase font-bold text-gray-400",children:p==="cross"?"Channel 2":"Direction"}),p==="cross"?c.jsx("select",{value:m,onChange:O=>g(O.target.value),className:"bg-gray-100 dark:bg-slate-800 border border-gray-200 dark:border-slate-700 rounded px-2 py-1.5 text-xs text-gray-700 dark:text-slate-200 outline-none focus:ring-1 focus:ring-indigo-500",children:h.map(O=>c.jsx("option",{value:O,children:O},O))}):c.jsxs("div",{className:"flex h-[28px] bg-gray-100 dark:bg-slate-800 rounded border border-gray-200 dark:border-slate-700 p-0.5",children:[c.jsx("button",{onClick:()=>S("H"),className:`flex-1 text-[9px] font-bold rounded ${k==="H"?"bg-slate-300 dark:bg-slate-600 text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"Horiz"}),c.jsx("button",{onClick:()=>S("V"),className:`flex-1 text-[9px] font-bold rounded ${k==="V"?"bg-slate-300 dark:bg-slate-600 text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"Vert"})]})]})]}),c.jsxs("div",{className:"grid grid-cols-1 gap-2",children:[c.jsx("button",{onClick:()=>F("single"),disabled:M,className:"w-full py-2 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-400 text-white font-bold rounded shadow-md transition-all active:scale-95 text-xs",children:M&&E==="single"?"Calculating...":"Calc Current Frame"}),l&&l.length>0&&c.jsxs("button",{onClick:()=>F("stack"),disabled:M,className:"w-full py-2 bg-emerald-600 hover:bg-emerald-500 disabled:bg-gray-400 text-white font-bold rounded shadow-md transition-all active:scale-95 text-xs flex flex-col items-center justify-center",children:[c.jsx("span",{children:"Calc Stack Concatenated"}),M&&E==="stack"&&c.jsxs("span",{className:"text-[9px] font-normal opacity-80",children:["Progress: ",P," / ",l.length]})]})]}),w!==null&&c.jsxs("div",{className:"mt-2 p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl border border-gray-200 dark:border-slate-700 text-center animate-in fade-in slide-in-from-top-2",children:[c.jsxs("div",{className:"text-[10px] uppercase font-bold text-gray-400 dark:text-slate-500 mb-1",children:[p==="cross"?"Cross-Channel":`Self-Adj (${k})`," r"]}),c.jsx("div",{className:"text-2xl font-mono font-bold text-indigo-600 dark:text-indigo-400 select-all",style:{fontSize:"24px"},children:w.toFixed(5)}),c.jsxs("div",{className:"text-[9px] text-gray-400 mt-2 font-mono",children:["N = ",R.toLocaleString()," pairs"]}),c.jsx("div",{className:"mt-3 text-[10px] font-bold",children:Math.abs(w)>.5?c.jsx("span",{className:"text-red-500",children:"Significant Correlation"}):Math.abs(w)>.1?c.jsx("span",{className:"text-amber-500",children:"Weak Correlation"}):c.jsx("span",{className:"text-emerald-500",children:"Near-Zero (Uncorrelated)"})})]})]}),c.jsx("div",{className:"p-3 bg-gray-50/50 dark:bg-slate-800/30 text-[9px] text-gray-400 dark:text-slate-600 italic border-t border-gray-100 dark:border-slate-800",children:p==="cross"?u?"Comparing two channels at the same RGB pixel.":"Comparing two color channels in the same Bayer 2x2 cells.":`Comparing pixel (r,c) with (r${k==="V"?`+${d.selfAdjacentStep}`:""}, c${k==="H"?`+${d.selfAdjacentStep}`:""}) in the same channel.`})]}):null},Soe=[{href:"https://y-g-jiang.github.io/CBLD.html",text:" (Primary Source)",abbr:"CBLD",description:"ISO",highlight:!0},{href:"https://y-G-jiang.github.io/LAC.html",text:"",abbr:"LAC",description:""},{href:"https://y-G-jiang.github.io/CCGV.html",text:"adobeIECMF",abbr:"CCGV",description:"acrRAWxy"},{href:"https://y-G-jiang.github.io/JTJS.html",text:"",abbr:"JTJS",description:"CMF/"},{href:"https://y-G-jiang.github.io/XJZS.html",text:"",abbr:"XJZS",description:""}],joe=["5","9","0","8","2","1","4","7","3","6"],z4=e=>!e||e==="--"?"--":String(e).split("").map(t=>{const r=parseInt(t);return isNaN(r)?t:joe[r]}).join(""),Moe=({isOpen:e,onClose:t})=>{const[r,n]=j.useState({pv:"--",uv:"--"});return j.useEffect(()=>{if(e){const a=()=>{const o=document.getElementById("vercount_value_site_pv"),s=document.getElementById("vercount_value_site_uv");o&&s&&n({pv:o.innerText||"--",uv:s.innerText||"--"})};a();const i=setTimeout(a,1e3);return()=>clearTimeout(i)}},[e]),e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-3xl rounded-2xl shadow-2xl border border-gray-200 dark:border-slate-700 overflow-hidden flex flex-col max-h-[90vh]",onClick:a=>a.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"About / Tools"}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-6 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700 relative",children:[c.jsx("div",{className:"mb-8 p-4 bg-gray-50 dark:bg-slate-800/50 rounded-xl border border-gray-100 dark:border-slate-700 text-center",children:c.jsxs("p",{className:"text-lg text-gray-700 dark:text-slate-300",children:[c.jsx("span",{className:"font-bold mr-2",children:"about:"}),c.jsx("a",{href:"https://y-g-jiang.github.io/JOindex.html",target:"_blank",rel:"noopener noreferrer",className:"text-cyan-600 dark:text-cyan-400 hover:underline break-all font-mono",children:"https://y-g-jiang.github.io/JOindex.html"})]})}),c.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 flex-1"}),c.jsx("span",{className:"text-sm font-bold text-gray-400 dark:text-slate-500 uppercase tracking-wider",children:"Primary Resources"}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 flex-1"})]}),c.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8",children:Soe.map(a=>c.jsxs("a",{href:a.href,target:"_blank",rel:"noopener noreferrer",className:`group block p-4 rounded-xl border transition-all duration-200 relative overflow-hidden ${a.highlight?"border-cyan-500 dark:border-cyan-400 bg-cyan-50/30 dark:bg-cyan-900/10 shadow-lg scale-[1.02] ring-2 ring-cyan-500/20":"border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-800/30 hover:bg-gray-50 dark:hover:bg-slate-800 hover:border-cyan-500"}`,children:[c.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 bg-gradient-to-bl from-cyan-500/5 to-transparent -mr-8 -mt-8 rounded-full pointer-events-none group-hover:from-cyan-500/10 transition-colors"}),c.jsxs("div",{className:"flex items-center gap-3 mb-2 relative z-10",children:[c.jsx("span",{className:`px-2 py-1 text-xs font-bold rounded transition-colors border ${a.highlight?"bg-cyan-600 text-white border-cyan-500":"bg-gray-100 dark:bg-slate-700 text-gray-600 dark:text-slate-300 border-gray-200 dark:border-slate-600 group-hover:border-cyan-200"}`,children:a.abbr}),c.jsx("h3",{className:`font-bold transition-colors ${a.highlight?"text-cyan-700 dark:text-cyan-300":"text-gray-800 dark:text-slate-200 group-hover:text-cyan-600"}`,children:a.text})]}),c.jsx("p",{className:`text-xs pl-1 transition-colors relative z-10 ${a.highlight?"text-cyan-600/80 dark:text-cyan-400/80":"text-gray-500 dark:text-slate-400"}`,children:a.description})]},a.abbr))}),c.jsx("div",{className:"flex justify-end mt-4",children:c.jsx("div",{className:"bg-gray-50 dark:bg-slate-900/50 rounded border border-gray-200 dark:border-slate-800 p-1.5 opacity-40 hover:opacity-100 transition-opacity cursor-default select-none group",children:c.jsxs("div",{className:"font-mono text-[10px] text-gray-400 dark:text-slate-600 leading-tight text-right flex flex-col",children:[c.jsx("span",{className:"group-hover:text-indigo-400 transition-colors",children:z4(r.pv)}),c.jsx("span",{className:"group-hover:text-emerald-400 transition-colors",children:z4(r.uv)})]})})})]})]})}):null},_oe=({isOpen:e,onClose:t,data:r,fileName:n,warning:a})=>{const[i,o]=j.useState(""),s=d=>{const f=new WeakSet;try{return JSON.stringify(d,(h,p)=>{if(typeof p=="bigint")return p.toString()+"n";if(typeof p=="object"&&p!==null){if(f.has(p))return"[Circular]";if(f.add(p),ArrayBuffer.isView(p))return`[${p.constructor.name}]`}return p})}catch{return"[Unable to serialize object]"}},l=j.useMemo(()=>{if(!r)return[];const d=[],f=(h,p=0)=>{if(p>5)return"...";if(h==null)return String(h);if(h instanceof Date)return h.toLocaleString();if(typeof h=="number")return h.toString();if(typeof h=="string")return h;if(typeof h=="bigint")return h.toString()+"n";if(ArrayBuffer.isView(h))return`<${h.constructor.name} len=${h.length} bytes=${h.byteLength}>`;if(h instanceof ArrayBuffer)return`<ArrayBuffer bytes=${h.byteLength}>`;if(typeof h=="object"){if(Array.isArray(h))return h.length===0?"[]":h.length>20?`[${h.slice(0,10).map(y=>typeof y=="number"?y.toFixed(2):f(y,p+1)).join(", ")}, ... (+${h.length-10} more)]`:`[${h.map(b=>typeof b=="number"?Number.isInteger(b)?b:b.toFixed(4):f(b,p+1)).join(", ")}]`;try{const x=Object.keys(h);return x.length>5?`{Object with ${x.length} keys}`:s(h)}catch{return"<Complex Object>"}}return String(h)};try{if(typeof r!="object")return[{key:"Value",value:String(r)}];Object.keys(r).sort().forEach(p=>{if(p==="MakerNote"||p==="UserComment"||p.includes("Strip")||p.includes("Offset")){d.push({key:p,value:"<Binary/Internal Data>"});return}const x=r[p];d.push({key:p,value:f(x)})})}catch(h){console.error("Error processing EXIF data:",h),d.push({key:"Error",value:"Failed to process metadata structure."})}return d},[r]);if(!e)return null;const u=l.filter(d=>d.key.toLowerCase().includes(i.toLowerCase())||d.value.toLowerCase().includes(i.toLowerCase()));return c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-3xl max-h-[90vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"overflow-hidden",children:[c.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100",children:"EXIF Data"}),c.jsx("p",{className:"text-sm text-gray-500 dark:text-slate-400 mt-1 font-mono truncate",children:n})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),a&&c.jsx("div",{className:"bg-amber-50 dark:bg-amber-900/20 px-4 py-2 border-b border-amber-100 dark:border-amber-800/50 text-center",children:c.jsx("p",{className:"text-xs text-amber-600 dark:text-amber-400 whitespace-pre-line font-medium leading-relaxed",children:a})}),c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:c.jsxs("div",{className:"relative",children:[c.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),c.jsx("input",{type:"text",placeholder:"Search tags...",value:i,onChange:d=>o(d.target.value),className:"w-full pl-9 pr-4 py-2 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded-lg text-sm focus:ring-2 focus:ring-cyan-500 outline-none text-gray-900 dark:text-slate-100 transition-colors placeholder-gray-400"})]})}),c.jsx("div",{className:"overflow-y-auto flex-1 p-0 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700",children:u.length>0?c.jsxs("table",{className:"w-full text-left border-collapse table-fixed",children:[c.jsx("thead",{className:"bg-gray-50 dark:bg-slate-800 sticky top-0 shadow-sm z-10",children:c.jsxs("tr",{children:[c.jsx("th",{className:"py-3 px-5 font-semibold text-xs text-gray-500 dark:text-slate-400 uppercase tracking-wider w-1/3 border-b border-gray-200 dark:border-slate-700",children:"Tag Name"}),c.jsx("th",{className:"py-3 px-5 font-semibold text-xs text-gray-500 dark:text-slate-400 uppercase tracking-wider w-2/3 border-b border-gray-200 dark:border-slate-700",children:"Value"})]})}),c.jsx("tbody",{className:"divide-y divide-gray-100 dark:divide-slate-800",children:u.map(d=>c.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-slate-800/50 transition-colors group",children:[c.jsx("td",{className:"py-2 px-5 text-sm font-medium text-cyan-600 dark:text-cyan-400 font-mono break-words align-top",children:d.key}),c.jsx("td",{className:"py-2 px-5 text-sm text-gray-700 dark:text-slate-300 font-mono break-words align-top group-hover:text-gray-900 dark:group-hover:text-slate-100",children:d.value})]},d.key))})]}):c.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-400 dark:text-slate-500",children:c.jsxs("p",{children:['No tags found matching "',i,'"']})})}),c.jsx("div",{className:"p-4 border-t border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50 flex justify-end rounded-b-2xl",children:c.jsx("button",{onClick:t,className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-800 dark:text-white rounded-lg text-sm font-semibold transition-colors",children:"Close"})})]})})},Poe=100,Wx=e=>{if(e.length===0)return 0;if(e.length===1)return e[0];if(e.length===2)return .5*(e[0]+e[1]);let t=[...e].sort((r,n)=>r-n);for(;t.length>4;){let r=1/0,n=0;const a=t.length,i=Math.floor(a/2);for(let o=0;o<=a-i;o++){const s=t[o+i-1]-t[o];s<r&&(r=s,n=o)}t=t.slice(n,n+i)}return t.reduce((r,n)=>r+n,0)/t.length},W4=({min:e,max:t,value:r,onChange:n,vertical:a=!1,logScale:i=!1})=>{const o=j.useRef(null),s=j.useRef(null),l=j.useCallback(g=>{const k=i?Math.max(1e-6,e):e,S=i?Math.max(k*1.0001,t):t,w=Math.max(k,Math.min(S,g));if(i){const v=Math.log10(k),M=Math.log10(S);return(Math.log10(w)-v)/(M-v)}return(w-k)/(S-k)},[e,t,i]),u=j.useCallback(g=>{const k=i?Math.max(1e-6,e):e,S=i?Math.max(k*1.0001,t):t;if(i){const w=Math.log10(k),v=Math.log10(S);return Math.pow(10,w+g*(v-w))}return k+g*(S-k)},[e,t,i]),d=(g,k)=>{g.preventDefault(),g.stopPropagation(),s.current=k;const S=v=>{if(!s.current||!o.current)return;const M=o.current.getBoundingClientRect();let _=0;a?_=(M.bottom-v.clientY)/M.height:_=(v.clientX-M.left)/M.width,_=Math.max(0,Math.min(1,_));const P=u(_);if(s.current==="min"){const A=r[1];n([Math.min(P,A),A])}else{const A=r[0];n([A,Math.max(P,A)])}},w=()=>{s.current=null,window.removeEventListener("mousemove",S),window.removeEventListener("mouseup",w)};window.addEventListener("mousemove",S),window.addEventListener("mouseup",w)},f=l(r[0])*100,h=l(r[1])*100,p=a?{left:"50%",top:0,bottom:0,width:"4px",transform:"translateX(-50%)"}:{top:"50%",left:0,right:0,height:"4px",transform:"translateY(-50%)"},x=a?{left:"50%",bottom:`${f}%`,height:`${h-f}%`,width:"4px",transform:"translateX(-50%)"}:{top:"50%",left:`${f}%`,width:`${h-f}%`,height:"4px",transform:"translateY(-50%)"},b="absolute w-3 h-3 bg-white border-2 border-cyan-600 rounded-full shadow-md cursor-pointer hover:scale-125 transition-transform z-10",y=a?{left:"50%",bottom:`${f}%`,transform:"translate(-50%, 50%)"}:{top:"50%",left:`${f}%`,transform:"translate(-50%, -50%)"},m=a?{left:"50%",bottom:`${h}%`,transform:"translate(-50%, 50%)"}:{top:"50%",left:`${h}%`,transform:"translate(-50%, -50%)"};return c.jsxs("div",{ref:o,className:`relative select-none ${a?"h-full w-4 py-2":"w-full h-4 px-2"}`,children:[c.jsx("div",{className:"absolute bg-gray-300 dark:bg-slate-600 rounded-full",style:p}),c.jsx("div",{className:"absolute bg-cyan-500 dark:bg-cyan-400 rounded-full",style:x}),c.jsx("div",{className:b,style:y,onMouseDown:g=>d(g,"min")}),c.jsx("div",{className:b,style:m,onMouseDown:g=>d(g,"max")})]})},Noe=({isOpen:e,onClose:t,data:r,blackLevel:n,imageHeight:a,isBGGR:i,importedMetadata:o,theme:s,initialCameraModel:l,initialISO:u})=>{const[d,f]=j.useState("Noise"),[h,p]=j.useState(!0),[x,b]=j.useState(null),[y,m]=j.useState("default"),[g,k]=j.useState(!1),[S,w]=j.useState(!1),[v,M]=j.useState({R:!0,G1:!0,G2:!0,B:!0}),[_,P]=j.useState(""),[A,R]=j.useState(""),[D,E]=j.useState(""),[W,F]=j.useState(""),[O,$]=j.useState("10"),[N,C]=j.useState(""),[B,I]=j.useState("0 0 0 0"),[z,V]=j.useState("0 0 0 0"),[K,q]=j.useState(!1),[G,pe]=j.useState(null),[J,Z]=j.useState(!1),[ae,ce]=j.useState(0),[ne,le]=j.useState([]),[se,he]=j.useState(""),[ue,ie]=j.useState(""),xe=()=>{const oe=parseFloat(se),me=parseFloat(ue);!isNaN(oe)&&!isNaN(me)&&(le([...ne,{id:Date.now(),x:oe,y:me}]),he(""),ie(""))},[Se,Ie]=j.useState(()=>localStorage.getItem("ptc_tester_name")||""),[te,Oe]=j.useState(""),[Fe,bt]=j.useState("");j.useEffect(()=>{localStorage.setItem("ptc_tester_name",Se)},[Se]);const Ct=j.useRef(K),ut=j.useRef(J),dt=j.useRef(ae);j.useEffect(()=>{Ct.current=K,ut.current=J,dt.current=ae},[K,J,ae]);const[ht,tt]=j.useState(null),[vt,Sr]=j.useState({min:.01,max:90}),[Ft,rt]=j.useState({readNoise:0,gain:1,prnu:.5}),[Kt,lr]=j.useState(2e6),Vt=j.useRef(Ft),gr=j.useRef(vt),Zt=j.useRef(Kt);j.useEffect(()=>{Vt.current=Ft,gr.current=vt,Zt.current=Kt},[Ft,vt,Kt]);const[zt,rr]=j.useState({read:"0",gain:"1.0",prnu:"0.5",rangeMin:"0.01",rangeMax:"90"}),[Ot,_e]=j.useState({read:!0,shot:!0,prnu:!0,total:!0,fitRange:!0}),[ee,ve]=j.useState(!1),[de,De]=j.useState([]),[Ye,st]=j.useState(null),[_t,Xe]=j.useState(""),Ar=j.useMemo(()=>n?n.join(","):"",[n]);j.useEffect(()=>{if(e){let oe="0 0 0 0";o&&o.blackLevel?oe=o.blackLevel.join(" "):oe=n&&n.length===4?n.join(" "):"0 0 0 0",I(oe),V(oe);let me="";if(o&&o.height?me=o.height.toString():a&&(me=a.toString()),C(me),me){const Q=parseFloat(me);!isNaN(Q)&&Q>0?$((2309.4/Q).toFixed(2)):$("10")}else $("10");pe(null),q(!1),Z(!1),ce(0),De([]),st(null),Sr({min:.01,max:90}),rr({read:"0",gain:"0",prnu:"0",rangeMin:"0.01",rangeMax:"90"});const je={readNoise:0,gain:0,prnu:0};rt(je),Vt.current=je,P(""),R(""),E(""),F(""),f("Noise"),tt(null),lr(2e6),Xe(""),w(!1),le([]),Oe(Q=>Q.trim()===""&&l?l:Q),bt(Q=>Q.trim()===""&&u?u:Q)}},[e,Ar,o,a,r,l,u]);const nr=oe=>{if(oe.key==="Enter"){const me=parseFloat(N);if(!isNaN(me)&&me>0){const je=(2309.4/me).toFixed(2);$(je)}oe.target.blur()}},Gt=j.useMemo(()=>{let me=z.trim().split(/[\s,]+/).filter(Boolean).map(Number);for(me.length===1&&(me=[me[0],me[0],me[0],me[0]]);me.length<4;)me.push(0);const je=Q=>{switch(Q){case"R":return me[0];case"G1":return me[1];case"G2":return me[2];case"B":return me[3];default:return 0}};return r.map(Q=>{const $e=Q.mean-je(Q.channel),Ke=Q.std>0?$e/Q.std:0;return{...Q,x:$e,std:Q.std,snr:Ke}}).filter(Q=>Q.std>0)},[r,z]),mt=j.useMemo(()=>{const oe=Ft.readNoise,me=oe*oe;return Gt.map(je=>{let Q=0;if(d==="Noise")Q=je.std;else if(d==="SNR")Q=je.snr;else if(d==="Linear"){const Ke=je.std*je.std-me;Q=je.x!==0?Ke/je.x:0}return{...je,y:Q}})},[Gt,d,Ft.readNoise]),Jt=j.useMemo(()=>{if(Gt.length===0)return"G1";const oe={R:0,G1:0,G2:0,B:0},me={R:0,G1:0,G2:0,B:0};for(const $e of Gt)oe[$e.channel]+=$e.x,me[$e.channel]++;let je="G1",Q=-1/0;return Object.keys(oe).forEach($e=>{const Ke=me[$e],ot=Ke>0?oe[$e]/Ke:-1/0;ot>Q&&(Q=ot,je=$e)}),je},[Gt]),Pr=j.useCallback(()=>{let oe=1/0,me=-1/0;if(Gt.length===0)return{min:.1,max:1};for(let je=0;je<Gt.length;je++){const Q=Gt[je].x;h&&Q<=0||(Q<oe&&(oe=Q),Q>me&&(me=Q))}return oe===1/0?{min:.1,max:1}:{min:oe,max:me}},[Gt,h]),Zr=j.useCallback(()=>{let oe=1/0,me=-1/0;if(mt.length===0)return{min:.1,max:1};for(let je=0;je<mt.length;je++){const Q=mt[je].y;h&&Q<=0||(Q<oe&&(oe=Q),Q>me&&(me=Q))}return oe===1/0?{min:.1,max:1}:{min:oe*.9,max:me*1.1}},[mt,h]),{min:jr,max:we}=Pr(),{min:Je,max:Qe}=Zr(),Qt=we*(vt.min/100),Ht=we*(vt.max/100),it=j.useMemo(()=>{if(!h&&mt.length===0)return{shot:[],read:[],prnu:[],total:[]};const oe=_?parseFloat(_):jr,me=A?parseFloat(A):we,je=100,Q=Math.max(.1,oe),$e=Math.max(1,me);if(Q>=$e)return{shot:[],read:[],prnu:[],total:[]};const Ke=Math.log10(Q),wt=(Math.log10($e)-Ke)/je,Rt=Ft.readNoise,yt=Ft.gain>0?Ft.gain:1,ir=Ft.prnu/100,dr=[],Cr=[],Fr=[],Ne=[];for(let Lt=0;Lt<=je;Lt++){const et=Math.pow(10,Ke+Lt*wt);if(d==="Linear"){const Mr=1/yt,vr=ir*ir,wn=Mr+vr*et;Ne.push({x:et,y:wn}),dr.push({x:et,y:Mr}),Fr.push({x:et,y:vr*et})}else{const Mr=Rt,vr=Math.sqrt(et/yt),wn=ir*et,mr=Math.sqrt(Mr*Mr+vr*vr+wn*wn);d==="Noise"?(dr.push({x:et,y:vr}),Cr.push({x:et,y:Mr}),Fr.push({x:et,y:wn}),Ne.push({x:et,y:mr})):(vr>0&&dr.push({x:et,y:et/vr}),Mr>0&&Cr.push({x:et,y:et/Mr}),wn>0&&Fr.push({x:et,y:et/wn}),mr>0&&Ne.push({x:et,y:et/mr}))}}return{shot:dr,read:Cr,prnu:Fr,total:Ne}},[mt,h,_,A,Ft,d,jr,we]),cr=j.useMemo(()=>{if(d==="Linear")return[];const oe=parseFloat(O);if(isNaN(oe)||oe<=0)return[];const me=_?parseFloat(_):jr,je=A?parseFloat(A):we;return d==="SNR"?[{x:me,y:oe},{x:je,y:oe}]:[{x:me,y:me/oe},{x:je,y:je/oe}]},[mt,O,d,_,A,jr,we]),pr=j.useCallback((oe,me)=>{if(!me||me.length===0)return null;const je=[...me].sort((Q,$e)=>Q.x-$e.x);for(let Q=0;Q<je.length-1;Q++){const $e=je[Q],Ke=je[Q+1];if($e.snr<=oe&&Ke.snr>=oe||$e.snr>=oe&&Ke.snr<=oe){const ot=(oe-$e.snr)/(Ke.snr-$e.snr);return $e.x+ot*(Ke.x-$e.x)}}return null},[]),It=j.useMemo(()=>{const oe=Gt,me=1e3,je=$e=>{if($e.length===0)return[];if($e.length<=me)return $e;const Ke=[...$e].sort((Rt,yt)=>Rt.x-yt.x),ot=[],wt=Ke.length/me;for(let Rt=0;Rt<me;Rt++){const yt=Math.floor(Rt*wt),ir=Math.floor((Rt+1)*wt),dr=Ke.slice(yt,ir);if(dr.length===0)continue;dr.sort((Fr,Ne)=>Fr.std-Ne.std);const Cr=Math.floor(dr.length/2);ot.push(dr[Cr])}return ot},Q={R:[],G1:[],G2:[],B:[]};return oe.forEach($e=>{Q[$e.channel]&&Q[$e.channel].push($e)}),{R:je(Q.R),G1:je(Q.G1),G2:je(Q.G2),B:je(Q.B)}},[Gt]),Tt=j.useMemo(()=>G&&Ft.gain?G*Ft.gain:null,[G,Ft.gain]),Ae=j.useMemo(()=>{if(G===null||G===0)return null;const oe=parseFloat(O);let me=null;if(!isNaN(oe)&&oe>0){let ot=0,wt=0;if(["R","G1","G2","B"].forEach(Rt=>{const yt=pr(oe,It[Rt]);yt!==null&&(ot+=yt,wt++)}),wt>0){const Rt=ot/wt;me=Math.log2(G/Rt)}}const je=parseFloat(N);let Q=null,$e=NaN;if(!isNaN(je)&&je>0){$e=16e3/je;let ot=0,wt=0;if(["R","G1","G2","B"].forEach(Rt=>{const yt=pr($e,It[Rt]);yt!==null&&(ot+=yt,wt++)}),wt>0){const Rt=ot/wt;Q=Math.log2(G/Rt)}}let Ke=null;if(!isNaN(je)&&je>0){const ot=pr($e,It[Jt]);ot!==null&&(Ke=Math.log2(G/ot))}return{manualDR:me,ptpDR:Q,d55DR:Ke,manualTarget:oe,ptpTarget:$e,saturationSignal:G,dominantChannel:Jt}},[G,O,N,It,pr,Jt]),Yt=j.useMemo(()=>{if(d==="Linear"||!Ae||!Ae.ptpTarget||isNaN(Ae.ptpTarget))return[];const oe=Ae.ptpTarget,me=_?parseFloat(_):jr,je=A?parseFloat(A):we;return d==="SNR"?[{x:me,y:oe},{x:je,y:oe}]:[{x:me,y:me/oe},{x:je,y:je/oe}]},[d,Ae,_,A,jr,we]),L=j.useCallback(()=>{const je=document.createElement("canvas");je.width=2048,je.height=1536;const Q=je.getContext("2d");if(!Q)return;const $e=s==="dark",Ke=$e?"#0f172a":"#ffffff",ot=$e?"#ffffff":"#000000",wt=$e?"#475569":"#cbd5e1",Rt=$e?"#1e293b":"#f1f5f9",yt=i?{R:"#ef4444",G1:"#22c55e",G2:"#4ade80",B:"#3b82f6"}:{R:"#ef4444",G1:"#22c55e",G2:"#4ade80",B:"#3b82f6"};Q.fillStyle=Ke,Q.fillRect(0,0,2048,1536);let ir=_?parseFloat(_):jr,dr=A?parseFloat(A):we,Cr=D?parseFloat(D):Je,Fr=W?parseFloat(W):Qe;isNaN(ir)&&(ir=.1),isNaN(dr)&&(dr=1e4),isNaN(Cr)&&(Cr=.1),isNaN(Fr)&&(Fr=1e3);const Ne={top:80,right:80,bottom:100,left:120},Lt=2048-Ne.left-Ne.right,et=1536-Ne.top-Ne.bottom,Mr=ze=>{if(h){const tr=Math.log10(Math.max(1e-9,ir)),kt=Math.log10(Math.max(1e-9,dr)),qt=Math.log10(Math.max(1e-9,ze));return Ne.left+(qt-tr)/(kt-tr)*Lt}else return Ne.left+(ze-ir)/(dr-ir)*Lt},vr=ze=>{if(h){const tr=Math.log10(Math.max(1e-9,Cr)),kt=Math.log10(Math.max(1e-9,Fr)),qt=Math.log10(Math.max(1e-9,ze));return Ne.top+et-(qt-tr)/(kt-tr)*et}else return Ne.top+et-(ze-Cr)/(Fr-Cr)*et};if(Q.beginPath(),h){const ze=(tr,kt,qt)=>{const un=Math.log10(Math.max(1e-9,tr)),da=Math.log10(Math.max(1e-9,kt)),gn=Math.floor(un),bi=Math.ceil(da);for(let Xn=gn;Xn<=bi;Xn++){const Ma=Math.pow(10,Xn);let Gr=qt?Mr(Ma):vr(Ma);(qt?Gr>=Ne.left-1&&Gr<=Ne.left+Lt+1:Gr>=Ne.top-1&&Gr<=Ne.top+et+1)&&(Q.lineWidth=1.5,Q.strokeStyle=wt,Q.beginPath(),qt?(Q.moveTo(Gr,Ne.top),Q.lineTo(Gr,Ne.top+et)):(Q.moveTo(Ne.left,Gr),Q.lineTo(Ne.left+Lt,Gr)),Q.stroke()),Q.lineWidth=.5,Q.strokeStyle=Rt;for(let fo=2;fo<10;fo++){const Wo=fo*Ma;Gr=qt?Mr(Wo):vr(Wo),(qt?Gr>=Ne.left&&Gr<=Ne.left+Lt:Gr>=Ne.top&&Gr<=Ne.top+et)&&(Q.beginPath(),qt?(Q.moveTo(Gr,Ne.top),Q.lineTo(Gr,Ne.top+et)):(Q.moveTo(Ne.left,Gr),Q.lineTo(Ne.left+Lt,Gr)),Q.stroke())}}};ze(ir,dr,!0),ze(Cr,Fr,!1)}else{Q.strokeStyle=wt,Q.lineWidth=1;for(let ze=0;ze<=5;ze++){const tr=Ne.left+Lt*ze/5;Q.beginPath(),Q.moveTo(tr,Ne.top),Q.lineTo(tr,Ne.top+et),Q.stroke();const kt=Ne.top+et*ze/5;Q.beginPath(),Q.moveTo(Ne.left,kt),Q.lineTo(Ne.left+Lt,kt),Q.stroke()}}Q.strokeStyle=ot,Q.lineWidth=2,Q.strokeRect(Ne.left,Ne.top,Lt,et);const wn=(ze,tr,kt)=>{ze<Ne.left||ze>Ne.left+Lt||tr<Ne.top||tr>Ne.top+et||(Q.fillStyle=kt,Q.fillRect(ze-1.5,tr-1.5,3,3))},mr=mt.filter(ze=>!(h&&(ze.x<=0||ze.y<=0)));mr.forEach(ze=>{v[ze.channel]&&ze.channel!==Jt&&wn(Mr(ze.x),vr(ze.y),yt[ze.channel])}),mr.forEach(ze=>{v[ze.channel]&&ze.channel===Jt&&wn(Mr(ze.x),vr(ze.y),yt[ze.channel])}),ne.forEach(ze=>{const tr=Mr(ze.x),kt=vr(ze.y);if(tr<Ne.left||tr>Ne.left+Lt||kt<Ne.top||kt>Ne.top+et)return;Q.strokeStyle="#d946ef",Q.lineWidth=2.5;const qt=6;Q.beginPath(),Q.moveTo(tr-qt,kt-qt),Q.lineTo(tr+qt,kt+qt),Q.moveTo(tr+qt,kt-qt),Q.lineTo(tr-qt,kt+qt),Q.stroke()});const Jr=(ze,tr,kt=[])=>{if(ze.length<2)return;Q.beginPath(),Q.strokeStyle=tr,Q.lineWidth=3,Q.setLineDash(kt);let qt=!1;for(const un of ze){const da=Mr(un.x),gn=vr(un.y);if(da<Ne.left-100||da>Ne.left+Lt+100||gn<Ne.top-100||gn>Ne.top+et+100){qt=!1;continue}qt?Q.lineTo(da,gn):(Q.moveTo(da,gn),qt=!0)}Q.stroke(),Q.setLineDash([])},Gn=$e?"#ffffff":"#000000";if(Ot.shot&&Jr(it.shot,"#94a3b8",[5,5]),Ot.read&&Jr(it.read,"#f43f5e",[3,3]),Ot.prnu&&Jr(it.prnu,"#f59e0b",[3,3]),Ot.total&&Jr(it.total,Gn,[]),cr.length===2){const ze="#6366f1";Jr(cr,ze,[4,2]);const tr=cr[1],kt=vr(tr.y);kt>=Ne.top&&kt<=Ne.top+et&&(Q.fillStyle=ze,Q.font="bold 20px sans-serif",Q.textAlign="right",Q.textBaseline="bottom",Q.fillText(`M.Tgt=${O}`,Ne.left+Lt-10,kt-8))}if(Yt.length===2&&(Ae!=null&&Ae.ptpTarget)){const ze="#10b981";Jr(Yt,ze,[4,4]);const tr=Yt[1],kt=vr(tr.y);if(kt>=Ne.top&&kt<=Ne.top+et){Q.fillStyle=ze,Q.font="bold 20px sans-serif",Q.textAlign="right",Q.textBaseline="bottom";const qt=Ae.ptpTarget.toFixed(1),un=cr.length===2?vr(cr[1].y):-100,da=Math.abs(kt-un)<25?25:0;Q.fillText(`PTP=${qt}`,Ne.left+Lt-10,kt-8-da)}}if(Ot.fitRange||J){const ze=(tr,kt)=>{const qt=Mr(tr);qt>=Ne.left&&qt<=Ne.left+Lt&&(Q.beginPath(),Q.strokeStyle=kt,Q.lineWidth=2,Q.setLineDash([8,8]),Q.moveTo(qt,Ne.top),Q.lineTo(qt,Ne.top+et),Q.stroke(),Q.setLineDash([]))};ze(Qt,"#22d3ee"),ze(Ht,"#22d3ee")}if(G){const ze=Mr(G);ze>=Ne.left&&ze<=Ne.left+Lt&&(Q.strokeStyle="#ef4444",Q.lineWidth=3,Q.setLineDash([10,10]),Q.beginPath(),Q.moveTo(ze,Ne.top),Q.lineTo(ze,Ne.top+et),Q.stroke(),Q.setLineDash([]),Q.fillStyle="#ef4444",Q.font="bold 24px sans-serif",Q.textAlign="center",Q.fillText("Sat",ze,Ne.top-10))}Q.fillStyle=ot,Q.font="28px monospace",Q.textAlign="center",Q.fillText(ir.toExponential(1),Ne.left,Ne.top+et+40),Q.fillText(dr.toExponential(1),Ne.left+Lt,Ne.top+et+40),Q.fillText("Signal (DN)",Ne.left+Lt/2,Ne.top+et+80),Q.textAlign="right",Q.textBaseline="middle",Q.fillText(Cr.toExponential(1),Ne.left-20,Ne.top+et),Q.fillText(Fr.toExponential(1),Ne.left-20,Ne.top),Q.save(),Q.translate(Ne.left-80,Ne.top+et/2),Q.rotate(-Math.PI/2),Q.textAlign="center",Q.fillText(d==="Linear"?"(Var - RN) / Mean":d,0,0),Q.restore(),Q.save(),Q.translate(2048/2,1536/2),Q.rotate(-Math.PI/6),Q.textAlign="center",Q.textBaseline="middle",Q.fillStyle=$e?"rgba(255, 255, 255, 0.1)":"rgba(0, 0, 0, 0.1)",Q.font="bold 150px sans-serif",Q.fillText(" y-g-jiang.github.io",0,0),Q.restore(),Q.fillStyle=ot,Q.font="bold 36px sans-serif",Q.textAlign="left",Q.textBaseline="top",Q.fillText(`PTC Export: ${d} Mode`,Ne.left,20),Q.font="24px sans-serif",Q.fillStyle=$e?"#94a3b8":"#64748b",Q.fillText(`Points: ${mt.length} | Sat Channel: ${Jt}`,Ne.left,65);const Fi=Ne.left+30,Gi=Ne.top+30,Wu=70,Ys=ze=>{if(!G||ze<=0)return"--";const tr=Ft.readNoise,kt=Ft.gain,qt=Ft.prnu/100;if(kt<=0)return"--";const un=ze*ze,da=tr*tr,gn=1-un*qt*qt,bi=-(un/kt),Xn=-(un*da);let Ma=0;if(Math.abs(gn)<1e-8)Math.abs(bi)>1e-8&&(Ma=-Xn/bi);else{const Gr=bi*bi-4*gn*Xn;Gr>=0&&(Ma=(-bi+Math.sqrt(Gr))/(2*gn))}return Ma>0?Math.log2(G/Ma).toFixed(2)+" EV":"--"},Vu=Ae!=null&&Ae.ptpTarget&&!isNaN(Ae.ptpTarget)?Ys(Ae.ptpTarget):"--",Jl=O?Ys(parseFloat(O)):"--";Q.font="bold 48px monospace",Q.textAlign="left",Q.textBaseline="top",Q.shadowColor=$e?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)",Q.shadowBlur=4,Q.shadowOffsetX=1,Q.shadowOffsetY=1;const nn=(ze,tr,kt,qt)=>{const un=Gi+kt*Wu;Q.fillStyle=ot,Q.fillText(ze,Fi,un);const da=Q.measureText(ze).width;Q.fillStyle=qt||ot,Q.fillText(tr,Fi+da,un)},La=zt.read,lo=parseFloat(zt.gain).toFixed(3),Ba=parseFloat(zt.prnu).toFixed(2)+"%";let co=`M.DR@SNR${O}: `;const Ui=parseFloat(N);if(!isNaN(Ui)&&Ui>0){const ze=(2309.4/Ui).toFixed(2);Math.abs(parseFloat(O)-parseFloat(ze))<.05&&(co="8mpSNR=1 DR: ")}nn("Tester: ",Se||"N/A",0),nn("Model : ",te||"Unknown",1),nn("ISO   : ",Fe||"N/A",2),nn("RN/FPN: ",La,3,"#f43f5e"),nn("KADC  : ",lo,4,"#06b6d4"),nn("PRNU  : ",Ba,5,"#f59e0b"),nn("PTP DR: ",Ae!=null&&Ae.ptpDR?Ae.ptpDR.toFixed(2)+" EV":"--",6,"#10b981"),nn("D55 DR: ",Ae!=null&&Ae.d55DR?Ae.d55DR.toFixed(2)+" EV":"--",7,"#8b5cf6"),nn("FWC   : ",Tt?Tt>1e4?(Tt/1e3).toFixed(1)+"k":Math.round(Tt).toString():"--",8,"#f97316"),nn(co,Ae!=null&&Ae.manualDR?Ae.manualDR.toFixed(2)+" EV":"--",9,"#06b6d4"),nn("PTCFitDR(PTP): ",Vu,10,"#10b981"),nn("PTCFitDR(Man): ",Jl,11,"#06b6d4"),Q.save(),Q.textAlign="right",Q.textBaseline="bottom",Q.fillStyle="#3b82f6",Q.font="bold 80px sans-serif",Q.shadowColor=$e?"rgba(0,0,0,0.8)":"rgba(255,255,255,0.8)",Q.shadowBlur=4,Q.shadowOffsetX=2,Q.shadowOffsetY=2;const uo=1988,qs=1476,zi=90;Q.fillText("Online",uo,qs),Q.fillText("Jiangtherapee",uo,qs-zi),Q.restore();const zo=document.createElement("a");zo.download=`ptc_complete_${d}_${Date.now()}.jpg`,zo.href=je.toDataURL("image/jpeg",.9),zo.click()},[mt,Jt,v,_,A,D,W,jr,we,Je,Qe,h,s,d,G,i,Ot,it,Qt,Ht,vt,J,Se,te,Fe,Ae,Tt,O,cr,Yt,zt,N,ne]),ke=j.useMemo(()=>{let oe=mt;if(h&&(oe=oe.filter($e=>$e.y>0&&$e.x>0)),y==="top3"){const $e=[...oe].sort((ot,wt)=>wt.x-ot.x),Ke=Math.max(50,Math.ceil($e.length*.03));oe=$e.slice(0,Ke)}const me={R:[],G1:[],G2:[],B:[]};if(oe.forEach($e=>{me[$e.channel]&&me[$e.channel].push($e)}),y==="raw")return me;const je=y==="top3"?500:Poe,Q=$e=>{if($e.length<=je)return $e;const Ke=[...$e].sort((Rt,yt)=>Rt.x-yt.x),ot=[],wt=Ke.length/je;for(let Rt=0;Rt<je;Rt++){const yt=Math.floor(Rt*wt),ir=Math.floor((Rt+1)*wt),dr=Ke.slice(yt,ir);if(dr.length===0)continue;dr.sort((Fr,Ne)=>Fr.y-Ne.y);const Cr=Math.floor(dr.length/2);ot.push(dr[Cr])}return ot};return{R:Q(me.R),G1:Q(me.G1),G2:Q(me.G2),B:Q(me.B)}},[mt,y,h]),Pe=j.useMemo(()=>{if(Gt.length<5)return[];const oe=Gt.filter(je=>je.channel===Jt);return[...oe.length>20?oe:Gt].sort((je,Q)=>je.x-Q.x).map(je=>({mean:je.x,std:je.std}))},[Gt,Jt]),jt=oe=>{const me=oe.length;if(me===0)return[];const je=oe.reduce((Lt,et)=>Lt+et,0)/me,Q=oe.reduce((Lt,et)=>Lt+Math.pow(et-je,2),0)/(me-1||1),$e=Math.sqrt(Q);if($e===0)return[{x:je-.001,density:0},{x:je,density:1},{x:je+.001,density:0}];const Ke=1.06*$e*Math.pow(me,-.2),ot=Math.min(...oe),wt=Math.max(...oe),Rt=(wt-ot)*.2||ot*.1,yt=Math.max(0,ot-Rt),ir=wt+Rt,dr=100,Cr=(ir-yt)/(dr-1),Fr=Lt=>1/Math.sqrt(2*Math.PI)*Math.exp(-.5*Lt*Lt),Ne=[];for(let Lt=0;Lt<dr;Lt++){const et=yt+Lt*Cr;let Mr=0;for(let vr=0;vr<me;vr++)Mr+=Fr((et-oe[vr])/Ke);Mr/=me*Ke,Ne.push({x:et,density:Mr})}return Ne},Be=j.useCallback((oe,me,je,Q)=>{if(oe.length<5)return{gain:0,prnu:0};const $e=oe[oe.length-1].mean,Ke=$e*(je.min/100),ot=$e*(je.max/100),wt=oe.filter(mr=>mr.mean>=Ke&&mr.mean<=ot);if(wt.length<5)return{gain:0,prnu:0};tt({nPoints:wt.length});const Rt=me*me,yt=[],ir=[];if(wt.forEach(mr=>{const Gn=mr.std*mr.std-Rt;if(mr.mean>1&&Gn>0){const Fi=mr.mean,Gi=Gn/mr.mean;yt.push({x:Fi,y:Gi}),ir.push(mr.mean/Gn)}}),yt.length<5)return{gain:0,prnu:0};const dr=[],Cr=yt.length,Fr=Q,Ne=Cr*(Cr-1)/2;if(Ne<=Fr)for(let mr=0;mr<Cr;mr++)for(let Jr=mr+1;Jr<Cr;Jr++){const Gn=yt[Jr].x-yt[mr].x;Math.abs(Gn)>1e-5&&dr.push((yt[Jr].y-yt[mr].y)/Gn)}else{const mr=Math.max(1,Math.floor(Ne/Fr));for(let Jr=0;Jr<Cr;Jr++)for(let Gn=Jr+1;Gn<Cr;Gn+=mr){const Fi=yt[Gn].x-yt[Jr].x;Math.abs(Fi)>1e-5&&dr.push((yt[Gn].y-yt[Jr].y)/Fi)}}const Lt=Wx(dr),et=yt.map(mr=>mr.y-Lt*mr.x),Mr=Wx(et);let vr=0,wn=0;if(Mr>1e-6?vr=1/Mr:vr=Wx(ir),Lt>0&&(wn=Math.sqrt(Lt)*100),ir.length>0){const mr=jt(ir);De(mr),st(vr)}else De([]);return{gain:vr,prnu:wn}},[]),nt=j.useCallback(oe=>{let me=oe.read??Vt.current.readNoise;const je=oe.gRange??gr.current,Q=Zt.current;if((oe.read!==void 0||oe.gRange!==void 0)&&oe.gain===void 0&&oe.prnu===void 0&&Pe.length>0&&me>=0)w(!0),setTimeout(()=>{const Ke=Be(Pe,me,je,Q);let ot=Vt.current.gain,wt=Vt.current.prnu;Ke.gain>0&&(ot=Ke.gain,wt=Ke.prnu),rt({readNoise:me,gain:ot,prnu:wt}),oe.gRange!==void 0&&Sr(oe.gRange),rr(Rt=>{var yt,ir;return{...Rt,read:me.toString(),gain:ot>0?ot.toFixed(3):"0",prnu:wt.toFixed(2),rangeMin:(((yt=oe.gRange)==null?void 0:yt.min)??Rt.rangeMin).toString(),rangeMax:(((ir=oe.gRange)==null?void 0:ir.max)??Rt.rangeMax).toString()}}),w(!1)},50);else{let Ke=oe.gain!==void 0?oe.gain:Vt.current.gain,ot=oe.prnu!==void 0?oe.prnu:Vt.current.prnu;rt({readNoise:me,gain:Ke,prnu:ot}),oe.gRange!==void 0&&Sr(oe.gRange),rr(wt=>{var Rt,yt;return{...wt,read:me.toString(),gain:Ke>0?Ke.toFixed(3):"0",prnu:ot.toFixed(2),rangeMin:(((Rt=oe.gRange)==null?void 0:Rt.min)??wt.rangeMin).toString(),rangeMax:(((yt=oe.gRange)==null?void 0:yt.max)??wt.rangeMax).toString()}})}},[Pe,Be]),Ue=`${z}-${r.length}`;j.useEffect(()=>{if(!e||!r||r.length===0)return;const oe=ke[Jt];if(!oe||oe.length===0||_t===Ue)return;M({R:Jt==="R",G1:Jt==="G1",G2:Jt==="G2",B:Jt==="B"});const me=[...oe].sort((Ke,ot)=>Ke.x-ot.x);let je=0;me.length>0&&(je=me[0].std);const Q=Gt.filter(Ke=>Ke.channel===Jt);let $e=-1/0;for(const Ke of Q)Ke.x>$e&&($e=Ke.x);$e!==-1/0&&pe($e),nt({read:je}),Xe(Ue)},[e,r,_t,Ue,ke,Jt,nt,Gt]);const er=(oe,me)=>{rr(je=>({...je,[oe]:me}))},Tr=oe=>{let me=parseFloat(zt[oe]);isNaN(me)||me<0||nt({[oe]:me})},Rr=()=>{V(B),Xe("")},Ut=()=>{const oe=parseFloat(zt.rangeMin),me=parseFloat(zt.rangeMax);!isNaN(oe)&&!isNaN(me)&&oe<me&&oe>=0&&me<=100&&nt({gRange:{min:oe,max:me}})},rn=(oe,me)=>{oe.key==="Enter"&&(me==="rangeMin"||me==="rangeMax"?Ut():Tr(me),oe.target.blur())};j.useEffect(()=>{e&&Pe.length>0&&nt({})},[e,Kt,Pe]);const ln=oe=>{M(me=>({...me,[oe]:!me[oe]}))},On=()=>{m(oe=>oe==="top3"?"default":"top3")},ur=()=>{y==="raw"?m("default"):k(!0)},Wt=()=>{k(!1),m("raw")},ar=(oe,me)=>{const je=parseFloat(oe),Q=parseFloat(me);let $e=isNaN(je)?"auto":je,Ke=isNaN(Q)?"auto":Q;return h&&typeof $e=="number"&&$e<=0&&($e="auto"),[$e,Ke]},We=oe=>{if(!oe||!oe.payload)return;const me=oe.payload;if(b(me),Ct.current&&(pe(me.x),q(!1)),ut.current){const je=gr.current.min,Q=gr.current.max,{max:$e}=Pr();if($e<=0)return;const Ke=Math.max(0,Math.min(100,me.x/$e*100));if(dt.current===1){const ot=Math.min(Ke,Q-.5);nt({gRange:{min:ot,max:Q}}),ce(2)}else if(dt.current===2){const ot=Math.max(Ke,je+.5);nt({gRange:{min:je,max:ot}}),ce(0),Z(!1)}}},$t=j.useCallback(oe=>{const{cx:me,cy:je,fill:Q}=oe;return c.jsx("circle",{cx:me,cy:je,r:3,fill:Q,stroke:"none",style:{cursor:"pointer"}})},[]),Nr=({active:oe,payload:me})=>{if(oe&&me&&me.length){const je=me[0].payload;return c.jsxs("div",{className:"bg-slate-800 text-white text-xs p-2 rounded border border-slate-600 shadow-xl opacity-90 font-mono z-50",children:[c.jsx("div",{className:"font-bold border-b border-slate-600 pb-1 mb-1",children:je.channel}),c.jsxs("div",{children:["Signal: ",je.x.toFixed(2)]}),c.jsxs("div",{children:[d,": ",je.y.toFixed(4)]}),je.row!==void 0&&je.col!==void 0&&!isNaN(je.row)&&!isNaN(je.col)&&c.jsxs("div",{className:"text-cyan-400 mt-0.5",children:["Loc: Row ",je.row,", Col ",je.col]}),je.filename&&c.jsx("div",{className:"text-gray-400 mt-1 max-w-[200px] truncate",title:je.filename,children:je.filename})]})}return null},cn=oe=>{f(oe),oe==="Linear"&&p(!1)};if(!e)return null;const ea=s==="dark"?"#ffffff":"#000000";let vn=d;d==="Linear"&&(vn="(Var - RN) / Mean");const ja=B!==z;return c.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in",onClick:oe=>{oe.stopPropagation()},children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-[98vw] max-w-[2200px] h-[95vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700 overflow-hidden relative",onClick:oe=>oe.stopPropagation(),children:[c.jsx(As,{isOpen:g,onClose:()=>k(!1),onConfirm:Wt,title:"Warning: High Performance Cost",message:"Displaying all data points may cause the browser to freeze or become unresponsive, especially with large datasets. Are you sure you want to continue?",confirmText:"Yes, Show All"}),x&&c.jsxs("div",{className:"absolute top-20 right-8 z-30 bg-white/90 dark:bg-slate-800/90 border border-cyan-500 rounded-xl p-4 shadow-xl backdrop-blur-md max-w-xs animate-in fade-in zoom-in-95 duration-200",children:[c.jsxs("div",{className:"flex justify-between items-start mb-2 border-b border-gray-200 dark:border-slate-700 pb-2",children:[c.jsx("h4",{className:"font-bold text-gray-900 dark:text-white text-sm",children:"Selected Point"}),c.jsx("button",{onClick:()=>b(null),className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"space-y-1 text-xs font-mono text-gray-700 dark:text-slate-300",children:c.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5",children:[c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Channel:"}),c.jsx("span",{className:"font-bold",children:x.channel}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Signal (DN):"}),c.jsx("span",{children:x.x.toFixed(4)}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"Noise (Std):"}),c.jsx("span",{children:x.std.toFixed(4)}),c.jsx("span",{className:"text-gray-500 dark:text-slate-500",children:"SNR:"}),c.jsx("span",{className:"text-purple-600 dark:text-purple-400 font-bold",children:(x.x/x.std).toFixed(2)})]})})]}),ee&&c.jsx("div",{className:"absolute inset-0 z-40 bg-white/95 dark:bg-slate-900/95 backdrop-blur-sm flex flex-col items-center justify-center p-8 animate-in fade-in zoom-in-95 duration-200",children:c.jsxs("div",{className:"w-full max-w-2xl h-[60vh] bg-gray-50 dark:bg-slate-800 rounded-xl border border-gray-200 dark:border-slate-700 shadow-2xl p-4 flex flex-col relative",children:[c.jsx("button",{onClick:()=>ve(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),c.jsxs("div",{className:"mb-4 text-center",children:[c.jsx("h3",{className:"text-lg font-bold text-gray-800 dark:text-slate-200",children:"Gain Density Estimation"}),c.jsxs("p",{className:"text-xs text-gray-500 dark:text-slate-400",children:["HSM Mode: ",c.jsx("span",{className:"text-cyan-600 dark:text-cyan-400 font-bold",children:Ye==null?void 0:Ye.toFixed(4)}),c.jsx("span",{className:"mx-2",children:"|"}),"Data Points: ",de.length>0?"Density Curve Generated":"No Data"]})]}),c.jsx("div",{className:"flex-1 min-h-0",children:de.length>0?c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(DO,{data:de,margin:{top:10,right:30,left:0,bottom:20},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3,vertical:!1}),c.jsx(ba,{dataKey:"x",tickFormatter:oe=>oe.toFixed(2),tick:{fill:"#9ca3af",fontSize:10},label:{value:"Gain (e/ADU)",position:"insideBottom",offset:-15,fill:"#9ca3af",fontSize:12}}),c.jsx(va,{tick:{fill:"#9ca3af",fontSize:10}}),c.jsx(Rn,{cursor:{stroke:"rgba(255,255,255,0.2)"},contentStyle:{backgroundColor:"#1f2937",border:"1px solid #374151",borderRadius:"0.5rem",color:"#f3f4f6"}}),c.jsx(di,{type:"monotone",dataKey:"density",stroke:"#0ea5e9",fill:"#0ea5e9",fillOpacity:.3,strokeWidth:2}),Ye!==null&&c.jsx(vs,{x:Ye,stroke:"#ef4444",strokeWidth:2,label:{value:"HSM",fill:"#ef4444",fontSize:10,position:"top"}})]})}):c.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:"No data in selected range"})})]})}),c.jsxs("div",{className:"flex flex-wrap justify-between items-center p-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50 gap-4 flex-shrink-0",children:[c.jsxs("h2",{className:"text-lg font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2",children:["Photon Transfer Curve",c.jsxs("span",{className:"text-xs font-normal bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-300 px-2 py-0.5 rounded border border-purple-200 dark:border-purple-800",children:[r.length," Pts"]})]}),c.jsxs("div",{className:"flex gap-4 items-center flex-wrap",children:[c.jsxs("button",{onClick:L,className:"bg-green-600 hover:bg-green-500 text-white font-bold py-1 px-3 rounded text-xs shadow-md transition-all active:scale-95 flex items-center gap-1",title:"Render all points, target lines, and metadata to a high-res JPG",children:[c.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export Complete Result"]}),c.jsxs("div",{className:"flex bg-white dark:bg-slate-700 rounded-lg p-1 border border-gray-200 dark:border-slate-600",children:[c.jsx("button",{onClick:()=>cn("Noise"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="Noise"?"bg-cyan-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"Noise ()"}),c.jsx("button",{onClick:()=>cn("SNR"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="SNR"?"bg-purple-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"SNR"}),c.jsx("button",{onClick:()=>cn("Linear"),className:`px-3 py-1 text-xs font-bold rounded transition-colors ${d==="Linear"?"bg-indigo-600 text-white shadow":"text-gray-600 dark:text-slate-300 hover:bg-gray-100 dark:hover:bg-slate-600"}`,children:"Linear (PTC)"})]}),c.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-600 dark:text-slate-300 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:h,onChange:oe=>p(oe.target.checked),className:"rounded border-gray-300 text-cyan-600 focus:ring-cyan-500 bg-gray-100 dark:bg-slate-700 dark:border-slate-600"}),"Log-Log"]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors p-1",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-0 border-b border-gray-200 dark:border-slate-700 bg-white dark:bg-slate-900 text-sm flex-shrink-0",children:[c.jsxs("div",{className:"lg:col-span-9 p-5 flex flex-col gap-5 border-r border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"flex flex-wrap gap-4 items-center justify-between text-xs",children:[c.jsxs("div",{className:"flex gap-4 items-center",children:[c.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-50 dark:bg-slate-800 rounded-md p-1 border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400 pl-1",children:"X:"}),c.jsx("input",{type:"number",placeholder:"Min",value:_,onChange:oe=>P(oe.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",placeholder:"Max",value:A,onChange:oe=>R(oe.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"})]}),c.jsxs("div",{className:"flex items-center gap-1.5 bg-gray-50 dark:bg-slate-800 rounded-md p-1 border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400 pl-1",children:"Y:"}),c.jsx("input",{type:"number",placeholder:"Min",value:D,onChange:oe=>E(oe.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",placeholder:"Max",value:W,onChange:oe=>F(oe.target.value),className:"w-12 px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded text-center outline-none"})]}),c.jsx("button",{onClick:()=>{P(""),R(""),E(""),F("")},className:"text-xs text-cyan-600 dark:text-cyan-400 hover:underline",children:"Auto"})]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white dark:bg-slate-700 p-1 rounded-lg border border-gray-200 dark:border-slate-600",children:[c.jsx("button",{onClick:()=>ln("R"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.R?"bg-red-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"R"}),c.jsx("button",{onClick:()=>ln("G1"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.G1?"bg-green-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"G1"}),c.jsx("button",{onClick:()=>ln("G2"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.G2?"bg-green-400 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"G2"}),c.jsx("button",{onClick:()=>ln("B"),className:`w-6 h-6 text-[10px] font-bold rounded flex items-center justify-center transition-colors ${v.B?"bg-blue-500 text-white":"bg-gray-100 dark:bg-slate-600 text-gray-400"}`,children:"B"})]})]}),c.jsxs("div",{className:"flex flex-wrap items-end gap-8",children:[c.jsxs("div",{className:"flex flex-col bg-gray-50 dark:bg-slate-800/50 p-2 rounded border border-gray-100 dark:border-slate-700",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-gray-500 dark:text-slate-400 mb-1",children:"Black Level (0,0 0,1 1,0 1,1)"}),c.jsx("input",{type:"text",value:B,onChange:oe=>I(oe.target.value),className:"w-32 text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-cyan-500 font-mono",placeholder:"0 0 0 0"})]}),c.jsxs("div",{className:"flex flex-col justify-between bg-gray-50 dark:bg-slate-800/50 p-2 rounded border border-gray-100 dark:border-slate-700",children:[c.jsxs("div",{className:"flex justify-between items-center mb-1",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-gray-500 dark:text-slate-400 mr-2",children:"Fit Range % (Robust)"}),c.jsx("button",{onClick:()=>{Z(!J),ce(J?0:1)},className:`px-1.5 py-0.5 text-[9px] rounded border transition-colors ${J?"bg-cyan-100 text-cyan-700 border-cyan-300 animate-pulse":"bg-white dark:bg-slate-700 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300 hover:bg-gray-50"}`,children:J?ae===1?"Pick Min":"Pick Max":"Select"})]}),c.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[c.jsx("input",{type:"number",step:"0.1",value:zt.rangeMin,onChange:oe=>er("rangeMin",oe.target.value),onBlur:Ut,onKeyDown:oe=>rn(oe,"rangeMin"),className:"w-10 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-0.5 text-center font-bold"}),c.jsx("span",{className:"text-gray-400",children:"-"}),c.jsx("input",{type:"number",step:"0.1",value:zt.rangeMax,onChange:oe=>er("rangeMax",oe.target.value),onBlur:Ut,onKeyDown:oe=>rn(oe,"rangeMax"),className:"w-10 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-0.5 text-center font-bold"})]})]}),c.jsxs("div",{className:"flex flex-col bg-indigo-50 dark:bg-indigo-900/20 p-2 rounded border border-indigo-100 dark:border-indigo-800/50",children:[c.jsx("span",{className:"text-[9px] uppercase font-bold text-indigo-600 dark:text-indigo-400 mb-1",children:"DR Params"}),c.jsxs("div",{className:"flex items-center gap-3",children:[c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-300",children:"Img H:"}),c.jsx("input",{type:"number",value:N,onChange:oe=>C(oe.target.value),onKeyDown:nr,placeholder:"Empty",className:"w-14 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-200 dark:border-indigo-800 rounded text-center font-bold text-indigo-700 dark:text-indigo-300 text-xs placeholder:font-normal placeholder:text-gray-300"})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-indigo-500 dark:text-indigo-300",children:"Tgt SNR:"}),c.jsx("input",{type:"number",value:O,onChange:oe=>$(oe.target.value),className:"w-10 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-200 dark:border-indigo-800 rounded text-center font-bold text-indigo-700 dark:text-indigo-300 text-xs"})]})]})]}),c.jsxs("div",{className:"flex flex-col gap-1 text-[10px] justify-end pb-0.5",children:[c.jsx("button",{onClick:()=>{q(!K),G&&pe(null)},disabled:J,className:`font-bold rounded border shadow-sm transition-all px-3 py-1.5 ${K?"bg-amber-100 dark:bg-amber-900/30 text-amber-700 dark:text-amber-400 border-amber-500 animate-pulse":"bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border-gray-300 dark:border-slate-600 hover:bg-gray-50 dark:hover:bg-slate-700"}`,children:K?"Pick Point":"Select Linear Limit"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("button",{onClick:On,className:`flex-1 font-bold rounded border shadow-sm transition-all px-2 py-1 ${y==="top3"?"bg-indigo-600 text-white border-indigo-700":"bg-white dark:bg-slate-800 text-gray-600 dark:text-slate-300 border-gray-300 dark:border-slate-600 hover:bg-gray-50"}`,children:"Top 3%"}),c.jsx("button",{onClick:ur,className:`font-bold rounded border shadow-sm transition-all px-2 py-1 ${y==="raw"?"bg-red-600 text-white border-red-700":"text-red-500 border-red-200 hover:bg-red-50"}`,children:"All"})]})]})]}),c.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-gray-50/50 dark:bg-slate-800/20 p-2 rounded-lg border border-gray-100 dark:border-slate-800",children:[c.jsx("span",{className:"text-[10px] uppercase font-bold text-gray-400 dark:text-slate-500",children:"Metadata"}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"text",value:Se,onChange:oe=>Ie(oe.target.value),placeholder:"Tester Name",className:"w-24 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"}),c.jsx("input",{type:"text",value:te,onChange:oe=>Oe(oe.target.value),placeholder:"Camera Model",className:"w-32 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"}),c.jsx("input",{type:"text",value:Fe,onChange:oe=>bt(oe.target.value),placeholder:"ISO",className:"w-16 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 text-gray-700 dark:text-slate-300 outline-none focus:border-cyan-500 transition-colors"})]})]}),c.jsxs("div",{className:"flex flex-wrap gap-4 items-center bg-fuchsia-50/50 dark:bg-fuchsia-900/10 p-2 rounded-lg border border-fuchsia-100 dark:border-fuchsia-900/30",children:[c.jsx("span",{className:"text-[10px] uppercase font-bold text-fuchsia-500 dark:text-fuchsia-400",children:"Markers"}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("input",{type:"number",value:se,onChange:oe=>he(oe.target.value),placeholder:"X (Signal)",className:"w-20 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 outline-none focus:border-fuchsia-500 transition-colors"}),c.jsx("input",{type:"number",value:ue,onChange:oe=>ie(oe.target.value),placeholder:"Y (Value)",className:"w-20 text-xs bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-2 py-1 outline-none focus:border-fuchsia-500 transition-colors"}),c.jsx("button",{onClick:xe,className:"px-3 py-1 bg-fuchsia-600 hover:bg-fuchsia-500 text-white text-xs font-bold rounded shadow-sm transition-colors active:scale-95",children:"+"}),ne.length>0&&c.jsx("button",{onClick:()=>le([]),className:"px-2 py-1 bg-gray-200 dark:bg-slate-700 hover:bg-red-500 hover:text-white text-gray-600 dark:text-slate-300 text-xs font-bold rounded shadow-sm transition-colors active:scale-95",children:"Clr"})]}),c.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono",children:[ne.length," pts"]})]}),c.jsxs("div",{className:"flex gap-4 text-[10px] pt-1 justify-center sm:justify-start flex-wrap",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Ot.shot,onChange:oe=>_e({...Ot,shot:oe.target.checked}),className:"rounded text-gray-500"})," ",c.jsx("span",{className:"text-gray-500",children:"Shot Noise"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Ot.read,onChange:oe=>_e({...Ot,read:oe.target.checked}),className:"rounded text-rose-500"})," ",c.jsx("span",{className:"text-rose-500",children:"Read Noise"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Ot.prnu,onChange:oe=>_e({...Ot,prnu:oe.target.checked}),className:"rounded text-amber-500"})," ",c.jsx("span",{className:"text-amber-500",children:"PRNU"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",children:[c.jsx("input",{type:"checkbox",checked:Ot.total,onChange:oe=>_e({...Ot,total:oe.target.checked}),className:"rounded text-white"})," ",c.jsx("span",{className:"text-gray-900 dark:text-white font-bold",children:"Model"})]})]})]}),c.jsxs("div",{className:"lg:col-span-3 bg-slate-100 dark:bg-slate-800 p-4 flex flex-col justify-center gap-4",children:[c.jsxs("div",{children:[c.jsxs("div",{className:"flex justify-between items-center mb-1 px-1",children:[c.jsxs("h3",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase flex items-center gap-2",children:["Fit Parameters (D55 SAT Channel:",Jt,")",S&&c.jsx("span",{className:"text-orange-500 animate-pulse text-[10px]",children:"Calculating..."})]}),c.jsxs("div",{className:"flex gap-2 items-center",children:[c.jsx("button",{onClick:Rr,disabled:S,className:`px-3 py-1 text-white text-[10px] font-bold rounded shadow-sm transition-all flex items-center gap-1 active:scale-95 
                                            ${S?"bg-gray-400 cursor-wait":ja?"bg-orange-500 hover:bg-orange-600 animate-pulse ring-2 ring-orange-400/50":"bg-cyan-600 hover:bg-cyan-500"}
                                        `,title:"Apply Black Level, Auto-detect Read Noise, then Recalculate Fit",children:S?c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-3 h-3 animate-spin",viewBox:"0 0 24 24",fill:"none",children:[c.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),c.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"})]}),"Fitting..."]}):c.jsxs(c.Fragment,{children:[c.jsxs("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})]}),"Apply & Calc"]})}),c.jsxs("select",{value:Kt,onChange:oe=>lr(Number(oe.target.value)),className:"text-[9px] bg-slate-200 dark:bg-slate-700 text-gray-600 dark:text-slate-300 rounded px-1 py-0.5 border-none outline-none cursor-pointer hover:bg-slate-300 dark:hover:bg-slate-600 transition-colors",title:"Number of point-pairs to sample for robust regression (Theil-Sen)",children:[c.jsx("option",{value:1e5,children:"100k Pairs"}),c.jsx("option",{value:5e5,children:"500k Pairs"}),c.jsx("option",{value:2e6,children:"2M Pairs"}),c.jsx("option",{value:5e6,children:"5M Pairs"}),c.jsx("option",{value:1e7,children:"10M Pairs"})]}),ht&&c.jsxs("span",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono",title:"Number of points used in regression",children:["N=",ht.nPoints]})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1",children:"rn/fpn"}),c.jsx("input",{type:"text",inputMode:"decimal",value:zt.read,onChange:oe=>er("read",oe.target.value),onBlur:()=>Tr("read"),onKeyDown:oe=>rn(oe,"read"),className:"w-full text-center text-2xl font-light bg-transparent text-rose-500 outline-none border-b border-transparent focus:border-rose-500 transition-colors"})]}),c.jsxs("div",{className:"flex flex-col items-center relative group",children:[c.jsxs("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1 flex items-center gap-1",children:["Kadc (HSM)",c.jsx("button",{onClick:()=>ve(!0),className:"text-[9px] text-cyan-600 dark:text-cyan-400 hover:underline",children:"Dist."})]}),c.jsx("input",{type:"text",inputMode:"decimal",value:zt.gain,onChange:oe=>er("gain",oe.target.value),onBlur:()=>Tr("gain"),onKeyDown:oe=>rn(oe,"gain"),className:"w-full text-center text-2xl font-light bg-transparent text-slate-700 dark:text-slate-200 outline-none border-b border-transparent focus:border-cyan-500 transition-colors"})]}),c.jsxs("div",{className:"flex flex-col items-center",children:[c.jsx("label",{className:"text-[10px] text-gray-500 dark:text-slate-400 uppercase tracking-wide mb-1",children:"PRNU (%)"}),c.jsx("input",{type:"text",inputMode:"decimal",value:zt.prnu,onChange:oe=>er("prnu",oe.target.value),onBlur:()=>Tr("prnu"),onKeyDown:oe=>rn(oe,"prnu"),className:"w-full text-center text-2xl font-light bg-transparent text-amber-500 outline-none border-b border-transparent focus:border-amber-500 transition-colors"})]})]})]}),c.jsx("div",{className:"h-px bg-gray-200 dark:bg-slate-700 w-full"}),c.jsxs("div",{className:"grid grid-cols-2 gap-2 text-center",children:[c.jsxs("div",{className:"flex flex-col justify-center bg-cyan-50 dark:bg-cyan-900/10 p-2 rounded-lg border border-cyan-100 dark:border-cyan-900/30",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-500 uppercase tracking-wide mb-1 truncate",title:`Manual DR at SNR=${(Ae==null?void 0:Ae.manualTarget)||O}`,children:["M.DR @ SNR=",(Ae==null?void 0:Ae.manualTarget)||O]}),c.jsx("div",{className:"text-base font-bold text-cyan-700 dark:text-cyan-400 whitespace-nowrap",children:Ae!=null&&Ae.manualDR?`${Ae.manualDR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-emerald-50 dark:bg-emerald-900/10 p-2 rounded-lg border border-emerald-100 dark:border-emerald-900/30",title:isNaN((Ae==null?void 0:Ae.ptpTarget)||NaN)?"Requires Image Height":`Standard Point-to-Point DR (Target SNR = 16000/${N||"H"})`,children:[c.jsx("h4",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-500 uppercase tracking-wide mb-1",children:"PTP DR"}),c.jsx("div",{className:"text-base font-bold text-emerald-700 dark:text-emerald-400 whitespace-nowrap",children:Ae!=null&&Ae.ptpDR?`${Ae.ptpDR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-purple-50 dark:bg-purple-900/10 p-2 rounded-lg border border-purple-100 dark:border-purple-900/30",title:isNaN((Ae==null?void 0:Ae.ptpTarget)||NaN)?"Requires Image Height":`D55 Saturation DR (Target SNR = 16000/${N||"H"} on ${Ae==null?void 0:Ae.dominantChannel} Channel)`,children:[c.jsxs("h4",{className:"text-[10px] font-bold text-purple-600 dark:text-purple-400 uppercase tracking-wide mb-1 truncate",children:["D55 DR (",Ae==null?void 0:Ae.dominantChannel,")"]}),c.jsx("div",{className:"text-base font-bold text-purple-700 dark:text-purple-400 whitespace-nowrap",children:Ae!=null&&Ae.d55DR?`${Ae.d55DR.toFixed(2)} EV`:"--"})]}),c.jsxs("div",{className:"flex flex-col justify-center bg-orange-50 dark:bg-orange-900/10 p-2 rounded-lg border border-orange-100 dark:border-orange-900/30",children:[c.jsx("h4",{className:"text-[10px] font-bold text-orange-600 dark:text-orange-400 uppercase tracking-wide mb-1",children:"FWC"}),c.jsx("div",{className:"text-base font-bold text-orange-600 dark:text-orange-400 font-mono whitespace-nowrap truncate",title:Tt!==null?`${Math.round(Tt)}`:"",children:Tt!==null?Tt>1e4?`${(Tt/1e3).toFixed(1)}k`:`${Math.round(Tt)}`:"--"})]})]}),G===null&&c.jsx("div",{className:"text-center text-[10px] text-red-500 animate-pulse font-bold mt-[-10px]",children:"Please select Linear Limit on chart to calc DR"})]})]}),c.jsxs("div",{className:`flex-1 p-4 bg-white dark:bg-slate-900 relative grid grid-cols-[auto_1fr] grid-rows-[1fr_auto] gap-2 ${K||J?"cursor-crosshair":""}`,children:[c.jsx("div",{className:"row-start-1 col-start-1 h-full",children:c.jsx(W4,{vertical:!0,min:Je,max:Qe,value:[D?parseFloat(D):Je,W?parseFloat(W):Qe],onChange:([oe,me])=>{E(oe.toString()),F(me.toString())},logScale:h})}),c.jsxs("div",{className:"row-start-1 col-start-2 relative",children:[mt.length===0?c.jsx("div",{className:"flex h-full items-center justify-center text-gray-400",children:"No valid data points found."}):c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(foe,{margin:{top:20,right:20,bottom:0,left:0},onClick:We,children:[c.jsx("defs",{children:c.jsxs("filter",{id:"glow",height:"300%",width:"300%",x:"-100%",y:"-100%",children:[c.jsx("feGaussianBlur",{stdDeviation:"2",result:"coloredBlur"}),c.jsxs("feMerge",{children:[c.jsx("feMergeNode",{in:"coloredBlur"}),c.jsx("feMergeNode",{in:"SourceGraphic"})]})]})}),c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.2}),c.jsx(ba,{type:"number",dataKey:"x",name:"Signal",scale:h?"log":"linear",domain:ar(_,A),allowDataOverflow:!0,hide:!0}),c.jsx(va,{type:"number",dataKey:"y",name:d,scale:h?"log":"linear",domain:ar(D,W),label:{value:vn,angle:-90,position:"insideLeft",fill:"#9ca3af",fontSize:12},tick:{fill:"#9ca3af",fontSize:10},allowDataOverflow:!0}),c.jsx(Rn,{content:c.jsx(Nr,{}),cursor:{strokeDasharray:"3 3"}}),G&&c.jsx(vs,{x:G,stroke:"red",strokeDasharray:"3 3",label:{position:"top",value:"Sat",fill:"red",fontSize:10}}),(Ot.fitRange||J)&&c.jsxs(c.Fragment,{children:[c.jsx(vs,{x:Qt,stroke:"#22d3ee",strokeDasharray:"5 5",label:{position:"insideTopLeft",value:`Min: ${vt.min}%`,fill:"#22d3ee",fontSize:9}}),c.jsx(vs,{x:Ht,stroke:"#22d3ee",strokeDasharray:"5 5",label:{position:"insideTopLeft",value:`Max: ${vt.max}%`,fill:"#22d3ee",fontSize:9}})]}),v.R&&c.jsx(ga,{name:"Red",data:ke.R,fill:"#ef4444",shape:$t,onClick:We,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-R"),v.G1&&c.jsx(ga,{name:"Green 1",data:ke.G1,fill:"#22c55e",shape:$t,onClick:We,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-G1"),v.G2&&c.jsx(ga,{name:"Green 2",data:ke.G2,fill:"#4ade80",shape:$t,onClick:We,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-G2"),v.B&&c.jsx(ga,{name:"Blue",data:ke.B,fill:"#3b82f6",shape:$t,onClick:We,style:s==="dark"?{filter:"url(#glow)"}:void 0},"scatter-B"),Ot.shot&&it.shot.length>0&&c.jsx(ga,{name:"Shot Noise (Ideal)",data:it.shot,line:{stroke:"#94a3b8",strokeWidth:1,strokeDasharray:"5 5"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-shot"),Ot.read&&it.read.length>0&&c.jsx(ga,{name:"Read Noise Floor",data:it.read,line:{stroke:"#f43f5e",strokeWidth:1,strokeDasharray:"3 3"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-read"),Ot.prnu&&it.prnu.length>0&&c.jsx(ga,{name:"PRNU (Non-uniformity)",data:it.prnu,line:{stroke:"#f59e0b",strokeWidth:1,strokeDasharray:"3 3"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-prnu"),Ot.total&&it.total.length>0&&c.jsx(ga,{name:"Total Noise Model",data:it.total,line:{stroke:ea,strokeWidth:2},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-total"),cr.length>0&&c.jsx(ga,{name:`Target SNR=${O}`,data:cr,line:{stroke:"#6366f1",strokeWidth:2,strokeDasharray:"4 2"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-target"),Yt.length>0&&c.jsx(ga,{name:`PTP Target SNR=${Ae!=null&&Ae.ptpTarget?Ae.ptpTarget.toFixed(1):"?"}`,data:Yt,line:{stroke:"#10b981",strokeWidth:2,strokeDasharray:"4 4"},shape:()=>c.jsx(c.Fragment,{}),legendType:"none",isAnimationActive:!1},"line-ptp"),ne.length>0&&c.jsx(ga,{name:"Manual Markers",data:ne,fill:"#d946ef",shape:"star",legendType:"star"},"manual-points")]})}),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none select-none opacity-25 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-96 h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"36",fontWeight:"bold",style:{fontFamily:"sans-serif",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})})]}),c.jsx("div",{className:"row-start-2 col-start-2 w-full",children:c.jsx(W4,{min:jr,max:we,value:[_?parseFloat(_):jr,A?parseFloat(A):we],onChange:([oe,me])=>{P(oe.toString()),R(me.toString())},logScale:h})})]})]})})},Coe=({searchTerm:e,onSearchChange:t,manufacturers:r,selectedManufacturer:n,onManufacturerChange:a,cameras:i,onCameraSelect:o})=>c.jsx("div",{className:"sticky top-4 z-10 bg-white/80 dark:bg-slate-900/80 backdrop-blur-sm p-4 rounded-xl border border-gray-200 dark:border-slate-700 shadow-sm",children:c.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[c.jsxs("div",{className:"relative md:col-span-3",children:[c.jsx("input",{type:"text",placeholder:"Search camera model...",value:e,onChange:s=>t(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 text-gray-900 dark:text-slate-200 placeholder-gray-500 dark:placeholder-slate-400"}),c.jsx("svg",{className:"w-5 h-5 text-gray-400 dark:text-slate-400 absolute top-1/2 left-3 transform -translate-y-1/2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),c.jsx("select",{value:n,onChange:s=>a(s.target.value),className:"w-full md:col-span-1 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 appearance-none text-gray-900 dark:text-slate-200",children:r.map(s=>c.jsx("option",{value:s,children:s},s))}),c.jsxs("select",{onChange:s=>o(s.target.value),className:"w-full md:col-span-1 bg-gray-50 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-cyan-500 focus:border-cyan-500 outline-none transition-all duration-300 appearance-none text-gray-900 dark:text-slate-200",value:"","aria-label":"Jump to camera model",children:[c.jsx("option",{value:"",disabled:!0,children:"Jump to model..."}),i.map(s=>c.jsx("option",{value:s.id,children:s.name},s.id))]})]})}),Ooe=({active:e,payload:t,label:r,theme:n})=>{if(e&&t&&t.length){const a=t[0].payload,i=n==="dark"?"bg-slate-800/80 border-slate-600 text-slate-300":"bg-white/90 border-gray-200 text-gray-700";return c.jsxs("div",{className:`${i} backdrop-blur-sm border p-3 rounded-lg shadow-lg`,children:[c.jsx("p",{className:"label font-bold",children:`ISO ${r}`}),c.jsx("div",{className:"mt-2 space-y-1 text-sm",children:c.jsxs(c.Fragment,{children:[c.jsxs("div",{style:{color:"#f87171"},children:["Red: ",a.R_avg.toFixed(2)," (Range: ",a.R_range[0]," - ",a.R_range[1],")"]}),c.jsxs("div",{style:{color:"#4ade80"},children:["Green 1: ",a.G1_avg.toFixed(2)," (Range: ",a.G1_range[0]," - ",a.G1_range[1],")"]}),c.jsxs("div",{style:{color:"#60a5fa"},children:["Blue: ",a.B_avg.toFixed(2)," (Range: ",a.B_range[0]," - ",a.B_range[1],")"]}),c.jsxs("div",{style:{color:"#86efac"},children:["Green 2: ",a.G2_avg.toFixed(2)," (Range: ",a.G2_range[0]," - ",a.G2_range[1],")"]})]})})]})}return null},Aoe=({data:e,theme:t="dark"})=>{const r=j.useMemo(()=>!e||e.length===0?[]:[...new Set(e.map(o=>o.iso))].sort((o,s)=>Number(o)-Number(s)),[e]),n=j.useMemo(()=>{if(!e||e.length===0)return[0,4096];const o=e.flatMap(x=>[...x.R_range,...x.G1_range,...x.G2_range,...x.B_range]);if(o.length===0)return[0,4096];let s=Math.min(...o),l=Math.max(...o);const u=.25,d=l-s;if(d<u){const x=u-d;s-=x/2,l+=x/2}const f=(l-s)*.1,h=s-f,p=l+f;return[h,p]},[e]),a=t==="dark"?"#475569":"#e5e7eb",i=t==="dark"?"#94a3b8":"#6b7280";return!e||e.length===0?c.jsx("div",{className:"flex items-center justify-center h-full text-gray-500 dark:text-slate-500",children:c.jsx("p",{children:"No data available for this mode."})}):c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(DO,{data:e,margin:{top:5,right:20,left:0,bottom:5},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:a}),c.jsx(ba,{dataKey:"iso",type:"number",domain:["dataMin","dataMax"],tick:{fill:i,fontSize:12},scale:"log",allowDuplicatedCategory:!1,ticks:r}),c.jsx(va,{tick:{fill:i,fontSize:12},domain:n,allowDecimals:!0,tickFormatter:o=>Number(o).toFixed(3)}),c.jsx(Rn,{content:c.jsx(Ooe,{theme:t})}),c.jsx(Qi,{wrapperStyle:{fontSize:"14px",color:i}}),c.jsx(di,{type:"monotone",dataKey:"R_range",fill:"#f87171",stroke:"none",fillOpacity:.2,name:"Red",legendType:"none"}),c.jsx(Dn,{type:"monotone",dataKey:"R_avg",stroke:"#f87171",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Red"}),c.jsx(di,{type:"monotone",dataKey:"G1_range",fill:"#4ade80",stroke:"none",fillOpacity:.2,name:"Green 1",legendType:"none"}),c.jsx(Dn,{type:"monotone",dataKey:"G1_avg",stroke:"#4ade80",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Green 1"}),c.jsx(di,{type:"monotone",dataKey:"B_range",fill:"#60a5fa",stroke:"none",fillOpacity:.2,name:"Blue",legendType:"none"}),c.jsx(Dn,{type:"monotone",dataKey:"B_avg",stroke:"#60a5fa",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Blue"}),c.jsx(di,{type:"monotone",dataKey:"G2_range",fill:"#86efac",stroke:"none",fillOpacity:.2,name:"Green 2",legendType:"none"}),c.jsx(Dn,{type:"monotone",dataKey:"G2_avg",stroke:"#86efac",strokeWidth:2,dot:!1,activeDot:{r:5},name:"Green 2"})]})})},Toe=re.forwardRef(({camera:e,theme:t="dark"},r)=>{const n=j.useMemo(()=>e.shootingModes.map(f=>f.modeName),[e.shootingModes]),[a,i]=j.useState(n[0]||""),{chartData:o,tableData:s}=j.useMemo(()=>{const f=e.shootingModes.find(x=>x.modeName===a);if(!(f!=null&&f.data))return{chartData:[],tableData:[]};const h=f.data.map(x=>({iso:x.iso,R_range:x.r.range,R_avg:x.r.avg,G1_range:x.g1.range,G1_avg:x.g1.avg,B_range:x.b.range,B_avg:x.b.avg,G2_range:x.g2.range,G2_avg:x.g2.avg})),p=f.data.map(x=>({iso:x.iso,levels:[x.r.avg,x.g1.avg,x.g2.avg,x.b.avg],clipping:x.clipping}));return{chartData:h,tableData:p}},[e.shootingModes,a]),l=`Raw Data (${a})`,u=j.useRef(null),d=j.useRef(null);return j.useEffect(()=>{const f=u.current,h=d.current;if(!f||!h)return;const p=new ResizeObserver(x=>{for(let b of x){const{width:y}=b.contentRect,g=Math.max(8,y/35);h.style.fontSize=`${g}px`}});return p.observe(f),()=>p.disconnect()},[]),c.jsxs("div",{ref:r,className:"bg-white dark:bg-slate-800/50 border border-gray-200 dark:border-slate-700 rounded-xl shadow-lg p-6 flex flex-col gap-6 transform hover:scale-[1.02] hover:border-cyan-500/50 transition-all duration-500 ease-in-out",children:[c.jsxs("div",{className:"border-b border-gray-200 dark:border-slate-700 pb-4",children:[c.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-slate-100",children:e.name}),c.jsx("p",{className:"text-cyan-600 dark:text-cyan-400",children:e.manufacturer})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-4",children:[c.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-slate-300",children:"Black Level vs. ISO"}),c.jsx("select",{value:a,onChange:f=>i(f.target.value),className:"w-full sm:w-auto bg-gray-50 dark:bg-slate-700 border border-gray-300 dark:border-slate-600 rounded-md px-3 py-1 text-sm outline-none focus:ring-2 focus:ring-cyan-500 transition-all duration-300 text-gray-900 dark:text-slate-200","aria-label":`Select shooting mode for ${e.name}`,children:n.map(f=>c.jsx("option",{value:f,children:f},f))})]}),c.jsxs("div",{ref:u,className:"h-64 relative",children:[c.jsx(Aoe,{data:o,theme:t},a),c.jsx("div",{className:"absolute top-1/2 left-[52%] transform -translate-x-1/2 -translate-y-1/2 -rotate-30 pointer-events-none",children:c.jsx("p",{ref:d,className:"font-bold text-gray-900/10 dark:text-slate-200/40 whitespace-nowrap",children:" y-g-jiang.github.io"})})]})]}),c.jsxs("div",{className:"overflow-x-auto",children:[c.jsx("div",{className:"flex justify-between items-center mb-4",children:c.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-slate-300",children:l})}),c.jsxs("table",{className:"w-full text-left border-collapse",children:[c.jsx("thead",{className:"bg-gray-100 dark:bg-slate-700/50",children:c.jsxs("tr",{children:[c.jsx("th",{className:"p-3 font-semibold text-sm text-gray-700 dark:text-slate-300",children:"ISO"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-red-500 dark:text-red-400",children:"Red"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-green-600 dark:text-green-400",children:"Green 1"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-blue-500 dark:text-blue-400",children:"Blue"}),c.jsx("th",{className:"p-3 font-semibold text-sm text-green-500 dark:text-green-300",children:"Green 2"})]})}),c.jsx("tbody",{children:s.map(({iso:f,levels:h,clipping:p})=>c.jsxs("tr",{className:"border-b border-gray-200 dark:border-slate-700/50 last:border-b-0",children:[c.jsxs("td",{className:"p-3 font-mono text-gray-700 dark:text-slate-300 whitespace-nowrap",children:[f,p&&c.jsx("span",{className:"ml-3 text-xs font-semibold text-amber-600 dark:text-amber-400 bg-amber-100 dark:bg-amber-900/50 px-2 py-1 rounded-full align-middle",children:"Clipping"})]}),c.jsx("td",{className:"p-3 font-mono text-red-500 dark:text-red-400",children:h[0].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-green-600 dark:text-green-400",children:h[1].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-blue-500 dark:text-blue-400",children:h[3].toFixed(2)}),c.jsx("td",{className:"p-3 font-mono text-green-500 dark:text-green-300",children:h[2].toFixed(2)})]},f))})]})]})]})}),He=(e,t,r)=>({avg:e,range:[t,r]}),Vx=[{id:"sony-a7r2",name:"Sony ILCE-7RM2 (A7R II)",manufacturer:"Sony",shootingModes:[{modeName:"Still (Mechanical Shutter)",data:[{iso:100,r:He(512.1,511.95,512.25),g1:He(512.05,511.9,512.2),b:He(512.12,511.98,512.28),g2:He(512.06,511.92,512.22)},{iso:200,r:He(512.15,512,512.3),g1:He(512.1,511.95,512.25),b:He(512.18,512.05,512.35),g2:He(512.12,511.98,512.28)},{iso:400,r:He(512.25,512.1,512.45),g1:He(512.2,512.05,512.4),b:He(512.3,512.15,512.5),g2:He(512.22,512.08,512.42)},{iso:800,r:He(512.5,512.2,512.8),g1:He(512.45,512.15,512.75),b:He(512.55,512.25,512.85),g2:He(512.48,512.18,512.78)},{iso:1600,r:He(513.1,512.8,513.4),g1:He(513.05,512.75,513.35),b:He(513.15,512.85,513.45),g2:He(513.08,512.78,513.38)}]}]},{id:"sony-a7c",name:"Sony ILCE-7C",manufacturer:"Sony",shootingModes:[{modeName:"Still (Mechanical)",data:[{iso:100,r:He(512.02,511.98,512.05),g1:He(512.01,511.97,512.04),b:He(512.03,511.99,512.06),g2:He(512.01,511.97,512.04)},{iso:640,r:He(512.15,512.05,512.25),g1:He(512.12,512.02,512.22),b:He(512.18,512.08,512.28),g2:He(512.13,512.03,512.23)}]}]},{id:"canon-r5",name:"Canon EOS R5",manufacturer:"Canon",shootingModes:[{modeName:"Mechanical Shutter",data:[{iso:100,r:He(512,511.8,512.2),g1:He(512,511.8,512.2),b:He(512,511.8,512.2),g2:He(512,511.8,512.2)},{iso:400,r:He(512,511.7,512.3),g1:He(512,511.7,512.3),b:He(512,511.7,512.3),g2:He(512,511.7,512.3)},{iso:1600,r:He(512.2,511.5,512.8),g1:He(512.2,511.5,512.8),b:He(512.2,511.5,512.8),g2:He(512.2,511.5,512.8)}]}]},{id:"canon-r6",name:"Canon EOS R6",manufacturer:"Canon",shootingModes:[{modeName:"Mechanical Shutter",data:[{iso:100,r:He(511.95,511.8,512.1),g1:He(511.95,511.8,512.1),b:He(511.95,511.8,512.1),g2:He(511.95,511.8,512.1)},{iso:800,r:He(512.1,511.9,512.3),g1:He(512.1,511.9,512.3),b:He(512.1,511.9,512.3),g2:He(512.1,511.9,512.3)}]}]},{id:"nikon-z9",name:"Nikon Z9",manufacturer:"Nikon",shootingModes:[{modeName:"Electronic Shutter",data:[{iso:64,r:He(400,399.9,400.1),g1:He(400,399.9,400.1),b:He(400,399.9,400.1),g2:He(400,399.9,400.1)},{iso:100,r:He(400,399.9,400.1),g1:He(400,399.9,400.1),b:He(400,399.9,400.1),g2:He(400,399.9,400.1)}]}]},{id:"nikon-z6-2",name:"Nikon Z 6II",manufacturer:"Nikon",shootingModes:[{modeName:"Still (Lossless)",data:[{iso:100,r:He(400.1,399.8,400.3),g1:He(400.1,399.8,400.3),b:He(400.1,399.8,400.3),g2:He(400.1,399.8,400.3)},{iso:800,r:He(400.3,399.5,401.1),g1:He(400.3,399.5,401.1),b:He(400.3,399.5,401.1),g2:He(400.3,399.5,401.1)}]}]},{id:"fujifilm-xt4",name:"Fujifilm X-T4",manufacturer:"Fujifilm",shootingModes:[{modeName:"Still (RAF)",data:[{iso:160,r:He(1024,1023.8,1024.2),g1:He(1024,1023.8,1024.2),b:He(1024,1023.8,1024.2),g2:He(1024,1023.8,1024.2)},{iso:800,r:He(1024.2,1023.5,1025),g1:He(1024.2,1023.5,1025),b:He(1024.2,1023.5,1025),g2:He(1024.2,1023.5,1025)}]}]}],Eoe=({isOpen:e,onClose:t,theme:r})=>{const[n,a]=j.useState(""),[i,o]=j.useState("All"),s=j.useMemo(()=>["All",...Array.from(new Set(Vx.map(f=>f.manufacturer))).sort()],[]),l=j.useMemo(()=>Vx.filter(d=>{const f=d.name.toLowerCase().includes(n.toLowerCase()),h=i==="All"||d.manufacturer===i;return f&&h}),[n,i]),u=d=>{const f=document.getElementById(`camera-${d}`);f&&f.scrollIntoView({behavior:"smooth"})};return e?c.jsx("div",{className:"fixed inset-0 z-[100] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-in fade-in duration-200",onClick:t,children:c.jsxs("div",{className:"bg-white dark:bg-slate-900 w-full max-w-6xl h-[90vh] rounded-2xl shadow-2xl flex flex-col border border-gray-200 dark:border-slate-700 overflow-hidden",onClick:d=>d.stopPropagation(),children:[c.jsxs("div",{className:"flex justify-between items-center p-5 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800/50",children:[c.jsxs("h2",{className:"text-xl font-bold text-gray-900 dark:text-slate-100 flex items-center gap-2",children:["Camera Black Level Database",c.jsxs("span",{className:"text-xs font-normal bg-cyan-100 dark:bg-cyan-900/30 text-cyan-600 dark:text-cyan-400 px-2 py-0.5 rounded border border-cyan-200 dark:border-cyan-800",children:[Vx.length," Models"]})]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-200 transition-colors p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-800",children:c.jsx("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-slate-700 bg-gray-50/50 dark:bg-slate-800/30",children:c.jsx(Coe,{searchTerm:n,onSearchChange:a,manufacturers:s,selectedManufacturer:i,onManufacturerChange:o,cameras:l,onCameraSelect:u})}),c.jsx("div",{className:"flex-1 overflow-y-auto p-6 scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-slate-700 bg-gray-100 dark:bg-slate-950",children:c.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-2 gap-6",children:[l.map(d=>c.jsx("div",{id:`camera-${d.id}`,children:c.jsx(Toe,{camera:d,theme:r})},d.id)),l.length===0&&c.jsx("div",{className:"col-span-full flex flex-col items-center justify-center py-20 text-gray-400 dark:text-slate-600",children:c.jsx("p",{className:"text-lg",children:"No cameras found matching your criteria."})})]})})]})}):null},Ioe=({isOpen:e,onClose:t,zIndex:r=150})=>{const[n,a]=j.useState(""),[i,o]=j.useState(""),[s,l]=j.useState(""),[u,d]=j.useState(""),[f,h]=j.useState(null),p=()=>{const x=parseFloat(n),b=parseFloat(i),y=parseFloat(s),m=parseFloat(u);if(isNaN(x)||isNaN(b)||isNaN(y)||isNaN(m)){h(null);return}const g=x,k=b,S=y*y,w=m*m,v=(g+k)/2;if(v<=1e-9){h(0);return}const M=S*w/v,_=Math.sqrt(M);h(_)};return e?c.jsxs(Ks,{initialPosition:{x:window.innerWidth/2-160,y:window.innerHeight/2-200},onClose:t,zIndex:r,className:"w-80 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsx("h3",{className:"text-sm font-bold text-gray-700 dark:text-slate-200",children:"Cross-Compensation Calc"}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-3 text-xs",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"H Mean (Power/Var)"}),c.jsx("input",{type:"number",step:"any",value:n,onChange:x=>a(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"V Mean (Power/Var)"}),c.jsx("input",{type:"number",step:"any",value:i,onChange:x=>o(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"H RMS 0 (Sigma)"}),c.jsx("input",{type:"number",step:"any",value:s,onChange:x=>l(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-gray-500 dark:text-slate-400 font-bold",children:"V RMS 0 (Sigma)"}),c.jsx("input",{type:"number",step:"any",value:u,onChange:x=>d(x.target.value),className:"p-2 rounded bg-gray-100 dark:bg-slate-800 border border-gray-300 dark:border-slate-600 outline-none focus:border-indigo-500 text-gray-900 dark:text-slate-100 font-mono"})]}),c.jsx("button",{onClick:p,className:"mt-2 w-full py-2 bg-indigo-600 hover:bg-indigo-500 text-white font-bold rounded shadow transition-colors active:scale-95",children:"Calculate Sigma"}),f!==null&&c.jsxs("div",{className:"mt-2 p-3 bg-indigo-50 dark:bg-indigo-900/30 border border-indigo-200 dark:border-indigo-800 rounded text-center animate-in fade-in slide-in-from-top-1",children:[c.jsx("span",{className:"block text-[10px] uppercase font-bold text-gray-500 dark:text-slate-400 mb-1",children:"Original White Noise Sigma"}),c.jsx("span",{className:"text-lg font-mono font-bold text-indigo-700 dark:text-indigo-300 select-all",children:f.toFixed(5)})]})]})]}):null},Ob=[[.1725,.0838,.0576],[.5481,.2985,.217],[.1103,.1968,.3359],[.1038,.1502,.0521],[.2244,.2177,.4302],[.1232,.519,.4044],[.7168,.199,.0271],[.065,.1063,.3924],[.5417,.0884,.1203],[.1042,.0438,.1396],[.3547,.5078,.0482],[.7805,.3541,.0215],[.0234,.0492,.2916],[.0653,.3019,.0645],[.4294,.0319,.0402],[.8568,.5754,.0079],[.5032,.0889,.3055],[0,.249,.383],[.9163,.9155,.8705],[.5819,.5911,.5839],[.3552,.361,.359],[.1876,.1924,.1917],[.0871,.0901,.0908],[.0321,.0319,.0326]],Roe=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]];function Doe(e,t,r,n,a,i,o=.5){const u=[],d=Math.max(.1,Math.min(.9,o)),f=Math.hypot(t.x-e.x,t.y-e.y),h=Math.hypot(n.x-r.x,n.y-r.y),p=Math.hypot(r.x-e.x,r.y-e.y),x=Math.hypot(n.x-t.x,n.y-t.y),b=(f+h)/2/5,y=(p+x)/2/3,m=b*d,g=y*d;for(let k=0;k<4;k++)for(let S=0;S<6;S++){const w=S/5,v=k/3,M=(1-w)*(1-v)*e.x+w*(1-v)*t.x+(1-w)*v*r.x+w*v*n.x,_=(1-w)*(1-v)*e.y+w*(1-v)*t.y+(1-w)*v*r.y+w*v*n.y;u.push({x:M-m/2,y:_-g/2,w:m,h:g})}return u}function $O(e){e.length;const t=e[0].length;return Array(t).fill(0).map((r,n)=>e.map(a=>a[n]))}function bh(e,t){const r=e.length,n=e[0].length,a=t.length,i=t[0].length;if(n!==a)throw new Error("Matrix dimensions mismatch");const o=Array(r).fill(0).map(()=>Array(i).fill(0));for(let s=0;s<r;s++)for(let l=0;l<i;l++)for(let u=0;u<n;u++)o[s][l]+=e[s][u]*t[u][l];return o}function $oe(e,t){const r=$O(e),n=bh(r,e);for(let u=0;u<3;u++)n[u][u]+=1e-9;const a=[[n[0][0],n[0][1],n[0][2]],[n[1][0],n[1][1],n[1][2]],[n[2][0],n[2][1],n[2][2]]],i=Ro(a);if(!i)throw new Error("Singular Matrix (Check Input Data)");const o=[[i[0][0],i[0][1],i[0][2]],[i[1][0],i[1][1],i[1][2]],[i[2][0],i[2][1],i[2][2]]],s=bh(r,t);return bh(o,s)}function Loe(e){const t=e.length,r=e.map((n,a)=>[...n,...Array(t).fill(0).map((i,o)=>a===o?1:0)]);for(let n=0;n<t;n++){let a=n;for(let s=n+1;s<t;s++)Math.abs(r[s][n])>Math.abs(r[a][n])&&(a=s);const i=r[n];r[n]=r[a],r[a]=i;const o=r[n][n];if(Math.abs(o)<1e-12)throw new Error("Singular Matrix");for(let s=n;s<2*t;s++)r[n][s]/=o;for(let s=0;s<t;s++)if(s!==n){const l=r[s][n];for(let u=n;u<2*t;u++)r[s][u]-=l*r[n][u]}}return r.map(n=>n.slice(t))}function Boe(e,t,r){const n=[...e].sort((b,y)=>b.id-y.id);if(n.length!==24)throw new Error("Requires exactly 24 patches");const a=[];n.forEach(b=>{const y=b.rawMeans,m=[y[0]-t[0],y[1]-t[1],y[2]-t[2],y[3]-t[3]];let g,k,S;r?(S=m[0],k=(m[1]+m[2])/2,g=m[3]):(g=m[0],k=(m[1]+m[2])/2,S=m[3]),g=Math.max(0,g),k=Math.max(0,k),S=Math.max(0,S),a.push([g,k,S])});const o=a[18],s=(o[0]+o[1]+o[2])/3,l=1/Math.max(1e-9,s),u=a.map(b=>[b[0]*l,b[1]*l,b[2]*l]),f=$oe(u,Ob),h=$O(f);let p;try{p=Loe(h)}catch{throw new Error("CCM Inversion Failed. Input data might be too dark or clipped.")}return{matrix:bh(p,Roe)}}const Foe=({isOpen:e,onClose:t,patchStats:r,initialIsBGGR:n,zIndex:a=200,sizeRatio:i,onSizeChange:o})=>{const[s,l]=j.useState(n),[u,d]=j.useState(["0","0","0","0"]),[f,h]=j.useState(null),[p,x]=j.useState(null);if(j.useEffect(()=>{if(e&&r&&r.length===24){const v=r[23].rawMeans;u[0]==="0"&&u[1]==="0"&&d([v[0].toFixed(2),v[1].toFixed(2),v[2].toFixed(2),v[3].toFixed(2)])}},[e,r]),j.useEffect(()=>{if(!e||!r||r.length!==24)return;const w=u.map(v=>parseFloat(v));if(!w.some(isNaN))try{const v=Boe(r,w,s);h(v),x(null)}catch(v){x(v.message)}},[e,r,s,u]),!e)return null;const b=(w,v)=>{d(M=>{const _=[...M];return _[w]=v,_})},y=w=>{navigator.clipboard.writeText(w)},m=w=>w?w.map(v=>v.map(M=>M.toFixed(4))):[],g=f?m(f.matrix).flat().join(" "):"",k=s?["B","G1","G2","R"]:["R","G1","G2","B"],S=s?["text-blue-500","text-green-500","text-green-500","text-red-500"]:["text-red-500","text-green-500","text-green-500","text-blue-500"];return c.jsxs(Ks,{initialPosition:{x:window.innerWidth/2-200,y:100},onClose:t,zIndex:a,className:"w-[500px] bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 flex flex-col shadow-2xl rounded-xl overflow-hidden",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-3 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800",children:[c.jsxs("h3",{className:"text-sm font-bold text-gray-800 dark:text-slate-100 flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-yellow-500"}),"Color Lab Result"]}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsxs("div",{className:"p-5 flex flex-col gap-5",children:[c.jsxs("div",{className:"bg-gray-100 dark:bg-slate-800 p-3 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsxs("div",{className:"flex justify-between items-center mb-1",children:[c.jsx("span",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Patch Sampling Size"}),c.jsxs("span",{className:"text-xs font-mono font-bold text-cyan-600 dark:text-cyan-400",children:[Math.round(i*100),"%"]})]}),c.jsx("input",{type:"range",min:"0.1",max:"0.9",step:"0.05",value:i,onChange:w=>o(parseFloat(w.target.value)),className:"w-full h-1.5 bg-gray-300 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"})]}),c.jsx("div",{className:"flex justify-center",children:c.jsxs("div",{className:"flex bg-gray-100 dark:bg-slate-800 p-1 rounded-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:()=>l(!1),className:`px-4 py-1.5 text-xs font-bold rounded transition-all ${s?"text-gray-500 dark:text-slate-400 hover:text-gray-700":"bg-white dark:bg-slate-600 text-indigo-600 dark:text-indigo-300 shadow-sm"}`,children:"RGGB Mode"}),c.jsx("button",{onClick:()=>l(!0),className:`px-4 py-1.5 text-xs font-bold rounded transition-all ${s?"bg-white dark:bg-slate-600 text-indigo-600 dark:text-indigo-300 shadow-sm":"text-gray-500 dark:text-slate-400 hover:text-gray-700"}`,children:"BGGR Mode"})]})}),c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-3 rounded-lg border border-gray-100 dark:border-slate-700",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase mb-2",children:"Input Black Levels ()"}),c.jsx("div",{className:"grid grid-cols-4 gap-2",children:[0,1,2,3].map(w=>c.jsxs("div",{className:"flex flex-col",children:[c.jsx("label",{className:`text-[10px] font-bold mb-1 ${S[w]}`,children:k[w]}),c.jsx("input",{type:"number",step:"0.01",value:u[w],onChange:v=>b(w,v.target.value),className:"w-full px-2 py-1 text-sm font-mono border border-gray-300 dark:border-slate-600 rounded bg-white dark:bg-slate-900 text-gray-900 dark:text-slate-100 outline-none focus:ring-1 focus:ring-yellow-500"})]},w))})]}),p?c.jsx("div",{className:"text-red-500 text-sm text-center bg-red-50 dark:bg-red-900/20 p-2 rounded",children:p}):f?c.jsx(c.Fragment,{children:c.jsxs("div",{className:"bg-gray-50 dark:bg-slate-800/50 p-3 rounded-lg border border-gray-100 dark:border-slate-700",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-400 dark:text-slate-500 uppercase mb-2",children:"Calculated Color Matrix (XYZ  Camera RGB)"}),c.jsx("div",{className:"font-mono text-xs text-gray-700 dark:text-slate-300 grid grid-rows-3 gap-1 mb-3",children:m(f.matrix).map((w,v)=>c.jsxs("div",{className:"flex justify-between bg-white dark:bg-slate-900 px-2 py-1 rounded",children:[c.jsx("span",{className:"text-red-500/80 w-1/3 text-right",children:w[0]}),c.jsx("span",{className:"text-green-500/80 w-1/3 text-right",children:w[1]}),c.jsx("span",{className:"text-blue-500/80 w-1/3 text-right",children:w[2]})]},v))}),c.jsx("button",{onClick:()=>y(g),className:"w-full py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded shadow transition-transform active:scale-95 flex items-center justify-center gap-2",children:"Copy Matrix String (for customMatrix)"})]})}):c.jsx("div",{className:"text-gray-400 text-sm text-center",children:"Calculating..."})]})]})};function Y2(e,t){const r=e.length;let n=0,a=0,i=0,o=0;for(let l=0;l<r;l++)n+=e[l],a+=t[l],i+=e[l]*t[l],o+=e[l]*e[l];const s=r*o-n*n;return s===0?{slope:0,intercept:0}:{slope:(r*i-n*a)/s,intercept:(a*o-n*i)/s}}function Goe(e,t){const r=e.length,n=new Array(r).fill(0),a=2*t;for(let i=0;i<r;i++){const o=i>0?e[i-1]:e[0],s=i<r-1?e[i+1]:e[r-1];n[i]=(s-o)/a}return n}function Uoe(e){const t=new Array(e.length).fill(0);t[0]=e[0];for(let r=1;r<e.length;r++){let n=e[r]-e[r-1];n>Math.PI?n-=2*Math.PI:n<-Math.PI&&(n+=2*Math.PI),t[r]=t[r-1]+n}return t}function zoe(e){const t=e.length,r=new Array(t).fill(0).map((i,o)=>o),{slope:n,intercept:a}=Y2(r,e);return e.map((i,o)=>i-(n*o+a))}function Woe(e,t,r="RGGB"){const n=r.toUpperCase(),a=t%2,i=e%2;return n==="RGGB"||n==="BGGR"?(a+i)%2!==0:n==="GBRG"||n==="GRBG"?(a+i)%2===0:(a+i)%2!==0}function Ab(e,t,r,n,a){const i=Math.floor(n.x),o=Math.floor(n.y),s=Math.floor(n.w),l=Math.floor(n.h);if(s<8||l<8)return null;let u=[];for(let Z=0;Z<l;Z++){const ae=[],ce=(o+Z)*t;for(let ne=0;ne<s;ne++)ae.push(e[ce+i+ne]);u.push(ae)}let d=0,f=0;for(let Z=1;Z<l-1;Z+=2)for(let ae=1;ae<s-1;ae+=2)d+=Math.abs(u[Z][ae+1]-u[Z][ae-1]),f+=Math.abs(u[Z+1][ae]-u[Z-1][ae]);let h=s,p=l,x=u,b=2,y=!1;if(f>d){b=1,y=!0,x=Array(s).fill(0).map(()=>Array(l).fill(0));for(let Z=0;Z<l;Z++)for(let ae=0;ae<s;ae++)x[ae][l-1-Z]=u[Z][ae];h=l,p=s}else b=2;const m=[],g=[];for(let Z=0;Z<p;Z++){const ae=x[Z],ce=ae.map((se,he)=>he===0?0:Math.abs(se-ae[he-1])),ne=Math.max(...ce),le=ce.indexOf(ne);if(ne>1){const se=Math.max(0,le-3),he=Math.min(h,le+4);let ue=0,ie=0;for(let xe=se;xe<he;xe++)ue+=ce[xe],ie+=xe*ce[xe];ue>0&&(m.push(ie/ue),g.push(Z))}}if(m.length<p*.4)return null;const{slope:k,intercept:S}=Y2(g,m),w=Math.cos(Math.atan(k)),v=[],M=[],_=(a==null?void 0:a.greenOnly)??!1,P=(a==null?void 0:a.globalX)??0,A=(a==null?void 0:a.globalY)??0,R=(a==null?void 0:a.bayerPattern)||"RGGB";for(let Z=0;Z<p;Z++){const ae=k*Z+S;for(let ce=0;ce<h;ce++){if(_){let ne,le;if(y){const se=l-1-ce,he=Z;ne=P+i+he,le=A+o+se}else ne=P+i+ce,le=A+o+Z;if(!Woe(ne,le,R))continue}v.push((ce-ae)*w),M.push(x[Z][ce])}}const E=Math.min(s,l)/2;let W=0;for(const Z of v)Math.abs(Z)<=E&&W++;let F=.125;if(a!=null&&a.manualBinSize&&a.manualBinSize>0)F=Math.max(.01,Math.min(.5,a.manualBinSize));else if(W>0){const Z=40*E/W;F=Math.max(.01,Math.min(.125,Z))}const O=F,$=Array.from(v.keys()).sort((Z,ae)=>v[Z]-v[ae]),N=$.map(Z=>v[Z]),C=$.map(Z=>M[Z]);if(N.length===0)return null;const B=N[0],I=N[N.length-1],z=Math.floor((I-B)/O),V=new Array(z).fill(0),K=new Array(z).fill(0);for(let Z=0;Z<N.length;Z++){const ae=Math.floor((N[Z]-B)/O);ae>=0&&ae<z&&(V[ae]+=C[Z],K[ae]++)}let q=C[0];for(let Z=0;Z<z;Z++)K[Z]>0?(V[Z]/=K[Z],q=V[Z]):V[Z]=q;const G=V.slice(0,10).reduce((Z,ae)=>Z+ae,0)/10,pe=V.slice(-10).reduce((Z,ae)=>Z+ae,0)/10;if(G>pe){const Z=Math.max(...V),ae=Math.min(...V);for(let ce=0;ce<V.length;ce++)V[ce]=Z-V[ce]+ae}const J=Goe(V,O);return{esf:V,lsfFull:J,binSize:O,orientation:b}}function LO(e,t,r,n=!1,a=0,i=!1){if(e.length===0)return null;const o=4096,s=new Tl(o),l=r?1e3/r:1,u=new Float32Array(501);for(let g=0;g<=500;g++)u[g]=g/500*l*2;const d=new Float32Array(501).fill(0);let f=0,h=[],p=[],x=0,b=[];for(const g of e){let k=[...g.lsfFull];const S=g.binSize;let w=0,v=-1/0;for(let K=0;K<k.length;K++)k[K]>v&&(v=k[K],w=K);const M=v*.2;let _=0,P=k.length-1;for(let K=w;K>=0;K--)if(k[K]<M){_=K;break}for(let K=w;K<k.length;K++)if(k[K]<M){P=K;break}const A=P-_;let R=!1;if(n&&A>0){const K=A*4,q=[],G=[];if(a>0){const pe=Math.max(0,w-K-a),J=Math.max(0,w-K);for(let ce=pe;ce<J;ce++)q.push(ce),G.push(k[ce]);const Z=Math.min(k.length,w+K),ae=Math.min(k.length,w+K+a);for(let ce=Z;ce<ae;ce++)q.push(ce),G.push(k[ce])}else{for(let pe=0;pe<Math.max(0,w-K);pe++)q.push(pe),G.push(k[pe]);for(let pe=Math.min(k.length,w+K);pe<k.length;pe++)q.push(pe),G.push(k[pe])}if(q.length>2){const{slope:pe,intercept:J}=Y2(q,G);for(let Z=0;Z<k.length;Z++)k[Z]=k[Z]-(pe*Z+J);v=-1/0;for(let Z=0;Z<k.length;Z++)k[Z]>v&&(v=k[Z],w=Z);R=!0}}let D=0,E=0;if(t>0)E=t,D=Math.round(t/S);else{const K=v*.2;let q=0,G=k.length-1;for(let ae=w;ae>=0;ae--)if(k[ae]<K){q=ae;break}for(let ae=w;ae<k.length;ae++)if(k[ae]<K){G=ae;break}const J=(G-q)*S;let Z=Math.max(2,J*8);E=Z,D=Math.round(Z/S)}x+=E;const W=Math.max(0,w-D),F=Math.min(k.length,w+D),O=k.slice(W,F);if(O.length<8)continue;const $=new Float32Array(o).fill(0);let N=-1/0,C=0;for(let K=0;K<O.length;K++)O[K]>N&&(N=O[K],C=K);for(let K=0;K<O.length;K++){let q=1;i&&(q=.5*(1-Math.cos(2*Math.PI*K/(O.length-1))));const G=O[K]*q,pe=(K-C+o)%o;$[pe]=G}s.transform($);const B=[],I=[],z=[];for(let K=0;K<=o/2;K++){const q=s._real[K],G=s._imag[K],pe=Math.sqrt(q*q+G*G);B.push(pe),I.push(K/(o*S)*l),z.push(Math.atan2(G,q))}const V=B[0];if(V>0){for(let K=0;K<=500;K++){const q=u[K];d[K]+=V4(q,I,B)/V}if(f++,h.length===0){h=O,p=R?Voe(k):g.esf;const K=Uoe(z),q=zoe(K);for(let G=0;G<=500;G++){const pe=u[G];b.push(V4(pe,I,q))}}}}if(f===0)return null;const y=Array.from(d).map(g=>g/f);let m=null;for(let g=0;g<y.length-1;g++)if(y[g]>=.5&&y[g+1]<.5){m=u[g]+(.5-y[g])*(u[g+1]-u[g])/(y[g+1]-y[g]);break}return{esf:p,lsf:[],lsfCropped:h,mtf:y,ptf:b,freqs:Array.from(u),mtf50:m,calcRadius:x/f}}function Voe(e){const t=new Array(e.length).fill(0);let r=0;for(let n=0;n<e.length;n++)r+=e[n],t[n]=r;return t}function V4(e,t,r){if(e<=t[0])return r[0];if(e>=t[t.length-1])return r[r.length-1];let n=0;for(;e>t[n+1];)n++;const a=(e-t[n])/(t[n+1]-t[n]);return r[n]+a*(r[n+1]-r[n])}const es=({locked:e,onToggle:t,title:r})=>c.jsx("span",{className:"inline-flex items-center justify-center p-1 rounded hover:bg-gray-200 dark:hover:bg-slate-700 transition-colors cursor-pointer select-none",title:r??(e?"Locked (Auto Fit will NOT change)":"Unlocked (Auto Fit may change)"),onMouseDown:n=>{n.stopPropagation()},onClick:n=>{n.stopPropagation(),t()},children:c.jsx("span",{className:`w-4 h-4 rounded-full border-2 transition-all active:scale-90 flex items-center justify-center ${e?"border-indigo-600 bg-indigo-600":"border-gray-400 dark:border-slate-500 bg-transparent hover:border-gray-500"}`,children:e&&c.jsx("span",{className:"w-2 h-2 rounded-full bg-white"})})}),Hoe=({isOpen:e,onClose:t,rawImageData:r,roi:n,zIndex:a=110,onFocus:i,displaySettings:o,isSfrLabOpen:s})=>{const[l,u]=j.useState([]),[d,f]=j.useState(""),[h,p]=j.useState(""),[x,b]=j.useState(12),[y,m]=j.useState(!0),[g,k]=j.useState(!0),[S,w]=j.useState(!0),[v,M]=j.useState(!1),[_,P]=j.useState(!1),[A,R]=j.useState(!1),[D,E]=j.useState(!1),[W,F]=j.useState("50"),[O,$]=j.useState(!1),[N,C]=j.useState("0.125"),[B,I]=j.useState(!1),[z,V]=j.useState({aperture:4,olpfSeparationPx:.7,fillFactor:.9,coreSigmaPx:.15,haloSigmaPx:.8,haloWeight:.25,wavelengthUm:.55,rolloff:1}),[K,q]=j.useState({aperture:!1,olpfSeparationPx:!1,fillFactor:!1,coreSigmaPx:!1,haloSigmaPx:!1,haloWeight:!1,wavelengthUm:!1,rolloff:!1}),[G,pe]=j.useState("0"),[J,Z]=j.useState(""),[ae,ce]=j.useState(!1),[ne,le]=j.useState(""),[se,he]=j.useState(1),[ue,ie]=j.useState(null),[xe,Se]=j.useState({x:100,y:50}),[Ie,te]=j.useState({w:1e3,h:800}),[Oe,Fe]=j.useState(!1),[bt,Ct]=j.useState(!1),ut=j.useRef({x:0,y:0}),dt=j.useRef({w:0,h:0}),[ht,tt]=j.useState(!1),[vt,Sr]=j.useState(!1),Ft=l.length>0?l[l.length-1].binSize:null,rt=Ft?(1/Ft).toFixed(1):"-",Kt=j.useMemo(()=>n?Math.max(n.w,n.h):100,[n]),Vt=(o==null?void 0:o.renderMode)==="advanced-zero-dep",gr=j.useMemo(()=>{const L=parseFloat(d);return Number.isFinite(L)&&L>0?L:null},[d]),Zt=gr!==null,zt=Zt?"lp/mm":"cy/px",rr=(L,ke,Pe)=>Math.min(Pe,Math.max(ke,L)),Ot=L=>{if(Math.abs(L)<1e-12)return 1;const ke=Math.PI*L;return Math.sin(ke)/ke},_e=L=>L<=0?1:L>=1?0:2/Math.PI*(Math.acos(L)-L*Math.sqrt(1-L*L)),ee=(L,ke,Pe,jt)=>{const Be=rr(jt,0,1),nt=Math.max(0,ke),Ue=Math.max(0,Pe),er=Math.exp(-2*Math.PI*Math.PI*nt*nt*L*L),Tr=Math.exp(-2*Math.PI*Math.PI*Ue*Ue*L*L);return(1-Be)*er+Be*Tr},ve=j.useMemo(()=>Zt&&gr?1e3/gr:1,[Zt,gr]),de=(L,ke)=>{const{aperture:Pe,olpfSeparationPx:jt,fillFactor:Be,coreSigmaPx:nt,haloSigmaPx:Ue,haloWeight:er,wavelengthUm:Tr,rolloff:Rr}=ke,Ut=Zt?L/ve:L,rn=Math.max(1e-9,Tr)/1e3,ln=Zt&&gr?gr/1e3:5/1e3,On=Math.max(1e-6,Pe),Wt=1/(rn*On)*ln,ar=Wt>0?Ut/Wt:1e9,We=_e(ar),$t=Math.max(0,jt),Nr=Math.abs(Math.cos(Math.PI*Ut*$t)),cn=rr(Be,0,1),ea=Math.abs(Ot(Ut*cn)),vn=Math.max(0,nt),ja=Math.max(0,Ue),oe=ee(Ut,vn,ja,er);let me=We*Nr*ea*oe;const je=Math.max(.1,Rr);return me=Math.pow(Math.max(0,me),je),Math.min(1.2,Math.max(0,me))},De=()=>{if(!(!r||!n)){if(!Vt){alert("Scalar Unmixing is required. Please configure Background/Foreground/BlackLevel in the Sidebar and click 'RUN UNMIXING' first.");return}try{let L=null;const ke=O?parseFloat(N):void 0;if(o!=null&&o.advancedZeroDep){const Pe=Gv(r,n,o);L=Ab(Pe.data,Pe.width,Pe.height,{x:0,y:0,w:Pe.width,h:Pe.height},{greenOnly:S,globalX:n.x,globalY:n.y,bayerPattern:r.bayerPattern,manualBinSize:ke})}else L=Ab(r.data,r.width,r.height,n,{greenOnly:S,globalX:n.x,globalY:n.y,bayerPattern:r.bayerPattern,manualBinSize:ke});L?u(Pe=>[...Pe,L]):alert("Could not detect valid edge.")}catch(L){console.error(L),alert("Error processing ROI")}}},Ye=()=>{u([]),ie(null),he(1)},st=()=>{if(!ue)return;const L=parseFloat(d),jt=`data:text/csv;charset=utf-8,Frequency (${!isNaN(L)&&L>0?"lp/mm":"cy/px"}),MTF,Phase(Rad)
`+ue.freqs.map((Ue,er)=>{const Tr=ue.ptf?ue.ptf[er]:0;return`${Ue.toFixed(6)},${ue.mtf[er].toFixed(6)},${Tr?Tr.toFixed(6):0}`}).join(`
`),Be=encodeURI(jt),nt=document.createElement("a");nt.setAttribute("href",Be),nt.setAttribute("download",`sfr_data_${Date.now()}.csv`),document.body.appendChild(nt),nt.click(),document.body.removeChild(nt)},_t=()=>{if(!(ue!=null&&ue.mtf50)||!n)return;const L=n.x+n.w/2,ke=n.y+n.h/2,Pe=`{${L.toFixed(1)},${ke.toFixed(1)},${ue.mtf50.toFixed(4)}}`;navigator.clipboard.writeText(Pe)};j.useEffect(()=>{if(l.length===0){ie(null);return}const L=parseFloat(d),ke=!isNaN(L)&&L>0?L:null,Pe=y?-1:x,jt=D&&parseFloat(W)||0,Be=LO(l,Pe,ke,g,jt,v);ie(Be)},[l,x,y,g,d,D,W,v]),j.useEffect(()=>{e&&Vt&&l.length===0&&n&&r&&De()},[e]);const Xe=L=>{i&&i(),!vt&&(L.target.closest("button")||L.target.closest("input")||L.target.closest("select")||L.target.closest("label")||(Fe(!0),ut.current={x:L.clientX-xe.x,y:L.clientY-xe.y}))},Ar=L=>{vt||(L.stopPropagation(),L.preventDefault(),Ct(!0),ut.current={x:L.clientX,y:L.clientY},dt.current={w:Ie.w,h:Ie.h})};j.useEffect(()=>{const L=Pe=>{if(Oe)Se({x:Pe.clientX-ut.current.x,y:Pe.clientY-ut.current.y});else if(bt){const jt=Pe.clientX-ut.current.x,Be=Pe.clientX-ut.current.y;te({w:Math.max(600,dt.current.w+jt),h:Math.max(500,dt.current.h+Be)})}},ke=()=>{Fe(!1),Ct(!1)};return(Oe||bt)&&(window.addEventListener("mousemove",L),window.addEventListener("mouseup",ke)),()=>{window.removeEventListener("mousemove",L),window.removeEventListener("mouseup",ke)}},[Oe,bt]);const nr=j.useMemo(()=>{if(!(ue!=null&&ue.mtf50)||!h)return null;const L=parseFloat(h);if(isNaN(L)||L<=0)return null;let ke=ue.mtf50;const Pe=parseFloat(d);return!isNaN(Pe)&&Pe>0&&(ke=ue.mtf50*(Pe/1e3)),ke*2*L},[ue,h,d]),Gt=_?2:1,mt=Gt*ve,Jt=.004,Pr=j.useMemo(()=>{if(!B)return[];const L=[];for(let ke=0;ke<=Gt+1e-12;ke+=Jt){const Pe=ke*ve;L.push({freq:Pe,modelMtf:de(Pe,z)})}return L},[B,z,Gt,ve]),Zr=j.useMemo(()=>{const L=ue?ue.mtf.map((Pe,jt)=>({freq:ue.freqs[jt],mtf:Pe})).filter(Pe=>Pe.freq<=mt):[];if(!B||Pr.length===0)return L.map(Pe=>({freq:Pe.freq,mtf:Pe.mtf,modelMtf:null}));const ke=new Map;for(const Pe of Pr){const jt=Pe.freq.toFixed(6);ke.set(jt,{freq:Pe.freq,mtf:null,modelMtf:Pe.modelMtf})}for(const Pe of L){const jt=Pe.freq.toFixed(6),Be=ke.get(jt);Be?Be.mtf=Pe.mtf:ke.set(jt,{freq:Pe.freq,mtf:Pe.mtf,modelMtf:null})}return Array.from(ke.values()).sort((Pe,jt)=>Pe.freq-jt.freq)},[ue,mt,B,Pr]),jr=ue?ue.lsfCropped.map((L,ke)=>({x:ke,y:L})):[],we=ue?ue.esf.map((L,ke)=>({x:ke,y:L})):[],Je=j.useMemo(()=>ue!=null&&ue.ptf?ue.ptf.map((L,ke)=>({freq:ue.freqs[ke],ptf:L})).filter(L=>L.freq<=mt):[],[ue,mt]);if(!e)return null;const Qe={aperture:[.7,64],olpfSeparationPx:[0,5],fillFactor:[.05,1],coreSigmaPx:[0,3],haloSigmaPx:[0,50],haloWeight:[0,1],wavelengthUm:[.4,.7],rolloff:[.2,6]},Qt={aperture:.2,olpfSeparationPx:.05,fillFactor:.03,coreSigmaPx:.03,haloSigmaPx:.2,haloWeight:.05,wavelengthUm:.01,rolloff:.1},Ht=()=>{let L=0,ke=0;for(;L===0;)L=Math.random();for(;ke===0;)ke=Math.random();return Math.sqrt(-2*Math.log(L))*Math.cos(2*Math.PI*ke)},it=()=>["aperture","olpfSeparationPx","fillFactor","coreSigmaPx","haloSigmaPx","haloWeight","wavelengthUm","rolloff"].filter(ke=>!K[ke]),cr=(L,ke)=>ke.map(Pe=>L[Pe]),pr=(L,ke,Pe,jt)=>{const Be={...ke};for(let er=0;er<Pe.length;er++){const Tr=Pe[er],[Rr,Ut]=Qe[Tr];Be[Tr]=rr(L[er],Rr,Ut)}Object.keys(jt).forEach(er=>{jt[er]&&(Be[er]=ke[er])});const nt=jt.coreSigmaPx,Ue=jt.haloSigmaPx;return Ue&&!nt?Be.coreSigmaPx=Math.min(Be.coreSigmaPx,ke.haloSigmaPx):nt&&!Ue?Be.haloSigmaPx=Math.max(Be.haloSigmaPx,ke.coreSigmaPx):!nt&&!Ue&&(Be.haloSigmaPx=Math.max(Be.haloSigmaPx,Be.coreSigmaPx)),Be},It=(L,ke)=>{const Pe=[...L];for(let jt=0;jt<ke.length;jt++){const Be=ke[jt],nt=Qt[Be],Ue=Be==="aperture"?.1:Be==="wavelengthUm"?.02:.2;Pe[jt]=Pe[jt]+Ue*nt*Ht()}return Pe},Tt=(L,ke,Pe,jt)=>{const Be=L.map(nt=>1/(1+.5*nt*nt));return nt=>{const Ue=pr(nt,Pe,jt,K);let er=0;for(let Ut=0;Ut<L.length;Ut++){const rn=ke[Ut],On=de(L[Ut],Ue)-rn;er+=Be[Ut]*On*On}const Rr=1e-4*((K.olpfSeparationPx?0:Ue.olpfSeparationPx*Ue.olpfSeparationPx)+(K.coreSigmaPx?0:Ue.coreSigmaPx*Ue.coreSigmaPx)+(K.haloSigmaPx?0:Ue.haloSigmaPx*Ue.haloSigmaPx)+(K.rolloff?0:(Ue.rolloff-1)*(Ue.rolloff-1)));return er+Rr}},Ae=(L,ke,Pe,jt=320)=>{const Be=ke.length,nt=new Array(Be+1);nt[0]=[...ke];for(let ur=0;ur<Be;ur++){const Wt=[...ke];Wt[ur]=Wt[ur]+Pe[ur],nt[ur+1]=Wt}const Ue=nt.map(ur=>L(ur)),er=()=>{const ur=Ue.map((We,$t)=>[We,$t]).sort((We,$t)=>We[0]-$t[0]).map(We=>We[1]),Wt=ur.map(We=>nt[We]),ar=ur.map(We=>Ue[We]);for(let We=0;We<nt.length;We++)nt[We]=Wt[We];for(let We=0;We<Ue.length;We++)Ue[We]=ar[We]},Tr=()=>{const ur=new Array(Be).fill(0);for(let Wt=0;Wt<Be;Wt++){const ar=nt[Wt];for(let We=0;We<Be;We++)ur[We]+=ar[We]}for(let Wt=0;Wt<Be;Wt++)ur[Wt]/=Be;return ur},Rr=(ur,Wt,ar=1)=>ur.map((We,$t)=>We+ar*Wt[$t]),Ut=(ur,Wt)=>ur.map((ar,We)=>ar-Wt[We]),rn=1,ln=2,On=.5;for(let ur=0;ur<jt;ur++){er();const Wt=nt[0],ar=nt[Be],We=Tr(),$t=Rr(We,Ut(We,ar),rn),Nr=L($t);if(Nr<Ue[0]){const vn=Rr(We,Ut($t,We),ln),ja=L(vn);ja<Nr?(nt[Be]=vn,Ue[Be]=ja):(nt[Be]=$t,Ue[Be]=Nr);continue}if(Nr<Ue[Be-1]){nt[Be]=$t,Ue[Be]=Nr;continue}const cn=Rr(We,Ut(ar,We),-.5),ea=L(cn);if(ea<Ue[Be]){nt[Be]=cn,Ue[Be]=ea;continue}for(let vn=1;vn<Be+1;vn++)nt[vn]=Rr(Wt,Ut(nt[vn],Wt),On),Ue[vn]=L(nt[vn])}return er(),{x:nt[0],fx:Ue[0]}},Yt=async()=>{if(!(ue!=null&&ue.freqs)||!(ue!=null&&ue.mtf)||ue.freqs.length<10){le("No enough MTF data to fit.");return}const L=it();if(L.length===0){le("All parameters are locked.");return}const ke=Math.max(0,parseFloat(G||"0")||0),Pe=mt,jt=(()=>{const We=parseFloat(J||"");return Number.isFinite(We)&&We>0?We:Pe})(),Be=[];for(let We=0;We<ue.freqs.length;We++){const $t=ue.freqs[We],Nr=ue.mtf[We];$t>=ke&&$t<=jt&&Number.isFinite(Nr)&&Be.push([$t,Nr])}if(Be.length<10){le("Fit range too narrow (need >= 10 points).");return}const Ue=Math.max(1,Math.floor(Be.length/300)),er=Be.filter((We,$t)=>$t%Ue===0).map(We=>We[0]),Tr=Be.filter((We,$t)=>$t%Ue===0).map(We=>We[1]);ce(!0),le(`Fitting ${L.length} params (${er.length} pts) in [${ke.toFixed(3)}, ${jt.toFixed(3)}] ${zt} ...`);const Rr=z,Ut=cr(Rr,L),rn=L.map(We=>Qt[We]),ln=Tt(er,Tr,Rr,L),On=7;let ur=Ut,Wt=ln(Ut);for(let We=0;We<On;We++){const $t=We===0?Ut:It(Ut,L),Nr=Ae(ln,$t,rn,320);Nr.fx<Wt&&(Wt=Nr.fx,ur=Nr.x),await new Promise(requestAnimationFrame)}const ar=pr(ur,Rr,L,K);V(ar),le(`Fit done. SSE=${Wt.toExponential(3)}  unlocked=${L.length}  range=[${ke.toFixed(3)}, ${jt.toFixed(3)}] ${zt}`),ce(!1)};return c.jsxs("div",{className:`fixed flex flex-col bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-700 shadow-2xl overflow-hidden ${vt?"rounded-none":"rounded-xl"}`,style:vt?{inset:0,width:"100vw",height:"100vh",zIndex:a??100}:{left:xe.x,top:xe.y,width:Ie.w,height:ht?"auto":Ie.h,zIndex:a??100},onMouseDownCapture:i,children:[c.jsxs("div",{className:`flex justify-between items-center px-4 py-2 border-b border-gray-200 dark:border-slate-700 bg-gray-50 dark:bg-slate-800 select-none ${!vt&&Oe?"cursor-grabbing":vt?"":"cursor-grab"}`,onMouseDown:Xe,onDoubleClick:()=>Sr(!vt),children:[c.jsxs("h3",{className:"text-sm font-bold text-orange-600 dark:text-orange-400 flex items-center gap-2 pointer-events-none",children:["SFR Expert (Adaptive Edge Method)",c.jsxs("span",{className:"text-xs bg-orange-100 dark:bg-orange-900/30 text-orange-700 dark:text-orange-300 px-2 py-0.5 rounded border border-orange-200 dark:border-orange-800",children:[l.length," ROI",l.length!==1?"s":""]})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("button",{onClick:()=>Sr(!vt),className:"text-gray-400 hover:text-orange-500 transition-colors",title:vt?"Restore":"Maximize",children:vt?c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 14h6v6M20 10h-6V4"})}):c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 8V4m0 0h4M20 8V4m0 0h-4M4 16v4m0 0h4M20 16v4m0 0h-4"})})}),c.jsx("button",{onClick:()=>tt(!ht),className:"text-gray-400 hover:text-orange-500 transition-colors",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})})]})]}),!ht&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"p-3 bg-gray-50/50 dark:bg-slate-800/30 border-b border-gray-200 dark:border-slate-700 flex items-center gap-4 flex-wrap text-xs flex-shrink-0",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:"Pixel Pitch (m):"}),c.jsx("input",{type:"number",value:d,onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>f(L.target.value),placeholder:"Default (cy/px)",className:"w-20 px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-orange-500"})]}),c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:"Image Height:"}),c.jsx("input",{type:"number",value:h,onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>p(L.target.value),placeholder:"px",className:"w-16 px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none focus:border-orange-500"})]}),c.jsxs("div",{className:"flex items-center gap-2 bg-blue-50 dark:bg-blue-900/20 px-2 py-1 rounded border border-blue-100 dark:border-blue-800",children:[c.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"Bin:"}),Ft?c.jsxs("span",{className:"font-mono text-gray-700 dark:text-gray-300",children:[Ft.toFixed(3),"px",c.jsxs("span",{className:"text-[10px] ml-1 text-gray-500",children:["(",rt,"x)"]})]}):c.jsx("span",{className:"text-gray-400 italic",children:"..."}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none ml-2 border-l border-blue-200 dark:border-blue-700 pl-2",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:O,onChange:L=>{L.stopPropagation(),$(L.target.checked)},className:"w-3 h-3 text-blue-600 rounded focus:ring-blue-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-blue-600 dark:text-blue-400",children:"Manual"})]}),O&&c.jsx("input",{type:"number",value:N,onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>C(L.target.value),step:"0.001",min:"0.01",max:"0.5",className:"w-16 px-1 py-0.5 text-xs bg-white dark:bg-slate-900 border border-blue-300 dark:border-blue-600 rounded outline-none focus:border-orange-500",placeholder:"0.125"})]}),c.jsxs("div",{className:"flex items-center gap-4 flex-1 min-w-[500px] border-l border-gray-300 dark:border-slate-600 pl-3",children:[c.jsxs("div",{className:"flex items-center gap-2",children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",title:"Linear detrending with limited fitting width",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:g,onChange:L=>{L.stopPropagation(),k(L.target.checked)},className:"w-4 h-4 text-purple-600 rounded focus:ring-purple-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-purple-600 dark:text-purple-400",children:"Deshading"})]}),g&&c.jsxs(c.Fragment,{children:[c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none border-l border-purple-200 dark:border-purple-800 pl-2",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:D,onChange:L=>{L.stopPropagation(),E(L.target.checked)},className:"w-3 h-3 text-purple-600 rounded focus:ring-purple-500 border-gray-300"}),c.jsx("span",{className:"text-[10px] font-bold text-purple-600 dark:text-purple-400",children:"Limit Fit"})]}),D&&c.jsxs("div",{className:"flex items-center gap-1",title:"Width of data used for fitting (pixels)",children:[c.jsx("input",{type:"number",value:W,onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>F(L.target.value),step:"5",min:"10",max:"500",className:"w-14 px-1 py-0.5 text-xs bg-white dark:bg-slate-900 border border-purple-300 dark:border-purple-600 rounded outline-none focus:border-orange-500"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]})]})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:S,onChange:L=>{L.stopPropagation(),w(L.target.checked)},className:"w-4 h-4 text-emerald-600 rounded focus:ring-emerald-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400",children:"G-Only"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),title:"Apply Hann windowing before FFT",children:[c.jsx("input",{type:"checkbox",checked:v,onChange:L=>{L.stopPropagation(),M(L.target.checked)},className:"w-4 h-4 text-amber-600 rounded focus:ring-amber-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400",children:"Hann On"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:_,onChange:L=>{L.stopPropagation(),P(L.target.checked)},className:"w-4 h-4 text-blue-600 rounded focus:ring-blue-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-blue-600 dark:text-blue-400",children:"2 Freq"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:A,onChange:L=>{L.stopPropagation(),R(L.target.checked)},className:"w-4 h-4 text-teal-600 rounded focus:ring-teal-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-teal-600 dark:text-teal-400",children:"Show PTF"})]}),c.jsxs("label",{className:"flex items-center gap-1 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:y,onChange:L=>{L.stopPropagation();const ke=L.target.checked;m(ke),ke||b(Kt)},className:"w-4 h-4 text-orange-600 rounded focus:ring-orange-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Jiang's official NR"})]}),c.jsxs("div",{className:"flex-1 flex flex-col justify-center",children:[c.jsxs("div",{className:"flex justify-between items-baseline",children:[c.jsx("span",{className:"font-bold text-gray-500 dark:text-slate-400",children:y?"Calculated:":"Manual:"}),c.jsxs("span",{className:`font-mono font-bold ${y?"text-green-600 dark:text-green-400":"text-gray-700 dark:text-gray-300"}`,children:[y&&(ue!=null&&ue.calcRadius)?ue.calcRadius.toFixed(2):x.toFixed(1)," px"]})]}),c.jsx("input",{type:"range",min:"2",max:Kt,step:"0.5",value:x,onMouseDown:L=>L.stopPropagation(),onChange:L=>{b(parseFloat(L.target.value)),m(!1)},disabled:y,className:`w-full h-1.5 rounded-lg appearance-none cursor-pointer ${y?"bg-gray-200 dark:bg-slate-800":"bg-gray-300 dark:bg-slate-600 accent-orange-500"}`})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onMouseDown:L=>L.stopPropagation(),onClick:L=>{L.stopPropagation(),De()},disabled:!Vt,title:Vt?"":"Scalar Unmixing must be active. Run Unmixing in Sidebar first.",className:`px-3 py-1.5 text-white font-bold rounded shadow-sm transition-transform active:scale-95 ${Vt?"bg-orange-600 hover:bg-orange-500":"bg-gray-400 cursor-not-allowed"}`,children:Vt?"Add Current ROI":"Unmixing Required"}),c.jsx("button",{onMouseDown:L=>L.stopPropagation(),onClick:L=>{L.stopPropagation(),_t()},disabled:!ue||!ue.mtf50||!n,className:"px-3 py-1.5 bg-cyan-600 hover:bg-cyan-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold rounded shadow-sm transition-transform active:scale-95",children:"Copy Pos/MTF50"}),c.jsx("button",{onMouseDown:L=>L.stopPropagation(),onClick:L=>{L.stopPropagation(),st()},disabled:!ue,className:"px-3 py-1.5 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-300 disabled:text-gray-500 text-white font-bold rounded shadow-sm transition-transform active:scale-95",children:"Export CSV"}),c.jsx("button",{onMouseDown:L=>L.stopPropagation(),onClick:L=>{L.stopPropagation(),Ye()},className:"px-3 py-1.5 bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600 text-gray-600 dark:text-slate-300 font-bold rounded transition-colors",children:"Clear"})]})]}),c.jsxs("div",{className:"px-3 py-2 bg-indigo-50 dark:bg-indigo-900/20 border-b border-indigo-200 dark:border-indigo-800 flex items-center gap-4 flex-wrap text-xs",children:[c.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),children:[c.jsx("input",{type:"checkbox",checked:B,onChange:L=>{L.stopPropagation(),I(L.target.checked)},className:"w-4 h-4 text-indigo-600 rounded focus:ring-indigo-500 border-gray-300"}),c.jsx("span",{className:"font-bold text-indigo-700 dark:text-indigo-400 text-sm",children:"Show Model Line"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"F-number (Aperture)",children:[c.jsx(es,{locked:K.aperture,onToggle:()=>q(L=>({...L,aperture:!L.aperture}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"F/"}),c.jsx("input",{type:"number",value:z.aperture,step:"0.05",min:"0.7",max:"64",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,aperture:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"OLPF two-image split separation d (px)",children:[c.jsx(es,{locked:K.olpfSeparationPx,onToggle:()=>q(L=>({...L,olpfSeparationPx:!L.olpfSeparationPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"OLPF d:"}),c.jsx("input",{type:"number",value:z.olpfSeparationPx,step:"0.01",min:"0",max:"5",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,olpfSeparationPx:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Pixel Fill Factor (0..1)",children:[c.jsx(es,{locked:K.fillFactor,onToggle:()=>q(L=>({...L,fillFactor:!L.fillFactor}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Fill:"}),c.jsx("input",{type:"number",value:z.fillFactor,step:"0.01",min:"0",max:"1",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,fillFactor:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Spherical core sigma (px)",children:[c.jsx(es,{locked:K.coreSigmaPx,onToggle:()=>q(L=>({...L,coreSigmaPx:!L.coreSigmaPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Core :"}),c.jsx("input",{type:"number",value:z.coreSigmaPx,step:"0.01",min:"0",max:"10",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,coreSigmaPx:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Spherical halo sigma (px)",children:[c.jsx(es,{locked:K.haloSigmaPx,onToggle:()=>q(L=>({...L,haloSigmaPx:!L.haloSigmaPx}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Halo :"}),c.jsx("input",{type:"number",value:z.haloSigmaPx,step:"0.01",min:"0",max:"50",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,haloSigmaPx:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"px"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Halo weight 0..1",children:[c.jsx(es,{locked:K.haloWeight,onToggle:()=>q(L=>({...L,haloWeight:!L.haloWeight}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Halo w:"}),c.jsx("input",{type:"number",value:z.haloWeight,step:"0.01",min:"0",max:"1",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,haloWeight:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Wavelength (m) for diffraction model",children:[c.jsx(es,{locked:K.wavelengthUm,onToggle:()=>q(L=>({...L,wavelengthUm:!L.wavelengthUm}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:":"}),c.jsx("input",{type:"number",value:z.wavelengthUm,step:"0.01",min:"0.35",max:"0.75",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,wavelengthUm:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"m"})]}),c.jsxs("div",{className:"flex items-center gap-2",title:"Manual rolloff exponent",children:[c.jsx(es,{locked:K.rolloff,onToggle:()=>q(L=>({...L,rolloff:!L.rolloff}))}),c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Rolloff:"}),c.jsx("input",{type:"number",value:z.rolloff,step:"0.01",min:"0.1",max:"10",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>{const ke=parseFloat(L.target.value);Number.isFinite(ke)&&V(Pe=>({...Pe,rolloff:ke}))},className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs"})]}),c.jsxs("div",{className:"flex items-center gap-2 ml-2",children:[c.jsx("span",{className:"font-bold text-gray-600 dark:text-slate-300",children:"Fit:"}),c.jsx("input",{type:"number",value:G,step:"0.001",min:"0",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>pe(L.target.value),className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs",title:`Fit range min (${zt})`}),c.jsx("span",{className:"text-[10px] text-gray-500",children:"to"}),c.jsx("input",{type:"number",value:J,step:"0.001",min:"0",onMouseDown:L=>L.stopPropagation(),onClick:L=>L.stopPropagation(),onChange:L=>Z(L.target.value),className:"w-20 px-1 py-0.5 bg-white dark:bg-slate-900 border border-indigo-300 dark:border-indigo-600 rounded text-xs",placeholder:`${mt.toFixed(2)}`,title:`Fit range max (${zt}), blank = current max`}),c.jsx("button",{onMouseDown:L=>L.stopPropagation(),onClick:L=>{L.stopPropagation(),ae||Yt()},disabled:ae||!ue,className:`px-2 py-1 rounded font-bold text-white text-xs transition-transform active:scale-95 ${ae?"bg-gray-400":"bg-indigo-600 hover:bg-indigo-500"}`,title:"Auto fit UNLOCKED params to measured MTF in the given frequency range",children:ae?"Fitting":"Auto Fit"})]}),c.jsx("span",{className:"text-[10px] text-gray-500 dark:text-slate-400 italic ml-2",children:"Dot filled = locked. Auto Fit only changes unlocked params."}),ne&&c.jsx("span",{className:"text-[10px] text-gray-500 dark:text-slate-400 italic ml-2",children:ne})]}),c.jsxs("div",{className:"flex-1 p-4 overflow-hidden flex flex-col gap-4 bg-white dark:bg-slate-950",children:[c.jsxs("div",{className:"h-[35%] min-h-[180px] flex gap-4",children:[c.jsxs("div",{className:"flex-1 bg-gray-50 dark:bg-slate-900/50 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsx("h4",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 absolute top-2 left-3 z-10 bg-white/80 dark:bg-slate-900/80 px-1 rounded",children:"ESF"}),c.jsx("div",{className:"flex-1 min-h-0 w-full",children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:we,children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(ba,{dataKey:"x",hide:!0}),c.jsx(va,{hide:!0,domain:["auto","auto"]}),c.jsx(Rn,{contentStyle:{fontSize:"10px"}}),c.jsx(Dn,{type:"monotone",dataKey:"y",stroke:"#3b82f6",strokeWidth:1,dot:!1,isAnimationActive:!1})]})})})]}),c.jsxs("div",{className:"flex-1 bg-gray-50 dark:bg-slate-900/50 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsxs("div",{className:"absolute top-2 left-3 z-10 flex items-center gap-3",children:[c.jsxs("h4",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 bg-white/80 dark:bg-slate-900/80 px-1 rounded",children:["LSF ",se>1?`(x${se.toFixed(0)})`:""]}),c.jsxs("div",{className:"flex items-center gap-1 bg-white/80 dark:bg-slate-900/80 px-1 rounded border border-gray-200 dark:border-slate-700",children:[c.jsx("span",{className:"text-[9px] text-gray-400 font-bold",children:"Zoom"}),c.jsx("input",{type:"range",min:"1",max:"50",step:"1",value:se,onMouseDown:L=>L.stopPropagation(),onChange:L=>he(parseFloat(L.target.value)),className:"w-16 h-1 bg-gray-300 dark:bg-slate-600 rounded-lg appearance-none cursor-pointer accent-red-500"})]})]}),c.jsx("div",{className:"flex-1 min-h-0 w-full",children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:jr,children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.1}),c.jsx(vs,{y:0,stroke:"#9ca3af",strokeOpacity:.5,strokeDasharray:"3 3"}),c.jsx(ba,{dataKey:"x",hide:!0}),c.jsx(va,{hide:!1,width:30,tick:{fontSize:9,fill:"#888"},domain:[L=>L,L=>L/se],allowDataOverflow:!0,tickFormatter:L=>L.toFixed(3)}),c.jsx(Rn,{contentStyle:{fontSize:"10px"},formatter:L=>[L.toFixed(5),"Amplitude"]}),c.jsx(Dn,{type:"monotone",dataKey:"y",stroke:"#ef4444",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]})]}),c.jsxs("div",{className:"flex-1 flex gap-4 min-h-[250px]",children:[c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsxs("div",{className:"flex justify-between items-start px-2 mb-1",children:[c.jsx("h4",{className:"text-xs font-bold text-gray-500 dark:text-slate-400 uppercase",children:"MTF"}),c.jsxs("div",{className:"flex gap-4 items-center",children:[(ue==null?void 0:ue.mtf50)&&c.jsxs("div",{className:"text-sm font-bold text-gray-600 dark:text-slate-300",children:["MTF50 = ",c.jsxs("span",{className:"text-orange-600 dark:text-orange-400",children:[ue.mtf50.toFixed(2)," ",zt]})]}),nr!==null&&c.jsxs("div",{className:"text-lg font-bold text-white bg-orange-500 px-3 py-0.5 rounded shadow-lg animate-in fade-in",children:[Math.round(nr)," LW/PH"]})]})]}),c.jsxs("div",{className:"flex-1 relative min-h-0 w-full",children:[c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 pointer-events-none select-none opacity-10",children:c.jsx("svg",{viewBox:"0 0 400 60",className:"w-[30rem] h-auto",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-gray-900 dark:fill-white",fontSize:"24",fontWeight:"bold",children:" y-g-jiang.github.io"})})}),c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:Zr,margin:{top:10,right:30,left:10,bottom:20},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.15}),c.jsx(ba,{dataKey:"freq",type:"number",domain:[0,mt],tick:{fontSize:10,fill:"#9ca3af"},label:{value:`Frequency (${zt})`,position:"insideBottom",offset:-10,fontSize:11,fill:"#9ca3af"}}),c.jsx(va,{domain:[0,1.1],tick:{fontSize:10,fill:"#9ca3af"},label:{value:"MTF",angle:-90,position:"insideLeft",fontSize:11,fill:"#9ca3af"}}),c.jsx(Rn,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.9)",border:"none",color:"#fff",fontSize:"11px",borderRadius:"4px"},labelFormatter:L=>`Freq: ${Number(L).toFixed(3)} ${zt}`,formatter:(L,ke)=>ke==="Model"?[L==null?void 0:L.toFixed(4),"Model"]:[L==null?void 0:L.toFixed(4),"Measured"]}),c.jsx(Qi,{verticalAlign:"top",height:20}),c.jsx(Dn,{type:"monotone",dataKey:"mtf",name:"Measured",stroke:"#000000",strokeWidth:2,className:"dark:stroke-white",dot:!1,isAnimationActive:!1,connectNulls:!1}),B&&c.jsx(Dn,{type:"monotone",dataKey:"modelMtf",name:"Model",stroke:"#0066cc",strokeWidth:2,strokeDasharray:"5 5",dot:!1,isAnimationActive:!1,connectNulls:!0}),(ue==null?void 0:ue.mtf50)&&c.jsx(r0,{x:ue.mtf50,y:.5,r:4,fill:"#f97316",stroke:"none",children:c.jsx(qn,{value:"MTF50",position:"top",fill:"#f97316",fontSize:10,fontWeight:"bold"})})]})})]})]}),A&&c.jsxs("div",{className:"flex-1 bg-white dark:bg-slate-900 border border-gray-200 dark:border-slate-800 rounded-xl p-2 relative flex flex-col",children:[c.jsx("div",{className:"flex justify-between items-start px-2 mb-1",children:c.jsx("h4",{className:"text-xs font-bold text-teal-600 dark:text-teal-400 uppercase",children:"PTF / Phase"})}),c.jsx("div",{className:"flex-1 relative min-h-0 w-full",children:c.jsx(Xi,{width:"100%",height:"100%",children:c.jsxs(bl,{data:Je,margin:{top:10,right:30,left:10,bottom:20},children:[c.jsx(Ei,{strokeDasharray:"3 3",stroke:"#374151",opacity:.15}),c.jsx(ba,{dataKey:"freq",type:"number",domain:[0,mt],tick:{fontSize:10,fill:"#9ca3af"},label:{value:`Frequency (${zt})`,position:"insideBottom",offset:-10,fontSize:11,fill:"#9ca3af"}}),c.jsx(va,{tick:{fontSize:10,fill:"#9ca3af"},label:{value:"Phase (Rad)",angle:-90,position:"insideLeft",fontSize:11,fill:"#9ca3af"}}),c.jsx(Rn,{contentStyle:{backgroundColor:"rgba(15, 23, 42, 0.9)",border:"none",color:"#fff",fontSize:"11px",borderRadius:"4px"},labelFormatter:L=>`Freq: ${Number(L).toFixed(3)} ${zt}`,formatter:L=>[L==null?void 0:L.toFixed(4),"Phase (Rad)"]}),c.jsx(Dn,{type:"monotone",dataKey:"ptf",name:"Phase",stroke:"#0d9488",strokeWidth:2,dot:!1,isAnimationActive:!1})]})})})]})]})]})]}),!vt&&c.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize z-50 bg-gray-300 dark:bg-slate-600 rounded-tl hover:bg-orange-500 transition-colors",onMouseDown:Ar})]})},Xoe=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Rational = (5,8); Ascii = (2,1); Byte = (1,1)
    Undefined = (7,1); Srational = (10,8); IFD = (13,4)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); Orientation = (274, Type.Short); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)
    BlackLevelRepeatDim = (50713, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 5 or tid == 10: 
            flat = [item for sublist in value for item in sublist]
            fmt = 'L' if tid == 5 else 'l'
            return struct.pack('<%s%s' % (len(flat), fmt), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def convert_to_dng(raw_bytes, width, height, cfa_str, black_level_list, shift, linear_shift, cm_flat):
    # 1. Pixel Data Processing
    # Ensure raw_bytes is a bytes-like object
    raw_data = np.frombuffer(raw_bytes, dtype=np.uint16).copy()
    
    # Use int32 for calculations to prevent premature overflow and allow negative offsets
    raw_data = raw_data.astype(np.int32)

    # Apply Bit Shift (<<)
    if shift > 0:
        raw_data = raw_data * (1 << shift)
    
    # Apply Linear Offset (+)
    if linear_shift != 0:
        raw_data = raw_data + linear_shift

    # Clip to 16-bit range
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    # 2. Metadata Preparation
    white_level = 65019
    # Format Color Matrix for Srational (Value, Denominator)
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]

    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}
    
    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]), 
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, "JO-Workstation"),
        dngTag(Tag.Model, "Manual-16bit"),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]), 
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, "Generic 16bit Raw")
    ]
    
    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0])) 
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)
    
    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size
    
    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC
            
    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break
            
    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))
    
    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12
        
    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)
        
    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`,Koe=({isOpen:e,onClose:t,rawImageData:r,fileName:n,zIndex:a=200,onFocus:i})=>{const[o,s]=j.useState(!0),[l,u]=j.useState(!1),[d,f]=j.useState(""),h=j.useRef(null),p=j.useRef(null),[x,b]=j.useState(4),[y,m]=j.useState(0),[g,k]=j.useState(""),[S,w]=j.useState(""),[v,M]=j.useState("RGGB"),[_,P]=j.useState(!1),[A,R]=j.useState(100),[D,E]=j.useState(4e3),[W,F]=j.useState(0),[O,$]=j.useState(0),N=j.useMemo(()=>Object.keys(Zc).sort(),[]);j.useEffect(()=>{e&&!h.current&&(async()=>{try{const z=await window.loadPyodide();await z.loadPackage("numpy"),await z.runPythonAsync(Xoe),h.current=z,s(!1)}catch(z){console.error("Pyodide Init Failed",z)}})()},[e]),j.useEffect(()=>{if(e&&r){const I=r.whiteLevel;I>1e4?b(2):I>3e3?b(4):I>6e4&&b(0);const z=r.bayerPattern?r.bayerPattern.toUpperCase():"RGGB";["RGGB","BGGR","GBRG","GRBG"].includes(z)?M(z):M("RGGB");const V=Math.min(r.width,r.height),K=Math.max(48,Math.round(V/40));R(K),F(Math.round(K*10)),$(Math.round(r.height-K*2))}},[e,r]);const C=async I=>{if(!I.target.files||I.target.files.length===0||!h.current)return;const z=Array.from(I.target.files);u(!0);const V=g.trim()?g.trim().split(/\s+/).map(Number):[0,0,0,0];for(V.length===1&&!isNaN(V[0])&&V.push(V[0],V[0],V[0]);V.length<4;)V.push(0);const K=S.trim()?S.trim().split(/[\s,\n]+/).map(Number):[1,0,0,0,1,0,0,0,1];if(K.length!==9){alert("Color Matrix must contain exactly 9 numeric values."),u(!1);return}const q=h.current;for(let G=0;G<z.length;G++){const pe=z[G];f(`Processing ${G+1}/${z.length}: ${pe.name}`);try{const J=await pe.arrayBuffer(),Z=await Ds(J);let ae;if(_){const xe=document.createElement("canvas");xe.width=Z.width,xe.height=Z.height;const Se=xe.getContext("2d");if(Se){Se.fillStyle="black",Se.fillRect(0,0,xe.width,xe.height),Se.font=`bold ${A}px sans-serif`,Se.fillStyle="white",Se.textBaseline="middle",Se.textAlign="center",Se.fillText("(C)  y-g-jiang.github.io",W,O);const Ie=Se.getImageData(0,0,xe.width,xe.height).data;ae=new Uint16Array(Z.data);const te=ae.length;for(let Oe=0;Oe<te;Oe++)if(Ie[Oe*4]>128){let Fe=ae[Oe]+D;Fe<0&&(Fe=0),Fe>65535&&(Fe=65535),ae[Oe]=Fe}}else ae=new Uint16Array(Z.data)}else ae=Z.data;q.globals.set("js_raw_bytes",new Uint8Array(ae.buffer,ae.byteOffset,ae.byteLength)),q.globals.set("js_width",Z.width),q.globals.set("js_height",Z.height),q.globals.set("js_cfa",v),q.globals.set("js_bl_list",V),q.globals.set("js_shift",x),q.globals.set("js_linear_shift",y),q.globals.set("js_cm_flat",K);const ce=await q.runPythonAsync(`
                    convert_to_dng(
                        js_raw_bytes.to_py(), 
                        js_width, 
                        js_height, 
                        js_cfa, 
                        js_bl_list.to_py(), 
                        js_shift,
                        js_linear_shift,
                        js_cm_flat.to_py()
                    )
                `),ne=ce.toJs();ce.destroy();const le=new Blob([ne],{type:"image/x-adobe-dng"}),se=URL.createObjectURL(le),he=document.createElement("a");he.href=se;const ue=pe.name.substring(0,pe.name.lastIndexOf("."))||"image",ie=_?"_wm":"";he.download=`${ue}_16bit_manual${ie}.dng`,document.body.appendChild(he),he.click(),document.body.removeChild(he),URL.revokeObjectURL(se),await new Promise(xe=>setTimeout(xe,200))}catch(J){console.error(`Failed to batch process ${pe.name}`,J)}}u(!1),f(""),I.target.value=""},B=async()=>{if(!(!r||!h.current)){u(!0);try{const I=h.current,z=g.trim()?g.trim().split(/\s+/).map(Number):[0,0,0,0];if(z.length===1&&!isNaN(z[0])&&z.push(z[0],z[0],z[0]),z.length<4)for(;z.length<4;)z.push(0);const V=S.trim()?S.trim().split(/[\s,\n]+/).map(Number):[1,0,0,0,1,0,0,0,1];if(V.length!==9)throw new Error("Color Matrix must contain exactly 9 numeric values.");const K=v;let q;if(_){const le=document.createElement("canvas");le.width=r.width,le.height=r.height;const se=le.getContext("2d");if(se){se.fillStyle="black",se.fillRect(0,0,le.width,le.height),se.font=`bold ${A}px sans-serif`,se.fillStyle="white",se.textBaseline="middle",se.textAlign="center",se.fillText("(C)  y-g-jiang.github.io",W,O);const he=se.getImageData(0,0,le.width,le.height).data;q=new Uint16Array(r.data);const ue=q.length;for(let ie=0;ie<ue;ie++)if(he[ie*4]>128){let xe=q[ie]+D;xe<0&&(xe=0),xe>65535&&(xe=65535),q[ie]=xe}}else q=new Uint16Array(r.data)}else q=r.data;I.globals.set("js_raw_bytes",new Uint8Array(q.buffer,q.byteOffset,q.byteLength)),I.globals.set("js_width",r.width),I.globals.set("js_height",r.height),I.globals.set("js_cfa",K),I.globals.set("js_bl_list",z),I.globals.set("js_shift",x),I.globals.set("js_linear_shift",y),I.globals.set("js_cm_flat",V);const G=await I.runPythonAsync(`
                convert_to_dng(
                    js_raw_bytes.to_py(), 
                    js_width, 
                    js_height, 
                    js_cfa, 
                    js_bl_list.to_py(), 
                    js_shift,
                    js_linear_shift,
                    js_cm_flat.to_py()
                )
            `),pe=G.toJs();G.destroy();const J=new Blob([pe],{type:"image/x-adobe-dng"}),Z=URL.createObjectURL(J),ae=document.createElement("a");ae.href=Z;const ce=n.substring(0,n.lastIndexOf("."))||"image",ne=_?"_wm":"";ae.download=`${ce}_16bit_manual${ne}.dng`,document.body.appendChild(ae),ae.click(),document.body.removeChild(ae),URL.revokeObjectURL(Z)}catch(I){console.error(I),alert("Export Failed: "+I.message)}finally{u(!1)}}};return e?c.jsxs(Ks,{initialPosition:{x:window.innerWidth/2-250,y:50},onClose:t,zIndex:a,onFocus:i,className:"w-[500px] bg-white dark:bg-black border-2 border-black dark:border-white shadow-2xl rounded-none flex flex-col font-mono max-h-[90vh] overflow-y-auto",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b-2 border-black dark:border-gray-500 bg-gray-200 dark:bg-gray-800",children:[c.jsx("h3",{className:"text-sm font-bold text-black dark:text-white uppercase tracking-widest",children:"16-bit DNG Workstation"}),c.jsx("button",{onClick:t,className:"text-black dark:text-white hover:text-red-600 transition-colors",children:c.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:3,d:"M6 18L18 6M6 6l12 12"})})})]}),c.jsx("div",{className:"p-6 flex flex-col gap-6",children:o?c.jsxs("div",{className:"flex flex-col items-center justify-center py-10 gap-4",children:[c.jsx("div",{className:"w-8 h-8 border-4 border-black dark:border-white border-t-transparent animate-spin"}),c.jsx("p",{className:"text-xs font-bold text-gray-500 animate-pulse"})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Width (Read Only)"}),c.jsx("input",{type:"text",readOnly:!0,value:(r==null?void 0:r.width)||0,className:"w-full bg-gray-100 dark:bg-gray-900 border border-black dark:border-gray-600 px-2 py-1 text-sm text-gray-400"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Height (Read Only)"}),c.jsx("input",{type:"text",readOnly:!0,value:(r==null?void 0:r.height)||0,className:"w-full bg-gray-100 dark:bg-gray-900 border border-black dark:border-gray-600 px-2 py-1 text-sm text-gray-400"})]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-cyan-600 dark:text-cyan-400 uppercase",children:"Bit Shift (<<)"}),c.jsx("input",{type:"number",value:x,onChange:I=>b(parseInt(I.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold"})]}),c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-emerald-600 dark:text-emerald-400 uppercase",children:"Offset (+)"}),c.jsx("input",{type:"number",value:y,onChange:I=>m(parseInt(I.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold"})]}),c.jsxs("div",{className:"col-span-1 flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-600 dark:text-gray-400 uppercase",children:"Pattern"}),c.jsxs("select",{value:v,onChange:I=>M(I.target.value),className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-1 py-1 text-sm font-bold",children:[c.jsx("option",{value:"RGGB",children:"RGGB"}),c.jsx("option",{value:"BGGR",children:"BGGR"}),c.jsx("option",{value:"GBRG",children:"GBRG"}),c.jsx("option",{value:"GRBG",children:"GRBG"})]})]})]}),c.jsx("div",{className:"mt-[-10px] grid grid-cols-3 gap-4",children:c.jsx("div",{className:"text-[9px] text-gray-400 dark:text-gray-500 col-span-2",children:"Shift: 4=12bit(x16), 2=14bit(x4). Added after shift."})}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-indigo-600 dark:text-indigo-400 uppercase",children:"16bit Black Level (Manual Fill)"}),c.jsx("input",{type:"text",value:g,onChange:I=>k(I.target.value),placeholder:"R G1 B G2",className:"w-full bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-sm font-bold font-mono placeholder:font-normal placeholder:text-gray-400"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsxs("div",{className:"flex justify-between items-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Color Matrix (XYZ to Raw - 9 Values)"}),c.jsxs("select",{className:"text-[10px] bg-gray-100 dark:bg-gray-800 border border-black dark:border-gray-500 rounded-none px-1 py-0.5 max-w-[180px] cursor-pointer",onChange:I=>{const z=Zc[I.target.value];z&&w(z),I.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Select Camera Preset..."}),N.map(I=>c.jsx("option",{value:I,children:I},I))]})]}),c.jsx("textarea",{value:S,onChange:I=>w(I.target.value),placeholder:"e.g. 0.94 -0.39 -0.07 -0.28 1.09 0.22 -0.01 0.09 0.57",className:"w-full h-20 bg-white dark:bg-gray-800 border-2 border-black dark:border-gray-500 px-2 py-1 text-xs font-mono resize-none placeholder:font-normal placeholder:text-gray-400"}),c.jsx("span",{className:"text-[8px] text-gray-400 mt-0.5",children:"Enter 9 numbers separated by space or comma."})]}),c.jsxs("div",{className:"border border-gray-300 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 rounded p-3",children:[c.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[c.jsx("input",{type:"checkbox",id:"enableWatermark",checked:_,onChange:I=>P(I.target.checked),className:"rounded border-gray-300 text-indigo-600 focus:ring-indigo-500"}),c.jsx("label",{htmlFor:"enableWatermark",className:"text-xs font-bold text-gray-700 dark:text-gray-300 select-none",children:"Add Watermark: (C)  y-g-jiang.github.io"})]}),_&&c.jsxs("div",{className:"space-y-2 animate-in slide-in-from-top-1",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Size (px)"}),c.jsx("input",{type:"number",value:A,onChange:I=>R(Math.max(10,parseInt(I.target.value)||10)),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Depth (Shift DN)"}),c.jsx("input",{type:"number",value:D,onChange:I=>E(parseInt(I.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs",placeholder:"+/- value"})]})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Center X"}),c.jsx("input",{type:"number",value:W,onChange:I=>F(parseInt(I.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]}),c.jsxs("div",{className:"flex flex-col gap-1",children:[c.jsx("label",{className:"text-[9px] font-bold text-gray-500 dark:text-gray-400 uppercase",children:"Center Y"}),c.jsx("input",{type:"number",value:O,onChange:I=>$(parseInt(I.target.value)||0),className:"w-full bg-white dark:bg-gray-800 border border-gray-400 dark:border-gray-600 px-2 py-1 text-xs"})]})]})]})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"file",ref:p,multiple:!0,className:"hidden",accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff",onChange:C}),c.jsx("button",{onClick:()=>{var I;return(I=p.current)==null?void 0:I.click()},disabled:l,className:"flex-1 py-4 text-sm font-bold uppercase tracking-widest transition-all shadow-[4px_4px_0px_black] active:shadow-none active:translate-x-1 active:translate-y-1 bg-white dark:bg-slate-800 border-2 border-black dark:border-white text-black dark:text-white hover:bg-gray-100 dark:hover:bg-slate-700",children:"Batch Export (Files)"}),c.jsx("button",{onClick:B,disabled:l,className:`flex-[2] py-4 text-sm font-bold uppercase tracking-widest transition-all shadow-[4px_4px_0px_black] active:shadow-none active:translate-x-1 active:translate-y-1 ${l?"bg-gray-400 cursor-wait":"bg-cyan-600 hover:bg-cyan-500 text-white border-2 border-black"}`,children:l?"Processing...":"Export Single"})]}),d&&c.jsx("div",{className:"text-center text-xs font-bold text-cyan-600 dark:text-cyan-400 animate-pulse",children:d})]})})]}):null},BO=1196311626,Tb=3,fm=40,vl=20,Nc=20,q2=4+Nc*4,Yoe=vl*q2,H4=fm,vh=fm+Yoe,FO=0,GO=1,qoe=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]],UO=0,ks=new Set(["R","G","B"]),Zoe=e=>{const t=(e||"RGGB").toUpperCase().trim();return t.length>=4&&ks.has(t[0])&&ks.has(t[1])&&ks.has(t[2])&&ks.has(t[3])?t.slice(0,4):"RGGB"},Joe=e=>{const t=Zoe(e);return[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]},Qoe=e=>{if(!e||e.length<4)return null;const t=e.slice(0,4).map(r=>String.fromCharCode(Math.round(r))).join("").toUpperCase();return t.length===4&&ks.has(t[0])&&ks.has(t[1])&&ks.has(t[2])&&ks.has(t[3])?t:null},ese=e=>{if(!e.customMatrix||e.customMatrix.length!==9)return[[1,0,0],[0,1,0],[0,0,1]];const t=[[e.customMatrix[0],e.customMatrix[1],e.customMatrix[2]],[e.customMatrix[3],e.customMatrix[4],e.customMatrix[5]],[e.customMatrix[6],e.customMatrix[7],e.customMatrix[8]]],r=Ro(t);return r?Kc(qoe,r):[[1,0,0],[0,1,0],[0,0,1]]};function tse(e,t,r,n,a="RGGB",i=[],o=[],s=null){if(e<=0||t<=0)throw new Error("Invalid JDNG size.");const l=e*t;let u=1;if(r.length===l*3)u=3;else if(r.length!==l)throw new Error("JDNG float data size mismatch.");if(i.length>vl)throw new Error(`JDNG tag count exceeds ${vl}.`);let d=0;for(let M=0;M<r.length;M++){const _=r[M];Number.isFinite(_)&&_>d&&(d=_)}const f=!!s&&s.length===l;if(s&&s.length!==l)throw new Error("JDNG source map length mismatch.");const h=f?o.map(M=>String(M)):[],p=new TextEncoder,x=f?p.encode(JSON.stringify(h)):new Uint8Array(0),b=4+(f?12+x.length+s.length*2:0),y=vh+r.length*4+b,m=new ArrayBuffer(y),g=new DataView(m);g.setUint32(0,BO,!0),g.setUint32(4,Tb,!0),g.setUint32(8,e,!0),g.setUint32(12,t,!0),g.setFloat32(16,n[0],!0),g.setFloat32(20,n[1],!0),g.setFloat32(24,n[2],!0),g.setFloat32(28,n[3],!0),g.setFloat32(32,d,!0),g.setUint32(36,u,!0);const k=Array.from({length:vl},(M,_)=>(i[_]||[]).slice(0,Nc));k[UO]=Joe(a);const S=fm;for(let M=0;M<vl;M++){const _=k[M]||[];if(_.length>Nc)throw new Error(`JDNG tag ${M} exceeds max length ${Nc}.`);const P=S+M*q2;g.setUint32(P,_.length,!0);for(let A=0;A<Nc;A++){const R=A<_.length?_[A]:0;g.setFloat32(P+4+A*4,Number.isFinite(R)?R:0,!0)}}new Float32Array(m,vh,r.length).set(r);let v=vh+r.length*4;if(g.setUint32(v,f?GO:FO,!0),v+=4,f&&s){g.setUint32(v,h.length,!0),v+=4,g.setUint32(v,x.length,!0),v+=4,g.setUint32(v,s.length,!0),v+=4,new Uint8Array(m,v,x.length).set(x),v+=x.length;for(let M=0;M<s.length;M++)g.setInt16(v+M*2,s[M],!0)}return m}function rse(e){if(e.byteLength<H4)throw new Error("Invalid JDNG file: header too short.");const t=new DataView(e);if(t.getUint32(0,!0)!==BO)throw new Error("Invalid JDNG file: bad magic.");const n=t.getUint32(4,!0);if(n!==1&&n!==2&&n!==Tb)throw new Error(`Unsupported JDNG version: ${n}`);const a=t.getUint32(8,!0),i=t.getUint32(12,!0);if(!Number.isFinite(a)||!Number.isFinite(i)||a<=0||i<=0)throw new Error("Invalid JDNG dimensions.");const o=a*i;let s=Math.max(1,Math.floor(t.getUint32(36,!0)||1));s!==1&&s!==3&&(s=1);const l=n===1?H4:vh,u=o*s,d=l+u*4;if(e.byteLength<d)throw new Error(`Invalid JDNG payload size: expected at least ${d}, got ${e.byteLength}.`);const f=[t.getFloat32(16,!0),t.getFloat32(20,!0),t.getFloat32(24,!0),t.getFloat32(28,!0)],h=t.getFloat32(32,!0),p=Array.from({length:vl},()=>[]);if(n>=2){const m=fm;for(let g=0;g<vl;g++){const k=m+g*q2,S=t.getUint32(k,!0);if(S>Nc)throw new Error(`Invalid JDNG tag length at tag ${g}: ${S}.`);const w=[];for(let v=0;v<S;v++)w.push(t.getFloat32(k+4+v*4,!0));p[g]=w}}const x=new Float32Array(u);x.set(new Float32Array(e,l,u));let b=[],y=null;if(n===Tb){let m=d;if(e.byteLength<m+4)throw new Error("Invalid JDNG provenance header.");const g=t.getUint32(m,!0);if(m+=4,g===FO){if(e.byteLength!==d+4)throw new Error("Invalid JDNG size: unexpected trailing bytes without provenance.")}else if(g===GO){if(e.byteLength<m+12)throw new Error("Invalid JDNG provenance metadata.");const k=t.getUint32(m,!0);m+=4;const S=t.getUint32(m,!0);m+=4;const w=t.getUint32(m,!0);if(m+=4,e.byteLength<m+S+w*2)throw new Error("Invalid JDNG provenance payload length.");const v=new Uint8Array(e,m,S);m+=S;const M=new TextDecoder().decode(v),_=JSON.parse(M);if(!Array.isArray(_))throw new Error("Invalid JDNG provenance names payload.");if(b=_.map(P=>String(P)),b.length!==k)throw new Error("JDNG provenance source count mismatch.");if(w!==o)throw new Error(`JDNG provenance map length mismatch: expected ${o}, got ${w}.`);y=new Int16Array(w);for(let P=0;P<w;P++)y[P]=t.getInt16(m+P*2,!0);if(m+=w*2,m!==e.byteLength){const P=new Uint8Array(e,m,e.byteLength-m);let A=!1;for(let R=0;R<P.length;R++)if(P[R]!==0){A=!0;break}if(A)throw new Error("Invalid JDNG size: trailing bytes after provenance payload.")}}else throw new Error(`Unsupported JDNG provenance version: ${g}`)}else if(e.byteLength!==d)throw new Error(`Invalid JDNG payload size: expected ${d}, got ${e.byteLength}.`);return{version:n,width:a,height:i,channels:s,blackLevel:f,whiteLevel:h,tags:p,data:x,sourceNames:b,sourceMap:y}}const Eb=e=>Math.max(0,Math.min(1,e)),ts=e=>{const t=Eb(e),r=t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055;return Math.round(Eb(r)*255)},X4=(e,t,r)=>{const n=Eb((r-e)/Math.max(t-e,1e-9));return n*n*n*(n*(n*6-15)+10)},nse=e=>{const t=(e||"RGGB").toUpperCase();return t.length>=4?t.slice(0,4):"RGGB"},Z2=(e,t,r)=>{const n=(r&1)<<1|t&1;return e[n]||"G"},Hx=(e,t,r,n,a,i,o)=>{const s=d=>d<0?0:d>=n?n-1:d,l=d=>d<0?0:d>=a?a-1:d,u=[[0,0],[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[1,-1],[-1,1],[1,1]];for(let d=0;d<u.length;d++){const f=s(e+u[d][0]),h=l(t+u[d][1]);if(Z2(i,f,h)===r)return o[h*n+f]}return o[t*n+e]},rs=(e,t,r,n,a,i,o,s)=>{const l=h=>h<0?0:h>=n?n-1:h,u=h=>h<0?0:h>=a?a-1:h;let d=0,f=0;for(let h=0;h<s.length;h++){const p=l(e+s[h][0]),x=u(t+s[h][1]);Z2(i,p,x)===r&&(d+=o[x*n+p],f++)}return f>0?d/f:NaN};function Xx(e,t){var z,V,K,q;const r=e.width,n=e.height,a=r*n,i=e.floatData;if(!i||i.length===0)throw new Error("JDNG render requires floatData in RawImageData.");const o=e.floatChannels||(i.length===a*3?3:1),s=Math.pow(2,Number(t.exposure)||0),l=t.wbGains||[1,1],u=Number(l[0])||1,d=Number(l[1])||1,f=nse(e.bayerPattern),h=t.blackLevel||[((z=e.blackLevels)==null?void 0:z[0])||0,((V=e.blackLevels)==null?void 0:V[1])||0,((K=e.blackLevels)==null?void 0:K[2])||0,((q=e.blackLevels)==null?void 0:q[3])||0],p=Number(h[0])||0,x=((Number(h[1])||0)+(Number(h[2])||0))*.5,b=Number(h[3])||0,y=e.metadata||{};let m=Number(y.sourceWhiteLevel);if(!Number.isFinite(m)||m<=1e-9){const G=Number(y.sourceMax);Number.isFinite(G)&&G>1e-9&&(m=G)}(!Number.isFinite(m)||m<=1e-9)&&(m=Math.max(1,e.whiteLevel||1));let g=m;if(t.highlightRecovery){const G=Number(t.customWhiteLevel);Number.isFinite(G)&&G>1e-9&&(g=G)}const k=ese(t),S=k[0][0],w=k[0][1],v=k[0][2],M=k[1][0],_=k[1][1],P=k[1][2],A=k[2][0],R=k[2][1],D=k[2][2],E=!!t.highlightRecovery;let W=[1,1,1];if(E){const G=Ro(k);if(G){const pe=M_(G,[1,1,1]),J=Math.max(Math.abs(pe[0]),Math.max(Math.abs(pe[1]),Math.abs(pe[2])));J>1e-9&&(W=[pe[0]/J,pe[1]/J,pe[2]/J])}}const F=new Float32Array(a*3),O=new Uint8ClampedArray(a*4);if(t.renderMode==="zero-dependency"){if(o===3&&i.length>=a*3){const G=Math.max(1e-9,m-p),pe=Math.max(1e-9,m-x),J=Math.max(1e-9,m-b);for(let Z=0,ae=0;Z<a;Z++,ae+=3){const ce=Math.max(0,(i[ae]-p)/G*s*u),ne=Math.max(0,(i[ae+1]-x)/pe*s),le=Math.max(0,(i[ae+2]-b)/J*s*d),se=(ce+ne+le)/3;F[ae]=se,F[ae+1]=se,F[ae+2]=se;const he=Z*4,ue=ts(se);O[he]=ue,O[he+1]=ue,O[he+2]=ue,O[he+3]=255}}else{if(i.length<a)throw new Error("JDNG floatData length does not match image size.");for(let G=0;G<n;G++){const pe=G*r;for(let J=0;J<r;J++){const Z=pe+J,ae=(G&1)<<1|J&1,ce=f[ae]||"G",ne=Number(h[ae])||0,le=Math.max(1e-9,m-ne);let se=(i[Z]-ne)/le;(!Number.isFinite(se)||se<0)&&(se=0),ce==="R"&&(se*=u),ce==="B"&&(se*=d),se*=s;const he=Z*3;F[he]=se,F[he+1]=se,F[he+2]=se;const ue=Z*4,ie=ts(se);O[ue]=ie,O[ue+1]=ie,O[ue+2]=ie,O[ue+3]=255}}}return{imageData:new ImageData(O,r,n),floatRgb:F,width:r,height:n}}if(o===3&&i.length>=a*3){const G=Math.max(1e-9,g-p),pe=Math.max(1e-9,g-x),J=Math.max(1e-9,g-b);for(let Z=0,ae=0;Z<a;Z++,ae+=3){let ce=Math.max(0,(i[ae]-p)/G*u),ne=Math.max(0,(i[ae+1]-x)/pe),le=Math.max(0,(i[ae+2]-b)/J*d);if(E){const xe=Math.max(ce/Math.max(u,1e-6),Math.max(ne,le/Math.max(d,1e-6))),Se=X4(.85,1,xe);if(Se>0){const Ie=Math.max(ce,Math.max(ne,le)),te=W[0]*Ie,Oe=W[1]*Ie,Fe=W[2]*Ie;ce=ce+(te-ce)*Se,ne=ne+(Oe-ne)*Se,le=le+(Fe-le)*Se}}const se=Math.max(0,(S*ce+w*ne+v*le)*s),he=Math.max(0,(M*ce+_*ne+P*le)*s),ue=Math.max(0,(A*ce+R*ne+D*le)*s);F[ae]=se,F[ae+1]=he,F[ae+2]=ue;const ie=Z*4;O[ie]=ts(se),O[ie+1]=ts(he),O[ie+2]=ts(ue),O[ie+3]=255}return{imageData:new ImageData(O,r,n),floatRgb:F,width:r,height:n}}if(i.length<a)throw new Error("JDNG floatData length does not match image size.");const N=new Float32Array(a);for(let G=0;G<n;G++){const pe=G*r;for(let J=0;J<r;J++){const Z=pe+J,ae=(G&1)<<1|J&1,ce=f[ae]||"G",ne=Number(h[ae])||0,le=Math.max(1e-9,g-ne);let se=(i[Z]-ne)/le;(!Number.isFinite(se)||se<0)&&(se=0),ce==="R"&&(se*=u),ce==="B"&&(se*=d),N[Z]=se*s}}const C=t.demosaicMethod===0,B=[[-1,0],[1,0],[0,-1],[0,1]],I=[[-1,-1],[1,-1],[-1,1],[1,1]];for(let G=0;G<n;G++){const pe=G*r;for(let J=0;J<r;J++){const Z=pe+J,ae=Z2(f,J,G);let ce=0,ne=0,le=0;if(C)ce=Hx(J,G,"R",r,n,f,N),ne=Hx(J,G,"G",r,n,f,N),le=Hx(J,G,"B",r,n,f,N);else{const Se=N[Z];ae==="R"?(ce=Se,ne=rs(J,G,"G",r,n,f,N,B),le=rs(J,G,"B",r,n,f,N,I)):ae==="B"?(le=Se,ne=rs(J,G,"G",r,n,f,N,B),ce=rs(J,G,"R",r,n,f,N,I)):(ne=Se,ce=rs(J,G,"R",r,n,f,N,B),le=rs(J,G,"B",r,n,f,N,B),Number.isFinite(ce)||(ce=rs(J,G,"R",r,n,f,N,I)),Number.isFinite(le)||(le=rs(J,G,"B",r,n,f,N,I))),Number.isFinite(ce)||(ce=Se),Number.isFinite(ne)||(ne=Se),Number.isFinite(le)||(le=Se)}if(E){const Se=ce/Math.max(u,1e-6),Ie=ne,te=le/Math.max(d,1e-6),Oe=Math.max(Se,Math.max(Ie,te)),Fe=X4(.85,1,Oe);if(Fe>0){const bt=Math.max(ce,Math.max(ne,le)),Ct=W[0]*bt,ut=W[1]*bt,dt=W[2]*bt;ce=ce+(Ct-ce)*Fe,ne=ne+(ut-ne)*Fe,le=le+(dt-le)*Fe}}const se=Math.max(0,S*ce+w*ne+v*le),he=Math.max(0,M*ce+_*ne+P*le),ue=Math.max(0,A*ce+R*ne+D*le),ie=Z*3;F[ie]=se,F[ie+1]=he,F[ie+2]=ue;const xe=Z*4;O[xe]=ts(se),O[xe+1]=ts(he),O[xe+2]=ts(ue),O[xe+3]=255}}return{imageData:new ImageData(O,r,n),floatRgb:F,width:r,height:n}}async function ase(e){const t=rse(e),{width:r,height:n,data:a,blackLevel:i,whiteLevel:o,channels:s}=t,l=Qoe(t.tags[UO])||"RGGB",u=r*n;let d=1/0,f=-1/0;for(let P=0;P<a.length;P++){const A=a[P];Number.isFinite(A)&&(A<d&&(d=A),A>f&&(f=A))}(!Number.isFinite(d)||!Number.isFinite(f))&&(d=0,f=1);const h=Math.max(1e-12,f-d),p=d<0?-d:0,x=Math.max(0,f+p),b=x>65535?65535/x:1,y=Math.max(1,Math.min(65535,Math.round(x*b))),m=s===3?3:1,g=new Uint16Array(u*m),k=new Uint8ClampedArray(u*4);if(m===3)for(let P=0,A=0;P<u;P++,A+=3){const R=Number.isFinite(a[A])?a[A]:0,D=Number.isFinite(a[A+1])?a[A+1]:0,E=Number.isFinite(a[A+2])?a[A+2]:0;g[A]=Math.max(0,Math.min(65535,Math.round((R+p)*b))),g[A+1]=Math.max(0,Math.min(65535,Math.round((D+p)*b))),g[A+2]=Math.max(0,Math.min(65535,Math.round((E+p)*b)));const W=Math.max(0,Math.min(1,(R-d)/h)),F=Math.max(0,Math.min(1,(D-d)/h)),O=Math.max(0,Math.min(1,(E-d)/h)),$=P*4;k[$]=Math.round(Math.pow(W,1/2.2)*255),k[$+1]=Math.round(Math.pow(F,1/2.2)*255),k[$+2]=Math.round(Math.pow(O,1/2.2)*255),k[$+3]=255}else for(let P=0;P<u;P++){const A=Number.isFinite(a[P])?a[P]:0,R=(A+p)*b;g[P]=Math.max(0,Math.min(65535,Math.round(R)));const D=Math.max(0,Math.min(1,(A-d)/h)),E=Math.pow(D,1/2.2),W=Math.round(E*255),F=P*4;k[F]=W,k[F+1]=W,k[F+2]=W,k[F+3]=255}const S=new ImageData(k,r,n),w=document.createElement("canvas");w.width=r,w.height=n;const v=w.getContext("2d");if(!v)throw new Error("Failed to create canvas context for JDNG preview.");v.putImageData(S,0,0);const M=await new Promise((P,A)=>{w.toBlob(R=>R?P(R):A(new Error("Failed to encode JDNG preview.")),"image/png")}),_={data:g,width:r,height:n,bayerPattern:l,blackLevels:i.map(P=>Math.max(0,Math.round(P))),whiteLevel:y,floatData:a,floatChannels:m,metadata:{format:`JDNG_FLOAT32_V${t.version}`,cfaPattern:l,channels:m,reservedTags:t.tags,sourceNames:t.sourceNames,sourceMap:t.sourceMap,sourceWhiteLevel:o,sourceMin:d,sourceMax:f,quantOffset:p,quantScaleToU16:b},isThreePlane:m===3,isXTrans:!1};return{previewBlob:M,renderedImageData:S,analysisData:_}}const ise=[[3.2404542,-1.5371385,-.4985314],[-.969266,1.8760108,.041556],[.0556434,-.2040259,1.0572252]];function ose(e){const t=e.length;if(t===0)return 16383;const r=Math.max(1,Math.floor(t/1e6));let n=0;for(let a=0;a<t;a+=r){const i=e[a];i>n&&(n=i)}return n>17e3?65535:16383}const sse=`
struct Uniforms {
    width: u32,
    height: u32,
    whiteLevel: f32,
    exposureScale: f32,

    bl0: f32, bl1: f32, bl2: f32, bl3: f32,
    wb0: f32, wb1: f32, wb2: f32, wb3: f32,

    cm0: f32, cm1: f32, cm2: f32,
    cm3: f32, cm4: f32, cm5: f32,
    cm6: f32, cm7: f32, cm8: f32,

    renderMode: u32,
    isBGGR: u32,
    colorDemosaicMode: u32,

    neutral0: f32, neutral1: f32, neutral2: f32,

    hlrEnabled: u32,
    
    // Export specific flags (packed into padding or new fields)
    exportStretch: u32, 
    exportSrgb: u32,
};

struct UnmixParams {
    bl0: f32, bl1: f32, bl2: f32, bl3: f32,
    bg0: f32, bg1: f32, bg2: f32, bg3: f32,
    fg0: f32, fg1: f32, fg2: f32, fg3: f32,
};

@group(0) @binding(0) var<uniform> u : Uniforms;
@group(0) @binding(1) var<storage, read> rawData : array<u32>;
@group(0) @binding(3) var<uniform> unmix : UnmixParams;
@group(0) @binding(4) var<storage, read> lut : array<f32>; // 1024 float buffer

fn srgb_gamma(linear: f32) -> f32 {
    if (linear <= 0.0031308) { return 12.92 * linear; }
    return 1.055 * pow(linear, 1.0 / 2.4) - 0.055;
}

fn clamp01(x: f32) -> f32 { return max(0.0, min(1.0, x)); }
fn clamp_i32(v: i32, lo: i32, hi: i32) -> i32 { return max(lo, min(v, hi)); }

fn smootherstep(edge0: f32, edge1: f32, x: f32) -> f32 {
    let t = clamp01((x - edge0) / max(edge1 - edge0, 1e-6));
    return t*t*t*(t*(t*6.0 - 15.0) + 10.0);
}

fn get_raw_val(idx: u32) -> f32 {
    let u32Idx = idx / 2u;
    let shift = (idx % 2u) * 16u;
    let packed = rawData[u32Idx];
    return f32((packed >> shift) & 0xFFFFu);
}

fn get_bayer_idx(x: u32, y: u32) -> u32 {
    let rowIsOdd = (y % 2u);
    let colIsOdd = (x % 2u);
    return (rowIsOdd * 2u) + colIsOdd;
}

fn get_norm_pixel(x: i32, y: i32) -> f32 {
    let w = i32(u.width);
    let h = i32(u.height);
    let sx = clamp_i32(x, 0, w - 1);
    let sy = clamp_i32(y, 0, h - 1);
    let sxu = u32(sx);
    let syu = u32(sy);
    let idx = syu * u.width + sxu;
    let rawVal = get_raw_val(idx);
    let bIdx = get_bayer_idx(sxu, syu);

    var bl = 0.0;
    var wb = 1.0;
    if (bIdx == 0u) { bl = u.bl0; wb = u.wb0; }
    else if (bIdx == 1u) { bl = u.bl1; wb = u.wb1; }
    else if (bIdx == 2u) { bl = u.bl2; wb = u.wb2; }
    else { bl = u.bl3; wb = u.wb3; }

    let denom = max(u.whiteLevel - bl, 1.0);
    let val = max(0.0, rawVal - bl);
    return (val / denom) * wb;
}

fn shoulder_hue_preserve(rgbIn: vec3f) -> vec3f {
    var rgb = rgbIn;
    let knee = 0.90;
    let mx = max(rgb.x, max(rgb.y, rgb.z));
    if (mx <= knee) { return rgb; }
    let d = mx - knee;
    let mx2 = knee + (d * (1.0 - knee)) / (d + (1.0 - knee));
    let s = mx2 / max(mx, 1e-6);
    return rgb * s;
}

fn apply_lut(val: f32, offset: u32) -> f32 {
    let v = clamp01(val);
    let pos = v * 255.0;
    let idx = u32(pos);
    let f = fract(pos);
    let p0 = lut[offset + idx];
    let idxNext = min(idx + 1u, 255u);
    let p1 = lut[offset + idxNext];
    return mix(p0, p1, f);
}

fn interp_green_edge(xi: i32, yi: i32) -> f32 {
    let left = get_norm_pixel(xi - 1, yi);
    let right = get_norm_pixel(xi + 1, yi);
    let up = get_norm_pixel(xi, yi - 1);
    let down = get_norm_pixel(xi, yi + 1);
    let gradH = abs(left - right);
    let gradV = abs(up - down);
    if (gradH + 1e-6 < gradV) { return (left + right) * 0.5; }
    if (gradV + 1e-6 < gradH) { return (up + down) * 0.5; }
    return (left + right + up + down) * 0.25;
}

fn interp_diag_edge(xi: i32, yi: i32) -> f32 {
    let d1a = get_norm_pixel(xi - 1, yi - 1);
    let d1b = get_norm_pixel(xi + 1, yi + 1);
    let d2a = get_norm_pixel(xi + 1, yi - 1);
    let d2b = get_norm_pixel(xi - 1, yi + 1);
    let gradD1 = abs(d1a - d1b);
    let gradD2 = abs(d2a - d2b);
    if (gradD1 + 1e-6 < gradD2) { return (d1a + d1b) * 0.5; }
    if (gradD2 + 1e-6 < gradD1) { return (d2a + d2b) * 0.5; }
    return (d1a + d1b + d2a + d2b) * 0.25;
}

fn ratio_or_ha(center: f32, nearV: f32, farV: f32) -> f32 {
    let ratio = (2.0 * nearV) / (center + farV + 1e-6);
    let ha = nearV + 0.5 * (center - farV);
    if (abs(1.0 - ratio) < 0.75) { return center * ratio; }
    return ha;
}

fn amaze_green_rb(xi: i32, yi: i32) -> f32 {
    let c = get_norm_pixel(xi, yi);
    let gu = ratio_or_ha(c, get_norm_pixel(xi, yi - 1), get_norm_pixel(xi, yi - 2));
    let gd = ratio_or_ha(c, get_norm_pixel(xi, yi + 1), get_norm_pixel(xi, yi + 2));
    let gl = ratio_or_ha(c, get_norm_pixel(xi - 1, yi), get_norm_pixel(xi - 2, yi));
    let gr = ratio_or_ha(c, get_norm_pixel(xi + 1, yi), get_norm_pixel(xi + 2, yi));

    let wu = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi - 2) - c) + abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1)));
    let wd = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi + 2) - c) + abs(get_norm_pixel(xi, yi + 1) - get_norm_pixel(xi, yi - 1)));
    let wl = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 2, yi) - c) + abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi)));
    let wr = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 2, yi) - c) + abs(get_norm_pixel(xi + 1, yi) - get_norm_pixel(xi - 1, yi)));

    let gv = (wu * gu + wd * gd) / max(wu + wd, 1e-6);
    let gh = (wl * gl + wr * gr) / max(wl + wr, 1e-6);

    let gradH = abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi))
              + abs(get_norm_pixel(xi - 2, yi) - c)
              + abs(c - get_norm_pixel(xi + 2, yi));
    let gradV = abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1))
              + abs(get_norm_pixel(xi, yi - 2) - c)
              + abs(c - get_norm_pixel(xi, yi + 2));
    let wH = 1.0 / (1e-6 + gradH);
    let wV = 1.0 / (1e-6 + gradV);
    return (wH * gh + wV * gv) / max(wH + wV, 1e-6);
}

fn amaze_diag_rb(xi: i32, yi: i32) -> f32 {
    let c = get_norm_pixel(xi, yi);
    let ne = ratio_or_ha(c, get_norm_pixel(xi + 1, yi - 1), get_norm_pixel(xi + 2, yi - 2));
    let sw = ratio_or_ha(c, get_norm_pixel(xi - 1, yi + 1), get_norm_pixel(xi - 2, yi + 2));
    let nw = ratio_or_ha(c, get_norm_pixel(xi - 1, yi - 1), get_norm_pixel(xi - 2, yi - 2));
    let se = ratio_or_ha(c, get_norm_pixel(xi + 1, yi + 1), get_norm_pixel(xi + 2, yi + 2));
    let wp = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 1, yi - 1) - get_norm_pixel(xi - 1, yi + 1))
                         + abs(get_norm_pixel(xi + 2, yi - 2) - get_norm_pixel(xi - 2, yi + 2)));
    let wm = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 1, yi - 1) - get_norm_pixel(xi + 1, yi + 1))
                         + abs(get_norm_pixel(xi - 2, yi - 2) - get_norm_pixel(xi + 2, yi + 2)));
    return (wp * (ne + sw) + wm * (nw + se)) / max(2.0 * (wp + wm), 1e-6);
}

fn amaze_axis_g(xi: i32, yi: i32, horizontal: bool) -> f32 {
    let c = get_norm_pixel(xi, yi);
    if (horizontal) {
        let l = ratio_or_ha(c, get_norm_pixel(xi - 1, yi), get_norm_pixel(xi - 2, yi));
        let r = ratio_or_ha(c, get_norm_pixel(xi + 1, yi), get_norm_pixel(xi + 2, yi));
        let wl = 1.0 / (1e-6 + abs(get_norm_pixel(xi - 2, yi) - c) + abs(get_norm_pixel(xi - 1, yi) - get_norm_pixel(xi + 1, yi)));
        let wr = 1.0 / (1e-6 + abs(get_norm_pixel(xi + 2, yi) - c) + abs(get_norm_pixel(xi + 1, yi) - get_norm_pixel(xi - 1, yi)));
        return (wl * l + wr * r) / max(wl + wr, 1e-6);
    }
    let u0 = ratio_or_ha(c, get_norm_pixel(xi, yi - 1), get_norm_pixel(xi, yi - 2));
    let d0 = ratio_or_ha(c, get_norm_pixel(xi, yi + 1), get_norm_pixel(xi, yi + 2));
    let wu = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi - 2) - c) + abs(get_norm_pixel(xi, yi - 1) - get_norm_pixel(xi, yi + 1)));
    let wd = 1.0 / (1e-6 + abs(get_norm_pixel(xi, yi + 2) - c) + abs(get_norm_pixel(xi, yi + 1) - get_norm_pixel(xi, yi - 1)));
    return (wu * u0 + wd * d0) / max(wu + wd, 1e-6);
}
`,lse=`
    let x = global_id.x;
    let y = global_id.y;
    if (x >= u.width || y >= u.height) { return; }
    let idx = y * u.width + x;

    var finalR: f32 = 0.0;
    var finalG: f32 = 0.0;
    var finalB: f32 = 0.0;
    
    // We compute 'linear-ish' float values first. 
    // In standard modes, these are 0..1.

    // MODE 0: mosaic gray
    if (u.renderMode == 0u) {
        let rawVal = get_raw_val(idx);
        let bIdx = get_bayer_idx(x, y);
        var bl = 0.0; var wb = 1.0;
        if (bIdx == 0u) { bl = u.bl0; wb = u.wb0; }
        else if (bIdx == 1u) { bl = u.bl1; wb = u.wb1; }
        else if (bIdx == 2u) { bl = u.bl2; wb = u.wb2; }
        else { bl = u.bl3; wb = u.wb3; }

        let val = max(0.0, rawVal - bl);
        var norm = val / max(u.whiteLevel - bl, 1.0);
        norm = clamp01(norm * u.exposureScale * wb);
        // Note: Gamma is applied at output stage for modularity
        finalR = norm; finalG = norm; finalB = norm;
    }
    // MODE 2: advanced unmix
    else if (u.renderMode == 2u) {
        let rawVal = get_raw_val(idx);
        let bIdx = get_bayer_idx(x, y);
        var bl = 0.0; var bg = 0.0; var fg = 0.0;
        if (bIdx == 0u) { bl = unmix.bl0; bg = unmix.bg0; fg = unmix.fg0; }
        else if (bIdx == 1u) { bl = unmix.bl1; bg = unmix.bg1; fg = unmix.fg1; }
        else if (bIdx == 2u) { bl = unmix.bl2; bg = unmix.bg2; fg = unmix.fg2; }
        else { bl = unmix.bl3; bg = unmix.bg3; fg = unmix.fg3; }

        let ref_bg = (unmix.bg1 + unmix.bg3) * 0.5;
        let ref_fg = (unmix.fg1 + unmix.fg3) * 0.5;
        let img_linear = max(0.0, rawVal - bl);
        let denom = fg - bg;
        var alpha = 0.0;
        if (abs(denom) > 1e-9) { alpha = (img_linear - bg) / denom; }

        var val = 0.0;
        if (alpha < 0.0) { val = img_linear * (ref_bg / max(bg, 1e-9)); }
        else if (alpha > 1.0) { val = img_linear * (ref_fg / max(fg, 1e-9)); }
        else { val = (1.0 - alpha) * ref_bg + alpha * ref_fg; }

        var norm = clamp01((val * u.exposureScale) / 65535.0);
        finalR = norm; finalG = norm; finalB = norm;
    }
    // MODE 1: color (bilinear or AMaZE)
    else {
        let xi = i32(x); let yi = i32(y);
        let rowIsOdd = (yi & 1); let colIsOdd = (xi & 1);
        var isRed = false; var isBlue = false;
        if (rowIsOdd == 0 && colIsOdd == 0) {
            if (u.isBGGR == 1u) { isBlue = true; } else { isRed = true; }
        } else if (rowIsOdd == 1 && colIsOdd == 1) {
            if (u.isBGGR == 1u) { isRed = true; } else { isBlue = true; }
        }

        var r_lin: f32 = 0.0; var g_lin: f32 = 0.0; var b_lin: f32 = 0.0;
        let useAmaze = (u.colorDemosaicMode == 1u);
        if (isRed) {
            r_lin = get_norm_pixel(xi, yi);
            if (useAmaze) {
                g_lin = amaze_green_rb(xi, yi);
                b_lin = amaze_diag_rb(xi, yi);
            } else {
                g_lin = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1) + get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.25;
                b_lin = (get_norm_pixel(xi-1, yi-1) + get_norm_pixel(xi+1, yi-1) + get_norm_pixel(xi-1, yi+1) + get_norm_pixel(xi+1, yi+1)) * 0.25;
            }
        } else if (isBlue) {
            b_lin = get_norm_pixel(xi, yi);
            if (useAmaze) {
                g_lin = amaze_green_rb(xi, yi);
                r_lin = amaze_diag_rb(xi, yi);
            } else {
                g_lin = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1) + get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.25;
                r_lin = (get_norm_pixel(xi-1, yi-1) + get_norm_pixel(xi+1, yi-1) + get_norm_pixel(xi-1, yi+1) + get_norm_pixel(xi+1, yi+1)) * 0.25;
            }
        } else {
            g_lin = get_norm_pixel(xi, yi);
            var horizIsRed = false;
            if (rowIsOdd == 0) { horizIsRed = (u.isBGGR == 0u); }
            else { horizIsRed = (u.isBGGR == 1u); }
            if (useAmaze) {
                if (horizIsRed) {
                    r_lin = amaze_axis_g(xi, yi, true);
                    b_lin = amaze_axis_g(xi, yi, false);
                } else {
                    b_lin = amaze_axis_g(xi, yi, true);
                    r_lin = amaze_axis_g(xi, yi, false);
                }
            } else {
                let valH = (get_norm_pixel(xi-1, yi) + get_norm_pixel(xi+1, yi)) * 0.5;
                let valV = (get_norm_pixel(xi, yi-1) + get_norm_pixel(xi, yi+1)) * 0.5;
                if (horizIsRed) { r_lin = valH; b_lin = valV; }
                else { b_lin = valH; r_lin = valV; }
            }
        }

        // HLR
        if (u.hlrEnabled == 1u) {
            let targetWhite = vec3f(u.neutral0, u.neutral1, u.neutral2);
            let isBG = (u.isBGGR == 1u);
            let wbR = select(u.wb0, u.wb3, isBG); 
            let wbB = select(u.wb3, u.wb0, isBG);
            let r_s = r_lin / max(wbR, 1e-6);
            let g_s = g_lin;
            let b_s = b_lin / max(wbB, 1e-6);
            let mag_sensor = max(r_s, max(g_s, b_s));
            let mag_wb = max(r_lin, max(g_lin, b_lin));
            let hl_mask = smootherstep(0.85, 1.00, mag_sensor);
            if (hl_mask > 0.0) {
                let corrected = targetWhite * mag_wb;
                r_lin = mix(r_lin, corrected.x, hl_mask);
                g_lin = mix(g_lin, corrected.y, hl_mask);
                b_lin = mix(b_lin, corrected.z, hl_mask);
            }
        }

        // Matrix
        var rr = u.cm0*r_lin + u.cm1*g_lin + u.cm2*b_lin;
        var gg = u.cm3*r_lin + u.cm4*g_lin + u.cm5*b_lin;
        var bb = u.cm6*r_lin + u.cm7*g_lin + u.cm8*b_lin;

        // Exposure
        rr *= u.exposureScale;
        gg *= u.exposureScale;
        bb *= u.exposureScale;

        // Shoulder
        var rgb2 = shoulder_hue_preserve(vec3f(rr, gg, bb));

        // Curves
        let rgbPos = max(rgb2, vec3f(0.0));
        let luma = dot(rgbPos, vec3f(0.2126, 0.7152, 0.0722));
        let luma2 = apply_lut(luma, 0u);
        var masterScale = 1.0;
        if (luma > 1e-6) { masterScale = luma2 / luma; }
        let mr = rgb2.x * masterScale;
        let mg = rgb2.y * masterScale;
        let mb = rgb2.z * masterScale;

        finalR = apply_lut(mr, 256u);
        finalG = apply_lut(mg, 512u);
        finalB = apply_lut(mb, 768u);
    }
`;function K4(e){let t="",r="";return e==="display"?(t="@group(0) @binding(2) var<storage, read_write> output : array<u32>;",r=`
            // Standard Display Output (Always sRGB Gamma + 8-bit Packing)
            let r_gamma = srgb_gamma(clamp01(finalR));
            let g_gamma = srgb_gamma(clamp01(finalG));
            let b_gamma = srgb_gamma(clamp01(finalB));

            let r8 = u32(r_gamma * 255.0 + 0.5);
            let g8 = u32(g_gamma * 255.0 + 0.5);
            let b8 = u32(b_gamma * 255.0 + 0.5);
            let a8 = 255u;
            output[idx] = (a8 << 24u) | (b8 << 16u) | (g8 << 8u) | r8;
        `):(t="@group(0) @binding(2) var<storage, read_write> output : array<u32>;",r=`
            var r_out = clamp01(finalR);
            var g_out = clamp01(finalG);
            var b_out = clamp01(finalB);

            if (u.exportSrgb == 1u) {
                r_out = srgb_gamma(r_out);
                g_out = srgb_gamma(g_out);
                b_out = srgb_gamma(b_out);
            }

            var scale = 65535.0;
            if (u.exportStretch == 0u) {
                // Approximate raw magnitude restoration
                // get_norm_pixel divided by (White - Black)
                // So multiply by that range to restore DNs
                // Average green BL? Just use bl0 for simplicity or max range
                let bl = u.bl0; 
                scale = max(u.whiteLevel - bl, 1.0);
            }

            let r16 = u32(min(65535.0, r_out * scale));
            let g16 = u32(min(65535.0, g_out * scale));
            let b16 = u32(min(65535.0, b_out * scale));
            let a16 = 65535u; // Fully opaque

            // Pack: Little Endian logic
            // RG pack: (G << 16) | R
            // BA pack: (A << 16) | B
            
            let packedRG = (g16 << 16u) | r16;
            let packedBA = (a16 << 16u) | b16;

            output[idx * 2u] = packedRG;
            output[idx * 2u + 1u] = packedBA;
        `),`
        ${sse}
        ${t}
        @compute @workgroup_size(16, 16)
        fn main(@builtin(global_invocation_id) global_id : vec3u) {
            ${lse}
            ${r}
        }
    `}class cse{constructor(){fr(this,"device",null);fr(this,"displayPipeline",null);fr(this,"exportPipeline",null);fr(this,"resources",new Map);fr(this,"uniformBuffer",null);fr(this,"unmixParamsBuffer",null);fr(this,"lutBuffer",null);fr(this,"isInitialized",!1)}async init(){if(this.isInitialized)return!0;if(!navigator.gpu)return console.warn("WebGPU not supported."),!1;try{const t=await navigator.gpu.requestAdapter();if(!t)throw new Error("No GPU adapter found.");const r={};t.limits.maxStorageBufferBindingSize&&(r.maxStorageBufferBindingSize=1024*1024*1024),t.limits.maxBufferSize&&(r.maxBufferSize=1024*1024*1024),this.device=await t.requestDevice({requiredLimits:r});const n=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:4,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]}),a=this.device.createShaderModule({code:K4("display")});this.displayPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[n]}),compute:{module:a,entryPoint:"main"}});const i=this.device.createShaderModule({code:K4("export")});return this.exportPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[n]}),compute:{module:i,entryPoint:"main"}}),this.uniformBuffer=this.device.createBuffer({size:256,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.unmixParamsBuffer=this.device.createBuffer({size:64,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.lutBuffer=this.device.createBuffer({size:4096,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),this.isInitialized=!0,console.log("WebGPU Renderer Initialized"),!0}catch(t){return console.error("WebGPU Init Failed:",t),!1}}hasImage(t){return this.resources.has(t)}async uploadImage(t,r,n,a,i){if(this.isInitialized||await this.init(),!!this.device){if(this.resources.has(t)){const o=this.resources.get(t);if(o&&o.width===n&&o.height===a)return;this.disposeImage(t)}try{const o=n*a,s=Math.ceil(o*2/4)*4,l=this.device.createBuffer({size:s,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST,mappedAtCreation:!0});new Uint16Array(l.getMappedRange()).set(r),l.unmap();const u=o*4,d=this.device.createBuffer({size:u,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),f=this.device.createBuffer({size:u,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),h=this.device.createBindGroup({layout:this.displayPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:l}},{binding:2,resource:{buffer:d}},{binding:3,resource:{buffer:this.unmixParamsBuffer}},{binding:4,resource:{buffer:this.lutBuffer}}]}),p=i??ose(r);this.resources.set(t,{width:n,height:a,rawBuffer:l,outputBuffer:d,readBuffer:f,bindGroup:h,whiteLevel:p,busy:!1})}catch(o){console.error("[WebGPU] Buffer creation failed",o)}}}updateUniforms(t,r,n,a){const i=Math.pow(2,r.exposure),o=r.blackLevel||[0,0,0,0],s=r.wbGains||[1,1];let l=65532;r.highlightRecovery&&(l=r.customWhiteLevel??t.whiteLevel??16383);let u=[1,1,1,1];r.isBGGR?u=[s[1],1,1,s[0]]:u=[s[0],1,1,s[1]];let d=[[1,0,0],[0,1,0],[0,0,1]],f=[1,0,0,0,1,0,0,0,1],h=null;if(r.customMatrix&&r.customMatrix.length===9){const v=[[r.customMatrix[0],r.customMatrix[1],r.customMatrix[2]],[r.customMatrix[3],r.customMatrix[4],r.customMatrix[5]],[r.customMatrix[6],r.customMatrix[7],r.customMatrix[8]]],M=Ro(v);M&&(d=Kc(ise,M),f=[d[0][0],d[0][1],d[0][2],d[1][0],d[1][1],d[1][2],d[2][0],d[2][1],d[2][2]],h=Ro(d))}const p=f;let x=0;r.renderMode==="zero-dep-color"&&(x=1),r.renderMode==="advanced-zero-dep"&&(x=2);const b=r.zeroDepColorDemosaic==="bilinear"?0:1;let y=[1,1,1];if(h){y=M_(h,[1,1,1]);const v=Math.max(Math.abs(y[0]),Math.max(Math.abs(y[1]),Math.abs(y[2])));v>1e-6?y=[y[0]/v,y[1]/v,y[2]/v]:y=[1,1,1]}const m=new Float32Array([0,0,l,i,o[0],o[1],o[2],o[3],u[0],u[1],u[2],u[3],p[0],p[1],p[2],p[3],p[4],p[5],p[6],p[7],p[8],0,0,0,y[0],y[1],y[2],0,0,0]),g=new Uint32Array(m.buffer);g[0]=t.width,g[1]=t.height,g[21]=x,g[22]=r.isBGGR?1:0,g[23]=b,g[27]=1,g[28]=a.stretch?1:0,g[29]=a.srgb?1:0,this.device.queue.writeBuffer(this.uniformBuffer,0,m);const k=new Float32Array(16);if(x===2&&r.advancedZeroDep){const v=r.advancedZeroDep;k.set([v.bl[0],v.bl[1],v.bl[2],v.bl[3],Math.max(0,v.bg[0]-v.bl[0]),Math.max(0,v.bg[1]-v.bl[1]),Math.max(0,v.bg[2]-v.bl[2]),Math.max(0,v.bg[3]-v.bl[3]),Math.max(0,v.fg[0]-v.bl[0]),Math.max(0,v.fg[1]-v.bl[1]),Math.max(0,v.fg[2]-v.bl[2]),Math.max(0,v.fg[3]-v.bl[3])])}this.device.queue.writeBuffer(this.unmixParamsBuffer,0,k);const S=new Float32Array(1024),w=r.curves||{master:[{x:0,y:0},{x:1,y:1}],red:[{x:0,y:0},{x:1,y:1}],green:[{x:0,y:0},{x:1,y:1}],blue:[{x:0,y:0},{x:1,y:1}]};S.set(ca(w.master),0),S.set(ca(w.red),256),S.set(ca(w.green),512),S.set(ca(w.blue),768),this.device.queue.writeBuffer(this.lutBuffer,0,S)}async render(t,r,n){if(this.isInitialized||await this.init(),!this.device||!this.displayPipeline)return null;const a=this.resources.get(t);if(!a||a.busy)return null;a.busy=!0;try{this.updateUniforms(a,r,!1,{stretch:!1,srgb:!0});const i=this.device.createCommandEncoder(),o=i.beginComputePass();o.setPipeline(this.displayPipeline),o.setBindGroup(0,a.bindGroup),o.dispatchWorkgroups(Math.ceil(a.width/16),Math.ceil(a.height/16)),o.end(),i.copyBufferToBuffer(a.outputBuffer,0,a.readBuffer,0,a.width*a.height*4),this.device.queue.submit([i.finish()]),await a.readBuffer.mapAsync(GPUMapMode.READ);const s=new Uint8ClampedArray(a.readBuffer.getMappedRange()),l=new ImageData(new Uint8ClampedArray(s),a.width,a.height);return a.readBuffer.unmap(),l}catch(i){console.error("WebGPU Render Error",i);try{a.readBuffer.unmap()}catch{}return null}finally{a.busy=!1}}async export16Bit(t,r,n,a){if(this.isInitialized||await this.init(),!this.device||!this.exportPipeline)return null;const i=this.resources.get(t);if(!i)return null;const o=i.width*i.height*8,s=this.device.createBuffer({size:o,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),l=this.device.createBuffer({size:o,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST}),u=this.device.createBindGroup({layout:this.exportPipeline.getBindGroupLayout(0),entries:[{binding:0,resource:{buffer:this.uniformBuffer}},{binding:1,resource:{buffer:i.rawBuffer}},{binding:2,resource:{buffer:s}},{binding:3,resource:{buffer:this.unmixParamsBuffer}},{binding:4,resource:{buffer:this.lutBuffer}}]});this.updateUniforms(i,r,!0,{stretch:n,srgb:a});const d=this.device.createCommandEncoder(),f=d.beginComputePass();f.setPipeline(this.exportPipeline),f.setBindGroup(0,u),f.dispatchWorkgroups(Math.ceil(i.width/16),Math.ceil(i.height/16)),f.end(),d.copyBufferToBuffer(s,0,l,0,o),this.device.queue.submit([d.finish()]),await l.mapAsync(GPUMapMode.READ);const h=new Uint32Array(l.getMappedRange()),p=i.width*i.height,x=new Uint16Array(p*3);for(let b=0;b<p;b++){const y=h[b*2],m=h[b*2+1],g=y&65535,k=y>>>16&65535,S=m&65535;x[b*3]=g,x[b*3+1]=k,x[b*3+2]=S}return l.unmap(),s.destroy(),l.destroy(),x}disposeImage(t){const r=this.resources.get(t);r&&(r.rawBuffer.destroy(),r.outputBuffer.destroy(),r.readBuffer.destroy(),this.resources.delete(t))}disposeAll(){this.resources.forEach(t=>{t.rawBuffer.destroy(),t.outputBuffer.destroy(),t.readBuffer.destroy()}),this.resources.clear()}}const Ha=new cse,bo=-1,Kx=-2,Y4=/\.(arw|cr2|cr3|dng|nef|orf|raf|rw2|pef|srw|sr2|srf|x3f|erf|mef|mos|mrw|kdc|dcr|iiq|3fr|fff|rwl|nrw|raw)$/i,use=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Ascii = (2,1); Byte = (1,1)
    Srational = (10,8)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevelRepeatDim = (50713, Type.Short)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 10:
            flat = [item for sublist in value for item in sublist]  # [[num,den]...]
            return struct.pack('<%sl' % len(flat), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def pack_dng_from_u16(raw_u16_bytes_le, width, height, cfa_str, black_level_list, cm_flat, make_str, model_str, unique_model_str):
    raw_data = np.frombuffer(raw_u16_bytes_le, dtype=np.uint16).copy()
    raw_data = raw_data.astype(np.int32)
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    white_level = 65019
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]
    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}

    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]),
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, make_str),
        dngTag(Tag.Model, model_str),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]),
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, unique_model_str),
    ]

    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0]))
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)

    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size

    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC

    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break

    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))

    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12

    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)

    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`;let Yx=null;async function dse(e){return Yx||(Yx=(async()=>{if(!window.loadPyodide)throw new Error("Pyodide missing: window.loadPyodide not found.");e==null||e("Loading Pyodide...");const t=await window.loadPyodide();return e==null||e("Loading numpy..."),await t.loadPackage("numpy"),e==null||e("Init DNG writer kernel..."),await t.runPythonAsync(use),t})()),Yx}const yn=(e,t,r)=>e<t?t:e>r?r:e,eg=e=>{const t=String(e||"RGGB").toUpperCase();return t.length>=4?t.slice(0,4):"RGGB"},q4=(e,t,r)=>{const n=(r&1)<<1|t&1;return e[n]||"G"};function Z4(e,t,r,n,a){const i=t*r;if(n&&e.length>=i*3){const u=new Float32Array(i*3),d=new Uint16Array(i),f=a[0]||0,h=a[1]||0,p=a[3]||0;for(let x=0,b=0;x<i;x++,b+=3)u[b]=e[b]-f,u[b+1]=e[b+1]-h,u[b+2]=e[b+2]-p,d[x]=e[b+1];return{workF32:u,maskU16:d,channels:3}}const o=new Float32Array(i),s=new Uint16Array(i);let l=0;for(let u=0;u<r;u++){const d=(u&1)<<1;for(let f=0;f<t;f++){const h=d|f&1;o[l]=e[l]-a[h],s[l]=e[l],l++}}return{workF32:o,maskU16:s,channels:1}}function fse(e,t,r,n){const a=t*r,i=new Uint16Array(a);let o=0;for(let s=0;s<r;s++){const l=(s&1)<<1;for(let u=0;u<t;u++){const d=l|u&1;let f=e[o]+n[d];f<0&&(f=0),f>65535&&(f=65535),i[o]=f+.5|0,o++}}return i}function hse(e,t,r,n){const a=t*r,i=new Float32Array(a);let o=0;for(let s=0;s<r;s++){const l=(s&1)<<1;for(let u=0;u<t;u++){const d=l|u&1;i[o]=e[o]+n[d],o++}}return i}function pse(e){const{width:t,height:r,channels:n,workF32:a}=e,i=t*r;if(n===3){const l=new Float32Array(i);for(let u=0,d=0;u<i;u++,d+=3)l[u]=a[d+1];return l}const o=new Float32Array(i),s=eg(e.cfaPattern);for(let l=0;l<r;l++)for(let u=0;u<t;u++){const d=l*t+u;if(q4(s,u,l)==="G"){o[d]=a[d];continue}let f=0,h=0;const p=[u-1,u+1,u,u],x=[l,l,l-1,l+1];for(let b=0;b<4;b++){const y=p[b],m=x[b];y<0||m<0||y>=t||m>=r||q4(s,y,m)==="G"&&(f+=a[m*t+y],h++)}o[d]=h>0?f/h:a[d]}return o}async function gse(e,t){if(e.channels!==1||e.isThreePlane||typeof navigator>"u"||!navigator.gpu||!await Ha.init())return null;const n=`stack-guide-amaze-${Date.now()}-${Math.random().toString(36).slice(2)}-${e.key}`;try{await Ha.uploadImage(n,e.origMaskU16,e.width,e.height);const a=await Ha.render(n,{exposure:0,demosaicMethod:-1,blackLevel:[t[0],t[1],t[2],t[3]],wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dep-color",isBGGR:eg(e.cfaPattern)==="BGGR",zeroDepColorDemosaic:"amaze"},65535);if(!a)return null;const i=e.width*e.height,o=new Float32Array(i),s=a.data;for(let l=0,u=0;l<i;l++,u+=4)o[l]=s[u+1]/255;return o}catch{return null}finally{Ha.hasImage(n)&&Ha.disposeImage(n)}}function J4(e,t){if(t<=1)return 0;let r=e;for(;r<0||r>=t;)r=r<0?-r-1:2*t-1-r;return r}function mse(e){const t=Math.max(.001,e),r=Math.max(1,Math.ceil(3*t)),n=new Float32Array(r*2+1);let a=0;for(let i=-r;i<=r;i++){const o=Math.exp(-(i*i)/(2*t*t));n[i+r]=o,a+=o}if(a>0)for(let i=0;i<n.length;i++)n[i]/=a;return n}function zO(e,t,r,n){const a=mse(n),i=a.length-1>>1,o=new Float32Array(t*r),s=new Float32Array(t*r);for(let l=0;l<r;l++){const u=l*t;for(let d=0;d<t;d++){let f=0;for(let h=-i;h<=i;h++){const p=J4(d+h,t);f+=e[u+p]*a[h+i]}o[u+d]=f}}for(let l=0;l<r;l++)for(let u=0;u<t;u++){let d=0;for(let f=-i;f<=i;f++){const h=J4(l+f,r);d+=o[h*t+u]*a[f+i]}s[l*t+u]=d}return s}function xse(e,t,r,n){if(n<=1)return{data:e,w:t,h:r};const a=zO(e,t,r,n*.5),i=Math.max(1,Math.floor(t/n)),o=Math.max(1,Math.floor(r/n)),s=new Float32Array(i*o);for(let l=0;l<o;l++){const d=l*n*t;for(let f=0;f<i;f++)s[l*i+f]=a[d+f*n]}return{data:s,w:i,h:o}}const Xa={factors:[1,2,4,4],tileSizes:[16,16,16,8],searchRadii:[1,4,4,4],metrics:["L1","L2","L2","L2"],subpixels:[!1,!1,!1,!1],icaIter:3,icaSigmaBlur:0,robustnessMotionThreshold:20,robustnessConfFloor:.65,confidenceBlendStrength:0};function yse(e,t,r,n=0){const a=n>1e-6?zO(e,t,r,n):e,i=new Float32Array(t*r),o=new Float32Array(t*r);for(let s=0;s<r;s++){const l=s>0?s-1:s,u=s+1<r?s+1:s;for(let d=0;d<t;d++){const f=d>0?d-1:d,h=d+1<t?d+1:d,p=s*t+d;i[p]=.5*(a[s*t+h]-a[s*t+f]),o[p]=.5*(a[u*t+d]-a[l*t+d])}}return{gx:i,gy:o}}function qx(e,t,r,n,a,i,o,s,l){let u=0;for(let d=0;d<o;d++){const h=(i+d)*r+a;for(let p=0;p<o;p++){const x=e[h+p],b=a+p+s,y=i+d+l,m=Cc(t,r,n,1,b,y,0),g=x-m;u+=g*g}}return u}function bse(e,t,r,n,a,i,o,s,l,u,d,f){let h=0,p=0,x=0;for(let v=0;v<l;v++){const M=(s+v)*a+o;for(let _=0;_<l;_++){const P=M+_,A=r[P],R=n[P];h+=A*A,p+=A*R,x+=R*R}}h+=1e-6,x+=1e-6;const b=h*x-p*p;if(!Number.isFinite(b)||Math.abs(b)<1e-9)return{dx:u,dy:d};const y=x/b,m=-p/b,g=h/b;let k=u,S=d,w=qx(e,t,a,i,o,s,l,k,S);for(let v=0;v<f;v++){let M=0,_=0;for(let N=0;N<l;N++){const C=(s+N)*a+o;for(let B=0;B<l;B++){const I=C+B,z=e[I],K=Cc(t,a,i,1,o+B+k,s+N+S,0)-z,q=r[I],G=n[I];M+=q*K,_+=G*K}}let P=y*M+m*_,A=m*M+g*_;const R=Math.hypot(P,A);if(!Number.isFinite(R)||R<1e-5)break;if(R>1){const N=1/R;P*=N,A*=N}const D=k-P,E=S-A,W=qx(e,t,a,i,o,s,l,D,E);if(W<=w){k=D,S=E,w=W;continue}const F=k-.5*P,O=S-.5*A,$=qx(e,t,a,i,o,s,l,F,O);if($<=w){k=F,S=O,w=$;continue}break}return{dx:k,dy:S}}function Q4(e,t,r){const n=Xa.factors,a=[{data:e,w:t,h:r,scale:1}];let i=a[0];for(let o=1;o<n.length;o++){const s=n[o];i={...xse(i.data,i.w,i.h,s),scale:i.scale*s},a.push(i)}return a.reverse()}function vse(e){const t=[.25,-.5,.25,.5,-1,.5,.25,-.5,.25],r=[.25,.5,.25,-.5,-1,-.5,.25,.5,.25],n=[.25,0,-.25,0,0,0,-.25,0,.25],a=[-.125,0,.125,-.25,0,.25,-.125,0,.125],i=[-.125,-.25,-.125,0,0,0,.125,.25,.125];let o=0,s=0,l=0,u=0,d=0;for(let b=0;b<9;b++){const y=e[b];o+=t[b]*y,s+=n[b]*y,l+=r[b]*y,u+=a[b]*y,d+=i[b]*y}o=Math.max(0,o),l=Math.max(0,l),o*l-s*s<0&&(s=0);const f=o*l-s*s;if(Math.abs(f)<1e-12)return{dx:0,dy:0};const h=-(o*d-s*u)/f,p=-(l*u-s*d)/f;return Math.hypot(p,h)>=1?{dx:0,dy:0}:{dx:p,dy:h}}function wse(e,t,r,n,a,i,o,s,l,u,d="invalid",f=65535){let h=a+s,p=i+l;if(d==="clip")h=yn(h,0,Math.max(0,r-o)),p=yn(p,0,Math.max(0,n-o));else if(d==="invalid"&&(h<0||p<0||h+o>r||p+o>n))return Number.POSITIVE_INFINITY;const x=Math.trunc(h),b=Math.trunc(p);let y=0;for(let m=0;m<o;m++){const k=(i+m)*r+a,S=b+m;for(let w=0;w<o;w++){const v=e[k+w],M=x+w;let _;S>=0&&S<n&&M>=0&&M<r?_=t[S*r+M]:_=d==="pad"?f:0;const P=v-_;y+=u?Math.abs(P):P*P}}return y}function WO(e,t,r){const n=Math.max(1,r),a=Math.max(0,Math.floor(t/n));return{gw:Math.max(0,Math.floor(e/n)),gh:a,step:n}}function kse(e,t,r,n,a,i){const o=WO(t.w,t.h,a);if(o.gw<=0||o.gh<=0)return new Float32Array(0);const s=e.gw,l=e.gh;if(s<=0||l<=0||i<=0)return new Float32Array(o.gw*o.gh*2);const u=new Float32Array(e.vectors.length);for(let p=0;p<e.vectors.length;p++)u[p]=e.vectors[p]*n;const d=Math.max(1,Math.floor(a/i)),f=Math.max(1,Math.floor(n/d)),h=new Float32Array(o.gw*o.gh*2);for(let p=0;p<o.gh;p++){const x=Math.floor(p/f);if(!(x<0||x>=l))for(let b=0;b<o.gw;b++){const y=Math.floor(b/f);if(y<0||y>=s)continue;const m=(x*s+y)*2,g=(p*o.gw+b)*2;h[g]=u[m],h[g+1]=u[m+1]}}return h}function Sse(e,t,r,n,a,i,o,s,l,u,d,f){const h=WO(e.w,e.h,n),{gw:p,gh:x,step:b}=h,y=new Float32Array(p*x*2);if(p<=0||x<=0)return{vectors:y,gw:p,gh:x,tileSize:n};let m=new Float32Array(p*x*2);l&&a&&(m=kse(l,e,t,r,n,a));const g=2*i+1,k=o==="L1",S="invalid",w=new Float64Array(g*g),v=!!u&&!!d;for(let M=0;M<x;M++)for(let _=0;_<p;_++){const P=(M*p+_)*2,A=Math.round(m[P]),R=Math.round(m[P+1]),D=M*b,E=_*b;let W=0,F=Number.POSITIVE_INFINITY,O=0;for(let I=-i;I<=i;I++)for(let z=-i;z<=i;z++,O++){const V=A+I,K=R+z,q=wse(e.data,t.data,e.w,e.h,E,D,n,K,V,k,S,0);w[O]=q,q<F&&(F=q,W=O)}if(!Number.isFinite(F)){y[P]=m[P],y[P+1]=m[P+1];continue}const $=Math.floor(W/g),N=W-$*g;let C=A+($-i),B=R+(N-i);if(s&&N>0&&N<g-1&&$>0&&$<g-1){const I=[w[($-1)*g+(N-1)],w[($-1)*g+N],w[($-1)*g+(N+1)],w[$*g+(N-1)],w[$*g+N],w[$*g+(N+1)],w[($+1)*g+(N-1)],w[($+1)*g+N],w[($+1)*g+(N+1)]],z=vse(I);C+=z.dy,B+=z.dx}if(v){const I=bse(e.data,t.data,u,d,e.w,e.h,E,D,n,B,C,f);B=I.dx,C=I.dy}y[P]=C,y[P+1]=B}return{vectors:y,gw:p,gh:x,tileSize:n}}function ej(e,t,r){const n=Math.max(1,Math.floor(t*.5)),a=Math.max(1,Math.floor(r*.5)),i=new Float32Array(n*a);for(let o=0;o<a;o++)for(let s=0;s<n;s++){const l=s*2,u=o*2,d=u*t+l,f=u*t+Math.min(t-1,l+1),h=Math.min(r-1,u+1)*t+l,p=Math.min(r-1,u+1)*t+Math.min(t-1,l+1);i[o*n+s]=.25*(e[d]+e[f]+e[h]+e[p])}return{data:i,w:n,h:a}}function jse(e,t,r){const n=new Float32Array(t*r),a=new Float32Array(t*r);if(e.gw<=0||e.gh<=0)return{flowX:n,flowY:a};const i=Math.max(1,e.tileSize);for(let o=0;o<r;o++){const s=yn(Math.floor(o/i),0,e.gh-1);for(let l=0;l<t;l++){const u=yn(Math.floor(l/i),0,e.gw-1),d=(s*e.gw+u)*2,f=o*t+l;n[f]=e.vectors[d+1],a[f]=e.vectors[d]}}return{flowX:n,flowY:a}}function Mse(e,t){const{gw:r,gh:n,vectors:a}=e,i=new Float32Array(r*n);if(r<=0||n<=0)return i;const o=Math.max(1e-6,t),s=yn(Xa.robustnessConfFloor,0,1);for(let l=0;l<n;l++)for(let u=0;u<r;u++){let d=Number.POSITIVE_INFINITY,f=Number.POSITIVE_INFINITY,h=Number.NEGATIVE_INFINITY,p=Number.NEGATIVE_INFINITY;for(let y=-1;y<=1;y++){const m=yn(l+y,0,n-1);for(let g=-1;g<=1;g++){const k=yn(u+g,0,r-1),S=(m*r+k)*2,w=a[S],v=a[S+1];v<d&&(d=v),v>h&&(h=v),w<f&&(f=w),w>p&&(p=w)}}const x=Math.hypot(h-d,p-f),b=l*r+u;if(x<=o)i[b]=1;else{const y=(x-o)/(o*.8),m=Math.exp(-.5*y*y);i[b]=Math.max(s,m)}}return i}function _se(e,t,r,n){return e}function Pse(e,t,r,n,a,i){const o=new Float32Array(a*i);if(t<=0||r<=0)return o;const s=Math.max(1,n);for(let l=0;l<i;l++){const u=yn(Math.floor(l/s),0,r-1);for(let d=0;d<a;d++){const f=yn(Math.floor(d/s),0,t-1);o[l*a+d]=e[u*t+f]}}return o}function Nse(e,t,r,n){const{width:a,height:i,channels:o}=e,s=a*i;if(s<=0)return{validRatio:0,oobRatio:0,meanConfOnValid:0,effectiveRatio:0,strongRatio:0};let l=0,u=0,d=0,f=0,h=0;for(let g=0;g<i;g++){const k=g*a;for(let S=0;S<a;S++){const w=k+S,v=S+t[w],M=g+r[w];if(!(o===1?HO(v,M,a,i,S&1,g&1):VO(v,M,a,i))){u++;continue}l++;const P=n?yn(n[w],0,1):1,A=yn(Xa.confidenceBlendStrength,0,1),R=1-A+A*P;d+=P,f+=R,R>=.5&&h++}}const p=l/s,x=u/s,b=l>0?d/l:0,y=f/s,m=h/s;return{validRatio:p,oobRatio:x,meanConfOnValid:b,effectiveRatio:y,strongRatio:m}}function Cse(e,t,r,n,a=null){const{width:i,height:o,channels:s}=e,l=i*o,u=new Float32Array(l*s),d=new Uint16Array(l),f=n.width===i&&n.height===o&&n.channels===s,h=f?n.workF32:e.workF32,p=f?n.origMaskU16:e.origMaskU16;if(s===3)for(let x=0;x<o;x++){const b=x*i;for(let y=0;y<i;y++){const m=b+y,g=y+t[m],k=x+r[m],S=m*3;if(VO(g,k,i,o)){const v=a?yn(a[m],0,1):1,M=yn(Xa.confidenceBlendStrength,0,1),_=1-M+M*v,P=Cc(e.workF32,i,o,3,g,k,0),A=Cc(e.workF32,i,o,3,g,k,1),R=Cc(e.workF32,i,o,3,g,k,2);u[S]=P*_+h[S]*(1-_),u[S+1]=A*_+h[S+1]*(1-_),u[S+2]=R*_+h[S+2]*(1-_);const E=Cc(e.origMaskU16,i,o,1,g,k,0)*_+p[m]*(1-_);d[m]=yn(Math.round(E),0,65535)}else u[S]=h[S],u[S+1]=h[S+1],u[S+2]=h[S+2],d[m]=p[m]}}else for(let x=0;x<o;x++){const b=x*i;for(let y=0;y<i;y++){const m=b+y,g=y+t[m],k=x+r[m],S=y&1,w=x&1;if(HO(g,k,i,o,S,w)){const M=a?yn(a[m],0,1):1,_=yn(Xa.confidenceBlendStrength,0,1),P=1-_+_*M,A=tj(e.workF32,i,o,g,k,S,w);u[m]=A*P+h[m]*(1-P);const D=tj(e.origMaskU16,i,o,g,k,S,w)*P+p[m]*(1-P);d[m]=yn(Math.round(D),0,65535)}else u[m]=h[m],d[m]=p[m]}}e.workF32=u,e.origMaskU16=d}function Ose(e,t,r,n,a,i){const o=Xa.tileSizes,s=Xa.searchRadii,l=Xa.metrics,u=Xa.subpixels;let d=e,f=t,h=r,p=n,x=1,b=1;if(a){const A=ej(e,r,n),R=ej(t,r,n);d=A.data,f=R.data,h=A.w,p=A.h,x=2,b=2}const y=Q4(d,h,p),m=Q4(f,h,p),g=Math.min(y.length,o.length);let k=null,S=0,w=-1/0;for(let A=0;A<g;A++){const R=y[A],D=m[A],E=o.length-1-A,W=o[E],F=s[E],O=l[E],$=u[E],N=k?Math.max(1,Math.round(S/R.scale)):1,C=yse(R.data,R.w,R.h,Xa.icaSigmaBlur),B=Sse(R,D,N,W,k?k.tileSize:null,F,O,$,k,C.gx,C.gy,Xa.icaIter);if(k=B,S=R.scale,B.vectors.length>0){let I=0;for(let z=0;z<B.vectors.length;z+=2)I+=Math.hypot(B.vectors[z+1],B.vectors[z]);w=I/Math.max(1,B.vectors.length/2)}}if(!k||k.vectors.length===0)return{flowX:new Float32Array(r*n),flowY:new Float32Array(r*n),flowConf:new Float32Array(r*n),score:-1/0};if(x!==1)for(let A=0;A<k.vectors.length;A++)k.vectors[A]*=x;const v=jse({vectors:k.vectors,gw:k.gw,gh:k.gh,tileSize:k.tileSize*b},r,n),M=Mse({vectors:k.vectors,gw:k.gw,gh:k.gh,tileSize:k.tileSize},typeof i=="number"&&Number.isFinite(i)?Math.max(.1,i):Xa.robustnessMotionThreshold),_=_se(M,k.gw,k.gh),P=Pse(_,k.gw,k.gh,k.tileSize*b,r,n);return{flowX:v.flowX,flowY:v.flowY,flowConf:P,score:w}}function Cc(e,t,r,n,a,i,o){const s=yn(a,0,t-1),l=yn(i,0,r-1),u=Math.floor(s),d=Math.floor(l),f=Math.min(t-1,u+1),h=Math.min(r-1,d+1),p=s-u,x=l-d,b=(d*t+u)*n+o,y=(d*t+f)*n+o,m=(h*t+u)*n+o,g=(h*t+f)*n+o,k=e[b]*(1-p)+e[y]*p,S=e[m]*(1-p)+e[g]*p;return k*(1-x)+S*x}function tj(e,t,r,n,a,i,o){const s=Math.floor((t-1-i)/2)+1,l=Math.floor((r-1-o)/2)+1;let u=(n-i)/2,d=(a-o)/2;u=yn(u,0,s-1),d=yn(d,0,l-1);const f=Math.floor(u),h=Math.floor(d),p=Math.min(s-1,f+1),x=Math.min(l-1,h+1),b=u-f,y=d-h,m=i+f*2,g=i+p*2,k=o+h*2,S=o+x*2,w=k*t+m,v=k*t+g,M=S*t+m,_=S*t+g,P=e[w]*(1-b)+e[v]*b,A=e[M]*(1-b)+e[_]*b;return P*(1-y)+A*y}function VO(e,t,r,n){return e>=0&&e<=r-1&&t>=0&&t<=n-1}function HO(e,t,r,n,a,i){const o=a+2*Math.floor((r-1-a)*.5),s=i+2*Math.floor((n-1-i)*.5);return e>=a&&e<=o&&t>=i&&t<=s}function Ase(e){const t=new Uint16Array([255]);if(new Uint8Array(t.buffer)[0]===255)return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);const n=new Uint8Array(e.length*2),a=new DataView(n.buffer);for(let i=0;i<e.length;i++)a.setUint16(i*2,e[i],!0);return n}function Tse(e){const t=e.trim(),r=[];let n=0;const a=d=>d>="0"&&d<="9",i=d=>d>="A"&&d<="Z"||d>="a"&&d<="z";for(;n<t.length;){const d=t[n];if(d<=" "){n++;continue}if(d==="("){r.push({t:"lp"}),n++;continue}if(d===")"){r.push({t:"rp"}),n++;continue}if(d===","){r.push({t:"comma"}),n++;continue}if(d==="+"&&t[n+1]==="+"){r.push({t:"op",v:"++"}),n+=2;continue}if(d==="+"){r.push({t:"op",v:"+"}),n++;continue}if(d==="-"){r.push({t:"op",v:"-"}),n++;continue}if(d==="*"){r.push({t:"op",v:"*"}),n++;continue}if(d==="/"){r.push({t:"op",v:"/"}),n++;continue}if(a(d)||d==="."){let f=n+1;for(;f<t.length&&(a(t[f])||t[f]===".");)f++;const h=Number(t.slice(n,f));if(!Number.isFinite(h))throw new Error(`Bad number: ${t.slice(n,f)}`);r.push({t:"num",v:h}),n=f;continue}if(i(d)){let f=n+1;for(;f<t.length&&i(t[f]);)f++;const h=t.slice(n,f).toUpperCase();let p=f;for(;p<t.length&&t[p]<=" ";)p++;t[p]==="("&&(h==="MAX"||h==="MIN"||h==="MID")?r.push({t:"func",name:h}):r.push({t:"id",v:h}),n=f;continue}throw new Error(`Unexpected char at ${n}: ${d}`)}const o=[];for(let d=0;d<r.length;d++){const f=r[d],h=o[o.length-1],p=!h||h.t==="op"||h.t==="lp"||h.t==="comma";if(f.t==="op"&&(f.v==="-"||f.v==="+")&&p){o.push({t:"num",v:0}),o.push(f);continue}o.push(f)}const s=[],l=d=>d.t==="num"||d.t==="id"||d.t==="rp",u=d=>d.t==="num"||d.t==="id"||d.t==="lp"||d.t==="func";for(let d=0;d<o.length;d++){const f=o[d],h=s[s.length-1];h&&l(h)&&u(f)&&s.push({t:"op",v:"*"}),s.push(f)}return s}function rj(e){return e==="*"||e==="/"?2:1}function Ese(e){const t=[],r=[],n=[];for(const a of e){if(a.t==="num"||a.t==="id"){t.push(a);continue}if(a.t==="func"){r.push(a),n.push(1);continue}if(a.t==="comma"){for(;r.length&&r[r.length-1].t!=="lp";)t.push(r.pop());if(!r.length)throw new Error("Comma found outside parentheses.");if(!n.length)throw new Error("Comma found but no function context.");n[n.length-1]+=1;continue}if(a.t==="lp"){r.push(a);continue}if(a.t==="rp"){for(;r.length&&r[r.length-1].t!=="lp";)t.push(r.pop());if(!r.length)throw new Error("Mismatched parentheses");if(r.pop(),r.length&&r[r.length-1].t==="func"){const i=r.pop(),o=n.pop()??1;t.push({t:"func",name:i.name,argc:o})}continue}if(a.t==="op"){for(;r.length;){const i=r[r.length-1];if(i.t!=="op")break;const o=rj(a.v);if(rj(i.v)>=o)t.push(r.pop());else break}r.push(a);continue}}for(;r.length;){const a=r.pop();if(a.t==="lp"||a.t==="rp")throw new Error("Mismatched parentheses");if(a.t==="func"){const i=n.pop()??1;t.push({t:"func",name:a.name,argc:i})}else t.push(a)}if(n.length!==0)throw new Error("Internal error: argCountStack not empty.");return t}function Ise(e,t){for(let n=1;n<t;n++){const a=e[n];let i=n-1;for(;i>=0&&e[i]>a;)e[i+1]=e[i],i--;e[i+1]=a}const r=t-1>>1;return e[r]}function Rse(e,t,r){if(t.size===0)throw new Error("No RAW loaded.");const n=t.values().next().value,a=n.width,i=n.height,o=a*i,s=new Map,l=new Map,u=new Map;let d=0;for(const v of t.keys())u.set(v,d++);const f=v=>{const M=t.get(v);if(!M)throw new Error(`Unknown RAW key: ${v}`);if(M.width!==a||M.height!==i)throw new Error("Dimension mismatch among RAWs.");let _=s.get(v);if(!_){_=new Float64Array(o*M.channels);const A=M.workF32;for(let R=0;R<_.length;R++)_[R]=A[R];s.set(v,_)}let P=l.get(v);return P||(P=new Int16Array(o),P.fill(u.get(v)??bo),l.set(v,P)),{kind:"img",v:_,w:a,h:i,c:M.channels,firstId:v,src:P}},h=v=>({kind:"scalar",v}),p=(v,M=1)=>{if(v.kind==="img"){if(v.c===M)return v;const P=new Float64Array(o*M);if(v.c===1&&M===3)for(let A=0;A<o;A++){const R=v.v[A],D=A*3;P[D]=R,P[D+1]=R,P[D+2]=R}else throw new Error("Unsupported channel conversion.");return{kind:"img",v:P,w:a,h:i,c:M,firstId:v.firstId,src:v.src}}const _=new Float64Array(o*M);return _.fill(v.v),{kind:"img",v:_,w:a,h:i,c:M,firstId:void 0,src:null}},x=(v,M)=>v??M,b=(v,M)=>{const _=v.c===3||M.c===3?3:1;return[p(v,_),p(M,_),_]},y=[];for(const v of e){if(v.t==="num"){y.push(h(v.v));continue}if(v.t==="id"){y.push(f(v.v));continue}if(v.t==="func"){const M=v.argc??1;if(M<1)throw new Error(`${v.name.toLowerCase()}(...) requires at least 1 argument.`);const _=[];for(let O=0;O<M;O++){const $=y.pop();if(!$)throw new Error(`${v.name.toLowerCase()}(...) missing argument(s).`);_.push($)}if(_.reverse(),_.every(O=>O.kind==="scalar")){const O=_.map($=>$.v);for(let $=1;$<O.length;$++){const N=O[$];let C=$-1;for(;C>=0&&O[C]>N;)O[C+1]=O[C],C--;O[C+1]=N}if(v.name==="MAX")y.push(h(O[O.length-1]));else if(v.name==="MIN")y.push(h(O[0]));else{const $=O.length-1>>1;y.push(h(O[$]))}continue}const A=_.map(O=>p(O)),R=A.some(O=>O.c===3)?3:1,D=A.map(O=>p(O,R)),E=A.reduce((O,$)=>x(O,$.firstId),void 0),W=o*R,F=new Float64Array(W);if(v.name==="MAX"||v.name==="MIN"){const O=D[0].v,$=new Int16Array(o),N=D[0].src;for(let C=0;C<o;C++){const B=C*R;for(let I=0;I<R;I++)F[B+I]=O[B+I];$[C]=N?N[C]:bo}if(v.name==="MAX")for(let C=1;C<D.length;C++){const B=D[C].v,I=D[C].src;for(let z=0;z<o;z++){const V=z*R;let K=!1;for(let q=0;q<R;q++)if(B[V+q]>F[V+q]){K=!0;break}if(K){for(let q=0;q<R;q++)F[V+q]=B[V+q];$[z]=I?I[z]:bo}}}else for(let C=1;C<D.length;C++){const B=D[C].v,I=D[C].src;for(let z=0;z<o;z++){const V=z*R;let K=!1;for(let q=0;q<R;q++)if(B[V+q]<F[V+q]){K=!0;break}if(K){for(let q=0;q<R;q++)F[V+q]=B[V+q];$[z]=I?I[z]:bo}}}y.push({kind:"img",v:F,w:a,h:i,c:R,firstId:E,src:$});continue}if(v.name==="MID"){const O=D.length,$=new Float64Array(O);for(let C=0;C<o;C++){const B=C*R;for(let I=0;I<R;I++){for(let z=0;z<O;z++)$[z]=D[z].v[B+I];F[B+I]=Ise($,O)}}let N;if(O===1){const C=D[0].src;C?N=C.slice():(N=new Int16Array(o),N.fill(bo))}else N=new Int16Array(o),N.fill(Kx);y.push({kind:"img",v:F,w:a,h:i,c:R,firstId:E,src:N});continue}throw new Error(`Unknown function: ${v.name}`)}if(v.t==="op"){const M=v.v,_=y.pop(),P=y.pop();if(!P||!_)throw new Error(`Operator ${M} missing operands`);if(M==="++"){if(!r)throw new Error("Formula uses '++' but ppRange is null.");const C=p(P),B=p(_),[I,z,V]=b(C,B),K=z.firstId;if(!K){y.push(I);continue}const q=t.get(K);if(!q)throw new Error(`Mask source RAW not found: ${K}`);const G=I.v,pe=z.v,J=new Float64Array(o*V),Z=new Int16Array(o),ae=r.min,ce=r.max,ne=q.origMaskU16,le=u.get(K)??bo;for(let se=0;se<o;se++){const he=ne[se],ue=se*V;if(he>=ae&&he<=ce){for(let ie=0;ie<V;ie++)J[ue+ie]=pe[ue+ie];Z[se]=z.src?z.src[se]:le}else{for(let ie=0;ie<V;ie++)J[ue+ie]=G[ue+ie];Z[se]=I.src?I.src[se]:bo}}y.push({kind:"img",v:J,w:a,h:i,c:V,firstId:x(I.firstId,K),src:Z});continue}if(P.kind==="scalar"&&_.kind==="scalar"){if(M==="+")y.push(h(P.v+_.v));else if(M==="-")y.push(h(P.v-_.v));else if(M==="*")y.push(h(P.v*_.v));else if(M==="/")y.push(h(P.v/_.v));else throw new Error(`Unsupported op ${M}`);continue}if(P.kind==="scalar"&&_.kind==="img"){const C=_.v,B=new Float64Array(C.length);if(M==="+")for(let I=0;I<C.length;I++)B[I]=P.v+C[I];else if(M==="-")for(let I=0;I<C.length;I++)B[I]=P.v-C[I];else if(M==="*")for(let I=0;I<C.length;I++)B[I]=P.v*C[I];else if(M==="/")for(let I=0;I<C.length;I++)B[I]=P.v/C[I];else throw new Error(`Unsupported op ${M}`);y.push({kind:"img",v:B,w:a,h:i,c:_.c,firstId:_.firstId,src:_.src});continue}if(P.kind==="img"&&_.kind==="scalar"){const C=P.v,B=new Float64Array(C.length);if(M==="+")for(let I=0;I<C.length;I++)B[I]=C[I]+_.v;else if(M==="-")for(let I=0;I<C.length;I++)B[I]=C[I]-_.v;else if(M==="*")for(let I=0;I<C.length;I++)B[I]=C[I]*_.v;else if(M==="/")for(let I=0;I<C.length;I++)B[I]=C[I]/_.v;else throw new Error(`Unsupported op ${M}`);y.push({kind:"img",v:B,w:a,h:i,c:P.c,firstId:P.firstId,src:P.src});continue}const A=p(P),R=p(_),[D,E,W]=b(A,R),F=D.v,O=E.v,$=new Float64Array(F.length);if(M==="+")for(let C=0;C<F.length;C++)$[C]=F[C]+O[C];else if(M==="-")for(let C=0;C<F.length;C++)$[C]=F[C]-O[C];else if(M==="*")for(let C=0;C<F.length;C++)$[C]=F[C]*O[C];else if(M==="/")for(let C=0;C<F.length;C++)$[C]=F[C]/O[C];else throw new Error(`Unsupported op ${M}`);const N=new Int16Array(o);if(D.src&&E.src)for(let C=0;C<o;C++)N[C]=D.src[C]===E.src[C]?D.src[C]:Kx;else!D.src&&!E.src?N.fill(bo):N.fill(Kx);y.push({kind:"img",v:$,w:a,h:i,c:W,firstId:x(D.firstId,E.firstId),src:N});continue}}if(y.length!==1)throw new Error("Expression did not reduce to a single value.");const m=y[0],g=m.kind==="img"?m:p(m,1),k=new Float32Array(g.v.length),S=g.v;for(let v=0;v<S.length;v++)k[v]=S[v];let w=g.src;return w||(w=new Int16Array(o),w.fill(bo)),{data:k,sourceMap:w.slice(),channels:g.c}}async function Dse(e,t,r,n,a,i,o,s,l,u,d,f,h,p="dng16",x=[]){var I;if(Object.keys(e).length===0)throw new Error("No files loaded.");if(!t.trim())throw new Error("Formula empty.");const b=t.includes("++");if(b&&!o)throw new Error("Formula contains '++' but ++Range is not provided.");h==null||h("Parsing formula...");const y=Tse(t),m=Ese(y),g=new Set;for(const z of y)z.t==="id"&&g.add(z.v);const k=Array.from(g);if(k.length===0)throw new Error("Formula must reference at least one loaded image key (A, B, ...).");for(const z of k)if(!e[z])throw new Error(`Formula references "${z}" but it is not loaded.`);const S=[];let w=0,v=0;for(let z=0;z<k.length;z++){const V=k[z],K=e[V];h==null||h(`Decoding ${V}: ${K.name}...`);const q=K.name.toLowerCase();let G;if(Y4.test(q)){const ne=await K.arrayBuffer();G=await Ds(ne)}else G=(await Jy(K)).analysisData;const pe=G.width,J=G.height,Z=G.data,ae=!!G.isThreePlane&&Z.length>=pe*J*3,ce=Z4(Z,pe,J,ae,r);if(S.length===0)w=pe,v=J;else if(pe!==w||J!==v)throw new Error(`Dimension mismatch: ${V} is ${pe}x${J}, expected ${w}x${v}.`);S.push({key:V,file:K,width:pe,height:J,channels:ce.channels,isThreePlane:ae,cfaPattern:eg(G.bayerPattern||i),origMaskU16:ce.maskU16,workF32:ce.workF32})}if(S.length===0)throw new Error("No referenced RAWs loaded.");if(x.length>0){h==null||h(`Building dark expectation from ${x.length} dark frame(s) (no alignment)...`);const z=new Map;for(let K=0;K<x.length;K++){const q=x[K];h==null||h(`Decoding dark ${K+1}/${x.length}: ${q.name}...`);const G=q.name.toLowerCase();let pe;if(Y4.test(G)){const he=await q.arrayBuffer();pe=await Ds(he)}else pe=(await Jy(q)).analysisData;const J=pe.width,Z=pe.height;if(J!==w||Z!==v)throw new Error(`Dark frame dimension mismatch: ${q.name} is ${J}x${Z}, expected ${w}x${v}.`);const ae=pe.data,ce=!!pe.isThreePlane&&ae.length>=J*Z*3,ne=Z4(ae,J,Z,ce,r),le=ne.channels;let se=z.get(le);if(se||(se={sum:new Float64Array(w*v*le),count:0},z.set(le,se)),ne.workF32.length!==se.sum.length)throw new Error(`Dark frame channel layout mismatch: ${q.name}.`);for(let he=0;he<ne.workF32.length;he++)se.sum[he]+=ne.workF32[he];se.count+=1}const V=new Map;for(const[K,q]of z){if(q.count<=0)continue;const G=1/q.count,pe=new Float32Array(q.sum.length);for(let J=0;J<q.sum.length;J++)pe[J]=q.sum[J]*G;V.set(K,pe)}if(V.size===0)throw new Error("Dark frame pool is empty after decoding.");for(const K of S){const q=V.get(K.channels);if(!q)throw new Error(`Missing dark expectation for ${K.channels}-channel frame "${K.key}".`);for(let G=0;G<K.workF32.length;G++)K.workF32[G]-=q[G]}h==null||h("Dark expectation subtraction applied to all formula frames.")}const M=typeof f=="number"&&Number.isFinite(f)?Math.max(.1,f):Xa.robustnessMotionThreshold;if(l&&S.length>1){h==null||h(`Estimating shifts (HDR+ style pyramid block matching, robustnessThreshold=${M.toFixed(2)})...`);const z=new Map;let V=!0;const K=async ne=>{const le=z.get(ne.key);if(le)return le;let se=null;return V&&ne.channels===1&&!ne.isThreePlane&&(se=await gse(ne,r),se?h==null||h(`Align guide ${ne.key}: AMaZE (GPU)`):V=!1),se||(se=pse(ne)),z.set(ne.key,se),se},q=S[0],G=await K(q);let pe=0,J=0,Z=0;for(let ne=1;ne<S.length;ne++){const le=S[ne],se=await K(le),he=Ose(G,se,q.width,q.height,q.channels===1,M),ue=Nse(le,he.flowX,he.flowY,he.flowConf);pe+=ue.effectiveRatio,Z+=ue.effectiveRatio,ue.effectiveRatio>=.15&&J++;const ie=he.flowX.length,xe=Math.max(1,Math.floor(ie/2e5));let Se=0,Ie=0,te=0,Oe=0;for(let ut=0;ut<ie;ut+=xe){const dt=he.flowX[ut],ht=he.flowY[ut];Se+=dt,Ie+=ht,te+=Math.hypot(dt,ht),Oe++}const Fe=Oe>0?Se/Oe:0,bt=Oe>0?Ie/Oe:0,Ct=Oe>0?te/Oe:0;h==null||h(`Align ${le.key}: hdr+field(meanDx=${Fe.toFixed(2)},meanDy=${bt.toFixed(2)},mag=${Ct.toFixed(2)},score=${he.score.toFixed(2)},valid=${(ue.validRatio*100).toFixed(1)}%,oob=${(ue.oobRatio*100).toFixed(1)}%,conf=${(ue.meanConfOnValid*100).toFixed(1)}%,eff=${(ue.effectiveRatio*100).toFixed(1)}%)`),Ct>1e-4&&Cse(le,he.flowX,he.flowY,q,he.flowConf),le.shiftX=Fe,le.shiftY=bt}const ae=Math.max(1,S.length-1);Z=Z/ae*100;const ce=1+pe;h==null||h(`Stack usage summary: adopted=${J}/${Math.max(0,S.length-1)} extras, effectiveExtras=${pe.toFixed(2)}, effectiveTotal=${ce.toFixed(2)}/${S.length}, meanEffPerFrame=${Z.toFixed(1)}%`)}h==null||h("Evaluating expression (float domain)...");const _=new Map(S.map(z=>[z.key,z])),P=Rse(m,_,b?o:null),A=P.data,R=P.sourceMap,D=Array.from(_.keys()).map(z=>{const V=_.get(z);return`${z}: ${V.file.name}`});if(s){let z=-1/0;for(let V=0;V<A.length;V++)A[V]>z&&(z=A[V]);if(z>1e-6){const q=(65019-Math.max(...n))/z;h==null||h(`Highlight stretch: Max=${z.toFixed(2)}, Factor=${q.toFixed(4)}`);for(let G=0;G<A.length;G++)A[G]*=q}}const E=((I=S[0])==null?void 0:I.cfaPattern)||eg(i);if(p==="jdngf32"){if(P.channels!==1)throw new Error("Float32 JDNG (mosaic mode) only supports single-channel Bayer output.");h==null||h("Finalizing Float32 JDNG data (mosaic + OutputBL pedestal)...");const z=hse(A,w,v,n);return h==null||h("Packing Float32 JDNG container..."),tse(w,v,z,n,E,[],D,R)}if(P.channels!==1)throw new Error("16-bit DNG output only supports single-channel Bayer mosaic.");h==null||h("Finalizing to 16-bit (add OutputBL pedestal + clip)...");const W=fse(A,w,v,n),F=Ase(W),O=a&&a.length===9?a:[1,0,0,0,1,0,0,0,1],$=await dse(h);h==null||h("Packing DNG container..."),$.globals.set("js_raw_u16_le",F),$.globals.set("js_width",w),$.globals.set("js_height",v),$.globals.set("js_cfa",String(i||"RGGB")),$.globals.set("js_bl_out",Array.from(n)),$.globals.set("js_cm_flat",O),$.globals.set("js_make","JO-Workstation"),$.globals.set("js_model","StackingTool"),$.globals.set("js_unique_model","JO StackingTool 16bit");const N=await $.runPythonAsync(`
pack_dng_from_u16(
  js_raw_u16_le.to_py(),
  js_width,
  js_height,
  js_cfa,
  js_bl_out.to_py(),
  js_cm_flat.to_py(),
  js_make,
  js_model,
  js_unique_model
)
  `),C=N.toJs();N.destroy&&N.destroy();const B=new Uint8Array(C.byteLength);return B.set(C),B.buffer}const $se=({isOpen:e,onClose:t,zIndex:r,onFocus:n})=>{const[a,i]=j.useState({}),[o,s]=j.useState([]),[l,u]=j.useState(0),[d,f]=j.useState("0 0 0 0"),[h,p]=j.useState("0 0 0 0"),[x,b]=j.useState(()=>localStorage.getItem("stacking_formula")||""),[y,m]=j.useState(!0),[g,k]=j.useState("0-14000"),[S,w]=j.useState(!0),[v,M]=j.useState("dng16"),[_,P]=j.useState(!0),[A,R]=j.useState("1"),[D,E]=j.useState("1"),[W,F]=j.useState("100"),[O,$]=j.useState(""),[N,C]=j.useState("RGGB"),[B,I]=j.useState("Idle"),[z,V]=j.useState(!1),[K,q]=j.useState(null),G=j.useRef(null),pe=j.useRef(null),J=j.useMemo(()=>Object.keys(Zc).sort(),[]);j.useEffect(()=>{localStorage.setItem("stacking_formula",x)},[x]);const Z=ie=>{let xe="",Se=ie;for(;Se>=0;)xe=String.fromCharCode(Se%26+65)+xe,Se=Math.floor(Se/26)-1;return xe},ae=ie=>{if(ie.target.files&&ie.target.files.length>0){const xe={...a};let Se=l;Array.from(ie.target.files).forEach(Ie=>{const te=Z(Se++);xe[te]=Ie}),i(xe),u(Se)}ie.target.value=""},ce=ie=>{ie.target.files&&ie.target.files.length>0&&s(xe=>[...xe,...Array.from(ie.target.files)]),ie.target.value=""},ne=()=>{i({}),s([]),u(0),q(null),I("Idle")},le=(ie,xe)=>{const Se=ie.trim().split(/[\s,]+/).map(Number);if(Se.length<1||Se.some(isNaN))throw new Error(`Invalid ${xe} Black Level format.`);return[Se[0],Se.length>1?Se[1]:Se[0],Se.length>2?Se[2]:Se[0],Se.length>3?Se[3]:Se[0]]},se=async()=>{if(Object.keys(a).length===0){q("No files loaded.");return}const ie=x.trim();if(!ie){q("Please enter a formula.");return}let xe,Se;try{xe=le(d,"Input"),Se=le(h,"Output")}catch(tt){q(tt.message);return}let Ie=null;if(y){const tt=g.split("-").map(vt=>parseFloat(vt.trim()));if(tt.length===2&&!isNaN(tt[0])&&!isNaN(tt[1]))Ie={min:Math.min(tt[0],tt[1]),max:Math.max(tt[0],tt[1])};else{q("Invalid ++Range format. Use min-max (e.g., 0-14000).");return}}else if(x.includes("++")){q("Formula contains '++' operator but ++Range is disabled.");return}let te=null;if(O.trim()&&(te=O.trim().split(/[\s,\n]+/).map(Number),te.length!==9||te.some(isNaN))){q("Color Matrix must be 9 numbers.");return}const Oe=Number(A),Fe=Number(D),bt=Number(W);if(!Number.isFinite(Oe)||Oe<1||Oe>8){q("SR Scale must be in range [1, 8].");return}if(!Number.isFinite(Fe)||Fe<=0||Fe>1){q("SR Point Area (pixfrac) must be in range (0, 1].");return}if(!Number.isFinite(bt)||bt<.1||bt>128){q("Align Robustness Threshold must be in range [0.1, 128].");return}V(!0),q(null),I("Starting...");const Ct=Date.now(),ut=`Stacked_Result_${Ct}`,dt=[],ht=tt=>{const vt=new Date().toISOString();dt.push(`[${vt}] ${tt}`)};try{await new Promise(Ot=>setTimeout(Ot,50)),ht("Processing started."),ht(`Files loaded: ${Object.keys(a).length}`),ht(`Dark frames: ${o.length}`),ht(`Formula: ${ie}`),ht(`Mode: ${v}, AutoAlign1: ${_?"ON":"OFF"}, Stretch: ${S?"ON":"OFF"}`),ht(`InputBL: ${xe.join(" ")} | OutputBL: ${Se.join(" ")}`),ht(`CFA: ${N} | SR scale: ${Oe} | SR point area: ${Fe}`),ht(`Align robustness threshold: ${bt}`);const tt=await Dse(a,ie,xe,Se,te,N,Ie,S,_,Oe,Fe,bt,Ot=>{I(Ot),ht(Ot)},v,o);I("Creating Download..."),ht("Creating output download.");const vt=v==="jdngf32",Sr=new Blob([tt],{type:vt?"application/octet-stream":"image/x-adobe-dng"}),Ft=URL.createObjectURL(Sr),rt=document.createElement("a");rt.href=Ft,rt.download=`${ut}${vt?".jdng":".dng"}`,document.body.appendChild(rt),rt.click(),document.body.removeChild(rt),URL.revokeObjectURL(Ft),ht(`Saved output: ${rt.download}`);const Kt=Object.entries(a).map(([Ot,_e])=>`${Ot}: ${_e.name}`),lr=o.map((Ot,_e)=>`D${_e+1}: ${Ot.name}`),gr=[...["Jiangtherapee Stacking Log",`RunId: ${Ct}`,`Output: ${rt.download}`,`Files: ${Object.keys(a).length}`,`Dark Frames: ${o.length}`,...Kt,...lr,"","Status Timeline:"],...dt].join(`\r
`),Zt=new Blob([gr],{type:"text/plain;charset=utf-8"}),zt=URL.createObjectURL(Zt),rr=document.createElement("a");rr.href=zt,rr.download=`${ut}.txt`,document.body.appendChild(rr),rr.click(),document.body.removeChild(rr),URL.revokeObjectURL(zt),I("Done!"),ht("Done.")}catch(tt){console.error(tt),q(tt.message),I("Failed"),ht(`Failed: ${(tt==null?void 0:tt.message)||String(tt)}`);const vt=Object.entries(a).map(([gr,Zt])=>`${gr}: ${Zt.name}`),Sr=o.map((gr,Zt)=>`D${Zt+1}: ${gr.name}`),rt=[...["Jiangtherapee Stacking Log",`RunId: ${Ct}`,"Output: FAILED",`Files: ${Object.keys(a).length}`,`Dark Frames: ${o.length}`,...vt,...Sr,"","Status Timeline:"],...dt].join(`\r
`),Kt=new Blob([rt],{type:"text/plain;charset=utf-8"}),lr=URL.createObjectURL(Kt),Vt=document.createElement("a");Vt.href=lr,Vt.download=`${ut}_FAILED.txt`,document.body.appendChild(Vt),Vt.click(),document.body.removeChild(Vt),URL.revokeObjectURL(lr)}finally{V(!1)}},he=()=>{p(d)},ue=()=>{const ie=Object.keys(a);if(ie.length){if(ie.length===1){b(ie[0]);return}b(`(${ie.join(" + ")}) / ${ie.length}`)}};return e?c.jsxs(Ks,{initialPosition:{x:window.innerWidth/2-250,y:100},onClose:t,zIndex:r,onFocus:n,className:"w-[500px] bg-white dark:bg-slate-900 border-2 border-black dark:border-white shadow-2xl flex flex-col font-mono",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 border-b-2 border-black dark:border-gray-500 bg-emerald-700 text-white",children:[c.jsx("h3",{className:"text-sm font-bold uppercase tracking-widest",children:"Advanced Math Stacking Tool"}),c.jsx("button",{onClick:t,className:"hover:text-red-300 transition-colors",children:"?                "})]}),c.jsxs("div",{className:"p-4 flex flex-col gap-4 overflow-y-auto max-h-[80vh]",children:[c.jsx("div",{className:"h-28 border border-gray-300 dark:border-slate-700 bg-gray-50 dark:bg-black/30 rounded p-2 overflow-y-auto",children:Object.keys(a).length===0?c.jsx("div",{className:"h-full flex items-center justify-center text-gray-400 text-xs",children:"No files loaded. Click 'Add Files' below."}):c.jsx("div",{className:"space-y-1",children:Object.entries(a).map(([ie,xe])=>{const Se=xe;return c.jsxs("div",{className:"flex justify-between text-xs border-b border-gray-200 dark:border-slate-800 pb-1 last:border-0",children:[c.jsx("span",{className:"font-bold text-emerald-600 dark:text-emerald-400 w-8",children:ie}),c.jsx("span",{className:"truncate text-gray-700 dark:text-slate-300 flex-1",children:Se.name}),c.jsxs("span",{className:"text-gray-400",children:[(Se.size/1024/1024).toFixed(1),"MB"]})]},ie)})})}),c.jsxs("div",{className:"h-24 border border-gray-300 dark:border-slate-700 bg-gray-50 dark:bg-black/30 rounded p-2 overflow-y-auto",children:[c.jsx("div",{className:"text-[10px] font-bold uppercase text-amber-700 dark:text-amber-400 mb-1",children:"Dark Frame Pool (No Align, Mean Expectation)"}),o.length===0?c.jsx("div",{className:"h-[calc(100%-16px)] flex items-center justify-center text-gray-400 text-xs",children:"No dark frames loaded."}):c.jsx("div",{className:"space-y-1",children:o.map((ie,xe)=>c.jsxs("div",{className:"flex justify-between text-xs border-b border-gray-200 dark:border-slate-800 pb-1 last:border-0",children:[c.jsx("span",{className:"font-bold text-amber-600 dark:text-amber-400 w-8",children:`D${xe+1}`}),c.jsx("span",{className:"truncate text-gray-700 dark:text-slate-300 flex-1",children:ie.name}),c.jsxs("span",{className:"text-gray-400",children:[(ie.size/1024/1024).toFixed(1),"MB"]})]},`${ie.name}-${ie.size}-${xe}`))})]}),c.jsxs("div",{className:"flex flex-col gap-3 flex-shrink-0",children:[c.jsxs("div",{className:"flex gap-2",children:[c.jsx("input",{type:"file",ref:G,multiple:!0,className:"hidden",onChange:ae,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("input",{type:"file",ref:pe,multiple:!0,className:"hidden",onChange:ce,accept:".arw,.cr2,.cr3,.dng,.nef,.orf,.raf,.rw2,.pef,.srw,.sr2,.srf,.x3f,.erf,.mef,.mos,.mrw,.kdc,.dcr,.iiq,.3fr,.fff,.rwl,.nrw,.raw,.tif,.tiff"}),c.jsx("button",{onClick:()=>{var ie;return(ie=G.current)==null?void 0:ie.click()},className:"flex-1 bg-gray-200 hover:bg-gray-300 dark:bg-slate-800 dark:hover:bg-slate-700 py-1 rounded text-xs font-bold transition-colors",children:"Add Files"}),c.jsx("button",{onClick:()=>{var ie;return(ie=pe.current)==null?void 0:ie.click()},className:"flex-1 bg-amber-100 hover:bg-amber-200 dark:bg-amber-900/30 dark:hover:bg-amber-900/50 py-1 rounded text-xs font-bold transition-colors",children:"Add Dark"})]}),c.jsxs("div",{className:"flex gap-2",children:[c.jsx("button",{onClick:()=>s([]),className:"flex-1 bg-amber-50 hover:bg-amber-100 dark:bg-amber-900/20 dark:hover:bg-amber-900/40 text-amber-700 dark:text-amber-400 py-1 rounded text-xs font-bold transition-colors",children:"Clear Dark"}),c.jsx("button",{onClick:ne,className:"px-3 bg-red-100 hover:bg-red-200 dark:bg-red-900/30 dark:hover:bg-red-900/50 text-red-600 dark:text-red-400 py-1 rounded text-xs font-bold transition-colors",children:"Clear"})]}),c.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Input BL (Subtract)"}),c.jsx("input",{type:"text",value:d,onChange:ie=>f(ie.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"}),c.jsx("div",{className:"text-[9px] text-gray-400 mt-0.5",children:"(0,0), (0,1), (1,0), (1,1)"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Output BL (Add to Result)"}),c.jsxs("div",{className:"flex gap-1",children:[c.jsx("input",{type:"text",value:h,onChange:ie=>p(ie.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"}),c.jsx("button",{onClick:he,className:"px-2 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 rounded text-[9px]",title:"Copy Input to Output",children:"Copy"})]})]})]}),c.jsxs("div",{className:"flex flex-col justify-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"Options"}),c.jsxs("div",{className:"mb-2",children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Output"}),c.jsxs("select",{value:v,onChange:ie=>M(ie.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"dng16",children:"16-bit DNG (Mosaic Output)"}),c.jsx("option",{value:"jdngf32",children:"Float32 JDNG (Bayer Mosaic)"})]})]}),c.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-gray-500 dark:text-slate-400",children:"Highlight Stretch to Container Max"}),c.jsx("button",{type:"button",onClick:()=>w(ie=>!ie),className:`px-2 py-0.5 text-[10px] font-bold rounded border ${S?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"Scale result so highlights reach container max code value",children:S?"ON":"OFF"})]}),c.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[c.jsx("span",{className:"text-[10px] font-bold uppercase text-gray-500 dark:text-slate-400",children:"1"}),c.jsx("button",{type:"button",onClick:()=>P(ie=>!ie),className:`px-2 py-0.5 text-[10px] font-bold rounded border ${_?"bg-emerald-600 border-emerald-500 text-white":"bg-gray-100 dark:bg-slate-800 border-gray-300 dark:border-slate-600 text-gray-600 dark:text-slate-300"}`,title:"",children:_?"ON":"OFF"})]}),_&&c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"SR Scale"}),c.jsx("input",{type:"number",min:1,max:8,step:1,value:A,onChange:ie=>R(ie.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Point Area"}),c.jsx("input",{type:"number",min:.01,max:1,step:.01,value:D,onChange:ie=>E(ie.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[9px] font-bold uppercase text-gray-500 dark:text-slate-400 block mb-1",children:"Align Robustness"}),c.jsx("input",{type:"number",min:.1,max:128,step:.1,value:W,onChange:ie=>F(ie.target.value),className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none",title:"Larger value = more tolerant to local flow span mismatch, usually keeps more stack contribution."})]})]}),c.jsxs("div",{className:"text-[9px] text-gray-400 mb-1 leading-tight",children:["1robustness=100, scale=1, point area=1",c.jsx("br",{}),""]})]}),c.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[c.jsx("input",{type:"checkbox",checked:y,onChange:ie=>m(ie.target.checked),className:"rounded",title:"Enable Conditional ++ Operator"}),c.jsx("span",{className:`text-[9px] font-bold uppercase ${y?"text-indigo-600 dark:text-indigo-400":"text-gray-400"}`,children:"++Range:"}),c.jsx("input",{type:"text",value:g,onChange:ie=>k(ie.target.value),disabled:!y,placeholder:"min-max",className:"w-full text-[10px] px-1 py-0.5 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none disabled:opacity-50"})]})]})]}),c.jsxs("div",{children:[c.jsxs("div",{className:"flex items-center justify-between mb-1",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block",children:"Math Formula ( + - * / and ++ )"}),c.jsx("button",{type:"button",onClick:ue,className:"px-2 py-0.5 text-[9px] font-bold rounded bg-gray-200 hover:bg-gray-300 dark:bg-slate-700 dark:hover:bg-slate-600",title:"Auto-generate average formula from loaded files",children:"Auto Avg"})]}),c.jsx("textarea",{value:x,onChange:ie=>b(ie.target.value),placeholder:"e.g. (A+B)/2 or A ++ 4*B",className:"w-full h-14 text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none resize-none font-mono"}),c.jsxs("p",{className:"text-[9px] text-gray-400 mt-1 leading-tight",children:["Operators: +, -, *, /, ( ). ",c.jsx("br",{}),c.jsx("span",{className:"text-indigo-400 font-bold",children:"++"})," Operator: ",c.jsx("code",{children:"A ++ B"}),' means "Use B if B is in range, else use A". ',c.jsx("br",{}),"Inputs are linearized float32 (Raw - InputBL)."]})]}),c.jsxs("div",{className:"grid grid-cols-3 gap-2 items-end",children:[c.jsxs("div",{className:"col-span-2",children:[c.jsxs("div",{className:"flex justify-between items-end",children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase",children:"Color Matrix (9 vals)"}),c.jsxs("select",{className:"text-[9px] bg-gray-100 dark:bg-slate-800 border border-black dark:border-slate-500 rounded-none px-1 py-0.5 max-w-[120px] cursor-pointer",onChange:ie=>{const xe=Zc[ie.target.value];xe&&$(xe),ie.target.value=""},defaultValue:"",children:[c.jsx("option",{value:"",disabled:!0,children:"Presets..."}),J.map(ie=>c.jsx("option",{value:ie,children:ie},ie))]})]}),c.jsx("input",{type:"text",value:O,onChange:ie=>$(ie.target.value),placeholder:"e.g. 1 0 0 0 1 0 0 0 1",className:"w-full text-xs px-2 py-1 bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded outline-none mt-1"})]}),c.jsxs("div",{children:[c.jsx("label",{className:"text-[10px] font-bold text-gray-500 dark:text-slate-400 uppercase block mb-1",children:"CFA Pattern"}),c.jsxs("select",{value:N,onChange:ie=>C(ie.target.value),className:"w-full bg-white dark:bg-slate-900 border border-gray-300 dark:border-slate-600 rounded px-1 py-1 text-xs font-bold",children:[c.jsx("option",{value:"RGGB",children:"RGGB"}),c.jsx("option",{value:"BGGR",children:"BGGR"}),c.jsx("option",{value:"GBRG",children:"GBRG"}),c.jsx("option",{value:"GRBG",children:"GRBG"})]})]})]}),K&&c.jsx("div",{className:"text-red-500 text-xs bg-red-50 dark:bg-red-900/20 p-2 rounded text-center font-bold",children:K}),c.jsxs("div",{className:"flex items-center gap-2 mt-2",children:[c.jsx("div",{className:"flex-1 text-xs text-emerald-600 dark:text-emerald-400 font-bold truncate",children:B}),c.jsx("button",{onClick:se,disabled:z,className:`px-6 py-2 text-sm font-bold uppercase tracking-wide text-white rounded shadow-md transition-all active:scale-95 ${z?"bg-gray-400 cursor-wait":"bg-emerald-600 hover:bg-emerald-500"}`,children:v==="jdngf32"?"Process & Save Float32 JDNG":"Process & Save DNG"})]})]})]})]}):null},Lse=`
import struct
import numpy as np

class Type:
    Short = (3,2); Long = (4,4); Rational = (5,8); Ascii = (2,1); Byte = (1,1)
    Undefined = (7,1); Srational = (10,8); IFD = (13,4)

class Tag:
    NewSubfileType = (254, Type.Long); ImageWidth = (256, Type.Long); ImageLength = (257, Type.Long)
    BitsPerSample = (258, Type.Short); Compression = (259, Type.Short)
    PhotometricInterpretation = (262, Type.Short); Make = (271, Type.Ascii); Model = (272, Type.Ascii)
    StripOffsets = (273, Type.Long); Orientation = (274, Type.Short); SamplesPerPixel = (277, Type.Short)
    RowsPerStrip = (278, Type.Short); StripByteCounts = (279, Type.Long)
    CFARepeatPatternDim = (33421, Type.Short); CFAPattern = (33422, Type.Byte)
    DNGVersion = (50706, Type.Byte); UniqueCameraModel = (50708, Type.Ascii)
    BlackLevel = (50714, Type.Short); WhiteLevel = (50717, Type.Short)
    ColorMatrix1 = (50721, Type.Srational); CalibrationIlluminant1 = (50778, Type.Short)
    BlackLevelRepeatDim = (50713, Type.Short)

class Compression: Uncompressed = 1
class PhotometricInterpretation: Color_Filter_Array = 32803
class CFAPattern: BGGR=[2,1,1,0]; GBRG=[1,2,0,1]; GRBG=[1,0,2,1]; RGGB=[0,1,1,2]

class dngTag(object):
    def __init__(self, tagType, value=[]):
        self.TagId = tagType[0]
        self.DataType = tagType[1]
        self.DataCount = len(value) if not isinstance(value, str) else len(value) + 1
        self.Value = self._pack_value(tagType[1], value)
        self.DataLength = len(self.Value)
        self.selfContained = (self.DataLength <= 4)
        self.DataOffset = 0

    def _pack_value(self, dtype, value):
        tid = dtype[0]
        if tid == 1: return struct.pack('<%sB' % len(value), *value)
        elif tid == 3: return struct.pack('<%sH' % len(value), *value)
        elif tid == 4: return struct.pack('<%sL' % len(value), *value)
        elif tid == 2: return struct.pack('<%ss' % len(value), value.encode("ascii")) + b'\\x00'
        elif tid == 5 or tid == 10: 
            flat = [item for sublist in value for item in sublist]
            fmt = 'L' if tid == 5 else 'l'
            return struct.pack('<%s%s' % (len(flat), fmt), *flat)
        return b''

    def write_directory(self, buf, offset):
        if self.selfContained:
            val = self.Value + b'\\x00' * (4 - len(self.Value))
            struct.pack_into("<HHI4s", buf, offset, self.TagId, self.DataType[0], self.DataCount, val)
        else:
            struct.pack_into("<HHII", buf, offset, self.TagId, self.DataType[0], self.DataCount, self.DataOffset)

    def write_data(self, buf):
        if not self.selfContained:
            struct.pack_into(f"<{len(self.Value)}s", buf, self.DataOffset, self.Value)

def convert_to_dng(raw_bytes, width, height, cfa_str, black_level_list, shift, linear_shift, cm_flat):
    # 1. Pixel Data Processing
    # Ensure raw_bytes is a bytes-like object
    raw_data = np.frombuffer(raw_bytes, dtype=np.uint16).copy()
    
    # Use int32 for calculations
    raw_data = raw_data.astype(np.int32)

    # Apply Bit Shift (<<)
    if shift > 0:
        raw_data = raw_data * (1 << shift)
    
    # Apply Linear Offset (+)
    if linear_shift != 0:
        raw_data = raw_data + linear_shift

    # Clip to 16-bit range
    raw_data = np.clip(raw_data, 0, 65535).astype(np.uint16)

    # 2. Metadata Preparation
    white_level = 65019
    # Format Color Matrix for Srational (Value, Denominator)
    color_matrix = [[int(x * 10000), 10000] for x in cm_flat]

    cfa_map = {"BGGR": CFAPattern.BGGR, "GBRG": CFAPattern.GBRG, "GRBG": CFAPattern.GRBG, "RGGB": CFAPattern.RGGB}
    
    tags = [
        dngTag(Tag.NewSubfileType, [0]),
        dngTag(Tag.ImageWidth, [width]),
        dngTag(Tag.ImageLength, [height]),
        dngTag(Tag.BitsPerSample, [16]), 
        dngTag(Tag.Compression, [Compression.Uncompressed]),
        dngTag(Tag.PhotometricInterpretation, [PhotometricInterpretation.Color_Filter_Array]),
        dngTag(Tag.Make, "JO-Workstation"),
        dngTag(Tag.Model, "Z8-Rescued"),
        dngTag(Tag.SamplesPerPixel, [1]),
        dngTag(Tag.RowsPerStrip, [height]), 
        dngTag(Tag.CFARepeatPatternDim, [2, 2]),
        dngTag(Tag.CFAPattern, cfa_map.get(cfa_str.upper(), CFAPattern.RGGB)),
        dngTag(Tag.BlackLevelRepeatDim, [2, 2]),
        dngTag(Tag.BlackLevel, [int(x) for x in black_level_list]),
        dngTag(Tag.WhiteLevel, [white_level]),
        dngTag(Tag.ColorMatrix1, color_matrix),
        dngTag(Tag.CalibrationIlluminant1, [21]),
        dngTag(Tag.DNGVersion, [1, 4, 0, 0]),
        dngTag(Tag.UniqueCameraModel, "Nikon Z 8") 
    ]
    
    pixel_bytes = raw_data.tobytes()
    tags.append(dngTag(Tag.StripOffsets, [0])) 
    tags.append(dngTag(Tag.StripByteCounts, [len(pixel_bytes)]))
    tags.sort(key=lambda x: x.TagId)
    
    ifd_size = 2 + (len(tags) * 12) + 4
    current_data_offset = 8 + ifd_size
    
    for tag in tags:
        if not tag.selfContained:
            tag.DataOffset = current_data_offset
            current_data_offset = (current_data_offset + tag.DataLength + 3) & 0xFFFFFFFC
            
    img_offset = current_data_offset
    for tag in tags:
        if tag.TagId == Tag.StripOffsets[0]:
            tag.Value = struct.pack('<L', img_offset)
            break
            
    buf = bytearray(img_offset + len(pixel_bytes))
    struct.pack_into("<ccbbI", buf, 0, b'I', b'I', 0x2A, 0x00, 8)
    struct.pack_into("<H", buf, 8, len(tags))
    
    offset = 10
    for tag in tags:
        tag.write_directory(buf, offset)
        offset += 12
        
    struct.pack_into("<I", buf, offset, 0)
    for tag in tags:
        tag.write_data(buf)
        
    buf[img_offset:img_offset+len(pixel_bytes)] = pixel_bytes
    return bytes(buf)
`,Bse=[1.1423,-.4564,-.1123,-.4816,1.2895,.2119,-.021,.1061,.7282],Fse=[4032,4032,4032,4032],Gse=2,Use=({isOpen:e,onClose:t,zIndex:r=250,onFocus:n})=>{const[a,i]=j.useState(!0),[o,s]=j.useState(!1),[l,u]=j.useState(""),d=j.useRef(null),f=j.useRef(null);j.useEffect(()=>{e&&!d.current&&(async()=>{try{const x=await window.loadPyodide();await x.loadPackage("numpy"),await x.runPythonAsync(Lse),d.current=x,i(!1)}catch(x){console.error("Pyodide Init Failed",x),u("Error loading Python environment.")}})()},[e]);const h=async p=>{if(!p.target.files||p.target.files.length===0||!d.current)return;const x=Array.from(p.target.files);s(!0),u("Starting batch...");const b=d.current;for(let y=0;y<x.length;y++){const m=x[y];u(`Processing ${y+1}/${x.length}: ${m.name}`);try{const g=await m.arrayBuffer(),k=await Ds(g),{data:S,width:w,height:v}=k,M=[[0,0,0],[0,0,0],[0,0,0],[0,0,0]];for(let O=0;O<v;O+=2){const $=O*w,N=(O+1)*w;for(let C=0;C<w;C+=2){const B=[$+C,$+C+1,N+C,N+C+1];for(let I=0;I<4;I++){const z=S[B[I]];z>=1006&&z<=1008&&M[I][z-1006]++}}}const _=[-1,-1,-1,-1];for(let O=0;O<4;O++){const $=M[O][0],N=M[O][1],C=M[O][2];C<N?_[O]=1007:C>N&&N<$&&(_[O]=1006)}let P=!1;if(_.some(O=>O>-1)){P=!0;for(let O=0;O<v;O+=2){const $=O*w,N=(O+1)*w;for(let C=0;C<w;C+=2){const B=[$+C,$+C+1,N+C,N+C+1];for(let I=0;I<4;I++){const z=_[I];z>-1&&S[B[I]]<=z&&(S[B[I]]+=1)}}}}b.globals.set("js_raw_bytes",new Uint8Array(S.buffer,S.byteOffset,S.byteLength)),b.globals.set("js_width",w),b.globals.set("js_height",v),b.globals.set("js_cfa","RGGB"),b.globals.set("js_bl_list",Fse),b.globals.set("js_shift",Gse),b.globals.set("js_linear_shift",0),b.globals.set("js_cm_flat",Bse);const A=await b.runPythonAsync(`
                    convert_to_dng(
                        js_raw_bytes.to_py(), 
                        js_width, 
                        js_height, 
                        js_cfa, 
                        js_bl_list.to_py(), 
                        js_shift,
                        js_linear_shift,
                        js_cm_flat.to_py()
                    )
                `),R=A.toJs();A.destroy();const D=new Blob([R],{type:"image/x-adobe-dng"}),E=URL.createObjectURL(D),W=document.createElement("a");W.href=E;const F=m.name.substring(0,m.name.lastIndexOf("."))||"image";W.download=`${F}_Z8Rescued_16bit.dng`,document.body.appendChild(W),W.click(),document.body.removeChild(W),URL.revokeObjectURL(E),await new Promise(O=>setTimeout(O,100))}catch(g){console.error(`Error processing ${m.name}`,g),u(`Error on ${m.name}: ${g.message}`)}}s(!1),u("Batch Complete."),p.target.value=""};return e?c.jsxs(Ks,{initialPosition:{x:window.innerWidth/2-200,y:150},onClose:t,zIndex:r,onFocus:n,className:"w-[400px] bg-white dark:bg-slate-900 border-2 border-red-600 shadow-[8px_8px_0px_rgba(220,38,38,0.3)] rounded-none flex flex-col font-mono",children:[c.jsxs("div",{className:"flex justify-between items-center px-4 py-2 bg-red-600 text-white border-b-2 border-black dark:border-white",children:[c.jsxs("h3",{className:"text-sm font-bold uppercase tracking-widest flex items-center gap-2",children:[c.jsx("span",{className:"text-xl",children:""}),"  Z8 (Z8 Rescue)"]}),c.jsx("button",{onClick:t,className:"hover:text-black transition-colors font-bold",children:""})]}),c.jsx("div",{className:"p-6 flex flex-col gap-4",children:a?c.jsxs("div",{className:"flex flex-col items-center justify-center py-4",children:[c.jsx("div",{className:"w-6 h-6 border-4 border-red-600 border-t-transparent animate-spin rounded-full"}),c.jsx("p",{className:"text-xs mt-2 text-gray-500",children:"Loading Python Kernel..."})]}):c.jsxs(c.Fragment,{children:[c.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 border border-red-200 dark:border-red-800 p-3 text-[10px] text-gray-700 dark:text-gray-300 leading-relaxed",children:[c.jsx("strong",{className:"block mb-1 text-red-600 dark:text-red-400",children:"Logic:"}),"1. iso64 preferred",c.jsx("br",{}),"2. PTC",c.jsx("br",{}),"3. Apply bit-shift (x4) to 16-bit.",c.jsx("br",{}),"4. Export DNG with BL=4032 & Z8 Matrix."]}),c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("input",{type:"file",ref:f,multiple:!0,accept:".nef,.dng",className:"hidden",onChange:h}),c.jsx("button",{onClick:()=>{var p;return(p=f.current)==null?void 0:p.click()},disabled:o,className:`w-full py-3 font-bold uppercase text-xs tracking-widest shadow-md transition-all active:translate-y-1 ${o?"bg-gray-400 text-gray-700 cursor-wait":"bg-red-600 hover:bg-red-500 text-white border-2 border-black dark:border-white"}`,children:o?"Rescuing...":"Select Z8 Files & Rescue"})]}),l&&c.jsx("div",{className:"text-center text-[10px] font-bold text-red-600 dark:text-red-400 border-t border-gray-200 dark:border-slate-800 pt-2 animate-pulse",children:l})]})})]}):null};function nj(e,t,r,n=3){const i=r.byteLength,o=8,s=o+i,l=[{id:256,type:4,count:1,value:e},{id:257,type:4,count:1,value:t},{id:258,type:3,count:n,value:n===1?16:[16,16,16]},{id:259,type:3,count:1,value:1},{id:262,type:3,count:1,value:n===1?1:2},{id:273,type:4,count:1,value:o},{id:277,type:3,count:1,value:n},{id:278,type:4,count:1,value:t},{id:279,type:4,count:1,value:i}],u=2+l.length*12+4;let d=0;const f=l.map(g=>{let k=g.type===3?2:4;const S=g.count*k,w=S<=4;let v=0;return w||(v=d,d+=S),{...g,fits:w,totalBytes:S,extraOffset:v}}),h=s+u+d,p=new ArrayBuffer(h),x=new DataView(p),b=new Uint8Array(p);x.setUint16(0,18761,!0),x.setUint16(2,42,!0),x.setUint32(4,s,!0),b.set(new Uint8Array(r.buffer,r.byteOffset,r.byteLength),o);let y=s;x.setUint16(y,l.length,!0),y+=2;const m=s+u;return f.forEach(g=>{if(x.setUint16(y,g.id,!0),x.setUint16(y+2,g.type,!0),x.setUint32(y+4,g.count,!0),g.fits)Array.isArray(g.value)||(g.type===3?x.setUint16(y+8,g.value,!0):x.setUint32(y+8,g.value,!0));else{const k=m+g.extraOffset;x.setUint32(y+8,k,!0),Array.isArray(g.value)&&g.value.forEach((S,w)=>{x.setUint16(k+w*2,S,!0)})}y+=12}),x.setUint32(y,0,!0),p}const zse="http://localhost:5428",Wse=(e=!1)=>{const[t,r]=j.useState({isConnected:!1,message:"Initializing...",hasDngConverter:!1});return j.useEffect(()=>{if(e){r({isConnected:!1,message:"Bridge Paused",hasDngConverter:!1});return}const n=async()=>{try{const i=new AbortController,o=setTimeout(()=>i.abort(),1e3),s=await fetch(`${zse}/health`,{method:"GET",signal:i.signal});if(clearTimeout(o),s.ok){const l=await s.json(),u=`Connected (${l.exiftool||"Ready"})`;r(d=>d.isConnected===!0&&d.message===u&&d.version===l.exiftool&&d.hasDngConverter===!!l.dng_converter?d:{isConnected:!0,message:u,version:l.exiftool,hasDngConverter:!!l.dng_converter})}else r(l=>l.isConnected===!1&&l.message==="Service Error"?l:{isConnected:!1,message:"Service Error",hasDngConverter:!1})}catch{r(o=>o.isConnected===!1&&o.message==="Not Detected"?o:{isConnected:!1,message:"Not Detected",hasDngConverter:!1})}};n();const a=setInterval(n,2e3);return()=>clearInterval(a)},[e]),t},Vse="JTR_BlobStore",io="raw_files",Hse=1,hm=()=>new Promise((e,t)=>{const r=indexedDB.open(Vse,Hse);r.onupgradeneeded=n=>{const a=n.target.result;a.objectStoreNames.contains(io)||a.createObjectStore(io)},r.onsuccess=()=>e(r.result),r.onerror=()=>t(r.error)}),Xse=async(e,t)=>{const r=await hm();return new Promise((n,a)=>{const i=r.transaction(io,"readwrite");i.objectStore(io).put(t,e),i.oncomplete=()=>n(),i.onerror=()=>a(i.error)})},Kse=async e=>{const t=await hm();return new Promise((r,n)=>{const o=t.transaction(io,"readonly").objectStore(io).get(e);o.onsuccess=()=>r(o.result),o.onerror=()=>n(o.error)})},Yse=async()=>{const e=await hm();return new Promise((t,r)=>{const n=e.transaction(io,"readwrite");n.objectStore(io).clear(),n.oncomplete=()=>t(),n.onerror=()=>r(n.error)})},XO="jtr_workspace_index",qse=e=>{try{const t=JSON.stringify(e);localStorage.setItem(XO,t)}catch(t){console.error("Failed to save workspace index",t)}},Zse=()=>{try{const e=localStorage.getItem(XO);return e?JSON.parse(e):null}catch(e){return console.error("Failed to load workspace index",e),null}},Jse=async e=>{const n=(await hm()).transaction(io,"readwrite").objectStore(io),a=n.getAllKeys();a.onsuccess=()=>{a.result.forEach(o=>{e.includes(o)||n.delete(o)})}},Qse=[{x:3050,y:1973},{x:4245,y:1980},{x:3043,y:2870},{x:4243,y:2876}],ele=1195,aj=150,ij=50,tle=[{x:3528,y:2437.5,ori:2},{x:3775,y:2419,ori:2},{x:3638.5,y:2303,ori:1},{x:3653,y:2548.5,ori:1},{x:3082,y:2413,ori:2},{x:2825,y:2427,ori:2},{x:2946,y:2300.5,ori:1},{x:2966,y:2550,ori:1},{x:3638.5,y:3e3,ori:1},{x:3657.5,y:3248.5,ori:1},{x:3521.5,y:3135,ori:2},{x:3770,y:3108.5,ori:2},{x:4375.5,y:3064.5,ori:2},{x:4620.5,y:3040,ori:2},{x:4486.5,y:2934,ori:1},{x:4509.5,y:3182.5,ori:1},{x:2066.5,y:1726,ori:2},{x:2176.5,y:1597,ori:1},{x:2194.5,y:1843,ori:1},{x:2313.5,y:1705,ori:2},{x:2675.5,y:1799.5,ori:2},{x:2789.5,y:1674,ori:1},{x:2926,y:1787.5,ori:2},{x:2810.5,y:1921.5,ori:1},{x:4380.5,y:1816,ori:2},{x:4497.5,y:1687,ori:1},{x:4513,y:1934.5,ori:1},{x:4628,y:1799.5,ori:2},{x:5099,y:1622.5,ori:1},{x:4985.5,y:1751,ori:2},{x:5122,y:1867.5,ori:1},{x:5229,y:1732,ori:2},{x:2194.5,y:2428,ori:2},{x:2305.5,y:2295.5,ori:1},{x:2327,y:2544,ori:1},{x:2442,y:2405,ori:2},{x:3530.5,y:1741.5,ori:2},{x:3640.5,y:1610,ori:1},{x:3777.5,y:1719.5,ori:2},{x:3666,y:1856.5,ori:1},{x:4222,y:2443.5,ori:2},{x:4470.5,y:2422,ori:2},{x:4334.5,y:2309,ori:1},{x:4356.5,y:2554,ori:1},{x:4965,y:2313,ori:1},{x:4852.5,y:2446,ori:2},{x:4987,y:2561,ori:1},{x:5097,y:2427,ori:2},{x:4981.5,y:3141.5,ori:2},{x:5096,y:3009,ori:1},{x:5222.5,y:3122.5,ori:2},{x:5115.5,y:3256.5,ori:1},{x:2779,y:2928,ori:1},{x:2667,y:3064.5,ori:2},{x:2799,y:3173.5,ori:1},{x:2917.5,y:3043,ori:2},{x:2167.5,y:2993,ori:1},{x:2052,y:3130,ori:2},{x:2187.5,y:3243.5,ori:1},{x:2304.5,y:3108.5,ori:2}];function rle(e,t){let r=[],n=[];for(let o=0;o<4;o++){let s=e[o].x,l=e[o].y,u=t[o].x,d=t[o].y;r.push([s,l,1,0,0,0,-s*u,-l*u]),r.push([0,0,0,s,l,1,-s*d,-l*d]),n.push(u),n.push(d)}const a=8;for(let o=0;o<a;o++){let s=o;for(let l=o+1;l<a;l++)Math.abs(r[l][o])>Math.abs(r[s][o])&&(s=l);[r[o],r[s]]=[r[s],r[o]],[n[o],n[s]]=[n[s],n[o]];for(let l=o+1;l<a;l++){const u=r[l][o]/r[o][o];n[l]-=u*n[o];for(let d=o;d<a;d++)r[l][d]-=u*r[o][d]}}const i=new Array(a).fill(0);for(let o=a-1;o>=0;o--){let s=0;for(let l=o+1;l<a;l++)s+=r[o][l]*i[l];i[o]=(n[o]-s)/r[o][o]}return[[i[0],i[1],i[2]],[i[3],i[4],i[5]],[i[6],i[7],1]]}function nle(e,t,r){const n=e[2][0]*t+e[2][1]*r+e[2][2];return{x:(e[0][0]*t+e[0][1]*r+e[0][2])/n,y:(e[1][0]*t+e[1][1]*r+e[1][2])/n}}function ale(e){if(e.length!==4)return[];const t=rle(Qse,e),n=Math.hypot(e[1].x-e[0].x,e[1].y-e[0].y)/ele;return tle.map(a=>{const i=nle(t,a.x,a.y);let o,s;return a.ori===1?(o=aj*n,s=ij*n):(o=ij*n,s=aj*n),{x:i.x-o/2,y:i.y-s/2,w:o,h:s,ori:a.ori}})}const ile=`
struct LayerUniforms {
  width: u32,
  height: u32,
  blendMode: u32,  // 0=add, 1=subtract
  enabled: u32,
  opacity: f32,
  exposure: f32,
  temperature: f32,
  tint: f32,
  contrast: f32,
  highlights: f32,
  shadows: f32,
  vibrance: f32,
  saturation: f32,
  pad0: f32,
  pad1: f32,
  pad2: f32,
  mixerHue0: vec4f, // red, orange, yellow, green
  mixerHue1: vec4f, // aqua, blue, purple, magenta
  mixerSat0: vec4f,
  mixerSat1: vec4f,
  mixerLum0: vec4f,
  mixerLum1: vec4f,
};

@group(0) @binding(0) var<uniform> u: LayerUniforms;
@group(0) @binding(1) var<storage, read_write> work: array<vec4f>;
@group(0) @binding(2) var<storage, read> maskAlpha: array<f32>;
@group(0) @binding(3) var<storage, read> curveLut: array<f32>;

fn clamp01(x: f32) -> f32 {
  return max(0.0, min(1.0, x));
}

fn smoothstep01(edge0: f32, edge1: f32, x: f32) -> f32 {
  let denom = max(1e-6, edge1 - edge0);
  let t = clamp01((x - edge0) / denom);
  return t * t * (3.0 - 2.0 * t);
}

fn tone_adjust(value: f32, amount: f32, weight: f32) -> f32 {
  let amt = clamp(amount, -1.0, 1.0);
  let w = clamp01(weight);
  if (amt >= 0.0) {
    return value + (1.0 - value) * amt * w;
  }
  return value + value * amt * w;
}

fn rgb_to_hsl(c: vec3f) -> vec3f {
  let r = c.x;
  let g = c.y;
  let b = c.z;
  let maxc = max(r, max(g, b));
  let minc = min(r, min(g, b));
  let l = (maxc + minc) * 0.5;
  if (maxc == minc) {
    return vec3f(0.0, 0.0, l);
  }
  let d = maxc - minc;
  var h = 0.0;
  let s = select(d / (maxc + minc), d / (2.0 - maxc - minc), l > 0.5);
  if (maxc == r) {
    h = (g - b) / d + select(6.0, 0.0, g >= b);
  } else if (maxc == g) {
    h = (b - r) / d + 2.0;
  } else {
    h = (r - g) / d + 4.0;
  }
  h = h / 6.0;
  return vec3f(h, s, l);
}

fn hue2rgb(p: f32, q: f32, t: f32) -> f32 {
  var tt = t;
  if (tt < 0.0) { tt = tt + 1.0; }
  if (tt > 1.0) { tt = tt - 1.0; }
  if (tt < (1.0 / 6.0)) { return p + (q - p) * 6.0 * tt; }
  if (tt < 0.5) { return q; }
  if (tt < (2.0 / 3.0)) { return p + (q - p) * ((2.0 / 3.0) - tt) * 6.0; }
  return p;
}

fn hsl_to_rgb(hsl: vec3f) -> vec3f {
  let h = hsl.x;
  let s = hsl.y;
  let l = hsl.z;
  if (s == 0.0) {
    return vec3f(l, l, l);
  }
  let q = select(l * (1.0 + s), l + s - l * s, l >= 0.5);
  let p = 2.0 * l - q;
  return vec3f(
    hue2rgb(p, q, h + (1.0 / 3.0)),
    hue2rgb(p, q, h),
    hue2rgb(p, q, h - (1.0 / 3.0))
  );
}

fn hue_distance_deg(a: f32, b: f32) -> f32 {
  let d = abs(a - b);
  return min(d, 360.0 - d);
}

fn band_weight(hueDeg: f32, centerDeg: f32) -> f32 {
  return clamp01(1.0 - hue_distance_deg(hueDeg, centerDeg) / 45.0);
}

fn apply_lut(val: f32, offset: u32) -> f32 {
  let v = clamp01(val);
  let pos = v * 255.0;
  let idx = u32(pos);
  let f = fract(pos);
  let p0 = curveLut[offset + idx];
  let idxNext = min(idx + 1u, 255u);
  let p1 = curveLut[offset + idxNext];
  return p0 * (1.0 - f) + p1 * f;
}

@compute @workgroup_size(16, 16)
fn main(@builtin(global_invocation_id) gid: vec3u) {
  if (gid.x >= u.width || gid.y >= u.height) { return; }
  if (u.enabled == 0u) { return; }
  let idx = gid.y * u.width + gid.x;

  let mask = clamp01(maskAlpha[idx] * u.opacity);
  if (mask <= 0.0) { return; }

  let src = work[idx].xyz;
  var adjusted = src;

  if (u.exposure != 0.0) {
    adjusted = adjusted * exp2(u.exposure);
  }

  if (u.temperature != 0.0 || u.tint != 0.0) {
    let t = u.temperature / 100.0;
    let ti = u.tint / 100.0;
    adjusted = vec3f(
      adjusted.x * (1.0 + 0.18 * t + 0.08 * ti),
      adjusted.y * (1.0 - 0.16 * ti),
      adjusted.z * (1.0 - 0.18 * t + 0.08 * ti)
    );
  }

  if (u.contrast != 0.0) {
    let contrastScale = 1.0 + (u.contrast / 100.0);
    adjusted = (adjusted - vec3f(0.5, 0.5, 0.5)) * contrastScale + vec3f(0.5, 0.5, 0.5);
  }

  if (u.highlights != 0.0 || u.shadows != 0.0) {
    let lumaNow = clamp01(dot(adjusted, vec3f(0.2126, 0.7152, 0.0722)));
    let wHighlights = smoothstep01(0.5, 1.0, lumaNow);
    let wShadows = 1.0 - smoothstep01(0.0, 0.5, lumaNow);
    let highlightAmount = u.highlights / 100.0;
    let shadowAmount = u.shadows / 100.0;
    adjusted = vec3f(
      tone_adjust(adjusted.x, highlightAmount, wHighlights),
      tone_adjust(adjusted.y, highlightAmount, wHighlights),
      tone_adjust(adjusted.z, highlightAmount, wHighlights)
    );
    adjusted = vec3f(
      tone_adjust(adjusted.x, shadowAmount, wShadows),
      tone_adjust(adjusted.y, shadowAmount, wShadows),
      tone_adjust(adjusted.z, shadowAmount, wShadows)
    );
  }

  if (
    u.vibrance != 0.0 || u.saturation != 0.0 ||
    u.mixerHue0.x != 0.0 || u.mixerHue0.y != 0.0 || u.mixerHue0.z != 0.0 || u.mixerHue0.w != 0.0 ||
    u.mixerHue1.x != 0.0 || u.mixerHue1.y != 0.0 || u.mixerHue1.z != 0.0 || u.mixerHue1.w != 0.0 ||
    u.mixerSat0.x != 0.0 || u.mixerSat0.y != 0.0 || u.mixerSat0.z != 0.0 || u.mixerSat0.w != 0.0 ||
    u.mixerSat1.x != 0.0 || u.mixerSat1.y != 0.0 || u.mixerSat1.z != 0.0 || u.mixerSat1.w != 0.0 ||
    u.mixerLum0.x != 0.0 || u.mixerLum0.y != 0.0 || u.mixerLum0.z != 0.0 || u.mixerLum0.w != 0.0 ||
    u.mixerLum1.x != 0.0 || u.mixerLum1.y != 0.0 || u.mixerLum1.z != 0.0 || u.mixerLum1.w != 0.0
  ) {
    var hsl = rgb_to_hsl(vec3f(clamp01(adjusted.x), clamp01(adjusted.y), clamp01(adjusted.z)));

    if (u.vibrance != 0.0) {
      let vib = u.vibrance / 100.0;
      hsl.y = select(clamp01(hsl.y + vib * hsl.y), clamp01(hsl.y + vib * (1.0 - hsl.y)), vib >= 0.0);
    }
    if (u.saturation != 0.0) {
      hsl.y = clamp01(hsl.y + (u.saturation / 100.0));
    }

    let hueDeg = fract(hsl.x) * 360.0;
    let w0 = band_weight(hueDeg, 0.0);
    let w1 = band_weight(hueDeg, 30.0);
    let w2 = band_weight(hueDeg, 60.0);
    let w3 = band_weight(hueDeg, 120.0);
    let w4 = band_weight(hueDeg, 180.0);
    let w5 = band_weight(hueDeg, 240.0);
    let w6 = band_weight(hueDeg, 285.0);
    let w7 = band_weight(hueDeg, 320.0);

    let sumW = w0 + w1 + w2 + w3 + w4 + w5 + w6 + w7;
    if (sumW > 1e-6) {
      let hueSum =
        w0 * u.mixerHue0.x + w1 * u.mixerHue0.y + w2 * u.mixerHue0.z + w3 * u.mixerHue0.w +
        w4 * u.mixerHue1.x + w5 * u.mixerHue1.y + w6 * u.mixerHue1.z + w7 * u.mixerHue1.w;
      let satSum =
        w0 * u.mixerSat0.x + w1 * u.mixerSat0.y + w2 * u.mixerSat0.z + w3 * u.mixerSat0.w +
        w4 * u.mixerSat1.x + w5 * u.mixerSat1.y + w6 * u.mixerSat1.z + w7 * u.mixerSat1.w;
      let lumSum =
        w0 * u.mixerLum0.x + w1 * u.mixerLum0.y + w2 * u.mixerLum0.z + w3 * u.mixerLum0.w +
        w4 * u.mixerLum1.x + w5 * u.mixerLum1.y + w6 * u.mixerLum1.z + w7 * u.mixerLum1.w;
      let invW = 1.0 / sumW;
      let chromaWeight = clamp01((hsl.y - 0.03) / 0.25);
      let hueShiftNorm = ((hueSum * invW) / 100.0) * (45.0 / 360.0) * chromaWeight;
      hsl.x = fract(hsl.x + hueShiftNorm);
      hsl.y = clamp01(hsl.y + ((satSum * invW) / 100.0) * chromaWeight);
      hsl.z = clamp01(hsl.z + ((lumSum * invW) / 100.0) * chromaWeight);
    }

    adjusted = hsl_to_rgb(hsl);
  }

  let luma = max(0.0, dot(adjusted, vec3f(0.2126, 0.7152, 0.0722)));
  let lumaMapped = apply_lut(luma, 0u);
  let masterScale = select(1.0, lumaMapped / luma, luma > 1e-6);
  let mr = clamp01(adjusted.x * masterScale);
  let mg = clamp01(adjusted.y * masterScale);
  let mb = clamp01(adjusted.z * masterScale);
  adjusted = vec3f(
    apply_lut(mr, 256u),
    apply_lut(mg, 512u),
    apply_lut(mb, 768u)
  );

  let blendValue = select(adjusted, (2.0 * src - adjusted), u.blendMode == 1u);
  let mixed = src * (1.0 - mask) + blendValue * mask;
  work[idx] = vec4f(mixed, 1.0);
}
`,ole=`
struct OutputUniforms {
  width: u32,
  height: u32,
};

@group(0) @binding(0) var<uniform> u: OutputUniforms;
@group(0) @binding(1) var<storage, read> work: array<vec4f>;
@group(0) @binding(2) var<storage, read_write> outBuf: array<u32>;

fn clamp01(x: f32) -> f32 {
  return max(0.0, min(1.0, x));
}

fn linear_to_srgb(x: f32) -> f32 {
  let v = clamp01(x);
  if (v <= 0.0031308) {
    return 12.92 * v;
  }
  return 1.055 * pow(v, 1.0 / 2.4) - 0.055;
}

@compute @workgroup_size(16, 16)
fn main(@builtin(global_invocation_id) gid: vec3u) {
  if (gid.x >= u.width || gid.y >= u.height) { return; }
  let idx = gid.y * u.width + gid.x;
  let v = work[idx];
  let r8 = u32(linear_to_srgb(v.x) * 255.0 + 0.5);
  let g8 = u32(linear_to_srgb(v.y) * 255.0 + 0.5);
  let b8 = u32(linear_to_srgb(v.z) * 255.0 + 0.5);
  let a8 = 255u;
  outBuf[idx] = (a8 << 24u) | (b8 << 16u) | (g8 << 8u) | r8;
}
`;class sle{constructor(){fr(this,"device",null);fr(this,"layerPipeline",null);fr(this,"outputPipeline",null);fr(this,"layerBindGroupLayout",null);fr(this,"outputBindGroupLayout",null);fr(this,"layerUniformBuffer",null);fr(this,"outputUniformBuffer",null);fr(this,"initialized",!1);fr(this,"resources",new Map);fr(this,"maskCpuCache",new Map);fr(this,"maxBufferSize",256*1024*1024);fr(this,"maxStorageBufferBindingSize",128*1024*1024);fr(this,"lastRenderBusy",!1)}async init(){var t,r;if(this.initialized)return!0;if(!navigator.gpu)return!1;try{const n=await navigator.gpu.requestAdapter();if(!n)return!1;const a={};(t=n.limits)!=null&&t.maxBufferSize&&(this.maxBufferSize=Number(n.limits.maxBufferSize),a.maxBufferSize=this.maxBufferSize),(r=n.limits)!=null&&r.maxStorageBufferBindingSize&&(this.maxStorageBufferBindingSize=Number(n.limits.maxStorageBufferBindingSize),a.maxStorageBufferBindingSize=this.maxStorageBufferBindingSize),this.device=await n.requestDevice({requiredLimits:Object.keys(a).length?a:void 0});const i=this.device.createShaderModule({code:ile}),o=this.device.createShaderModule({code:ole});return this.layerBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:3,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}}]}),this.outputBindGroupLayout=this.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,buffer:{type:"uniform"}},{binding:1,visibility:GPUShaderStage.COMPUTE,buffer:{type:"read-only-storage"}},{binding:2,visibility:GPUShaderStage.COMPUTE,buffer:{type:"storage"}}]}),this.layerPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[this.layerBindGroupLayout]}),compute:{module:i,entryPoint:"main"}}),this.outputPipeline=this.device.createComputePipeline({layout:this.device.createPipelineLayout({bindGroupLayouts:[this.outputBindGroupLayout]}),compute:{module:o,entryPoint:"main"}}),this.layerUniformBuffer=this.device.createBuffer({size:160,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.outputUniformBuffer=this.device.createBuffer({size:16,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST}),this.initialized=!0,!0}catch(n){return console.error("[PS GPU] init failed",n),!1}}getMaskData(t){const r=`${t.id}:${t.version}`,n=this.maskCpuCache.get(r);if(n)return n;const a=t.alpha;if(this.maskCpuCache.set(r,a),this.maskCpuCache.size>48){const i=this.maskCpuCache.keys().next().value;i&&this.maskCpuCache.delete(i)}return a}ensureResource(t){if(!this.device)return null;let r=this.resources.get(t.id);const n=t.width*t.height,a=n*16,i=n*4;if(a>this.maxBufferSize||a>this.maxStorageBufferBindingSize)return console.warn(`[PS GPU] image too large for current storage buffer limits: ${a} bytes, maxStorageBufferBindingSize=${this.maxStorageBufferBindingSize}, maxBufferSize=${this.maxBufferSize}`),null;if(i>this.maxBufferSize||i>this.maxStorageBufferBindingSize)return console.warn(`[PS GPU] output too large for current storage buffer limits: ${i} bytes, maxStorageBufferBindingSize=${this.maxStorageBufferBindingSize}, maxBufferSize=${this.maxBufferSize}`),null;if(r&&(r.width!==t.width||r.height!==t.height)&&(this.dispose(t.id),r=void 0),r){if(r.baseSourceRef!==t.baseRgb){const o=new Float32Array(n*4);for(let s=0,l=0;s<n;s++,l+=3){const u=s*4;o[u]=t.baseRgb[l],o[u+1]=t.baseRgb[l+1],o[u+2]=t.baseRgb[l+2],o[u+3]=1}this.device.queue.writeBuffer(r.baseBuffer,0,o),r.baseSourceRef=t.baseRgb}}else{const o=new Float32Array(n*4);for(let f=0,h=0;f<n;f++,h+=3){const p=f*4;o[p]=t.baseRgb[h],o[p+1]=t.baseRgb[h+1],o[p+2]=t.baseRgb[h+2],o[p+3]=1}const s=this.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(s,0,o);const l=this.device.createBuffer({size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.STORAGE}),u=this.device.createBuffer({size:i,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_SRC}),d=this.device.createBuffer({size:i,usage:GPUBufferUsage.MAP_READ|GPUBufferUsage.COPY_DST});r={width:t.width,height:t.height,pixelCount:n,baseBuffer:s,baseSourceRef:t.baseRgb,workBuffer:l,outputBuffer:u,readBuffer:d,busy:!1,maskGpuCache:new Map,curveGpuCache:new Map},this.resources.set(t.id,r)}return r}ensureMaskBuffer(t,r){if(!this.device)return null;const n=`${r.id}:${r.version}`,a=[];for(const l of t.maskGpuCache.keys())l.startsWith(`${r.id}:`)&&l!==n&&a.push(l);for(const l of a){const u=t.maskGpuCache.get(l);u&&u.destroy(),t.maskGpuCache.delete(l)}const i=t.maskGpuCache.get(n);if(i)return i;const o=this.getMaskData(r),s=this.device.createBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST});return this.device.queue.writeBuffer(s,0,o),t.maskGpuCache.set(n,s),s}ensureCurveBuffer(t,r,n){if(!this.device)return null;const a=yg(n),i=JSON.stringify(a),o=new Float32Array(1024);o.set(ca(a.master),0),o.set(ca(a.red),256),o.set(ca(a.green),512),o.set(ca(a.blue),768);let s=t.curveGpuCache.get(r);return s||(s={buffer:this.device.createBuffer({size:o.byteLength,usage:GPUBufferUsage.STORAGE|GPUBufferUsage.COPY_DST}),signature:""},t.curveGpuCache.set(r,s)),s.signature!==i&&(this.device.queue.writeBuffer(s.buffer,0,o),s.signature=i),s.buffer}async renderPreview(t){if(!this.initialized&&!await this.init()||!this.device||!this.layerPipeline||!this.outputPipeline||!this.layerUniformBuffer||!this.outputUniformBuffer)return null;const r=this.ensureResource(t);if(!r)return null;if(r.busy)return this.lastRenderBusy=!0,null;this.lastRenderBusy=!1,r.busy=!0;const n=[];try{const a=new Map;for(const f of t.layers)f.enabled&&a.set(f.maskId,f);const i=this.device.createCommandEncoder();i.copyBufferToBuffer(r.baseBuffer,0,r.workBuffer,0,r.pixelCount*16);for(const f of t.masks){const h=a.get(f.id);if(!h||!f.visible)continue;const p=this.ensureMaskBuffer(r,f),x=this.ensureCurveBuffer(r,h.id,h.curves);if(!p||!x)continue;const b=Yc(h.basic),y=qc(h.mixer),m=new Float32Array(40),g=new Uint32Array(m.buffer);g[0]=r.width,g[1]=r.height,g[2]=h.blendMode==="subtract"?1:0,g[3]=h.enabled?1:0,m[4]=h.opacity,m[5]=b.exposure,m[6]=b.temperature,m[7]=b.tint,m[8]=b.contrast,m[9]=b.highlights,m[10]=b.shadows,m[11]=b.vibrance,m[12]=b.saturation,m[16]=y.red.hue,m[17]=y.orange.hue,m[18]=y.yellow.hue,m[19]=y.green.hue,m[20]=y.aqua.hue,m[21]=y.blue.hue,m[22]=y.purple.hue,m[23]=y.magenta.hue,m[24]=y.red.saturation,m[25]=y.orange.saturation,m[26]=y.yellow.saturation,m[27]=y.green.saturation,m[28]=y.aqua.saturation,m[29]=y.blue.saturation,m[30]=y.purple.saturation,m[31]=y.magenta.saturation,m[32]=y.red.luminance,m[33]=y.orange.luminance,m[34]=y.yellow.luminance,m[35]=y.green.luminance,m[36]=y.aqua.luminance,m[37]=y.blue.luminance,m[38]=y.purple.luminance,m[39]=y.magenta.luminance;const k=this.device.createBuffer({size:160,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST});this.device.queue.writeBuffer(k,0,m),n.push(k);const S=this.device.createBindGroup({layout:this.layerBindGroupLayout,entries:[{binding:0,resource:{buffer:k}},{binding:1,resource:{buffer:r.workBuffer}},{binding:2,resource:{buffer:p}},{binding:3,resource:{buffer:x}}]}),w=i.beginComputePass();w.setPipeline(this.layerPipeline),w.setBindGroup(0,S),w.dispatchWorkgroups(Math.ceil(r.width/16),Math.ceil(r.height/16)),w.end()}const o=new Uint32Array(4);o[0]=r.width,o[1]=r.height,this.device.queue.writeBuffer(this.outputUniformBuffer,0,o);const s=this.device.createBindGroup({layout:this.outputBindGroupLayout,entries:[{binding:0,resource:{buffer:this.outputUniformBuffer}},{binding:1,resource:{buffer:r.workBuffer}},{binding:2,resource:{buffer:r.outputBuffer}}]}),l=i.beginComputePass();l.setPipeline(this.outputPipeline),l.setBindGroup(0,s),l.dispatchWorkgroups(Math.ceil(r.width/16),Math.ceil(r.height/16)),l.end(),i.copyBufferToBuffer(r.outputBuffer,0,r.readBuffer,0,r.pixelCount*4),this.device.queue.submit([i.finish()]),await r.readBuffer.mapAsync(GPUMapMode.READ);const u=new Uint8ClampedArray(r.readBuffer.getMappedRange()),d=new ImageData(new Uint8ClampedArray(u),r.width,r.height);return r.readBuffer.unmap(),d}catch(a){console.error("[PS GPU] render failed",a);try{r.readBuffer.unmap()}catch{}return null}finally{for(const a of n)try{a.destroy()}catch{}r.busy=!1}}dispose(t){const r=this.resources.get(t);if(r){r.baseBuffer.destroy(),r.workBuffer.destroy(),r.outputBuffer.destroy(),r.readBuffer.destroy();for(const n of r.maskGpuCache.values())n.destroy();for(const n of r.curveGpuCache.values())n.buffer.destroy();this.resources.delete(t)}}wasBusyLastRender(){return this.lastRenderBusy}}const th=new sle,rh=1024,oj=/\.(arw|cr2|cr3|dng|nef|orf|raf|rw2|pef|srw|sr2|srf|x3f|erf|mef|mos|mrw|kdc|dcr|iiq|3fr|fff|rwl|nrw|raw)$/i,bd="jiangtherapee onlinecsv",sj="jiangtherapee.ps.workflow.json",lj=80,lle=20,cle=6,_n=e=>({x:e.x,y:e.y}),_l=e=>({...e,p1:_n(e.p1),p2:_n(e.p2)}),KO=e=>({model:e.model,focal:Number(e.focal)||0,k1:Number(e.k1)||0,k2:Number(e.k2)||0,a:Number(e.a)||0,b:Number(e.b)||0,c:Number(e.c)||0,lensLabel:e.lensLabel||""}),YO=e=>{switch(e.type){case"crop":return{type:"crop",rect:{...e.rect}};case"rotate":return{type:"rotate",angleDeg:e.angleDeg};case"flipH":return{type:"flipH"};case"flipV":return{type:"flipV"};case"lensDistortion":return{type:"lensDistortion",params:KO(e.params)};case"upright":return{type:"upright",guides:e.guides.map(_l)}}},ss=e=>e.map(YO),ju=e=>e.type==="ellipse"?{...e,center:_n(e.center)}:{...e,points:e.points.map(t=>_n(t))},J2=e=>{const t=Yc(e==null?void 0:e.basic),r=e==null?void 0:e.hsl;return!(e!=null&&e.basic)&&r&&(t.saturation=Math.max(-100,Math.min(100,Number(r.saturation)||0)),t.exposure=Math.max(-5,Math.min(5,(Number(r.lightness)||0)/100*1.5))),t},Q2=e=>{const t=qc(e==null?void 0:e.mixer),r=e==null?void 0:e.hsl;if(!(e!=null&&e.mixer)&&r&&Number.isFinite(Number(r.hue))){const n=Math.max(-100,Math.min(100,Number(r.hue)/180*100));return{red:{...t.red,hue:n},orange:{...t.orange,hue:n},yellow:{...t.yellow,hue:n},green:{...t.green,hue:n},aqua:{...t.aqua,hue:n},blue:{...t.blue,hue:n},purple:{...t.purple,hue:n},magenta:{...t.magenta,hue:n}}}return t},nh=e=>({...e,baseRgb:e.baseRgb,masks:e.masks.map(t=>({...t,alpha:t.alpha,items:(t.items||[]).map(ju)})),layers:e.layers.map(t=>({...t,basic:J2(t),mixer:Q2(t),curves:{master:t.curves.master.map(_n),red:t.curves.red.map(_n),green:t.curves.green.map(_n),blue:t.curves.blue.map(_n)}})),guides:e.guides.map(t=>({...t,p1:_n(t.p1),p2:_n(t.p2)})),transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null},history:e.history.map(t=>({...t}))}),tg=e=>{var t,r,n,a;return{...e,basic:J2(e),mixer:Q2(e),curves:{master:(((t=e.curves)==null?void 0:t.master)||[{x:0,y:0},{x:1,y:1}]).map(_n),red:(((r=e.curves)==null?void 0:r.red)||[{x:0,y:0},{x:1,y:1}]).map(_n),green:(((n=e.curves)==null?void 0:n.green)||[{x:0,y:0},{x:1,y:1}]).map(_n),blue:(((a=e.curves)==null?void 0:a.blue)||[{x:0,y:0},{x:1,y:1}]).map(_n)}}},ule=e=>({id:e.id,name:e.name,shape:e.shape,visible:e.visible,overlayVisible:e.overlayVisible??!0,items:(e.items||[]).map(ju)}),cj=(e,t)=>({width:e.width,height:e.height,transformOps:ss(t),masks:e.masks.map(ule),layers:e.layers.map(tg),guides:e.guides.map(_l),selectedMaskId:e.selectedMaskId,selectedLayerId:e.selectedLayerId,selectedMaskItemId:e.selectedMaskItemId,selectedGuideId:e.selectedGuideId,transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null}}),uj=(e,t)=>{var x,b,y;const r=Number(t.width),n=Number(t.height);if(!Number.isFinite(r)||!Number.isFinite(n)||r<=0||n<=0)throw new Error("Invalid workflow canvas size.");const a=ss(t.transformOps||[]),i=dle(e,a);if(i.width!==r||i.height!==n)throw new Error(`Workflow transform replay size mismatch: expected ${r}x${n}, got ${i.width}x${i.height}.`);const o=(t.masks||[]).map(m=>({id:m.id,name:m.name,shape:m.shape||"full",width:r,height:n,alpha:new Float32Array(r*n),featherPx:0,visible:m.visible!==!1,overlayVisible:m.overlayVisible!==!1,version:1,items:(m.items||[]).map(ju)})),s=((x=o[0])==null?void 0:x.id)||"",l=(t.layers||[]).map(m=>({...tg(m),maskId:o.some(g=>g.id===m.maskId)?m.maskId:s})),u=(t.guides||[]).map(_l),d=o.some(m=>m.id===t.selectedMaskId)?t.selectedMaskId:((b=o[0])==null?void 0:b.id)||"",f=l.some(m=>m.id===t.selectedLayerId)?t.selectedLayerId:((y=l[0])==null?void 0:y.id)||"",h=t.selectedGuideId&&u.some(m=>m.id===t.selectedGuideId)?t.selectedGuideId:null,p=t.selectedMaskItemId&&o.some(m=>(m.items||[]).some(g=>g.id===t.selectedMaskItemId))?t.selectedMaskItemId:null;return P_({...i,width:r,height:n,masks:o,layers:l,guides:u,selectedMaskId:d,selectedLayerId:f,selectedMaskItemId:p,selectedGuideId:h,transform:t.transform?{rotationDeg:Number(t.transform.rotationDeg)||0,crop:t.transform.crop?{...t.transform.crop}:null}:{rotationDeg:0,crop:null}})},Zx=e=>{const t={...e,baseRgb:e.baseRgb,masks:e.masks.map(r=>({...r,alpha:new Float32Array(r.width*r.height),items:(r.items||[]).map(ju)})),layers:e.layers.map(r=>({...r,basic:J2(r),mixer:Q2(r),curves:{master:r.curves.master.map(_n),red:r.curves.red.map(_n),green:r.curves.green.map(_n),blue:r.curves.blue.map(_n)}})),guides:e.guides.map(r=>({...r,p1:_n(r.p1),p2:_n(r.p2)})),transform:{rotationDeg:e.transform.rotationDeg,crop:e.transform.crop?{...e.transform.crop}:null},history:e.history.map(r=>({...r}))};return P_(t)},dle=(e,t)=>{var n;let r=e;for(const a of t){if(a.type==="crop"){r=T_(r,a.rect);continue}if(a.type==="rotate"){r=E_(r,a.angleDeg);continue}if(a.type==="flipH"){r=I_(r);continue}if(a.type==="flipV"){r=R_(r);continue}if(a.type==="lensDistortion"){r=D_(r,a.params);continue}const i={...r,guides:a.guides.map(_l),selectedGuideId:((n=a.guides[0])==null?void 0:n.id)||null};r=$_(i)}return r},fle=e=>{const t=atob(e);let r="";for(let n=0;n<t.length;n++)r+=`%${t.charCodeAt(n).toString(16).padStart(2,"0")}`;return decodeURIComponent(r)},dj=e=>{const t=e.trim();return t.startsWith('"')&&t.endsWith('"')?t.slice(1,-1).replace(/""/g,'"'):t},hle=e=>{const t=[];let r="",n=!1;for(let a=0;a<e.length;a++){const i=e[a];if(i==='"'){n&&e[a+1]==='"'?(r+='"',a++):n=!n;continue}if(i===","&&!n){t.push(r),r="";continue}r+=i}return t.push(r),t},fj=e=>(e||"image").replace(/\.[^/.]+$/,"")||"image",ple=(e,t,r)=>{const n=e.width,a=e.height,i=new ImageData(t,r),o=e.data,s=i.data,l=n/t,u=a/r;for(let d=0;d<r;d++){const f=Math.floor(d*u),h=d*t*4,p=f*n*4;for(let x=0;x<t;x++){const y=Math.floor(x*l)*4,m=h+x*4,g=p+y;s[m]=o[g],s[m+1]=o[g+1],s[m+2]=o[g+2],s[m+3]=o[g+3]}}return i},gle=(e,t)=>{if(!e)return null;if(t){const r=e.bayerPattern.toUpperCase(),n=l=>{const u=[];for(let d=0;d<4;d++)r[d]===l&&u.push(d);return u},a=t.BlackLevelRed,i=t.BlackLevelGreen,o=t.BlackLevelBlue;if(a!==void 0&&i!==void 0&&o!==void 0){const l=parseFloat(a),u=parseFloat(i),d=parseFloat(o);if(!isNaN(l)&&!isNaN(u)&&!isNaN(d)){const f=[0,0,0,0];if(f.fill(u),n("R").forEach(h=>f[h]=l),n("G").forEach(h=>f[h]=u),n("B").forEach(h=>d),f.some(h=>h>0))return f}}let s=t.BlackLevel;if(s===void 0&&(s=t.BlackLevel2),s!==void 0){let l=[];if(Array.isArray(s)?l=s.map(Number):typeof s=="string"?l=s.trim().split(/\s+/).map(Number):typeof s=="number"&&(l=[s,s,s,s]),l.length===1&&!isNaN(l[0])&&(l=[l[0],l[0],l[0],l[0]]),l.length>=4&&!l.slice(0,4).some(isNaN)&&l.some(u=>u>0))return[l[0],l[1],l[2],l[3]]}}return e.blackLevels&&e.blackLevels.length===4?[e.blackLevels[0],e.blackLevels[1],e.blackLevels[2],e.blackLevels[3]]:null},mle=({stats:e,onClose:t,onMinimize:r,isBGGR:n,onToggleBGGR:a,onOpenWindow:i,displaySettings:o,zIndex:s,onFocus:l,rawImageData:u})=>{if(!e)return null;const d=!!o.showKadc,f=o.blackLevel||[0,0,0,0],h=!!o.subtractBlackLevelFromStats&&!!o.blackLevel,p=!!(u!=null&&u.isThreePlane),x=j.useMemo(()=>{if(!e||!u||!o.advancedZeroDep||o.renderMode!=="advanced-zero-dep")return null;try{const{x:w,y:v,width:M,height:_}=e,P=Gv(u,{x:w,y:v,w:M,h:_},o),A=[0,0,0,0],R=[0,0,0,0],D=Math.floor(v),E=Math.floor(w);for(let W=0;W<P.height;W++){const F=W*P.width;for(let O=0;O<P.width;O++){const $=P.data[F+O],N=D+W,C=E+O,B=N%2,I=C%2,z=B*2+I;A[z]+=$,R[z]++}}return A.map((W,F)=>R[F]>0?W/R[F]:0)}catch(w){return console.error("Unmix calc error",w),null}},[e,u,o]),b=(w,v,M)=>d?v<=1e-4?0:(w-M)/v:null,y=(w,v)=>h?w-f[v]:w,m=()=>{if(!h){alert(`Sub. BL
Please enable 'Sub. BL' in Tools sidebar first.`);return}let w,v,M,_;n?(_=0,v=1,M=2,w=3):(w=0,v=1,M=2,_=3);const P=R=>e.means[R]-f[R],A=R=>e.stdDevs[R];localStorage.setItem("import_signal_r",P(w).toString()),localStorage.setItem("import_signal_g1",P(v).toString()),localStorage.setItem("import_signal_g2",P(M).toString()),localStorage.setItem("import_signal_b",P(_).toString()),localStorage.setItem("import_sigma_r",A(w).toString()),localStorage.setItem("import_sigma_g1",A(v).toString()),localStorage.setItem("import_sigma_g2",A(M).toString()),localStorage.setItem("import_sigma_b",A(_).toString()),window.open("https://y-g-jiang.github.io/XJZS.html","_blank")},g=p?[{name:"R",desc:"RGB",mean:y(e.means[0],0),std:e.stdDevs[0],color:"text-red-500",snr:b(e.means[0],e.stdDevs[0],f[0]),unmixed:null},{name:"G",desc:"RGB",mean:y(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:b(e.means[1],e.stdDevs[1],f[1]),unmixed:null},{name:"B",desc:"RGB",mean:y(e.means[2],2),std:e.stdDevs[2],color:"text-blue-500",snr:b(e.means[2],e.stdDevs[2],f[2]),unmixed:null}]:n?[{name:"B",desc:"(0,0)",mean:y(e.means[0],0),std:e.stdDevs[0],color:"text-blue-500",snr:b(e.means[0],e.stdDevs[0],f[0]),unmixed:x?x[0]:null},{name:"G1",desc:"(0,1)",mean:y(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:b(e.means[1],e.stdDevs[1],f[1]),unmixed:x?x[1]:null},{name:"G2",desc:"(1,0)",mean:y(e.means[2],2),std:e.stdDevs[2],color:"text-green-500",snr:b(e.means[2],e.stdDevs[2],f[2]),unmixed:x?x[2]:null},{name:"R",desc:"(1,1)",mean:y(e.means[3],3),std:e.stdDevs[3],color:"text-red-500",snr:b(e.means[3],e.stdDevs[3],f[3]),unmixed:x?x[3]:null}]:[{name:"R",desc:"(0,0)",mean:y(e.means[0],0),std:e.stdDevs[0],color:"text-red-500",snr:b(e.means[0],e.stdDevs[0],f[0]),unmixed:x?x[0]:null},{name:"G1",desc:"(0,1)",mean:y(e.means[1],1),std:e.stdDevs[1],color:"text-green-500",snr:b(e.means[1],e.stdDevs[1],f[1]),unmixed:x?x[1]:null},{name:"G2",desc:"(1,0)",mean:y(e.means[2],2),std:e.stdDevs[2],color:"text-green-500",snr:b(e.means[2],e.stdDevs[2],f[2]),unmixed:x?x[2]:null},{name:"B",desc:"(1,1)",mean:y(e.means[3],3),std:e.stdDevs[3],color:"text-blue-500",snr:b(e.means[3],e.stdDevs[3],f[3]),unmixed:x?x[3]:null}],k=x?"w-96":d?"w-80":"w-60",S=j.useMemo(()=>{if(!e||!u||Math.round(e.width)!==1||Math.round(e.height)!==1)return null;const w=u.metadata||{},v=Array.isArray(w.sourceNames)?w.sourceNames:[];if(!v.length)return null;const M=w.sourceMap;if(!M)return null;const _=Math.max(0,Math.min(u.width-1,Math.round(e.x))),A=Math.max(0,Math.min(u.height-1,Math.round(e.y)))*u.width+_;let R=Number.NaN;if((Array.isArray(M)||ArrayBuffer.isView(M))&&(R=Number(M[A])),!Number.isFinite(R))return null;const D=Math.round(R);return D>=0&&D<v.length?v[D]:D===-1?"Scalar / No RAW Source":D===-2?"Mixed Source":`Source #${D}`},[e,u]);return c.jsxs(Ks,{className:`${k} p-0 overflow-hidden transition-all duration-300 bg-white dark:bg-black border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] dark:shadow-[4px_4px_0px_rgba(255,255,255,0.2)]`,onClose:t,zIndex:s,onFocus:l,initialPosition:{x:20,y:80},children:[c.jsxs("div",{className:"flex justify-between items-center px-3 py-2 border-b border-gray-100 dark:border-slate-800 bg-gray-50/50 dark:bg-slate-800/50 select-none",children:[c.jsxs("h3",{className:"text-xs font-bold text-gray-700 dark:text-slate-300 uppercase tracking-wider flex items-center gap-2",children:["ROI Analysis",c.jsxs("span",{className:"text-[10px] font-normal text-gray-400 bg-gray-200 dark:bg-slate-700 px-1.5 py-0.5 rounded",children:[Math.round(e.width),"",Math.round(e.height)]})]}),c.jsxs("div",{className:"flex items-center gap-1",children:[c.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-slate-300 transition-colors p-1 rounded-md hover:bg-gray-200 dark:hover:bg-slate-700 relative z-20",children:c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),c.jsx("button",{onClick:t,className:"text-gray-400 hover:text-red-500 dark:hover:text-red-400 transition-colors p-1 rounded-md hover:bg-gray-200 dark:hover:bg-slate-700 relative z-20",children:c.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),c.jsxs("div",{className:"p-3",children:[c.jsxs("div",{className:"flex justify-between items-center mb-3",children:[c.jsxs("div",{className:"text-[10px] text-gray-400 dark:text-slate-500 font-mono leading-tight",children:["X: ",Math.round(e.x),c.jsx("br",{}),"Y: ",Math.round(e.y),S&&c.jsxs(c.Fragment,{children:[c.jsx("br",{}),c.jsxs("span",{className:"text-emerald-600 dark:text-emerald-400 font-bold",children:["Src: ",S]})]})]}),!p&&c.jsx("button",{onClick:()=>a(!n),className:"text-[10px] font-bold px-2 py-1 rounded bg-gray-100 hover:bg-gray-200 dark:bg-slate-800 dark:hover:bg-slate-700 text-gray-600 dark:text-slate-300 transition-colors border border-gray-200 dark:border-slate-700 relative z-20",title:"Toggle Bayer Pattern Interpretation",children:n?"BGGR":"RGGB"})]}),c.jsxs("table",{className:"w-full mb-3",children:[c.jsx("thead",{children:c.jsxs("tr",{className:"text-[10px] text-gray-400 dark:text-slate-500 border-b border-gray-100 dark:border-slate-800",children:[c.jsx("th",{className:"text-left pb-1 font-medium",children:"Ch"}),c.jsxs("th",{className:"text-right pb-1 font-medium",children:["Mean",h?"*":""]}),c.jsx("th",{className:"text-right pb-1 font-medium",children:"Std()"}),d&&c.jsx("th",{className:"text-right pb-1 font-medium text-cyan-600 dark:text-cyan-400",children:"k"}),x&&c.jsx("th",{className:"text-right pb-1 font-medium text-indigo-600 dark:text-indigo-400",children:"Unmix"})]})}),c.jsx("tbody",{className:"font-mono text-xs",children:g.map((w,v)=>c.jsxs("tr",{className:"group hover:bg-gray-50 dark:hover:bg-slate-800/30 transition-colors",children:[c.jsxs("td",{className:"py-1",children:[c.jsx("span",{className:`font-bold ${w.color}`,children:w.name}),c.jsx("span",{className:"text-[9px] text-gray-300 dark:text-slate-600 ml-1 hidden group-hover:inline",children:w.desc})]}),c.jsx("td",{className:"py-1 text-right text-gray-700 dark:text-slate-200 font-semibold",children:w.mean.toFixed(2)}),c.jsx("td",{className:"py-1 text-right text-gray-500 dark:text-slate-400",children:w.std.toFixed(2)}),d&&c.jsx("td",{className:"py-1 text-right text-cyan-600 dark:text-cyan-400 font-bold",children:w.snr!==null?w.snr.toFixed(2):"-"}),x&&c.jsx("td",{className:"py-1 text-right text-indigo-600 dark:text-indigo-400 font-bold",children:w.unmixed!==null?w.unmixed.toFixed(1):"-"})]},v))})]}),h&&c.jsx("div",{className:"mb-2 text-[9px] text-gray-400 dark:text-slate-500 text-right italic",children:"* Mean adjusted by Black Level"}),c.jsxs("div",{className:"flex flex-wrap gap-2",children:[c.jsx("button",{onClick:()=>i("histogram"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-cyan-600 hover:bg-cyan-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"Hist"}),c.jsx("button",{onClick:()=>i("quant"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-teal-600 hover:bg-teal-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"Quant"}),c.jsx("button",{onClick:()=>i("fft"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-purple-600 hover:bg-purple-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"FFT"}),c.jsx("button",{onClick:()=>i("pearson"),className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"PCC"}),!p&&c.jsx("button",{onClick:m,className:"relative z-20 flex-1 min-w-[50px] py-1.5 bg-pink-600 hover:bg-pink-500 text-white text-[10px] font-bold uppercase tracking-wide rounded shadow-sm hover:shadow transition-all active:scale-95 flex items-center justify-center gap-1",children:"ColorN"})]})]})]})},xle=()=>{var cw;const[e,t]=j.useState("init"),[r,n]=j.useState("Checking storage..."),[a,i]=j.useState(null),o=j.useRef(!1),[s,l]=j.useState("dark"),[u,d]=j.useState(!1);j.useEffect(()=>((async()=>{const U=await Ha.init();d(U),console.log("WebGPU Available:",U)})(),()=>{Ha.disposeAll()}),[]),j.useEffect(()=>{const T=window.document.documentElement;T.classList.remove(s==="dark"?"light":"dark"),T.classList.add(s)},[s]);const[f,h]=j.useState(!1),[p,x]=j.useState(!1),[b,y]=j.useState(!1),[m,g]=j.useState(!1),[k,S]=j.useState(!1),[w,v]=j.useState(!1),M=Wse(f||p||b),[_,P]=j.useState(!1),[A,R]=j.useState([]),[D,E]=j.useState(-1),[W,F]=j.useState([]),O=j.useMemo(()=>A[D],[A,D]),$=j.useRef(null);j.useEffect(()=>{$.current=O||null},[O]);const N=j.useRef({}),C=(O==null?void 0:O.file)||null,B=(O==null?void 0:O.imageElement)||null,I=(O==null?void 0:O.rawImageData)||null,z=(O==null?void 0:O.rawFileBuffer)||null,V=(O==null?void 0:O.renderedRawImageData)||null,K=(O==null?void 0:O.referenceImageData)||null,q=(O==null?void 0:O.sampledImageData)||null,G=(O==null?void 0:O.exifData)||null,pe=(O==null?void 0:O.isThreePlane)||!1,J=(O==null?void 0:O.psDocument)||null,Z=(O==null?void 0:O.xtransPhase)||{x:0,y:0},ae=(O==null?void 0:O.displaySettings)||{exposure:0,demosaicMethod:3,blackLevel:void 0,wbGains:[1,1],showKadc:!0,subtractBlackLevelFromStats:!0},ce=j.useMemo(()=>J?{...J,guides:[],selectedGuideId:null}:null,[J==null?void 0:J.id,J==null?void 0:J.width,J==null?void 0:J.height,J==null?void 0:J.baseRgb,J==null?void 0:J.masks,J==null?void 0:J.layers,J==null?void 0:J.selectedMaskId,J==null?void 0:J.selectedLayerId,J==null?void 0:J.transform,J==null?void 0:J.historyIndex]),[ne,le]=j.useState(!1),[se,he]=j.useState(null),[ue,ie]=j.useState(!1),[xe,Se]=j.useState(!1),[Ie,te]=j.useState(null),[Oe,Fe]=j.useState([]),[bt,Ct]=j.useState(100),[ut,dt]=j.useState(!0),[ht,tt]=j.useState(!1),[vt,Sr]=j.useState(null),[Ft,rt]=j.useState(!1),[Kt,lr]=j.useState(!1),[Vt,gr]=j.useState(!1),[Zt,zt]=j.useState(!1),[rr,Ot]=j.useState(!1),[_e,ee]=j.useState("1.0"),[ve,de]=j.useState(!1),[De,Ye]=j.useState(!1),[st,_t]=j.useState(!1),[Xe,Ar]=j.useState(!1),[nr,Gt]=j.useState(!1),[mt,Jt]=j.useState(32),[Pr,Zr]=j.useState(.35),[jr,we]=j.useState(.6),[Je,Qe]=j.useState(24),[Qt,Ht]=j.useState("add"),[it,cr]=j.useState(null),[pr,It]=j.useState("off"),[Tt,Ae]=j.useState(null),[Yt,L]=j.useState(null),[ke,Pe]=j.useState(!1),[jt,Be]=j.useState(null),[nt,Ue]=j.useState(null),[er,Tr]=j.useState(0),Rr=j.useRef({}),Ut=j.useRef(null),rn=j.useRef(null),ln=j.useRef([]),On=j.useRef(null),ur=j.useRef(null);j.useEffect(()=>{On.current=jt},[jt]),j.useEffect(()=>{ur.current=nt},[nt]);const[Wt,ar]=j.useState([]),[We,$t]=j.useState(!1),[Nr,cn]=j.useState(0),[ea,vn]=j.useState([]),[ja,oe]=j.useState(!1),[me,je]=j.useState({x:0,y:0}),[Q,$e]=j.useState(!1),[Ke,ot]=j.useState(!1),[wt,Rt]=j.useState([]),[yt,ir]=j.useState(0),[dr,Cr]=j.useState(null),[Fr,Ne]=j.useState(!1),[Lt,et]=j.useState([]),[Mr,vr]=j.useState(.5),[wn,mr]=j.useState(!1),[Jr,Gn]=j.useState(2),[Fi,Gi]=j.useState(1),[Wu,Ys]=j.useState([]),[Vu,Jl]=j.useState(null),[nn,La]=j.useState(0),[lo,Ba]=j.useState([]),[co,Ui]=j.useState([]),[uo,qs]=j.useState(64),[zi,zo]=j.useState(10),[ze,tr]=j.useState(10),[kt,qt]=j.useState(4),[un,da]=j.useState(1),[gn,bi]=j.useState(0),[Xn,Ma]=j.useState("processed"),[Gr,ta]=j.useState(!1),fo=j.useMemo(()=>ae.blackLevel?ae.blackLevel:I!=null&&I.blackLevels?[I.blackLevels[0],I.blackLevels[1],I.blackLevels[2],I.blackLevels[3]]:[0,0,0,0],[ae.blackLevel,I]),Wo=(G==null?void 0:G.ImageHeight)||(G==null?void 0:G.ExifImageHeight)||(I==null?void 0:I.height)||0,[Zs,pt]=j.useState(null),[Ql,xt]=j.useState(null),[Vo,Ho]=j.useState({x:0,y:0}),[Js,Hu]=j.useState(1),[_a,a0]=j.useState("pan"),Qs=j.useRef(null),ho=j.useRef(null);j.useEffect(()=>{if(u&&O&&O.rawImageData&&O.id){if(!!O.rawImageData.floatData&&/\.jdng$/i.test(O.fileName||""))return;const{data:U,width:X,height:Y}=O.rawImageData;Ha.uploadImage(O.id,U,X,Y)}},[u,O==null?void 0:O.id]),j.useEffect(()=>{const T=Zse();T&&T.sessions.length>0?(i(T),t("prompt")):t("idle")},[]),j.useCallback(async()=>{o.current=!0,n("Cleaning up..."),localStorage.removeItem("jtr_workspace_index");try{await Yse()}catch(T){console.error("Failed to clear DB",T)}t("idle"),i(null),o.current=!1},[]),j.useCallback(async()=>{if(!a)return;t("restoring"),n("Restoring layout...");const T=a;if(l(T.theme),dt(T.sidebarOpen),T.sessions.length>0){n(`Restoring ${T.sessions.length} images...`);const U=[];for(const X of T.sessions){if(o.current)return;await new Promise(Y=>setTimeout(Y,50));try{const Y=await Kse(X.id);if(Y){const fe={id:X.id,fileName:X.fileName,file:null,imageElement:null,rawImageData:null,rawFileBuffer:Y,renderedRawImageData:null,referenceImageData:null,sampledImageData:null,exifData:null,isThreePlane:X.isThreePlane,displaySettings:X.displaySettings,originalRawFileBuffer:null,isXTransOriginal:!1,isXTransConverted:!1,xtransPhase:{x:0,y:0},psDocument:null},{previewBlob:Me,analysisData:Ee}=await lc(Y);let ge=null;if(Ee)try{X.displaySettings.renderMode==="zero-dependency"?ge=await fx(Y,X.displaySettings):X.displaySettings.renderMode==="advanced-zero-dep"?ge=await AE(Y,X.displaySettings):X.displaySettings.renderMode==="zero-dep-color"?ge=await OE(Y,X.displaySettings):ge=await CE(Y,X.displaySettings)}catch(Ge){console.error("Render failed",Ge),ge=await fx(Y,X.displaySettings)}const Ve=URL.createObjectURL(Me),Le=new Image;Le.src=Ve,await new Promise(Ge=>{Le.onload=()=>Ge()}),U.push({...fe,rawImageData:Ee,renderedRawImageData:ge,previewUrl:Ve,imageElement:Le,exifData:Ee.metadata})}}catch(Y){console.error(`Failed to restore session ${X.id}`,Y)}}if(o.current)return;if(R(U),T.activeSessionId){const X=U.findIndex(Y=>Y.id===T.activeSessionId);X>=0?E(X):U.length>0&&E(0)}Fe(T.windows)}o.current||t("idle")},[a]);const i0=j.useCallback(async()=>{gr(!1);const T=O;if(u&&T&&T.id&&Ha.hasImage(T.id)&&(T.displaySettings.renderMode||"standard")!=="standard"){xt("Exporting via WebGPU...");try{const Y=await Ha.export16Bit(T.id,T.displaySettings,Zt,rr);if(Y){const fe=nj(T.rawImageData.width,T.rawImageData.height,Y,3),Me=new Blob([fe],{type:"image/tiff"}),Ee=URL.createObjectURL(Me),ge=document.createElement("a");ge.href=Ee,ge.download=`export_webgpu_${Date.now()}.tiff`,document.body.appendChild(ge),ge.click(),document.body.removeChild(ge),URL.revokeObjectURL(Ee),xt(null);return}}catch(Y){console.error("WebGPU Export Failed, falling back to CPU",Y)}}!z||!O||(xt("Exporting 16-bit TIFF (CPU)..."),setTimeout(async()=>{try{const U=await eP(z,ae,Zt,rr),X=nj(U.width,U.height,U.data,U.channels),Y=new Blob([X],{type:"image/tiff"}),fe=URL.createObjectURL(Y),Me=document.createElement("a");Me.href=fe,Me.download=`export_${Date.now()}.tiff`,document.body.appendChild(Me),Me.click(),document.body.removeChild(Me),URL.revokeObjectURL(fe)}catch(U){pt("Export failed: "+U.message)}finally{xt(null)}},100))},[z,O,ae,Zt,rr,u]),o0=j.useCallback(()=>{!z||!O||gr(!0)},[z,O]),pm=j.useCallback(async()=>{},[I,O,_e,fo]);j.useEffect(()=>{const T=U=>{(U.ctrlKey||U.metaKey)&&U.key.toLowerCase()==="s"&&(U.preventDefault(),o0())};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[o0]);const Xu=j.useRef(null),s0=j.useCallback(()=>{e==="idle"&&(Xu.current&&clearTimeout(Xu.current),Xu.current=window.setTimeout(async()=>{var X;const T={version:1,timestamp:Date.now(),activeSessionId:((X=A[D])==null?void 0:X.id)||null,theme:s,sidebarOpen:ut,sessions:A.map(Y=>({id:Y.id,fileName:Y.fileName,fileType:Y.file?Y.file.type:"application/octet-stream",fileSize:Y.rawFileBuffer?Y.rawFileBuffer.byteLength:0,displaySettings:Y.displaySettings,isThreePlane:Y.isThreePlane})),windows:Oe.map(Y=>({id:Y.id,type:Y.type,roi:Y.roi,zIndex:Y.zIndex,initialPosition:Y.initialPosition,sessionId:Y.sessionId,isBGGR:Y.isBGGR,isMinimized:Y.isMinimized||!1,internalState:Y.internalState}))};qse(T);const U=A.map(Y=>Y.id);Jse(U)},1e3))},[A,Oe,D,s,ut,e]);j.useEffect(()=>{s0()},[s0]);const ei=j.useCallback(T=>{R(U=>U.map((X,Y)=>Y===D?{...X,...T}:X))},[D]),Fa=j.useCallback((T,U)=>{R(X=>X.map(Y=>Y.id===T?{...Y,...U}:Y))},[]),Ga=j.useCallback((T,U)=>({...T,history:U.entries.map(X=>({id:X.id,label:X.label,timestamp:X.timestamp})),historyIndex:U.index}),[]),ec=j.useCallback((T,U,X="Initialize PS Document",Y=[])=>{const fe=nh(U),Ee={entries:[{id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:X,timestamp:Date.now(),doc:fe,transformOps:ss(Y)}],index:0};return N.current[T]=Ee,Ga(U,Ee)},[Ga]);j.useEffect(()=>{const T=new Set(A.map(U=>U.id));Object.keys(N.current).forEach(U=>{T.has(U)||delete N.current[U]}),Object.keys(Rr.current).forEach(U=>{T.has(U)||delete Rr.current[U]})},[A]);const Ku=()=>E(T=>Math.min(T+1,A.length-1)),Yu=()=>E(T=>Math.max(0,T-1)),l0=j.useCallback(T=>{if(!I)return null;const U=Math.max(0,Math.floor(T.x)),X=Math.max(0,Math.floor(T.y)),Y=Math.min(I.width,Math.ceil(T.x+T.w)),fe=Math.min(I.height,Math.ceil(T.y+T.h));if(Y<=U||fe<=X)return null;let Me=0,Ee=0,ge=null;if(V)Me=V.width,Ee=V.height,ge=V.data;else if(B&&B.naturalWidth>0&&B.naturalHeight>0){const Mt=document.createElement("canvas");Mt.width=B.naturalWidth,Mt.height=B.naturalHeight;const Wr=Mt.getContext("2d");if(!Wr)return null;Wr.drawImage(B,0,0);const Sn=Wr.getImageData(0,0,Mt.width,Mt.height);Me=Sn.width,Ee=Sn.height,ge=Sn.data}else return null;const Ve=Math.max(0,Math.min(Me-1,Math.floor(U*Me/I.width))),Le=Math.max(0,Math.min(Ee-1,Math.floor(X*Ee/I.height))),Ge=Math.max(Ve+1,Math.min(Me,Math.ceil(Y*Me/I.width))),ft=Math.max(Le+1,Math.min(Ee,Math.ceil(fe*Ee/I.height)));let Ce=0,gt=0,or=0,Ur=0,xr=0,At=0,Pt=0;for(let Mt=Le;Mt<ft;Mt++){const Wr=Mt*Me;for(let Sn=Ve;Sn<Ge;Sn++){const Pa=(Wr+Sn)*4,Na=ge[Pa],qo=ge[Pa+1],vi=ge[Pa+2];Ce+=Na,gt+=qo,or+=vi,Ur+=Na*Na,xr+=qo*qo,At+=vi*vi,Pt++}}if(Pt<=0)return null;const zr=Ce/Pt,kn=gt/Pt,dn=or/Pt,Qr=Math.sqrt(Math.max(0,Ur/Pt-zr*zr)),ri=Math.sqrt(Math.max(0,xr/Pt-kn*kn)),ha=Math.sqrt(Math.max(0,At/Pt-dn*dn));return{x:U,y:X,width:Y-U,height:fe-X,means:[zr,kn,dn,0],stdDevs:[Qr,ri,ha,0],pixelCount:Pt}},[I,V,B]),qu=j.useCallback(T=>I?I.isThreePlane&&l0(T)||tl(I.data,I.width,I.height,T.x,T.y,T.w,T.h):null,[I,l0]);j.useEffect(()=>{if(!I||!se)return;const T=qu({x:se.x,y:se.y,w:se.width,h:se.height});T&&he(T)},[I,V,B,qu]);const el=j.useCallback(async T=>{var Me;const U=T.displaySettings.renderMode||"standard",X=!!((Me=T.rawImageData)!=null&&Me.floatData)&&/\.jdng$/i.test(T.fileName||"");if(u&&Ha.hasImage(T.id)&&U!=="standard"&&!T.isThreePlane&&!X&&T.rawImageData){const Ee=await Ha.export16Bit(T.id,T.displaySettings,!0,!1);if(Ee)return{width:T.rawImageData.width,height:T.rawImageData.height,data:N8(Ee)}}if(X&&T.rawImageData){const Ee=Xx(T.rawImageData,T.displaySettings);return{width:Ee.width,height:Ee.height,data:Ee.floatRgb}}return oj.test(T.fileName)&&T.rawFileBuffer?await TE(T.rawFileBuffer,T.displaySettings):T.renderedRawImageData?{width:T.renderedRawImageData.width,height:T.renderedRawImageData.height,data:N_(T.renderedRawImageData)}:T.imageElement?await C8(T.imageElement):null},[u]),tc=j.useCallback(async T=>{if(T.psDocument)return;const U=await el(T);if(!U)throw new Error("Failed to build PS source buffer.");const X=jk(T.id,U.width,U.height,U.data),Y=ec(T.id,X,"Initialize PS Document");Fa(T.id,{psDocument:Y})},[el,Fa,ec]),gm=j.useCallback(async()=>{if(Xe){pt("PS Mode is locked and cannot be closed in this build.");return}const T=!Xe;if(T&&O){xt("Preparing PS Mode Float32 source...");try{await tc(O)}catch(U){pt(`PS Mode init failed: ${U.message||U}`),xt(null);return}xt(null)}Ar(T),T?(ve&&de(!1),De&&Ye(!1),Ke&&ot(!1),st&&_t(!1),ir(0),et([]),ar([]),$t(!1),cn(0)):(Gt(!1),cr(null),It("off"),Ae(null),Ue(null),Be(null))},[Xe,O,tc,ve,De,Ke,st]);j.useEffect(()=>{if(!Xe||!O||O.psDocument)return;let T=!1;return(async()=>{try{await tc(O)}catch(U){T||console.error("PS document auto-init failed:",U)}})(),()=>{T=!0}},[Xe,O,tc]),j.useEffect(()=>{if(!Xe||!ce){Be(null);return}if(ke)return;let T=!1;return(async()=>{var Me;let U=null;const X=ur.current,Y=On.current,fe=((Me=$.current)==null?void 0:Me.id)||ce.id;if(u)if(U=await th.renderPreview(ce),U)Rr.current[fe]=!0;else{const Ee=th.wasBusyLastRender(),ge=!!Rr.current[fe];if(Ee||ge){T||(Ut.current&&clearTimeout(Ut.current),Ut.current=setTimeout(()=>{Ut.current=null,Tr(Ve=>Ve+1)},16));return}}U||(X&&Y?U=H8(ce,Y,X):U=Hy(ce)),T||(Be(U),X&&Ue(null))})(),()=>{T=!0,Ut.current&&(clearTimeout(Ut.current),Ut.current=null)}},[Xe,ce,u,ke,er]);const lt=j.useCallback((T,U)=>{var Ce;const X=$.current;if(!(X!=null&&X.psDocument))return;const Y={label:(U==null?void 0:U.label)||"PS Edit",trackHistory:(U==null?void 0:U.trackHistory)!==!1,transformOp:U==null?void 0:U.transformOp},fe=T(X.psDocument);if(fe===X.psDocument)return;if(!Y.trackHistory){const gt=N.current[X.id],or=gt?Ga(fe,gt):fe;Fa(X.id,{psDocument:or});return}let Me=N.current[X.id];Me||(Me={entries:[{id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:"Initialize PS Document",timestamp:Date.now(),doc:nh(X.psDocument),transformOps:[]}],index:0});const Ee=((Ce=Me.entries[Me.index])==null?void 0:Ce.transformOps)||[],ge=Y.transformOp?[...Ee,YO(Y.transformOp)]:Ee,Ve=Me.entries.slice(0,Me.index+1);Ve.push({id:`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:Y.label,timestamp:Date.now(),doc:nh(fe),transformOps:ss(ge)});let Le=Ve.length-1;if(Ve.length>lj){const gt=Ve.length-lj;Ve.splice(0,gt),Le=Math.max(0,Le-gt)}const Ge={entries:Ve,index:Le};N.current[X.id]=Ge;const ft=Ga(fe,Ge);Fa(X.id,{psDocument:ft})},[Fa,Ga]),mm=j.useCallback(()=>{const T=$.current;if(!(T!=null&&T.psDocument))return;const U=N.current[T.id];if(!U||U.index<=0)return;const X=U.index-1,Y={...U,index:X};N.current[T.id]=Y;const fe=Zx(Y.entries[X].doc),Me=Ga(fe,Y);Fa(T.id,{psDocument:Me}),Ue(null),Be(null)},[Fa,Ga]),xm=j.useCallback(T=>{const U=$.current;if(!(U!=null&&U.psDocument))return;const X=N.current[U.id];if(!X||T<0||T>=X.entries.length)return;const Y={...X,index:T};N.current[U.id]=Y;const fe=Zx(Y.entries[T].doc),Me=Ga(fe,Y);Fa(U.id,{psDocument:Me}),Ue(null),Be(null)},[Fa,Ga]),Xo=j.useCallback((T,U)=>{const X=URL.createObjectURL(T),Y=document.createElement("a");Y.href=X,Y.download=U,document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(X)},[]),rc=j.useCallback((T,U,X)=>new Promise((Y,fe)=>{const Me=document.createElement("canvas");Me.width=T.width,Me.height=T.height;const Ee=Me.getContext("2d");if(!Ee){fe(new Error("Failed to get 2D canvas context."));return}Ee.putImageData(T,0,0),Me.toBlob(ge=>{if(!ge){fe(new Error("Failed to encode image blob."));return}Y(ge)},U,X)}),[]),nc=j.useCallback(async()=>{const T=$.current;if(!T)return null;const U=fj(T.fileName);if(Xe&&T.psDocument){if(On.current)return{imageData:On.current,baseName:U};let X=null;if(u)if(X=await th.renderPreview(T.psDocument),X)Rr.current[T.id]=!0;else{const Y=th.wasBusyLastRender(),fe=!!Rr.current[T.id];if(Y||fe)return null}return X||(X=Hy(T.psDocument)),{imageData:X,baseName:U}}if(Xn==="reference"&&T.referenceImageData)return{imageData:T.referenceImageData,baseName:U};if(Xn==="sampled"&&T.sampledImageData)return{imageData:T.sampledImageData,baseName:U};if(T.renderedRawImageData)return{imageData:T.renderedRawImageData,baseName:U};if(T.imageElement){const X=T.imageElement.naturalWidth||T.imageElement.width,Y=T.imageElement.naturalHeight||T.imageElement.height,fe=document.createElement("canvas");fe.width=X,fe.height=Y;const Me=fe.getContext("2d");return Me?(Me.drawImage(T.imageElement,0,0,X,Y),{imageData:Me.getImageData(0,0,X,Y),baseName:U}):null}return null},[Xe,u,Xn]),ym=j.useCallback(async()=>{try{const T=await nc();if(!T){pt("No image available for PNG export.");return}const U=await rc(T.imageData,"image/png");Xo(U,`${T.baseName}_ps_export_${Date.now()}.png`)}catch(T){pt(`PNG export failed: ${(T==null?void 0:T.message)||T}`)}},[nc,rc,Xo]),bm=j.useCallback(async()=>{try{const T=await nc();if(!T){pt("No image available for JPEG export.");return}const U=await rc(T.imageData,"image/jpeg",.92);Xo(U,`${T.baseName}_ps_export_${Date.now()}.jpg`)}catch(T){pt(`JPEG export failed: ${(T==null?void 0:T.message)||T}`)}},[nc,rc,Xo]),vm=j.useCallback(async()=>{var U,X,Y,fe,Me,Ee;const T=$.current;if(!(T!=null&&T.psDocument)){pt("No PS workflow to export.");return}xt("Exporting PS workflow...");try{const ge=T.psDocument,Ve=((U=T.rawImageData)==null?void 0:U.width)||((X=T.imageElement)==null?void 0:X.naturalWidth)||((Y=T.imageElement)==null?void 0:Y.width)||ge.width,Le=((fe=T.rawImageData)==null?void 0:fe.height)||((Me=T.imageElement)==null?void 0:Me.naturalHeight)||((Ee=T.imageElement)==null?void 0:Ee.height)||ge.height,Ge={signature:bd,version:3,exportedAt:new Date().toISOString(),sourceFileName:T.fileName,sourceWidth:Ve,sourceHeight:Le,width:ge.width,height:ge.height,displaySettings:{...T.displaySettings},psUi:{brushEnabled:nr,brushSize:mt,brushOpacity:Pr,brushFeather:jr,ellipseFeather:Je,brushMode:Qt},flow:(()=>{var xr,At;const or=N.current[T.id],Ur=((At=(xr=or==null?void 0:or.entries)==null?void 0:xr[or.index])==null?void 0:At.transformOps)||[];return cj(ge,Ur)})(),history:(()=>{const or=N.current[T.id];if(!or||or.entries.length===0)return;const Ur=Math.max(0,Math.min(or.entries.length-1,or.index)),xr=Math.max(0,Ur-lle+1),At=or.entries.slice(xr,Ur+1);return{index:At.length-1,entries:At.map(Pt=>({id:Pt.id,label:Pt.label,timestamp:Pt.timestamp,flow:cj(Pt.doc,Pt.transformOps||[])}))}})()},Ce=JSON.stringify({format:sj,version:1,payload:Ge}),gt=new Blob([Ce],{type:"application/json;charset=utf-8"});Xo(gt,`${fj(T.fileName)}_ps_workflow.json`)}catch(ge){pt(`Export workflow failed: ${(ge==null?void 0:ge.message)||ge}`)}finally{xt(null)}},[Xo,nr,mt,Pr,jr,Je,Qt]),wm=j.useCallback(async T=>{var X,Y,fe,Me,Ee,ge,Ve;if(!$.current){pt("Load an image first, then import workflow file.");return}xt("Importing PS workflow...");try{const Le=$.current;if(!Le)throw new Error("Session disappeared during import.");const Ge=await T.text(),ft=Ge.trim();if(!ft)throw new Error("Workflow file is empty.");let Ce=null;if(ft.startsWith("{")){let Mt;try{Mt=JSON.parse(ft)}catch{throw new Error("Invalid workflow JSON.")}const Wr=Mt;if((Wr==null?void 0:Wr.format)===sj&&(Wr!=null&&Wr.payload))Ce=Wr.payload;else if(Mt!=null&&Mt.payload&&((X=Mt==null?void 0:Mt.payload)==null?void 0:X.signature)===bd)Ce=Mt.payload;else if((Mt==null?void 0:Mt.signature)===bd)Ce=Mt;else throw new Error("Invalid workflow JSON signature.")}else{const Mt={};if(Ge.split(/\r?\n/).map(Wr=>Wr.trim()).filter(Boolean).forEach(Wr=>{const Sn=hle(Wr);if(Sn.length<2)return;const Pa=dj(Sn[0]).trim().toLowerCase(),Na=dj(Sn.slice(1).join(","));Mt[Pa]=Na}),Mt.signature!==bd)throw new Error("Invalid workflow CSV signature.");Ce=Mt.payload_json?JSON.parse(Mt.payload_json):Mt.payload_b64?JSON.parse(fle(Mt.payload_b64)):null}if(!Ce)throw new Error("Missing workflow payload.");if(Ce.signature!==bd)throw new Error("Workflow payload signature mismatch.");const gt=Number(Ce.sourceWidth||Ce.width),or=Number(Ce.sourceHeight||Ce.height),Ur=((Y=Le.rawImageData)==null?void 0:Y.width)||((fe=Le.imageElement)==null?void 0:fe.naturalWidth)||((Me=Le.imageElement)==null?void 0:Me.width)||gt,xr=((Ee=Le.rawImageData)==null?void 0:Ee.height)||((ge=Le.imageElement)==null?void 0:ge.naturalHeight)||((Ve=Le.imageElement)==null?void 0:Ve.height)||or;if(gt!==Ur||or!==xr)throw new Error(`Source size mismatch: workflow expects ${gt}x${or}, current file is ${Ur}x${xr}.`);const At=Number(Ce.width),Pt=Number(Ce.height);if(!Number.isFinite(At)||!Number.isFinite(Pt)||At<=0||Pt<=0)throw new Error("Invalid workflow canvas size.");const zr=await el(Le);if(!zr)throw new Error("Failed to rebuild source image for workflow import.");const kn=jk(Le.id,zr.width,zr.height,zr.data),dn={width:Number(Ce.flow.width||Ce.width),height:Number(Ce.flow.height||Ce.height),transformOps:ss(Ce.flow.transformOps||[]),masks:(Ce.flow.masks||[]).map(Mt=>({...Mt,items:(Mt.items||[]).map(ju)})),layers:(Ce.flow.layers||[]).map(tg),guides:(Ce.flow.guides||[]).map(_l),selectedMaskId:Ce.flow.selectedMaskId||"",selectedLayerId:Ce.flow.selectedLayerId||"",selectedMaskItemId:Ce.flow.selectedMaskItemId??null,selectedGuideId:Ce.flow.selectedGuideId??null,transform:Ce.flow.transform?{rotationDeg:Number(Ce.flow.transform.rotationDeg)||0,crop:Ce.flow.transform.crop?{...Ce.flow.transform.crop}:null}:{rotationDeg:0,crop:null}},Qr=uj(kn,dn);let ri;const ha=Ce.history;if(ha&&Array.isArray(ha.entries)&&ha.entries.length>0){const Mt=Number(ha.index),Wr=Number.isFinite(Mt)?Math.max(0,Math.min(ha.entries.length-1,Mt)):ha.entries.length-1,Sn=Math.max(0,Wr-cle+1),Pa=ha.entries.slice(Sn,Wr+1),Na=[];for(const ic of Pa){const na=ic.flow||dn,uw={width:Number(na.width||dn.width),height:Number(na.height||dn.height),transformOps:ss(na.transformOps||[]),masks:(na.masks||[]).map(dw=>({...dw,items:(dw.items||[]).map(ju)})),layers:(na.layers||[]).map(tg),guides:(na.guides||[]).map(_l),selectedMaskId:na.selectedMaskId||"",selectedLayerId:na.selectedLayerId||"",selectedMaskItemId:na.selectedMaskItemId??null,selectedGuideId:na.selectedGuideId??null,transform:na.transform?{rotationDeg:Number(na.transform.rotationDeg)||0,crop:na.transform.crop?{...na.transform.crop}:null}:{rotationDeg:0,crop:null}},WA=uj(kn,uw);Na.push({id:ic.id||`history_${Date.now()}_${Math.random().toString(36).slice(2,7)}`,label:ic.label||"PS Edit",timestamp:Number(ic.timestamp)||Date.now(),doc:nh(WA),transformOps:ss(uw.transformOps||[])})}const qo=Na.length-1,vi={entries:Na,index:qo};N.current[Le.id]=vi;const ac=Zx(Na[qo].doc);ri=Ga(ac,vi)}else{const Mt=ss(dn.transformOps||[]);ri=ec(Le.id,Qr,"Import Workflow",Mt)}Fa(Le.id,{psDocument:ri,displaySettings:Ce.displaySettings?{...Ce.displaySettings}:Le.displaySettings}),Ce.psUi&&(Gt(!!Ce.psUi.brushEnabled),Jt(Math.max(1,Number(Ce.psUi.brushSize)||32)),Zr(Math.max(0,Math.min(1,Number(Ce.psUi.brushOpacity)||.35))),we(Math.max(0,Math.min(1,Number(Ce.psUi.brushFeather)||0))),Qe(Math.max(0,Number(Ce.psUi.ellipseFeather)||0)),Ht(Ce.psUi.brushMode==="subtract"?"subtract":"add")),cr(null),It("off"),Ae(null),Ue(null),Be(null)}catch(Le){pt(`Import workflow failed: ${(Le==null?void 0:Le.message)||Le}`)}finally{xt(null)}},[el,ec,Fa,Ga]),Ko=j.useCallback(T=>{lt(U=>{const X=U.layers.find(Y=>Y.id===T);return{...U,selectedLayerId:T,selectedMaskId:X?X.maskId:U.selectedMaskId}},{trackHistory:!1}),Ue(null)},[lt]),km=j.useCallback(T=>{lt(U=>C_(U,T),{trackHistory:!1}),Ue(null)},[lt]),Sm=j.useCallback(T=>{lt(U=>D8(U,T),{trackHistory:!1})},[lt]),c0=j.useCallback((T,U)=>{lt(X=>$8(X,T,U),{label:"Edit Ellipse"}),Ue(null)},[lt]),jm=j.useCallback((T,U)=>{lt(X=>L8(X,T,U),{label:"Toggle Mask Overlay"})},[lt]),Mm=j.useCallback(()=>{lt(T=>Av(T),{label:"Add Mask"}),Ue(null)},[lt]),u0=j.useCallback(()=>{It("center"),Ae(null)},[]),d0=j.useCallback(()=>{It("off"),Ae(null)},[]),f0=j.useCallback(T=>{pr==="center"&&(Ae({center:T,radiusX:1,radiusY:1,rotationDeg:0}),It("drag"))},[pr]),H=j.useCallback((T,U)=>{if(pr!=="drag"||!Tt)return;const X=T.x-Tt.center.x,Y=T.y-Tt.center.y,fe={...Tt,radiusX:Math.max(1,Math.abs(X)),radiusY:Math.max(1,Math.abs(Y))};Ae(fe),U==="end"&&(lt(Me=>E8(Me,fe,Je,Qt),{label:"Add Ellipse Item"}),It("off"),Ae(null),Ue(null))},[pr,Tt,lt,Je,Qt]),be=j.useCallback(()=>{if(!se){pt("Create an ROI first, then crop.");return}const T={x:se.x,y:se.y,w:se.width,h:se.height};lt(U=>T_(U,T),{label:"Crop To ROI",transformOp:{type:"crop",rect:T}}),Ue(null),Be(null),he(null),te(null)},[lt,se]),at=j.useCallback(T=>{lt(U=>E_(U,T),{label:`Rotate ${T.toFixed(1)}deg`,transformOp:{type:"rotate",angleDeg:T}}),Ue(null),Be(null),he(null),te(null)},[lt]),Xt=j.useCallback(()=>{lt(T=>I_(T),{label:"Flip Horizontal",transformOp:{type:"flipH"}}),Ue(null),Be(null),he(null),te(null)},[lt]),$r=j.useCallback(()=>{lt(T=>R_(T),{label:"Flip Vertical",transformOp:{type:"flipV"}}),Ue(null),Be(null),he(null),te(null)},[lt]),An=j.useCallback(()=>{var U,X;const T=(((X=(U=$.current)==null?void 0:U.psDocument)==null?void 0:X.guides)||[]).map(_l);lt(Y=>$_(Y),{label:"Apply Upright",transformOp:{type:"upright",guides:T}}),Ue(null),Be(null),he(null),te(null)},[lt]),wr=j.useCallback(T=>{const U=KO(T);lt(X=>D_(X,U),{label:U.lensLabel?`Lens Correction (${U.lensLabel})`:`Lens Correction (${U.model})`,transformOp:{type:"lensDistortion",params:U}}),Ue(null),Be(null),he(null),te(null)},[lt]),ra=j.useCallback(T=>{lt(U=>O8(U,T),{label:`Add ${T==="horizontal"?"H":"V"} Guide`})},[lt]),po=j.useCallback(T=>{lt(U=>A8(U,T),{trackHistory:!1})},[lt]),ti=j.useCallback((T,U,X)=>{lt(Y=>Mk(Y,T,U,X),{label:"Edit Guide"})},[lt]),Yo=j.useCallback(T=>{cr(T)},[]),go=j.useCallback(()=>{cr(null)},[]),fa=j.useCallback(T=>{const U=it;U&&(lt(X=>{if(!X.selectedGuideId)return X;const Y=X.guides.find(Me=>Me.id===X.selectedGuideId);if(!Y)return X;const fe={x:T.x,y:T.y};return Mk(X,Y.id,U==="p1"?fe:Y.p1,U==="p2"?fe:Y.p2)},{label:"Pick Guide Endpoint"}),cr(null))},[lt,it]),_m=j.useCallback(T=>{lt(U=>T8(U,T),{label:"Delete Guide"})},[lt]),ZO=j.useCallback((T,U)=>{lt(X=>({...X,layers:X.layers.map(Y=>Y.id===T?{...Y,maskId:U}:Y),selectedLayerId:T,selectedMaskId:U}),{label:"Bind Layer To Mask"}),Ue(null)},[lt]),JO=j.useCallback((T,U)=>{lt(X=>({...X,layers:X.layers.map(Y=>Y.id===T?{...Y,blendMode:U}:Y)}),{label:"Set Layer Blend"})},[lt]),QO=j.useCallback((T,U)=>{lt(X=>({...X,layers:X.layers.map(Y=>Y.id===T?{...Y,opacity:Math.max(0,Math.min(1,U))}:Y)}),{label:"Set Layer Opacity"})},[lt]),eA=j.useCallback((T,U)=>{const X=Yc(U);lt(Y=>({...Y,layers:Y.layers.map(fe=>fe.id===T?{...fe,basic:X}:fe)}),{label:"Set Layer Basic"}),Ue(null)},[lt]),tA=j.useCallback((T,U)=>{const X=Yc(U);lt(Y=>({...Y,layers:Y.layers.map(fe=>fe.id===T?{...fe,basic:X}:fe)}),{trackHistory:!1}),Ue(null)},[lt]),rA=j.useCallback((T,U)=>{const X=qc(U);lt(Y=>({...Y,layers:Y.layers.map(fe=>fe.id===T?{...fe,mixer:X}:fe)}),{label:"Set Layer Mixer"}),Ue(null)},[lt]),nA=j.useCallback((T,U)=>{const X=qc(U);lt(Y=>({...Y,layers:Y.layers.map(fe=>fe.id===T?{...fe,mixer:X}:fe)}),{trackHistory:!1}),Ue(null)},[lt]),aA=j.useCallback((T,U)=>{var Ee,ge;const X=Ve=>{const Le=(Ve||[]).map(Ge=>({x:Math.max(0,Math.min(1,Number((Ge==null?void 0:Ge.x)??0))),y:Math.max(0,Math.min(1,Number((Ge==null?void 0:Ge.y)??0)))})).filter(Ge=>!Number.isNaN(Ge.x)&&!Number.isNaN(Ge.y)).sort((Ge,ft)=>Ge.x-ft.x);return Le.length<2?[{x:0,y:0},{x:1,y:1}]:(Le[0].x=0,Le[Le.length-1].x=1,Le)};lt(Ve=>({...Ve,layers:Ve.layers.map(Le=>Le.id===T?{...Le,curves:{master:X(U.master),red:X(U.red),green:X(U.green),blue:X(U.blue)}}:Le)}),{label:`Edit ${T} Curves`});const Y=$.current,fe=(Ee=Y==null?void 0:Y.psDocument)==null?void 0:Ee.layers.find(Ve=>Ve.id===T),Me=fe?(ge=Y==null?void 0:Y.psDocument)==null?void 0:ge.masks.find(Ve=>Ve.id===fe.maskId):null;Ue(Me?P8(Me):null)},[lt]),Pm=j.useCallback(T=>{ln.current.push({x:T.x,y:T.y}),lt(X=>I8(X,T.x,T.y,mt,Pr,Qt,jr),{trackHistory:!1});const U={x0:Math.floor(T.x-mt-2),y0:Math.floor(T.y-mt-2),x1:Math.ceil(T.x+mt+2),y1:Math.ceil(T.y+mt+2)};Ue(X=>X?{x0:Math.min(X.x0,U.x0),y0:Math.min(X.y0,U.y0),x1:Math.max(X.x1,U.x1),y1:Math.max(X.y1,U.y1)}:U)},[lt,mt,Pr,Qt,jr]),iA=j.useCallback((T,U)=>{if(!nr)return;if(U==="start"&&(Pe(!0),ln.current=[]),U==="end"){Yt!==null&&(cancelAnimationFrame(Yt),L(null));const Y=rn.current;Y&&Pm(Y);const fe=ln.current;fe.length>0&&lt(Me=>R8(Me,fe,mt,Pr,Qt,jr),{label:"Brush Stroke"}),rn.current=null,ln.current=[],Pe(!1);return}if(rn.current=T,Yt!==null)return;const X=requestAnimationFrame(()=>{L(null);const Y=rn.current;Y&&Pm(Y)});L(X)},[nr,Yt,Pm,lt,mt,Pr,Qt,jr]);j.useEffect(()=>()=>{Yt!==null&&cancelAnimationFrame(Yt)},[Yt]);const oA=T=>{if(!se||!O)return;const U=Date.now().toString()+Math.random().toString().slice(2,5),X=Math.max(bt,...Oe.map(Me=>Me.zIndex),100),Y=Oe.length%10*30,fe=T==="fft"?{x:50,y:50}:T==="histogram"?{x:100,y:100}:{x:150,y:150};Fe(Me=>[...Me,{id:U,type:T,roi:{x:se.x,y:se.y,w:se.width,h:se.height},zIndex:X+1,initialPosition:{x:fe.x+Y,y:fe.y+Y},sessionId:O.id,isBGGR:ue,isMinimized:!1,stackFiles:(T==="fft"||T==="pearson"||T==="histogram")&&W.length>0?W:void 0}])},sA=T=>{Fe(U=>U.filter(X=>X.id!==T))},lA=T=>{Fe(U=>U.map(X=>X.id===T?{...X,isMinimized:!0}:X))},cA=T=>{Fe(U=>U.map(X=>X.id===T?{...X,isMinimized:!1}:X)),ew(T)},ew=T=>{Fe(U=>{const X=Math.max(bt,...U.map(Y=>Y.zIndex));return U.map(Y=>Y.id===T?{...Y,zIndex:X+1}:Y)})},uA=(T,U)=>{Fe(X=>X.map(Y=>Y.id===T?{...Y,internalState:{...Y.internalState,...U}}:Y))},Zu=()=>{const T=Math.max(bt,...Oe.map(U=>U.zIndex));Ct(T+1)},dA=(T,U)=>{Fe(X=>X.map(Y=>Y.id===T?{...Y,roi:U}:Y))};j.useEffect(()=>{if(!G)return;const T=G.CFAPattern2||G.CFAPattern;if(T){let U="";Array.isArray(T)?U=T.join(""):typeof T=="string"?U=T.replace(/[\s,]+/g,""):typeof T=="number"&&(U=String(T)),U==="0112"?ie(!1):U==="2110"&&ie(!0)}},[G]),j.useEffect(()=>{Xe||(Gt(!1),cr(null),It("off"),Ae(null),Pe(!1),Ue(null))},[Xe]),j.useEffect(()=>{(!Xe||!(J!=null&&J.selectedGuideId))&&cr(null)},[Xe,J==null?void 0:J.selectedGuideId]),j.useEffect(()=>{let T;const U=()=>{if(wn&&ja){const X=Date.now()/1e3,Y=.55+.45*Math.sin(X*Jr);Gi(Y),T=requestAnimationFrame(U)}else Gi(1)};return wn&&ja?U():Gi(1),()=>{T&&cancelAnimationFrame(T)}},[wn,ja,Jr]),j.useEffect(()=>{const T=U=>{U.key==="Escape"&&ja&&(oe(!1),je({x:0,y:0}),mr(!1))};return window.addEventListener("keydown",T),()=>window.removeEventListener("keydown",T)},[ja]),j.useEffect(()=>()=>{A.forEach(T=>{T.previewUrl&&URL.revokeObjectURL(T.previewUrl)}),ho.current&&ho.current.terminate()},[]);const Ju=async(T,U=!0)=>{var Le;U&&(Ho({x:0,y:0}),Hu(1),La(0),Ba([]),Ui([]),tt(!1),Sr(null),le(!1),ot(!1),Rt([]),et([]),ir(0),ar([]));let X=null;if(M.isConnected){const Ge=new FormData;Ge.append("file",T);try{const Ce=await(await fetch("http://localhost:5428/read",{method:"POST",body:Ge})).json();if(Ce.success){let gt=Ce.data;Array.isArray(gt)&&gt.length===1&&(gt=gt[0]),X=gt}}catch(ft){console.warn("Auto Exif fetch failed",ft)}}const Y=T.name.toLowerCase(),fe=oj.test(Y),Me=T.type==="image/x-adobe-dng"||/\.dng$/i.test(Y),Ee=/\.jdng$/i.test(Y);let ge={file:T,exifData:X,psDocument:null};if(Ee)try{U?xt("Processing JDNG file..."):ta(!0);const Ge=await T.arrayBuffer(),{previewBlob:ft,analysisData:Ce}=await ase(Ge);ge.rawImageData=Ce,!X&&Ce.metadata&&(ge.exifData=Ce.metadata),ge.rawFileBuffer=null;const or={exposure:0,demosaicMethod:-1,blackLevel:(((Le=Ce.blackLevels)==null?void 0:Le.length)||0)>=4?[Ce.blackLevels[0],Ce.blackLevels[1],Ce.blackLevels[2],Ce.blackLevels[3]]:void 0,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"standard"},Ur=Xx(Ce,or);ge.renderedRawImageData=Ur.imageData,ge.displaySettings=or,ge.isThreePlane=Ce.isThreePlane||!1,ge.isXTransOriginal=!1,ge.isXTransConverted=!1,ge.originalRawFileBuffer=null,ge.xtransPhase={x:0,y:0};const xr=URL.createObjectURL(ft);ge.previewUrl=xr;const At=new Image;At.src=xr,await new Promise(Pt=>{At.onload=()=>{ge.imageElement=At,Pt()},At.onerror=()=>{pt("Could not load the JDNG preview image."),Pt()}})}catch(Ge){pt(`Failed to process JDNG file: ${Ge.message}`),xt(null),ta(!1);return}else if(fe||Me)try{U?xt("Processing RAW file (this may take a moment)..."):ta(!0);const Ge=await T.arrayBuffer();ge.rawFileBuffer=Ge;const{previewBlob:ft,analysisData:Ce}=await lc(Ge);ge.rawImageData=Ce,!X&&Ce.metadata&&(ge.exifData=Ce.metadata),ge.isThreePlane=Ce.isThreePlane||!1,Ce.isThreePlane&&U&&le(!0);let gt=!1,or=null,Ur=!1;if(Ce.isXTrans){Ur=!0,or=Ge;const Pt=(await B0(Ge,0,0)).dngBuffer,zr=await lc(Pt);ge.rawFileBuffer=Pt,ge.rawImageData=zr.analysisData,ge.previewUrl=URL.createObjectURL(zr.previewBlob),gt=!0}else ge.previewUrl=URL.createObjectURL(ft);ge.originalRawFileBuffer=or,ge.isXTransOriginal=Ur,ge.isXTransConverted=gt,ge.xtransPhase={x:0,y:0};const xr=new Image;if(xr.src=ge.previewUrl||"",await new Promise((At,Pt)=>{xr.onload=()=>{ge.imageElement=xr,At()},xr.onerror=()=>{At()}}),U){const At=ge.rawImageData||Ce,Pt=gle(At,X||At.metadata);let zr;Pt&&Pt.some(Qr=>Qr>0)&&(zr=Pt);const kn={exposure:0,demosaicMethod:-1,blackLevel:zr,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dependency"},dn=ge.rawFileBuffer;if(dn&&(fe||T.type==="image/x-adobe-dng"))try{const Qr=await fx(dn,kn);ge.renderedRawImageData=Qr,ge.displaySettings=kn}catch(Qr){console.error("Initial Zero-Dep Render Failed",Qr)}}}catch(Ge){pt(`Failed to process RAW file: ${Ge.message}`),xt(null),ta(!1);return}else try{xt("Processing image...");const{previewBlob:Ge,analysisData:ft}=await Jy(T);ge.rawImageData=ft,!X&&ft.metadata&&(ge.exifData=ft.metadata),ge.rawFileBuffer=await T.arrayBuffer(),ge.isThreePlane=ft.isThreePlane||!1,ge.isXTransOriginal=!1,ge.isXTransConverted=!1,ge.originalRawFileBuffer=null;const Ce=URL.createObjectURL(Ge);ge.previewUrl=Ce;const gt=new Image;gt.src=Ce,await new Promise(or=>{gt.onload=()=>{ge.imageElement=gt,or()},gt.onerror=()=>{pt("Could not load the image file."),or()}})}catch(Ge){pt(`Failed to process image: ${Ge.message}`),xt(null);return}const Ve=Date.now().toString()+Math.random();if(ge.rawFileBuffer&&await Xse(Ve,ge.rawFileBuffer),U){const Ge={exposure:0,demosaicMethod:-1,blackLevel:void 0,wbGains:[1,1],showKadc:!1,subtractBlackLevelFromStats:!1,renderMode:"zero-dependency"},ft={id:Ve,fileName:T.name,file:T,imageElement:null,rawImageData:null,rawFileBuffer:null,renderedRawImageData:null,referenceImageData:null,sampledImageData:null,exifData:null,isThreePlane:!1,displaySettings:Ge,originalRawFileBuffer:null,isXTransOriginal:!1,isXTransConverted:!1,xtransPhase:{x:0,y:0},psDocument:null,...ge};R(Ce=>{const gt=[...Ce,ft];return E(gt.length-1),gt})}else ei(ge);xt(null),ta(!1)},tw=j.useCallback(async()=>{const T=rh,U=rh,X=new Uint16Array(T*U),Y=Math.max(2,kt),fe=gn*Y;for(let Ve=0;Ve<U;Ve++)for(let Le=0;Le<T;Le++){const Ge=.5+.5*Math.sin(2*Math.PI*(Le+fe)/Y);X[Ve*T+Le]=Math.round(1e3+Ge*9e3)}const Me=xh(T,U,X,[0,0,0,0],16383,"RGGB"),Ee=new Blob([Me],{type:"image/x-adobe-dng"}),ge=new File([Ee],"pattern_test.dng",{type:"image/x-adobe-dng"});await Ju(ge,(C==null?void 0:C.name)!=="pattern_test.dng")},[kt,gn,un,C]),fA=T=>{var X;if(Xe){pt("Load Image is disabled while PS Mode is active."),T.target.value="";return}const U=(X=T.target.files)==null?void 0:X[0];U&&Ju(U,!0)},hA=async(T,U)=>{if(Xe){pt("Load Image is disabled while PS Mode is active.");return}if(U==="convert"){xt("Converting RAW via Bridge...");try{const X=new FormData;X.append("file",T);const Y=await fetch("http://localhost:5428/convert",{method:"POST",body:X});if(!Y.ok)throw new Error("Conversion failed on server");const fe=await Y.blob(),Me=new File([fe],T.name.replace(/\.[^/.]+$/,"")+".dng",{type:"image/x-adobe-dng"});await Ju(Me,!0)}catch(X){pt("DNG Conversion Failed: "+X.message)}finally{xt(null)}}else Ju(T,!0)},pA=async(T,U,X,Y)=>{xt("Processing Pair Difference...");try{const fe=await T.arrayBuffer(),Me=await U.arrayBuffer(),Ee=await dx(fe,Me,X,Y),ge=xh(Ee.width,Ee.height,Ee.rawData,[32768,32768,32768,32768],65535,"RGGB"),Ve=new Blob([ge],{type:"image/x-adobe-dng"}),Le=new File([Ve],`Diff_${T.name}_${U.name}.dng`,{type:"image/x-adobe-dng"});await Ju(Le,!0)}catch(fe){pt("Pair Processing Failed: "+fe.message)}finally{xt(null)}},gA=async T=>{const U=Array.from(T).sort((X,Y)=>X.name.localeCompare(Y.name,void 0,{numeric:!0}));if(U.length<2){pt("Need at least 2 files for batch diff.");return}xt("Batch Difference Processing...");try{for(let X=0;X<U.length-1;X+=2){const Y=U[X],fe=U[X+1];xt(`Processing pair ${X/2+1}: ${Y.name} - ${fe.name}`);const Me=await Y.arrayBuffer(),Ee=await fe.arrayBuffer(),ge=await dx(Me,Ee,!1,!0),Ve=xh(ge.width,ge.height,ge.rawData,[32768,32768,32768,32768],65535,"RGGB"),Le=new Blob([Ve],{type:"image/x-adobe-dng"}),Ge=URL.createObjectURL(Le),ft=document.createElement("a");ft.href=Ge,ft.download=`Diff_${Y.name}_vs_${fe.name}.dng`,document.body.appendChild(ft),ft.click(),document.body.removeChild(ft),URL.revokeObjectURL(Ge),await new Promise(Ce=>setTimeout(Ce,200))}}catch(X){pt("Batch Diff Failed: "+X.message)}finally{xt(null)}},mA=T=>{F(Array.from(T)),xt(`Loaded ${T.length} files for Stack FFT. Open Stack Lab to process.`),setTimeout(()=>xt(null),2e3)},xA=()=>{rt(!0)},yA=()=>{rt(!1),Ma("sampled"),xt("Generating..."),setTimeout(()=>tw(),50)},h0=j.useRef({period:kt,fill:un,phase:gn});j.useEffect(()=>{(C==null?void 0:C.name)==="pattern_test.dng"&&(h0.current.period!==kt||h0.current.fill!==un||h0.current.phase!==gn)&&(h0.current={period:kt,fill:un,phase:gn},tw())},[kt,un,gn,C]);const bA=j.useCallback(async T=>{var Me,Ee;if(ei({displaySettings:T}),!$.current)return;const U=$.current,X=U.id;if(!!((Me=U.rawImageData)!=null&&Me.floatData)&&/\.jdng$/i.test(U.fileName||"")&&U.rawImageData){try{ta(!0);const ge=Xx(U.rawImageData,T);ei({renderedRawImageData:ge.imageData})}catch(ge){pt(`JDNG render failed: ${ge.message||ge}`)}finally{ta(!1)}return}if(T.renderMode==="zero-dependency"||T.renderMode==="zero-dep-color"||T.renderMode==="advanced-zero-dep")if(u)try{ta(!0);const ge=((Ee=$.current.rawImageData)==null?void 0:Ee.whiteLevel)||16383,Ve=await Ha.render(X,T,ge);if(Ve){ei({renderedRawImageData:Ve}),ta(!1);return}else throw new Error("WebGPU returned null frame.")}catch(ge){console.error("WebGPU Render failed:",ge),ta(!1);return}else{pt("WebGPU not ready/supported. These modes require WebGPU.");return}if(!z)return;ta(!0),ho.current&&ho.current.terminate();const fe=new Worker(new URL("/assets/renderWorker-CpYFhYTH.js",import.meta.url),{type:"module"});ho.current=fe,fe.onmessage=ge=>{const{success:Ve,imageData:Le,error:Ge}=ge.data;if(Ve){let ft=Le;(C==null?void 0:C.name)==="pattern_test.dng"&&(ft=ple(Le,rh,rh)),ei({renderedRawImageData:ft})}else pt(Ge||"Unknown worker error");ta(!1),fe.terminate(),ho.current=null},fe.postMessage({buffer:z.slice(0),settings:T})},[z,C,ei,u]),vA=async(T,U)=>{xt("Re-sampling X-Trans with new Phase...");try{const Y=(await B0(U,T.x,T.y)).dngBuffer,fe=await lc(Y),Me=URL.createObjectURL(fe.previewBlob),Ee=new Image;Ee.src=Me,await new Promise(ge=>{Ee.onload=()=>ge()}),O!=null&&O.previewUrl&&URL.revokeObjectURL(O.previewUrl),ei({rawFileBuffer:Y,rawImageData:fe.analysisData,previewUrl:Me,imageElement:Ee,xtransPhase:T}),he(null)}catch(X){console.error("X-Trans Phase Update Failed",X),pt("Phase Update Failed: "+X.message)}finally{xt(null)}},wA=T=>{if(!O||!O.originalRawFileBuffer||!O.isXTransConverted)return;const U={...O.xtransPhase,...T};vA(U,O.originalRawFileBuffer)},kA=j.useCallback(async T=>{if(O)if(T){if(O.isXTransConverted)return;const U=O.originalRawFileBuffer||O.rawFileBuffer;if(!U)return;xt("Converting X-Trans to Pseudo-Bayer DNG...");try{const X=O.xtransPhase||{x:0,y:0},fe=(await B0(U,X.x,X.y)).dngBuffer,Me=await lc(fe),Ee=URL.createObjectURL(Me.previewBlob),ge=new Image;ge.src=Ee,await new Promise(Ve=>{ge.onload=()=>Ve()}),O.previewUrl&&URL.revokeObjectURL(O.previewUrl),ei({rawFileBuffer:fe,rawImageData:Me.analysisData,previewUrl:Ee,imageElement:ge,isXTransConverted:!0,originalRawFileBuffer:U}),he(null)}catch(X){console.error("X-Trans Conversion Failed",X),pt("Failed to convert X-Trans: "+X.message)}finally{xt(null)}}else{if(!O.isXTransConverted)return;const U=O.originalRawFileBuffer;if(!U){pt("Original X-Trans buffer lost. Cannot revert.");return}xt("Reverting to Native X-Trans...");try{const X=await lc(U),Y=URL.createObjectURL(X.previewBlob),fe=new Image;fe.src=Y,await new Promise(Me=>{fe.onload=()=>Me()}),O.previewUrl&&URL.revokeObjectURL(O.previewUrl),ei({rawFileBuffer:U,rawImageData:X.analysisData,previewUrl:Y,imageElement:fe,isXTransConverted:!1}),he(null)}catch(X){console.error("X-Trans Revert Failed",X),pt("Failed to revert X-Trans: "+X.message)}finally{xt(null)}}},[O,ei]),rw=T=>{if(Qs.current){const U=Qs.current,{width:X,height:Y}=U.getBoundingClientRect(),fe=X/2,Me=Y/2,Ee=T/Js,ge=fe-(fe-Vo.x)*Ee,Ve=Me-(Me-Vo.y)*Ee;Ho({x:ge,y:Ve})}Hu(T)},nw=T=>{if(!T)return;if(!I){he(null);return}if(We){T.w>0&&T.h>0&&ar(X=>[...X,T]);return}xe&&Se(!1);const U=qu(T);he(U)},SA=T=>{te(T),nw(T)},jA=()=>{a0(T=>T==="pan"?"select":"pan")},MA=(T,U,X)=>{ar(Y=>{if(Y.length===0)return Y;if(T==="move")return Y.map(fe=>({...fe,x:fe.x+U,y:fe.y+X}));if(T==="scale"){const fe=Y.reduce((Ee,ge)=>Ee+ge.x+ge.w/2,0)/Y.length,Me=Y.reduce((Ee,ge)=>Ee+ge.y+ge.h/2,0)/Y.length;return Y.map(Ee=>{const ge=Ee.x+Ee.w/2,Ve=Ee.y+Ee.h/2,Le=fe+(ge-fe)*U,Ge=Me+(Ve-Me)*X,ft=Ee.w*U,Ce=Ee.h*X;return{...Ee,x:Le-ft/2,y:Ge-Ce/2,w:ft,h:Ce}})}return Y})},_A=()=>{if(Wt.length===0){pt("No ROIs to save.");return}let T=`Index,X,Y,W,H,Orientation
`;Wt.forEach((fe,Me)=>{T+=`${Me+1},${fe.x.toFixed(2)},${fe.y.toFixed(2)},${fe.w.toFixed(2)},${fe.h.toFixed(2)},${fe.ori||0}
`});const U=new Blob([T],{type:"text/csv;charset=utf-8;"}),X=URL.createObjectURL(U),Y=document.createElement("a");Y.setAttribute("href",X),Y.setAttribute("download",`sfr_plate_template_${Date.now()}.csv`),document.body.appendChild(Y),Y.click(),document.body.removeChild(Y),URL.revokeObjectURL(X)},PA=T=>{if(!T||T.length===0){pt("No valid ROIs found in file.");return}ar(U=>[...U,...T])},aw=T=>{if(Wt.length===0){pt("ROIs ");return}if(!I||ae.renderMode!=="advanced-zero-dep"){pt("Advanced Zero-Dep (Unmixed) mode required for scalar SFR calc.");return}xt("Computing Batch SFR..."),setTimeout(()=>{try{const U=[];for(const X of Wt){const Y=Gv(I,X,ae),fe=Ab(Y.data,Y.width,Y.height,{x:0,y:0,w:Y.width,h:Y.height},{greenOnly:T.greenOnly,globalX:X.x,globalY:X.y,bayerPattern:I.bayerPattern});if(fe){const Me=T.useNR?-1:12,Ee=LO([fe],Me,null,T.useDeshading);Ee&&Ee.mtf50!==null&&U.push({x:X.x+X.w/2,y:X.y+X.h/2,mtf50:Ee.mtf50,orientation:fe.orientation})}}if(U.length>0){const X=U.map(Y=>`{${Y.x.toFixed(1)},${Y.y.toFixed(1)},${Y.mtf50.toFixed(4)},${Y.orientation}}`).join("");navigator.clipboard.writeText(X).then(()=>alert(`Computed ${U.length}/${Wt.length} ROIs. Copied results to clipboard.`)).catch(Y=>pt("Failed to copy results: "+Y))}else pt("Failed to compute valid SFR for any selected ROIs.")}catch(U){pt("Batch Compute Failed: "+U.message)}finally{xt(null)}},100)},NA=T=>{if(nn===0||nn>4)return;const U=[...lo,T];Ba(U),nn===4?(CA(U),La(0)):La(nn+1)},iw=(T,U,X,Y)=>{const fe=T[0],Me=T[1],Ee=T[2],ge=T[3],Ve=U/2,Le=[];for(let Ge=0;Ge<X;Ge++){const ft=X>1?Ge/(X-1):.5;for(let Ce=0;Ce<Y;Ce++){const gt=Y>1?Ce/(Y-1):.5,or=fe.x*(1-gt)+Me.x*gt,Ur=fe.y*(1-gt)+Me.y*gt,xr=Ee.x*(1-gt)+ge.x*gt,At=Ee.y*(1-gt)+ge.y*gt,Pt=or*(1-ft)+xr*ft,zr=Ur*(1-ft)+At*ft,kn=Pt-Ve,dn=zr-Ve;Le.push({x:kn,y:dn,w:U,h:U})}}return Le},CA=T=>{!I||!O||(xt("Calculating DR Lab Grid..."),setTimeout(()=>{try{const U=iw(T,uo,zi,ze);Ui(U);const Me=[...[`#BlackLevel: ${(ae.blackLevel||[0,0,0,0]).join(",")}`,`#ImageHeight: ${I.height}`],"Filename,Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std"],Ee=`img${O.fileName||"image"}`;U.forEach((ft,Ce)=>{const gt=Math.floor(Ce/ze)+1,or=Ce%ze+1,Ur=tl(I.data,I.width,I.height,ft.x,ft.y,ft.w,ft.h),xr=Ur.means,At=Ur.stdDevs,Pt=`${Ee},${gt},${or},${xr[0].toFixed(4)},${xr[1].toFixed(4)},${xr[2].toFixed(4)},${xr[3].toFixed(4)},${At[0].toFixed(4)},${At[1].toFixed(4)},${At[2].toFixed(4)},${At[3].toFixed(4)}`;Me.push(Pt)});const ge=Me.join(`
`),Ve=new Blob([ge],{type:"text/csv;charset=utf-8;"}),Le=URL.createObjectURL(Ve),Ge=document.createElement("a");Ge.setAttribute("href",Le),Ge.setAttribute("download","dr_lab_results.csv"),document.body.appendChild(Ge),Ge.click(),document.body.removeChild(Ge),URL.revokeObjectURL(Le),Ba([])}catch(U){pt("DR Lab Error: "+U.message)}finally{xt(null)}},100))},OA=async(T,U)=>{if(lo.length<4&&co.length<1){pt("Please mark the grid on an image first before running batch processing.");return}let X=co;if(X.length===0&&lo.length===4&&(X=iw(lo,uo,zi,ze)),X.length===0){pt("No grid definitions found. Mark corners first.");return}xt(U==="pair"?"Batch Pair Difference (Sigma = Diff/sqrt(2))":"Batch Processing...");const fe=(ae.blackLevel||[0,0,0,0]).join(","),Me=I?I.height:0,ge=[...[`#BlackLevel: ${fe}`,`#ImageHeight: ${Me}`,U==="pair"?"#Mode: Pair Difference (Sigma = Diff/sqrt(2), Full Float Stats)":"#Mode: Independent"],"Filename,Row,Col,R_Mean,G1_Mean,G2_Mean,B_Mean,R_Std,G1_Std,G2_Std,B_Std"],Ve=Array.from(T).sort((Ce,gt)=>Ce.name.localeCompare(gt.name,void 0,{numeric:!0}));if(U==="pair"&&Ve.length<2){pt("Need at least 2 files for Pair processing."),xt(null);return}const Le=$.current,Ge=(Le==null?void 0:Le.isXTransConverted)||!1,ft=(Le==null?void 0:Le.xtransPhase)||{x:0,y:0};try{const Ce=async At=>{let Pt=await At.arrayBuffer();return Ge&&(Pt=(await B0(Pt,ft.x,ft.y)).dngBuffer),Pt};if(U==="single")for(let At=0;At<Ve.length;At++){const Pt=Ve[At];xt(`Processing ${At+1}/${Ve.length}: ${Pt.name}...`);const zr=await Ce(Pt),kn=await Ds(zr),dn=`img${Pt.name}`;X.forEach((Qr,ri)=>{const ha=Math.floor(ri/zi)+1,Mt=ri%ze+1,Wr=tl(kn.data,kn.width,kn.height,Qr.x,Qr.y,Qr.w,Qr.h),Sn=Wr.means,Pa=Wr.stdDevs,Na=`${dn},${ha},${Mt},${Sn[0].toFixed(4)},${Sn[1].toFixed(4)},${Sn[2].toFixed(4)},${Sn[3].toFixed(4)},${Pa[0].toFixed(4)},${Pa[1].toFixed(4)},${Pa[2].toFixed(4)},${Pa[3].toFixed(4)}`;ge.push(Na)})}else for(let At=0;At<Ve.length-1;At+=2){const Pt=Ve[At],zr=Ve[At+1],kn=`img${Pt.name} & ${zr.name}`;xt(`Processing Pair ${Math.floor(At/2)+1}/${Math.floor(Ve.length/2)}: ${Pt.name} & ${zr.name}...`);const dn=await Ce(Pt),Qr=await Ds(dn),ri=await Ce(zr),ha=await dx(dn,ri,!1,!1);X.forEach((Mt,Wr)=>{const Sn=Math.floor(Wr/zi)+1,Pa=Wr%ze+1,Na=tl(Qr.data,Qr.width,Qr.height,Mt.x,Mt.y,Mt.w,Mt.h),qo=tl(ha.rawData,ha.width,ha.height,Mt.x,Mt.y,Mt.w,Mt.h),vi=Na.means,ac=qo.stdDevs.map(na=>na/1.41421356),ic=`${kn},${Sn},${Pa},${vi[0].toFixed(4)},${vi[1].toFixed(4)},${vi[2].toFixed(4)},${vi[3].toFixed(4)},${ac[0].toFixed(4)},${ac[1].toFixed(4)},${ac[2].toFixed(4)},${ac[3].toFixed(4)}`;ge.push(ic)})}const gt=ge.join(`
`),or=new Blob([gt],{type:"text/csv;charset=utf-8;"}),Ur=URL.createObjectURL(or),xr=document.createElement("a");xr.href=Ur,xr.setAttribute("download",`dr_lab_batch_${U}_${new Date().getTime()}.csv`),document.body.appendChild(xr),xr.click(),document.body.removeChild(xr),URL.revokeObjectURL(Ur)}catch(Ce){console.error("Batch Error",Ce),pt("Batch Processing Failed: "+Ce.message)}finally{xt(null)}},AA=()=>{Rt([]),ir(1)},TA=T=>{if(!Ke||yt===0)return;const U=[...wt,T];Rt(U),U.length===4&&I?(ow(U,Mr),ir(0)):ir(X=>X+1)},ow=(T,U)=>{I&&(xt("Analyzing Color Chart..."),setTimeout(()=>{try{const X=Doe(T[0],T[1],T[2],T[3],I.width,I.height,U);et(X);const fe=X.map((Me,Ee)=>{const ge=tl(I.data,I.width,I.height,Me.x,Me.y,Me.w,Me.h);return{id:Ee,rawMeans:ge.means,refRGB:[0,0,0]}}).map((Me,Ee)=>({...Me,refRGB:Ob[Ee]||[0,0,0]}));Cr(fe),Ne(!0)}catch(X){pt("Color Lab Error: "+X.message)}finally{xt(null)}},100))},EA=T=>{vr(T),wt.length===4&&ow(wt,T)},IA=()=>{Ne(!1)},RA=()=>{G||Sr("No EXIF data found. The file might not contain metadata or it was stripped during processing."),tt(!0)},DA=async T=>{xt("Parsing PTC Data...");const U=[];let X=null;try{for(let Y=0;Y<T.length;Y++){const Me=(await T[Y].text()).split(`
`);let Ee=!0;for(const ge of Me){const Ve=ge.trim();if(!Ve)continue;if(Ve.startsWith("#")){if(Ve.includes("BlackLevel:")){const Qr=Ve.split(":")[1].trim().split(",");if(Qr.length>=4){const ri=Qr.map(Number);X||(X={}),X.blackLevel=ri}}if(Ve.includes("ImageHeight:")){const Qr=parseInt(Ve.split(":")[1].trim());isNaN(Qr)||(X||(X={}),X.height=Qr)}continue}if(Ee){Ve.toLowerCase().includes("mean")&&Ve.toLowerCase().includes("std")&&(Ee=!1);continue}const Le=Ve.split(",");if(Le.length<5)continue;let Ge=0,ft;isNaN(parseFloat(Le[0]))&&(ft=Le[0],Ge=1);const Ce=parseInt(Le[Ge]),gt=parseInt(Le[Ge+1]),or=parseFloat(Le[Ge+2]),Ur=parseFloat(Le[Ge+3]),xr=parseFloat(Le[Ge+4]),At=parseFloat(Le[Ge+5]),Pt=parseFloat(Le[Ge+6]),zr=parseFloat(Le[Ge+7]),kn=parseFloat(Le[Ge+8]),dn=parseFloat(Le[Ge+9]);!isNaN(or)&&!isNaN(Pt)&&U.push({channel:"R",mean:or,std:Pt,filename:ft,row:Ce,col:gt}),!isNaN(Ur)&&!isNaN(zr)&&U.push({channel:"G1",mean:Ur,std:zr,filename:ft,row:Ce,col:gt}),!isNaN(xr)&&!isNaN(kn)&&U.push({channel:"G2",mean:xr,std:kn,filename:ft,row:Ce,col:gt}),!isNaN(At)&&!isNaN(dn)&&U.push({channel:"B",mean:At,std:dn,filename:ft,row:Ce,col:gt})}}Ys(U),Jl(X),h(!0)}catch(Y){console.error("PTC Parse Error",Y),pt("Failed to parse CSV files: "+Y.message)}finally{xt(null)}},$A=()=>{if(!z||!O)return;const T=new Blob([z],{type:"image/x-adobe-dng"}),U=URL.createObjectURL(T),X=document.createElement("a");X.href=U;const Y=O.fileName||"image.dng",fe=Y.toLowerCase().endsWith(".dng")?Y:Y.replace(/\.[^/.]+$/,"")+".dng";X.download=fe,document.body.appendChild(X),X.click(),document.body.removeChild(X),URL.revokeObjectURL(U)},LA=()=>{La(1),Ba([]),Ui([])},sw=()=>{window.open("https://github.com/y-g-jiang/y-g-jiang.github.io/blob/main/drtest.png","_blank")},BA=j.useMemo(()=>dr?dr.map((T,U)=>({...T,refRGB:Ob[U]||[0,0,0]})):[],[dr]),FA=()=>{cn(1),vn([]),ar([])},GA=T=>{if(Nr===0)return;const U=[...ea,T];if(vn(U),U.length===4){cn(0);try{const X=ale(U);ar(X),aw({useNR:!0,useDeshading:!0,greenOnly:!1})}catch(X){console.error("Standard Chart Gen Error",X),pt("Failed to generate chart ROIs.")}}else cn(X=>X+1)},UA=j.useMemo(()=>{if(!Xe||!J)return null;const T=J.masks.find(U=>U.id===J.selectedMaskId);return!T||!(T.overlayVisible??!0)?null:{alpha:T.alpha,width:T.width,height:T.height,version:T.version}},[Xe,J]),zA=j.useMemo(()=>{if(!Xe||!J||pr!=="off")return null;const T=J.masks.find(X=>X.id===J.selectedMaskId);if(!T)return null;const U=(T.items||[]).find(X=>X.id===J.selectedMaskItemId);return!U||U.type!=="ellipse"?null:{id:U.id,center:U.center,radiusX:U.radiusX,radiusY:U.radiusY,rotationDeg:U.rotationDeg}},[Xe,J,pr]);let p0=jt||V||B;Xe||(Xn==="reference"&&K?p0=K:Xn==="sampled"&&q&&(p0=q));const lw=Ql||Gr;return c.jsxs("div",{className:"flex flex-col h-screen bg-[#d4d4d4] dark:bg-[#111111] text-black dark:text-gray-200 font-mono transition-colors duration-300 overflow-hidden",children:[c.jsx("div",{className:"p-4 pb-0 flex-shrink-0",children:c.jsx(b8,{onLoadImage:fA,onFileSelected:hA,onGenerateFakeDng:xA,fileName:C?C.name:null,hasGeneratedData:(C==null?void 0:C.name)==="pattern_test.dng",viewMode:Xn,onSetViewMode:Ma,patternPeriod:kt,onPatternPeriodChange:qt,fillFactor:un,onFillFactorChange:da,patternPhase:gn,onPatternPhaseChange:bi,showPatternControls:(C==null?void 0:C.name)==="pattern_test.dng",onOpenAbout:()=>lr(!0),onShowExif:RA,bridgeStatus:M,onBridgeClick:()=>P(!0),isDrLabOpen:ve,onToggleDrLab:()=>{if(Xe){pt("Cannot switch labs while PS Mode is locked.");return}de(!ve),La(0),Ba([]),Ui([]),De&&Ye(!1),Ke&&ot(!1),st&&_t(!1),ir(0),et([]),ar([]),$t(!1),cn(0)},isColorLabOpen:Ke,onToggleColorLab:()=>{if(Xe){pt("Cannot switch labs while PS Mode is locked.");return}ot(!Ke),Rt([]),ir(0),et([]),ve&&de(!1),De&&Ye(!1),st&&_t(!1),ar([]),$t(!1),cn(0)},isFftLabOpen:De,onToggleFftLab:()=>{if(Xe){pt("Cannot switch labs while PS Mode is locked.");return}Ye(!De),ve&&de(!1),Ke&&ot(!1),st&&_t(!1),ir(0),et([]),ar([]),$t(!1),cn(0)},isSfrLabOpen:st,onToggleSfrLab:()=>{if(Xe){pt("Cannot switch labs while PS Mode is locked.");return}_t(!st),ve&&de(!1),Ke&&ot(!1),De&&Ye(!1),ir(0),et([]),ar([]),$t(!1),cn(0)},isPsModeOpen:Xe,onTogglePsMode:gm,onGenerateTestPic:sw,onPTCFilesSelected:DA,onDownloadDng:$A,isThreePlane:pe,onOpenDatabase:()=>x(!0),isSidebarOpen:ut,onToggleSidebar:()=>dt(!ut),stretchMultiplier:_e,onStretchMultiplierChange:ee,onStretchDngExport:pm,isRawLoaded:!!I,onOpenSaveZ8:()=>v(!0)})}),c.jsxs("div",{className:"flex flex-1 overflow-hidden p-4 pt-2 gap-4 relative",children:[c.jsxs("div",{className:"flex-1 relative bg-gray-200 dark:bg-black border-4 border-gray-500 dark:border-gray-700 shadow-[inset_2px_2px_8px_rgba(0,0,0,0.2)] overflow-hidden transition-colors duration-300",ref:Qs,children:[lw&&c.jsxs("div",{className:"absolute bottom-4 right-4 z-50 flex items-center gap-2 bg-white/90 dark:bg-black/90 px-3 py-1.5 border-2 border-black dark:border-white shadow-[4px_4px_0px_black] dark:shadow-[4px_4px_0px_gray]",children:[c.jsx("div",{className:"w-4 h-4 border-2 border-black dark:border-white border-t-transparent animate-spin"}),c.jsx("span",{className:"text-xs font-bold text-black dark:text-white uppercase",children:Ql||"Processing..."})]}),u&&c.jsx("div",{className:"absolute top-2 left-2 z-30 pointer-events-none opacity-50 hover:opacity-100 transition-opacity",children:c.jsx("span",{className:"text-[9px] font-bold text-cyan-500 bg-black/50 px-1 py-0.5 rounded border border-cyan-500/50",children:" WebGPU"})}),A.length>1&&c.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-50 flex items-center gap-4 bg-white/90 dark:bg-slate-900/90 px-4 py-2 rounded-full shadow-lg border border-gray-200 dark:border-slate-700",children:[c.jsx("button",{onClick:Yu,disabled:D===0,className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-full disabled:opacity-30",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),c.jsxs("span",{className:"font-mono text-xs font-bold text-gray-700 dark:text-gray-300",children:[D+1," / ",A.length]}),c.jsx("button",{onClick:Ku,disabled:D===A.length-1,className:"p-1 hover:bg-gray-200 dark:hover:bg-slate-700 rounded-full disabled:opacity-30",children:c.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:c.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]}),c.jsxs("div",{className:"absolute bottom-4 left-4 z-40 flex flex-col-reverse gap-2 items-start pointer-events-none",children:[xe&&se&&c.jsxs("button",{onClick:()=>Se(!1),className:"pointer-events-auto bg-white dark:bg-slate-800 border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] px-3 py-2 text-xs font-bold uppercase tracking-widest hover:translate-x-1 transition-transform flex items-center gap-2",children:[c.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),"ROI Stats"]}),Oe.filter(T=>T.isMinimized).map(T=>c.jsxs("button",{onClick:()=>cA(T.id),className:"pointer-events-auto bg-white dark:bg-slate-800 border-2 border-black dark:border-white shadow-[4px_4px_0px_rgba(0,0,0,0.5)] px-3 py-2 text-xs font-bold uppercase tracking-widest hover:translate-x-1 transition-transform flex items-center gap-2",children:[c.jsx("span",{className:`w-2 h-2 rounded-full animate-pulse ${T.type==="histogram"?"bg-cyan-500":T.type==="fft"?"bg-purple-500":T.type==="quant"?"bg-teal-500":"bg-indigo-500"}`}),T.type==="histogram"?"Histogram":T.type==="fft"?"Power Spectrum":T.type==="quant"?"Quantization":"Pearson"]},T.id))]}),c.jsx(Moe,{isOpen:Kt,onClose:()=>lr(!1)}),c.jsx(_oe,{isOpen:ht,onClose:()=>tt(!1),data:G,fileName:C?C.name:"",warning:vt}),c.jsx(Noe,{isOpen:f,onClose:()=>h(!1),data:Wu,blackLevel:fo,imageHeight:Wo,isBGGR:ue,importedMetadata:Vu||void 0,theme:s,initialCameraModel:(G==null?void 0:G.Model)||"",initialISO:(G==null?void 0:G.ISO)||((cw=G==null?void 0:G.ISOSpeedRatings)==null?void 0:cw.toString())||""}),c.jsx(Eoe,{isOpen:p,onClose:()=>x(!1),theme:s}),c.jsx(Ioe,{isOpen:b,onClose:()=>y(!1),zIndex:200}),c.jsx(Foe,{isOpen:Fr,onClose:IA,patchStats:BA,initialIsBGGR:ue,sizeRatio:Mr,onSizeChange:EA}),c.jsx(Hoe,{isOpen:st,isSfrLabOpen:st,onClose:()=>{},rawImageData:I,roi:se?{x:se.x,y:se.y,w:se.width,h:se.height}:null,zIndex:200,onFocus:Zu,displaySettings:ae}),c.jsx(Koe,{isOpen:m,onClose:()=>g(!1),rawImageData:I,fileName:(C==null?void 0:C.name)||"image.dng",zIndex:300,onFocus:Zu}),c.jsx($se,{isOpen:k,onClose:()=>S(!1),zIndex:350,onFocus:Zu}),c.jsx(Use,{isOpen:w,onClose:()=>v(!1),zIndex:400,onFocus:Zu}),c.jsx(As,{isOpen:Ft,onClose:()=>rt(!1),onConfirm:yA,title:"High Resource Usage Warning",confirmText:"I know the risk and insist to continue",message:c.jsxs("div",{className:"flex flex-col gap-2",children:[c.jsx("p",{children:"Patter DNG mode involves high-frequency refreshing and heavy computation. Due to current memory management limitations, repeated use may lead to browser memory overflow or crashes. Please proceed with caution."}),c.jsx("p",{className:"text-xs text-gray-500"})]})}),c.jsx(As,{isOpen:_,onClose:()=>P(!1),onConfirm:()=>{window.open("https://y-g-jiang.github.io/jiangbridge.exe","_blank"),P(!1)},title:"JiangBridge Connection / ",confirmText:"Download Bridge App",cancelText:"Cancel",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsx("p",{className:"font-bold text-gray-800 dark:text-gray-200",children:"JiangBridge"}),c.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:'JiangBridge is optional for this webpage, but recommended for full functionality. Simply double-click and run it once after system startup. If the indicator light does not turn green after double-clicking, please consider checking whether the web page is allowed to "View and connect to any device on the network".'})]})}),c.jsx(As,{isOpen:Vt,onClose:()=>gr(!1),onConfirm:i0,title:"Export 16-bit TIFF Options",confirmText:"Confirm Export",message:c.jsxs("div",{className:"flex flex-col gap-4 text-left",children:[c.jsxs("div",{className:"grid grid-cols-2 gap-4 bg-gray-50 dark:bg-slate-800/80 p-4 border border-gray-400 dark:border-600",children:[c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("span",{className:"font-bold text-xs text-gray-800 dark:text-slate-200",children:"Stretch ()"}),c.jsx("span",{className:"text-[9px] text-gray-500 dark:text-slate-400 mt-0.5",children:"Map [0, White] to [0, 65535]"})]}),c.jsx("div",{onClick:()=>zt(!Zt),className:`relative w-12 h-6 border-2 border-black dark:border-white cursor-pointer ${Zt?"bg-black dark:bg-white":"bg-gray-300 dark:bg-slate-600"}`,children:c.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white dark:bg-black shadow-sm transition-transform ${Zt?"translate-x-6":""}`})})]}),c.jsxs("div",{className:"flex flex-col items-center gap-3",children:[c.jsxs("div",{className:"flex flex-col items-center text-center",children:[c.jsx("span",{className:"font-bold text-xs text-gray-800 dark:text-slate-200",children:"sRGB Gamma"}),c.jsx("span",{className:"text-[9px] text-gray-500 dark:text-slate-400 mt-0.5",children:"Apply non-linear contrast"})]}),c.jsx("div",{onClick:()=>Ot(!rr),className:`relative w-12 h-6 border-2 border-black dark:border-white cursor-pointer ${rr?"bg-black dark:bg-white":"bg-gray-300 dark:bg-slate-600"}`,children:c.jsx("div",{className:`absolute top-0.5 left-0.5 w-4 h-4 bg-white dark:bg-black shadow-sm transition-transform ${rr?"translate-x-6":""}`})})]})]}),c.jsxs("div",{className:"p-3 bg-gray-200 dark:bg-slate-800 text-[11px] text-black dark:text-white italic border border-gray-400 dark:border-gray-600 text-center font-mono",children:[Zt&&!rr&&"Mode: Stretched Linear. Histogram preserved but range expanded.",!Zt&&rr&&"Mode: Native DN + sRGB. Best for analyzing raw distribution contrast.",Zt&&rr&&"Mode: Ready-to-Use. Conventional 16-bit development.",!Zt&&!rr&&"Mode: Native Linear. Pure physical sensor DN values."]})]})}),!xe&&c.jsx(mle,{stats:se,onClose:()=>{he(null),te(null)},onMinimize:()=>Se(!0),isBGGR:ue,onToggleBGGR:ie,onOpenWindow:oA,displaySettings:ae,zIndex:bt,onFocus:Zu,rawImageData:I}),Oe.map(T=>{if(T.isMinimized)return null;const U=A.find(fe=>fe.id===T.sessionId),X=U==null?void 0:U.rawImageData;if(!X)return null;const Y={key:T.id,isOpen:!0,onClose:()=>sA(T.id),onMinimize:()=>lA(T.id),rawImageData:X,roi:T.roi,isBGGR:T.isBGGR,zIndex:T.zIndex,onFocus:()=>ew(T.id),initialPosition:T.initialPosition,initialInternalState:T.internalState,onUpdateState:fe=>uA(T.id,fe),stackFiles:T.stackFiles};return T.type==="histogram"?c.jsx(moe,{...Y}):T.type==="fft"?c.jsx(voe,{...Y,onUpdateROI:fe=>dA(T.id,fe)}):T.type==="quant"?c.jsx(woe,{...Y}):T.type==="pearson"?c.jsx(koe,{...Y}):null}),Zs&&c.jsx("div",{className:"absolute inset-0 z-50 flex items-center justify-center bg-white/90 dark:bg-black/90 p-8",children:c.jsxs("div",{className:"max-w-md text-center p-6 bg-white dark:bg-black rounded-none border-2 border-red-600 shadow-[8px_8px_0px_rgba(200,0,0,0.5)]",children:[c.jsx("h3",{className:"text-xl font-bold text-red-600 uppercase mb-2",children:"Notice"}),c.jsx("p",{className:"text-black dark:text-white mb-6 whitespace-pre-wrap font-mono",children:Zs}),c.jsx("button",{onClick:()=>pt(null),className:"px-4 py-2 bg-gray-200 hover:bg-gray-300 dark:bg-gray-800 dark:hover:bg-gray-700 border-2 border-black dark:border-white text-black dark:text-white transition-colors uppercase font-bold",children:"Dismiss"})]})}),!p0&&!lw&&!Zs&&c.jsx("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-gray-400 dark:text-gray-600 select-none font-mono",children:c.jsx("p",{className:"text-lg",children:"Load an image or generate a pattern"})}),c.jsx(v8,{image:p0,zoom:Js,pan:Vo,onPanChange:Ho,onZoomChange:rw,onSelectionChange:nw,forcedSelection:Ie,theme:s,touchAction:_a,isMarking:nn>0||Ke&&yt>0||Nr>0||Xe&&pr!=="off",onPointClick:T=>{nn>0?NA(T):Ke&&yt>0?TA(T):Nr>0&&GA(T)},markers:lo,gridRects:co,colorLabPoints:wt,colorLabRects:Lt,sfrRects:Wt,psMaskOverlay:UA,psMaskDirtyRect:nt,psGuides:Xe&&J?J.guides:[],psSelectedGuideId:Xe&&J?J.selectedGuideId:null,psGuidePickTarget:Xe?it:null,psEllipseTool:Xe?{mode:pr,draft:Tt}:{mode:"off",draft:null},psEditableEllipse:zA,psBrush:{enabled:Xe&&nr,size:mt,opacity:Pr,mode:Qt},onPsBrushPaint:iA,onPsGuidePickPoint:fa,onPsEllipseCenterPick:f0,onPsEllipseDrag:H,onPsEditEllipse:c0}),Nr>0&&ea.map((T,U)=>c.jsxs("div",{className:"absolute pointer-events-none z-30",style:{left:T.x*Js+Vo.x,top:T.y*Js+Vo.y,transform:"translate(-50%, -50%)"},children:[c.jsx("div",{className:"w-3 h-3 border-2 border-cyan-400 rounded-full flex items-center justify-center bg-transparent",children:c.jsx("div",{className:"w-1 h-1 bg-cyan-400 rounded-full"})}),c.jsx("div",{className:"text-[10px] font-bold text-cyan-400 absolute top-3 left-1/2 -translate-x-1/2 bg-black/50 px-1 rounded",children:U+1})]},U)),c.jsx("div",{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-1/2 z-30 pointer-events-none select-none opacity-20 mix-blend-normal dark:mix-blend-plus-lighter",children:c.jsx("svg",{viewBox:"0 0 500 60",className:"w-full h-auto drop-shadow-none",children:c.jsx("text",{x:"50%",y:"50%",dominantBaseline:"middle",textAnchor:"middle",className:"fill-black dark:fill-white",fontSize:"26",fontWeight:"bold",style:{fontFamily:"Courier New, monospace",letterSpacing:"0.05em"},children:" y-g-jiang.github.io"})})}),I&&!nn&&!Ke&&!We&&!Nr&&c.jsxs("div",{className:"absolute bottom-4 left-4 z-30 pointer-events-none opacity-60 text-[10px] text-black dark:text-white font-mono bg-white/50 dark:bg-black/50 px-1",children:["Hold ",c.jsx("b",{children:"Shift"})," + Drag to calculate Raw ROI stats"]}),We&&c.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-red-500 bg-black/80 px-4 py-2 rounded-full border border-red-500 animate-pulse shadow-lg",children:"Manual Batch Marking Active (Shift+Drag to add)"}),Nr>0&&c.jsxs("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-emerald-500 bg-black/80 px-4 py-2 rounded-full border border-emerald-500 animate-pulse shadow-lg",children:["Calibration: Click Corner ",Nr,"/4"]}),Ke&&yt>0&&c.jsxs("div",{className:"absolute top-4 left-1/2 -translate-x-1/2 z-30 pointer-events-none text-sm font-bold text-yellow-500 bg-black/80 px-4 py-2 rounded-full border border-yellow-500 animate-pulse shadow-lg",children:[wt.length===0&&"Click Top-Left Corner of Chart",wt.length===1&&"Click Top-Right Corner",wt.length===2&&"Click Bottom-Left Corner",wt.length===3&&"Click Bottom-Right Corner",wt.length===4&&"Processing..."]}),c.jsx(KE,{zoom:Js,onZoomChange:rw,onResetView:()=>{Hu(1),Ho({x:0,y:0})},touchAction:_a,onToggleTouchAction:jA})]}),ut&&c.jsx("div",{className:"w-80 flex-shrink-0 bg-white dark:bg-black border-4 border-gray-500 dark:border-gray-700 shadow-[inset_2px_2px_8px_rgba(0,0,0,0.2)] overflow-hidden transition-all duration-300",children:c.jsx(FE,{rawImageData:I,displaySettings:ae,onApplyDisplaySettings:bA,onSetSelection:SA,exifData:G,isBridgeConnected:M.isConnected,isDrLabOpen:ve,drMarkingStep:nn,onStartMarking:LA,onGenerateTestPic:sw,drRoiSize:uo,onDrRoiSizeChange:qs,drGridRows:zi,onDrGridRowsChange:zo,drGridCols:ze,onDrGridColsChange:tr,onBatchDrLab:OA,hasDrMarkers:co.length>0,isFftLabOpen:De,onProcessPair:pA,onProcessBatchDiff:gA,onProcessStackFft:mA,onOpenCrossCalc:()=>y(!0),isThreePlane:pe,onToggleXTrans:kA,xtransPhase:Z,onXTransPhaseChange:wA,isXTransConverted:O==null?void 0:O.isXTransConverted,roiStats:se,isBGGR:ue,isColorLabOpen:Ke,colorLabMarkingStep:yt,onStartColorLabMarking:AA,isSfrLabOpen:st,onOpenDngExport:()=>g(!0),sfrRectCount:Wt.length,isBatchMarkingMode:We,onToggleBatchMarking:()=>$t(!We),onClearBatchMarks:()=>ar([]),onBatchCompute:aw,stdChartStep:Nr,onStartStandardCalibration:FA,onSaveBatchTemplate:_A,onImportBatchTemplate:PA,onBatchTransform:MA,onOpenStackingTool:()=>S(!0),isPsModeOpen:Xe,psDocument:J,canCreatePsEllipse:!!J,psBrushEnabled:nr,psBrushSize:mt,psBrushOpacity:Pr,psBrushFeather:jr,psEllipseFeather:Je,psBrushMode:Qt,onPsAddMask:Mm,onPsAddEllipseMask:u0,onPsCancelEllipseTool:d0,onPsFlipHorizontal:Xt,onPsFlipVertical:$r,onPsCropToRoi:be,onPsRotateCanvas:at,onPsApplyUpright:An,onPsApplyLensDistortion:wr,onPsSelectLayer:Ko,onPsSelectMask:km,onPsBindLayerMask:ZO,onPsSetLayerBlendMode:JO,onPsSetLayerOpacity:QO,onPsSetLayerBasic:eA,onPsSetLayerMixer:rA,onPsPreviewLayerBasic:tA,onPsPreviewLayerMixer:nA,onPsSetLayerCurves:aA,onPsSelectMaskItem:Sm,onPsUpdateEllipseItem:c0,onPsSetMaskOverlayVisible:jm,onPsAddGuide:ra,onPsSelectGuide:po,onPsSetGuideEndpoints:ti,psGuidePickTarget:it,onPsStartGuidePointPick:Yo,onPsCancelGuidePointPick:go,onPsDeleteGuide:_m,onPsUndo:mm,onPsJumpHistoryIndex:xm,onPsExportWorkflowCsv:vm,onPsImportWorkflowCsv:wm,onPsExportPng:ym,onPsExportJpeg:bm,onPsBrushEnabledChange:Gt,onPsBrushSizeChange:Jt,onPsBrushOpacityChange:Zr,onPsBrushFeatherChange:we,onPsEllipseFeatherChange:Qe,onPsBrushModeChange:Ht})}),c.jsx(YE,{theme:s,setTheme:l})]})]})},qO=document.getElementById("root");if(!qO)throw new Error("Could not find root element to mount to");const yle=Jx.createRoot(qO);yle.render(c.jsx(re.StrictMode,{children:c.jsx(xle,{})}));export{ct as _};
